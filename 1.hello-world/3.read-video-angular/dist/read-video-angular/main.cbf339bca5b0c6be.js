"use strict";(self.webpackChunkread_video_angular=self.webpackChunkread_video_angular||[]).push([[179],{206:()=>{function it(t){return"function"==typeof t}function fo(t){const n=t(i=>{Error.call(i),i.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const go=fo(t=>function(n){t(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function ur(t,e){if(t){const n=t.indexOf(e);0<=n&&t.splice(n,1)}}class mn{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const o of n)o.remove(this);else n.remove(this);const{initialTeardown:i}=this;if(it(i))try{i()}catch(o){e=o instanceof go?o.errors:[o]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const o of r)try{xu(o)}catch(s){e=e??[],s instanceof go?e=[...e,...s.errors]:e.push(s)}}if(e)throw new go(e)}}add(e){var n;if(e&&e!==this)if(this.closed)xu(e);else{if(e instanceof mn){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(e)}}_hasParent(e){const{_parentage:n}=this;return n===e||Array.isArray(n)&&n.includes(e)}_addParent(e){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e}_removeParent(e){const{_parentage:n}=this;n===e?this._parentage=null:Array.isArray(n)&&ur(n,e)}remove(e){const{_finalizers:n}=this;n&&ur(n,e),e instanceof mn&&e._removeParent(this)}}mn.EMPTY=(()=>{const t=new mn;return t.closed=!0,t})();const Iu=mn.EMPTY;function Tu(t){return t instanceof mn||t&&"closed"in t&&it(t.remove)&&it(t.add)&&it(t.unsubscribe)}function xu(t){it(t)?t():t.unsubscribe()}const ti={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},po={setTimeout(t,e,...n){const{delegate:i}=po;return i?.setTimeout?i.setTimeout(t,e,...n):setTimeout(t,e,...n)},clearTimeout(t){const{delegate:e}=po;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Au(t){po.setTimeout(()=>{const{onUnhandledError:e}=ti;if(!e)throw t;e(t)})}function Mu(){}const mv=ia("C",void 0,void 0);function ia(t,e,n){return{kind:t,value:e,error:n}}let ni=null;function mo(t){if(ti.useDeprecatedSynchronousErrorHandling){const e=!ni;if(e&&(ni={errorThrown:!1,error:null}),t(),e){const{errorThrown:n,error:i}=ni;if(ni=null,n)throw i}}else t()}class ra extends mn{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Tu(e)&&e.add(this)):this.destination=bv}static create(e,n,i){return new dr(e,n,i)}next(e){this.isStopped?sa(function vv(t){return ia("N",t,void 0)}(e),this):this._next(e)}error(e){this.isStopped?sa(function _v(t){return ia("E",void 0,t)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?sa(mv,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Cv=Function.prototype.bind;function oa(t,e){return Cv.call(t,e)}class wv{constructor(e){this.partialObserver=e}next(e){const{partialObserver:n}=this;if(n.next)try{n.next(e)}catch(i){_o(i)}}error(e){const{partialObserver:n}=this;if(n.error)try{n.error(e)}catch(i){_o(i)}else _o(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(n){_o(n)}}}class dr extends ra{constructor(e,n,i){let r;if(super(),it(e)||!e)r={next:e??void 0,error:n??void 0,complete:i??void 0};else{let o;this&&ti.useDeprecatedNextContext?(o=Object.create(e),o.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&oa(e.next,o),error:e.error&&oa(e.error,o),complete:e.complete&&oa(e.complete,o)}):r=e}this.destination=new wv(r)}}function _o(t){ti.useDeprecatedSynchronousErrorHandling?function yv(t){ti.useDeprecatedSynchronousErrorHandling&&ni&&(ni.errorThrown=!0,ni.error=t)}(t):Au(t)}function sa(t,e){const{onStoppedNotification:n}=ti;n&&po.setTimeout(()=>n(t,e))}const bv={closed:!0,next:Mu,error:function Sv(t){throw t},complete:Mu},aa="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ou(t){return t}let Mt=(()=>{class t{constructor(n){n&&(this._subscribe=n)}lift(n){const i=new t;return i.source=this,i.operator=n,i}subscribe(n,i,r){const o=function Ev(t){return t&&t instanceof ra||function Dv(t){return t&&it(t.next)&&it(t.error)&&it(t.complete)}(t)&&Tu(t)}(n)?n:new dr(n,i,r);return mo(()=>{const{operator:s,source:u}=this;o.add(s?s.call(o,u):u?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return new(i=Fu(i))((r,o)=>{const s=new dr({next:u=>{try{n(u)}catch(g){o(g),s.unsubscribe()}},error:o,complete:r});this.subscribe(s)})}_subscribe(n){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(n)}[aa](){return this}pipe(...n){return function Ru(t){return 0===t.length?Ou:1===t.length?t[0]:function(n){return t.reduce((i,r)=>r(i),n)}}(n)(this)}toPromise(n){return new(n=Fu(n))((i,r)=>{let o;this.subscribe(s=>o=s,s=>r(s),()=>i(o))})}}return t.create=e=>new t(e),t})();function Fu(t){var e;return null!==(e=t??ti.Promise)&&void 0!==e?e:Promise}const Iv=fo(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let la=(()=>{class t extends Mt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const i=new Pu(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new Iv}next(n){mo(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(n)}})}error(n){mo(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){mo(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:i,isStopped:r,observers:o}=this;return i||r?Iu:(this.currentObservers=null,o.push(n),new mn(()=>{this.currentObservers=null,ur(o,n)}))}_checkFinalizedStatuses(n){const{hasError:i,thrownError:r,isStopped:o}=this;i?n.error(r):o&&n.complete()}asObservable(){const n=new Mt;return n.source=this,n}}return t.create=(e,n)=>new Pu(e,n),t})();class Pu extends la{constructor(e,n){super(),this.destination=e,this.source=n}next(e){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===i||i.call(n,e)}error(e){var n,i;null===(i=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===i||i.call(n,e)}complete(){var e,n;null===(n=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===n||n.call(e)}_subscribe(e){var n,i;return null!==(i=null===(n=this.source)||void 0===n?void 0:n.subscribe(e))&&void 0!==i?i:Iu}}function hr(t){return e=>{if(function Tv(t){return it(t?.lift)}(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function vo(t,e,n,i,r){return new xv(t,e,n,i,r)}class xv extends ra{constructor(e,n,i,r,o,s){super(e),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=n?function(u){try{n(u)}catch(g){e.error(g)}}:super._next,this._error=r?function(u){try{r(u)}catch(g){e.error(g)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(u){e.error(u)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function zn(t){return this instanceof zn?(this.v=t,this):new zn(t)}function Bu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,e=t[Symbol.asyncIterator];return e?e.call(t):(t=function ha(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(t),n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n);function i(o){n[o]=t[o]&&function(s){return new Promise(function(u,g){!function r(o,s,u,g){Promise.resolve(g).then(function(v){o({value:v,done:u})},s)}(u,g,(s=t[o](s)).done,s.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const ju=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function Vu(t){return it(t?.then)}function Uu(t){return it(t[aa])}function Hu(t){return Symbol.asyncIterator&&it(t?.[Symbol.asyncIterator])}function Gu(t){return new TypeError(`You provided ${null!==t&&"object"==typeof t?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Wu=function Kv(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function zu(t){return it(t?.[Wu])}function $u(t){return function Nu(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(I){i[I]&&(r[I]=function(x){return new Promise(function(O,R){o.push([I,x,O,R])>1||u(I,x)})})}function u(I,x){try{!function g(I){I.value instanceof zn?Promise.resolve(I.value.v).then(v,w):b(o[0][2],I)}(i[I](x))}catch(O){b(o[0][3],O)}}function v(I){u("next",I)}function w(I){u("throw",I)}function b(I,x){I(x),o.shift(),o.length&&u(o[0][0],o[0][1])}}(this,arguments,function*(){const n=t.getReader();try{for(;;){const{value:i,done:r}=yield zn(n.read());if(r)return yield zn(void 0);yield yield zn(i)}}finally{n.releaseLock()}})}function Yu(t){return it(t?.getReader)}function $n(t){if(t instanceof Mt)return t;if(null!=t){if(Uu(t))return function Jv(t){return new Mt(e=>{const n=t[aa]();if(it(n.subscribe))return n.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(t);if(ju(t))return function Qv(t){return new Mt(e=>{for(let n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()})}(t);if(Vu(t))return function ey(t){return new Mt(e=>{t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,Au)})}(t);if(Hu(t))return Xu(t);if(zu(t))return function ty(t){return new Mt(e=>{for(const n of t)if(e.next(n),e.closed)return;e.complete()})}(t);if(Yu(t))return function ny(t){return Xu($u(t))}(t)}throw Gu(t)}function Xu(t){return new Mt(e=>{(function iy(t,e){var n,i,r,o;return function Lu(t,e,n,i){return new(n||(n=Promise))(function(o,s){function u(w){try{v(i.next(w))}catch(b){s(b)}}function g(w){try{v(i.throw(w))}catch(b){s(b)}}function v(w){w.done?o(w.value):function r(o){return o instanceof n?o:new n(function(s){s(o)})}(w.value).then(u,g)}v((i=i.apply(t,e||[])).next())})}(this,void 0,void 0,function*(){try{for(n=Bu(t);!(i=yield n.next()).done;)if(e.next(i.value),e.closed)return}catch(s){r={error:s}}finally{try{i&&!i.done&&(o=n.return)&&(yield o.call(n))}finally{if(r)throw r.error}}e.complete()})})(t,e).catch(n=>e.error(n))})}function Yn(t,e,n,i=0,r=!1){const o=e.schedule(function(){n(),r?t.add(this.schedule(null,i)):this.unsubscribe()},i);if(t.add(o),!r)return o}function qu(t,e,n=1/0){return it(e)?qu((i,r)=>function Av(t,e){return hr((n,i)=>{let r=0;n.subscribe(vo(i,o=>{i.next(t.call(e,o,r++))}))})}((o,s)=>e(i,o,r,s))($n(t(i,r))),n):("number"==typeof e&&(n=e),hr((i,r)=>function ry(t,e,n,i,r,o,s,u){const g=[];let v=0,w=0,b=!1;const I=()=>{b&&!g.length&&!v&&e.complete()},x=R=>v<i?O(R):g.push(R),O=R=>{o&&e.next(R),v++;let P=!1;$n(n(R,w++)).subscribe(vo(e,V=>{r?.(V),o?x(V):e.next(V)},()=>{P=!0},void 0,()=>{if(P)try{for(v--;g.length&&v<i;){const V=g.shift();s?Yn(e,s,()=>O(V)):O(V)}I()}catch(V){e.error(V)}}))};return t.subscribe(vo(e,x,()=>{b=!0,I()})),()=>{u?.()}}(i,r,t,n)))}const Zu=new Mt(t=>t.complete());function fa(t){return t[t.length-1]}function Ku(t,e=0){return hr((n,i)=>{n.subscribe(vo(i,r=>Yn(i,t,()=>i.next(r),e),()=>Yn(i,t,()=>i.complete(),e),r=>Yn(i,t,()=>i.error(r),e)))})}function Ju(t,e=0){return hr((n,i)=>{i.add(t.schedule(()=>n.subscribe(i),e))})}function Qu(t,e){if(!t)throw new Error("Iterable cannot be null");return new Mt(n=>{Yn(n,e,()=>{const i=t[Symbol.asyncIterator]();Yn(n,e,()=>{i.next().then(r=>{r.done?n.complete():n.next(r.value)})},0,!0)})})}function _y(...t){const e=function ly(t){return function ay(t){return t&&it(t.schedule)}(fa(t))?t.pop():void 0}(t),n=function cy(t,e){return"number"==typeof fa(t)?t.pop():e}(t,1/0),i=t;return i.length?1===i.length?$n(i[0]):function oy(t=1/0){return qu(Ou,t)}(n)(function my(t,e){return e?function py(t,e){if(null!=t){if(Uu(t))return function uy(t,e){return $n(t).pipe(Ju(e),Ku(e))}(t,e);if(ju(t))return function hy(t,e){return new Mt(n=>{let i=0;return e.schedule(function(){i===t.length?n.complete():(n.next(t[i++]),n.closed||this.schedule())})})}(t,e);if(Vu(t))return function dy(t,e){return $n(t).pipe(Ju(e),Ku(e))}(t,e);if(Hu(t))return Qu(t,e);if(zu(t))return function fy(t,e){return new Mt(n=>{let i;return Yn(n,e,()=>{i=t[Wu](),Yn(n,e,()=>{let r,o;try{({value:r,done:o}=i.next())}catch(s){return void n.error(s)}o?n.complete():n.next(r)},0,!0)}),()=>it(i?.return)&&i.return()})}(t,e);if(Yu(t))return function gy(t,e){return Qu($u(t),e)}(t,e)}throw Gu(t)}(t,e):$n(t)}(i,e)):Zu}function ga(t,e,...n){if(!0===e)return void t();if(!1===e)return;const i=new dr({next:()=>{i.unsubscribe(),t()}});return $n(e(...n)).subscribe(i)}function ze(t){for(let e in t)if(t[e]===ze)return e;throw Error("Could not find renamed property on target object.")}function $e(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map($e).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function ma(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const yy=ze({__forward_ref__:ze});function _a(t){return t.__forward_ref__=_a,t.toString=function(){return $e(this())},t}function Se(t){return function va(t){return"function"==typeof t&&t.hasOwnProperty(yy)&&t.__forward_ref__===_a}(t)?t():t}function ya(t){return t&&!!t.\u0275providers}class Ce extends Error{constructor(e,n){super(yo(e,n)),this.code=e}}function yo(t,e){return`NG0${Math.abs(t)}${e?": "+e.trim():""}`}function Ue(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():function Ie(t){return"string"==typeof t?t:null==t?"":String(t)}(t)}function Co(t,e){throw new Ce(-201,!1)}function Zt(t,e){null==t&&function He(t,e,n,i){throw new Error(`ASSERTION ERROR: ${t}`+(null==i?"":` [Expected=> ${n} ${i} ${e} <=Actual]`))}(e,t,null,"!=")}function Ke(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function vi(t){return{providers:t.providers||[],imports:t.imports||[]}}function wo(t){return td(t,So)||td(t,id)}function td(t,e){return t.hasOwnProperty(e)?t[e]:null}function nd(t){return t&&(t.hasOwnProperty(Ca)||t.hasOwnProperty(Iy))?t[Ca]:null}const So=ze({\u0275prov:ze}),Ca=ze({\u0275inj:ze}),id=ze({ngInjectableDef:ze}),Iy=ze({ngInjectorDef:ze});var Ee=(()=>((Ee=Ee||{})[Ee.Default=0]="Default",Ee[Ee.Host=1]="Host",Ee[Ee.Self=2]="Self",Ee[Ee.SkipSelf=4]="SkipSelf",Ee[Ee.Optional=8]="Optional",Ee))();let wa;function Kt(t){const e=wa;return wa=t,e}function rd(t,e,n){const i=wo(t);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:n&Ee.Optional?null:void 0!==e?e:void Co($e(t))}const Xe=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),fr={},Sa="__NG_DI_FLAG__",bo="ngTempTokenPath",xy="ngTokenPath",Ay=/\n/gm,My="\u0275",od="__source";let gr;function yi(t){const e=gr;return gr=t,e}function Oy(t,e=Ee.Default){if(void 0===gr)throw new Ce(-203,!1);return null===gr?rd(t,void 0,e):gr.get(t,e&Ee.Optional?null:void 0,e)}function je(t,e=Ee.Default){return(function Ty(){return wa}()||Oy)(Se(t),e)}function Do(t){return typeof t>"u"||"number"==typeof t?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function ba(t){const e=[];for(let n=0;n<t.length;n++){const i=Se(t[n]);if(Array.isArray(i)){if(0===i.length)throw new Ce(900,!1);let r,o=Ee.Default;for(let s=0;s<i.length;s++){const u=i[s],g=Fy(u);"number"==typeof g?-1===g?r=u.token:o|=g:r=u}e.push(je(r,o))}else e.push(je(i))}return e}function pr(t,e){return t[Sa]=e,t.prototype[Sa]=e,t}function Fy(t){return t[Sa]}function Tn(t){return{toString:t}.toString()}var _n=(()=>((_n=_n||{})[_n.OnPush=0]="OnPush",_n[_n.Default=1]="Default",_n))(),vn=(()=>{return(t=vn||(vn={}))[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",vn;var t})();const xn={},Ve=[],Eo=ze({\u0275cmp:ze}),Da=ze({\u0275dir:ze}),Ea=ze({\u0275pipe:ze}),ad=ze({\u0275mod:ze}),An=ze({\u0275fac:ze}),mr=ze({__NG_ELEMENT_ID__:ze});let ky=0;function _r(t){return Tn(()=>{const e=cd(t),n={...e,decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===_n.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&t.dependencies||null,getStandaloneInjector:null,data:t.data||{},encapsulation:t.encapsulation||vn.Emulated,id:"c"+ky++,styles:t.styles||Ve,_:null,schemas:t.schemas||null,tView:null};ud(n);const i=t.dependencies;return n.directiveDefs=Io(i,!1),n.pipeDefs=Io(i,!0),n})}function By(t){return Ge(t)||vt(t)}function jy(t){return null!==t}function vr(t){return Tn(()=>({type:t.type,bootstrap:t.bootstrap||Ve,declarations:t.declarations||Ve,imports:t.imports||Ve,exports:t.exports||Ve,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function ld(t,e){if(null==t)return xn;const n={};for(const i in t)if(t.hasOwnProperty(i)){let r=t[i],o=r;Array.isArray(r)&&(o=r[1],r=r[0]),n[r]=i,e&&(e[r]=o)}return n}function Jt(t){return Tn(()=>{const e=cd(t);return ud(e),e})}function Ge(t){return t[Eo]||null}function vt(t){return t[Da]||null}function Rt(t){return t[Ea]||null}function cd(t){const e={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,exportAs:t.exportAs||null,standalone:!0===t.standalone,selectors:t.selectors||Ve,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ld(t.inputs,e),outputs:ld(t.outputs)}}function ud(t){t.features?.forEach(e=>e(t))}function Io(t,e){if(!t)return null;const n=e?Rt:By;return()=>("function"==typeof t?t():t).map(i=>n(i)).filter(jy)}const Mn=0,_e=1,Ae=2,rt=3,an=4,ii=5,yt=6,Ci=7,st=8,To=9,xo=10,Re=11,Ia=12,Cr=13,dd=14,wi=15,Ct=16,wr=17,Si=18,yn=19,Sr=20,hd=21,qe=22,Ta=1,fd=2,Ao=7,Mo=8,bi=9,Et=10;function Vt(t){return Array.isArray(t)&&"object"==typeof t[Ta]}function ln(t){return Array.isArray(t)&&!0===t[Ta]}function xa(t){return 0!=(4&t.flags)}function br(t){return t.componentOffset>-1}function Oo(t){return 1==(1&t.flags)}function cn(t){return!!t.template}function Uy(t){return 0!=(256&t[Ae])}function ri(t,e){return t.hasOwnProperty(An)?t[An]:null}class Wy{constructor(e,n,i){this.previousValue=e,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}}function md(t){return t.type.prototype.ngOnChanges&&(t.setInput=$y),zy}function zy(){const t=vd(this),e=t?.current;if(e){const n=t.previous;if(n===xn)t.previous=e;else for(let i in e)n[i]=e[i];t.current=null,this.ngOnChanges(e)}}function $y(t,e,n,i){const r=this.declaredInputs[n],o=vd(t)||function Yy(t,e){return t[_d]=e}(t,{previous:xn,current:null}),s=o.current||(o.current={}),u=o.previous,g=u[r];s[r]=new Wy(g&&g.currentValue,e,u===xn),t[i]=e}const _d="__ngSimpleChanges__";function vd(t){return t[_d]||null}const Qt=function(t,e,n){},yd="svg";function pt(t){for(;Array.isArray(t);)t=t[Mn];return t}function Ut(t,e){return pt(e[t.index])}function wd(t,e){return t.data[e]}function Ft(t,e){const n=e[t];return Vt(n)?n:n[Mn]}function Po(t){return 64==(64&t[Ae])}function qn(t,e){return null==e?null:t[e]}function Sd(t){t[Si]=0}function Ma(t,e){t[ii]+=e;let n=t,i=t[rt];for(;null!==i&&(1===e&&1===n[ii]||-1===e&&0===n[ii]);)i[ii]+=e,n=i,i=i[rt]}const Te={lFrame:Rd(null),bindingsEnabled:!0};function Dd(){return Te.bindingsEnabled}function oe(){return Te.lFrame.lView}function Be(){return Te.lFrame.tView}function mt(){let t=Ed();for(;null!==t&&64===t.type;)t=t.parent;return t}function Ed(){return Te.lFrame.currentTNode}function Cn(t,e){const n=Te.lFrame;n.currentTNode=t,n.isParent=e}function Oa(){return Te.lFrame.isParent}function c0(t,e){const n=Te.lFrame;n.bindingIndex=n.bindingRootIndex=t,Fa(e)}function Fa(t){Te.lFrame.currentDirectiveIndex=t}function La(t){Te.lFrame.currentQueryIndex=t}function d0(t){const e=t[_e];return 2===e.type?e.declTNode:1===e.type?t[yt]:null}function Md(t,e,n){if(n&Ee.SkipSelf){let r=e,o=t;for(;!(r=r.parent,null!==r||n&Ee.Host||(r=d0(o),null===r||(o=o[wi],10&r.type))););if(null===r)return!1;e=r,t=o}const i=Te.lFrame=Od();return i.currentTNode=e,i.lView=t,!0}function ka(t){const e=Od(),n=t[_e];Te.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function Od(){const t=Te.lFrame,e=null===t?null:t.child;return null===e?Rd(t):e}function Rd(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function Fd(){const t=Te.lFrame;return Te.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const Pd=Fd;function Na(){const t=Fd();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Tt(){return Te.lFrame.selectedIndex}function oi(t){Te.lFrame.selectedIndex=t}function Lo(){Te.lFrame.currentNamespace=yd}function Ba(){!function p0(){Te.lFrame.currentNamespace=null}()}function ko(t,e){for(let n=e.directiveStart,i=e.directiveEnd;n<i;n++){const o=t.data[n].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:u,ngAfterViewInit:g,ngAfterViewChecked:v,ngOnDestroy:w}=o;s&&(t.contentHooks??(t.contentHooks=[])).push(-n,s),u&&((t.contentHooks??(t.contentHooks=[])).push(n,u),(t.contentCheckHooks??(t.contentCheckHooks=[])).push(n,u)),g&&(t.viewHooks??(t.viewHooks=[])).push(-n,g),v&&((t.viewHooks??(t.viewHooks=[])).push(n,v),(t.viewCheckHooks??(t.viewCheckHooks=[])).push(n,v)),null!=w&&(t.destroyHooks??(t.destroyHooks=[])).push(n,w)}}function No(t,e,n){Ld(t,e,3,n)}function Bo(t,e,n,i){(3&t[Ae])===n&&Ld(t,e,n,i)}function ja(t,e){let n=t[Ae];(3&n)===e&&(n&=2047,n+=1,t[Ae]=n)}function Ld(t,e,n,i){const o=i??-1,s=e.length-1;let u=0;for(let g=void 0!==i?65535&t[Si]:0;g<s;g++)if("number"==typeof e[g+1]){if(u=e[g],null!=i&&u>=i)break}else e[g]<0&&(t[Si]+=65536),(u<o||-1==o)&&(v0(t,n,e,g),t[Si]=(4294901760&t[Si])+g+2),g++}function v0(t,e,n,i){const r=n[i]<0,o=n[i+1],u=t[r?-n[i]:n[i]];if(r){if(t[Ae]>>11<t[Si]>>16&&(3&t[Ae])===e){t[Ae]+=2048,Qt(4,u,o);try{o.call(u)}finally{Qt(5,u,o)}}}else{Qt(4,u,o);try{o.call(u)}finally{Qt(5,u,o)}}}const Ii=-1;class Er{constructor(e,n,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}}function Ua(t,e,n){let i=0;for(;i<n.length;){const r=n[i];if("number"==typeof r){if(0!==r)break;i++;const o=n[i++],s=n[i++],u=n[i++];t.setAttribute(e,s,u,o)}else{const o=r,s=n[++i];Nd(o)?t.setProperty(e,o,s):t.setAttribute(e,o,s),i++}}return i}function kd(t){return 3===t||4===t||6===t}function Nd(t){return 64===t.charCodeAt(0)}function Ir(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?n=r:0===n||Bd(t,n,r,null,-1===n||2===n?e[++i]:null)}}return t}function Bd(t,e,n,i,r){let o=0,s=t.length;if(-1===e)s=-1;else for(;o<t.length;){const u=t[o++];if("number"==typeof u){if(u===e){s=-1;break}if(u>e){s=o-1;break}}}for(;o<t.length;){const u=t[o];if("number"==typeof u)break;if(u===n){if(null===i)return void(null!==r&&(t[o+1]=r));if(i===t[o+1])return void(t[o+2]=r)}o++,null!==i&&o++,null!==r&&o++}-1!==s&&(t.splice(s,0,e),o=s+1),t.splice(o++,0,n),null!==i&&t.splice(o++,0,i),null!==r&&t.splice(o++,0,r)}function jd(t){return t!==Ii}function jo(t){return 32767&t}function Vo(t,e){let n=function S0(t){return t>>16}(t),i=e;for(;n>0;)i=i[wi],n--;return i}let Ha=!0;function Uo(t){const e=Ha;return Ha=t,e}const Vd=255,Ud=5;let b0=0;const wn={};function Ho(t,e){const n=Hd(t,e);if(-1!==n)return n;const i=e[_e];i.firstCreatePass&&(t.injectorIndex=e.length,Ga(i.data,t),Ga(e,null),Ga(i.blueprint,null));const r=Wa(t,e),o=t.injectorIndex;if(jd(r)){const s=jo(r),u=Vo(r,e),g=u[_e].data;for(let v=0;v<8;v++)e[o+v]=u[s+v]|g[s+v]}return e[o+8]=r,o}function Ga(t,e){t.push(0,0,0,0,0,0,0,0,e)}function Hd(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function Wa(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,i=null,r=e;for(;null!==r;){if(i=qd(r),null===i)return Ii;if(n++,r=r[wi],-1!==i.injectorIndex)return i.injectorIndex|n<<16}return Ii}function za(t,e,n){!function D0(t,e,n){let i;"string"==typeof n?i=n.charCodeAt(0)||0:n.hasOwnProperty(mr)&&(i=n[mr]),null==i&&(i=n[mr]=b0++);const r=i&Vd;e.data[t+(r>>Ud)]|=1<<r}(t,e,n)}function Gd(t,e,n){if(n&Ee.Optional||void 0!==t)return t;Co()}function Wd(t,e,n,i){if(n&Ee.Optional&&void 0===i&&(i=null),!(n&(Ee.Self|Ee.Host))){const r=t[To],o=Kt(void 0);try{return r?r.get(e,i,n&Ee.Optional):rd(e,i,n&Ee.Optional)}finally{Kt(o)}}return Gd(i,0,n)}function zd(t,e,n,i=Ee.Default,r){if(null!==t){if(1024&e[Ae]){const s=function M0(t,e,n,i,r){let o=t,s=e;for(;null!==o&&null!==s&&1024&s[Ae]&&!(256&s[Ae]);){const u=$d(o,s,n,i|Ee.Self,wn);if(u!==wn)return u;let g=o.parent;if(!g){const v=s[hd];if(v){const w=v.get(n,wn,i);if(w!==wn)return w}g=qd(s),s=s[wi]}o=g}return r}(t,e,n,i,wn);if(s!==wn)return s}const o=$d(t,e,n,i,wn);if(o!==wn)return o}return Wd(e,n,i,r)}function $d(t,e,n,i,r){const o=function T0(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(mr)?t[mr]:void 0;return"number"==typeof e?e>=0?e&Vd:x0:e}(n);if("function"==typeof o){if(!Md(e,t,i))return i&Ee.Host?Gd(r,0,i):Wd(e,n,i,r);try{const s=o(i);if(null!=s||i&Ee.Optional)return s;Co()}finally{Pd()}}else if("number"==typeof o){let s=null,u=Hd(t,e),g=Ii,v=i&Ee.Host?e[Ct][yt]:null;for((-1===u||i&Ee.SkipSelf)&&(g=-1===u?Wa(t,e):e[u+8],g!==Ii&&Xd(i,!1)?(s=e[_e],u=jo(g),e=Vo(g,e)):u=-1);-1!==u;){const w=e[_e];if(Yd(o,u,w.data)){const b=I0(u,e,n,s,i,v);if(b!==wn)return b}g=e[u+8],g!==Ii&&Xd(i,e[_e].data[u+8]===v)&&Yd(o,u,e)?(s=w,u=jo(g),e=Vo(g,e)):u=-1}}return r}function I0(t,e,n,i,r,o){const s=e[_e],u=s.data[t+8],w=function Go(t,e,n,i,r){const o=t.providerIndexes,s=e.data,u=1048575&o,g=t.directiveStart,w=o>>20,I=r?u+w:t.directiveEnd;for(let x=i?u:u+w;x<I;x++){const O=s[x];if(x<g&&n===O||x>=g&&O.type===n)return x}if(r){const x=s[g];if(x&&cn(x)&&x.type===n)return g}return null}(u,s,n,null==i?br(u)&&Ha:i!=s&&0!=(3&u.type),r&Ee.Host&&o===u);return null!==w?si(e,s,w,u):wn}function si(t,e,n,i){let r=t[n];const o=e.data;if(function y0(t){return t instanceof Er}(r)){const s=r;s.resolving&&function Cy(t,e){const n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new Ce(-200,`Circular dependency in DI detected for ${t}${n}`)}(Ue(o[n]));const u=Uo(s.canSeeViewProviders);s.resolving=!0;const g=s.injectImpl?Kt(s.injectImpl):null;Md(t,i,Ee.Default);try{r=t[n]=s.factory(void 0,o,t,i),e.firstCreatePass&&n>=i.directiveStart&&function _0(t,e,n){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:o}=e.type.prototype;if(i){const s=md(e);(n.preOrderHooks??(n.preOrderHooks=[])).push(t,s),(n.preOrderCheckHooks??(n.preOrderCheckHooks=[])).push(t,s)}r&&(n.preOrderHooks??(n.preOrderHooks=[])).push(0-t,r),o&&((n.preOrderHooks??(n.preOrderHooks=[])).push(t,o),(n.preOrderCheckHooks??(n.preOrderCheckHooks=[])).push(t,o))}(n,o[n],e)}finally{null!==g&&Kt(g),Uo(u),s.resolving=!1,Pd()}}return r}function Yd(t,e,n){return!!(n[e+(t>>Ud)]&1<<t)}function Xd(t,e){return!(t&Ee.Self||t&Ee.Host&&e)}class Ti{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,i){return zd(this._tNode,this._lView,e,Do(i),n)}}function x0(){return new Ti(mt(),oe())}function qd(t){const e=t[_e],n=e.type;return 2===n?e.declTNode:1===n?t[yt]:null}const Ai="__parameters__";function Oi(t,e,n){return Tn(()=>{const i=function Xa(t){return function(...n){if(t){const i=t(...n);for(const r in i)this[r]=i[r]}}}(e);function r(...o){if(this instanceof r)return i.apply(this,o),this;const s=new r(...o);return u.annotation=s,u;function u(g,v,w){const b=g.hasOwnProperty(Ai)?g[Ai]:Object.defineProperty(g,Ai,{value:[]})[Ai];for(;b.length<=w;)b.push(null);return(b[w]=b[w]||[]).push(s),g}}return n&&(r.prototype=Object.create(n.prototype)),r.prototype.ngMetadataName=t,r.annotationCls=r,r})}class Fe{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=Ke({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ai(t,e){t.forEach(n=>Array.isArray(n)?ai(n,e):e(n))}function Kd(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Wo(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}const $o=pr(Oi("Optional"),8),Yo=pr(Oi("SkipSelf"),4);var Pt=(()=>((Pt=Pt||{})[Pt.Important=1]="Important",Pt[Pt.DashCase=2]="DashCase",Pt))();const nl=new Map;let nC=0;const rl="__ngContext__";function wt(t,e){Vt(e)?(t[rl]=e[Sr],function rC(t){nl.set(t[Sr],t)}(e)):t[rl]=e}let ol;function sl(t,e){return ol(t,e)}function Fr(t){const e=t[rt];return ln(e)?e[rt]:e}function al(t){return vh(t[Cr])}function ll(t){return vh(t[an])}function vh(t){for(;null!==t&&!ln(t);)t=t[an];return t}function Pi(t,e,n,i,r){if(null!=i){let o,s=!1;ln(i)?o=i:Vt(i)&&(s=!0,i=i[Mn]);const u=pt(i);0===t&&null!==n?null==r?Dh(e,n,u):li(e,n,u,r||null,!0):1===t&&null!==n?li(e,n,u,r||null,!0):2===t?function pl(t,e,n){const i=Zo(t,e);i&&function DC(t,e,n,i){t.removeChild(e,n,i)}(t,i,e,n)}(e,u,s):3===t&&e.destroyNode(u),null!=o&&function TC(t,e,n,i,r){const o=n[Ao];o!==pt(n)&&Pi(e,t,i,o,r);for(let u=Et;u<n.length;u++){const g=n[u];Pr(g[_e],g,t,e,i,o)}}(e,t,o,n,r)}}function ul(t,e,n){return t.createElement(e,n)}function Ch(t,e){const n=t[bi],i=n.indexOf(e),r=e[rt];512&e[Ae]&&(e[Ae]&=-513,Ma(r,-1)),n.splice(i,1)}function dl(t,e){if(t.length<=Et)return;const n=Et+e,i=t[n];if(i){const r=i[wr];null!==r&&r!==t&&Ch(r,i),e>0&&(t[n-1][an]=i[an]);const o=Wo(t,Et+e);!function mC(t,e){Pr(t,e,e[Re],2,null,null),e[Mn]=null,e[yt]=null}(i[_e],i);const s=o[yn];null!==s&&s.detachView(o[_e]),i[rt]=null,i[an]=null,i[Ae]&=-65}return i}function wh(t,e){if(!(128&e[Ae])){const n=e[Re];n.destroyNode&&Pr(t,e,n,3,null,null),function yC(t){let e=t[Cr];if(!e)return hl(t[_e],t);for(;e;){let n=null;if(Vt(e))n=e[Cr];else{const i=e[Et];i&&(n=i)}if(!n){for(;e&&!e[an]&&e!==t;)Vt(e)&&hl(e[_e],e),e=e[rt];null===e&&(e=t),Vt(e)&&hl(e[_e],e),n=e&&e[an]}e=n}}(e)}}function hl(t,e){if(!(128&e[Ae])){e[Ae]&=-65,e[Ae]|=128,function bC(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let i=0;i<n.length;i+=2){const r=e[n[i]];if(!(r instanceof Er)){const o=n[i+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){const u=r[o[s]],g=o[s+1];Qt(4,u,g);try{g.call(u)}finally{Qt(5,u,g)}}else{Qt(4,r,o);try{o.call(r)}finally{Qt(5,r,o)}}}}}(t,e),function SC(t,e){const n=t.cleanup,i=e[Ci];let r=-1;if(null!==n)for(let o=0;o<n.length-1;o+=2)if("string"==typeof n[o]){const s=n[o+3];s>=0?i[r=s]():i[r=-s].unsubscribe(),o+=2}else{const s=i[r=n[o+1]];n[o].call(s)}if(null!==i){for(let o=r+1;o<i.length;o++)(0,i[o])();e[Ci]=null}}(t,e),1===e[_e].type&&e[Re].destroy();const n=e[wr];if(null!==n&&ln(e[rt])){n!==e[rt]&&Ch(n,e);const i=e[yn];null!==i&&i.detachView(t)}!function oC(t){nl.delete(t[Sr])}(e)}}function Sh(t,e,n){return function bh(t,e,n){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return n[Mn];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:o}=t.data[i.directiveStart+r];if(o===vn.None||o===vn.Emulated)return null}return Ut(i,n)}}(t,e.parent,n)}function li(t,e,n,i,r){t.insertBefore(e,n,i,r)}function Dh(t,e,n){t.appendChild(e,n)}function Eh(t,e,n,i,r){null!==i?li(t,e,n,i,r):Dh(t,e,n)}function Zo(t,e){return t.parentNode(e)}let fl,vl,xh=function Th(t,e,n){return 40&t.type?Ut(t,n):null};function Ko(t,e,n,i){const r=Sh(t,i,e),o=e[Re],u=function Ih(t,e,n){return xh(t,e,n)}(i.parent||e[yt],i,e);if(null!=r)if(Array.isArray(n))for(let g=0;g<n.length;g++)Eh(o,r,n[g],u,!1);else Eh(o,r,n,u,!1);void 0!==fl&&fl(o,i,e,n,r)}function Jo(t,e){if(null!==e){const n=e.type;if(3&n)return Ut(e,t);if(4&n)return gl(-1,t[e.index]);if(8&n){const i=e.child;if(null!==i)return Jo(t,i);{const r=t[e.index];return ln(r)?gl(-1,r):pt(r)}}if(32&n)return sl(e,t)()||pt(t[e.index]);{const i=Mh(t,e);return null!==i?Array.isArray(i)?i[0]:Jo(Fr(t[Ct]),i):Jo(t,e.next)}}return null}function Mh(t,e){return null!==e?t[Ct][yt].projection[e.projection]:null}function gl(t,e){const n=Et+t+1;if(n<e.length){const i=e[n],r=i[_e].firstChild;if(null!==r)return Jo(i,r)}return e[Ao]}function ml(t,e,n,i,r,o,s){for(;null!=n;){const u=i[n.index],g=n.type;if(s&&0===e&&(u&&wt(pt(u),i),n.flags|=2),32!=(32&n.flags))if(8&g)ml(t,e,n.child,i,r,o,!1),Pi(e,t,r,u,o);else if(32&g){const v=sl(n,i);let w;for(;w=v();)Pi(e,t,r,w,o);Pi(e,t,r,u,o)}else 16&g?Oh(t,e,i,n,r,o):Pi(e,t,r,u,o);n=s?n.projectionNext:n.next}}function Pr(t,e,n,i,r,o){ml(n,i,t.firstChild,e,r,o,!1)}function Oh(t,e,n,i,r,o){const s=n[Ct],g=s[yt].projection[i.projection];if(Array.isArray(g))for(let v=0;v<g.length;v++)Pi(e,t,r,g[v],o);else ml(t,e,g,s[rt],r,o,!0)}function Rh(t,e,n){""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n)}function Fh(t,e,n){const{mergedAttrs:i,classes:r,styles:o}=n;null!==i&&Ua(t,e,i),null!==r&&Rh(t,e,r),null!==o&&function AC(t,e,n){t.setAttribute(e,"style",n)}(t,e,o)}const Yh=new Fe("ENVIRONMENT_INITIALIZER"),Xh=new Fe("INJECTOR",-1),qh=new Fe("INJECTOR_DEF_TYPES");class Zh{get(e,n=fr){if(n===fr){const i=new Error(`NullInjectorError: No provider for ${$e(e)}!`);throw i.name="NullInjectorError",i}return n}}function iw(...t){return{\u0275providers:Kh(0,t),\u0275fromNgModule:!0}}function Kh(t,...e){const n=[],i=new Set;let r;return ai(e,o=>{const s=o;Dl(s,n,[],i)&&(r||(r=[]),r.push(s))}),void 0!==r&&Jh(r,n),n}function Jh(t,e){for(let n=0;n<t.length;n++){const{providers:r}=t[n];El(r,o=>{e.push(o)})}}function Dl(t,e,n,i){if(!(t=Se(t)))return!1;let r=null,o=nd(t);const s=!o&&Ge(t);if(o||s){if(s&&!s.standalone)return!1;r=t}else{const g=t.ngModule;if(o=nd(g),!o)return!1;r=g}const u=i.has(r);if(s){if(u)return!1;if(i.add(r),s.dependencies){const g="function"==typeof s.dependencies?s.dependencies():s.dependencies;for(const v of g)Dl(v,e,n,i)}}else{if(!o)return!1;{if(null!=o.imports&&!u){let v;i.add(r);try{ai(o.imports,w=>{Dl(w,e,n,i)&&(v||(v=[]),v.push(w))})}finally{}void 0!==v&&Jh(v,e)}if(!u){const v=ri(r)||(()=>new r);e.push({provide:r,useFactory:v,deps:Ve},{provide:qh,useValue:r,multi:!0},{provide:Yh,useValue:()=>je(r),multi:!0})}const g=o.providers;null==g||u||El(g,w=>{e.push(w)})}}return r!==t&&void 0!==t.providers}function El(t,e){for(let n of t)ya(n)&&(n=n.\u0275providers),Array.isArray(n)?El(n,e):e(n)}const rw=ze({provide:String,useValue:ze});function Il(t){return null!==t&&"object"==typeof t&&rw in t}function ci(t){return"function"==typeof t}const Tl=new Fe("Set Injector scope."),ns={},sw={};let xl;function is(){return void 0===xl&&(xl=new Zh),xl}class ki{}class tf extends ki{get destroyed(){return this._destroyed}constructor(e,n,i,r){super(),this.parent=n,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ml(e,s=>this.processProvider(s)),this.records.set(Xh,Ni(void 0,this)),r.has("environment")&&this.records.set(ki,Ni(void 0,this));const o=this.records.get(Tl);null!=o&&"string"==typeof o.value&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(qh.multi,Ve,Ee.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const n=yi(this),i=Kt(void 0);try{return e()}finally{yi(n),Kt(i)}}get(e,n=fr,i=Ee.Default){this.assertNotDestroyed(),i=Do(i);const r=yi(this),o=Kt(void 0);try{if(!(i&Ee.SkipSelf)){let u=this.records.get(e);if(void 0===u){const g=function dw(t){return"function"==typeof t||"object"==typeof t&&t instanceof Fe}(e)&&wo(e);u=g&&this.injectableDefInScope(g)?Ni(Al(e),ns):null,this.records.set(e,u)}if(null!=u)return this.hydrate(e,u)}return(i&Ee.Self?is():this.parent).get(e,n=i&Ee.Optional&&n===fr?null:n)}catch(s){if("NullInjectorError"===s.name){if((s[bo]=s[bo]||[]).unshift($e(e)),r)throw s;return function Py(t,e,n,i){const r=t[bo];throw e[od]&&r.unshift(e[od]),t.message=function Ly(t,e,n,i=null){t=t&&"\n"===t.charAt(0)&&t.charAt(1)==My?t.slice(2):t;let r=$e(e);if(Array.isArray(e))r=e.map($e).join(" -> ");else if("object"==typeof e){let o=[];for(let s in e)if(e.hasOwnProperty(s)){let u=e[s];o.push(s+":"+("string"==typeof u?JSON.stringify(u):$e(u)))}r=`{${o.join(", ")}}`}return`${n}${i?"("+i+")":""}[${r}]: ${t.replace(Ay,"\n  ")}`}("\n"+t.message,r,n,i),t[xy]=r,t[bo]=null,t}(s,e,"R3InjectorError",this.source)}throw s}finally{Kt(o),yi(r)}}resolveInjectorInitializers(){const e=yi(this),n=Kt(void 0);try{const i=this.get(Yh.multi,Ve,Ee.Self);for(const r of i)r()}finally{yi(e),Kt(n)}}toString(){const e=[],n=this.records;for(const i of n.keys())e.push($e(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Ce(205,!1)}processProvider(e){let n=ci(e=Se(e))?e:Se(e&&e.provide);const i=function lw(t){return Il(t)?Ni(void 0,t.useValue):Ni(function nf(t,e,n){let i;if(ci(t)){const r=Se(t);return ri(r)||Al(r)}if(Il(t))i=()=>Se(t.useValue);else if(function ef(t){return!(!t||!t.useFactory)}(t))i=()=>t.useFactory(...ba(t.deps||[]));else if(function Qh(t){return!(!t||!t.useExisting)}(t))i=()=>je(Se(t.useExisting));else{const r=Se(t&&(t.useClass||t.provide));if(!function cw(t){return!!t.deps}(t))return ri(r)||Al(r);i=()=>new r(...ba(t.deps))}return i}(t),ns)}(e);if(ci(e)||!0!==e.multi)this.records.get(n);else{let r=this.records.get(n);r||(r=Ni(void 0,ns,!0),r.factory=()=>ba(r.multi),this.records.set(n,r)),n=e,r.multi.push(e)}this.records.set(n,i)}hydrate(e,n){return n.value===ns&&(n.value=sw,n.value=n.factory()),"object"==typeof n.value&&n.value&&function uw(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;const n=Se(e.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function Al(t){const e=wo(t),n=null!==e?e.factory:ri(t);if(null!==n)return n;if(t instanceof Fe)throw new Ce(204,!1);if(t instanceof Function)return function aw(t){const e=t.length;if(e>0)throw function Ar(t,e){const n=[];for(let i=0;i<t;i++)n.push(e);return n}(e,"?"),new Ce(204,!1);const n=function Ey(t){return t&&(t[So]||t[id])||null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new Ce(204,!1)}function Ni(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function Ml(t,e){for(const n of t)Array.isArray(n)?Ml(n,e):n&&ya(n)?Ml(n.\u0275providers,e):e(n)}class hw{}class rf{}class gw{resolveComponentFactory(e){throw function fw(t){const e=Error(`No component factory found for ${$e(t)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=t,e}(e)}}let rs=(()=>{class t{}return t.NULL=new gw,t})();function pw(){return Bi(mt(),oe())}function Bi(t,e){return new ji(Ut(t,e))}let ji=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=pw,t})();class sf{}let af=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function _w(){const t=oe(),n=Ft(mt().index,t);return(Vt(n)?n:t)[Re]}(),t})(),vw=(()=>{class t{}return t.\u0275prov=Ke({token:t,providedIn:"root",factory:()=>null}),t})();class Ol{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const yw=new Ol("15.2.10"),Rl={},Fl="ngOriginalError";function Pl(t){return t[Fl]}class Vi{constructor(){this._console=console}handleError(e){const n=this._findOriginalError(e);this._console.error("ERROR",e),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&Pl(e);for(;n&&Pl(n);)n=Pl(n);return n||null}}function cf(t,e,n){let i=t.length;for(;;){const r=t.indexOf(e,n);if(-1===r)return r;if(0===r||t.charCodeAt(r-1)<=32){const o=e.length;if(r+o===i||t.charCodeAt(r+o)<=32)return r}n=r+1}}const uf="ng-template";function Mw(t,e,n){let i=0,r=!0;for(;i<t.length;){let o=t[i++];if("string"==typeof o&&r){const s=t[i++];if(n&&"class"===o&&-1!==cf(s.toLowerCase(),e,0))return!0}else{if(1===o){for(;i<t.length&&"string"==typeof(o=t[i++]);)if(o.toLowerCase()===e)return!0;return!1}"number"==typeof o&&(r=!1)}}return!1}function df(t){return 4===t.type&&t.value!==uf}function Ow(t,e,n){return e===(4!==t.type||n?t.value:uf)}function Rw(t,e,n){let i=4;const r=t.attrs||[],o=function Lw(t){for(let e=0;e<t.length;e++)if(kd(t[e]))return e;return t.length}(r);let s=!1;for(let u=0;u<e.length;u++){const g=e[u];if("number"!=typeof g){if(!s)if(4&i){if(i=2|1&i,""!==g&&!Ow(t,g,n)||""===g&&1===e.length){if(un(i))return!1;s=!0}}else{const v=8&i?g:e[++u];if(8&i&&null!==t.attrs){if(!Mw(t.attrs,v,n)){if(un(i))return!1;s=!0}continue}const b=Fw(8&i?"class":g,r,df(t),n);if(-1===b){if(un(i))return!1;s=!0;continue}if(""!==v){let I;I=b>o?"":r[b+1].toLowerCase();const x=8&i?I:null;if(x&&-1!==cf(x,v,0)||2&i&&v!==I){if(un(i))return!1;s=!0}}}}else{if(!s&&!un(i)&&!un(g))return!1;if(s&&un(g))continue;s=!1,i=g|1&i}}return un(i)||s}function un(t){return 0==(1&t)}function Fw(t,e,n,i){if(null===e)return-1;let r=0;if(i||!n){let o=!1;for(;r<e.length;){const s=e[r];if(s===t)return r;if(3===s||6===s)o=!0;else{if(1===s||2===s){let u=e[++r];for(;"string"==typeof u;)u=e[++r];continue}if(4===s)break;if(0===s){r+=4;continue}}r+=o?1:2}return-1}return function kw(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const i=t[n];if("number"==typeof i)return-1;if(i===e)return n;n++}return-1}(e,t)}function hf(t,e,n=!1){for(let i=0;i<e.length;i++)if(Rw(t,e[i],n))return!0;return!1}function ff(t,e){return t?":not("+e.trim()+")":e}function Bw(t){let e=t[0],n=1,i=2,r="",o=!1;for(;n<t.length;){let s=t[n];if("string"==typeof s)if(2&i){const u=t[++n];r+="["+s+(u.length>0?'="'+u+'"':"")+"]"}else 8&i?r+="."+s:4&i&&(r+=" "+s);else""!==r&&!un(s)&&(e+=ff(o,r),r=""),i=s,o=o||!un(i);n++}return""!==r&&(e+=ff(o,r)),e}const xe={};function Br(t){gf(Be(),oe(),Tt()+t,!1)}function gf(t,e,n,i){if(!i)if(3==(3&e[Ae])){const o=t.preOrderCheckHooks;null!==o&&No(e,o,n)}else{const o=t.preOrderHooks;null!==o&&Bo(e,o,0,n)}oi(n)}function vf(t,e=null,n=null,i){const r=yf(t,e,n,i);return r.resolveInjectorInitializers(),r}function yf(t,e=null,n=null,i,r=new Set){const o=[n||Ve,iw(t)];return i=i||("object"==typeof t?void 0:$e(t)),new tf(o,e||is(),i||null,r)}let ui=(()=>{class t{static create(n,i){if(Array.isArray(n))return vf({name:""},i,n,"");{const r=n.name??"";return vf({name:r},n.parent,n.providers,r)}}}return t.THROW_IF_NOT_FOUND=fr,t.NULL=new Zh,t.\u0275prov=Ke({token:t,providedIn:"any",factory:()=>je(Xh)}),t.__NG_ELEMENT_ID__=-1,t})();function Pe(t,e=Ee.Default){const n=oe();return null===n?je(t,e):zd(mt(),n,Se(t),e)}function If(t,e){const n=t.contentQueries;if(null!==n)for(let i=0;i<n.length;i+=2){const o=n[i+1];if(-1!==o){const s=t.data[o];La(n[i]),s.contentQueries(2,e[o],o)}}}function ss(t,e,n,i,r,o,s,u,g,v,w){const b=e.blueprint.slice();return b[Mn]=r,b[Ae]=76|i,(null!==w||t&&1024&t[Ae])&&(b[Ae]|=1024),Sd(b),b[rt]=b[wi]=t,b[st]=n,b[xo]=s||t&&t[xo],b[Re]=u||t&&t[Re],b[Ia]=g||t&&t[Ia]||null,b[To]=v||t&&t[To]||null,b[yt]=o,b[Sr]=function iC(){return nC++}(),b[hd]=w,b[Ct]=2==e.type?t[Ct]:b,b}function Gi(t,e,n,i,r){let o=t.data[e];if(null===o)o=function jl(t,e,n,i,r){const o=Ed(),s=Oa(),g=t.data[e]=function dS(t,e,n,i,r,o){return{type:n,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,n,e,i,r);return null===t.firstChild&&(t.firstChild=g),null!==o&&(s?null==o.child&&null!==g.parent&&(o.child=g):null===o.next&&(o.next=g,g.prev=o)),g}(t,e,n,i,r),function l0(){return Te.lFrame.inI18n}()&&(o.flags|=32);else if(64&o.type){o.type=n,o.value=i,o.attrs=r;const s=function Dr(){const t=Te.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();o.injectorIndex=null===s?-1:s.injectorIndex}return Cn(o,!0),o}function jr(t,e,n,i){if(0===n)return-1;const r=e.length;for(let o=0;o<n;o++)e.push(i),t.blueprint.push(i),t.data.push(null);return r}function Vl(t,e,n){ka(e);try{const i=t.viewQuery;null!==i&&ql(1,i,n);const r=t.template;null!==r&&Tf(t,e,r,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&If(t,e),t.staticViewQueries&&ql(2,t.viewQuery,n);const o=t.components;null!==o&&function lS(t,e){for(let n=0;n<e.length;n++)OS(t,e[n])}(e,o)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{e[Ae]&=-5,Na()}}function as(t,e,n,i){const r=e[Ae];if(128!=(128&r)){ka(e);try{Sd(e),function Td(t){return Te.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&Tf(t,e,n,2,i);const s=3==(3&r);if(s){const v=t.preOrderCheckHooks;null!==v&&No(e,v,null)}else{const v=t.preOrderHooks;null!==v&&Bo(e,v,0,null),ja(e,0)}if(function AS(t){for(let e=al(t);null!==e;e=ll(e)){if(!e[fd])continue;const n=e[bi];for(let i=0;i<n.length;i++){const r=n[i];512&r[Ae]||Ma(r[rt],1),r[Ae]|=512}}}(e),function xS(t){for(let e=al(t);null!==e;e=ll(e))for(let n=Et;n<e.length;n++){const i=e[n],r=i[_e];Po(i)&&as(r,i,r.template,i[st])}}(e),null!==t.contentQueries&&If(t,e),s){const v=t.contentCheckHooks;null!==v&&No(e,v)}else{const v=t.contentHooks;null!==v&&Bo(e,v,1),ja(e,1)}!function sS(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let i=0;i<n.length;i++){const r=n[i];if(r<0)oi(~r);else{const o=r,s=n[++i],u=n[++i];c0(s,o),u(2,e[o])}}}finally{oi(-1)}}(t,e);const u=t.components;null!==u&&function aS(t,e){for(let n=0;n<e.length;n++)MS(t,e[n])}(e,u);const g=t.viewQuery;if(null!==g&&ql(2,g,i),s){const v=t.viewCheckHooks;null!==v&&No(e,v)}else{const v=t.viewHooks;null!==v&&Bo(e,v,2),ja(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),e[Ae]&=-41,512&e[Ae]&&(e[Ae]&=-513,Ma(e[rt],-1))}finally{Na()}}}function Tf(t,e,n,i,r){const o=Tt(),s=2&i;try{oi(-1),s&&e.length>qe&&gf(t,e,qe,!1),Qt(s?2:0,r),n(i,r)}finally{oi(o),Qt(s?3:1,r)}}function Ul(t,e,n){if(xa(e)){const r=e.directiveEnd;for(let o=e.directiveStart;o<r;o++){const s=t.data[o];s.contentQueries&&s.contentQueries(1,n[o],o)}}}function Hl(t,e,n){Dd()&&(function vS(t,e,n,i){const r=n.directiveStart,o=n.directiveEnd;br(n)&&function ES(t,e,n){const i=Ut(e,t),r=xf(n),o=t[xo],s=ls(t,ss(t,r,null,n.onPush?32:16,i,e,o,o.createRenderer(i,n),null,null,null));t[e.index]=s}(e,n,t.data[r+n.componentOffset]),t.firstCreatePass||Ho(n,e),wt(i,e);const s=n.initialInputs;for(let u=r;u<o;u++){const g=t.data[u],v=si(e,t,u,n);wt(v,e),null!==s&&IS(0,u-r,v,g,0,s),cn(g)&&(Ft(n.index,e)[st]=si(e,t,u,n))}}(t,e,n,Ut(n,e)),64==(64&n.flags)&&Ff(t,e,n))}function Gl(t,e,n=Ut){const i=e.localNames;if(null!==i){let r=e.index+1;for(let o=0;o<i.length;o+=2){const s=i[o+1],u=-1===s?n(e,t):t[s];t[r++]=u}}}function xf(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=Wl(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function Wl(t,e,n,i,r,o,s,u,g,v){const w=qe+i,b=w+r,I=function cS(t,e){const n=[];for(let i=0;i<e;i++)n.push(i<t?null:xe);return n}(w,b),x="function"==typeof v?v():v;return I[_e]={type:t,blueprint:I,template:n,queries:null,viewQuery:u,declTNode:e,data:I.slice().fill(null,w),bindingStartIndex:w,expandoStartIndex:b,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:g,consts:x,incompleteFirstPass:!1}}function Mf(t,e,n,i){for(let r in t)if(t.hasOwnProperty(r)){n=null===n?{}:n;const o=t[r];null===i?Of(n,e,r,o):i.hasOwnProperty(r)&&Of(n,e,i[r],o)}return n}function Of(t,e,n,i){t.hasOwnProperty(n)?t[n].push(e,i):t[n]=[e,i]}function zl(t,e,n,i){if(Dd()){const r=null===i?null:{"":-1},o=function CS(t,e){const n=t.directiveRegistry;let i=null,r=null;if(n)for(let o=0;o<n.length;o++){const s=n[o];if(hf(e,s.selectors,!1))if(i||(i=[]),cn(s))if(null!==s.findHostDirectiveDefs){const u=[];r=r||new Map,s.findHostDirectiveDefs(s,u,r),i.unshift(...u,s),$l(t,e,u.length)}else i.unshift(s),$l(t,e,0);else r=r||new Map,s.findHostDirectiveDefs?.(s,i,r),i.push(s)}return null===i?null:[i,r]}(t,n);let s,u;null===o?s=u=null:[s,u]=o,null!==s&&Rf(t,e,n,s,r,u),r&&function wS(t,e,n){if(e){const i=t.localNames=[];for(let r=0;r<e.length;r+=2){const o=n[e[r+1]];if(null==o)throw new Ce(-301,!1);i.push(e[r],o)}}}(n,i,r)}n.mergedAttrs=Ir(n.mergedAttrs,n.attrs)}function Rf(t,e,n,i,r,o){for(let v=0;v<i.length;v++)za(Ho(n,e),t,i[v].type);!function bS(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}(n,t.data.length,i.length);for(let v=0;v<i.length;v++){const w=i[v];w.providersResolver&&w.providersResolver(w)}let s=!1,u=!1,g=jr(t,e,i.length,null);for(let v=0;v<i.length;v++){const w=i[v];n.mergedAttrs=Ir(n.mergedAttrs,w.hostAttrs),DS(t,n,e,g,w),SS(g,w,r),null!==w.contentQueries&&(n.flags|=4),(null!==w.hostBindings||null!==w.hostAttrs||0!==w.hostVars)&&(n.flags|=64);const b=w.type.prototype;!s&&(b.ngOnChanges||b.ngOnInit||b.ngDoCheck)&&((t.preOrderHooks??(t.preOrderHooks=[])).push(n.index),s=!0),!u&&(b.ngOnChanges||b.ngDoCheck)&&((t.preOrderCheckHooks??(t.preOrderCheckHooks=[])).push(n.index),u=!0),g++}!function hS(t,e,n){const r=e.directiveEnd,o=t.data,s=e.attrs,u=[];let g=null,v=null;for(let w=e.directiveStart;w<r;w++){const b=o[w],I=n?n.get(b):null,O=I?I.outputs:null;g=Mf(b.inputs,w,g,I?I.inputs:null),v=Mf(b.outputs,w,v,O);const R=null===g||null===s||df(e)?null:TS(g,w,s);u.push(R)}null!==g&&(g.hasOwnProperty("class")&&(e.flags|=8),g.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=u,e.inputs=g,e.outputs=v}(t,n,o)}function Ff(t,e,n){const i=n.directiveStart,r=n.directiveEnd,o=n.index,s=function u0(){return Te.lFrame.currentDirectiveIndex}();try{oi(o);for(let u=i;u<r;u++){const g=t.data[u],v=e[u];Fa(u),(null!==g.hostBindings||0!==g.hostVars||null!==g.hostAttrs)&&yS(g,v)}}finally{oi(-1),Fa(s)}}function yS(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function $l(t,e,n){e.componentOffset=n,(t.components??(t.components=[])).push(e.index)}function SS(t,e,n){if(n){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)n[e.exportAs[i]]=t;cn(e)&&(n[""]=t)}}function DS(t,e,n,i,r){t.data[i]=r;const o=r.factory||(r.factory=ri(r.type)),s=new Er(o,cn(r),Pe);t.blueprint[i]=s,n[i]=s,function mS(t,e,n,i,r){const o=r.hostBindings;if(o){let s=t.hostBindingOpCodes;null===s&&(s=t.hostBindingOpCodes=[]);const u=~e.index;(function _S(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(s)!=u&&s.push(u),s.push(n,i,o)}}(t,e,i,jr(t,n,r.hostVars,xe),r)}function IS(t,e,n,i,r,o){const s=o[e];if(null!==s){const u=i.setInput;for(let g=0;g<s.length;){const v=s[g++],w=s[g++],b=s[g++];null!==u?i.setInput(n,b,v,w):n[w]=b}}}function TS(t,e,n){let i=null,r=0;for(;r<n.length;){const o=n[r];if(0!==o)if(5!==o){if("number"==typeof o)break;if(t.hasOwnProperty(o)){null===i&&(i=[]);const s=t[o];for(let u=0;u<s.length;u+=2)if(s[u]===e){i.push(o,s[u+1],n[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function Pf(t,e,n,i){return[t,!0,!1,e,null,0,i,n,null,null]}function MS(t,e){const n=Ft(e,t);if(Po(n)){const i=n[_e];48&n[Ae]?as(i,n,i.template,n[st]):n[ii]>0&&Xl(n)}}function Xl(t){for(let i=al(t);null!==i;i=ll(i))for(let r=Et;r<i.length;r++){const o=i[r];if(Po(o))if(512&o[Ae]){const s=o[_e];as(s,o,s.template,o[st])}else o[ii]>0&&Xl(o)}const n=t[_e].components;if(null!==n)for(let i=0;i<n.length;i++){const r=Ft(n[i],t);Po(r)&&r[ii]>0&&Xl(r)}}function OS(t,e){const n=Ft(e,t),i=n[_e];(function RS(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])})(i,n),Vl(i,n,n[st])}function ls(t,e){return t[Cr]?t[dd][an]=e:t[Cr]=e,t[dd]=e,e}function cs(t){for(;t;){t[Ae]|=32;const e=Fr(t);if(Uy(t)&&!e)return t;t=e}return null}function us(t,e,n,i=!0){const r=e[xo];r.begin&&r.begin();try{as(t,e,t.template,n)}catch(s){throw i&&Bf(e,s),s}finally{r.end&&r.end()}}function ql(t,e,n){La(0),e(t,n)}function Lf(t){return t[Ci]||(t[Ci]=[])}function kf(t){return t.cleanup||(t.cleanup=[])}function Bf(t,e){const n=t[To],i=n?n.get(Vi,null):null;i&&i.handleError(e)}function Zl(t,e,n,i,r){for(let o=0;o<n.length;){const s=n[o++],u=n[o++],g=e[s],v=t.data[s];null!==v.setInput?v.setInput(g,r,i,u):g[u]=r}}function ds(t,e,n){let i=n?t.styles:null,r=n?t.classes:null,o=0;if(null!==e)for(let s=0;s<e.length;s++){const u=e[s];"number"==typeof u?o=u:1==o?r=ma(r,u):2==o&&(i=ma(i,u+": "+e[++s]+";"))}n?t.styles=i:t.stylesWithoutHost=i,n?t.classes=r:t.classesWithoutHost=r}function hs(t,e,n,i,r=!1){for(;null!==n;){const o=e[n.index];if(null!==o&&i.push(pt(o)),ln(o))for(let u=Et;u<o.length;u++){const g=o[u],v=g[_e].firstChild;null!==v&&hs(g[_e],g,v,i)}const s=n.type;if(8&s)hs(t,e,n.child,i);else if(32&s){const u=sl(n,e);let g;for(;g=u();)i.push(g)}else if(16&s){const u=Mh(e,n);if(Array.isArray(u))i.push(...u);else{const g=Fr(e[Ct]);hs(g[_e],g,u,i,!0)}}n=r?n.projectionNext:n.next}return i}class Vr{get rootNodes(){const e=this._lView,n=e[_e];return hs(n,e,n.firstChild,[])}constructor(e,n){this._lView=e,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[st]}set context(e){this._lView[st]=e}get destroyed(){return 128==(128&this._lView[Ae])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[rt];if(ln(e)){const n=e[Mo],i=n?n.indexOf(this):-1;i>-1&&(dl(e,i),Wo(n,i))}this._attachedToViewContainer=!1}wh(this._lView[_e],this._lView)}onDestroy(e){!function Af(t,e,n,i){const r=Lf(e);null===n?r.push(i):(r.push(n),t.firstCreatePass&&kf(t).push(i,r.length-1))}(this._lView[_e],this._lView,null,e)}markForCheck(){cs(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ae]&=-65}reattach(){this._lView[Ae]|=64}detectChanges(){us(this._lView[_e],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ce(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function vC(t,e){Pr(t,e,e[Re],2,null,null)}(this._lView[_e],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new Ce(902,!1);this._appRef=e}}class FS extends Vr{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;us(e[_e],e,e[st],!1)}checkNoChanges(){}get context(){return null}}class jf extends rs{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const n=Ge(e);return new Ur(n,this.ngModule)}}function Vf(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}class LS{constructor(e,n){this.injector=e,this.parentInjector=n}get(e,n,i){i=Do(i);const r=this.injector.get(e,Rl,i);return r!==Rl||n===Rl?r:this.parentInjector.get(e,n,i)}}class Ur extends rf{get inputs(){return Vf(this.componentDef.inputs)}get outputs(){return Vf(this.componentDef.outputs)}constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=function jw(t){return t.map(Bw).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}create(e,n,i,r){let o=(r=r||this.ngModule)instanceof ki?r:r?.injector;o&&null!==this.componentDef.getStandaloneInjector&&(o=this.componentDef.getStandaloneInjector(o)||o);const s=o?new LS(e,o):e,u=s.get(sf,null);if(null===u)throw new Ce(407,!1);const g=s.get(vw,null),v=u.createRenderer(null,this.componentDef),w=this.componentDef.selectors[0][0]||"div",b=i?function uS(t,e,n){return t.selectRootElement(e,n===vn.ShadowDom)}(v,i,this.componentDef.encapsulation):ul(v,w,function PS(t){const e=t.toLowerCase();return"svg"===e?yd:"math"===e?"math":null}(w)),I=this.componentDef.onPush?288:272,x=Wl(0,null,null,1,0,null,null,null,null,null),O=ss(null,x,null,I,null,null,u,v,g,s,null);let R,P;ka(O);try{const V=this.componentDef;let W,L=null;V.findHostDirectiveDefs?(W=[],L=new Map,V.findHostDirectiveDefs(V,W,L),W.push(V)):W=[V];const X=function NS(t,e){const n=t[_e],i=qe;return t[i]=e,Gi(n,i,2,"#host",null)}(O,b),ee=function BS(t,e,n,i,r,o,s,u){const g=r[_e];!function jS(t,e,n,i){for(const r of t)e.mergedAttrs=Ir(e.mergedAttrs,r.hostAttrs);null!==e.mergedAttrs&&(ds(e,e.mergedAttrs,!0),null!==n&&Fh(i,n,e))}(i,t,e,s);const v=o.createRenderer(e,n),w=ss(r,xf(n),null,n.onPush?32:16,r[t.index],t,o,v,u||null,null,null);return g.firstCreatePass&&$l(g,t,i.length-1),ls(r,w),r[t.index]=w}(X,b,V,W,O,u,v);P=wd(x,qe),b&&function US(t,e,n,i){if(i)Ua(t,n,["ng-version",yw.full]);else{const{attrs:r,classes:o}=function Vw(t){const e=[],n=[];let i=1,r=2;for(;i<t.length;){let o=t[i];if("string"==typeof o)2===r?""!==o&&e.push(o,t[++i]):8===r&&n.push(o);else{if(!un(r))break;r=o}i++}return{attrs:e,classes:n}}(e.selectors[0]);r&&Ua(t,n,r),o&&o.length>0&&Rh(t,n,o.join(" "))}}(v,V,b,i),void 0!==n&&function HS(t,e,n){const i=t.projection=[];for(let r=0;r<e.length;r++){const o=n[r];i.push(null!=o?Array.from(o):null)}}(P,this.ngContentSelectors,n),R=function VS(t,e,n,i,r,o){const s=mt(),u=r[_e],g=Ut(s,r);Rf(u,r,s,n,null,i);for(let w=0;w<n.length;w++)wt(si(r,u,s.directiveStart+w,s),r);Ff(u,r,s),g&&wt(g,r);const v=si(r,u,s.directiveStart+s.componentOffset,s);if(t[st]=r[st]=v,null!==o)for(const w of o)w(v,e);return Ul(u,s,t),v}(ee,V,W,L,O,[GS]),Vl(x,O,null)}finally{Na()}return new kS(this.componentType,R,Bi(P,O),O,P)}}class kS extends hw{constructor(e,n,i,r,o){super(),this.location=i,this._rootLView=r,this._tNode=o,this.instance=n,this.hostView=this.changeDetectorRef=new FS(r),this.componentType=e}setInput(e,n){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){const o=this._rootLView;Zl(o[_e],o,r,e,n),cs(Ft(this._tNode.index,o))}}get injector(){return new Ti(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function GS(){const t=mt();ko(oe()[_e],t)}function Jl(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function St(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function Ql(t,e,n,i,r,o,s,u){const g=oe(),v=Be(),w=t+qe,b=v.firstCreatePass?function ib(t,e,n,i,r,o,s,u,g){const v=e.consts,w=Gi(e,t,4,s||null,qn(v,u));zl(e,n,w,qn(v,g)),ko(e,w);const b=w.tView=Wl(2,w,i,r,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,v);return null!==e.queries&&(e.queries.template(e,w),b.queries=e.queries.embeddedTView(w)),w}(w,v,g,e,n,i,r,o,s):v.data[w];Cn(b,!1);const I=g[Re].createComment("");Ko(v,g,I,b),wt(I,g),ls(g,g[w]=Pf(I,g,I,b)),Oo(b)&&Hl(v,g,b),null!=s&&Gl(g,b,u)}function Qi(t,e,n){const i=oe();return St(i,function Ei(){return Te.lFrame.bindingIndex++}(),e)&&function Gt(t,e,n,i,r,o,s,u){const g=Ut(e,n);let w,v=e.inputs;!u&&null!=v&&(w=v[i])?(Zl(t,n,w,i,r),br(e)&&function gS(t,e){const n=Ft(e,t);16&n[Ae]||(n[Ae]|=32)}(n,e.index)):3&e.type&&(i=function fS(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(i),r=null!=s?s(r,e.value||"",i):r,o.setProperty(g,i,r))}(Be(),function tt(){const t=Te.lFrame;return wd(t.tView,t.selectedIndex)}(),i,t,e,i[Re],n,!1),Qi}function ec(t,e,n,i,r){const s=r?"class":"style";Zl(t,n,e.inputs[s],s,i)}function _t(t,e,n,i){const r=oe(),o=Be(),s=qe+t,u=r[Re],g=o.firstCreatePass?function sb(t,e,n,i,r,o){const s=e.consts,g=Gi(e,t,2,i,qn(s,r));return zl(e,n,g,qn(s,o)),null!==g.attrs&&ds(g,g.attrs,!1),null!==g.mergedAttrs&&ds(g,g.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,g),g}(s,o,r,e,n,i):o.data[s],v=r[s]=ul(u,e,function m0(){return Te.lFrame.currentNamespace}()),w=Oo(g);return Cn(g,!0),Fh(u,v,g),32!=(32&g.flags)&&Ko(o,r,v,g),0===function Qy(){return Te.lFrame.elementDepthCount}()&&wt(v,r),function e0(){Te.lFrame.elementDepthCount++}(),w&&(Hl(o,r,g),Ul(o,g,r)),null!==i&&Gl(r,g),_t}function kt(){let t=mt();Oa()?function Ra(){Te.lFrame.isParent=!1}():(t=t.parent,Cn(t,!1));const e=t;!function t0(){Te.lFrame.elementDepthCount--}();const n=Be();return n.firstCreatePass&&(ko(n,t),xa(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function C0(t){return 0!=(8&t.flags)}(e)&&ec(n,e,oe(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function w0(t){return 0!=(16&t.flags)}(e)&&ec(n,e,oe(),e.stylesWithoutHost,!1),kt}function Wt(t,e,n,i){return _t(t,e,n,i),kt(),Wt}function ic(t){return!!t&&"function"==typeof t.then}const cb=function ig(t){return!!t&&"function"==typeof t.subscribe};function Gr(t,e,n,i){const r=oe(),o=Be(),s=mt();return function og(t,e,n,i,r,o,s){const u=Oo(i),v=t.firstCreatePass&&kf(t),w=e[st],b=Lf(e);let I=!0;if(3&i.type||s){const R=Ut(i,e),P=s?s(R):R,V=b.length,W=s?X=>s(pt(X[i.index])):i.index;let L=null;if(!s&&u&&(L=function ub(t,e,n,i){const r=t.cleanup;if(null!=r)for(let o=0;o<r.length-1;o+=2){const s=r[o];if(s===n&&r[o+1]===i){const u=e[Ci],g=r[o+2];return u.length>g?u[g]:null}"string"==typeof s&&(o+=2)}return null}(t,e,r,i.index)),null!==L)(L.__ngLastListenerFn__||L).__ngNextListenerFn__=o,L.__ngLastListenerFn__=o,I=!1;else{o=ag(i,e,w,o,!1);const X=n.listen(P,r,o);b.push(o,X),v&&v.push(r,W,V,V+1)}}else o=ag(i,e,w,o,!1);const x=i.outputs;let O;if(I&&null!==x&&(O=x[r])){const R=O.length;if(R)for(let P=0;P<R;P+=2){const ee=e[O[P]][O[P+1]].subscribe(o),le=b.length;b.push(o,ee),v&&v.push(r,i.index,le,-(le+1))}}}(o,r,r[Re],s,t,e,i),Gr}function sg(t,e,n,i){try{return Qt(6,e,n),!1!==n(i)}catch(r){return Bf(t,r),!1}finally{Qt(7,e,n)}}function ag(t,e,n,i,r){return function o(s){if(s===Function)return i;cs(t.componentOffset>-1?Ft(t.index,e):e);let g=sg(e,n,i,s),v=o.__ngNextListenerFn__;for(;v;)g=sg(e,n,v,s)&&g,v=v.__ngNextListenerFn__;return r&&!1===g&&(s.preventDefault(),s.returnValue=!1),g}}function _s(t,e=""){const n=oe(),i=Be(),r=t+qe,o=i.firstCreatePass?Gi(i,r,1,e,null):i.data[r],s=n[r]=function cl(t,e){return t.createText(e)}(n[Re],e);Ko(i,n,s,o),Cn(o,!1)}const nr="en-US";let ep=nr;class ir{}class nE{}class Ip extends ir{constructor(e,n){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new jf(this);const i=function jt(t,e){const n=t[ad]||null;if(!n&&!0===e)throw new Error(`Type ${$e(t)} does not have '\u0275mod' property.`);return n}(e);this._bootstrapComponents=function Pn(t){return t instanceof Function?t():t}(i.bootstrap),this._r3Injector=yf(e,n,[{provide:ir,useValue:this},{provide:rs,useValue:this.componentFactoryResolver}],$e(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class mc extends nE{constructor(e){super(),this.moduleType=e}create(e){return new Ip(this.moduleType,e)}}function vc(t,e,n,i){return function Pp(t,e,n,i,r,o){const s=e+n;return St(t,s,r)?function bn(t,e,n){return t[e]=n}(t,s+1,o?i.call(o,r):i(r)):function Zr(t,e){const n=t[e];return n===xe?void 0:n}(t,s+1)}(oe(),function It(){const t=Te.lFrame;let e=t.bindingRootIndex;return-1===e&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}(),t,e,n,i)}function yc(t){return e=>{setTimeout(t,void 0,e)}}const kn=class OE extends la{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,i){let r=e,o=n||(()=>null),s=i;if(e&&"object"==typeof e){const g=e;r=g.next?.bind(g),o=g.error?.bind(g),s=g.complete?.bind(g)}this.__isAsync&&(o=yc(o),r&&(r=yc(r)),s&&(s=yc(s)));const u=super.subscribe({next:r,error:o,complete:s});return e instanceof mn&&e.add(u),u}};let Nn=(()=>{class t{}return t.__NG_ELEMENT_ID__=LE,t})();const FE=Nn,PE=class extends FE{constructor(e,n,i){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=i}createEmbeddedView(e,n){const i=this._declarationTContainer.tView,r=ss(this._declarationLView,i,e,16,null,i.declTNode,null,null,null,null,n||null);r[wr]=this._declarationLView[this._declarationTContainer.index];const s=this._declarationLView[yn];return null!==s&&(r[yn]=s.createEmbeddedView(i)),Vl(i,r,e),new Vr(r)}};function LE(){return function Ss(t,e){return 4&t.type?new PE(e,t,Bi(t,e)):null}(mt(),oe())}let In=(()=>{class t{}return t.__NG_ELEMENT_ID__=kE,t})();function kE(){return function Up(t,e){let n;const i=e[t.index];if(ln(i))n=i;else{let r;if(8&t.type)r=pt(i);else{const o=e[Re];r=o.createComment("");const s=Ut(t,e);li(o,Zo(o,s),r,function EC(t,e){return t.nextSibling(e)}(o,s),!1)}e[t.index]=n=Pf(i,e,r,t),ls(e,n)}return new jp(n,t,e)}(mt(),oe())}const NE=In,jp=class extends NE{constructor(e,n,i){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=i}get element(){return Bi(this._hostTNode,this._hostLView)}get injector(){return new Ti(this._hostTNode,this._hostLView)}get parentInjector(){const e=Wa(this._hostTNode,this._hostLView);if(jd(e)){const n=Vo(e,this._hostLView),i=jo(e);return new Ti(n[_e].data[i+8],n)}return new Ti(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const n=Vp(this._lContainer);return null!==n&&n[e]||null}get length(){return this._lContainer.length-Et}createEmbeddedView(e,n,i){let r,o;"number"==typeof i?r=i:null!=i&&(r=i.index,o=i.injector);const s=e.createEmbeddedView(n||{},o);return this.insert(s,r),s}createComponent(e,n,i,r,o){const s=e&&!function xr(t){return"function"==typeof t}(e);let u;if(s)u=n;else{const b=n||{};u=b.index,i=b.injector,r=b.projectableNodes,o=b.environmentInjector||b.ngModuleRef}const g=s?e:new Ur(Ge(e)),v=i||this.parentInjector;if(!o&&null==g.ngModule){const I=(s?v:this.parentInjector).get(ki,null);I&&(o=I)}const w=g.create(v,r,void 0,o);return this.insert(w.hostView,u),w}insert(e,n){const i=e._lView,r=i[_e];if(function Jy(t){return ln(t[rt])}(i)){const w=this.indexOf(e);if(-1!==w)this.detach(w);else{const b=i[rt],I=new jp(b,b[yt],b[rt]);I.detach(I.indexOf(e))}}const o=this._adjustIndex(n),s=this._lContainer;!function CC(t,e,n,i){const r=Et+i,o=n.length;i>0&&(n[r-1][an]=e),i<o-Et?(e[an]=n[r],Kd(n,Et+i,e)):(n.push(e),e[an]=null),e[rt]=n;const s=e[wr];null!==s&&n!==s&&function wC(t,e){const n=t[bi];e[Ct]!==e[rt][rt][Ct]&&(t[fd]=!0),null===n?t[bi]=[e]:n.push(e)}(s,e);const u=e[yn];null!==u&&u.insertView(t),e[Ae]|=64}(r,i,s,o);const u=gl(o,s),g=i[Re],v=Zo(g,s[Ao]);return null!==v&&function _C(t,e,n,i,r,o){i[Mn]=r,i[yt]=e,Pr(t,i,n,1,r,o)}(r,s[yt],g,i,v,u),e.attachToViewContainerRef(),Kd(wc(s),o,e),e}move(e,n){return this.insert(e,n)}indexOf(e){const n=Vp(this._lContainer);return null!==n?n.indexOf(e):-1}remove(e){const n=this._adjustIndex(e,-1),i=dl(this._lContainer,n);i&&(Wo(wc(this._lContainer),n),wh(i[_e],i))}detach(e){const n=this._adjustIndex(e,-1),i=dl(this._lContainer,n);return i&&null!=Wo(wc(this._lContainer),n)?new Vr(i):null}_adjustIndex(e,n=0){return e??this.length+n}};function Vp(t){return t[Mo]}function wc(t){return t[Mo]||(t[Mo]=[])}function Ds(...t){}const dm=new Fe("Application Initializer");let Es=(()=>{class t{constructor(n){this.appInits=n,this.resolve=Ds,this.reject=Ds,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const n=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const o=this.appInits[r]();if(ic(o))n.push(o);else if(cb(o)){const s=new Promise((u,g)=>{o.subscribe({complete:u,error:g})});n.push(s)}}Promise.all(n).then(()=>{i()}).catch(r=>{this.reject(r)}),0===n.length&&i(),this.initialized=!0}}return t.\u0275fac=function(n){return new(n||t)(je(dm,8))},t.\u0275prov=Ke({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Qr=new Fe("AppId",{providedIn:"root",factory:function hm(){return`${Oc()}${Oc()}${Oc()}`}});function Oc(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const fm=new Fe("Platform Initializer"),gm=new Fe("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Bn=new Fe("LocaleId",{providedIn:"root",factory:()=>function Ry(t,e=Ee.Default){return je(t,Do(e))}(Bn,Ee.Optional|Ee.SkipSelf)||function gI(){return typeof $localize<"u"&&$localize.locale||nr}()}),yI=(()=>Promise.resolve(0))();function Rc(t){typeof Zone>"u"?yI.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class bt{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new kn(!1),this.onMicrotaskEmpty=new kn(!1),this.onStable=new kn(!1),this.onError=new kn(!1),typeof Zone>"u")throw new Ce(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&n,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function CI(){let t=Xe.requestAnimationFrame,e=Xe.cancelAnimationFrame;if(typeof Zone<"u"&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function bI(t){const e=()=>{!function SI(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Xe,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Pc(t),t.isCheckStableRunning=!0,Fc(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Pc(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,r,o,s,u)=>{try{return _m(t),n.invokeTask(r,o,s,u)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||t.shouldCoalesceRunChangeDetection)&&e(),vm(t)}},onInvoke:(n,i,r,o,s,u,g)=>{try{return _m(t),n.invoke(r,o,s,u,g)}finally{t.shouldCoalesceRunChangeDetection&&e(),vm(t)}},onHasTask:(n,i,r,o)=>{n.hasTask(r,o),i===r&&("microTask"==o.change?(t._hasPendingMicrotasks=o.microTask,Pc(t),Fc(t)):"macroTask"==o.change&&(t.hasPendingMacrotasks=o.macroTask))},onHandleError:(n,i,r,o)=>(n.handleError(r,o),t.runOutsideAngular(()=>t.onError.emit(o)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!bt.isInAngularZone())throw new Ce(909,!1)}static assertNotInAngularZone(){if(bt.isInAngularZone())throw new Ce(909,!1)}run(e,n,i){return this._inner.run(e,n,i)}runTask(e,n,i,r){const o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+r,e,wI,Ds,Ds);try{return o.runTask(s,n,i)}finally{o.cancelTask(s)}}runGuarded(e,n,i){return this._inner.runGuarded(e,n,i)}runOutsideAngular(e){return this._outer.run(e)}}const wI={};function Fc(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Pc(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function _m(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function vm(t){t._nesting--,Fc(t)}class DI{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new kn,this.onMicrotaskEmpty=new kn,this.onStable=new kn,this.onError=new kn}run(e,n,i){return e.apply(n,i)}runGuarded(e,n,i){return e.apply(n,i)}runOutsideAngular(e){return e()}runTask(e,n,i,r){return e.apply(n,i)}}const ym=new Fe(""),Is=new Fe("");let Nc,Lc=(()=>{class t{constructor(n,i,r){this._ngZone=n,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Nc||(function EI(t){Nc=t}(r),r.addToWindow(i)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{bt.assertNotInAngularZone(),Rc(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Rc(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(n)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,i,r){let o=-1;i&&i>0&&(o=setTimeout(()=>{this._callbacks=this._callbacks.filter(s=>s.timeoutId!==o),n(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:n,timeoutId:o,updateCb:r})}whenStable(n,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,i,r){return[]}}return t.\u0275fac=function(n){return new(n||t)(je(bt),je(kc),je(Is))},t.\u0275prov=Ke({token:t,factory:t.\u0275fac}),t})(),kc=(()=>{class t{constructor(){this._applications=new Map}registerApplication(n,i){this._applications.set(n,i)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,i=!0){return Nc?.findTestabilityInTree(this,n,i)??null}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ke({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const jn=!1;let Jn=null;const Cm=new Fe("AllowMultipleToken"),Bc=new Fe("PlatformDestroyListeners"),II=new Fe("appBootstrapListener");function Sm(t,e,n=[]){const i=`Platform: ${e}`,r=new Fe(i);return(o=[])=>{let s=jc();if(!s||s.injector.get(Cm,!1)){const u=[...n,...o,{provide:r,useValue:!0}];t?t(u):function AI(t){if(Jn&&!Jn.get(Cm,!1))throw new Ce(400,!1);Jn=t;const e=t.get(Dm);(function wm(t){const e=t.get(fm,null);e&&e.forEach(n=>n())})(t)}(function bm(t=[],e){return ui.create({name:e,providers:[{provide:Tl,useValue:"platform"},{provide:Bc,useValue:new Set([()=>Jn=null])},...t]})}(u,i))}return function OI(t){const e=jc();if(!e)throw new Ce(401,!1);return e}()}}function jc(){return Jn?.get(Dm)??null}let Dm=(()=>{class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,i){const r=function Im(t,e){let n;return n="noop"===t?new DI:("zone.js"===t?void 0:t)||new bt(e),n}(i?.ngZone,function Em(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!t||!t.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!t||!t.ngZoneRunCoalescing)||!1}}(i)),o=[{provide:bt,useValue:r}];return r.run(()=>{const s=ui.create({providers:o,parent:this.injector,name:n.moduleType.name}),u=n.create(s),g=u.injector.get(Vi,null);if(!g)throw new Ce(402,!1);return r.runOutsideAngular(()=>{const v=r.onError.subscribe({next:w=>{g.handleError(w)}});u.onDestroy(()=>{Ts(this._modules,u),v.unsubscribe()})}),function Tm(t,e,n){try{const i=n();return ic(i)?i.catch(r=>{throw e.runOutsideAngular(()=>t.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>t.handleError(i)),i}}(g,r,()=>{const v=u.injector.get(Es);return v.runInitializers(),v.donePromise.then(()=>(function tp(t){Zt(t,"Expected localeId to be defined"),"string"==typeof t&&(ep=t.toLowerCase().replace(/_/g,"-"))}(u.injector.get(Bn,nr)||nr),this._moduleDoBootstrap(u),u))})})}bootstrapModule(n,i=[]){const r=xm({},i);return function TI(t,e,n){const i=new mc(n);return Promise.resolve(i)}(0,0,n).then(o=>this.bootstrapModuleFactory(o,r))}_moduleDoBootstrap(n){const i=n.injector.get(Vc);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!n.instance.ngDoBootstrap)throw new Ce(-403,!1);n.instance.ngDoBootstrap(i)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Ce(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const n=this._injector.get(Bc,null);n&&(n.forEach(i=>i()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(n){return new(n||t)(je(ui))},t.\u0275prov=Ke({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();function xm(t,e){return Array.isArray(e)?e.reduce(xm,t):{...t,...e}}let Vc=(()=>{class t{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(n,i,r){this._zone=n,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const o=new Mt(u=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{u.next(this._stable),u.complete()})}),s=new Mt(u=>{let g;this._zone.runOutsideAngular(()=>{g=this._zone.onStable.subscribe(()=>{bt.assertNotInAngularZone(),Rc(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,u.next(!0))})})});const v=this._zone.onUnstable.subscribe(()=>{bt.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{u.next(!1)}))});return()=>{g.unsubscribe(),v.unsubscribe()}});this.isStable=_y(o,s.pipe(function vy(t={}){const{connector:e=(()=>new la),resetOnError:n=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=t;return o=>{let s,u,g,v=0,w=!1,b=!1;const I=()=>{u?.unsubscribe(),u=void 0},x=()=>{I(),s=g=void 0,w=b=!1},O=()=>{const R=s;x(),R?.unsubscribe()};return hr((R,P)=>{v++,!b&&!w&&I();const V=g=g??e();P.add(()=>{v--,0===v&&!b&&!w&&(u=ga(O,r))}),V.subscribe(P),!s&&v>0&&(s=new dr({next:W=>V.next(W),error:W=>{b=!0,I(),u=ga(x,n,W),V.error(W)},complete:()=>{w=!0,I(),u=ga(x,i),V.complete()}}),$n(R).subscribe(s))})(o)}}()))}bootstrap(n,i){const r=n instanceof rf;if(!this._injector.get(Es).done){!r&&function yr(t){const e=Ge(t)||vt(t)||Rt(t);return null!==e&&e.standalone}(n);throw new Ce(405,jn)}let s;s=r?n:this._injector.get(rs).resolveComponentFactory(n),this.componentTypes.push(s.componentType);const u=function xI(t){return t.isBoundToModule}(s)?void 0:this._injector.get(ir),v=s.create(ui.NULL,[],i||s.selector,u),w=v.location.nativeElement,b=v.injector.get(ym,null);return b?.registerApplication(w),v.onDestroy(()=>{this.detachView(v.hostView),Ts(this.components,v),b?.unregisterApplication(w)}),this._loadComponent(v),v}tick(){if(this._runningTick)throw new Ce(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const i=n;this._views.push(i),i.attachToAppRef(this)}detachView(n){const i=n;Ts(this._views,i),i.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const i=this._injector.get(II,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>Ts(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Ce(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return t.\u0275fac=function(n){return new(n||t)(je(bt),je(ki),je(Vi))},t.\u0275prov=Ke({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Ts(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class km{constructor(){}supports(e){return e instanceof Map||Jl(e)}create(){return new WI}}class WI{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(e){let n;for(n=this._mapHead;null!==n;n=n._next)e(n)}forEachPreviousItem(e){let n;for(n=this._previousMapHead;null!==n;n=n._nextPrevious)e(n)}forEachChangedItem(e){let n;for(n=this._changesHead;null!==n;n=n._nextChanged)e(n)}forEachAddedItem(e){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)e(n)}forEachRemovedItem(e){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)e(n)}diff(e){if(e){if(!(e instanceof Map||Jl(e)))throw new Ce(900,!1)}else e=new Map;return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(e,(i,r)=>{if(n&&n.key===r)this._maybeAddToChanges(n,i),this._appendAfter=n,n=n._next;else{const o=this._getOrCreateRecordForKey(r,i);n=this._insertBeforeOrAppend(n,o)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let i=n;null!==i;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,n){if(e){const i=e._prev;return n._next=e,n._prev=i,e._prev=n,i&&(i._next=n),e===this._mapHead&&(this._mapHead=n),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(e,n){if(this._records.has(e)){const r=this._records.get(e);this._maybeAddToChanges(r,n);const o=r._prev,s=r._next;return o&&(o._next=s),s&&(s._prev=o),r._next=null,r._prev=null,r}const i=new zI(e);return this._records.set(e,i),i.currentValue=n,this._addToAdditions(i),i}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,n){Object.is(n,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=n,this._addToChanges(e))}_addToAdditions(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,n){e instanceof Map?e.forEach(n):Object.keys(e).forEach(i=>n(e[i],i))}}class zI{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function Bm(){return new eo([new km])}let eo=(()=>{class t{constructor(n){this.factories=n}static create(n,i){if(i){const r=i.factories.slice();n=n.concat(r)}return new t(n)}static extend(n){return{provide:t,useFactory:i=>t.create(n,i||Bm()),deps:[[t,new Yo,new $o]]}}find(n){const i=this.factories.find(r=>r.supports(n));if(i)return i;throw new Ce(901,!1)}}return t.\u0275prov=Ke({token:t,providedIn:"root",factory:Bm}),t})();const XI=Sm(null,"core",[]);let qI=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(je(Vc))},t.\u0275mod=vr({type:t}),t.\u0275inj=vi({}),t})(),zc=null;function Os(){return zc}class JI{}const Vn=new Fe("DocumentToken");let Jm=(()=>{class t{constructor(n,i){this._viewContainer=n,this._context=new GT,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){Qm("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){Qm("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,i){return!0}}return t.\u0275fac=function(n){return new(n||t)(Pe(In),Pe(Nn))},t.\u0275dir=Jt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),t})();class GT{constructor(){this.$implicit=null,this.ngIf=null}}function Qm(t,e){if(e&&!e.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${$e(e)}'.`)}let t_=(()=>{class t{constructor(n,i,r){this._ngEl=n,this._differs=i,this._renderer=r,this._ngStyle=null,this._differ=null}set ngStyle(n){this._ngStyle=n,!this._differ&&n&&(this._differ=this._differs.find(n).create())}ngDoCheck(){if(this._differ){const n=this._differ.diff(this._ngStyle);n&&this._applyChanges(n)}}_setStyle(n,i){const[r,o]=n.split("."),s=-1===r.indexOf("-")?void 0:Pt.DashCase;null!=i?this._renderer.setStyle(this._ngEl.nativeElement,r,o?`${i}${o}`:i,s):this._renderer.removeStyle(this._ngEl.nativeElement,r,s)}_applyChanges(n){n.forEachRemovedItem(i=>this._setStyle(i.key,null)),n.forEachAddedItem(i=>this._setStyle(i.key,i.currentValue)),n.forEachChangedItem(i=>this._setStyle(i.key,i.currentValue))}}return t.\u0275fac=function(n){return new(n||t)(Pe(ji),Pe(eo),Pe(af))},t.\u0275dir=Jt({type:t,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),t})(),p1=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=vr({type:t}),t.\u0275inj=vi({}),t})();class Y1 extends JI{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class lu extends Y1{static makeCurrent(){!function KI(t){zc||(zc=t)}(new lu)}onAndCancel(e,n,i){return e.addEventListener(n,i,!1),()=>{e.removeEventListener(n,i,!1)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return(n=n||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return"window"===n?window:"document"===n?e:"body"===n?e.body:null}getBaseHref(e){const n=function X1(){return ro=ro||document.querySelector("base"),ro?ro.getAttribute("href"):null}();return null==n?null:function q1(t){Gs=Gs||document.createElement("a"),Gs.setAttribute("href",t);const e=Gs.pathname;return"/"===e.charAt(0)?e:`/${e}`}(n)}resetBaseElement(){ro=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function NT(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const i=n.indexOf("="),[r,o]=-1==i?[n,""]:[n.slice(0,i),n.slice(i+1)];if(r.trim()===e)return decodeURIComponent(o)}return null}(document.cookie,e)}}let Gs,ro=null;const c_=new Fe("TRANSITION_ID"),K1=[{provide:dm,useFactory:function Z1(t,e,n){return()=>{n.get(Es).donePromise.then(()=>{const i=Os(),r=e.querySelectorAll(`style[ng-transition="${t}"]`);for(let o=0;o<r.length;o++)i.remove(r[o])})}},deps:[c_,Vn,ui],multi:!0}];let Q1=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ke({token:t,factory:t.\u0275fac}),t})();const Ws=new Fe("EventManagerPlugins");let zs=(()=>{class t{constructor(n,i){this._zone=i,this._eventNameToPlugin=new Map,n.forEach(r=>{r.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,i,r){return this._findPluginFor(i).addEventListener(n,i,r)}addGlobalEventListener(n,i,r){return this._findPluginFor(i).addGlobalEventListener(n,i,r)}getZone(){return this._zone}_findPluginFor(n){const i=this._eventNameToPlugin.get(n);if(i)return i;const r=this._plugins;for(let o=0;o<r.length;o++){const s=r[o];if(s.supports(n))return this._eventNameToPlugin.set(n,s),s}throw new Error(`No event manager plugin found for event ${n}`)}}return t.\u0275fac=function(n){return new(n||t)(je(Ws),je(bt))},t.\u0275prov=Ke({token:t,factory:t.\u0275fac}),t})();class u_{constructor(e){this._doc=e}addGlobalEventListener(e,n,i){const r=Os().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${n}`);return this.addEventListener(r,n,i)}}let d_=(()=>{class t{constructor(){this.usageCount=new Map}addStyles(n){for(const i of n)1===this.changeUsageCount(i,1)&&this.onStyleAdded(i)}removeStyles(n){for(const i of n)0===this.changeUsageCount(i,-1)&&this.onStyleRemoved(i)}onStyleRemoved(n){}onStyleAdded(n){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(n,i){const r=this.usageCount;let o=r.get(n)??0;return o+=i,o>0?r.set(n,o):r.delete(n),o}ngOnDestroy(){for(const n of this.getAllStyles())this.onStyleRemoved(n);this.usageCount.clear()}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=Ke({token:t,factory:t.\u0275fac}),t})(),oo=(()=>{class t extends d_{constructor(n){super(),this.doc=n,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(n){for(const i of this.hostNodes)this.addStyleToHost(i,n)}onStyleRemoved(n){const i=this.styleRef;i.get(n)?.forEach(o=>o.remove()),i.delete(n)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const i of this.getAllStyles())this.addStyleToHost(n,i)}removeHost(n){this.hostNodes.delete(n)}addStyleToHost(n,i){const r=this.doc.createElement("style");r.textContent=i,n.appendChild(r);const o=this.styleRef.get(i);o?o.push(r):this.styleRef.set(i,[r])}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}}return t.\u0275fac=function(n){return new(n||t)(je(Vn))},t.\u0275prov=Ke({token:t,factory:t.\u0275fac}),t})();const cu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},uu=/%COMP%/g,g_=new Fe("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function p_(t,e){return e.flat(100).map(n=>n.replace(uu,t))}function m_(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let du=(()=>{class t{constructor(n,i,r,o){this.eventManager=n,this.sharedStylesHost=i,this.appId=r,this.removeStylesOnCompDestory=o,this.rendererByCompId=new Map,this.defaultRenderer=new hu(n)}createRenderer(n,i){if(!n||!i)return this.defaultRenderer;const r=this.getOrCreateRenderer(n,i);return r instanceof y_?r.applyToHost(n):r instanceof fu&&r.applyStyles(),r}getOrCreateRenderer(n,i){const r=this.rendererByCompId;let o=r.get(i.id);if(!o){const s=this.eventManager,u=this.sharedStylesHost,g=this.removeStylesOnCompDestory;switch(i.encapsulation){case vn.Emulated:o=new y_(s,u,i,this.appId,g);break;case vn.ShadowDom:return new sx(s,u,n,i);default:o=new fu(s,u,i,g)}o.onDestroy=()=>r.delete(i.id),r.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return t.\u0275fac=function(n){return new(n||t)(je(zs),je(oo),je(Qr),je(g_))},t.\u0275prov=Ke({token:t,factory:t.\u0275fac}),t})();class hu{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,n){return n?document.createElementNS(cu[n]||n,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,n){(v_(e)?e.content:e).appendChild(n)}insertBefore(e,n,i){e&&(v_(e)?e.content:e).insertBefore(n,i)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return n||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,i,r){if(r){n=r+":"+n;const o=cu[r];o?e.setAttributeNS(o,n,i):e.setAttribute(n,i)}else e.setAttribute(n,i)}removeAttribute(e,n,i){if(i){const r=cu[i];r?e.removeAttributeNS(r,n):e.removeAttribute(`${i}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,i,r){r&(Pt.DashCase|Pt.Important)?e.style.setProperty(n,i,r&Pt.Important?"important":""):e.style[n]=i}removeStyle(e,n,i){i&Pt.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,i){e[n]=i}setValue(e,n){e.nodeValue=n}listen(e,n,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,n,m_(i)):this.eventManager.addEventListener(e,n,m_(i))}}function v_(t){return"TEMPLATE"===t.tagName&&void 0!==t.content}class sx extends hu{constructor(e,n,i,r){super(e),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const o=p_(r.id,r.styles);for(const s of o){const u=document.createElement("style");u.textContent=s,this.shadowRoot.appendChild(u)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,i){return super.insertBefore(this.nodeOrShadowRoot(e),n,i)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class fu extends hu{constructor(e,n,i,r,o=i.id){super(e),this.sharedStylesHost=n,this.removeStylesOnCompDestory=r,this.rendererUsageCount=0,this.styles=p_(o,i.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class y_ extends fu{constructor(e,n,i,r,o){const s=r+"-"+i.id;super(e,n,i,o,s),this.contentAttr=function ix(t){return"_ngcontent-%COMP%".replace(uu,t)}(s),this.hostAttr=function rx(t){return"_nghost-%COMP%".replace(uu,t)}(s)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,n){const i=super.createElement(e,n);return super.setAttribute(i,this.contentAttr,""),i}}let ax=(()=>{class t extends u_{constructor(n){super(n)}supports(n){return!0}addEventListener(n,i,r){return n.addEventListener(i,r,!1),()=>this.removeEventListener(n,i,r)}removeEventListener(n,i,r){return n.removeEventListener(i,r)}}return t.\u0275fac=function(n){return new(n||t)(je(Vn))},t.\u0275prov=Ke({token:t,factory:t.\u0275fac}),t})();const C_=["alt","control","meta","shift"],lx={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},cx={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let ux=(()=>{class t extends u_{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,i,r){const o=t.parseEventName(i),s=t.eventCallback(o.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Os().onAndCancel(n,o.domEventName,s))}static parseEventName(n){const i=n.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const o=t._normalizeKey(i.pop());let s="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),s="code."),C_.forEach(v=>{const w=i.indexOf(v);w>-1&&(i.splice(w,1),s+=v+".")}),s+=o,0!=i.length||0===o.length)return null;const g={};return g.domEventName=r,g.fullKey=s,g}static matchEventFullKeyCode(n,i){let r=lx[n.key]||n.key,o="";return i.indexOf("code.")>-1&&(r=n.code,o="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),C_.forEach(s=>{s!==r&&(0,cx[s])(n)&&(o+=s+".")}),o+=r,o===i)}static eventCallback(n,i,r){return o=>{t.matchEventFullKeyCode(o,n)&&r.runGuarded(()=>i(o))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return t.\u0275fac=function(n){return new(n||t)(je(Vn))},t.\u0275prov=Ke({token:t,factory:t.\u0275fac}),t})();const S_=[{provide:gm,useValue:"browser"},{provide:fm,useValue:function dx(){lu.makeCurrent()},multi:!0},{provide:Vn,useFactory:function fx(){return function FC(t){vl=t}(document),document},deps:[]}],gx=Sm(XI,"browser",S_),b_=new Fe(""),D_=[{provide:Is,useClass:class J1{addToWindow(e){Xe.getAngularTestability=(i,r=!0)=>{const o=e.findTestabilityInTree(i,r);if(null==o)throw new Error("Could not find testability for element.");return o},Xe.getAllAngularTestabilities=()=>e.getAllTestabilities(),Xe.getAllAngularRootElements=()=>e.getAllRootElements(),Xe.frameworkStabilizers||(Xe.frameworkStabilizers=[]),Xe.frameworkStabilizers.push(i=>{const r=Xe.getAllAngularTestabilities();let o=r.length,s=!1;const u=function(g){s=s||g,o--,0==o&&i(s)};r.forEach(function(g){g.whenStable(u)})})}findTestabilityInTree(e,n,i){return null==n?null:e.getTestability(n)??(i?Os().isShadowRoot(n)?this.findTestabilityInTree(e,n.host,!0):this.findTestabilityInTree(e,n.parentElement,!0):null)}},deps:[]},{provide:ym,useClass:Lc,deps:[bt,kc,Is]},{provide:Lc,useClass:Lc,deps:[bt,kc,Is]}],E_=[{provide:Tl,useValue:"root"},{provide:Vi,useFactory:function hx(){return new Vi},deps:[]},{provide:Ws,useClass:ax,multi:!0,deps:[Vn,bt,gm]},{provide:Ws,useClass:ux,multi:!0,deps:[Vn]},{provide:du,useClass:du,deps:[zs,oo,Qr,g_]},{provide:sf,useExisting:du},{provide:d_,useExisting:oo},{provide:oo,useClass:oo,deps:[Vn]},{provide:zs,useClass:zs,deps:[Ws,bt]},{provide:class C1{},useClass:Q1,deps:[]},[]];let px=(()=>{class t{constructor(n){}static withServerTransition(n){return{ngModule:t,providers:[{provide:Qr,useValue:n.appId},{provide:c_,useExisting:Qr},K1]}}}return t.\u0275fac=function(n){return new(n||t)(je(b_,12))},t.\u0275mod=vr({type:t}),t.\u0275inj=vi({providers:[...E_,...D_],imports:[p1,qI]}),t})();function x_(t,e,n,i,r,o,s){try{var u=t[o](s),g=u.value}catch(v){return void n(v)}u.done?e(g):Promise.resolve(g).then(i,r)}function ne(t){return function(){var e=this,n=arguments;return new Promise(function(i,r){var o=t.apply(e,n);function s(g){x_(o,i,r,s,u,"next",g)}function u(g){x_(o,i,r,s,u,"throw",g)}s(void 0)})}}typeof window<"u"&&window;var mu=function(){this.init()};mu.prototype={init:function(){var t=this||se;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator=typeof window<"u"&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||se;if(t=parseFloat(t),e.ctx||Xs(),typeof t<"u"&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,se.ctx.currentTime);for(var n=0;n<e._howls.length;n++)if(!e._howls[n]._webAudio)for(var i=e._howls[n]._getSoundIds(),r=0;r<i.length;r++){var o=e._howls[n]._soundById(i[r]);o&&o._node&&(o._node.volume=o._volume*t)}return e}return e._volume},mute:function(t){var e=this||se;e.ctx||Xs(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,se.ctx.currentTime);for(var n=0;n<e._howls.length;n++)if(!e._howls[n]._webAudio)for(var i=e._howls[n]._getSoundIds(),r=0;r<i.length;r++){var o=e._howls[n]._soundById(i[r]);o&&o._node&&(o._node.muted=!!t||o._muted)}return e},stop:function(){for(var t=this||se,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||se,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&typeof t.ctx.close<"u"&&(t.ctx.close(),t.ctx=null,Xs()),t},codecs:function(t){return(this||se)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||se;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if(typeof Audio<"u")try{typeof(new Audio).oncanplaythrough>"u"&&(t._canPlayEvent="canplay")}catch{t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch{}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||se,e=null;try{e=typeof Audio<"u"?new Audio:null}catch{return t}if(!e||"function"!=typeof e.canPlayType)return t;var n=e.canPlayType("audio/mpeg;").replace(/^no$/,""),i=t._navigator?t._navigator.userAgent:"",r=i.match(/OPR\/([0-6].)/g),o=r&&parseInt(r[0].split("/")[1],10)<33,s=-1!==i.indexOf("Safari")&&-1===i.indexOf("Chrome"),u=i.match(/Version\/(.*?) /),g=s&&u&&parseInt(u[1],10)<15;return t._codecs={mp3:!(o||!n&&!e.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!n,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(g||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(g||!e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||se;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,!t._mobileUnloaded&&44100!==t.ctx.sampleRate&&(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(n){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var i=new Audio;i._unlocked=!0,t._releaseHtml5Audio(i)}catch{t.noAudio=!0;break}for(var r=0;r<t._howls.length;r++)if(!t._howls[r]._webAudio)for(var o=t._howls[r]._getSoundIds(),s=0;s<o.length;s++){var u=t._howls[r]._soundById(o[s]);u&&u._node&&!u._node._unlocked&&(u._node._unlocked=!0,u._node.load())}t._autoResume();var g=t.ctx.createBufferSource();g.buffer=t._scratchBuffer,g.connect(t.ctx.destination),typeof g.start>"u"?g.noteOn(0):g.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),g.onended=function(){g.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var v=0;v<t._howls.length;v++)t._howls[v]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||se;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=(new Audio).play();return e&&typeof Promise<"u"&&(e instanceof Promise||"function"==typeof e.then)&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(t){var e=this||se;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&!(typeof t.ctx.suspend>"u")&&se.usingWebAudio){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio)for(var n=0;n<t._howls[e]._sounds.length;n++)if(!t._howls[e]._sounds[n]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var i=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(i,i)}},3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&!(typeof t.ctx.resume>"u")&&se.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var se=new mu,$s=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};$s.prototype={init:function(t){var e=this;return se.ctx||Xs(),e._autoplay=t.autoplay||!1,e._format="string"!=typeof t.format?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src="string"!=typeof t.src?t.src:[t.src],e._volume=void 0!==t.volume?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=se.usingWebAudio&&!e._html5,typeof se.ctx<"u"&&se.ctx&&se.autoUnlock&&se._unlockAudio(),se._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&"none"!==e._preload&&e.load(),e},load:function(){var t=this,e=null;if(se.noAudio)t._emit("loaderror",null,"No audio support.");else{"string"==typeof t._src&&(t._src=[t._src]);for(var n=0;n<t._src.length;n++){var i,r;if(t._format&&t._format[n])i=t._format[n];else{if("string"!=typeof(r=t._src[n])){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(i=/^data:audio\/([^;,]+);/i.exec(r))||(i=/\.([^.]+)$/.exec(r.split("?",1)[0])),i&&(i=i[1].toLowerCase())}if(i||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),i&&se.codecs(i)){e=t._src[n];break}}if(e)return t._src=e,t._state="loading","https:"===window.location.protocol&&"http:"===e.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new Ys(t),t._webAudio&&Dx(t),t;t._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,e){var n=this,i=null;if("number"==typeof t)i=t,t=null;else{if("string"==typeof t&&"loaded"===n._state&&!n._sprite[t])return null;if(typeof t>"u"&&(t="__default",!n._playLock)){for(var r=0,o=0;o<n._sounds.length;o++)n._sounds[o]._paused&&!n._sounds[o]._ended&&(r++,i=n._sounds[o]._id);1===r?t=null:i=null}}var s=i?n._soundById(i):n._inactiveSound();if(!s)return null;if(i&&!t&&(t=s._sprite||"__default"),"loaded"!==n._state){s._sprite=t,s._ended=!1;var u=s._id;return n._queue.push({event:"play",action:function(){n.play(u)}}),u}if(i&&!s._paused)return e||n._loadQueue("play"),s._id;n._webAudio&&se._autoResume();var g=Math.max(0,s._seek>0?s._seek:n._sprite[t][0]/1e3),v=Math.max(0,(n._sprite[t][0]+n._sprite[t][1])/1e3-g),w=1e3*v/Math.abs(s._rate),b=n._sprite[t][0]/1e3,I=(n._sprite[t][0]+n._sprite[t][1])/1e3;s._sprite=t,s._ended=!1;var x=function(){s._paused=!1,s._seek=g,s._start=b,s._stop=I,s._loop=!(!s._loop&&!n._sprite[t][2])};if(!(g>=I)){var O=s._node;if(n._webAudio){var R=function(){n._playLock=!1,x(),n._refreshBuffer(s),O.gain.setValueAtTime(s._muted||n._muted?0:s._volume,se.ctx.currentTime),s._playStart=se.ctx.currentTime,typeof O.bufferSource.start>"u"?O.bufferSource.noteGrainOn(0,g,s._loop?86400:v):O.bufferSource.start(0,g,s._loop?86400:v),w!==1/0&&(n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),w)),e||setTimeout(function(){n._emit("play",s._id),n._loadQueue()},0)};"running"===se.state&&"interrupted"!==se.ctx.state?R():(n._playLock=!0,n.once("resume",R),n._clearTimer(s._id))}else{var P=function(){O.currentTime=g,O.muted=s._muted||n._muted||se._muted||O.muted,O.volume=s._volume*se.volume(),O.playbackRate=s._rate;try{var L=O.play();if(L&&typeof Promise<"u"&&(L instanceof Promise||"function"==typeof L.then)?(n._playLock=!0,x(),L.then(function(){n._playLock=!1,O._unlocked=!0,e?n._loadQueue():n._emit("play",s._id)}).catch(function(){n._playLock=!1,n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),s._ended=!0,s._paused=!0})):e||(n._playLock=!1,x(),n._emit("play",s._id)),O.playbackRate=s._rate,O.paused)return void n._emit("playerror",s._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||s._loop?n._endTimers[s._id]=setTimeout(n._ended.bind(n,s),w):(n._endTimers[s._id]=function(){n._ended(s),O.removeEventListener("ended",n._endTimers[s._id],!1)},O.addEventListener("ended",n._endTimers[s._id],!1))}catch(X){n._emit("playerror",s._id,X)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===O.src&&(O.src=n._src,O.load());var V=window&&window.ejecta||!O.readyState&&se._navigator.isCocoonJS;if(O.readyState>=3||V)P();else{n._playLock=!0,n._state="loading";var W=function(){n._state="loaded",P(),O.removeEventListener(se._canPlayEvent,W,!1)};O.addEventListener(se._canPlayEvent,W,!1),n._clearTimer(s._id)}}return s._id}n._ended(s)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var n=e._getSoundIds(t),i=0;i<n.length;i++){e._clearTimer(n[i]);var r=e._soundById(n[i]);if(r&&!r._paused&&(r._seek=e.seek(n[i]),r._rateSeek=0,r._paused=!0,e._stopFade(n[i]),r._node))if(e._webAudio){if(!r._node.bufferSource)continue;typeof r._node.bufferSource.stop>"u"?r._node.bufferSource.noteOff(0):r._node.bufferSource.stop(0),e._cleanBuffer(r._node)}else(!isNaN(r._node.duration)||r._node.duration===1/0)&&r._node.pause();arguments[1]||e._emit("pause",r?r._id:null)}return e},stop:function(t,e){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"stop",action:function(){n.stop(t)}}),n;for(var i=n._getSoundIds(t),r=0;r<i.length;r++){n._clearTimer(i[r]);var o=n._soundById(i[r]);o&&(o._seek=o._start||0,o._rateSeek=0,o._paused=!0,o._ended=!0,n._stopFade(i[r]),o._node&&(n._webAudio?o._node.bufferSource&&(typeof o._node.bufferSource.stop>"u"?o._node.bufferSource.noteOff(0):o._node.bufferSource.stop(0),n._cleanBuffer(o._node)):(!isNaN(o._node.duration)||o._node.duration===1/0)&&(o._node.currentTime=o._start||0,o._node.pause(),o._node.duration===1/0&&n._clearSound(o._node))),e||n._emit("stop",o._id))}return n},mute:function(t,e){var n=this;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"mute",action:function(){n.mute(t,e)}}),n;if(typeof e>"u"){if("boolean"!=typeof t)return n._muted;n._muted=t}for(var i=n._getSoundIds(e),r=0;r<i.length;r++){var o=n._soundById(i[r]);o&&(o._muted=t,o._interval&&n._stopFade(o._id),n._webAudio&&o._node?o._node.gain.setValueAtTime(t?0:o._volume,se.ctx.currentTime):o._node&&(o._node.muted=!!se._muted||t),n._emit("mute",o._id))}return n},volume:function(){var n,i,s,t=this,e=arguments;if(0===e.length)return t._volume;if(1===e.length||2===e.length&&typeof e[1]>"u"?t._getSoundIds().indexOf(e[0])>=0?i=parseInt(e[0],10):n=parseFloat(e[0]):e.length>=2&&(n=parseFloat(e[0]),i=parseInt(e[1],10)),!(typeof n<"u"&&n>=0&&n<=1))return(s=i?t._soundById(i):t._sounds[0])?s._volume:0;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,e)}}),t;typeof i>"u"&&(t._volume=n),i=t._getSoundIds(i);for(var u=0;u<i.length;u++)(s=t._soundById(i[u]))&&(s._volume=n,e[2]||t._stopFade(i[u]),t._webAudio&&s._node&&!s._muted?s._node.gain.setValueAtTime(n,se.ctx.currentTime):s._node&&!s._muted&&(s._node.volume=n*se.volume()),t._emit("volume",s._id));return t},fade:function(t,e,n,i){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"fade",action:function(){r.fade(t,e,n,i)}}),r;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),n=parseFloat(n),r.volume(t,i);for(var o=r._getSoundIds(i),s=0;s<o.length;s++){var u=r._soundById(o[s]);if(u){if(i||r._stopFade(o[s]),r._webAudio&&!u._muted){var g=se.ctx.currentTime,v=g+n/1e3;u._volume=t,u._node.gain.setValueAtTime(t,g),u._node.gain.linearRampToValueAtTime(e,v)}r._startFadeInterval(u,t,e,n,o[s],typeof i>"u")}}return r},_startFadeInterval:function(t,e,n,i,r,o){var s=this,u=e,g=n-e,v=Math.abs(g/.01),w=Math.max(4,v>0?i/v:i),b=Date.now();t._fadeTo=n,t._interval=setInterval(function(){var I=(Date.now()-b)/i;b=Date.now(),u+=g*I,u=Math.round(100*u)/100,u=g<0?Math.max(n,u):Math.min(n,u),s._webAudio?t._volume=u:s.volume(u,t._id,!0),o&&(s._volume=u),(n<e&&u<=n||n>e&&u>=n)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,s.volume(n,t._id),s._emit("fade",t._id))},w)},_stopFade:function(t){var e=this,n=e._soundById(t);return n&&n._interval&&(e._webAudio&&n._node.gain.cancelScheduledValues(se.ctx.currentTime),clearInterval(n._interval),n._interval=null,e.volume(n._fadeTo,t),n._fadeTo=null,e._emit("fade",t)),e},loop:function(){var n,i,r,t=this,e=arguments;if(0===e.length)return t._loop;if(1===e.length){if("boolean"!=typeof e[0])return!!(r=t._soundById(parseInt(e[0],10)))&&r._loop;t._loop=n=e[0]}else 2===e.length&&(n=e[0],i=parseInt(e[1],10));for(var o=t._getSoundIds(i),s=0;s<o.length;s++)(r=t._soundById(o[s]))&&(r._loop=n,t._webAudio&&r._node&&r._node.bufferSource&&(r._node.bufferSource.loop=n,n&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop,t.playing(o[s])&&(t.pause(o[s],!0),t.play(o[s],!0)))));return t},rate:function(){var n,i,s,t=this,e=arguments;if(0===e.length?i=t._sounds[0]._id:1===e.length?t._getSoundIds().indexOf(e[0])>=0?i=parseInt(e[0],10):n=parseFloat(e[0]):2===e.length&&(n=parseFloat(e[0]),i=parseInt(e[1],10)),"number"!=typeof n)return(s=t._soundById(i))?s._rate:t._rate;if("loaded"!==t._state||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,e)}}),t;typeof i>"u"&&(t._rate=n),i=t._getSoundIds(i);for(var u=0;u<i.length;u++)if(s=t._soundById(i[u])){t.playing(i[u])&&(s._rateSeek=t.seek(i[u]),s._playStart=t._webAudio?se.ctx.currentTime:s._playStart),s._rate=n,t._webAudio&&s._node&&s._node.bufferSource?s._node.bufferSource.playbackRate.setValueAtTime(n,se.ctx.currentTime):s._node&&(s._node.playbackRate=n);var g=t.seek(i[u]),w=1e3*((t._sprite[s._sprite][0]+t._sprite[s._sprite][1])/1e3-g)/Math.abs(s._rate);(t._endTimers[i[u]]||!s._paused)&&(t._clearTimer(i[u]),t._endTimers[i[u]]=setTimeout(t._ended.bind(t,s),w)),t._emit("rate",s._id)}return t},seek:function(){var n,i,t=this,e=arguments;if(0===e.length?t._sounds.length&&(i=t._sounds[0]._id):1===e.length?t._getSoundIds().indexOf(e[0])>=0?i=parseInt(e[0],10):t._sounds.length&&(i=t._sounds[0]._id,n=parseFloat(e[0])):2===e.length&&(n=parseFloat(e[0]),i=parseInt(e[1],10)),typeof i>"u")return 0;if("number"==typeof n&&("loaded"!==t._state||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,e)}}),t;var s=t._soundById(i);if(s){if(!("number"==typeof n&&n>=0)){if(t._webAudio){var w=t.playing(i)?se.ctx.currentTime-s._playStart:0;return s._seek+((s._rateSeek?s._rateSeek-s._seek:0)+w*Math.abs(s._rate))}return s._node.currentTime}var u=t.playing(i);u&&t.pause(i,!0),s._seek=n,s._ended=!1,t._clearTimer(i),!t._webAudio&&s._node&&!isNaN(s._node.duration)&&(s._node.currentTime=n);var g=function(){u&&t.play(i,!0),t._emit("seek",i)};if(u&&!t._webAudio){var v=function(){t._playLock?setTimeout(v,0):g()};setTimeout(v,0)}else g()}return t},playing:function(t){var e=this;if("number"==typeof t){var n=e._soundById(t);return!!n&&!n._paused}for(var i=0;i<e._sounds.length;i++)if(!e._sounds[i]._paused)return!0;return!1},duration:function(t){var e=this,n=e._duration,i=e._soundById(t);return i&&(n=e._sprite[i._sprite][1]/1e3),n},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,n=0;n<e.length;n++)e[n]._paused||t.stop(e[n]._id),t._webAudio||(t._clearSound(e[n]._node),e[n]._node.removeEventListener("error",e[n]._errorFn,!1),e[n]._node.removeEventListener(se._canPlayEvent,e[n]._loadFn,!1),e[n]._node.removeEventListener("ended",e[n]._endFn,!1),se._releaseHtml5Audio(e[n]._node)),delete e[n]._node,t._clearTimer(e[n]._id);var i=se._howls.indexOf(t);i>=0&&se._howls.splice(i,1);var r=!0;for(n=0;n<se._howls.length;n++)if(se._howls[n]._src===t._src||t._src.indexOf(se._howls[n]._src)>=0){r=!1;break}return pi&&r&&delete pi[t._src],se.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,n,i){return"function"==typeof e&&this["_on"+t].push(i?{id:n,fn:e,once:i}:{id:n,fn:e}),this},off:function(t,e,n){var i=this,r=i["_on"+t],o=0;if("number"==typeof e&&(n=e,e=null),e||n)for(o=0;o<r.length;o++){var s=n===r[o].id;if(e===r[o].fn&&s||!e&&s){r.splice(o,1);break}}else if(t)i["_on"+t]=[];else{var u=Object.keys(i);for(o=0;o<u.length;o++)0===u[o].indexOf("_on")&&Array.isArray(i[u[o]])&&(i[u[o]]=[])}return i},once:function(t,e,n){return this.on(t,e,n,1),this},_emit:function(t,e,n){for(var i=this,r=i["_on"+t],o=r.length-1;o>=0;o--)(!r[o].id||r[o].id===e||"load"===t)&&(setTimeout(function(s){s.call(this,e,n)}.bind(i,r[o].fn),0),r[o].once&&i.off(t,r[o].fn,r[o].id));return i._loadQueue(t),i},_loadQueue:function(t){var e=this;if(e._queue.length>0){var n=e._queue[0];n.event===t&&(e._queue.shift(),e._loadQueue()),t||n.action()}return e},_ended:function(t){var e=this,n=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var i=!(!t._loop&&!e._sprite[n][2]);if(e._emit("end",t._id),!e._webAudio&&i&&e.stop(t._id,!0).play(t._id),e._webAudio&&i){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=se.ctx.currentTime;var r=1e3*(t._stop-t._start)/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),r)}return e._webAudio&&!i&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),se._autoSuspend()),!e._webAudio&&!i&&e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if("function"!=typeof e._endTimers[t])clearTimeout(e._endTimers[t]);else{var n=e._soundById(t);n&&n._node&&n._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,n=0;n<e._sounds.length;n++)if(t===e._sounds[n]._id)return e._sounds[n];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new Ys(t)},_drain:function(){var t=this,e=t._pool,n=0,i=0;if(!(t._sounds.length<e)){for(i=0;i<t._sounds.length;i++)t._sounds[i]._ended&&n++;for(i=t._sounds.length-1;i>=0;i--){if(n<=e)return;t._sounds[i]._ended&&(t._webAudio&&t._sounds[i]._node&&t._sounds[i]._node.disconnect(0),t._sounds.splice(i,1),n--)}}},_getSoundIds:function(t){if(typeof t>"u"){for(var n=[],i=0;i<this._sounds.length;i++)n.push(this._sounds[i]._id);return n}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=se.ctx.createBufferSource(),t._node.bufferSource.buffer=pi[this._src],t._node.bufferSource.connect(t._panner?t._panner:t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,se.ctx.currentTime),this},_cleanBuffer:function(t){var n=se._navigator&&se._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return this;if(se._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),n))try{t.bufferSource.buffer=se._scratchBuffer}catch{}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(se._navigator&&se._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var Ys=function(t){this._parent=t,this.init()};Ys.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++se._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,n=se._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=typeof se.ctx.createGain>"u"?se.ctx.createGainNode():se.ctx.createGain(),t._node.gain.setValueAtTime(n,se.ctx.currentTime),t._node.paused=!0,t._node.connect(se.masterGain)):se.noAudio||(t._node=se._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(se._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=!0===e._preload?"auto":e._preload,t._node.volume=n*se.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++se._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(e._sprite).length&&(e._sprite={__default:[0,1e3*e._duration]}),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(se._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(10*t._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var pi={},Dx=function(t){var e=t._src;if(pi[e])return t._duration=pi[e].duration,void M_(t);if(/^data:[^;]+;base64,/.test(e)){for(var n=atob(e.split(",")[1]),i=new Uint8Array(n.length),r=0;r<n.length;++r)i[r]=n.charCodeAt(r);A_(i.buffer,t)}else{var o=new XMLHttpRequest;o.open(t._xhr.method,e,!0),o.withCredentials=t._xhr.withCredentials,o.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(s){o.setRequestHeader(s,t._xhr.headers[s])}),o.onload=function(){var s=(o.status+"")[0];"0"===s||"2"===s||"3"===s?A_(o.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+o.status+".")},o.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete pi[e],t.load())},Ex(o)}},Ex=function(t){try{t.send()}catch{t.onerror()}},A_=function(t,e){var n=function(){e._emit("loaderror",null,"Decoding audio data failed.")},i=function(r){r&&e._sounds.length>0?(pi[e._src]=r,M_(e,r)):n()};typeof Promise<"u"&&1===se.ctx.decodeAudioData.length?se.ctx.decodeAudioData(t).then(i).catch(n):se.ctx.decodeAudioData(t,i,n)},M_=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},Xs=function(){if(se.usingWebAudio){try{typeof AudioContext<"u"?se.ctx=new AudioContext:typeof webkitAudioContext<"u"?se.ctx=new webkitAudioContext:se.usingWebAudio=!1}catch{se.usingWebAudio=!1}se.ctx||(se.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(se._navigator&&se._navigator.platform),e=se._navigator&&se._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),n=e?parseInt(e[1],10):null;if(t&&n&&n<9){var i=/safari/.test(se._navigator&&se._navigator.userAgent.toLowerCase());se._navigator&&!i&&(se.usingWebAudio=!1)}se.usingWebAudio&&(se.masterGain=typeof se.ctx.createGain>"u"?se.ctx.createGainNode():se.ctx.createGain(),se.masterGain.gain.setValueAtTime(se._muted?0:se._volume,se.ctx.currentTime),se.masterGain.connect(se.ctx.destination)),se._setup()}};!function bx(t,e,n,i){var o;t.prototype._pos=[0,0,0],t.prototype._orientation=[0,0,-1,0,1,0],t.prototype.stereo=function(o){var s=this;if(!s.ctx||!s.ctx.listener)return s;for(var u=s._howls.length-1;u>=0;u--)s._howls[u].stereo(o);return s},t.prototype.pos=function(o,s,u){var g=this;return g.ctx&&g.ctx.listener?"number"!=typeof o?g._pos:(g._pos=[o,s="number"!=typeof s?g._pos[1]:s,u="number"!=typeof u?g._pos[2]:u],typeof g.ctx.listener.positionX<"u"?(g.ctx.listener.positionX.setTargetAtTime(g._pos[0],e.ctx.currentTime,.1),g.ctx.listener.positionY.setTargetAtTime(g._pos[1],e.ctx.currentTime,.1),g.ctx.listener.positionZ.setTargetAtTime(g._pos[2],e.ctx.currentTime,.1)):g.ctx.listener.setPosition(g._pos[0],g._pos[1],g._pos[2]),g):g},t.prototype.orientation=function(o,s,u,g,v,w){var b=this;if(!b.ctx||!b.ctx.listener)return b;var I=b._orientation;return"number"!=typeof o?I:(b._orientation=[o,s="number"!=typeof s?I[1]:s,u="number"!=typeof u?I[2]:u,g="number"!=typeof g?I[3]:g,v="number"!=typeof v?I[4]:v,w="number"!=typeof w?I[5]:w],typeof b.ctx.listener.forwardX<"u"?(b.ctx.listener.forwardX.setTargetAtTime(o,e.ctx.currentTime,.1),b.ctx.listener.forwardY.setTargetAtTime(s,e.ctx.currentTime,.1),b.ctx.listener.forwardZ.setTargetAtTime(u,e.ctx.currentTime,.1),b.ctx.listener.upX.setTargetAtTime(g,e.ctx.currentTime,.1),b.ctx.listener.upY.setTargetAtTime(v,e.ctx.currentTime,.1),b.ctx.listener.upZ.setTargetAtTime(w,e.ctx.currentTime,.1)):b.ctx.listener.setOrientation(o,s,u,g,v,w),b)},n.prototype.init=(o=n.prototype.init,function(s){var u=this;return u._orientation=s.orientation||[1,0,0],u._stereo=s.stereo||null,u._pos=s.pos||null,u._pannerAttr={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:360,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:360,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:0,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:"inverse",maxDistance:typeof s.maxDistance<"u"?s.maxDistance:1e4,panningModel:typeof s.panningModel<"u"?s.panningModel:"HRTF",refDistance:typeof s.refDistance<"u"?s.refDistance:1,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:1},u._onstereo=s.onstereo?[{fn:s.onstereo}]:[],u._onpos=s.onpos?[{fn:s.onpos}]:[],u._onorientation=s.onorientation?[{fn:s.onorientation}]:[],o.call(this,s)}),n.prototype.stereo=function(o,s){var u=this;if(!u._webAudio)return u;if("loaded"!==u._state)return u._queue.push({event:"stereo",action:function(){u.stereo(o,s)}}),u;var g=typeof e.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof s>"u"){if("number"!=typeof o)return u._stereo;u._stereo=o,u._pos=[o,0,0]}for(var v=u._getSoundIds(s),w=0;w<v.length;w++){var b=u._soundById(v[w]);if(b){if("number"!=typeof o)return b._stereo;b._stereo=o,b._pos=[o,0,0],b._node&&(b._pannerAttr.panningModel="equalpower",(!b._panner||!b._panner.pan)&&r(b,g),"spatial"===g?typeof b._panner.positionX<"u"?(b._panner.positionX.setValueAtTime(o,e.ctx.currentTime),b._panner.positionY.setValueAtTime(0,e.ctx.currentTime),b._panner.positionZ.setValueAtTime(0,e.ctx.currentTime)):b._panner.setPosition(o,0,0):b._panner.pan.setValueAtTime(o,e.ctx.currentTime)),u._emit("stereo",b._id)}}return u},n.prototype.pos=function(o,s,u,g){var v=this;if(!v._webAudio)return v;if("loaded"!==v._state)return v._queue.push({event:"pos",action:function(){v.pos(o,s,u,g)}}),v;if(s="number"!=typeof s?0:s,u="number"!=typeof u?-.5:u,typeof g>"u"){if("number"!=typeof o)return v._pos;v._pos=[o,s,u]}for(var w=v._getSoundIds(g),b=0;b<w.length;b++){var I=v._soundById(w[b]);if(I){if("number"!=typeof o)return I._pos;I._pos=[o,s,u],I._node&&((!I._panner||I._panner.pan)&&r(I,"spatial"),typeof I._panner.positionX<"u"?(I._panner.positionX.setValueAtTime(o,e.ctx.currentTime),I._panner.positionY.setValueAtTime(s,e.ctx.currentTime),I._panner.positionZ.setValueAtTime(u,e.ctx.currentTime)):I._panner.setPosition(o,s,u)),v._emit("pos",I._id)}}return v},n.prototype.orientation=function(o,s,u,g){var v=this;if(!v._webAudio)return v;if("loaded"!==v._state)return v._queue.push({event:"orientation",action:function(){v.orientation(o,s,u,g)}}),v;if(s="number"!=typeof s?v._orientation[1]:s,u="number"!=typeof u?v._orientation[2]:u,typeof g>"u"){if("number"!=typeof o)return v._orientation;v._orientation=[o,s,u]}for(var w=v._getSoundIds(g),b=0;b<w.length;b++){var I=v._soundById(w[b]);if(I){if("number"!=typeof o)return I._orientation;I._orientation=[o,s,u],I._node&&(I._panner||(I._pos||(I._pos=v._pos||[0,0,-.5]),r(I,"spatial")),typeof I._panner.orientationX<"u"?(I._panner.orientationX.setValueAtTime(o,e.ctx.currentTime),I._panner.orientationY.setValueAtTime(s,e.ctx.currentTime),I._panner.orientationZ.setValueAtTime(u,e.ctx.currentTime)):I._panner.setOrientation(o,s,u)),v._emit("orientation",I._id)}}return v},n.prototype.pannerAttr=function(){var u,g,v,o=this,s=arguments;if(!o._webAudio)return o;if(0===s.length)return o._pannerAttr;if(1===s.length){if("object"!=typeof s[0])return(v=o._soundById(parseInt(s[0],10)))?v._pannerAttr:o._pannerAttr;u=s[0],typeof g>"u"&&(u.pannerAttr||(u.pannerAttr={coneInnerAngle:u.coneInnerAngle,coneOuterAngle:u.coneOuterAngle,coneOuterGain:u.coneOuterGain,distanceModel:u.distanceModel,maxDistance:u.maxDistance,refDistance:u.refDistance,rolloffFactor:u.rolloffFactor,panningModel:u.panningModel}),o._pannerAttr={coneInnerAngle:typeof u.pannerAttr.coneInnerAngle<"u"?u.pannerAttr.coneInnerAngle:o._coneInnerAngle,coneOuterAngle:typeof u.pannerAttr.coneOuterAngle<"u"?u.pannerAttr.coneOuterAngle:o._coneOuterAngle,coneOuterGain:typeof u.pannerAttr.coneOuterGain<"u"?u.pannerAttr.coneOuterGain:o._coneOuterGain,distanceModel:typeof u.pannerAttr.distanceModel<"u"?u.pannerAttr.distanceModel:o._distanceModel,maxDistance:typeof u.pannerAttr.maxDistance<"u"?u.pannerAttr.maxDistance:o._maxDistance,refDistance:typeof u.pannerAttr.refDistance<"u"?u.pannerAttr.refDistance:o._refDistance,rolloffFactor:typeof u.pannerAttr.rolloffFactor<"u"?u.pannerAttr.rolloffFactor:o._rolloffFactor,panningModel:typeof u.pannerAttr.panningModel<"u"?u.pannerAttr.panningModel:o._panningModel})}else 2===s.length&&(u=s[0],g=parseInt(s[1],10));for(var w=o._getSoundIds(g),b=0;b<w.length;b++)if(v=o._soundById(w[b])){var I=v._pannerAttr;I={coneInnerAngle:typeof u.coneInnerAngle<"u"?u.coneInnerAngle:I.coneInnerAngle,coneOuterAngle:typeof u.coneOuterAngle<"u"?u.coneOuterAngle:I.coneOuterAngle,coneOuterGain:typeof u.coneOuterGain<"u"?u.coneOuterGain:I.coneOuterGain,distanceModel:typeof u.distanceModel<"u"?u.distanceModel:I.distanceModel,maxDistance:typeof u.maxDistance<"u"?u.maxDistance:I.maxDistance,refDistance:typeof u.refDistance<"u"?u.refDistance:I.refDistance,rolloffFactor:typeof u.rolloffFactor<"u"?u.rolloffFactor:I.rolloffFactor,panningModel:typeof u.panningModel<"u"?u.panningModel:I.panningModel};var x=v._panner;x||(v._pos||(v._pos=o._pos||[0,0,-.5]),r(v,"spatial"),x=v._panner),x.coneInnerAngle=I.coneInnerAngle,x.coneOuterAngle=I.coneOuterAngle,x.coneOuterGain=I.coneOuterGain,x.distanceModel=I.distanceModel,x.maxDistance=I.maxDistance,x.refDistance=I.refDistance,x.rolloffFactor=I.rolloffFactor,x.panningModel=I.panningModel}return o},i.prototype.init=function(o){return function(){var s=this,u=s._parent;s._orientation=u._orientation,s._stereo=u._stereo,s._pos=u._pos,s._pannerAttr=u._pannerAttr,o.call(this),s._stereo?u.stereo(s._stereo):s._pos&&u.pos(s._pos[0],s._pos[1],s._pos[2],s._id)}}(i.prototype.init),i.prototype.reset=function(o){return function(){var s=this,u=s._parent;return s._orientation=u._orientation,s._stereo=u._stereo,s._pos=u._pos,s._pannerAttr=u._pannerAttr,s._stereo?u.stereo(s._stereo):s._pos?u.pos(s._pos[0],s._pos[1],s._pos[2],s._id):s._panner&&(s._panner.disconnect(0),s._panner=void 0,u._refreshBuffer(s)),o.call(this)}}(i.prototype.reset);var r=function(o,s){"spatial"===(s=s||"spatial")?(o._panner=e.ctx.createPanner(),o._panner.coneInnerAngle=o._pannerAttr.coneInnerAngle,o._panner.coneOuterAngle=o._pannerAttr.coneOuterAngle,o._panner.coneOuterGain=o._pannerAttr.coneOuterGain,o._panner.distanceModel=o._pannerAttr.distanceModel,o._panner.maxDistance=o._pannerAttr.maxDistance,o._panner.refDistance=o._pannerAttr.refDistance,o._panner.rolloffFactor=o._pannerAttr.rolloffFactor,o._panner.panningModel=o._pannerAttr.panningModel,typeof o._panner.positionX<"u"?(o._panner.positionX.setValueAtTime(o._pos[0],e.ctx.currentTime),o._panner.positionY.setValueAtTime(o._pos[1],e.ctx.currentTime),o._panner.positionZ.setValueAtTime(o._pos[2],e.ctx.currentTime)):o._panner.setPosition(o._pos[0],o._pos[1],o._pos[2]),typeof o._panner.orientationX<"u"?(o._panner.orientationX.setValueAtTime(o._orientation[0],e.ctx.currentTime),o._panner.orientationY.setValueAtTime(o._orientation[1],e.ctx.currentTime),o._panner.orientationZ.setValueAtTime(o._orientation[2],e.ctx.currentTime)):o._panner.setOrientation(o._orientation[0],o._orientation[1],o._orientation[2])):(o._panner=e.ctx.createStereoPanner(),o._panner.pan.setValueAtTime(o._stereo,e.ctx.currentTime)),o._panner.connect(o._node),o._paused||o._parent.pause(o._id,!0).play(o._id,!0)}}(mu,se,$s,Ys);const ei=typeof self>"u",O_=ei?{}:self;let so,Hn,qs,Zs,Dt;if(typeof navigator<"u"&&(so=navigator,Hn=so.userAgent,qs=so.platform,Zs=so.mediaDevices),!ei){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:so.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:qs,search:"Win"},Mac:{str:qs},Linux:{str:qs}};let n="unknownBrowser",i=0,r="unknownOS";for(let o in t){const s=t[o]||{};let v=s.verStr||Hn,w=s.verSearch||o;if(w instanceof Array||(w=[w]),-1!=(s.str||Hn).indexOf(s.search||o)){n=o;for(let b of w){let I=v.indexOf(b);if(-1!=I){i=parseFloat(v.substring(I+b.length+1));break}}break}}for(let o in e){const s=e[o]||{};if(-1!=(s.str||Hn).indexOf(s.search||o)){r=o;break}}"Linux"==r&&-1!=Hn.indexOf("Windows NT")&&(r="HarmonyOS"),Dt={browser:n,version:i,OS:r}}ei&&(Dt={browser:"ssr",version:0,OS:"ssr"});const Ix=typeof WebAssembly<"u"&&Hn&&!(/Safari/.test(Hn)&&!/Chrome/.test(Hn)&&/\(.+\s11_2_([2-6]).*\)/.test(Hn)),Tx=!(typeof Worker>"u"),R_=!(!Zs||!Zs.getUserMedia),xx=function(){var t=ne(function*(){let e=!1;if(R_)try{(yield Zs.getUserMedia({video:!0})).getTracks().forEach(n=>{n.stop()}),e=!0}catch{}return e});return function(){return t.apply(this,arguments)}}(),Ax=(()=>{if(!ei&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let n=t.indexOf("#");-1!=n&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),ao=" is not allowed to change after `createInstance` or `loadWasm` is called.",Mx=!ei&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Ox=!ei&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",F_=t=>{if(null==t)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!ei){let n=document.createElement("a");n.href=t[e],t[e]=n.href}t[e].endsWith("/")||(t[e]+="/")}}return t};var Ze,Ks,_u,zt,sr,t;(t=Ze||(Ze={}))[t.IPF_Binary=0]="IPF_Binary",t[t.IPF_BinaryInverted=1]="IPF_BinaryInverted",t[t.IPF_GrayScaled=2]="IPF_GrayScaled",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",function(t){t[t.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",t[t.DBR_SUCCESS=0]="DBR_SUCCESS",t[t.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",t[t.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",t[t.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",t[t.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",t[t.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",t[t.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",t[t.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",t[t.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",t[t.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",t[t.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",t[t.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",t[t.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",t[t.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",t[t.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",t[t.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",t[t.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",t[t.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",t[t.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",t[t.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",t[t.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",t[t.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",t[t.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",t[t.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",t[t.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",t[t.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",t[t.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",t[t.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",t[t.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",t[t.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",t[t.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",t[t.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",t[t.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",t[t.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",t[t.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",t[t.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",t[t.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",t[t.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",t[t.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",t[t.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",t[t.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",t[t.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",t[t.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",t[t.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",t[t.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",t[t.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",t[t.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",t[t.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",t[t.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",t[t.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",t[t.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",t[t.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",t[t.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",t[t.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",t[t.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",t[t.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",t[t.DBR_PANORAMA_LICENSE_INVALID=-10060]="DBR_PANORAMA_LICENSE_INVALID",t[t.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",t[t.DBR_PHARMACODE_LICENSE_INVALID=-10062]="DBR_PHARMACODE_LICENSE_INVALID",t[t.DBR_IMAGE_ORIENTATION_INVALID=-10063]="DBR_IMAGE_ORIENTATION_INVALID",t[t.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",t[t.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",t[t.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",t[t.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS"}(Ks||(Ks={})),function(t){t[t.IMRDT_IMAGE=1]="IMRDT_IMAGE",t[t.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",t[t.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",t[t.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",t[t.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",t[t.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL"}(_u||(_u={})),function(t){t[t.BF_ALL=-29360129]="BF_ALL",t[t.BF_ONED=3147775]="BF_ONED",t[t.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",t[t.BF_CODE_39=1]="BF_CODE_39",t[t.BF_CODE_128=2]="BF_CODE_128",t[t.BF_CODE_93=4]="BF_CODE_93",t[t.BF_CODABAR=8]="BF_CODABAR",t[t.BF_ITF=16]="BF_ITF",t[t.BF_EAN_13=32]="BF_EAN_13",t[t.BF_EAN_8=64]="BF_EAN_8",t[t.BF_UPC_A=128]="BF_UPC_A",t[t.BF_UPC_E=256]="BF_UPC_E",t[t.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",t[t.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",t[t.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",t[t.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",t[t.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",t[t.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",t[t.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",t[t.BF_PATCHCODE=262144]="BF_PATCHCODE",t[t.BF_PDF417=33554432]="BF_PDF417",t[t.BF_QR_CODE=67108864]="BF_QR_CODE",t[t.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",t[t.BF_AZTEC=268435456]="BF_AZTEC",t[t.BF_MAXICODE=536870912]="BF_MAXICODE",t[t.BF_MICRO_QR=1073741824]="BF_MICRO_QR",t[t.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",t[t.BF_GS1_COMPOSITE=-2147483648]="BF_GS1_COMPOSITE",t[t.BF_MSI_CODE=1048576]="BF_MSI_CODE",t[t.BF_CODE_11=2097152]="BF_CODE_11",t[t.BF_NULL=0]="BF_NULL"}(zt||(zt={})),function(t){t[t.IRT_NO_RESULT=0]="IRT_NO_RESULT",t[t.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",t[t.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",t[t.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",t[t.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",t[t.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",t[t.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",t[t.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",t[t.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",t[t.IRT_CONTOUR=256]="IRT_CONTOUR",t[t.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",t[t.IRT_FORM=1024]="IRT_FORM",t[t.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",t[t.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",t[t.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL"}(sr||(sr={}));const P_=t=>t&&"object"==typeof t&&"function"==typeof t.then;class L_ extends Promise{constructor(e){let n,i;super((r,o)=>{n=r,i=o}),this._s="pending",this.resolve=r=>{this.isPending&&(P_(r)?this.task=r:(this._s="fulfilled",n(r)))},this.reject=r=>{this.isPending&&(this._s="rejected",i(r))},this.task=e}get status(){return this._s}get isPending(){return"pending"===this._s}get isFulfilled(){return"fulfilled"===this._s}get isRejected(){return"rejected"===this._s}get task(){return this._task}set task(e){var n=this;let i;this._task=e,P_(e)?i=e:"function"==typeof e&&(i=new Promise(e)),i&&ne(function*(){try{const r=yield i;e===n._task&&n.resolve(r)}catch(r){e===n._task&&n.reject(r)}})()}get isEmpty(){return null==this._task}}const vu=["iPhone","iPad","Android","HarmonyOS"].includes(Dt.OS)?2048:4096;class B{constructor(){this._instanceID=void 0,this._ifSaveOriginalImageInACanvas=!1,this.oriCanvas=null,this.oriCanvasData=null,this.canvas=null,this.bFilterRegionInJs=!1,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0,this.intervalTime=0,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this._arrPolygons=[],this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.captureAndDecodeInParallel=!0,this.autoSuggestTip=!1,this.suggestTipFrameArray=[],this.suggestTipFrameLimit=[5,3],this.noIntermediateResultsCount=0,this.noIntermediateResultsTipLimit=100,this.tinyBarcodeTipModuleSizeLimit=3,this.hugeBarcodeTipLimit=.9,this.autoZoomInFrameArray=[],this.autoZoomInFrameLimit=[5,3],this.autoZoomInStepRate=1/3,this.autoZoomInMaxStep=1.5,this.autoZoomInMaxTimes=5,this.autoZoomInMinStep=Math.pow(10,1/this.autoZoomInMaxTimes),this.autoZoomInIdealModuleSize=6,this.autoZoomOutFrameCount=0,this.autoZoomOutFrameLimit=3,this.autoZoomOutStepRate=1/3,this.autoZoomOutMinValue=1,this.autoZoomOutMinStep=2,this.autoZoomOutStepRate_2=.05,this.autoZoomOutMinValue_2=2,this.frameArrayInIdealZoom=[],this.frameLimitInIdealZoom=[5,3],this.enableZoomOutInIdealZoom=!1,this.nextActionInIdealZoom="focus",this.autoFocusFrameArray=[],this.autoFocusFrameLimit=[5,3],this.autoZoomIdealArea=[0,.05],this.autoZoomTargetBorder=.9,this.autoZoomDetectionArea=.5,this.autoZoom=!1,this.autoFocus=!1,this._resultHighlightingDuration=-1,this._dce=null,this._imgSource=null,this._maxCvsSideLength=vu,this._promiseStartScan=null,this.beepSound=new $s({src:[this._soundSource],onplayerror:(e,n)=>{console.warn(`Sound '${e}' playback failure: ${n}`)}})}static get version(){return this._version}static get license(){return this._license}static set license(e){((n,i)=>{const r=n;if(!r._pLoad.isEmpty)throw new Error("`license`"+ao);r._license=i})(B,e)}static get productKeys(){return this._license}static set productKeys(e){B.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){B.license=e}static get organizationID(){return this._license}static set organizationID(e){B.license=e}static set sessionPassword(e){((n,i)=>{const r=n;if(!r._pLoad.isEmpty)throw new Error("`sessionPassword`"+ao);r._sessionPassword=i})(B,e)}static get sessionPassword(){return this._sessionPassword}static detectEnvironment(){return ne(function*(){return yield ne(function*(){return{wasm:Ix,worker:Tx,getUserMedia:R_,camera:yield xx(),browser:Dt.browser,version:Dt.version,OS:Dt.OS}})()})()}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");B._engineResourcePath=(n=>{if(null==n&&(n="./"),!ei){let i=document.createElement("a");i.href=n,n=i.href}return n.endsWith("/")||(n+="/"),n})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((n,i)=>{const r=n;if(!r._pLoad.isEmpty)throw new Error("`licenseServer`"+ao);r._licenseServer=F_(i)})(B,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((n,i)=>{const r=n;if(!r._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+ao);r._deviceFriendlyName=i||""})(B,e)}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if(!this._pLoad.isEmpty)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");B.__bUseFullFeature=e}static isImageSource(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"getImage"in e}static isDSImage(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"data"in e&&"width"in e&&"height"in e&&"pixelFormat"in e}static isDCEFrame(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e,this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}static isWasmLoaded(){return this._pLoad.isFulfilled}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static get defaultUIElementURL(){var e;return null===(e=B._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",B.engineResourcePath)}static set defaultUIElementURL(e){B._defaultUIElementURL=e}static _fireHTTPSWarnning(){B.onWarning&&location&&"https:"!==location.protocol&&setTimeout(()=>{B.onWarning&&B.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}get soundSource(){return this._soundSource}set soundSource(e){this._soundSource=e,this.beepSound=new $s({src:[this._soundSource],onplayerror:(n,i)=>{console.warn(`Sound '${n}' playback failure: ${i}`)}})}get whenToPlaySoundforSuccessfulRead(){return!0===this.bPlaySoundOnSuccessfulRead?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead="never"!==e&&e}get whenToVibrateforSuccessfulRead(){return!0===this.bVibrateOnSuccessfulRead?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead="never"!==e&&e}set dce(e){this._dce=e}get dce(){return!this._dce||this._dce.isDisposed||this._dce.disposed?null:this._dce}set maxCvsSideLength(e){this._maxCvsSideLength=e,this._dceControler&&this._dceControler.setDisiredValue(this,"maxCvsSideLength",e)}get maxCvsSideLength(){return this._maxCvsSideLength}_registerDCEControler(){var e=this;return ne(function*(){if(!e.dce)return;B._onLog&&B._onLog("_registerDCEControler()");const n=e.dce;e._dceControler=n._createControler();const i=e._dceControler;i.register(e),i.setDisiredValue(e,"refreshInterval",200),i.setDisiredValue(e,"maxCvsSideLength",e._maxCvsSideLength),e._styleIdBeforeVerification=e.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"});const r=n.getUIElement(),o=e.dce.constructor;if("@engineResourcePath/dce.ui.html"===o._defaultUIElementURL)try{r?r===i._innerSetUI&&(yield n.setUIElement(`${o.engineResourcePath}dce.ui.html`),i._innerSetUI=n.getUIElement()):(yield n.setUIElement(`${o.engineResourcePath}dbr.ui.html`),i._innerSetUI=n.getUIElement())}catch{yield n.setUIElement(o.defaultUIElementURL)}else r||(yield n.setUIElement(o.defaultUIElementURL));e.callbackCameraChange=()=>{e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null),e.array_decodeFrameTimeCost.length=0,e.array_getFrameTimeCost.length=0,e._intervalGetVideoFrame=0},e.callbackResolutionChange=()=>{e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null),e.array_decodeFrameTimeCost.length=0,e.array_getFrameTimeCost.length=0,e._intervalGetVideoFrame=0},e.callbackCameraClose=()=>{e.stopScanning(!0),e.array_decodeFrameTimeCost.length=0,e.array_getFrameTimeCost.length=0,e._intervalGetVideoFrame=0,e._bPauseScan=!1},e.callbackSingleFrameAcquired=function(){var s=ne(function*(u){e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null);let g=yield e._decode_DCEFrame(u,{bCopyData:!1}),v=null;if(g&&g.length){const{sx:w,sy:b,width:I,height:x,_sWidth:O,_sHeight:R}=u;v=g.map(P=>({localizationResult:JSON.parse(JSON.stringify(P.localizationResult))})),B.recalculateResultLocation(v,w,b,O,R,I,x)}if(e._drawResults(v,g),yield e.clearMapDecodeRecord(),e.onImageRead&&e.dce.isOpen()&&!e._bPauseScan){let w=e._cloneDecodeResults(g);e.onImageRead(w)}if(e.onUniqueRead&&e.dce.isOpen()&&!e._bPauseScan)for(let w of g)e.onUniqueRead(w.barcodeText,e._cloneDecodeResults(w))});return function(u){return s.apply(this,arguments)}}(),n.on("cameraChange",e.callbackCameraChange),n.on("resolutionChange",e.callbackResolutionChange),n.on("cameraClose",e.callbackCameraClose),n.on("singleFrameAcquired",e.callbackSingleFrameAcquired)})()}_logoutDCEControler(){this.dce&&this._dceControler&&(B._onLog&&B._onLog("_logoutDCEControler()"),this._dceControler.logout(this),this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this._dceControler=null,this.dce=null)}setImageSource(e,n){var i=this;return ne(function*(){if(null==e)return i._imgSource=null,i._logoutDCEControler(),void(i._drawingItemNamespace=null);if(e&&e.isCameraEnhancer)i.dce=e,yield i._registerDCEControler(),i._imgSource=null;else{if(!B.isImageSource(e))throw new Error("Invalid value.");i._logoutDCEControler(),i._imgSource=e}n&&n.resultsHighlightBaseShapes&&(i._drawingItemNamespace=n.resultsHighlightBaseShapes)})()}static loadWasm(){var e=this;return ne(function*(){if(e._pLoad.isEmpty){let{lt:n,l:i,ls:r,sp:o,rmk:s}=(u=>{const g=u;if(g._pLoad.isEmpty){let v,w,b=g._license||"",I=JSON.parse(JSON.stringify(g._licenseServer)),x=g._sessionPassword,O=0;if(b.startsWith("t")||b.startsWith("f"))O=0;else if(0===b.length||b.startsWith("P")||b.startsWith("L")||b.startsWith("Y")||b.startsWith("A"))O=1;else{O=2;const R=b.indexOf(":");if(-1!=R&&(b=b.substring(R+1)),b.startsWith("DLS2")){let P;try{let V=b.substring(4);V=atob(V),P=JSON.parse(V)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(b=P.handshakeCode?P.handshakeCode:P.organizationID?P.organizationID:"","number"==typeof b&&(b=JSON.stringify(b)),0===I.length){let V=[];P.mainServerURL&&(V[0]=P.mainServerURL),P.standbyServerURL&&(V[1]=P.standbyServerURL),I=F_(V)}!x&&P.sessionPassword&&(x=P.sessionPassword),v=P.remark}("200001"===b||b.startsWith("200001-"))&&(I&&I.length||(b="")),b||(O=1)}if(O&&(O_.crypto||(w="Please upgrade your browser to support online key."),O_.crypto.subtle||(w="Require https to use online key in this browser.")),w){if(1!==O)throw new Error(w);O=0,console.warn(w),g._lastErrorCode=-1,g._lastErrorString=w}return 1===O&&(b="",console.warn("Applying for a public trial license ...")),{lt:O,l:b,ls:I,sp:x,rmk:v}}throw new Error("Can't preprocess license again"+ao)})(B);e._pLoad.task=function(){var u=ne(function*(g,v){let w=B.engineResourcePath+B._workerName;B.engineResourcePath.startsWith(location.origin)||(w=yield fetch(w).then(b=>b.blob()).then(b=>URL.createObjectURL(b))),B._dbrWorker=new Worker(w),B._dbrWorker.onerror=b=>{let I=new Error(b.message);v(I)},B._dbrWorker.onmessage=function(){var b=ne(function*(I){let x=I.data?I.data:I;switch(x.type){case"log":B._onLog&&B._onLog(x.message);break;case"load":{x.message&&(x.message=x.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let O,R=!1;1===n&&(R=!0,x.message||(x.message="Using a temporary license. [Register for a 30-day trial license >>>](https://www.dynamsoft.com/customer/license/trialLicense?product=dbr&deploymenttype=browser)")),x.success?(B._dbrWorker.onerror=null,B._version=x.version+"(JS "+B._jsVersion+"."+B._jsEditVersion+")",B._onLog&&B._onLog("load dbr worker success"),x.message&&console.warn(x.message)):(O=new Error(x.message),O.stack=x.stack+"\n"+O.stack,O.ltsErrorCode=x.ltsErrorCode,R||111==x.ltsErrorCode&&-1!=x.message.toLowerCase().indexOf("trial license")&&(R=!0)),R&&B.showDialog(x.success?"warn":"error",x.message),x.success?g():v(O);break}case"task":{let O=x.id,R=x.body;try{B._taskCallbackMap.get(O)(R),B._taskCallbackMap.delete(O)}catch(P){throw B._taskCallbackMap.delete(O),P}break}default:B._onLog&&B._onLog(I)}});return function(I){return b.apply(this,arguments)}}(),B._dbrWorker.postMessage({type:"loadWasm",engineResourcePath:B.engineResourcePath,bUseFullFeature:B._bUseFullFeature,bd:B._bWasmDebug,v:B._jsVersion,brtk:!!n,bptk:1===n,l:i,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:Dt,cv:B.authCacheVersion,fn:B.deviceFriendlyName,ls:r,sp:o,rmk:s})});return function(g,v){return u.apply(this,arguments)}}()}yield e._pLoad})()}static showDialog(e,n){var i=this;return ne(function*(){var r;yield(r=ne(function*(o,s,u){if(!o._bNeverShowDialog)try{let g=yield fetch(o.engineResourcePath+"dls.license.dialog.html");if(!g.ok)throw Error("Get license dialog fail. Network Error: "+g.statusText);let v=yield g.text();if(!v.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let w=document.createElement("div");w.innerHTML=v;let b=[];for(let X=0;X<w.childElementCount;++X){let ee=w.children[X];ee instanceof HTMLStyleElement&&(b.push(ee),document.head.append(ee))}let I=1==w.childElementCount?w.children[0]:w;I.remove();let x,O,R,P,V,W=[I],L=I.children;for(let X of L)W.push(X);for(let X=0;X<W.length;++X)for(let ee of W[X].children)W.push(ee);for(let X of W)if(!x&&X.classList.contains("dls-license-mask"))x=X,X.addEventListener("click",ee=>{if(X==ee.target){I.remove();for(let le of b)le.remove()}});else if(!O&&X.classList.contains("dls-license-icon-close"))O=X,X.addEventListener("click",()=>{I.remove();for(let ee of b)ee.remove()});else if(!R&&X.classList.contains("dls-license-icon-error"))R=X,"error"!=s&&X.remove();else if(!P&&X.classList.contains("dls-license-icon-warn"))P=X,"warn"!=s&&X.remove();else if(!V&&X.classList.contains("dls-license-msg-content")){V=X;let ee=u;for(;ee;){let le=ee.indexOf("["),ye=ee.indexOf("]",le),S=ee.indexOf("(",ye),pe=ee.indexOf(")",S);if(-1==le||-1==ye||-1==S||-1==pe){X.appendChild(new Text(ee));break}le>0&&X.appendChild(new Text(ee.substring(0,le)));let be=document.createElement("a"),Qe=ee.substring(le+1,ye);be.innerText=Qe;let h=ee.substring(S+1,pe);be.setAttribute("href",h),be.setAttribute("target","_blank"),X.appendChild(be),ee=ee.substring(pe+1)}}document.body.appendChild(I)}catch(g){o._onLog&&o._onLog(g.message||g)}}),function(o,s,u){return r.apply(this,arguments)})(i,e,n)})()}static createInstanceInWorker(e=!1){return ne(function*(){return yield B.loadWasm(),yield new Promise((n,i)=>{let r=B._nextTaskID++;B._taskCallbackMap.set(r,o=>{if(o.success)return n(o.instanceID);{let s=new Error(o.message);return s.stack=o.stack+"\n"+s.stack,i(s)}}),B._dbrWorker.postMessage({type:"createInstance",id:r,bScanner:e})})})()}static createInstance(){return ne(function*(){const e=new B;return e._instanceID=yield B.createInstanceInWorker(),B._fireHTTPSWarnning(),e})()}clearMapDecodeRecord(){var e=this;return ne(function*(){return yield new Promise((n,i)=>{let r=B._nextTaskID++;B._taskCallbackMap.set(r,o=>{if(o.success)return n();{let s=new Error(o.message);return s.stack=o.stack+"\n"+s.stack,i(s)}}),B._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:r,instanceID:e._instanceID})})})()}decode(e){var n=this;return ne(function*(){B._onLog&&B._onLog("decode(source: any)"),B._onLog&&(n._timeStartDecode=Date.now());{let i={};return!n.region||n.region instanceof Array||(i.region=JSON.parse(JSON.stringify(n.region))),e instanceof Blob?yield n._decode_Blob(e,i):e instanceof ArrayBuffer?yield n._decode_ArrayBuffer(e,i):e instanceof Uint8Array||e instanceof Uint8ClampedArray?yield n._decode_Uint8Array(e,i):e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?yield n._decode_Image(e,i):e instanceof HTMLCanvasElement?yield n._decode_Canvas(e,i):e instanceof HTMLVideoElement?yield n._decode_Video(e,i):"string"==typeof e?"data:image/"==e.substring(0,11)?yield n._decode_Base64(e,i):yield n._decode_Url(e,i):B.isDCEFrame(e)?(i.bCopyData=!0,yield n._decode_DCEFrame(e,i)):B.isDSImage(e)?(i.bCopyData=!0,yield n._decode_DSImage(e,i)):yield Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}})()}decodeBase64String(e){var n=this;return ne(function*(){let i={};return!n.region||n.region instanceof Array||(i.region=JSON.parse(JSON.stringify(n.region))),n._decode_Base64(e,i)})()}decodeUrl(e){var n=this;return ne(function*(){let i={};return!n.region||n.region instanceof Array||(i.region=JSON.parse(JSON.stringify(n.region))),n._decode_Url(e,i)})()}_decodeBuffer_Uint8Array(e,n,i,r,o,s,u){var g=this;return ne(function*(){return yield new Promise((v,w)=>{let b=B._nextTaskID++;B._taskCallbackMap.set(b,I=>{if(I.success){let x,O=B._onLog?Date.now():0;B._onLog&&B._onLog("worker return result: "+O),g._lastInnerDecodeDuration=I.duration;try{x=g._handleRetJsonString(I.decodeReturn)}catch(R){return w(R)}if(B._onLog){let R=Date.now();B._onLog("DBR getting message from worker timestamp: "+O),B._onLog("From DBR staring decoding to entering worker costs: "+(g._timeEnterInnerDBR-g._timeStartDecode)),B._onLog("From DBR entering worker to returning message from worker costs: "+(O-g._timeEnterInnerDBR)),B._onLog("Handling results from DBR worker costs: "+(R-O)),B._onLog("Total decoding image costs: "+(R-g._timeStartDecode))}return v(x)}{let x=new Error(I.message);return x.stack=I.stack+"\n"+x.stack,w(x)}}),g._timeEnterInnerDBR=Date.now(),B._onLog&&B._onLog("Sending buffer to worker timestamp:"+g._timeEnterInnerDBR),B._dbrWorker.postMessage({type:"decodeBuffer",id:b,instanceID:g._instanceID,body:{buffer:e,width:n,height:i,stride:r,format:o,orientation:s,config:u}},[e.buffer]),B._onLog&&u&&u.timeStamp&&B._onLog("Delay of decoding image: "+(g._timeEnterInnerDBR-u.timeStamp))})})()}_decodeBuffer_Blob(e,n,i,r,o,s,u){var g=this;return ne(function*(){B._onLog&&B._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const v=e.arrayBuffer?yield e.arrayBuffer():yield new Promise((w,b)=>{let I=new FileReader;I.readAsArrayBuffer(e),I.onload=()=>{w(I.result)},I.onerror=()=>{b(I.error)}});return yield g._decodeBuffer_Uint8Array(new Uint8Array(v),n,i,r,o,s,u)})()}decodeBuffer(e,n,i,r,o,s,u){var g=this;return ne(function*(){let v;return B._onLog&&B._onLog("decodeBuffer(buffer,width,height,stride,format)"),B._onLog&&(g._timeStartDecode=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?v=yield g._decodeBuffer_Uint8Array(e,n,i,r,o,s,u):e instanceof ArrayBuffer?v=yield g._decodeBuffer_Uint8Array(new Uint8Array(e),n,i,r,o,s,u):e instanceof Blob&&(v=yield g._decodeBuffer_Blob(e,n,i,r,o,s,u)),v})()}_decodeFileInMemory_Uint8Array(e){var n=this;return ne(function*(){return yield new Promise((i,r)=>{let o=B._nextTaskID++;B._taskCallbackMap.set(o,s=>{if(s.success){let u;n._lastInnerDecodeDuration=s.duration;try{u=n._handleRetJsonString(s.decodeReturn)}catch(g){return r(g)}return i(u)}{let u=new Error(s.message);return u.stack=s.stack+"\n"+u.stack,r(u)}}),B._dbrWorker.postMessage({type:"decodeFileInMemory",id:o,instanceID:n._instanceID,body:{bytes:e}})})})()}getRuntimeSettings(){var e=this;return ne(function*(){return yield new Promise((n,i)=>{let r=B._nextTaskID++;B._taskCallbackMap.set(r,o=>{if(o.success){let s=JSON.parse(o.results);return null!=e.userDefinedRegion&&(s.region=JSON.parse(JSON.stringify(e.userDefinedRegion))),n(s)}{let s=new Error(o.message);return s.stack=o.stack+"\n"+s.stack,i(s)}}),B._dbrWorker.postMessage({type:"getRuntimeSettings",id:r,instanceID:e._instanceID})})})()}updateRuntimeSettings(e){var n=this;return ne(function*(){let i;if("string"==typeof e)if("speed"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,i.region=r.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0]}else if("balance"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,i.region=r.region,i.deblurLevel=5,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0]}else if("coverage"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,i.region=r.region}else if("dense"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),n.maxCvsSideLength=4096,i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,i.region=r.region,i.deblurLevel=9,i.expectedBarcodesCount=0,i.localizationModes=[2,8,0,0,0,0,0,0]}else if("distance"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),n.maxCvsSideLength=4096,i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,i.region=r.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,8,0,0,0,0,0,0]}else i=JSON.parse(e);else{if("object"!=typeof e)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(e)),i.region instanceof Array){let r=i.region;[r.regionLeft,r.regionTop,r.regionLeft,r.regionBottom,r.regionMeasuredByPercentage].some(o=>void 0!==o)&&(i.region={regionLeft:r.regionLeft||0,regionTop:r.regionTop||0,regionRight:r.regionRight||0,regionBottom:r.regionBottom||0,regionMeasuredByPercentage:r.regionMeasuredByPercentage||0})}}if(!B._bUseFullFeature){if(i.barcodeFormatIds&~(zt.BF_ONED|zt.BF_QR_CODE|zt.BF_PDF417|zt.BF_DATAMATRIX)||0!=i.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=i.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(n.bFilterRegionInJs){let r=i.region;if(r instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");n.userDefinedRegion=JSON.parse(JSON.stringify(r)),n.region=(r.regionLeft||r.regionTop||r.regionRight||r.regionBottom||r.regionMeasuredByPercentage)&&(r.regionLeft||r.regionTop||100!=r.regionRight||100!=r.regionBottom||!r.regionMeasuredByPercentage)?r:null,i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else n.userDefinedRegion=null,n.region=null;return(n.autoZoom||n.autoFocus)&&(i.intermediateResultTypes|=sr.IRT_TYPED_BARCODE_ZONE),yield new Promise((r,o)=>{let s=B._nextTaskID++;B._taskCallbackMap.set(s,u=>{if(u.success){try{n._handleRetJsonString(u.updateReturn)}catch(g){o(g)}return r()}{let g=new Error(u.message);return g.stack=u.stack+"\n"+g.stack,o(g)}}),B._dbrWorker.postMessage({type:"updateRuntimeSettings",id:s,instanceID:n._instanceID,body:{settings:JSON.stringify(i)}})})})()}resetRuntimeSettings(){var e=this;return ne(function*(){return e.userDefinedRegion=null,e.region=null,e.maxCvsSideLength=vu,yield new Promise((n,i)=>{let r=B._nextTaskID++;B._taskCallbackMap.set(r,o=>{if(o.success)return n();{let s=new Error(o.message);return s.stack=o.stack+"\n"+s.stack,i(s)}}),B._dbrWorker.postMessage({type:"resetRuntimeSettings",id:r,instanceID:e._instanceID})})})()}_resetRuntimeSettingsToCppDefault(){var e=this;return ne(function*(){return e.userDefinedRegion=null,e.region=null,e.maxCvsSideLength=vu,yield new Promise((n,i)=>{let r=B._nextTaskID++;B._taskCallbackMap.set(r,o=>{if(o.success)return n();{let s=new Error(o.message);return s.stack=o.stack+"\n"+s.stack,i(s)}}),B._dbrWorker.postMessage({type:"resetRuntimeSettingsToCppDefault",id:r,instanceID:e._instanceID})})})()}outputRuntimeSettingsToString(){var e=this;return ne(function*(){if(!B._bUseFullFeature)throw Error("outputRuntimeSettingsToString() is not supported in the compact version. Please try the full-featured version.");return yield new Promise((n,i)=>{let r=B._nextTaskID++;B._taskCallbackMap.set(r,o=>{if(o.success)return n(o.results);{let s=new Error(o.message);return s.stack=o.stack+"\n"+s.stack,i(s)}}),B._dbrWorker.postMessage({type:"outputRuntimeSettingsToString",id:r,instanceID:e._instanceID})})})()}initRuntimeSettingsWithString(e){var n=this;return ne(function*(){if(!B._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if("string"==typeof e);else{if("object"!=typeof e)throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return yield new Promise((i,r)=>{let o=B._nextTaskID++;B._taskCallbackMap.set(o,s=>{if(s.success){try{n._handleRetJsonString(s.initReturn)}catch(u){r(u)}return i()}{let u=new Error(s.message);return u.stack=s.stack+"\n"+u.stack,r(u)}}),B._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:o,instanceID:n._instanceID,body:{settings:e}})})})()}_decode_Blob(e,n){var i=this;return ne(function*(){B._onLog&&B._onLog("_decode_Blob(blob: Blob)");let r=null,o=null;if(typeof createImageBitmap<"u")try{r=yield createImageBitmap(e)}catch{}var u;r||(o=yield(u=e,new Promise((g,v)=>{let w=URL.createObjectURL(u),b=new Image;b.dbrObjUrl=w,b.src=w,b.onload=()=>{g(b)},b.onerror=I=>{v(new Error("Can't convert blob to image : "+(I instanceof Event?I.type:I)))}})));let s=yield i._decode_Image(r||o,n);return r&&r.close(),s})()}_decode_ArrayBuffer(e,n){var i=this;return ne(function*(){return yield i._decode_Blob(new Blob([e]),n)})()}_decode_Uint8Array(e,n){var i=this;return ne(function*(){return yield i._decode_Blob(new Blob([e]),n)})()}_decode_Image(e,n){var i=this;return ne(function*(){B._onLog&&B._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),n=n||{};let r,o,s=e instanceof HTMLImageElement?e.naturalWidth:e.width,u=e instanceof HTMLImageElement?e.naturalHeight:e.height,g=Math.max(s,u);if(g>i._maxCvsSideLength){let b=i._maxCvsSideLength/g;r=Math.round(s*b),o=Math.round(u*b)}else r=s,o=u;i.canvas||(i.canvas=document.createElement("canvas"));const v=i.canvas;v.width===r&&v.height===o||(v.width=r,v.height=o),v.ctx2d||(v.ctx2d=v.getContext("2d",{willReadFrequently:!0})),v.ctx2d.drawImage(e,0,0,s,u,0,0,r,o),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl);let w=yield i._decode_Canvas(v,n);if(i.ifSaveOriginalImageInACanvas){const b=document.createElement("canvas");b.width=e.width,b.height=e.height,b.getContext("2d").drawImage(e,0,0),i.oriCanvas=b,i.oriCanvasData=null}return B.recalculateResultLocation(w,0,0,s,u,r,o),w})()}_decode_Canvas(e,n){var i=this;return ne(function*(){if(B._onLog&&B._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";if(0===e.width||0===e.height)throw Error("The width or height of the 'canvas' is 0.");i.ifSaveOriginalImageInACanvas&&(i.oriCanvas=e,i.oriCanvasData=null);let r=(e.ctx2d||e.getContext("2d",{willReadFrequently:!0})).getImageData(0,0,e.width,e.height).data;return yield i._decodeBuffer_Uint8Array(r,e.width,e.height,4*e.width,Ze.IPF_ABGR_8888,0,n)})()}_decode_Video(e,n){var i=this;return ne(function*(){if(B._onLog&&B._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";n=n||{};let r,o,s=e.videoWidth,u=e.videoHeight,g=Math.max(s,u);if(g>i._maxCvsSideLength){let b=i._maxCvsSideLength/g;r=Math.round(s*b),o=Math.round(u*b)}else r=s,o=u;i.canvas||(i.canvas=document.createElement("canvas"));const v=i.canvas;v.width===r&&v.height===o||(v.width=r,v.height=o),v.ctx2d||(v.ctx2d=v.getContext("2d",{willReadFrequently:!0})),v.ctx2d.drawImage(e,0,0,s,u,0,0,r,o);let w=yield i._decode_Canvas(v,n);if(i.ifSaveOriginalImageInACanvas){const b=document.createElement("canvas");b.width=e.videoWidth,b.height=e.videoHeight,b.getContext("2d").drawImage(e,0,0),i.oriCanvas=b,i.oriCanvasData=null}return B.recalculateResultLocation(w,0,0,s,u,r,o),w})()}_decode_DCEFrame(e,n){var i=this;return ne(function*(){if(B._onLog&&B._onLog("_decode_DCEFrame(dceFrame)"),!B.isDCEFrame(e))return[];let r=[];i.ifSaveOriginalImageInACanvas&&(i.oriCanvas=null,i.oriCanvasData={width:e.width,height:e.height,colorMode:e.colorMode,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{width:o,height:s,colorMode:u,pixelFormat:g,stride:v,timeStamp:w}=e;let b;b=n&&n.bCopyData?new Uint8Array(e.data):e.data;let I=null;if(n?(I=JSON.parse(JSON.stringify(n)),I.timeStamp=w):I={timeStamp:w},g&&v)if("grey"===g)r=yield i._decodeBuffer_Uint8Array(b,o,s,v,Ze.IPF_GrayScaled,0,I);else if("rgba"===g)r=yield i._decodeBuffer_Uint8Array(b,o,s,v,Ze.IPF_ABGR_8888,0,I);else{if("bgra"!==g)throw new Error(`Pixel format '${g}' is not supported to decode.`);r=yield i._decodeBuffer_Uint8Array(b,o,s,v,Ze.IPF_ARGB_8888,0,I)}else if("grey"===u)r=yield i._decodeBuffer_Uint8Array(b,o,s,o,Ze.IPF_GrayScaled,0,I);else if("rgba"===u)r=yield i._decodeBuffer_Uint8Array(b,o,s,4*o,Ze.IPF_ABGR_8888,0,I);else{if("bgra"!==u)throw new Error(`Color mode '${u}' is not supported to decode.`);r=yield i._decodeBuffer_Uint8Array(b,o,s,4*o,Ze.IPF_ARGB_8888,0,I)}return r})()}_decode_DSImage(e,n){var i=this;return ne(function*(){if(B._onLog&&B._onLog("_decode_DSImage(dsImage)"),!B.isDSImage(e))return null;i.ifSaveOriginalImageInACanvas&&(i.oriCanvas=null,i.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat.toLowerCase(),data:new Uint8Array(e.data),toCanvas:function(){const w=document.createElement("canvas");let b;switch(w.width=this.width,w.height=this.height,this.pixelFormat){case"grey":b=new Uint8ClampedArray(this.width*this.height*4);for(let x=0;x<b.length;x+=4)b[x]=this.data[x/4],b[x+1]=this.data[x/4],b[x+2]=this.data[x/4],b[x+3]=255;break;case"rgb":b=new Uint8ClampedArray(this.width*this.height*4);for(let x=0;x<b.length;x+=4)b[x]=this.data[x],b[x+1]=this.data[x+1],b[x+2]=this.data[x+2],b[x+3]=255;break;case"bgr":b=new Uint8ClampedArray(this.width*this.height*4);for(let x=0;x<b.length;x+=4)b[x]=this.data[x],b[x+1]=this.data[x+1],b[x+2]=this.data[x+2],b[x+3]=255;break;case"rgba":case"bgra":b=new Uint8ClampedArray(this.data);break;default:throw new Error("The content of 2D Canvas is currently limited to the sRGB color space.")}const I=new ImageData(b,this.width,this.height);return w.getContext("2d").putImageData(I,0,0),w}});const{width:r,height:o}=e;let s,u,g,v=e.pixelFormat.toLowerCase();switch(s=n&&n.bCopyData?new Uint8Array(e.data):e.data,v){case"grey":g=Ze.IPF_GrayScaled,u=r;break;case"rgb":g=Ze.IPF_BGR_888,u=3*r;break;case"bgr":g=Ze.IPF_RGB_888,u=3*r;break;case"rgba":g=Ze.IPF_ABGR_8888,u=4*r;break;case"bgra":g=Ze.IPF_ARGB_8888,u=4*r;break;default:throw new Error("The pixel format is not supported to decode.")}return yield i._decodeBuffer_Uint8Array(s,r,o,u,g,0,n)})()}_decode_Base64(e,n){var i=this;return ne(function*(){if(B._onLog&&B._onLog("_decode_Base64(base64Str)"),"string"!=typeof e)return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");"data:image/"==e.substring(0,11)&&(e=e.substring(e.indexOf(",")+1));{let r=atob(e),o=r.length,s=new Uint8Array(o);for(;o--;)s[o]=r.charCodeAt(o);return yield i._decode_Blob(new Blob([s]),n)}})()}_decode_Url(e,n){var i=this;return ne(function*(){if(B._onLog&&B._onLog("_decode_Url(url)"),"string"!=typeof e)throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");{let r=yield new Promise((o,s)=>{let u=new XMLHttpRequest;u.open("GET",e,!0),u.responseType="blob",u.send(),u.onloadend=ne(function*(){o(u.response)}),u.onerror=()=>{s(new Error("Network Error: "+u.statusText))}});return yield i._decode_Blob(r,n)}})()}_decode_FilePath(e,n){return ne(function*(){throw B._onLog&&B._onLog("_decode_FilePath(path)"),Error("'_decode_FilePath(path, config)': The method is only supported in node environment.")})()}static recalculateResultLocation(e,n,i,r,o,s,u){if(e.length>0)for(let g of e){let v=g.localizationResult;2==v.resultCoordinateType&&(v.x1*=.01*s,v.x2*=.01*s,v.x3*=.01*s,v.x4*=.01*s,v.y1*=.01*u,v.y2*=.01*u,v.y3*=.01*u,v.y4*=.01*u);let w=s/r,b=u/o;v.x1=v.x1/w+n,v.x2=v.x2/w+n,v.x3=v.x3/w+n,v.x4=v.x4/w+n,v.y1=v.y1/b+i,v.y2=v.y2/b+i,v.y3=v.y3/b+i,v.y4=v.y4/b+i,2==v.resultCoordinateType&&(v.x1*=100/r,v.x2*=100/r,v.x3*=100/r,v.x4*=100/r,v.y1*=100/o,v.y2*=100/o,v.y3*=100/o,v.y4*=100/o),v.x1=Math.round(v.x1),v.x2=Math.round(v.x2),v.x3=Math.round(v.x3),v.x4=Math.round(v.x4),v.y1=Math.round(v.y1),v.y2=Math.round(v.y2),v.y3=Math.round(v.y3),v.y4=Math.round(v.y4)}}static BarcodeReaderException(e,n){let i,r=Ks.DBR_UNKNOWN;return"number"==typeof e?(r=e,i=new Error(n)):i=new Error(e),i.code=r,i}_handleRetJsonString(e){let n=Ks;if(e.textResults){for(let i=0;i<e.textResults.length;i++){let r=e.textResults[i];try{let o=r.barcodeText,s="";for(let u=0;u<o.length;u++)s+=String.fromCharCode(o[u]);try{r.barcodeText=decodeURIComponent(escape(s))}catch{r.barcodeText=s}}catch{r.barcodeText=""}if(null!=r.exception){B._setWarnnedEx.has(r.exception)||(B._setWarnnedEx.add(r.exception),console.warn(r.exception));let o={};r.exception.split(";").forEach(s=>{let u=s.indexOf(":");o[s.substring(0,u)]=s.substring(u+1)}),r.exception=o}}return this.decodeRecords=e.decodeRecords?e.decodeRecords:{},this._lastErrorCode=e.exception,this._lastErrorString=e.description,e.exception&&!B._setWarnnedEx.has(e.description)&&(B._setWarnnedEx.add(e.description),console.warn(e.description)),e.textResults}if(e.exception==n.DBR_SUCCESS)return e.data;throw B.BarcodeReaderException(e.exception,e.description)}setModeArgument(e,n,i,r){var o=this;return ne(function*(){return yield new Promise((s,u)=>{let g=B._nextTaskID++;B._taskCallbackMap.set(g,v=>{if(v.success){try{o._handleRetJsonString(v.setReturn)}catch(w){return u(w)}return s()}{let w=new Error(v.message);return w.stack=v.stack+"\n"+w.stack,u(w)}}),B._dbrWorker.postMessage({type:"setModeArgument",id:g,instanceID:o._instanceID,body:{modeName:e,index:n,argumentName:i,argumentValue:r}})})})()}getModeArgument(e,n,i){var r=this;return ne(function*(){return yield new Promise((o,s)=>{let u=B._nextTaskID++;B._taskCallbackMap.set(u,g=>{if(g.success){let v;try{v=r._handleRetJsonString(g.getReturn)}catch(w){return s(w)}return o(v)}{let v=new Error(g.message);return v.stack=g.stack+"\n"+v.stack,s(v)}}),B._dbrWorker.postMessage({type:"getModeArgument",id:u,instanceID:r._instanceID,body:{modeName:e,index:n,argumentName:i}})})})()}getIntermediateResults(){var e=this;return ne(function*(){return yield new Promise((n,i)=>{let r=B._nextTaskID++;B._taskCallbackMap.set(r,o=>{if(o.success)return n(o.results);{let s=new Error(o.message);return s.stack=o.stack+"\n"+s.stack,i(s)}}),B._dbrWorker.postMessage({type:"getIntermediateResults",id:r,instanceID:e._instanceID,body:{isCharge:!0}})})})()}getIntermediateCanvas(){var e=this;return ne(function*(){let n=yield e.getIntermediateResults(),i=[];for(let r of n)if(r.dataType==_u.IMRDT_IMAGE)for(let o of r.results){const s=o.bytes;let u;switch(B._onLog&&B._onLog(" "+s.length+" "+s.byteLength+" "+o.width+" "+o.height+" "+o.stride+" "+o.format),o.format){case Ze.IPF_ABGR_8888:u=new Uint8ClampedArray(s);break;case Ze.IPF_RGB_888:{const w=s.length/3;u=new Uint8ClampedArray(4*w);for(let b=0;b<w;++b)u[4*b]=s[3*b+2],u[4*b+1]=s[3*b+1],u[4*b+2]=s[3*b],u[4*b+3]=255;break}case Ze.IPF_GrayScaled:{const w=s.length;u=new Uint8ClampedArray(4*w);for(let b=0;b<w;b++)u[4*b]=u[4*b+1]=u[4*b+2]=s[b],u[4*b+3]=255;break}case Ze.IPF_Binary:case Ze.IPF_BinaryInverted:{const w=s.length,b=o.width,x=o.stride;u=new Uint8ClampedArray(b*o.height*4);for(let O=0;O<w;O++){let R=s[O],P=O%x*8,V=Math.floor(O/x);for(let W=0;W<8;W++){let L=P+W,X=4*(V*b+L);if(L>=b)break;u[X]=u[X+1]=u[X+2]=(128&R)/128*255,u[X+3]=255,R<<=1}}break}default:console.warn("unknow intermediate image",o)}if(!u)continue;let g=new ImageData(u,o.width,o.height),v=document.createElement("canvas");v.width=o.width,v.height=o.height,v.getContext("2d").putImageData(g,0,0),i.push(v)}return i})()}getScanSettings(){var e=this;return ne(function*(){return yield new Promise((n,i)=>{let r=B._nextTaskID++;B._taskCallbackMap.set(r,o=>{if(o.success){let s=o.results;return s.intervalTime=e.intervalTime,s.whenToPlaySoundforSuccessfulRead=e.whenToPlaySoundforSuccessfulRead,s.soundOnSuccessfullRead=e.soundSource,s.whenToVibrateforSuccessfulRead=e.whenToVibrateforSuccessfulRead,s.vibrateDuration=e.vibrateDuration,s.captureAndDecodeInParallel=e.captureAndDecodeInParallel,s.autoZoom=e.autoZoom,s.autoFocus=e.autoFocus,s.autoSuggestTip=e.autoSuggestTip,n(s)}{let s=new Error(o.message);return s.stack+="\n"+o.stack,i(s)}}),B._dbrWorker.postMessage({type:"getScanSettings",id:r,instanceID:e._instanceID})})})()}updateScanSettings(e){var n=this;return ne(function*(){if(!e)return;const i=JSON.parse(JSON.stringify(e));if(i.autoZoom||i.autoFocus||i.autoSuggestTip){if(!B._bUseFullFeature)throw new Error("'autoZoom', 'autoFocus' and 'autoSuggestTip' are not supported in the compact version. Please try the full-featured version.");const r=yield n.getRuntimeSettings();r.intermediateResultTypes|=sr.IRT_TYPED_BARCODE_ZONE,yield n.updateRuntimeSettings(r)}return i.hasOwnProperty("intervalTime")&&(n.intervalTime=Math.max(i.intervalTime,0),delete i.intervalTime),i.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(n.whenToPlaySoundforSuccessfulRead=i.whenToPlaySoundforSuccessfulRead,delete i.whenToPlaySoundforSuccessfulRead),i.hasOwnProperty("soundOnSuccessfullRead")&&(n.soundSource=i.soundOnSuccessfullRead,delete i.soundOnSuccessfullRead),i.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(n.whenToVibrateforSuccessfulRead=i.whenToVibrateforSuccessfulRead,delete i.whenToVibrateforSuccessfulRead),i.hasOwnProperty("vibrateDuration")&&(n.vibrateDuration=i.vibrateDuration,delete i.vibrateDuration),i.hasOwnProperty("captureAndDecodeInParallel")&&(n.captureAndDecodeInParallel=i.captureAndDecodeInParallel,delete i.captureAndDecodeInParallel),i.hasOwnProperty("autoZoom")&&(n.autoZoom&&n.autoZoom!=i.autoZoom&&n.dce&&n.dce.setZoom({factor:1}).catch(()=>{}),n.autoZoom=i.autoZoom,delete i.autoZoom),i.hasOwnProperty("autoFocus")&&(n.autoFocus=i.autoFocus,n.dce&&n.dce.setFocus({mode:"continuous"}).catch(()=>{}),delete i.autoFocus),i.hasOwnProperty("autoSuggestTip")&&(n.autoSuggestTip=i.autoSuggestTip,delete i.autoFocus),yield new Promise((r,o)=>{let s=B._nextTaskID++;B._taskCallbackMap.set(s,u=>{if(u.success)return r();{let g=new Error(u.message);return g.stack+="\n"+u.stack,o(g)}}),B._dbrWorker.postMessage({type:"updateScanSettings",id:s,instanceID:n._instanceID,body:{settings:i}})})})()}_cloneDecodeResults(e){if(e instanceof Array){let n=[];for(let i of e)n.push(this._cloneDecodeResults(i));return n}return JSON.parse(JSON.stringify(e,(r,o)=>"oriVideoCanvas"==r||"searchRegionCanvas"==r?void 0:o))}_loopReadVideo(){var e=this;return ne(function*(){if(e.bDestroyed)return e.dce&&e._dceControler&&e._dceControler.setDisiredAction(e,"stopFetchingLoop"),e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),void e._drawResults(null);if(e.dce&&!e.dce.isOpen())return e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null),void(yield e.clearMapDecodeRecord());if(!e.dce&&!e._imgSource||e._bPauseScan)return B._onLog&&B._onLog("Scan is paused, or imageSource is not set. Ask in 1s."),yield e.clearMapDecodeRecord(),e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),void(e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},e._intervalDetectVideoPause));B._onLog&&B._onLog("======= once read ======="),B._onLog&&(e._timeStartDecode=Date.now());let n=null,i=null;if(e.dce)n=e._getVideoFrame();else if(e._imgSource&&(i=yield e._imgSource.getImage(),!B.isDSImage(i)))throw new Error("Invalid DSImage.");if(!n&&!i)return B._onLog&&B._onLog("Get invalid frame."),e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),void(e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},0));ne(function*(){let r=[];if(n){r=yield e._decode_DCEFrame(n,{bScanner:!0,bCopyData:!1});let o=null;if(r&&r.length){const{sx:s,sy:u,width:g,height:v,_sWidth:w,_sHeight:b}=n;o=r.map(I=>({resultState:I.resultState,localizationResult:JSON.parse(JSON.stringify(I.localizationResult))})),B.recalculateResultLocation(o,s,u,w,b,g,v)}0==e._resultHighlightingDuration?e._drawResults(null):e._drawResults(o,r),e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._resultHighlightingDuration>0&&(e._clearResultsCanvasTimeoutId=setTimeout(()=>{e.bDestroyed||e._drawResults(null)},e._resultHighlightingDuration))}else i&&(r=yield e._decode_DSImage(i,{bScanner:!0,bCopyData:!1}));return r})().then(r=>{if(B._onLog&&B._onLog(r),e.dce&&e.captureAndDecodeInParallel){let o=e.array_decodeFrameTimeCost,s=e.array_getFrameTimeCost;const u=()=>{let g=0;if(s&&s.length){let v=Math.min(...o),w=Math.max(...s);v&&w&&(g=v-w)}else g=0;return g>0?g:0};(()=>{for(;o.length>=5;)o.shift();o.push(e._lastInnerDecodeDuration)})(),e._intervalGetVideoFrame=u()+e.intervalTime}if((e.dce&&e.dce.isOpen()||e._imgSource)&&!e._bPauseScan){if(e.bPlaySoundOnSuccessfulRead&&r.length){let o=!1;!0===e.bPlaySoundOnSuccessfulRead||"frame"===e.bPlaySoundOnSuccessfulRead?o=r.some(s=>s.resultState>=0):"unique"===e.bPlaySoundOnSuccessfulRead&&(o=r.some(s=>0==s.resultState)),o&&e.beepSound&&(e.beepSound.stop(),e.beepSound.play())}if(navigator.vibrate&&e.bVibrateOnSuccessfulRead&&r.length){let o=!1;if(!0===e.bVibrateOnSuccessfulRead||"frame"===e.bVibrateOnSuccessfulRead?o=r.some(s=>s.resultState>=0):"unique"===e.bVibrateOnSuccessfulRead&&(o=r.some(s=>0==s.resultState)),o)try{navigator.vibrate(e.vibrateDuration)}catch(s){console.warn("Vibration not allowed. User interaction required: "+(s.message||s))}}if(e.onImageRead){r=r.filter(s=>s.resultState>=0);const o=e._cloneDecodeResults(r);e.onImageRead(o)}if(e.onUniqueRead){r=r.filter(s=>0==s.resultState);const o=e._cloneDecodeResults(r);for(let s of o)e.onUniqueRead(s.barcodeText,s)}}e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),e.intervalTime?e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},e.intervalTime):e._loopReadVideo()}).catch(r=>{e.dce&&e._dceControler&&e._dceControler.setDisiredAction(e,"stopFetchingLoop"),B._onLog&&B._onLog(r.message||r),e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),e._loopReadVideoTimeoutId=setTimeout(()=>{e.dce&&(e.dce.startFetchingLoop(),e._dceControler&&e._dceControler.clearUserDisiredAction({user:e,actionName:"stopFetchingLoop"})),e._loopReadVideo()},Math.max(e.intervalTime,1e3)),"platform error"==r.message||console.warn(r.message)})})()}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){if(B._onLog&&B._onLog("Get frame in parallel."),this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",this._intervalGetVideoFrame),!this.dce.numberOfFramesInBuffer)return this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",0),null;e=this.dce.getFrameFromBuffer(),(i=>{if(!i)return;let r=i.timeSpent,o=this.array_getFrameTimeCost;for(;o.length>=5;)o.shift();o.push(r)})(e)}else B._onLog&&B._onLog("Get frame in serial."),this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),e=this.dce.getFrame();return e}_drawResults(e,n){if(!this.dce||this.dce.disposed||this._bPauseScan||!this._drawingItemNamespace||!this._drawingItemNamespace.DT_Polygon)return;if(!this._dbrDrawingLayer){if(!this.dce.isOpen()||!(this.dce.singleFrameMode||this.dce.video&&this.dce._videoTrack))return;this._dbrDrawingLayer=this.dce.getDrawingLayer(3)}const i=this._dbrDrawingLayer;e||(e=[]);let r=this._arrPolygons;for(let o=0;o<e.length;o++){let s,u=e[o].localizationResult;r[o]?(s=r[o],i.hasDrawingItem(s)||i.addDrawingItem(s),s.set("vertices",[{x:u.x1,y:u.y1},{x:u.x2,y:u.y2},{x:u.x3,y:u.y3},{x:u.x4,y:u.y4}]),(s.set||s.setAttribute).call(s,"vertices",[{x:u.x1,y:u.y1},{x:u.x2,y:u.y2},{x:u.x3,y:u.y3},{x:u.x4,y:u.y4}])):(s=new this._drawingItemNamespace.DT_Polygon([{x:u.x1,y:u.y1},{x:u.x2,y:u.y2},{x:u.x3,y:u.y3},{x:u.x4,y:u.y4}]),i.addDrawingItem(s),r[o]=s),-1===e[o].resultState?(s.styleId=this._styleIdBeforeVerification,s._mapStyle.set("default",this.dce.getDrawingStyle(this._styleIdBeforeVerification)),s._mapStyle.set("selected",this.dce.getDrawingStyle(this._styleIdBeforeVerification))):(s.styleId=null,s._mapStyle.set("default",this.dce.getDrawingStyle(3)),s._mapStyle.set("selected",this.dce.getDrawingStyle(7))),s.addNote(n&&n[o]?{name:"Barcode_Result",content:n[o]}:{name:"Barcode_Result",content:e[o]},!0)}for(let o=e.length;o<r.length;o++)r[o].deleteNote("Barcode_Result"),i.removeDrawingItem(r[o]);i.renderAll()}startScanning(e){var n=this;return ne(function*(){if(!n.dce&&!n._imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");if(n._promiseStartScan&&n._promiseStartScan.isPending)return n._promiseStartScan;n._promiseStartScan=new L_;let i=null;if(n.dce){if(n.dce.isOpen())if(e&&n.dce.appendAndShowUI(),n.dce.playCallbackInfo)i=JSON.parse(JSON.stringify(n.dce.playCallbackInfo));else{const r=n.dce.getSelectedCamera();i={width:n.dce.video.videoWidth,height:n.dce.video.videoHeight,deviceId:r&&r.deviceId}}else if(i=yield n.dce.open(e),!n._promiseStartScan)return null;n._dceControler&&(n._dceControler.clearUserDisiredAction({user:n,actionName:"close"}),n._dceControler.setDisiredValue(n,"ifShowScanRegionLaser",!0),n.dce.ifShowScanRegionLaser&&n.dce.showScanRegionLaser())}return n._bPauseScan=!1,n.dce&&n.dce.singleFrameMode||(n._loopReadVideoTimeoutId&&clearTimeout(n._loopReadVideoTimeoutId),n._loopReadVideoTimeoutId=setTimeout(()=>{n.dce&&(n.dce.startFetchingLoop(),n._dceControler&&n._dceControler.clearUserDisiredAction({user:n,actionName:"stopFetchingLoop"})),n._loopReadVideo()},0)),n._promiseStartScan.resolve(i),i})()}stopScanning(e){this.dce&&(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"close",[e]))),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._promiseStartScan=null}pauseScanning(e){if(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce){if(this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"stopFetchingLoop"))}}resumeScanning(){if(this._bPauseScan=!1,this.dce){if(this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.startFetchingLoop(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}}destroyContext(){if(B._onLog&&B._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0,(this.dce||this._promiseStartScan)&&this.stopScanning(),this.setImageSource(null);let e=B._nextTaskID++;B._taskCallbackMap.set(e,n=>{if(!n.success){let i=new Error(n.message);throw i.stack=n.stack+"\n"+i.stack,i}}),B._dbrWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}B._jsVersion="9.6.32",B._jsEditVersion="20231027",B._version=`loading...(JS ${B._jsVersion}.${B._jsEditVersion})`,B._license=Mx,B._sessionPassword=Ox,B.browserInfo=Dt,B._workerName=`dbr-${B._jsVersion}.browser.worker.js`,B._engineResourcePath=Ax,B._licenseServer=[],B._deviceFriendlyName="",B._isShowRelDecodeTimeInResults=!1,B._bWasmDebug=!1,B._bNeverShowDialog=!1,B.__bUseFullFeature=!0,B._nextTaskID=0,B._taskCallbackMap=new Map,B._pLoad=new L_,B._lastErrorCode=0,B._lastErrorString="",B._setWarnnedEx=new Set,B._defaultUIElementURL="@engineResourcePath/dbr.ui.html";var Rx={653:(t,e,n)=>{var i,r,o,s,u,g,v,w,b,I,O,R,P,V,W,L,X,ee,le,ye,h,c,d,p,S=S||{version:"5.2.1"};if(e.fabric=S,typeof document<"u"&&typeof window<"u")S.document=document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?document:document.implementation.createHTMLDocument(""),S.window=window;else{var pe=new(n(192).JSDOM)(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;S.document=pe.document,S.jsdomImplForWrapper=n(898).implForWrapper,S.nodeCanvas=n(245).Canvas,S.window=pe,DOMParser=S.window.DOMParser}function be(h,c){var d=h.canvas,p=c.targetCanvas,a=p.getContext("2d");a.translate(0,p.height),a.scale(1,-1),a.drawImage(d,0,d.height-p.height,p.width,p.height,0,0,p.width,p.height)}function Qe(h,c){var d=c.targetCanvas.getContext("2d"),p=c.destinationWidth,a=c.destinationHeight,l=p*a*4,f=new Uint8Array(this.imageBuffer,0,l),y=new Uint8ClampedArray(this.imageBuffer,0,l);h.readPixels(0,0,p,a,h.RGBA,h.UNSIGNED_BYTE,f);var m=new ImageData(y,p,a);d.putImageData(m,0,0)}S.isTouchSupported="ontouchstart"in S.window||"ontouchstart"in S.document||S.window&&S.window.navigator&&S.window.navigator.maxTouchPoints>0,S.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",S.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],S.DPI=96,S.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",S.commaWsp="(?:\\s+,?\\s*|,\\s*)",S.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,S.reNonWord=/[ \n\.,;!\?\-]/,S.fontPaths={},S.iMatrix=[1,0,0,1,0,0],S.svgNS="http://www.w3.org/2000/svg",S.perfLimitSizeTotal=2097152,S.maxCacheSideLimit=4096,S.minCacheSideLimit=256,S.charWidthsCache={},S.textureSize=2048,S.disableStyleCopyPaste=!1,S.enableGLFiltering=!0,S.devicePixelRatio=S.window.devicePixelRatio||S.window.webkitDevicePixelRatio||S.window.mozDevicePixelRatio||1,S.browserShadowBlurConstant=1,S.arcToSegmentsCache={},S.boundsOfCurveCache={},S.cachesBoundsOfCurve=!0,S.forceGLPutImageData=!1,S.initFilterBackend=function(){return S.enableGLFiltering&&S.isWebglSupported&&S.isWebglSupported(S.textureSize)?(console.log("max texture size: "+S.maxTextureSize),new S.WebglFilterBackend({tileSize:S.textureSize})):S.Canvas2dFilterBackend?new S.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=S),function(){function h(d,p){if(this.__eventListeners[d]){var a=this.__eventListeners[d];p?a[a.indexOf(p)]=!1:S.util.array.fill(a,!1)}}function c(d,p){var a=function(){p.apply(this,arguments),this.off(d,a)}.bind(this);this.on(d,a)}S.Observable={fire:function(d,p){if(!this.__eventListeners)return this;var a=this.__eventListeners[d];if(!a)return this;for(var l=0,f=a.length;l<f;l++)a[l]&&a[l].call(this,p||{});return this.__eventListeners[d]=a.filter(function(y){return!1!==y}),this},on:function(d,p){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var a in d)this.on(a,d[a]);else this.__eventListeners[d]||(this.__eventListeners[d]=[]),this.__eventListeners[d].push(p);return this},once:function(d,p){if(1===arguments.length)for(var a in d)c.call(this,a,d[a]);else c.call(this,d,p);return this},off:function(d,p){if(!this.__eventListeners)return this;if(0===arguments.length)for(d in this.__eventListeners)h.call(this,d);else if(1===arguments.length&&"object"==typeof arguments[0])for(var a in d)h.call(this,a,d[a]);else h.call(this,d,p);return this}}}(),S.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var h=0,c=arguments.length;h<c;h++)this._onObjectAdded(arguments[h]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(h,c,d){var p=this._objects;return d?p[c]=h:p.splice(c,0,h),this._onObjectAdded&&this._onObjectAdded(h),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var h,c=this._objects,d=!1,p=0,a=arguments.length;p<a;p++)-1!==(h=c.indexOf(arguments[p]))&&(d=!0,c.splice(h,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[p]));return this.renderOnAddRemove&&d&&this.requestRenderAll(),this},forEachObject:function(h,c){for(var d=this.getObjects(),p=0,a=d.length;p<a;p++)h.call(c,d[p],p,d);return this},getObjects:function(h){return void 0===h?this._objects.concat():this._objects.filter(function(c){return c.type===h})},item:function(h){return this._objects[h]},isEmpty:function(){return 0===this._objects.length},size:function(){return this._objects.length},contains:function(h,c){return this._objects.indexOf(h)>-1||!!c&&this._objects.some(function(d){return"function"==typeof d.contains&&d.contains(h,!0)})},complexity:function(){return this._objects.reduce(function(h,c){return h+(c.complexity?c.complexity():0)},0)}},S.CommonMethods={_setOptions:function(h){for(var c in h)this.set(c,h[c])},_initGradient:function(h,c){!h||!h.colorStops||h instanceof S.Gradient||this.set(c,new S.Gradient(h))},_initPattern:function(h,c,d){!h||!h.source||h instanceof S.Pattern?d&&d():this.set(c,new S.Pattern(h,d))},_setObject:function(h){for(var c in h)this._set(c,h[c])},set:function(h,c){return"object"==typeof h?this._setObject(h):this._set(h,c),this},_set:function(h,c){this[h]=c},toggle:function(h){var c=this.get(h);return"boolean"==typeof c&&this.set(h,!c),this},get:function(h){return this[h]}},i=e,r=Math.sqrt,o=Math.atan2,s=Math.pow,u=Math.PI/180,g=Math.PI/2,S.util={cos:function(h){if(0===h)return 1;switch(h<0&&(h=-h),h/g){case 1:case 3:return 0;case 2:return-1}return Math.cos(h)},sin:function(h){if(0===h)return 0;var c=1;switch(h<0&&(c=-1),h/g){case 1:return c;case 2:return 0;case 3:return-c}return Math.sin(h)},removeFromArray:function(h,c){var d=h.indexOf(c);return-1!==d&&h.splice(d,1),h},getRandomInt:function(h,c){return Math.floor(Math.random()*(c-h+1))+h},degreesToRadians:function(h){return h*u},radiansToDegrees:function(h){return h/u},rotatePoint:function(h,c,d){var p=new S.Point(h.x-c.x,h.y-c.y),a=S.util.rotateVector(p,d);return new S.Point(a.x,a.y).addEquals(c)},rotateVector:function(h,c){var d=S.util.sin(c),p=S.util.cos(c);return{x:h.x*p-h.y*d,y:h.x*d+h.y*p}},createVector:function(h,c){return new S.Point(c.x-h.x,c.y-h.y)},calcAngleBetweenVectors:function(h,c){return Math.acos((h.x*c.x+h.y*c.y)/(Math.hypot(h.x,h.y)*Math.hypot(c.x,c.y)))},getHatVector:function(h){return new S.Point(h.x,h.y).multiply(1/Math.hypot(h.x,h.y))},getBisector:function(h,c,d){var p=S.util.createVector(h,c),a=S.util.createVector(h,d),l=S.util.calcAngleBetweenVectors(p,a),f=l*(0===S.util.calcAngleBetweenVectors(S.util.rotateVector(p,l),a)?1:-1)/2;return{vector:S.util.getHatVector(S.util.rotateVector(p,f)),angle:l}},projectStrokeOnPoints:function(h,c,d){var p=[],a=c.strokeWidth/2,l=c.strokeUniform?new S.Point(1/c.scaleX,1/c.scaleY):new S.Point(1,1),f=function(y){var m=a/Math.hypot(y.x,y.y);return new S.Point(y.x*m*l.x,y.y*m*l.y)};return h.length<=1||h.forEach(function(y,m){var _,C,D=new S.Point(y.x,y.y);0===m?(C=h[m+1],_=d?f(S.util.createVector(C,D)).addEquals(D):h[h.length-1]):m===h.length-1?(_=h[m-1],C=d?f(S.util.createVector(_,D)).addEquals(D):h[0]):(_=h[m-1],C=h[m+1]);var E,A,T=S.util.getBisector(D,_,C),M=T.vector;if("miter"===c.strokeLineJoin&&(E=-a/Math.sin(T.angle/2),A=new S.Point(M.x*E*l.x,M.y*E*l.y),Math.hypot(A.x,A.y)/a<=c.strokeMiterLimit))return p.push(D.add(A)),void p.push(D.subtract(A));E=-a*Math.SQRT2,A=new S.Point(M.x*E*l.x,M.y*E*l.y),p.push(D.add(A)),p.push(D.subtract(A))}),p},transformPoint:function(h,c,d){return d?new S.Point(c[0]*h.x+c[2]*h.y,c[1]*h.x+c[3]*h.y):new S.Point(c[0]*h.x+c[2]*h.y+c[4],c[1]*h.x+c[3]*h.y+c[5])},makeBoundingBoxFromPoints:function(h,c){if(c)for(var d=0;d<h.length;d++)h[d]=S.util.transformPoint(h[d],c);var p=[h[0].x,h[1].x,h[2].x,h[3].x],a=S.util.array.min(p),l=S.util.array.max(p)-a,f=[h[0].y,h[1].y,h[2].y,h[3].y],y=S.util.array.min(f);return{left:a,top:y,width:l,height:S.util.array.max(f)-y}},invertTransform:function(h){var c=1/(h[0]*h[3]-h[1]*h[2]),d=[c*h[3],-c*h[1],-c*h[2],c*h[0]],p=S.util.transformPoint({x:h[4],y:h[5]},d,!0);return d[4]=-p.x,d[5]=-p.y,d},toFixed:function(h,c){return parseFloat(Number(h).toFixed(c))},parseUnit:function(h,c){var d=/\D{0,2}$/.exec(h),p=parseFloat(h);switch(c||(c=S.Text.DEFAULT_SVG_FONT_SIZE),d[0]){case"mm":return p*S.DPI/25.4;case"cm":return p*S.DPI/2.54;case"in":return p*S.DPI;case"pt":return p*S.DPI/72;case"pc":return p*S.DPI/72*12;case"em":return p*c;default:return p}},falseFunction:function(){return!1},getKlass:function(h,c){return h=S.util.string.camelize(h.charAt(0).toUpperCase()+h.slice(1)),S.util.resolveNamespace(c)[h]},getSvgAttributes:function(h){var c=["instantiated_by_use","style","id","class"];switch(h){case"linearGradient":c=c.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":c=c.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":c=c.concat(["offset","stop-color","stop-opacity"])}return c},resolveNamespace:function(h){if(!h)return S;var c,d=h.split("."),p=d.length,a=i||S.window;for(c=0;c<p;++c)a=a[d[c]];return a},loadImage:function(h,c,d,p){if(h){var a=S.util.createImage(),l=function(){c&&c.call(d,a,!1),a=a.onload=a.onerror=null};a.onload=l,a.onerror=function(){S.log("Error loading "+a.src),c&&c.call(d,null,!0),a=a.onload=a.onerror=null},0!==h.indexOf("data")&&null!=p&&(a.crossOrigin=p),"data:image/svg"===h.substring(0,14)&&(a.onload=null,S.util.loadImageInDom(a,l)),a.src=h}else c&&c.call(d,h)},loadImageInDom:function(h,c){var d=S.document.createElement("div");d.style.width=d.style.height="1px",d.style.left=d.style.top="-100%",d.style.position="absolute",d.appendChild(h),S.document.querySelector("body").appendChild(d),h.onload=function(){c(),d.parentNode.removeChild(d),d=null}},enlivenObjects:function(h,c,d,p){var a=[],l=0,f=(h=h||[]).length;function y(){++l===f&&c&&c(a.filter(function(m){return m}))}f?h.forEach(function(m,_){m&&m.type?S.util.getKlass(m.type,d).fromObject(m,function(C,D){D||(a[_]=C),p&&p(m,C,D),y()}):y()}):c&&c(a)},enlivenObjectEnlivables:function(h,c,d){var p=S.Object.ENLIVEN_PROPS.filter(function(a){return!!h[a]});S.util.enlivenObjects(p.map(function(a){return h[a]}),function(a){var l={};p.forEach(function(f,y){l[f]=a[y],c&&(c[f]=a[y])}),d&&d(l)})},enlivenPatterns:function(h,c){function d(){++a===l&&c&&c(p)}var p=[],a=0,l=(h=h||[]).length;l?h.forEach(function(f,y){f&&f.source?new S.Pattern(f,function(m){p[y]=m,d()}):(p[y]=f,d())}):c&&c(p)},groupSVGElements:function(h,c,d){var p;return h&&1===h.length?h[0]:(c&&(c.width&&c.height?c.centerPoint={x:c.width/2,y:c.height/2}:(delete c.width,delete c.height)),p=new S.Group(h,c),void 0!==d&&(p.sourcePath=d),p)},populateWithProperties:function(h,c,d){if(d&&Array.isArray(d))for(var p=0,a=d.length;p<a;p++)d[p]in h&&(c[d[p]]=h[d[p]])},createCanvasElement:function(){return S.document.createElement("canvas")},copyCanvasElement:function(h){var c=S.util.createCanvasElement();return c.width=h.width,c.height=h.height,c.getContext("2d").drawImage(h,0,0),c},toDataURL:function(h,c,d){return h.toDataURL("image/"+c,d)},createImage:function(){return S.document.createElement("img")},multiplyTransformMatrices:function(h,c,d){return[h[0]*c[0]+h[2]*c[1],h[1]*c[0]+h[3]*c[1],h[0]*c[2]+h[2]*c[3],h[1]*c[2]+h[3]*c[3],d?0:h[0]*c[4]+h[2]*c[5]+h[4],d?0:h[1]*c[4]+h[3]*c[5]+h[5]]},qrDecompose:function(h){var c=o(h[1],h[0]),d=s(h[0],2)+s(h[1],2),p=r(d),a=(h[0]*h[3]-h[2]*h[1])/p,l=o(h[0]*h[2]+h[1]*h[3],d);return{angle:c/u,scaleX:p,scaleY:a,skewX:l/u,skewY:0,translateX:h[4],translateY:h[5]}},calcRotateMatrix:function(h){if(!h.angle)return S.iMatrix.concat();var c=S.util.degreesToRadians(h.angle),d=S.util.cos(c),p=S.util.sin(c);return[d,p,-p,d,0,0]},calcDimensionsMatrix:function(h){var c=void 0===h.scaleX?1:h.scaleX,d=void 0===h.scaleY?1:h.scaleY,p=[h.flipX?-c:c,0,0,h.flipY?-d:d,0,0],a=S.util.multiplyTransformMatrices,l=S.util.degreesToRadians;return h.skewX&&(p=a(p,[1,0,Math.tan(l(h.skewX)),1],!0)),h.skewY&&(p=a(p,[1,Math.tan(l(h.skewY)),0,1],!0)),p},composeMatrix:function(h){var c=[1,0,0,1,h.translateX||0,h.translateY||0],d=S.util.multiplyTransformMatrices;return h.angle&&(c=d(c,S.util.calcRotateMatrix(h))),(1!==h.scaleX||1!==h.scaleY||h.skewX||h.skewY||h.flipX||h.flipY)&&(c=d(c,S.util.calcDimensionsMatrix(h))),c},resetObjectTransform:function(h){h.scaleX=1,h.scaleY=1,h.skewX=0,h.skewY=0,h.flipX=!1,h.flipY=!1,h.rotate(0)},saveObjectTransform:function(h){return{scaleX:h.scaleX,scaleY:h.scaleY,skewX:h.skewX,skewY:h.skewY,angle:h.angle,left:h.left,flipX:h.flipX,flipY:h.flipY,top:h.top}},isTransparent:function(h,c,d,p){p>0&&(c>p?c-=p:c=0,d>p?d-=p:d=0);var a,l=!0,f=h.getImageData(c,d,2*p||1,2*p||1),y=f.data.length;for(a=3;a<y&&0!=(l=f.data[a]<=0);a+=4);return f=null,l},parsePreserveAspectRatioAttribute:function(h){var c,d="meet",p=h.split(" ");return p&&p.length&&("meet"!==(d=p.pop())&&"slice"!==d?(c=d,d="meet"):p.length&&(c=p.pop())),{meetOrSlice:d,alignX:"none"!==c?c.slice(1,4):"none",alignY:"none"!==c?c.slice(5,8):"none"}},clearFabricFontCache:function(h){(h=(h||"").toLowerCase())?S.charWidthsCache[h]&&delete S.charWidthsCache[h]:S.charWidthsCache={}},limitDimsByArea:function(h,c){var d=Math.sqrt(c*h),p=Math.floor(c/d);return{x:Math.floor(d),y:p}},capValue:function(h,c,d){return Math.max(h,Math.min(c,d))},findScaleToFit:function(h,c){return Math.min(c.width/h.width,c.height/h.height)},findScaleToCover:function(h,c){return Math.max(c.width/h.width,c.height/h.height)},matrixToSVG:function(h){return"matrix("+h.map(function(c){return S.util.toFixed(c,S.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(h,c){var d=S.util.invertTransform(c),p=S.util.multiplyTransformMatrices(d,h.calcOwnMatrix());S.util.applyTransformToObject(h,p)},addTransformToObject:function(h,c){S.util.applyTransformToObject(h,S.util.multiplyTransformMatrices(c,h.calcOwnMatrix()))},applyTransformToObject:function(h,c){var d=S.util.qrDecompose(c),p=new S.Point(d.translateX,d.translateY);h.flipX=!1,h.flipY=!1,h.set("scaleX",d.scaleX),h.set("scaleY",d.scaleY),h.skewX=d.skewX,h.skewY=d.skewY,h.angle=d.angle,h.setPositionByOrigin(p,"center","center")},sizeAfterTransform:function(h,c,d){var p=h/2,a=c/2,l=[{x:-p,y:-a},{x:p,y:-a},{x:-p,y:a},{x:p,y:a}],f=S.util.calcDimensionsMatrix(d),y=S.util.makeBoundingBoxFromPoints(l,f);return{x:y.width,y:y.height}},mergeClipPaths:function(h,c){var d=h,p=c;d.inverted&&!p.inverted&&(d=c,p=h),S.util.applyTransformToObject(p,S.util.multiplyTransformMatrices(S.util.invertTransform(d.calcTransformMatrix()),p.calcTransformMatrix()));var a=d.inverted&&p.inverted;return a&&(d.inverted=p.inverted=!1),new S.Group([d],{clipPath:p,inverted:a})}},function(){var h=Array.prototype.join,c={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},d={m:"l",M:"L"};function p(A,T,M,F,U,G,K,q,$,N,k){var z=S.util.cos(A),J=S.util.sin(A),Q=S.util.cos(T),H=S.util.sin(T),j=M*U*Q-F*G*H+K,Y=F*U*Q+M*G*H+q;return["C",N+$*(-M*U*J-F*G*z),k+$*(-F*U*J+M*G*z),j+$*(M*U*H+F*G*Q),Y+$*(F*U*H-M*G*Q),j,Y]}function a(A,T,M,F){var U=Math.atan2(T,A),G=Math.atan2(F,M);return G>=U?G-U:2*Math.PI-(U-G)}function l(A,T,M){for(var $=function(z,J,Q,H,j,Y,te){var Z=Math.PI,re=te*Z/180,he=S.util.sin(re),ce=S.util.cos(re),ae=0,de=0,ue=-ce*z*.5-he*J*.5,fe=-ce*J*.5+he*z*.5,ve=(Q=Math.abs(Q))*Q,me=(H=Math.abs(H))*H,Oe=fe*fe,We=ue*ue,on=ve*me-ve*Oe-me*We,Wn=0;if(on<0){var ar=Math.sqrt(1-on/(ve*me));Q*=ar,H*=ar}else Wn=(j===Y?-1:1)*Math.sqrt(on/(ve*Oe+me*We));var et=Wn*Q*fe/H,sn=-Wn*H*ue/Q,co=ce*et-he*sn+.5*z,lr=he*et+ce*sn+.5*J,_i=a(1,0,(ue-et)/Q,(fe-sn)/H),cr=a((ue-et)/Q,(fe-sn)/H,(-ue-et)/Q,(-fe-sn)/H);0===Y&&cr>0?cr-=2*Z:1===Y&&cr<0&&(cr+=2*Z);for(var pv=Math.ceil(Math.abs(cr/Z*2)),na=[],uo=cr/pv,Kx=8/3*Math.sin(uo/4)*Math.sin(uo/4)/Math.sin(uo/2),Eu=_i+uo,ho=0;ho<pv;ho++)na[ho]=p(_i,Eu,ce,he,Q,H,co,lr,Kx,ae,de),ae=na[ho][5],de=na[ho][6],_i=Eu,Eu+=uo;return na}(M[6]-A,M[7]-T,M[1],M[2],M[4],M[5],M[3]),N=0,k=$.length;N<k;N++)$[N][1]+=A,$[N][2]+=T,$[N][3]+=A,$[N][4]+=T,$[N][5]+=A,$[N][6]+=T;return $}function f(A,T,M,F){return Math.sqrt((M-A)*(M-A)+(F-T)*(F-T))}function y(A,T,M,F,U,G,K,q){return function($){var N,H,k=(N=$)*N*N,z=3*(H=$)*H*(1-H),J=function(H){return 3*H*(1-H)*(1-H)}($),Q=function(H){return(1-H)*(1-H)*(1-H)}($);return{x:K*k+U*z+M*J+A*Q,y:q*k+G*z+F*J+T*Q}}}function m(A,T,M,F,U,G,K,q){return function($){var N=1-$;return Math.atan2(3*N*N*(F-T)+6*N*$*(G-F)+3*$*$*(q-G),3*N*N*(M-A)+6*N*$*(U-M)+3*$*$*(K-U))}}function _(A,T,M,F,U,G){return function(K){var q,z,$=(q=K)*q,N=2*(z=K)*(1-z),k=function(z){return(1-z)*(1-z)}(K);return{x:U*$+M*N+A*k,y:G*$+F*N+T*k}}}function C(A,T,M,F,U,G){return function(K){var q=1-K;return Math.atan2(2*q*(F-T)+2*K*(G-F),2*q*(M-A)+2*K*(U-M))}}function D(A,T,M){var F,U,G={x:T,y:M},K=0;for(U=1;U<=100;U+=1)F=A(U/100),K+=f(G.x,G.y,F.x,F.y),G=F;return K}function E(A){for(var T,M,F,U,G=0,K=A.length,q=0,$=0,N=0,k=0,z=[],J=0;J<K;J++){switch(F={x:q,y:$,command:(T=A[J])[0]},T[0]){case"M":F.length=0,N=q=T[1],k=$=T[2];break;case"L":F.length=f(q,$,T[1],T[2]),q=T[1],$=T[2];break;case"C":M=y(q,$,T[1],T[2],T[3],T[4],T[5],T[6]),U=m(q,$,T[1],T[2],T[3],T[4],T[5],T[6]),F.iterator=M,F.angleFinder=U,F.length=D(M,q,$),q=T[5],$=T[6];break;case"Q":M=_(q,$,T[1],T[2],T[3],T[4]),U=C(q,$,T[1],T[2],T[3],T[4]),F.iterator=M,F.angleFinder=U,F.length=D(M,q,$),q=T[3],$=T[4];break;case"Z":case"z":F.destX=N,F.destY=k,F.length=f(q,$,N,k),q=N,$=k}G+=F.length,z.push(F)}return z.push({length:G,x:q,y:$}),z}S.util.joinPath=function(A){return A.map(function(T){return T.join(" ")}).join(" ")},S.util.parsePath=function(A){var T,M,F,U,G,K=[],q=[],$=S.rePathCommand,N="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",k="("+N+")"+S.commaWsp,z="([01])"+S.commaWsp+"?",J=new RegExp(k+"?"+k+"?"+k+z+z+k+"?("+N+")","g");if(!A||!A.match)return K;for(var Q,H=0,j=(G=A.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;H<j;H++){U=(T=G[H]).slice(1).trim(),q.length=0;var Y=T.charAt(0);if(Q=[Y],"a"===Y.toLowerCase())for(var te;te=J.exec(U);)for(var Z=1;Z<te.length;Z++)q.push(te[Z]);else for(;F=$.exec(U);)q.push(F[0]);Z=0;for(var re=q.length;Z<re;Z++)M=parseFloat(q[Z]),isNaN(M)||Q.push(M);var he=c[Y.toLowerCase()],ce=d[Y]||Y;if(Q.length-1>he)for(var ae=1,de=Q.length;ae<de;ae+=he)K.push([Y].concat(Q.slice(ae,ae+he))),Y=ce;else K.push(Q)}return K},S.util.makePathSimpler=function(A){var T,M,F,U,G,K,q=0,$=0,N=A.length,k=0,z=0,J=[];for(M=0;M<N;++M){switch(F=!1,(T=A[M].slice(0))[0]){case"l":T[0]="L",T[1]+=q,T[2]+=$;case"L":q=T[1],$=T[2];break;case"h":T[1]+=q;case"H":T[0]="L",T[2]=$,q=T[1];break;case"v":T[1]+=$;case"V":T[0]="L",$=T[1],T[1]=q,T[2]=$;break;case"m":T[0]="M",T[1]+=q,T[2]+=$;case"M":q=T[1],$=T[2],k=T[1],z=T[2];break;case"c":T[0]="C",T[1]+=q,T[2]+=$,T[3]+=q,T[4]+=$,T[5]+=q,T[6]+=$;case"C":G=T[3],K=T[4],q=T[5],$=T[6];break;case"s":T[0]="S",T[1]+=q,T[2]+=$,T[3]+=q,T[4]+=$;case"S":"C"===U?(G=2*q-G,K=2*$-K):(G=q,K=$),q=T[3],$=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=G,T[2]=K,G=T[3],K=T[4];break;case"q":T[0]="Q",T[1]+=q,T[2]+=$,T[3]+=q,T[4]+=$;case"Q":G=T[1],K=T[2],q=T[3],$=T[4];break;case"t":T[0]="T",T[1]+=q,T[2]+=$;case"T":"Q"===U?(G=2*q-G,K=2*$-K):(G=q,K=$),T[0]="Q",q=T[1],$=T[2],T[1]=G,T[2]=K,T[3]=q,T[4]=$;break;case"a":T[0]="A",T[6]+=q,T[7]+=$;case"A":F=!0,J=J.concat(l(q,$,T)),q=T[6],$=T[7];break;case"z":case"Z":q=k,$=z}F||J.push(T),U=T[0]}return J},S.util.getSmoothPathFromPoints=function(A,T){var M,F=[],U=new S.Point(A[0].x,A[0].y),G=new S.Point(A[1].x,A[1].y),K=A.length,q=1,$=0,N=K>2;for(N&&(q=A[2].x<G.x?-1:A[2].x===G.x?0:1,$=A[2].y<G.y?-1:A[2].y===G.y?0:1),F.push(["M",U.x-q*(T=T||0),U.y-$*T]),M=1;M<K;M++){if(!U.eq(G)){var k=U.midPointFrom(G);F.push(["Q",U.x,U.y,k.x,k.y])}U=A[M],M+1<A.length&&(G=A[M+1])}return N&&(q=U.x>A[M-2].x?1:U.x===A[M-2].x?0:-1,$=U.y>A[M-2].y?1:U.y===A[M-2].y?0:-1),F.push(["L",U.x+q*T,U.y+$*T]),F},S.util.getPathSegmentsInfo=E,S.util.getBoundsOfCurve=function(A,T,M,F,U,G,K,q){var $;if(S.cachesBoundsOfCurve&&($=h.call(arguments),S.boundsOfCurveCache[$]))return S.boundsOfCurveCache[$];var N,k,z,J,Q,H,j,Y,te=Math.sqrt,Z=Math.min,re=Math.max,he=Math.abs,ce=[],ae=[[],[]];k=6*A-12*M+6*U,N=-3*A+9*M-9*U+3*K,z=3*M-3*A;for(var de=0;de<2;++de)if(de>0&&(k=6*T-12*F+6*G,N=-3*T+9*F-9*G+3*q,z=3*F-3*T),he(N)<1e-12){if(he(k)<1e-12)continue;0<(J=-z/k)&&J<1&&ce.push(J)}else(j=k*k-4*z*N)<0||(0<(Q=(-k+(Y=te(j)))/(2*N))&&Q<1&&ce.push(Q),0<(H=(-k-Y)/(2*N))&&H<1&&ce.push(H));for(var ue,ve,me=ce.length,Oe=me;me--;)ue=(ve=1-(J=ce[me]))*ve*ve*A+3*ve*ve*J*M+3*ve*J*J*U+J*J*J*K,ae[0][me]=ue,ae[1][me]=ve*ve*ve*T+3*ve*ve*J*F+3*ve*J*J*G+J*J*J*q;ae[0][Oe]=A,ae[1][Oe]=T,ae[0][Oe+1]=K,ae[1][Oe+1]=q;var We=[{x:Z.apply(null,ae[0]),y:Z.apply(null,ae[1])},{x:re.apply(null,ae[0]),y:re.apply(null,ae[1])}];return S.cachesBoundsOfCurve&&(S.boundsOfCurveCache[$]=We),We},S.util.getPointOnPath=function(A,T,M){M||(M=E(A));for(var F=0;T-M[F].length>0&&F<M.length-2;)T-=M[F].length,F++;var U,G=M[F],K=T/G.length,$=A[F];switch(G.command){case"M":return{x:G.x,y:G.y,angle:0};case"Z":case"z":return(U=new S.Point(G.x,G.y).lerp(new S.Point(G.destX,G.destY),K)).angle=Math.atan2(G.destY-G.y,G.destX-G.x),U;case"L":return(U=new S.Point(G.x,G.y).lerp(new S.Point($[1],$[2]),K)).angle=Math.atan2($[2]-G.y,$[1]-G.x),U;case"C":case"Q":return function(N,k){for(var z,J,Q,H=0,j=0,Y=N.iterator,te={x:N.x,y:N.y},Z=.01,re=N.angleFinder;j<k&&Z>1e-4;)z=Y(H),Q=H,(J=f(te.x,te.y,z.x,z.y))+j>k?(H-=Z,Z/=2):(te=z,H+=Z,j+=J);return z.angle=re(Q),z}(G,T)}},S.util.transformPath=function(A,T,M){return M&&(T=S.util.multiplyTransformMatrices(T,[1,0,0,1,-M.x,-M.y])),A.map(function(F){for(var U=F.slice(0),G={},K=1;K<F.length-1;K+=2)G.x=F[K],G.y=F[K+1],G=S.util.transformPoint(G,T),U[K]=G.x,U[K+1]=G.y;return U})}}(),function(){var h=Array.prototype.slice;function c(d,p,a){if(d&&0!==d.length){var l=d.length-1,f=p?d[l][p]:d[l];if(p)for(;l--;)a(d[l][p],f)&&(f=d[l][p]);else for(;l--;)a(d[l],f)&&(f=d[l]);return f}}S.util.array={fill:function(d,p){for(var a=d.length;a--;)d[a]=p;return d},invoke:function(d,p){for(var a=h.call(arguments,2),l=[],f=0,y=d.length;f<y;f++)l[f]=a.length?d[f][p].apply(d[f],a):d[f][p].call(d[f]);return l},min:function(d,p){return c(d,p,function(a,l){return a<l})},max:function(d,p){return c(d,p,function(a,l){return a>=l})}}}(),function(){function h(c,d,p){if(p)if(!S.isLikelyNode&&d instanceof Element)c=d;else if(d instanceof Array){c=[];for(var a=0,l=d.length;a<l;a++)c[a]=h({},d[a],p)}else if(d&&"object"==typeof d)for(var f in d)"canvas"===f||"group"===f?c[f]=null:d.hasOwnProperty(f)&&(c[f]=h({},d[f],p));else c=d;else for(var f in d)c[f]=d[f];return c}S.util.object={extend:h,clone:function(c,d){return h({},c,d)}},S.util.object.extend(S.util,S.Observable)}(),function(){function h(c,d){var p=c.charCodeAt(d);if(isNaN(p))return"";if(p<55296||p>57343)return c.charAt(d);if(55296<=p&&p<=56319){if(c.length<=d+1)throw"High surrogate without following low surrogate";var a=c.charCodeAt(d+1);if(56320>a||a>57343)throw"High surrogate without following low surrogate";return c.charAt(d)+c.charAt(d+1)}if(0===d)throw"Low surrogate without preceding high surrogate";var l=c.charCodeAt(d-1);if(55296>l||l>56319)throw"Low surrogate without preceding high surrogate";return!1}S.util.string={camelize:function(c){return c.replace(/-+(.)?/g,function(d,p){return p?p.toUpperCase():""})},capitalize:function(c,d){return c.charAt(0).toUpperCase()+(d?c.slice(1):c.slice(1).toLowerCase())},escapeXml:function(c){return c.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(c){var d,p=0,a=[];for(p=0;p<c.length;p++)!1!==(d=h(c,p))&&a.push(d);return a}}}(),function(){var h=Array.prototype.slice,c=function(){},d=function(){for(var f in{toString:1})if("toString"===f)return!1;return!0}(),p=function(f,y,m){for(var _ in y)f.prototype[_]=_ in f.prototype&&"function"==typeof f.prototype[_]&&(y[_]+"").indexOf("callSuper")>-1?function(C){return function(){var D=this.constructor.superclass;this.constructor.superclass=m;var E=y[C].apply(this,arguments);if(this.constructor.superclass=D,"initialize"!==C)return E}}(_):y[_],d&&(y.toString!==Object.prototype.toString&&(f.prototype.toString=y.toString),y.valueOf!==Object.prototype.valueOf&&(f.prototype.valueOf=y.valueOf))};function a(){}function l(f){for(var y=null,m=this;m.constructor.superclass;){var _=m.constructor.superclass.prototype[f];if(m[f]!==_){y=_;break}m=m.constructor.superclass.prototype}return y?arguments.length>1?y.apply(this,h.call(arguments,1)):y.call(this):console.log("tried to callSuper "+f+", method not found in prototype chain",this)}S.util.createClass=function(){var f=null,y=h.call(arguments,0);function m(){this.initialize.apply(this,arguments)}"function"==typeof y[0]&&(f=y.shift()),m.superclass=f,m.subclasses=[],f&&(a.prototype=f.prototype,m.prototype=new a,f.subclasses.push(m));for(var _=0,C=y.length;_<C;_++)p(m,y[_],f);return m.prototype.initialize||(m.prototype.initialize=c),m.prototype.constructor=m,m.prototype.callSuper=l,m}}(),v=!!S.document.createElement("div").attachEvent,w=["touchstart","touchmove","touchend"],S.util.addListener=function(h,c,d,p){h&&h.addEventListener(c,d,!v&&p)},S.util.removeListener=function(h,c,d,p){h&&h.removeEventListener(c,d,!v&&p)},S.util.getPointer=function(h){var a,l,d=S.util.getScrollLeftTop(h.target),p=(l=(a=h).changedTouches)&&l[0]?l[0]:a;return{x:p.clientX+d.left,y:p.clientY+d.top}},S.util.isTouchEvent=function(h){return w.indexOf(h.type)>-1||"touch"===h.pointerType},I="string"==typeof(b=S.document.createElement("div")).style.opacity,O=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,R=function(h){return h},I?R=function(h,c){return h.style.opacity=c,h}:"string"==typeof b.style.filter&&(R=function(h,c){var d=h.style;return h.currentStyle&&!h.currentStyle.hasLayout&&(d.zoom=1),O.test(d.filter)?d.filter=d.filter.replace(O,c=c>=.9999?"":"alpha(opacity="+100*c+")"):d.filter+=" alpha(opacity="+100*c+")",h}),S.util.setStyle=function(h,c){var d=h.style;if(!d)return h;if("string"==typeof c)return h.style.cssText+=";"+c,c.indexOf("opacity")>-1?R(h,c.match(/opacity:\s*(\d?\.?\d*)/)[1]):h;for(var p in c)"opacity"===p?R(h,c[p]):d["float"===p||"cssFloat"===p?void 0===d.styleFloat?"cssFloat":"styleFloat":p]=c[p];return h},function(){var h,c,d,p,a=Array.prototype.slice,l=function(m){return a.call(m,0)};try{h=l(S.document.childNodes)instanceof Array}catch{}function f(m,_){var C=S.document.createElement(m);for(var D in _)"class"===D?C.className=_[D]:"for"===D?C.htmlFor=_[D]:C.setAttribute(D,_[D]);return C}function y(m){for(var _=0,C=0,D=S.document.documentElement,E=S.document.body||{scrollLeft:0,scrollTop:0};m&&(m.parentNode||m.host)&&((m=m.parentNode||m.host)===S.document?(_=E.scrollLeft||D.scrollLeft||0,C=E.scrollTop||D.scrollTop||0):(_+=m.scrollLeft||0,C+=m.scrollTop||0),1!==m.nodeType||"fixed"!==m.style.position););return{left:_,top:C}}h||(l=function(m){for(var _=new Array(m.length),C=m.length;C--;)_[C]=m[C];return _}),c=S.document.defaultView&&S.document.defaultView.getComputedStyle?function(m,_){var C=S.document.defaultView.getComputedStyle(m,null);return C?C[_]:void 0}:function(m,_){var C=m.style[_];return!C&&m.currentStyle&&(C=m.currentStyle[_]),C},p="userSelect"in(d=S.document.documentElement.style)?"userSelect":"MozUserSelect"in d?"MozUserSelect":"WebkitUserSelect"in d?"WebkitUserSelect":"KhtmlUserSelect"in d?"KhtmlUserSelect":"",S.util.makeElementUnselectable=function(m){return void 0!==m.onselectstart&&(m.onselectstart=S.util.falseFunction),p?m.style[p]="none":"string"==typeof m.unselectable&&(m.unselectable="on"),m},S.util.makeElementSelectable=function(m){return void 0!==m.onselectstart&&(m.onselectstart=null),p?m.style[p]="":"string"==typeof m.unselectable&&(m.unselectable=""),m},S.util.setImageSmoothing=function(m,_){m.imageSmoothingEnabled=m.imageSmoothingEnabled||m.webkitImageSmoothingEnabled||m.mozImageSmoothingEnabled||m.msImageSmoothingEnabled||m.oImageSmoothingEnabled,m.imageSmoothingEnabled=_},S.util.getById=function(m){return"string"==typeof m?S.document.getElementById(m):m},S.util.toArray=l,S.util.addClass=function(m,_){m&&-1===(" "+m.className+" ").indexOf(" "+_+" ")&&(m.className+=(m.className?" ":"")+_)},S.util.makeElement=f,S.util.wrapElement=function(m,_,C){return"string"==typeof _&&(_=f(_,C)),m.parentNode&&m.parentNode.replaceChild(_,m),_.appendChild(m),_},S.util.getScrollLeftTop=y,S.util.getElementOffset=function(m){var _,C,D=m&&m.ownerDocument,E={left:0,top:0},A={left:0,top:0},T={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!D)return A;for(var M in T)A[T[M]]+=parseInt(c(m,M),10)||0;return _=D.documentElement,void 0!==m.getBoundingClientRect&&(E=m.getBoundingClientRect()),C=y(m),{left:E.left+C.left-(_.clientLeft||0)+A.left,top:E.top+C.top-(_.clientTop||0)+A.top}},S.util.getNodeCanvas=function(m){var _=S.jsdomImplForWrapper(m);return _._canvas||_._image},S.util.cleanUpJsdomNode=function(m){if(S.isLikelyNode){var _=S.jsdomImplForWrapper(m);_&&(_._image=null,_._canvas=null,_._currentSrc=null,_._attributes=null,_._classList=null)}}}(),function(){function h(){}S.util.request=function(c,d){d||(d={});var y,m,p=d.method?d.method.toUpperCase():"GET",a=d.onComplete||function(){},l=new S.window.XMLHttpRequest,f=d.body||d.parameters;return l.onreadystatechange=function(){4===l.readyState&&(a(l),l.onreadystatechange=h)},"GET"===p&&(f=null,"string"==typeof d.parameters&&(m=d.parameters,c=(y=c)+(/\?/.test(y)?"&":"?")+m)),l.open(p,c,!0),"POST"!==p&&"PUT"!==p||l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.send(f),l}}(),S.log=console.log,S.warn=console.warn,function(){var h=S.util.object.extend,c=S.util.object.clone,d=[];function p(){return!1}function a(m,_,C,D){return-C*Math.cos(m/D*(Math.PI/2))+C+_}S.util.object.extend(d,{cancelAll:function(){var m=this.splice(0);return m.forEach(function(_){_.cancel()}),m},cancelByCanvas:function(m){if(!m)return[];var _=this.filter(function(C){return"object"==typeof C.target&&C.target.canvas===m});return _.forEach(function(C){C.cancel()}),_},cancelByTarget:function(m){var _=this.findAnimationsByTarget(m);return _.forEach(function(C){C.cancel()}),_},findAnimationIndex:function(m){return this.indexOf(this.findAnimation(m))},findAnimation:function(m){return this.find(function(_){return _.cancel===m})},findAnimationsByTarget:function(m){return m?this.filter(function(_){return _.target===m}):[]}});var l=S.window.requestAnimationFrame||S.window.webkitRequestAnimationFrame||S.window.mozRequestAnimationFrame||S.window.oRequestAnimationFrame||S.window.msRequestAnimationFrame||function(m){return S.window.setTimeout(m,1e3/60)},f=S.window.cancelAnimationFrame||S.window.clearTimeout;function y(){return l.apply(S.window,arguments)}S.util.animate=function(m){m||(m={});var _,C=!1,D=function(){var E=S.runningAnimations.indexOf(_);return E>-1&&S.runningAnimations.splice(E,1)[0]};return _=h(c(m),{cancel:function(){return C=!0,D()},currentValue:"startValue"in m?m.startValue:0,completionRate:0,durationRate:0}),S.runningAnimations.push(_),y(function(E){var A,T=E||+new Date,M=m.duration||500,F=T+M,U=m.onChange||p,G=m.abort||p,K=m.onComplete||p,q=m.easing||a,$="startValue"in m&&m.startValue.length>0,N="startValue"in m?m.startValue:0,k="endValue"in m?m.endValue:100,z=m.byValue||($?N.map(function(J,Q){return k[Q]-N[Q]}):k-N);m.onStart&&m.onStart(),function J(Q){var H=(A=Q||+new Date)>F?M:A-T,j=H/M,Y=$?N.map(function(Z,re){return q(H,N[re],z[re],M)}):q(H,N,z,M),te=Math.abs($?(Y[0]-N[0])/z[0]:(Y-N)/z);if(_.currentValue=$?Y.slice():Y,_.completionRate=te,_.durationRate=j,!C){if(!G(Y,te,j))return A>F?(_.currentValue=$?k.slice():k,_.completionRate=1,_.durationRate=1,U($?k.slice():k,1,1),K(k,1,1),void D()):(U(Y,te,j),void y(J));D()}}(T)}),_.cancel},S.util.requestAnimFrame=y,S.util.cancelAnimFrame=function(){return f.apply(S.window,arguments)},S.runningAnimations=d}(),function(){function h(c,d,p){var a="rgba("+parseInt(c[0]+p*(d[0]-c[0]),10)+","+parseInt(c[1]+p*(d[1]-c[1]),10)+","+parseInt(c[2]+p*(d[2]-c[2]),10);return(a+=","+(c&&d?parseFloat(c[3]+p*(d[3]-c[3])):1))+")"}S.util.animateColor=function(c,d,p,a){var l=new S.Color(c).getSource(),f=new S.Color(d).getSource(),y=a.onComplete,m=a.onChange;return S.util.animate(S.util.object.extend(a=a||{},{duration:p||500,startValue:l,endValue:f,byValue:f,easing:function(_,C,D,E){return h(C,D,a.colorEasing?a.colorEasing(_,E):1-Math.cos(_/E*(Math.PI/2)))},onComplete:function(_,C,D){if(y)return y(h(f,f,0),C,D)},onChange:function(_,C,D){if(m){if(Array.isArray(_))return m(h(_,_,0),C,D);m(_,C,D)}}}))}}(),function(){function h(a,l,f,y){return a<Math.abs(l)?(a=l,y=f/4):y=0===l&&0===a?f/(2*Math.PI)*Math.asin(1):f/(2*Math.PI)*Math.asin(l/a),{a,c:l,p:f,s:y}}function c(a,l,f){return a.a*Math.pow(2,10*(l-=1))*Math.sin((l*f-a.s)*(2*Math.PI)/a.p)}function d(a,l,f,y){return f-p(y-a,0,f,y)+l}function p(a,l,f,y){return(a/=y)<1/2.75?f*(7.5625*a*a)+l:a<2/2.75?f*(7.5625*(a-=1.5/2.75)*a+.75)+l:a<2.5/2.75?f*(7.5625*(a-=2.25/2.75)*a+.9375)+l:f*(7.5625*(a-=2.625/2.75)*a+.984375)+l}S.util.ease={easeInQuad:function(a,l,f,y){return f*(a/=y)*a+l},easeOutQuad:function(a,l,f,y){return-f*(a/=y)*(a-2)+l},easeInOutQuad:function(a,l,f,y){return(a/=y/2)<1?f/2*a*a+l:-f/2*(--a*(a-2)-1)+l},easeInCubic:function(a,l,f,y){return f*(a/=y)*a*a+l},easeOutCubic:function(a,l,f,y){return f*((a=a/y-1)*a*a+1)+l},easeInOutCubic:function(a,l,f,y){return(a/=y/2)<1?f/2*a*a*a+l:f/2*((a-=2)*a*a+2)+l},easeInQuart:function(a,l,f,y){return f*(a/=y)*a*a*a+l},easeOutQuart:function(a,l,f,y){return-f*((a=a/y-1)*a*a*a-1)+l},easeInOutQuart:function(a,l,f,y){return(a/=y/2)<1?f/2*a*a*a*a+l:-f/2*((a-=2)*a*a*a-2)+l},easeInQuint:function(a,l,f,y){return f*(a/=y)*a*a*a*a+l},easeOutQuint:function(a,l,f,y){return f*((a=a/y-1)*a*a*a*a+1)+l},easeInOutQuint:function(a,l,f,y){return(a/=y/2)<1?f/2*a*a*a*a*a+l:f/2*((a-=2)*a*a*a*a+2)+l},easeInSine:function(a,l,f,y){return-f*Math.cos(a/y*(Math.PI/2))+f+l},easeOutSine:function(a,l,f,y){return f*Math.sin(a/y*(Math.PI/2))+l},easeInOutSine:function(a,l,f,y){return-f/2*(Math.cos(Math.PI*a/y)-1)+l},easeInExpo:function(a,l,f,y){return 0===a?l:f*Math.pow(2,10*(a/y-1))+l},easeOutExpo:function(a,l,f,y){return a===y?l+f:f*(1-Math.pow(2,-10*a/y))+l},easeInOutExpo:function(a,l,f,y){return 0===a?l:a===y?l+f:(a/=y/2)<1?f/2*Math.pow(2,10*(a-1))+l:f/2*(2-Math.pow(2,-10*--a))+l},easeInCirc:function(a,l,f,y){return-f*(Math.sqrt(1-(a/=y)*a)-1)+l},easeOutCirc:function(a,l,f,y){return f*Math.sqrt(1-(a=a/y-1)*a)+l},easeInOutCirc:function(a,l,f,y){return(a/=y/2)<1?-f/2*(Math.sqrt(1-a*a)-1)+l:f/2*(Math.sqrt(1-(a-=2)*a)+1)+l},easeInElastic:function(a,l,f,y){var m=0;return 0===a?l:1==(a/=y)?l+f:(m||(m=.3*y),-c(h(f,f,m,1.70158),a,y)+l)},easeOutElastic:function(a,l,f,y){var m=0;if(0===a)return l;if(1==(a/=y))return l+f;m||(m=.3*y);var _=h(f,f,m,1.70158);return _.a*Math.pow(2,-10*a)*Math.sin((a*y-_.s)*(2*Math.PI)/_.p)+_.c+l},easeInOutElastic:function(a,l,f,y){var m=0;if(0===a)return l;if(2==(a/=y/2))return l+f;m||(m=y*(.3*1.5));var _=h(f,f,m,1.70158);return a<1?-.5*c(_,a,y)+l:_.a*Math.pow(2,-10*(a-=1))*Math.sin((a*y-_.s)*(2*Math.PI)/_.p)*.5+_.c+l},easeInBack:function(a,l,f,y,m){return void 0===m&&(m=1.70158),f*(a/=y)*a*((m+1)*a-m)+l},easeOutBack:function(a,l,f,y,m){return void 0===m&&(m=1.70158),f*((a=a/y-1)*a*((m+1)*a+m)+1)+l},easeInOutBack:function(a,l,f,y,m){return void 0===m&&(m=1.70158),(a/=y/2)<1?f/2*(a*a*((1+(m*=1.525))*a-m))+l:f/2*((a-=2)*a*((1+(m*=1.525))*a+m)+2)+l},easeInBounce:d,easeOutBounce:p,easeInOutBounce:function(a,l,f,y){return a<y/2?.5*d(2*a,0,f,y)+l:.5*p(2*a-y,0,f,y)+.5*f+l}}}(),function(h){var c=h.fabric||(h.fabric={}),d=c.util.object.extend,p=c.util.object.clone,a=c.util.toFixed,l=c.util.parseUnit,f=c.util.multiplyTransformMatrices,y={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},m={stroke:"strokeOpacity",fill:"fillOpacity"},_="font-size",C="clip-path";function D(N){return N in y?y[N]:N}function E(N,k,z,J){var Q,H=Array.isArray(k);if("fill"!==N&&"stroke"!==N||"none"!==k){if("strokeUniform"===N)return"non-scaling-stroke"===k;if("strokeDashArray"===N)k="none"===k?null:k.replace(/,/g," ").split(/\s+/).map(parseFloat);else if("transformMatrix"===N)k=z&&z.transformMatrix?f(z.transformMatrix,c.parseTransformAttribute(k)):c.parseTransformAttribute(k);else if("visible"===N)k="none"!==k&&"hidden"!==k,z&&!1===z.visible&&(k=!1);else if("opacity"===N)k=parseFloat(k),z&&void 0!==z.opacity&&(k*=z.opacity);else if("textAnchor"===N)k="start"===k?"left":"end"===k?"right":"center";else if("charSpacing"===N)Q=l(k,J)/J*1e3;else if("paintFirst"===N){var j=k.indexOf("fill"),Y=k.indexOf("stroke");k="fill",(j>-1&&Y>-1&&Y<j||-1===j&&Y>-1)&&(k="stroke")}else{if("href"===N||"xlink:href"===N||"font"===N)return k;if("imageSmoothing"===N)return"optimizeQuality"===k;Q=H?k.map(l):l(k,J)}}else k="";return!H&&isNaN(Q)?k:Q}function A(N){return new RegExp("^("+N.join("|")+")\\b","i")}function T(N,k){var J,Q,H,j=[];for(Q=0,H=k.length;Q<H;Q++)J=N.getElementsByTagName(k[Q]),j=j.concat(Array.prototype.slice.call(J));return j}function M(N,k){var z,J=!0;return(z=F(N,k.pop()))&&k.length&&(J=function(Q,H){for(var j,Y=!0;Q.parentNode&&1===Q.parentNode.nodeType&&H.length;)Y&&(j=H.pop()),Y=F(Q=Q.parentNode,j);return 0===H.length}(N,k)),z&&J&&0===k.length}function F(N,k){var z,J,Q=N.nodeName,H=N.getAttribute("class"),j=N.getAttribute("id");if(z=new RegExp("^"+Q,"i"),k=k.replace(z,""),j&&k.length&&(z=new RegExp("#"+j+"(?![a-zA-Z\\-]+)","i"),k=k.replace(z,"")),H&&k.length)for(J=(H=H.split(" ")).length;J--;)z=new RegExp("\\."+H[J]+"(?![a-zA-Z\\-]+)","i"),k=k.replace(z,"");return 0===k.length}function U(N,k){var z;if(N.getElementById&&(z=N.getElementById(k)),z)return z;var J,Q,H,j=N.getElementsByTagName("*");for(Q=0,H=j.length;Q<H;Q++)if(k===(J=j[Q]).getAttribute("id"))return J}c.svgValidTagNamesRegEx=A(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),c.svgViewBoxElementsRegEx=A(["symbol","image","marker","pattern","view","svg"]),c.svgInvalidAncestorsRegEx=A(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),c.svgValidParentsRegEx=A(["symbol","g","a","svg","clipPath","defs"]),c.cssRules={},c.gradientDefs={},c.clipPaths={},c.parseTransformAttribute=function(){function N(Y,te,Z){Y[Z]=Math.tan(c.util.degreesToRadians(te[0]))}var k=c.iMatrix,z=c.reNum,J=c.commaWsp,Q="(?:(?:(matrix)\\s*\\(\\s*("+z+")"+J+"("+z+")"+J+"("+z+")"+J+"("+z+")"+J+"("+z+")"+J+"("+z+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+z+")(?:"+J+"("+z+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+z+")(?:"+J+"("+z+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+z+")(?:"+J+"("+z+")"+J+"("+z+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+z+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+z+")\\s*\\)))",H=new RegExp("^\\s*(?:(?:"+Q+"(?:"+J+"*"+Q+")*)?)\\s*$"),j=new RegExp(Q,"g");return function(Y){var te=k.concat(),Z=[];if(!Y||Y&&!H.test(Y))return te;Y.replace(j,function(he){var ue,fe,ce=new RegExp(Q).exec(he).filter(function(ue){return!!ue}),ae=ce[1],de=ce.slice(2).map(parseFloat);switch(ae){case"translate":(ue=te)[4]=(fe=de)[0],2===fe.length&&(ue[5]=fe[1]);break;case"rotate":de[0]=c.util.degreesToRadians(de[0]),function(ue,fe){var ve=c.util.cos(fe[0]),me=c.util.sin(fe[0]),Oe=0,We=0;3===fe.length&&(Oe=fe[1],We=fe[2]),ue[0]=ve,ue[1]=me,ue[2]=-me,ue[3]=ve,ue[4]=Oe-(ve*Oe-me*We),ue[5]=We-(me*Oe+ve*We)}(te,de);break;case"scale":!function(ue,fe){var me=2===fe.length?fe[1]:fe[0];ue[0]=fe[0],ue[3]=me}(te,de);break;case"skewX":N(te,de,2);break;case"skewY":N(te,de,1);break;case"matrix":te=de}Z.push(te.concat()),te=k.concat()});for(var re=Z[0];Z.length>1;)Z.shift(),re=c.util.multiplyTransformMatrices(re,Z[0]);return re}}();var G=new RegExp("^\\s*("+c.reNum+"+)\\s*,?\\s*("+c.reNum+"+)\\s*,?\\s*("+c.reNum+"+)\\s*,?\\s*("+c.reNum+"+)\\s*$");function K(N){if(!c.svgViewBoxElementsRegEx.test(N.nodeName))return{};var k,z,J,Q,H,j,Y=N.getAttribute("viewBox"),te=1,Z=1,re=N.getAttribute("width"),he=N.getAttribute("height"),ce=N.getAttribute("x")||0,ae=N.getAttribute("y")||0,de=N.getAttribute("preserveAspectRatio")||"",ue=!Y||!(Y=Y.match(G)),fe=!re||!he||"100%"===re||"100%"===he,ve=ue&&fe,me={},Oe="",We=0,on=0;if(me.width=0,me.height=0,me.toBeParsed=ve,ue&&(ce||ae)&&N.parentNode&&"#document"!==N.parentNode.nodeName&&(Oe=" translate("+l(ce)+" "+l(ae)+") ",H=(N.getAttribute("transform")||"")+Oe,N.setAttribute("transform",H),N.removeAttribute("x"),N.removeAttribute("y")),ve)return me;if(ue)return me.width=l(re),me.height=l(he),me;if(k=-parseFloat(Y[1]),z=-parseFloat(Y[2]),J=parseFloat(Y[3]),Q=parseFloat(Y[4]),me.minX=k,me.minY=z,me.viewBoxWidth=J,me.viewBoxHeight=Q,fe?(me.width=J,me.height=Q):(me.width=l(re),me.height=l(he),te=me.width/J,Z=me.height/Q),"none"!==(de=c.util.parsePreserveAspectRatioAttribute(de)).alignX&&("meet"===de.meetOrSlice&&(Z=te=te>Z?Z:te),"slice"===de.meetOrSlice&&(Z=te=te>Z?te:Z),We=me.width-J*te,on=me.height-Q*te,"Mid"===de.alignX&&(We/=2),"Mid"===de.alignY&&(on/=2),"Min"===de.alignX&&(We=0),"Min"===de.alignY&&(on=0)),1===te&&1===Z&&0===k&&0===z&&0===ce&&0===ae)return me;if((ce||ae)&&"#document"!==N.parentNode.nodeName&&(Oe=" translate("+l(ce)+" "+l(ae)+") "),H=Oe+" matrix("+te+" 0 0 "+Z+" "+(k*te+We)+" "+(z*Z+on)+") ","svg"===N.nodeName){for(j=N.ownerDocument.createElementNS(c.svgNS,"g");N.firstChild;)j.appendChild(N.firstChild);N.appendChild(j)}else(j=N).removeAttribute("x"),j.removeAttribute("y"),H=j.getAttribute("transform")+H;return j.setAttribute("transform",H),me}function q(N,k){var z="xlink:href",J=U(N,k.getAttribute(z).slice(1));if(J&&J.getAttribute(z)&&q(N,J),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(H){J&&!k.hasAttribute(H)&&J.hasAttribute(H)&&k.setAttribute(H,J.getAttribute(H))}),!k.children.length)for(var Q=J.cloneNode(!0);Q.firstChild;)k.appendChild(Q.firstChild);k.removeAttribute(z)}c.parseSVGDocument=function(N,k,z,J){if(N){!function(ce){for(var ae=T(ce,["use","svg:use"]),de=0;ae.length&&de<ae.length;){var ue=ae[de],fe=ue.getAttribute("xlink:href")||ue.getAttribute("href");if(null===fe)return;var ve,me,Oe,We,on=fe.slice(1),Wn=ue.getAttribute("x")||0,ar=ue.getAttribute("y")||0,et=U(ce,on).cloneNode(!0),sn=(et.getAttribute("transform")||"")+" translate("+Wn+", "+ar+")",co=ae.length,lr=c.svgNS;if(K(et),/^svg$/i.test(et.nodeName)){var _i=et.ownerDocument.createElementNS(lr,"g");for(me=0,We=(Oe=et.attributes).length;me<We;me++)ve=Oe.item(me),_i.setAttributeNS(lr,ve.nodeName,ve.nodeValue);for(;et.firstChild;)_i.appendChild(et.firstChild);et=_i}for(me=0,We=(Oe=ue.attributes).length;me<We;me++)"x"!==(ve=Oe.item(me)).nodeName&&"y"!==ve.nodeName&&"xlink:href"!==ve.nodeName&&"href"!==ve.nodeName&&("transform"===ve.nodeName?sn=ve.nodeValue+" "+sn:et.setAttribute(ve.nodeName,ve.nodeValue));et.setAttribute("transform",sn),et.setAttribute("instantiated_by_use","1"),et.removeAttribute("id"),ue.parentNode.replaceChild(et,ue),ae.length===co&&de++}}(N);var Q,H,j=c.Object.__uid++,Y=K(N),te=c.util.toArray(N.getElementsByTagName("*"));if(Y.crossOrigin=J&&J.crossOrigin,Y.svgUid=j,0===te.length&&c.isLikelyNode){var Z=[];for(Q=0,H=(te=N.selectNodes('//*[name(.)!="svg"]')).length;Q<H;Q++)Z[Q]=te[Q];te=Z}var re=te.filter(function(ce){return K(ce),c.svgValidTagNamesRegEx.test(ce.nodeName.replace("svg:",""))&&!function(ae,de){for(;ae&&(ae=ae.parentNode);)if(ae.nodeName&&de.test(ae.nodeName.replace("svg:",""))&&!ae.getAttribute("instantiated_by_use"))return!0;return!1}(ce,c.svgInvalidAncestorsRegEx)});if(!re||re&&!re.length)k&&k([],{});else{var he={};te.filter(function(ce){return"clipPath"===ce.nodeName.replace("svg:","")}).forEach(function(ce){var ae=ce.getAttribute("id");he[ae]=c.util.toArray(ce.getElementsByTagName("*")).filter(function(de){return c.svgValidTagNamesRegEx.test(de.nodeName.replace("svg:",""))})}),c.gradientDefs[j]=c.getGradientDefs(N),c.cssRules[j]=c.getCSSRules(N),c.clipPaths[j]=he,c.parseElements(re,function(ce,ae){k&&(k(ce,Y,ae,te),delete c.gradientDefs[j],delete c.cssRules[j],delete c.clipPaths[j])},p(Y),z,J)}}};var $=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+c.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+c.reNum+"))?\\s+(.*)");d(c,{parseFontDeclaration:function(N,k){var z=N.match($);if(z){var J=z[1],Q=z[3],H=z[4],j=z[5],Y=z[6];J&&(k.fontStyle=J),Q&&(k.fontWeight=isNaN(parseFloat(Q))?Q:parseFloat(Q)),H&&(k.fontSize=l(H)),Y&&(k.fontFamily=Y),j&&(k.lineHeight="normal"===j?1:j)}},getGradientDefs:function(N){var k,z=T(N,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),J=0,Q={};for(J=z.length;J--;)(k=z[J]).getAttribute("xlink:href")&&q(N,k),Q[k.getAttribute("id")]=k;return Q},parseAttributes:function(N,k,z){if(N){var J,Q,H,j={};void 0===z&&(z=N.getAttribute("svgUid")),N.parentNode&&c.svgValidParentsRegEx.test(N.parentNode.nodeName)&&(j=c.parseAttributes(N.parentNode,k,z));var Y=k.reduce(function(de,ue){return(J=N.getAttribute(ue))&&(de[ue]=J),de},{}),te=d(function(de,ue){var fe={};for(var ve in c.cssRules[ue])if(M(de,ve.split(" ")))for(var me in c.cssRules[ue][ve])fe[me]=c.cssRules[ue][ve][me];return fe}(N,z),c.parseStyleAttribute(N));Y=d(Y,te),te[C]&&N.setAttribute(C,te[C]),Q=H=j.fontSize||c.Text.DEFAULT_SVG_FONT_SIZE,Y[_]&&(Y[_]=Q=l(Y[_],H));var Z,re,he={};for(var ce in Y)re=E(Z=D(ce),Y[ce],j,Q),he[Z]=re;he&&he.font&&c.parseFontDeclaration(he.font,he);var ae=d(j,he);return c.svgValidParentsRegEx.test(N.nodeName)?ae:function(de){for(var ue in m)if(void 0!==de[m[ue]]&&""!==de[ue]){if(void 0===de[ue]){if(!c.Object.prototype[ue])continue;de[ue]=c.Object.prototype[ue]}if(0!==de[ue].indexOf("url(")){var fe=new c.Color(de[ue]);de[ue]=fe.setAlpha(a(fe.getAlpha()*de[m[ue]],2)).toRgba()}}return de}(ae)}},parseElements:function(N,k,z,J,Q){new c.ElementsParser(N,k,z,J,Q).parse()},parseStyleAttribute:function(N){var Q,H,j,k={},z=N.getAttribute("style");return z&&("string"==typeof z?(Q=k,z.replace(/;\s*$/,"").split(";").forEach(function(Y){var te=Y.split(":");H=te[0].trim().toLowerCase(),j=te[1].trim(),Q[H]=j})):function(J,Q){for(var Y in J)void 0!==J[Y]&&(Q[Y.toLowerCase()]=J[Y])}(z,k)),k},parsePointsAttribute:function(N){if(!N)return null;var k,z,J=[];for(k=0,z=(N=(N=N.replace(/,/g," ").trim()).split(/\s+/)).length;k<z;k+=2)J.push({x:parseFloat(N[k]),y:parseFloat(N[k+1])});return J},getCSSRules:function(N){var k,z,J=N.getElementsByTagName("style"),Q={};for(k=0,z=J.length;k<z;k++){var H=J[k].textContent;""!==(H=H.replace(/\/\*[\s\S]*?\*\//g,"")).trim()&&H.split("}").filter(function(j){return j.trim()}).forEach(function(j){var Y=j.split("{"),te={},Z=Y[1].trim().split(";").filter(function(ae){return ae.trim()});for(k=0,z=Z.length;k<z;k++){var re=Z[k].split(":"),he=re[0].trim(),ce=re[1].trim();te[he]=ce}(j=Y[0].trim()).split(",").forEach(function(ae){""!==(ae=ae.replace(/^svg/i,"").trim())&&(Q[ae]?c.util.object.extend(Q[ae],te):Q[ae]=c.util.object.clone(te))})})}return Q},loadSVGFromURL:function(N,k,z,J){N=N.replace(/^\n\s*/,"").trim(),new c.util.request(N,{method:"get",onComplete:function(Q){var H=Q.responseXML;if(!H||!H.documentElement)return k&&k(null),!1;c.parseSVGDocument(H.documentElement,function(j,Y,te,Z){k&&k(j,Y,te,Z)},z,J)}})},loadSVGFromString:function(N,k,z,J){var Q=(new c.window.DOMParser).parseFromString(N.trim(),"text/xml");c.parseSVGDocument(Q.documentElement,function(H,j,Y,te){k(H,j,Y,te)},z,J)}})}(e),S.ElementsParser=function(h,c,d,p,a,l){this.elements=h,this.callback=c,this.options=d,this.reviver=p,this.svgUid=d&&d.svgUid||0,this.parsingOptions=a,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=l},(P=S.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},P.createObjects=function(){var h=this;this.elements.forEach(function(c,d){c.setAttribute("svgUid",h.svgUid),h.createObject(c,d)})},P.findTag=function(h){return S[S.util.string.capitalize(h.tagName.replace("svg:",""))]},P.createObject=function(h,c){var d=this.findTag(h);if(d&&d.fromElement)try{d.fromElement(h,this.createCallback(c,h),this.options)}catch(p){S.log(p)}else this.checkIfDone()},P.createCallback=function(h,c){var d=this;return function(p){var a;d.resolveGradient(p,c,"fill"),d.resolveGradient(p,c,"stroke"),p instanceof S.Image&&p._originalElement&&(a=p.parsePreserveAspectRatioAttribute(c)),p._removeTransformMatrix(a),d.resolveClipPath(p,c),d.reviver&&d.reviver(c,p),d.instances[h]=p,d.checkIfDone()}},P.extractPropertyDefinition=function(h,c,d){var p=h[c],a=this.regexUrl;if(a.test(p)){a.lastIndex=0;var l=a.exec(p)[1];return a.lastIndex=0,S[d][this.svgUid][l]}},P.resolveGradient=function(h,c,d){var p=this.extractPropertyDefinition(h,d,"gradientDefs");if(p){var a=c.getAttribute(d+"-opacity"),l=S.Gradient.fromElement(p,h,a,this.options);h.set(d,l)}},P.createClipPathCallback=function(h,c){return function(d){d._removeTransformMatrix(),d.fillRule=d.clipRule,c.push(d)}},P.resolveClipPath=function(h,c){var d,p,a,l,f=this.extractPropertyDefinition(h,"clipPath","clipPaths");if(f){a=[],p=S.util.invertTransform(h.calcTransformMatrix());for(var y=f[0].parentNode,m=c;m.parentNode&&m.getAttribute("clip-path")!==h.clipPath;)m=m.parentNode;m.parentNode.appendChild(y);for(var _=0;_<f.length;_++)this.findTag(d=f[_]).fromElement(d,this.createClipPathCallback(h,a),this.options);f=1===a.length?a[0]:new S.Group(a),l=S.util.multiplyTransformMatrices(p,f.calcTransformMatrix()),f.clipPath&&this.resolveClipPath(f,m);var C=S.util.qrDecompose(l);f.flipX=!1,f.flipY=!1,f.set("scaleX",C.scaleX),f.set("scaleY",C.scaleY),f.angle=C.angle,f.skewX=C.skewX,f.skewY=0,f.setPositionByOrigin({x:C.translateX,y:C.translateY},"center","center"),h.clipPath=f}else delete h.clipPath},P.checkIfDone=function(){0==--this.numElements&&(this.instances=this.instances.filter(function(h){return null!=h}),this.callback(this.instances,this.elements))},function(h){var c=h.fabric||(h.fabric={});function d(p,a){this.x=p,this.y=a}c.Point?c.warn("fabric.Point is already defined"):(c.Point=d,d.prototype={type:"point",constructor:d,add:function(p){return new d(this.x+p.x,this.y+p.y)},addEquals:function(p){return this.x+=p.x,this.y+=p.y,this},scalarAdd:function(p){return new d(this.x+p,this.y+p)},scalarAddEquals:function(p){return this.x+=p,this.y+=p,this},subtract:function(p){return new d(this.x-p.x,this.y-p.y)},subtractEquals:function(p){return this.x-=p.x,this.y-=p.y,this},scalarSubtract:function(p){return new d(this.x-p,this.y-p)},scalarSubtractEquals:function(p){return this.x-=p,this.y-=p,this},multiply:function(p){return new d(this.x*p,this.y*p)},multiplyEquals:function(p){return this.x*=p,this.y*=p,this},divide:function(p){return new d(this.x/p,this.y/p)},divideEquals:function(p){return this.x/=p,this.y/=p,this},eq:function(p){return this.x===p.x&&this.y===p.y},lt:function(p){return this.x<p.x&&this.y<p.y},lte:function(p){return this.x<=p.x&&this.y<=p.y},gt:function(p){return this.x>p.x&&this.y>p.y},gte:function(p){return this.x>=p.x&&this.y>=p.y},lerp:function(p,a){return void 0===a&&(a=.5),a=Math.max(Math.min(1,a),0),new d(this.x+(p.x-this.x)*a,this.y+(p.y-this.y)*a)},distanceFrom:function(p){var a=this.x-p.x,l=this.y-p.y;return Math.sqrt(a*a+l*l)},midPointFrom:function(p){return this.lerp(p)},min:function(p){return new d(Math.min(this.x,p.x),Math.min(this.y,p.y))},max:function(p){return new d(Math.max(this.x,p.x),Math.max(this.y,p.y))},toString:function(){return this.x+","+this.y},setXY:function(p,a){return this.x=p,this.y=a,this},setX:function(p){return this.x=p,this},setY:function(p){return this.y=p,this},setFromPoint:function(p){return this.x=p.x,this.y=p.y,this},swap:function(p){var a=this.x,l=this.y;this.x=p.x,this.y=p.y,p.x=a,p.y=l},clone:function(){return new d(this.x,this.y)}})}(e),function(h){var c=h.fabric||(h.fabric={});function d(p){this.status=p,this.points=[]}c.Intersection?c.warn("fabric.Intersection is already defined"):(c.Intersection=d,c.Intersection.prototype={constructor:d,appendPoint:function(p){return this.points.push(p),this},appendPoints:function(p){return this.points=this.points.concat(p),this}},c.Intersection.intersectLineLine=function(p,a,l,f){var y,m=(f.x-l.x)*(p.y-l.y)-(f.y-l.y)*(p.x-l.x),_=(a.x-p.x)*(p.y-l.y)-(a.y-p.y)*(p.x-l.x),C=(f.y-l.y)*(a.x-p.x)-(f.x-l.x)*(a.y-p.y);if(0!==C){var D=m/C,E=_/C;0<=D&&D<=1&&0<=E&&E<=1?(y=new d("Intersection")).appendPoint(new c.Point(p.x+D*(a.x-p.x),p.y+D*(a.y-p.y))):y=new d}else y=new d(0===m||0===_?"Coincident":"Parallel");return y},c.Intersection.intersectLinePolygon=function(p,a,l){var m,_,C=new d,D=l.length;for(_=0;_<D;_++)m=d.intersectLineLine(p,a,l[_],l[(_+1)%D]),C.appendPoints(m.points);return C.points.length>0&&(C.status="Intersection"),C},c.Intersection.intersectPolygonPolygon=function(p,a){var l,f=new d,y=p.length;for(l=0;l<y;l++){var C=d.intersectLinePolygon(p[l],p[(l+1)%y],a);f.appendPoints(C.points)}return f.points.length>0&&(f.status="Intersection"),f},c.Intersection.intersectPolygonRectangle=function(p,a,l){var f=a.min(l),y=a.max(l),m=new c.Point(y.x,f.y),_=new c.Point(f.x,y.y),C=d.intersectLinePolygon(f,m,p),D=d.intersectLinePolygon(m,y,p),E=d.intersectLinePolygon(y,_,p),A=d.intersectLinePolygon(_,f,p),T=new d;return T.appendPoints(C.points),T.appendPoints(D.points),T.appendPoints(E.points),T.appendPoints(A.points),T.points.length>0&&(T.status="Intersection"),T})}(e),function(h){var c=h.fabric||(h.fabric={});function d(a){a?this._tryParsingColor(a):this.setSource([0,0,0,1])}function p(a,l,f){return f<0&&(f+=1),f>1&&(f-=1),f<1/6?a+6*(l-a)*f:f<.5?l:f<2/3?a+(l-a)*(2/3-f)*6:a}c.Color?c.warn("fabric.Color is already defined."):(c.Color=d,c.Color.prototype={_tryParsingColor:function(a){var l;a in d.colorNameMap&&(a=d.colorNameMap[a]),"transparent"===a&&(l=[255,255,255,0]),l||(l=d.sourceFromHex(a)),l||(l=d.sourceFromRgb(a)),l||(l=d.sourceFromHsl(a)),l||(l=[0,0,0,1]),l&&this.setSource(l)},_rgbToHsl:function(a,l,f){var y,m,_,C=c.util.array.max([a/=255,l/=255,f/=255]),D=c.util.array.min([a,l,f]);if(_=(C+D)/2,C===D)y=m=0;else{var E=C-D;switch(m=_>.5?E/(2-C-D):E/(C+D),C){case a:y=(l-f)/E+(l<f?6:0);break;case l:y=(f-a)/E+2;break;case f:y=(a-l)/E+4}y/=6}return[Math.round(360*y),Math.round(100*m),Math.round(100*_)]},getSource:function(){return this._source},setSource:function(a){this._source=a},toRgb:function(){var a=this.getSource();return"rgb("+a[0]+","+a[1]+","+a[2]+")"},toRgba:function(){var a=this.getSource();return"rgba("+a[0]+","+a[1]+","+a[2]+","+a[3]+")"},toHsl:function(){var a=this.getSource(),l=this._rgbToHsl(a[0],a[1],a[2]);return"hsl("+l[0]+","+l[1]+"%,"+l[2]+"%)"},toHsla:function(){var a=this.getSource(),l=this._rgbToHsl(a[0],a[1],a[2]);return"hsla("+l[0]+","+l[1]+"%,"+l[2]+"%,"+a[3]+")"},toHex:function(){var a,l,f,y=this.getSource();return a=1===(a=y[0].toString(16)).length?"0"+a:a,l=1===(l=y[1].toString(16)).length?"0"+l:l,f=1===(f=y[2].toString(16)).length?"0"+f:f,a.toUpperCase()+l.toUpperCase()+f.toUpperCase()},toHexa:function(){var a,l=this.getSource();return a=1===(a=(a=Math.round(255*l[3])).toString(16)).length?"0"+a:a,this.toHex()+a.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(a){var l=this.getSource();return l[3]=a,this.setSource(l),this},toGrayscale:function(){var a=this.getSource(),l=parseInt((.3*a[0]+.59*a[1]+.11*a[2]).toFixed(0),10);return this.setSource([l,l,l,a[3]]),this},toBlackWhite:function(a){var l=this.getSource(),f=(.3*l[0]+.59*l[1]+.11*l[2]).toFixed(0),y=l[3];return a=a||127,f=Number(f)<Number(a)?0:255,this.setSource([f,f,f,y]),this},overlayWith:function(a){a instanceof d||(a=new d(a));var l,f=[],y=this.getAlpha(),m=this.getSource(),_=a.getSource();for(l=0;l<3;l++)f.push(Math.round(.5*m[l]+.5*_[l]));return f[3]=y,this.setSource(f),this}},c.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,c.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,c.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,c.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},c.Color.fromRgb=function(a){return d.fromSource(d.sourceFromRgb(a))},c.Color.sourceFromRgb=function(a){var l=a.match(d.reRGBa);if(l){var f=parseInt(l[1],10)/(/%$/.test(l[1])?100:1)*(/%$/.test(l[1])?255:1),y=parseInt(l[2],10)/(/%$/.test(l[2])?100:1)*(/%$/.test(l[2])?255:1),m=parseInt(l[3],10)/(/%$/.test(l[3])?100:1)*(/%$/.test(l[3])?255:1);return[parseInt(f,10),parseInt(y,10),parseInt(m,10),l[4]?parseFloat(l[4]):1]}},c.Color.fromRgba=d.fromRgb,c.Color.fromHsl=function(a){return d.fromSource(d.sourceFromHsl(a))},c.Color.sourceFromHsl=function(a){var l=a.match(d.reHSLa);if(l){var f,y,m,_=(parseFloat(l[1])%360+360)%360/360,C=parseFloat(l[2])/(/%$/.test(l[2])?100:1),D=parseFloat(l[3])/(/%$/.test(l[3])?100:1);if(0===C)f=y=m=D;else{var E=D<=.5?D*(C+1):D+C-D*C,A=2*D-E;f=p(A,E,_+1/3),y=p(A,E,_),m=p(A,E,_-1/3)}return[Math.round(255*f),Math.round(255*y),Math.round(255*m),l[4]?parseFloat(l[4]):1]}},c.Color.fromHsla=d.fromHsl,c.Color.fromHex=function(a){return d.fromSource(d.sourceFromHex(a))},c.Color.sourceFromHex=function(a){if(a.match(d.reHex)){var l=a.slice(a.indexOf("#")+1),f=3===l.length||4===l.length,y=8===l.length||4===l.length,m=f?l.charAt(0)+l.charAt(0):l.substring(0,2),_=f?l.charAt(1)+l.charAt(1):l.substring(2,4),C=f?l.charAt(2)+l.charAt(2):l.substring(4,6),D=y?f?l.charAt(3)+l.charAt(3):l.substring(6,8):"FF";return[parseInt(m,16),parseInt(_,16),parseInt(C,16),parseFloat((parseInt(D,16)/255).toFixed(2))]}},c.Color.fromSource=function(a){var l=new d;return l.setSource(a),l})}(e),function(h){var c=h.fabric||(h.fabric={}),d=["e","se","s","sw","w","nw","n","ne","e"],p=["ns","nesw","ew","nwse"],a={},l="left",f="top",y="right",m="bottom",_="center",C={top:m,bottom:f,left:y,right:l,center:_},D=c.util.radiansToDegrees,E=Math.sign||function(H){return(H>0)-(H<0)||+H};function A(H,j){var Y=H.angle+D(Math.atan2(j.y,j.x))+360;return Math.round(Y%360/45)}function T(H,j){var Y=j.transform.target,te=Y.canvas,Z=c.util.object.clone(j);Z.target=Y,te&&te.fire("object:"+H,Z),Y.fire(H,j)}function M(H,j){var Y=j.canvas,te=H[Y.uniScaleKey];return Y.uniformScaling&&!te||!Y.uniformScaling&&te}function F(H){return H.originX===_&&H.originY===_}function U(H,j,Y){var te=H.lockScalingX,Z=H.lockScalingY;return!((!te||!Z)&&(j||!te&&!Z||!Y)&&(!te||"x"!==j)&&(!Z||"y"!==j))}function G(H,j,Y,te){return{e:H,transform:j,pointer:{x:Y,y:te}}}function K(H){return function(j,Y,te,Z){var re=Y.target,he=re.getCenterPoint(),ce=re.translateToOriginPoint(he,Y.originX,Y.originY),ae=H(j,Y,te,Z);return re.setPositionByOrigin(ce,Y.originX,Y.originY),ae}}function q(H,j){return function(Y,te,Z,re){var he=j(Y,te,Z,re);return he&&T(H,G(Y,te,Z,re)),he}}function $(H,j,Y,te,Z){var re=H.target,he=re.controls[H.corner],ce=re.canvas.getZoom(),ae=re.padding/ce,de=re.toLocalPoint(new c.Point(te,Z),j,Y);return de.x>=ae&&(de.x-=ae),de.x<=-ae&&(de.x+=ae),de.y>=ae&&(de.y-=ae),de.y<=ae&&(de.y+=ae),de.x-=he.offsetX,de.y-=he.offsetY,de}function N(H){return H.flipX!==H.flipY}function k(H,j,Y,te,Z){if(0!==H[j]){var re=Z/H._getTransformedDimensions()[te]*H[Y];H.set(Y,re)}}function z(H,j,Y,te){var Z,re=j.target,he=re._getTransformedDimensions(0,re.skewY),ce=$(j,j.originX,j.originY,Y,te),ae=Math.abs(2*ce.x)-he.x,de=re.skewX;ae<2?Z=0:(Z=D(Math.atan2(ae/re.scaleX,he.y/re.scaleY)),j.originX===l&&j.originY===m&&(Z=-Z),j.originX===y&&j.originY===f&&(Z=-Z),N(re)&&(Z=-Z));var ue=de!==Z;if(ue){var fe=re._getTransformedDimensions().y;re.set("skewX",Z),k(re,"skewY","scaleY","y",fe)}return ue}function J(H,j,Y,te){var Z,re=j.target,he=re._getTransformedDimensions(re.skewX,0),ce=$(j,j.originX,j.originY,Y,te),ae=Math.abs(2*ce.y)-he.y,de=re.skewY;ae<2?Z=0:(Z=D(Math.atan2(ae/re.scaleY,he.x/re.scaleX)),j.originX===l&&j.originY===m&&(Z=-Z),j.originX===y&&j.originY===f&&(Z=-Z),N(re)&&(Z=-Z));var ue=de!==Z;if(ue){var fe=re._getTransformedDimensions().x;re.set("skewY",Z),k(re,"skewX","scaleX","x",fe)}return ue}function Q(H,j,Y,te,Z){var re,he,ce,ae,de,ue,fe=j.target,ve=fe.lockScalingX,me=fe.lockScalingY,Oe=(Z=Z||{}).by,We=M(H,fe),on=U(fe,Oe,We),Wn=j.gestureScale;if(on)return!1;if(Wn)he=j.scaleX*Wn,ce=j.scaleY*Wn;else{if(re=$(j,j.originX,j.originY,Y,te),de="y"!==Oe?E(re.x):1,ue="x"!==Oe?E(re.y):1,j.signX||(j.signX=de),j.signY||(j.signY=ue),fe.lockScalingFlip&&(j.signX!==de||j.signY!==ue))return!1;if(ae=fe._getTransformedDimensions(),We&&!Oe){var ar=Math.abs(re.x)+Math.abs(re.y),et=j.original,sn=ar/(Math.abs(ae.x*et.scaleX/fe.scaleX)+Math.abs(ae.y*et.scaleY/fe.scaleY));he=et.scaleX*sn,ce=et.scaleY*sn}else he=Math.abs(re.x*fe.scaleX/ae.x),ce=Math.abs(re.y*fe.scaleY/ae.y);F(j)&&(he*=2,ce*=2),j.signX!==de&&"y"!==Oe&&(j.originX=C[j.originX],he*=-1,j.signX=de),j.signY!==ue&&"x"!==Oe&&(j.originY=C[j.originY],ce*=-1,j.signY=ue)}var co=fe.scaleX,lr=fe.scaleY;return Oe?("x"===Oe&&fe.set("scaleX",he),"y"===Oe&&fe.set("scaleY",ce)):(!ve&&fe.set("scaleX",he),!me&&fe.set("scaleY",ce)),co!==fe.scaleX||lr!==fe.scaleY}a.scaleCursorStyleHandler=function(H,j,Y){var te=M(H,Y),Z="";if(0!==j.x&&0===j.y?Z="x":0===j.x&&0!==j.y&&(Z="y"),U(Y,Z,te))return"not-allowed";var re=A(Y,j);return d[re]+"-resize"},a.skewCursorStyleHandler=function(H,j,Y){if(0!==j.x&&Y.lockSkewingY||0!==j.y&&Y.lockSkewingX)return"not-allowed";var Z=A(Y,j)%4;return p[Z]+"-resize"},a.scaleSkewCursorStyleHandler=function(H,j,Y){return H[Y.canvas.altActionKey]?a.skewCursorStyleHandler(H,j,Y):a.scaleCursorStyleHandler(H,j,Y)},a.rotationWithSnapping=q("rotating",K(function(H,j,Y,te){var Z=j,re=Z.target,he=re.translateToOriginPoint(re.getCenterPoint(),Z.originX,Z.originY);if(re.lockRotation)return!1;var ce,ae=Math.atan2(Z.ey-he.y,Z.ex-he.x),de=Math.atan2(te-he.y,Y-he.x),ue=D(de-ae+Z.theta);if(re.snapAngle>0){var fe=re.snapAngle,ve=re.snapThreshold||fe,me=Math.ceil(ue/fe)*fe,Oe=Math.floor(ue/fe)*fe;Math.abs(ue-Oe)<ve?ue=Oe:Math.abs(ue-me)<ve&&(ue=me)}return ue<0&&(ue=360+ue),ce=re.angle!==(ue%=360),re.angle=ue,ce})),a.scalingEqually=q("scaling",K(function(H,j,Y,te){return Q(H,j,Y,te)})),a.scalingX=q("scaling",K(function(H,j,Y,te){return Q(H,j,Y,te,{by:"x"})})),a.scalingY=q("scaling",K(function(H,j,Y,te){return Q(H,j,Y,te,{by:"y"})})),a.scalingYOrSkewingX=function(H,j,Y,te){return H[j.target.canvas.altActionKey]?a.skewHandlerX(H,j,Y,te):a.scalingY(H,j,Y,te)},a.scalingXOrSkewingY=function(H,j,Y,te){return H[j.target.canvas.altActionKey]?a.skewHandlerY(H,j,Y,te):a.scalingX(H,j,Y,te)},a.changeWidth=q("resizing",K(function(H,j,Y,te){var Z=j.target,re=$(j,j.originX,j.originY,Y,te),he=Z.strokeWidth/(Z.strokeUniform?Z.scaleX:1),ce=F(j)?2:1,ae=Z.width,de=Math.abs(re.x*ce/Z.scaleX)-he;return Z.set("width",Math.max(de,0)),ae!==de})),a.skewHandlerX=function(H,j,Y,te){var Z,re=j.target,he=re.skewX,ce=j.originY;return!re.lockSkewingX&&(0===he?Z=$(j,_,_,Y,te).x>0?l:y:(he>0&&(Z=ce===f?l:y),he<0&&(Z=ce===f?y:l),N(re)&&(Z=Z===l?y:l)),j.originX=Z,q("skewing",K(z))(H,j,Y,te))},a.skewHandlerY=function(H,j,Y,te){var Z,re=j.target,he=re.skewY,ce=j.originX;return!re.lockSkewingY&&(0===he?Z=$(j,_,_,Y,te).y>0?f:m:(he>0&&(Z=ce===l?f:m),he<0&&(Z=ce===l?m:f),N(re)&&(Z=Z===f?m:f)),j.originY=Z,q("skewing",K(J))(H,j,Y,te))},a.dragHandler=function(H,j,Y,te){var Z=j.target,re=Y-j.offsetX,he=te-j.offsetY,ce=!Z.get("lockMovementX")&&Z.left!==re,ae=!Z.get("lockMovementY")&&Z.top!==he;return ce&&Z.set("left",re),ae&&Z.set("top",he),(ce||ae)&&T("moving",G(H,j,Y,te)),ce||ae},a.scaleOrSkewActionName=function(H,j,Y){var te=H[Y.canvas.altActionKey];return 0===j.x?te?"skewX":"scaleY":0===j.y?te?"skewY":"scaleX":void 0},a.rotationStyleHandler=function(H,j,Y){return Y.lockRotation?"not-allowed":j.cursorStyle},a.fireEvent=T,a.wrapWithFixedAnchor=K,a.wrapWithFireEvent=q,a.getLocalPoint=$,c.controlsUtils=a}(e),c=(h=e).fabric||(h.fabric={}),d=c.util.degreesToRadians,(p=c.controlsUtils).renderCircleControl=function(a,l,f,y,m){y=y||{};var _,C=this.sizeX||y.cornerSize||m.cornerSize,D=this.sizeY||y.cornerSize||m.cornerSize,E=void 0!==y.transparentCorners?y.transparentCorners:m.transparentCorners,A=E?"stroke":"fill",T=!E&&(y.cornerStrokeColor||m.cornerStrokeColor),M=l,F=f;a.save(),a.fillStyle=y.cornerColor||m.cornerColor,a.strokeStyle=y.cornerStrokeColor||m.cornerStrokeColor,C>D?(_=C,a.scale(1,D/C),F=f*C/D):D>C?(_=D,a.scale(C/D,1),M=l*D/C):_=C,a.lineWidth=1,a.beginPath(),a.arc(M,F,_/2,0,2*Math.PI,!1),a[A](),T&&a.stroke(),a.restore()},p.renderSquareControl=function(a,l,f,y,m){y=y||{};var _=this.sizeX||y.cornerSize||m.cornerSize,C=this.sizeY||y.cornerSize||m.cornerSize,D=void 0!==y.transparentCorners?y.transparentCorners:m.transparentCorners,E=D?"stroke":"fill",A=!D&&(y.cornerStrokeColor||m.cornerStrokeColor),T=_/2,M=C/2;a.save(),a.fillStyle=y.cornerColor||m.cornerColor,a.strokeStyle=y.cornerStrokeColor||m.cornerStrokeColor,a.lineWidth=1,a.translate(l,f),a.rotate(d(m.angle)),a[E+"Rect"](-T,-M,_,C),A&&a.strokeRect(-T,-M,_,C),a.restore()},function(h){var c=h.fabric||(h.fabric={});c.Control=function(d){for(var p in d)this[p]=d[p]},c.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(d,p){return p.cursorStyle},getActionName:function(d,p){return p.actionName},getVisibility:function(d,p){var a=d._controlsVisibility;return a&&void 0!==a[p]?a[p]:this.visible},setVisibility:function(d){this.visible=d},positionHandler:function(d,p){return c.util.transformPoint({x:this.x*d.x+this.offsetX,y:this.y*d.y+this.offsetY},p)},calcCornerCoords:function(d,p,a,l,f){var y,m,_,C,D=f?this.touchSizeX:this.sizeX,E=f?this.touchSizeY:this.sizeY;if(D&&E&&D!==E){var A=Math.atan2(E,D),T=Math.sqrt(D*D+E*E)/2,M=A-c.util.degreesToRadians(d),F=Math.PI/2-A-c.util.degreesToRadians(d);y=T*c.util.cos(M),m=T*c.util.sin(M),_=T*c.util.cos(F),C=T*c.util.sin(F)}else T=.7071067812*(D&&E?D:p),M=c.util.degreesToRadians(45-d),y=_=T*c.util.cos(M),m=C=T*c.util.sin(M);return{tl:{x:a-C,y:l-_},tr:{x:a+y,y:l-m},bl:{x:a-y,y:l+m},br:{x:a+C,y:l+_}}},render:function(d,p,a,l,f){"circle"===((l=l||{}).cornerStyle||f.cornerStyle)?c.controlsUtils.renderCircleControl.call(this,d,p,a,l,f):c.controlsUtils.renderSquareControl.call(this,d,p,a,l,f)}}}(e),function(){function h(d,p){var a,l,f,y,m=d.getAttribute("style"),_=d.getAttribute("offset")||0;if(_=(_=parseFloat(_)/(/%$/.test(_)?100:1))<0?0:_>1?1:_,m){var C=m.split(/\s*;\s*/);for(""===C[C.length-1]&&C.pop(),y=C.length;y--;){var D=C[y].split(/\s*:\s*/),E=D[0].trim(),A=D[1].trim();"stop-color"===E?a=A:"stop-opacity"===E&&(f=A)}}return a||(a=d.getAttribute("stop-color")||"rgb(0,0,0)"),f||(f=d.getAttribute("stop-opacity")),l=(a=new S.Color(a)).getAlpha(),f=isNaN(parseFloat(f))?1:parseFloat(f),f*=l*p,{offset:_,color:a.toRgb(),opacity:f}}var c=S.util.object.clone;S.Gradient=S.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(d){d||(d={}),d.coords||(d.coords={});var p,a=this;Object.keys(d).forEach(function(l){a[l]=d[l]}),this.id?this.id+="_"+S.Object.__uid++:this.id=S.Object.__uid++,p={x1:d.coords.x1||0,y1:d.coords.y1||0,x2:d.coords.x2||0,y2:d.coords.y2||0},"radial"===this.type&&(p.r1=d.coords.r1||0,p.r2=d.coords.r2||0),this.coords=p,this.colorStops=d.colorStops.slice()},addColorStop:function(d){for(var p in d){var a=new S.Color(d[p]);this.colorStops.push({offset:parseFloat(p),color:a.toRgb(),opacity:a.getAlpha()})}return this},toObject:function(d){var p={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return S.util.populateWithProperties(this,p,d),p},toSVG:function(d,p){var a,l,f,y,m=c(this.coords,!0),_=(p=p||{},c(this.colorStops,!0)),C=m.r1>m.r2,D=this.gradientTransform?this.gradientTransform.concat():S.iMatrix.concat(),E=-this.offsetX,A=-this.offsetY,T=!!p.additionalTransform,M="pixels"===this.gradientUnits?"userSpaceOnUse":"objectBoundingBox";if(_.sort(function(K,q){return K.offset-q.offset}),"objectBoundingBox"===M?(E/=d.width,A/=d.height):(E+=d.width/2,A+=d.height/2),"path"===d.type&&"percentage"!==this.gradientUnits&&(E-=d.pathOffset.x,A-=d.pathOffset.y),D[4]-=E,D[5]-=A,y='id="SVGID_'+this.id+'" gradientUnits="'+M+'"',y+=' gradientTransform="'+(T?p.additionalTransform+" ":"")+S.util.matrixToSVG(D)+'" ',"linear"===this.type?f=["<linearGradient ",y,' x1="',m.x1,'" y1="',m.y1,'" x2="',m.x2,'" y2="',m.y2,'">\n']:"radial"===this.type&&(f=["<radialGradient ",y,' cx="',C?m.x1:m.x2,'" cy="',C?m.y1:m.y2,'" r="',C?m.r1:m.r2,'" fx="',C?m.x2:m.x1,'" fy="',C?m.y2:m.y1,'">\n']),"radial"===this.type){if(C)for((_=_.concat()).reverse(),a=0,l=_.length;a<l;a++)_[a].offset=1-_[a].offset;var F=Math.min(m.r1,m.r2);if(F>0){var U=F/Math.max(m.r1,m.r2);for(a=0,l=_.length;a<l;a++)_[a].offset+=U*(1-_[a].offset)}}for(a=0,l=_.length;a<l;a++){var G=_[a];f.push("<stop ",'offset="',100*G.offset+"%",'" style="stop-color:',G.color,void 0!==G.opacity?";stop-opacity: "+G.opacity:";",'"/>\n')}return f.push("linear"===this.type?"</linearGradient>\n":"</radialGradient>\n"),f.join("")},toLive:function(d){var p,a,l,f=S.util.object.clone(this.coords);if(this.type){for("linear"===this.type?p=d.createLinearGradient(f.x1,f.y1,f.x2,f.y2):"radial"===this.type&&(p=d.createRadialGradient(f.x1,f.y1,f.r1,f.x2,f.y2,f.r2)),a=0,l=this.colorStops.length;a<l;a++){var y=this.colorStops[a].color,m=this.colorStops[a].opacity,_=this.colorStops[a].offset;void 0!==m&&(y=new S.Color(y).setAlpha(m).toRgba()),p.addColorStop(_,y)}return p}}}),S.util.object.extend(S.Gradient,{fromElement:function(d,p,a,l){var f=parseFloat(a)/(/%$/.test(a)?100:1);f=f<0?0:f>1?1:f,isNaN(f)&&(f=1);var y,m,_,C,U,G,K,q,$,N,D=d.getElementsByTagName("stop"),E="userSpaceOnUse"===d.getAttribute("gradientUnits")?"pixels":"percentage",A=d.getAttribute("gradientTransform")||"",T=[],M=0,F=0;for("linearGradient"===d.nodeName||"LINEARGRADIENT"===d.nodeName?(y="linear",m={x1:(U=d).getAttribute("x1")||0,y1:U.getAttribute("y1")||0,x2:U.getAttribute("x2")||"100%",y2:U.getAttribute("y2")||0}):(y="radial",m=function(U){return{x1:U.getAttribute("fx")||U.getAttribute("cx")||"50%",y1:U.getAttribute("fy")||U.getAttribute("cy")||"50%",r1:0,x2:U.getAttribute("cx")||"50%",y2:U.getAttribute("cy")||"50%",r2:U.getAttribute("r")||"50%"}}(d)),_=D.length;_--;)T.push(h(D[_],f));return C=S.parseTransformAttribute(A),G=m,K=l,q=E,Object.keys(G).forEach(function(k){"Infinity"===($=G[k])?N=1:"-Infinity"===$?N=0:(N=parseFloat(G[k],10),"string"==typeof $&&/^(\d+\.\d+)%|(\d+)%$/.test($)&&(N*=.01,"pixels"===q&&("x1"!==k&&"x2"!==k&&"r2"!==k||(N*=K.viewBoxWidth||K.width),"y1"!==k&&"y2"!==k||(N*=K.viewBoxHeight||K.height)))),G[k]=N}),"pixels"===E&&(M=-p.left,F=-p.top),new S.Gradient({id:d.getAttribute("id"),type:y,coords:m,colorStops:T,gradientUnits:E,gradientTransform:C,offsetX:M,offsetY:F})}})}(),V=S.util.toFixed,S.Pattern=S.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(h,c){if(h||(h={}),this.id=S.Object.__uid++,this.setOptions(h),!h.source||h.source&&"string"!=typeof h.source)c&&c(this);else{var d=this;this.source=S.util.createImage(),S.util.loadImage(h.source,function(p,a){d.source=p,c&&c(d,a)},null,this.crossOrigin)}},toObject:function(h){var c,d,p=S.Object.NUM_FRACTION_DIGITS;return"string"==typeof this.source.src?c=this.source.src:"object"==typeof this.source&&this.source.toDataURL&&(c=this.source.toDataURL()),d={type:"pattern",source:c,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:V(this.offsetX,p),offsetY:V(this.offsetY,p),patternTransform:this.patternTransform?this.patternTransform.concat():null},S.util.populateWithProperties(this,d,h),d},toSVG:function(h){var c="function"==typeof this.source?this.source():this.source,d=c.width/h.width,p=c.height/h.height,a=this.offsetX/h.width,l=this.offsetY/h.height,f="";return"repeat-x"!==this.repeat&&"no-repeat"!==this.repeat||(p=1,l&&(p+=Math.abs(l))),"repeat-y"!==this.repeat&&"no-repeat"!==this.repeat||(d=1,a&&(d+=Math.abs(a))),c.src?f=c.src:c.toDataURL&&(f=c.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+a+'" y="'+l+'" width="'+d+'" height="'+p+'">\n<image x="0" y="0" width="'+c.width+'" height="'+c.height+'" xlink:href="'+f+'"></image>\n</pattern>\n'},setOptions:function(h){for(var c in h)this[c]=h[c]},toLive:function(h){var c=this.source;return c&&(void 0===c.src||c.complete&&0!==c.naturalWidth&&0!==c.naturalHeight)?h.createPattern(c,this.repeat):""}}),function(h){var c=h.fabric||(h.fabric={}),d=c.util.toFixed;c.Shadow?c.warn("fabric.Shadow is already defined."):(c.Shadow=c.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(p){for(var a in"string"==typeof p&&(p=this._parseShadow(p)),p)this[a]=p[a];this.id=c.Object.__uid++},_parseShadow:function(p){var a=p.trim(),l=c.Shadow.reOffsetsAndBlur.exec(a)||[];return{color:(a.replace(c.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(l[1],10)||0,offsetY:parseFloat(l[2],10)||0,blur:parseFloat(l[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(p){var a=40,l=40,f=c.Object.NUM_FRACTION_DIGITS,y=c.util.rotateVector({x:this.offsetX,y:this.offsetY},c.util.degreesToRadians(-p.angle)),m=new c.Color(this.color);return p.width&&p.height&&(a=100*d((Math.abs(y.x)+this.blur)/p.width,f)+20,l=100*d((Math.abs(y.y)+this.blur)/p.height,f)+20),p.flipX&&(y.x*=-1),p.flipY&&(y.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+l+'%" height="'+(100+2*l)+'%" x="-'+a+'%" width="'+(100+2*a)+'%" >\n\t<feGaussianBlur in="SourceAlpha" stdDeviation="'+d(this.blur?this.blur/2:0,f)+'"></feGaussianBlur>\n\t<feOffset dx="'+d(y.x,f)+'" dy="'+d(y.y,f)+'" result="oBlur" ></feOffset>\n\t<feFlood flood-color="'+m.toRgb()+'" flood-opacity="'+m.getAlpha()+'"/>\n\t<feComposite in2="oBlur" operator="in" />\n\t<feMerge>\n\t\t<feMergeNode></feMergeNode>\n\t\t<feMergeNode in="SourceGraphic"></feMergeNode>\n\t</feMerge>\n</filter>\n'},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var p={},a=c.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(l){this[l]!==a[l]&&(p[l]=this[l])},this),p}}),c.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(S.StaticCanvas)S.warn("fabric.StaticCanvas is already defined.");else{var h=S.util.object.extend,c=S.util.getElementOffset,d=S.util.removeFromArray,p=S.util.toFixed,a=S.util.transformPoint,l=S.util.invertTransform,f=S.util.getNodeCanvas,y=S.util.createCanvasElement,m=new Error("Could not initialize `canvas` element");S.StaticCanvas=S.util.createClass(S.CommonMethods,{initialize:function(_,C){C||(C={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(_,C)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:S.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(_,C){var D=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(_),this._initOptions(C),this.interactive||this._initRetinaScaling(),C.overlayImage&&this.setOverlayImage(C.overlayImage,D),C.backgroundImage&&this.setBackgroundImage(C.backgroundImage,D),C.backgroundColor&&this.setBackgroundColor(C.backgroundColor,D),C.overlayColor&&this.setOverlayColor(C.overlayColor,D),this.calcOffset()},_isRetinaScaling:function(){return S.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,S.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var _=S.devicePixelRatio;this.__initRetinaScaling(_,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(_,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(_,C,D){C.setAttribute("width",this.width*_),C.setAttribute("height",this.height*_),D.scale(_,_)},calcOffset:function(){return this._offset=c(this.lowerCanvasEl),this},setOverlayImage:function(_,C,D){return this.__setBgOverlayImage("overlayImage",_,C,D)},setBackgroundImage:function(_,C,D){return this.__setBgOverlayImage("backgroundImage",_,C,D)},setOverlayColor:function(_,C){return this.__setBgOverlayColor("overlayColor",_,C)},setBackgroundColor:function(_,C){return this.__setBgOverlayColor("backgroundColor",_,C)},__setBgOverlayImage:function(_,C,D,E){return"string"==typeof C?S.util.loadImage(C,function(A,T){if(A){var M=new S.Image(A,E);this[_]=M,M.canvas=this}D&&D(A,T)},this,E&&E.crossOrigin):(E&&C.setOptions(E),this[_]=C,C&&(C.canvas=this),D&&D(C,!1)),this},__setBgOverlayColor:function(_,C,D){return this[_]=C,this._initGradient(C,_),this._initPattern(C,_,D),this},_createCanvasElement:function(){var _=y();if(!_||(_.style||(_.style={}),void 0===_.getContext))throw m;return _},_initOptions:function(_){var C=this.lowerCanvasEl;this._setOptions(_),this.width=this.width||parseInt(C.width,10)||0,this.height=this.height||parseInt(C.height,10)||0,this.lowerCanvasEl.style&&(C.width=this.width,C.height=this.height,C.style.width=this.width+"px",C.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(_){this.lowerCanvasEl=_&&_.getContext?_:S.util.getById(_)||this._createCanvasElement(),S.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(_,C){return this.setDimensions({width:_},C)},setHeight:function(_,C){return this.setDimensions({height:_},C)},setDimensions:function(_,C){var D;for(var E in C=C||{},_)D=_[E],C.cssOnly||(this._setBackstoreDimension(E,_[E]),D+="px",this.hasLostContext=!0),C.backstoreOnly||this._setCssDimension(E,D);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),C.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(_,C){return this.lowerCanvasEl[_]=C,this.upperCanvasEl&&(this.upperCanvasEl[_]=C),this.cacheCanvasEl&&(this.cacheCanvasEl[_]=C),this[_]=C,this},_setCssDimension:function(_,C){return this.lowerCanvasEl.style[_]=C,this.upperCanvasEl&&(this.upperCanvasEl.style[_]=C),this.wrapperEl&&(this.wrapperEl.style[_]=C),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(_){var C,D,E,A=this._activeObject,T=this.backgroundImage,M=this.overlayImage;for(this.viewportTransform=_,D=0,E=this._objects.length;D<E;D++)(C=this._objects[D]).group||C.setCoords(!0);return A&&A.setCoords(),T&&T.setCoords(!0),M&&M.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(_,C){var D=_,E=this.viewportTransform.slice(0);_=a(_,l(this.viewportTransform)),E[0]=C,E[3]=C;var A=a(_,E);return E[4]+=D.x-A.x,E[5]+=D.y-A.y,this.setViewportTransform(E)},setZoom:function(_){return this.zoomToPoint(new S.Point(0,0),_),this},absolutePan:function(_){var C=this.viewportTransform.slice(0);return C[4]=-_.x,C[5]=-_.y,this.setViewportTransform(C)},relativePan:function(_){return this.absolutePan(new S.Point(-_.x-this.viewportTransform[4],-_.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(_){this.stateful&&_.setupState(),_._set("canvas",this),_.setCoords(),this.fire("object:added",{target:_}),_.fire("added")},_onObjectRemoved:function(_){this.fire("object:removed",{target:_}),_.fire("removed"),delete _.canvas},clearContext:function(_){return _.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){return this.renderCanvas(this.contextContainer,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=S.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var _={},C=this.width,D=this.height,E=l(this.viewportTransform);return _.tl=a({x:0,y:0},E),_.br=a({x:C,y:D},E),_.tr=new S.Point(_.br.x,_.tl.y),_.bl=new S.Point(_.tl.x,_.br.y),this.vptCoords=_,_},cancelRequestedRender:function(){this.isRendering&&(S.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(_,C){var D=this.viewportTransform,E=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(_),S.util.setImageSmoothing(_,this.imageSmoothingEnabled),this.fire("before:render",{ctx:_}),this._renderBackground(_),_.save(),_.transform(D[0],D[1],D[2],D[3],D[4],D[5]),this._renderObjects(_,C),_.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(_),E&&(E.canvas=this,E.shouldCache(),E._transformDone=!0,E.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(_)),this._renderOverlay(_),this.controlsAboveOverlay&&this.interactive&&this.drawControls(_),this.fire("after:render",{ctx:_})},drawClipPathOnCanvas:function(_){var C=this.viewportTransform,D=this.clipPath;_.save(),_.transform(C[0],C[1],C[2],C[3],C[4],C[5]),_.globalCompositeOperation="destination-in",D.transform(_),_.scale(1/D.zoomX,1/D.zoomY),_.drawImage(D._cacheCanvas,-D.cacheTranslationX,-D.cacheTranslationY),_.restore()},_renderObjects:function(_,C){var D,E;for(D=0,E=C.length;D<E;++D)C[D]&&C[D].render(_)},_renderBackgroundOrOverlay:function(_,C){var D=this[C+"Color"],E=this[C+"Image"],A=this.viewportTransform,T=this[C+"Vpt"];if(D||E){if(D){_.save(),_.beginPath(),_.moveTo(0,0),_.lineTo(this.width,0),_.lineTo(this.width,this.height),_.lineTo(0,this.height),_.closePath(),_.fillStyle=D.toLive?D.toLive(_,this):D,T&&_.transform(A[0],A[1],A[2],A[3],A[4],A[5]),_.transform(1,0,0,1,D.offsetX||0,D.offsetY||0);var M=D.gradientTransform||D.patternTransform;M&&_.transform(M[0],M[1],M[2],M[3],M[4],M[5]),_.fill(),_.restore()}E&&(_.save(),T&&_.transform(A[0],A[1],A[2],A[3],A[4],A[5]),E.render(_),_.restore())}},_renderBackground:function(_){this._renderBackgroundOrOverlay(_,"background")},_renderOverlay:function(_){this._renderBackgroundOrOverlay(_,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new S.Point(this.width/2,this.height/2)},centerObjectH:function(_){return this._centerObject(_,new S.Point(this.getCenterPoint().x,_.getCenterPoint().y))},centerObjectV:function(_){return this._centerObject(_,new S.Point(_.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(_){var C=this.getCenterPoint();return this._centerObject(_,C)},viewportCenterObject:function(_){var C=this.getVpCenter();return this._centerObject(_,C)},viewportCenterObjectH:function(_){var C=this.getVpCenter();return this._centerObject(_,new S.Point(C.x,_.getCenterPoint().y)),this},viewportCenterObjectV:function(_){var C=this.getVpCenter();return this._centerObject(_,new S.Point(_.getCenterPoint().x,C.y))},getVpCenter:function(){var _=this.getCenterPoint(),C=l(this.viewportTransform);return a(_,C)},_centerObject:function(_,C){return _.setPositionByOrigin(C,"center","center"),_.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(_){return this.toDatalessObject(_)},toObject:function(_){return this._toObjectMethod("toObject",_)},toDatalessObject:function(_){return this._toObjectMethod("toDatalessObject",_)},_toObjectMethod:function(_,C){var D=this.clipPath,E={version:S.version,objects:this._toObjects(_,C)};return D&&!D.excludeFromExport&&(E.clipPath=this._toObject(this.clipPath,_,C)),h(E,this.__serializeBgOverlay(_,C)),S.util.populateWithProperties(this,E,C),E},_toObjects:function(_,C){return this._objects.filter(function(D){return!D.excludeFromExport}).map(function(D){return this._toObject(D,_,C)},this)},_toObject:function(_,C,D){var E;this.includeDefaultValues||(E=_.includeDefaultValues,_.includeDefaultValues=!1);var A=_[C](D);return this.includeDefaultValues||(_.includeDefaultValues=E),A},__serializeBgOverlay:function(_,C){var D={},E=this.backgroundImage,A=this.overlayImage,T=this.backgroundColor,M=this.overlayColor;return T&&T.toObject?T.excludeFromExport||(D.background=T.toObject(C)):T&&(D.background=T),M&&M.toObject?M.excludeFromExport||(D.overlay=M.toObject(C)):M&&(D.overlay=M),E&&!E.excludeFromExport&&(D.backgroundImage=this._toObject(E,_,C)),A&&!A.excludeFromExport&&(D.overlayImage=this._toObject(A,_,C)),D},svgViewportTransformation:!0,toSVG:function(_,C){_||(_={}),_.reviver=C;var D=[];return this._setSVGPreamble(D,_),this._setSVGHeader(D,_),this.clipPath&&D.push('<g clip-path="url(#'+this.clipPath.clipPathId+')" >\n'),this._setSVGBgOverlayColor(D,"background"),this._setSVGBgOverlayImage(D,"backgroundImage",C),this._setSVGObjects(D,C),this.clipPath&&D.push("</g>\n"),this._setSVGBgOverlayColor(D,"overlay"),this._setSVGBgOverlayImage(D,"overlayImage",C),D.push("</svg>"),D.join("")},_setSVGPreamble:function(_,C){C.suppressPreamble||_.push('<?xml version="1.0" encoding="',C.encoding||"UTF-8",'" standalone="no" ?>\n','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n')},_setSVGHeader:function(_,C){var D,E=C.width||this.width,A=C.height||this.height,T='viewBox="0 0 '+this.width+" "+this.height+'" ',M=S.Object.NUM_FRACTION_DIGITS;C.viewBox?T='viewBox="'+C.viewBox.x+" "+C.viewBox.y+" "+C.viewBox.width+" "+C.viewBox.height+'" ':this.svgViewportTransformation&&(T='viewBox="'+p(-(D=this.viewportTransform)[4]/D[0],M)+" "+p(-D[5]/D[3],M)+" "+p(this.width/D[0],M)+" "+p(this.height/D[3],M)+'" '),_.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',E,'" ','height="',A,'" ',T,'xml:space="preserve">\n',"<desc>Created with Fabric.js ",S.version,"</desc>\n","<defs>\n",this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(C),"</defs>\n")},createSVGClipPathMarkup:function(_){var C=this.clipPath;return C?(C.clipPathId="CLIPPATH_"+S.Object.__uid++,'<clipPath id="'+C.clipPathId+'" >\n'+this.clipPath.toClipPathSVG(_.reviver)+"</clipPath>\n"):""},createSVGRefElementsMarkup:function(){var _=this;return["background","overlay"].map(function(C){var D=_[C+"Color"];if(D&&D.toLive){var E=_[C+"Vpt"],A=_.viewportTransform;return D.toSVG({width:_.width/(E?A[0]:1),height:_.height/(E?A[3]:1)},{additionalTransform:E?S.util.matrixToSVG(A):""})}}).join("")},createSVGFontFacesMarkup:function(){var _,C,D,E,A,T,M,F,U="",G={},K=S.fontPaths,q=[];for(this._objects.forEach(function N(k){q.push(k),k._objects&&k._objects.forEach(N)}),M=0,F=q.length;M<F;M++)if(C=(_=q[M]).fontFamily,-1!==_.type.indexOf("text")&&!G[C]&&K[C]&&(G[C]=!0,_.styles))for(A in D=_.styles)for(T in E=D[A])!G[C=E[T].fontFamily]&&K[C]&&(G[C]=!0);for(var $ in G)U+=["\t\t@font-face {\n","\t\t\tfont-family: '",$,"';\n","\t\t\tsrc: url('",K[$],"');\n","\t\t}\n"].join("");return U&&(U=['\t<style type="text/css">',"<![CDATA[\n",U,"]]>","</style>\n"].join("")),U},_setSVGObjects:function(_,C){var D,E,A,T=this._objects;for(E=0,A=T.length;E<A;E++)(D=T[E]).excludeFromExport||this._setSVGObject(_,D,C)},_setSVGObject:function(_,C,D){_.push(C.toSVG(D))},_setSVGBgOverlayImage:function(_,C,D){this[C]&&!this[C].excludeFromExport&&this[C].toSVG&&_.push(this[C].toSVG(D))},_setSVGBgOverlayColor:function(_,C){var D=this[C+"Color"],A=this.width,T=this.height;if(D)if(D.toLive){var M=D.repeat,F=S.util.invertTransform(this.viewportTransform),U=this[C+"Vpt"]?S.util.matrixToSVG(F):"";_.push('<rect transform="'+U+" translate(",A/2,",",T/2,')"',' x="',D.offsetX-A/2,'" y="',D.offsetY-T/2,'" ','width="',"repeat-y"===M||"no-repeat"===M?D.source.width:A,'" height="',"repeat-x"===M||"no-repeat"===M?D.source.height:T,'" fill="url(#SVGID_'+D.id+')"',"></rect>\n")}else _.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',D,'"',"></rect>\n")},sendToBack:function(_){if(!_)return this;var C,D,E,A=this._activeObject;if(_===A&&"activeSelection"===_.type)for(C=(E=A._objects).length;C--;)d(this._objects,D=E[C]),this._objects.unshift(D);else d(this._objects,_),this._objects.unshift(_);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(_){if(!_)return this;var C,D,E,A=this._activeObject;if(_===A&&"activeSelection"===_.type)for(E=A._objects,C=0;C<E.length;C++)d(this._objects,D=E[C]),this._objects.push(D);else d(this._objects,_),this._objects.push(_);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(_,C){if(!_)return this;var D,E,A,T,M,F=this._activeObject,U=0;if(_===F&&"activeSelection"===_.type)for(M=F._objects,D=0;D<M.length;D++)(A=this._objects.indexOf(E=M[D]))>0+U&&(T=A-1,d(this._objects,E),this._objects.splice(T,0,E)),U++;else 0!==(A=this._objects.indexOf(_))&&(T=this._findNewLowerIndex(_,A,C),d(this._objects,_),this._objects.splice(T,0,_));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(_,C,D){var E,A;if(D){for(E=C,A=C-1;A>=0;--A)if(_.intersectsWithObject(this._objects[A])||_.isContainedWithinObject(this._objects[A])||this._objects[A].isContainedWithinObject(_)){E=A;break}}else E=C-1;return E},bringForward:function(_,C){if(!_)return this;var D,E,A,T,M,F=this._activeObject,U=0;if(_===F&&"activeSelection"===_.type)for(D=(M=F._objects).length;D--;)(A=this._objects.indexOf(E=M[D]))<this._objects.length-1-U&&(T=A+1,d(this._objects,E),this._objects.splice(T,0,E)),U++;else(A=this._objects.indexOf(_))!==this._objects.length-1&&(T=this._findNewUpperIndex(_,A,C),d(this._objects,_),this._objects.splice(T,0,_));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(_,C,D){var E,A,T;if(D){for(E=C,A=C+1,T=this._objects.length;A<T;++A)if(_.intersectsWithObject(this._objects[A])||_.isContainedWithinObject(this._objects[A])||this._objects[A].isContainedWithinObject(_)){E=A;break}}else E=C+1;return E},moveTo:function(_,C){return d(this._objects,_),this._objects.splice(C,0,_),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(S.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(_){_.dispose&&_.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),S.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),S.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),h(S.StaticCanvas.prototype,S.Observable),h(S.StaticCanvas.prototype,S.Collection),h(S.StaticCanvas.prototype,S.DataURLExporter),h(S.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(_){var C=y();if(!C||!C.getContext)return null;var D=C.getContext("2d");return D&&"setLineDash"===_?void 0!==D.setLineDash:null}}),S.StaticCanvas.prototype.toJSON=S.StaticCanvas.prototype.toObject,S.isLikelyNode&&(S.StaticCanvas.prototype.createPNGStream=function(){var _=f(this.lowerCanvasEl);return _&&_.createPNGStream()},S.StaticCanvas.prototype.createJPEGStream=function(_){var C=f(this.lowerCanvasEl);return C&&C.createJPEGStream(_)})}}(),S.BaseBrush=S.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(h){h.strokeStyle=this.color,h.lineWidth=this.width,h.lineCap=this.strokeLineCap,h.miterLimit=this.strokeMiterLimit,h.lineJoin=this.strokeLineJoin,h.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(h){var c=this.canvas.viewportTransform;h.save(),h.transform(c[0],c[1],c[2],c[3],c[4],c[5])},_setShadow:function(){if(this.shadow){var h=this.canvas,c=this.shadow,d=h.contextTop,p=h.getZoom();h&&h._isRetinaScaling()&&(p*=S.devicePixelRatio),d.shadowColor=c.color,d.shadowBlur=c.blur*p,d.shadowOffsetX=c.offsetX*p,d.shadowOffsetY=c.offsetY*p}},needsFullRender:function(){return new S.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var h=this.canvas.contextTop;h.shadowColor="",h.shadowBlur=h.shadowOffsetX=h.shadowOffsetY=0},_isOutSideCanvas:function(h){return h.x<0||h.x>this.canvas.getWidth()||h.y<0||h.y>this.canvas.getHeight()}}),S.PencilBrush=S.util.createClass(S.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(h){this.canvas=h,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(h,c,d){var p=c.midPointFrom(d);return h.quadraticCurveTo(c.x,c.y,p.x,p.y),p},onMouseDown:function(h,c){this.canvas._isMainEvent(c.e)&&(this.drawStraightLine=c.e[this.straightLineKey],this._prepareForDrawing(h),this._captureDrawingPath(h),this._render())},onMouseMove:function(h,c){if(this.canvas._isMainEvent(c.e)&&(this.drawStraightLine=c.e[this.straightLineKey],(!0!==this.limitedToCanvasSize||!this._isOutSideCanvas(h))&&this._captureDrawingPath(h)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var d=this._points,p=d.length,a=this.canvas.contextTop;this._saveAndTransform(a),this.oldEnd&&(a.beginPath(),a.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(a,d[p-2],d[p-1],!0),a.stroke(),a.restore()}},onMouseUp:function(h){return!this.canvas._isMainEvent(h.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(h){var c=new S.Point(h.x,h.y);this._reset(),this._addPoint(c),this.canvas.contextTop.moveTo(c.x,c.y)},_addPoint:function(h){return!(this._points.length>1&&h.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(h),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(h){var c=new S.Point(h.x,h.y);return this._addPoint(c)},_render:function(h){var c,d,p=this._points[0],a=this._points[1];if(this._saveAndTransform(h=h||this.canvas.contextTop),h.beginPath(),2===this._points.length&&p.x===a.x&&p.y===a.y){var l=this.width/1e3;p=new S.Point(p.x,p.y),a=new S.Point(a.x,a.y),p.x-=l,a.x+=l}for(h.moveTo(p.x,p.y),c=1,d=this._points.length;c<d;c++)this._drawSegment(h,p,a),p=this._points[c],a=this._points[c+1];h.lineTo(p.x,p.y),h.stroke(),h.restore()},convertPointsToSVGPath:function(h){return S.util.getSmoothPathFromPoints(h,this.width/1e3)},_isEmptySVGPath:function(h){return"M 0 0 Q 0 0 0 0 L 0 0"===S.util.joinPath(h)},createPath:function(h){var c=new S.Path(h,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,c.shadow=new S.Shadow(this.shadow)),c},decimatePoints:function(h,c){if(h.length<=2)return h;var d,p=this.canvas.getZoom(),a=Math.pow(c/p,2),l=h.length-1,f=h[0],y=[f];for(d=1;d<l-1;d++)Math.pow(f.x-h[d].x,2)+Math.pow(f.y-h[d].y,2)>=a&&y.push(f=h[d]);return y.push(h[l]),y},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var h=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(h))this.canvas.requestRenderAll();else{var c=this.createPath(h);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.requestRenderAll(),c.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:c})}}}),S.CircleBrush=S.util.createClass(S.BaseBrush,{width:10,initialize:function(h){this.canvas=h,this.points=[]},drawDot:function(h){var c=this.addPoint(h),d=this.canvas.contextTop;this._saveAndTransform(d),this.dot(d,c),d.restore()},dot:function(h,c){h.fillStyle=c.fill,h.beginPath(),h.arc(c.x,c.y,c.radius,0,2*Math.PI,!1),h.closePath(),h.fill()},onMouseDown:function(h){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(h)},_render:function(){var h,c,d=this.canvas.contextTop,p=this.points;for(this._saveAndTransform(d),h=0,c=p.length;h<c;h++)this.dot(d,p[h]);d.restore()},onMouseMove:function(h){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(h)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(h),this._render()):this.drawDot(h))},onMouseUp:function(){var h,c,d=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var p=[];for(h=0,c=this.points.length;h<c;h++){var a=this.points[h],l=new S.Circle({radius:a.radius,left:a.x,top:a.y,originX:"center",originY:"center",fill:a.fill});this.shadow&&(l.shadow=new S.Shadow(this.shadow)),p.push(l)}var f=new S.Group(p);f.canvas=this.canvas,this.canvas.fire("before:path:created",{path:f}),this.canvas.add(f),this.canvas.fire("path:created",{path:f}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=d,this.canvas.requestRenderAll()},addPoint:function(h){var c=new S.Point(h.x,h.y),d=S.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,p=new S.Color(this.color).setAlpha(S.util.getRandomInt(0,100)/100).toRgba();return c.radius=d,c.fill=p,this.points.push(c),c}}),S.SprayBrush=S.util.createClass(S.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(h){this.canvas=h,this.sprayChunks=[]},onMouseDown:function(h){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(h),this.render(this.sprayChunkPoints)},onMouseMove:function(h){!0===this.limitedToCanvasSize&&this._isOutSideCanvas(h)||(this.addSprayChunk(h),this.render(this.sprayChunkPoints))},onMouseUp:function(){var h=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var c=[],d=0,p=this.sprayChunks.length;d<p;d++)for(var a=this.sprayChunks[d],l=0,f=a.length;l<f;l++){var y=new S.Rect({width:a[l].width,height:a[l].width,left:a[l].x+1,top:a[l].y+1,originX:"center",originY:"center",fill:this.color});c.push(y)}this.optimizeOverlapping&&(c=this._getOptimizedRects(c));var m=new S.Group(c);this.shadow&&m.set("shadow",new S.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:m}),this.canvas.add(m),this.canvas.fire("path:created",{path:m}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=h,this.canvas.requestRenderAll()},_getOptimizedRects:function(h){var c,d,p,a={};for(d=0,p=h.length;d<p;d++)a[c=h[d].left+""+h[d].top]||(a[c]=h[d]);var l=[];for(c in a)l.push(a[c]);return l},render:function(h){var c,d,p=this.canvas.contextTop;for(p.fillStyle=this.color,this._saveAndTransform(p),c=0,d=h.length;c<d;c++){var a=h[c];void 0!==a.opacity&&(p.globalAlpha=a.opacity),p.fillRect(a.x,a.y,a.width,a.width)}p.restore()},_render:function(){var h,c,d=this.canvas.contextTop;for(d.fillStyle=this.color,this._saveAndTransform(d),h=0,c=this.sprayChunks.length;h<c;h++)this.render(this.sprayChunks[h]);d.restore()},addSprayChunk:function(h){this.sprayChunkPoints=[];var c,d,p,a,l=this.width/2;for(a=0;a<this.density;a++){c=S.util.getRandomInt(h.x-l,h.x+l),d=S.util.getRandomInt(h.y-l,h.y+l),p=this.dotWidthVariance?S.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var f=new S.Point(c,d);f.width=p,this.randomOpacity&&(f.opacity=S.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(f)}this.sprayChunks.push(this.sprayChunkPoints)}}),S.PatternBrush=S.util.createClass(S.PencilBrush,{getPatternSrc:function(){var h=S.util.createCanvasElement(),c=h.getContext("2d");return h.width=h.height=25,c.fillStyle=this.color,c.beginPath(),c.arc(10,10,10,0,2*Math.PI,!1),c.closePath(),c.fill(),h},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(h){return h.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(h){this.callSuper("_setBrushStyles",h),h.strokeStyle=this.getPattern(h)},createPath:function(h){var c=this.callSuper("createPath",h),d=c._getLeftTopCoords().scalarAdd(c.strokeWidth/2);return c.stroke=new S.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-d.x,offsetY:-d.y}),c}}),function(){var h=S.util.getPointer,c=S.util.degreesToRadians,d=S.util.isTouchEvent;for(var p in S.Canvas=S.util.createClass(S.StaticCanvas,{initialize:function(a,l){l||(l={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(a,l),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=S.PencilBrush&&new S.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var a,l,f,y=this.getActiveObjects();if(y.length>0&&!this.preserveObjectStacking){l=[],f=[];for(var m=0,_=this._objects.length;m<_;m++)-1===y.indexOf(a=this._objects[m])?l.push(a):f.push(a);y.length>1&&(this._activeObject._objects=f),l.push.apply(l,f)}else l=this._objects;return l},renderAll:function(){return!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1),this.renderCanvas(this.contextContainer,this._chooseObjectsToRender()),this},renderTopLayer:function(a){a.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(a),this.contextTopDirty=!0),a.restore()},renderTop:function(){var a=this.contextTop;return this.clearContext(a),this.renderTopLayer(a),this.fire("after:render"),this},_normalizePointer:function(a,l){var f=a.calcTransformMatrix(),y=S.util.invertTransform(f),m=this.restorePointerVpt(l);return S.util.transformPoint(m,y)},isTargetTransparent:function(a,l,f){if(a.shouldCache()&&a._cacheCanvas&&a!==this._activeObject){var y=this._normalizePointer(a,{x:l,y:f}),m=Math.max(a.cacheTranslationX+y.x*a.zoomX,0),_=Math.max(a.cacheTranslationY+y.y*a.zoomY,0);return S.util.isTransparent(a._cacheContext,Math.round(m),Math.round(_),this.targetFindTolerance)}var C=this.contextCache,D=a.selectionBackgroundColor,E=this.viewportTransform;return a.selectionBackgroundColor="",this.clearContext(C),C.save(),C.transform(E[0],E[1],E[2],E[3],E[4],E[5]),a.render(C),C.restore(),a.selectionBackgroundColor=D,S.util.isTransparent(C,l,f,this.targetFindTolerance)},_isSelectionKeyPressed:function(a){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(l){return!0===a[l]}):a[this.selectionKey]},_shouldClearSelection:function(a,l){var f=this.getActiveObjects(),y=this._activeObject;return!l||l&&y&&f.length>1&&-1===f.indexOf(l)&&y!==l&&!this._isSelectionKeyPressed(a)||l&&!l.evented||l&&!l.selectable&&y&&y!==l},_shouldCenterTransform:function(a,l,f){var y;if(a)return"scale"===l||"scaleX"===l||"scaleY"===l||"resizing"===l?y=this.centeredScaling||a.centeredScaling:"rotate"===l&&(y=this.centeredRotation||a.centeredRotation),y?!f:f},_getOriginFromCorner:function(a,l){var f={x:a.originX,y:a.originY};return"ml"===l||"tl"===l||"bl"===l?f.x="right":"mr"!==l&&"tr"!==l&&"br"!==l||(f.x="left"),"tl"===l||"mt"===l||"tr"===l?f.y="bottom":"bl"!==l&&"mb"!==l&&"br"!==l||(f.y="top"),f},_getActionFromCorner:function(a,l,f,y){if(!l||!a)return"drag";var m=y.controls[l];return m.getActionName(f,m,y)},_setupCurrentTransform:function(a,l,f){if(l){var y=this.getPointer(a),m=l.__corner,_=l.controls[m],C=f&&m?_.getActionHandler(a,l,_):S.controlsUtils.dragHandler,D=this._getActionFromCorner(f,m,a,l),E=this._getOriginFromCorner(l,m),A=a[this.centeredKey],T={target:l,action:D,actionHandler:C,corner:m,scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,offsetX:y.x-l.left,offsetY:y.y-l.top,originX:E.x,originY:E.y,ex:y.x,ey:y.y,lastX:y.x,lastY:y.y,theta:c(l.angle),width:l.width*l.scaleX,shiftKey:a.shiftKey,altKey:A,original:S.util.saveObjectTransform(l)};this._shouldCenterTransform(l,D,A)&&(T.originX="center",T.originY="center"),T.original.originX=E.x,T.original.originY=E.y,this._currentTransform=T,this._beforeTransform(a)}},setCursor:function(a){this.upperCanvasEl.style.cursor=a},_drawSelection:function(a){var l=this._groupSelector,f=new S.Point(l.ex,l.ey),y=S.util.transformPoint(f,this.viewportTransform),m=new S.Point(l.ex+l.left,l.ey+l.top),_=S.util.transformPoint(m,this.viewportTransform),C=Math.min(y.x,_.x),D=Math.min(y.y,_.y),E=Math.max(y.x,_.x),A=Math.max(y.y,_.y),T=this.selectionLineWidth/2;this.selectionColor&&(a.fillStyle=this.selectionColor,a.fillRect(C,D,E-C,A-D)),this.selectionLineWidth&&this.selectionBorderColor&&(a.lineWidth=this.selectionLineWidth,a.strokeStyle=this.selectionBorderColor,C+=T,D+=T,E-=T,A-=T,S.Object.prototype._setLineDash.call(this,a,this.selectionDashArray),a.strokeRect(C,D,E-C,A-D))},findTarget:function(a,l){if(!this.skipTargetFind){var f,y,m=this.getPointer(a,!0),_=this._activeObject,C=this.getActiveObjects(),D=d(a),E=C.length>1&&!l||1===C.length;if(this.targets=[],E&&_._findTargetCorner(m,D)||C.length>1&&!l&&_===this._searchPossibleTargets([_],m))return _;if(1===C.length&&_===this._searchPossibleTargets([_],m)){if(!this.preserveObjectStacking)return _;f=_,y=this.targets,this.targets=[]}var A=this._searchPossibleTargets(this._objects,m);return a[this.altSelectionKey]&&A&&f&&A!==f&&(A=f,this.targets=y),A}},_checkTarget:function(a,l,f){if(l&&l.visible&&l.evented&&l.containsPoint(a)&&(!this.perPixelTargetFind&&!l.perPixelTargetFind||l.isEditing||!this.isTargetTransparent(l,f.x,f.y)))return!0},_searchPossibleTargets:function(a,l){for(var f,y,m=a.length;m--;){var _=a[m],C=_.group?this._normalizePointer(_.group,l):l;if(this._checkTarget(C,_,l)){(f=a[m]).subTargetCheck&&f instanceof S.Group&&(y=this._searchPossibleTargets(f._objects,l))&&this.targets.push(y);break}}return f},restorePointerVpt:function(a){return S.util.transformPoint(a,S.util.invertTransform(this.viewportTransform))},getPointer:function(a,l){if(this._absolutePointer&&!l)return this._absolutePointer;if(this._pointer&&l)return this._pointer;var f,y=h(a),m=this.upperCanvasEl,_=m.getBoundingClientRect(),C=_.width||0,D=_.height||0;C&&D||("top"in _&&"bottom"in _&&(D=Math.abs(_.top-_.bottom)),"right"in _&&"left"in _&&(C=Math.abs(_.right-_.left))),this.calcOffset(),y.x=y.x-this._offset.left,y.y=y.y-this._offset.top,l||(y=this.restorePointerVpt(y));var E=this.getRetinaScaling();return 1!==E&&(y.x/=E,y.y/=E),{x:y.x*(f=0===C||0===D?{width:1,height:1}:{width:m.width/C,height:m.height/D}).width,y:y.y*f.height}},_createUpperCanvas:function(){var a=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),l=this.lowerCanvasEl,f=this.upperCanvasEl;f?f.className="":(f=this._createCanvasElement(),this.upperCanvasEl=f),S.util.addClass(f,"upper-canvas "+a),this.wrapperEl.appendChild(f),this._copyCanvasStyle(l,f),this._applyCanvasStyle(f),this.contextTop=f.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=S.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),S.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),S.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(a){var l=this.width||a.width,f=this.height||a.height;S.util.setStyle(a,{position:"absolute",width:l+"px",height:f+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),a.width=l,a.height=f,S.util.makeElementUnselectable(a)},_copyCanvasStyle:function(a,l){l.style.cssText=a.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var a=this._activeObject;return a?"activeSelection"===a.type&&a._objects?a._objects.slice(0):[a]:[]},_onObjectRemoved:function(a){a===this._activeObject&&(this.fire("before:selection:cleared",{target:a}),this._discardActiveObject(),this.fire("selection:cleared",{target:a}),a.fire("deselected")),a===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",a)},_fireSelectionEvents:function(a,l){var f=!1,y=this.getActiveObjects(),m=[],_=[];a.forEach(function(C){-1===y.indexOf(C)&&(f=!0,C.fire("deselected",{e:l,target:C}),_.push(C))}),y.forEach(function(C){-1===a.indexOf(C)&&(f=!0,C.fire("selected",{e:l,target:C}),m.push(C))}),a.length>0&&y.length>0?f&&this.fire("selection:updated",{e:l,selected:m,deselected:_}):y.length>0?this.fire("selection:created",{e:l,selected:m}):a.length>0&&this.fire("selection:cleared",{e:l,deselected:_})},setActiveObject:function(a,l){var f=this.getActiveObjects();return this._setActiveObject(a,l),this._fireSelectionEvents(f,l),this},_setActiveObject:function(a,l){return this._activeObject!==a&&!!this._discardActiveObject(l,a)&&!a.onSelect({e:l})&&(this._activeObject=a,!0)},_discardActiveObject:function(a,l){var f=this._activeObject;if(f){if(f.onDeselect({e:a,object:l}))return!1;this._activeObject=null}return!0},discardActiveObject:function(a){var l=this.getActiveObjects(),f=this.getActiveObject();return l.length&&this.fire("before:selection:cleared",{target:f,e:a}),this._discardActiveObject(a),this._fireSelectionEvents(l,a),this},dispose:function(){var a=this.wrapperEl;return this.removeListeners(),a.removeChild(this.upperCanvasEl),a.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(l){S.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this)),a.parentNode&&a.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,S.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(a){var l=this._activeObject;l&&l._renderControls(a)},_toObject:function(a,l,f){var y=this._realizeGroupTransformOnObject(a),m=this.callSuper("_toObject",a,l,f);return this._unwindGroupTransformOnObject(a,y),m},_realizeGroupTransformOnObject:function(a){if(a.group&&"activeSelection"===a.group.type&&this._activeObject===a.group){var l={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(f){l[f]=a[f]}),S.util.addTransformToObject(a,this._activeObject.calcOwnMatrix()),l}return null},_unwindGroupTransformOnObject:function(a,l){l&&a.set(l)},_setSVGObject:function(a,l,f){var y=this._realizeGroupTransformOnObject(l);this.callSuper("_setSVGObject",a,l,f),this._unwindGroupTransformOnObject(l,y)},setViewportTransform:function(a){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),S.StaticCanvas.prototype.setViewportTransform.call(this,a)}}),S.StaticCanvas)"prototype"!==p&&(S.Canvas[p]=S.StaticCanvas[p])}(),function(){var h=S.util.addListener,c=S.util.removeListener,d={passive:!1};function p(a,l){return a.button&&a.button===l-1}S.util.object.extend(S.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(h,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(a,l){var f=this.upperCanvasEl,y=this._getEventPrefix();a(S.window,"resize",this._onResize),a(f,y+"down",this._onMouseDown),a(f,y+"move",this._onMouseMove,d),a(f,y+"out",this._onMouseOut),a(f,y+"enter",this._onMouseEnter),a(f,"wheel",this._onMouseWheel),a(f,"contextmenu",this._onContextMenu),a(f,"dblclick",this._onDoubleClick),a(f,"dragover",this._onDragOver),a(f,"dragenter",this._onDragEnter),a(f,"dragleave",this._onDragLeave),a(f,"drop",this._onDrop),this.enablePointerEvents||a(f,"touchstart",this._onTouchStart,d),typeof eventjs<"u"&&l in eventjs&&(eventjs[l](f,"gesture",this._onGesture),eventjs[l](f,"drag",this._onDrag),eventjs[l](f,"orientation",this._onOrientationChange),eventjs[l](f,"shake",this._onShake),eventjs[l](f,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(c,"remove");var a=this._getEventPrefix();c(S.document,a+"up",this._onMouseUp),c(S.document,"touchend",this._onTouchEnd,d),c(S.document,a+"move",this._onMouseMove,d),c(S.document,"touchmove",this._onMouseMove,d)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(a,l){this.__onTransformGesture&&this.__onTransformGesture(a,l)},_onDrag:function(a,l){this.__onDrag&&this.__onDrag(a,l)},_onMouseWheel:function(a){this.__onMouseWheel(a)},_onMouseOut:function(a){var l=this._hoveredTarget;this.fire("mouse:out",{target:l,e:a}),this._hoveredTarget=null,l&&l.fire("mouseout",{e:a});var f=this;this._hoveredTargets.forEach(function(y){f.fire("mouse:out",{target:l,e:a}),y&&l.fire("mouseout",{e:a})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(y){y.isEditing&&y.hiddenTextarea.focus()})},_onMouseEnter:function(a){this._currentTransform||this.findTarget(a)||(this.fire("mouse:over",{target:null,e:a}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(a,l){this.__onOrientationChange&&this.__onOrientationChange(a,l)},_onShake:function(a,l){this.__onShake&&this.__onShake(a,l)},_onLongPress:function(a,l){this.__onLongPress&&this.__onLongPress(a,l)},_onDragOver:function(a){a.preventDefault();var l=this._simpleEventHandler("dragover",a);this._fireEnterLeaveEvents(l,a)},_onDrop:function(a){return this._simpleEventHandler("drop:before",a),this._simpleEventHandler("drop",a)},_onContextMenu:function(a){return this.stopContextMenu&&(a.stopPropagation(),a.preventDefault()),!1},_onDoubleClick:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"dblclick"),this._resetTransformEventData(a)},getPointerId:function(a){var l=a.changedTouches;return l?l[0]&&l[0].identifier:this.enablePointerEvents?a.pointerId:-1},_isMainEvent:function(a){return!0===a.isPrimary||!1!==a.isPrimary&&("touchend"===a.type&&0===a.touches.length||!a.changedTouches||a.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(a){a.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(a)),this.__onMouseDown(a),this._resetTransformEventData();var l=this.upperCanvasEl,f=this._getEventPrefix();h(S.document,"touchend",this._onTouchEnd,d),h(S.document,"touchmove",this._onMouseMove,d),c(l,f+"down",this._onMouseDown)},_onMouseDown:function(a){this.__onMouseDown(a),this._resetTransformEventData();var l=this.upperCanvasEl,f=this._getEventPrefix();c(l,f+"move",this._onMouseMove,d),h(S.document,f+"up",this._onMouseUp),h(S.document,f+"move",this._onMouseMove,d)},_onTouchEnd:function(a){if(!(a.touches.length>0)){this.__onMouseUp(a),this._resetTransformEventData(),this.mainTouchId=null;var l=this._getEventPrefix();c(S.document,"touchend",this._onTouchEnd,d),c(S.document,"touchmove",this._onMouseMove,d);var f=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){h(f.upperCanvasEl,l+"down",f._onMouseDown),f._willAddMouseDown=0},400)}},_onMouseUp:function(a){this.__onMouseUp(a),this._resetTransformEventData();var l=this.upperCanvasEl,f=this._getEventPrefix();this._isMainEvent(a)&&(c(S.document,f+"up",this._onMouseUp),c(S.document,f+"move",this._onMouseMove,d),h(l,f+"move",this._onMouseMove,d))},_onMouseMove:function(a){!this.allowTouchScrolling&&a.preventDefault&&a.preventDefault(),this.__onMouseMove(a)},_onResize:function(){this.calcOffset()},_shouldRender:function(a){var l=this._activeObject;return!!(!!l!=!!a||l&&a&&l!==a)||!1},__onMouseUp:function(a){var l,f=this._currentTransform,y=this._groupSelector,m=!1,_=!y||0===y.left&&0===y.top;if(this._cacheTransformEventData(a),l=this._target,this._handleEvent(a,"up:before"),p(a,3))this.fireRightClick&&this._handleEvent(a,"up",3,_);else{if(p(a,2))return this.fireMiddleClick&&this._handleEvent(a,"up",2,_),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(a);else if(this._isMainEvent(a)){if(f&&(this._finalizeCurrentTransform(a),m=f.actionPerformed),!_){var C=l===this._activeObject;this._maybeGroupObjects(a),m||(m=this._shouldRender(l)||!C&&l===this._activeObject)}var D,E;if(l){if(D=l._findTargetCorner(this.getPointer(a,!0),S.util.isTouchEvent(a)),l.selectable&&l!==this._activeObject&&"up"===l.activeOn)this.setActiveObject(l,a),m=!0;else{var A=l.controls[D],T=A&&A.getMouseUpHandler(a,l,A);T&&T(a,f,(E=this.getPointer(a)).x,E.y)}l.isMoving=!1}if(f&&(f.target!==l||f.corner!==D)){var M=f.target&&f.target.controls[f.corner],F=M&&M.getMouseUpHandler(a,l,A);E=E||this.getPointer(a),F&&F(a,f,E.x,E.y)}this._setCursorFromEvent(a,l),this._handleEvent(a,"up",1,_),this._groupSelector=null,this._currentTransform=null,l&&(l.__corner=0),m?this.requestRenderAll():_||this.renderTop()}}},_simpleEventHandler:function(a,l){var f=this.findTarget(l),y=this.targets,m={e:l,target:f,subTargets:y};if(this.fire(a,m),f&&f.fire(a,m),!y)return f;for(var _=0;_<y.length;_++)y[_].fire(a,m);return f},_handleEvent:function(a,l,f,y){var m=this._target,_=this.targets||[],C={e:a,target:m,subTargets:_,button:f||1,isClick:y||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};"up"===l&&(C.currentTarget=this.findTarget(a),C.currentSubTargets=this.targets),this.fire("mouse:"+l,C),m&&m.fire("mouse"+l,C);for(var D=0;D<_.length;D++)_[D].fire("mouse"+l,C)},_finalizeCurrentTransform:function(a){var l=this._currentTransform,f=l.target,y={e:a,target:f,transform:l,action:l.action};f._scaling&&(f._scaling=!1),f.setCoords(),(l.actionPerformed||this.stateful&&f.hasStateChanged())&&this._fire("modified",y)},_onMouseDownInDrawingMode:function(a){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(a).requestRenderAll();var l=this.getPointer(a);this.freeDrawingBrush.onMouseDown(l,{e:a,pointer:l}),this._handleEvent(a,"down")},_onMouseMoveInDrawingMode:function(a){if(this._isCurrentlyDrawing){var l=this.getPointer(a);this.freeDrawingBrush.onMouseMove(l,{e:a,pointer:l})}this.setCursor(this.freeDrawingCursor),this._handleEvent(a,"move")},_onMouseUpInDrawingMode:function(a){var l=this.getPointer(a);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:a,pointer:l}),this._handleEvent(a,"up")},__onMouseDown:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"down:before");var l=this._target;if(p(a,3))this.fireRightClick&&this._handleEvent(a,"down",3);else if(p(a,2))this.fireMiddleClick&&this._handleEvent(a,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(a);else if(this._isMainEvent(a)&&!this._currentTransform){var f=this._pointer;this._previousPointer=f;var y=this._shouldRender(l),m=this._shouldGroup(a,l);if(this._shouldClearSelection(a,l)?this.discardActiveObject(a):m&&(this._handleGrouping(a,l),l=this._activeObject),!this.selection||l&&(l.selectable||l.isEditing||l===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),l){var _=l===this._activeObject;l.selectable&&"down"===l.activeOn&&this.setActiveObject(l,a);var C=l._findTargetCorner(this.getPointer(a,!0),S.util.isTouchEvent(a));if(l.__corner=C,l===this._activeObject&&(C||!m)){this._setupCurrentTransform(a,l,_);var D=l.controls[C],E=(f=this.getPointer(a),D&&D.getMouseDownHandler(a,l,D));E&&E(a,this._currentTransform,f.x,f.y)}}this._handleEvent(a,"down"),(y||m)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(a){this._resetTransformEventData(),this._pointer=this.getPointer(a,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(a)||null},_beforeTransform:function(a){var l=this._currentTransform;this.stateful&&l.target.saveState(),this.fire("before:transform",{e:a,transform:l})},__onMouseMove:function(a){var l,f;if(this._handleEvent(a,"move:before"),this._cacheTransformEventData(a),this.isDrawingMode)this._onMouseMoveInDrawingMode(a);else if(this._isMainEvent(a)){var y=this._groupSelector;y?(y.left=(f=this._absolutePointer).x-y.ex,y.top=f.y-y.ey,this.renderTop()):this._currentTransform?this._transformObject(a):(l=this.findTarget(a)||null,this._setCursorFromEvent(a,l),this._fireOverOutEvents(l,a)),this._handleEvent(a,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(a,l){var f=this._hoveredTarget,y=this._hoveredTargets,m=this.targets,_=Math.max(y.length,m.length);this.fireSyntheticInOutEvents(a,l,{oldTarget:f,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var C=0;C<_;C++)this.fireSyntheticInOutEvents(m[C],l,{oldTarget:y[C],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(a,l){var f=this._draggedoverTarget,y=this._hoveredTargets,m=this.targets,_=Math.max(y.length,m.length);this.fireSyntheticInOutEvents(a,l,{oldTarget:f,evtOut:"dragleave",evtIn:"dragenter"});for(var C=0;C<_;C++)this.fireSyntheticInOutEvents(m[C],l,{oldTarget:y[C],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=a},fireSyntheticInOutEvents:function(a,l,f){var y,m,_,C=f.oldTarget,D=C!==a,E=f.canvasEvtIn,A=f.canvasEvtOut;D&&(y={e:l,target:a,previousTarget:C},m={e:l,target:C,nextTarget:a}),_=a&&D,C&&D&&(A&&this.fire(A,m),C.fire(f.evtOut,m)),_&&(E&&this.fire(E,y),a.fire(f.evtIn,y))},__onMouseWheel:function(a){this._cacheTransformEventData(a),this._handleEvent(a,"wheel"),this._resetTransformEventData()},_transformObject:function(a){var l=this.getPointer(a),f=this._currentTransform;f.reset=!1,f.shiftKey=a.shiftKey,f.altKey=a[this.centeredKey],this._performTransformAction(a,f,l),f.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(a,l,f){var _=l.action,C=!1,D=l.actionHandler;D&&(C=D(a,l,f.x,f.y)),"drag"===_&&C&&(l.target.isMoving=!0,this.setCursor(l.target.moveCursor||this.moveCursor)),l.actionPerformed=l.actionPerformed||C},_fire:S.controlsUtils.fireEvent,_setCursorFromEvent:function(a,l){if(!l)return this.setCursor(this.defaultCursor),!1;var f=l.hoverCursor||this.hoverCursor,y=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,m=(!y||!y.contains(l))&&l._findTargetCorner(this.getPointer(a,!0));m?this.setCursor(this.getCornerCursor(m,l,a)):(l.subTargetCheck&&this.targets.concat().reverse().map(function(_){f=_.hoverCursor||f}),this.setCursor(f))},getCornerCursor:function(a,l,f){var y=l.controls[a];return y.cursorStyleHandler(f,y,l)}})}(),W=Math.min,L=Math.max,S.util.object.extend(S.Canvas.prototype,{_shouldGroup:function(h,c){var d=this._activeObject;return d&&this._isSelectionKeyPressed(h)&&c&&c.selectable&&this.selection&&(d!==c||"activeSelection"===d.type)&&!c.onSelect({e:h})},_handleGrouping:function(h,c){var d=this._activeObject;d.__corner||(c!==d||(c=this.findTarget(h,!0))&&c.selectable)&&(d&&"activeSelection"===d.type?this._updateActiveSelection(c,h):this._createActiveSelection(c,h))},_updateActiveSelection:function(h,c){var d=this._activeObject,p=d._objects.slice(0);d.contains(h)?(d.removeWithUpdate(h),this._hoveredTarget=h,this._hoveredTargets=this.targets.concat(),1===d.size()&&this._setActiveObject(d.item(0),c)):(d.addWithUpdate(h),this._hoveredTarget=d,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(p,c)},_createActiveSelection:function(h,c){var d=this.getActiveObjects(),p=this._createGroup(h);this._hoveredTarget=p,this._setActiveObject(p,c),this._fireSelectionEvents(d,c)},_createGroup:function(h){var c=this._objects,d=c.indexOf(this._activeObject)<c.indexOf(h)?[this._activeObject,h]:[h,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new S.ActiveSelection(d,{canvas:this})},_groupSelectedObjects:function(h){var c,d=this._collectObjects(h);1===d.length?this.setActiveObject(d[0],h):d.length>1&&(c=new S.ActiveSelection(d.reverse(),{canvas:this}),this.setActiveObject(c,h))},_collectObjects:function(h){for(var c,d=[],p=this._groupSelector.ex,a=this._groupSelector.ey,l=p+this._groupSelector.left,f=a+this._groupSelector.top,y=new S.Point(W(p,l),W(a,f)),m=new S.Point(L(p,l),L(a,f)),_=!this.selectionFullyContained,C=p===l&&a===f,D=this._objects.length;D--&&!((c=this._objects[D])&&c.selectable&&c.visible&&(_&&c.intersectsWithRect(y,m,!0)||c.isContainedWithinRect(y,m,!0)||_&&c.containsPoint(y,null,!0)||_&&c.containsPoint(m,null,!0))&&(d.push(c),C)););return d.length>1&&(d=d.filter(function(E){return!E.onSelect({e:h})})),d},_maybeGroupObjects:function(h){this.selection&&this._groupSelector&&this._groupSelectedObjects(h),this.setCursor(this.defaultCursor),this._groupSelector=null}}),S.util.object.extend(S.StaticCanvas.prototype,{toDataURL:function(h){h||(h={});var c=h.format||"png",d=h.quality||1,p=(h.multiplier||1)*(h.enableRetinaScaling?this.getRetinaScaling():1),a=this.toCanvasElement(p,h);return S.util.toDataURL(a,c,d)},toCanvasElement:function(h,c){var d=((c=c||{}).width||this.width)*(h=h||1),p=(c.height||this.height)*h,a=this.getZoom(),l=this.width,f=this.height,y=a*h,m=this.viewportTransform,D=this.interactive,E=[y,0,0,y,(m[4]-(c.left||0))*h,(m[5]-(c.top||0))*h],A=this.enableRetinaScaling,T=S.util.createCanvasElement(),M=this.contextTop;return T.width=d,T.height=p,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=E,this.width=d,this.height=p,this.calcViewportBoundaries(),this.renderCanvas(T.getContext("2d"),this._objects),this.viewportTransform=m,this.width=l,this.height=f,this.calcViewportBoundaries(),this.interactive=D,this.enableRetinaScaling=A,this.contextTop=M,T}}),S.util.object.extend(S.StaticCanvas.prototype,{loadFromJSON:function(h,c,d){if(h){var p="string"==typeof h?JSON.parse(h):S.util.object.clone(h),a=this,l=p.clipPath,f=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete p.clipPath,this._enlivenObjects(p.objects,function(y){a.clear(),a._setBgOverlay(p,function(){l?a._enlivenObjects([l],function(m){a.clipPath=m[0],a.__setupCanvas.call(a,p,y,f,c)}):a.__setupCanvas.call(a,p,y,f,c)})},d),this}},__setupCanvas:function(h,c,d,p){var a=this;c.forEach(function(l,f){a.insertAt(l,f)}),this.renderOnAddRemove=d,delete h.objects,delete h.backgroundImage,delete h.overlayImage,delete h.background,delete h.overlay,this._setOptions(h),this.renderAll(),p&&p()},_setBgOverlay:function(h,c){var d={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(h.backgroundImage||h.overlayImage||h.background||h.overlay){var p=function(){d.backgroundImage&&d.overlayImage&&d.backgroundColor&&d.overlayColor&&c&&c()};this.__setBgOverlay("backgroundImage",h.backgroundImage,d,p),this.__setBgOverlay("overlayImage",h.overlayImage,d,p),this.__setBgOverlay("backgroundColor",h.background,d,p),this.__setBgOverlay("overlayColor",h.overlay,d,p)}else c&&c()},__setBgOverlay:function(h,c,d,p){var a=this;if(!c)return d[h]=!0,void(p&&p());"backgroundImage"===h||"overlayImage"===h?S.util.enlivenObjects([c],function(l){a[h]=l[0],d[h]=!0,p&&p()}):this["set"+S.util.string.capitalize(h,!0)](c,function(){d[h]=!0,p&&p()})},_enlivenObjects:function(h,c,d){h&&0!==h.length?S.util.enlivenObjects(h,function(p){c&&c(p)},null,d):c&&c([])},_toDataURL:function(h,c){this.clone(function(d){c(d.toDataURL(h))})},_toDataURLWithMultiplier:function(h,c,d){this.clone(function(p){d(p.toDataURLWithMultiplier(h,c))})},clone:function(h,c){var d=JSON.stringify(this.toJSON(c));this.cloneWithoutData(function(p){p.loadFromJSON(d,function(){h&&h(p)})})},cloneWithoutData:function(h){var c=S.util.createCanvasElement();c.width=this.width,c.height=this.height;var d=new S.Canvas(c);this.backgroundImage?(d.setBackgroundImage(this.backgroundImage.src,function(){d.renderAll(),h&&h(d)}),d.backgroundImageOpacity=this.backgroundImageOpacity,d.backgroundImageStretch=this.backgroundImageStretch):h&&h(d)}}),function(h){var c=h.fabric||(h.fabric={}),d=c.util.object.extend,p=c.util.object.clone,a=c.util.toFixed,l=c.util.string.capitalize,f=c.util.degreesToRadians;c.Object||(c.Object=c.util.createClass(c.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:!c.isLikelyNode,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(m){m&&this.setOptions(m)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=c.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(m){var _=c.perfLimitSizeTotal,C=m.width,D=m.height,E=c.maxCacheSideLimit,A=c.minCacheSideLimit;if(C<=E&&D<=E&&C*D<=_)return C<A&&(m.width=A),D<A&&(m.height=A),m;var M=c.util.limitDimsByArea(C/D,_),F=c.util.capValue,U=F(A,M.x,E),G=F(A,M.y,E);return C>U&&(m.zoomX/=C/U,m.width=U,m.capped=!0),D>G&&(m.zoomY/=D/G,m.height=G,m.capped=!0),m},_getCacheCanvasDimensions:function(){var m=this.getTotalObjectScaling(),_=this._getTransformedDimensions(0,0),C=_.x*m.scaleX/this.scaleX,D=_.y*m.scaleY/this.scaleY;return{width:C+2,height:D+2,zoomX:m.scaleX,zoomY:m.scaleY,x:C,y:D}},_updateCacheCanvas:function(){var m=this.canvas;if(this.noScaleCache&&m&&m._currentTransform){var C=m._currentTransform.action;if(this===m._currentTransform.target&&C.slice&&"scale"===C.slice(0,5))return!1}var D,E,A=this._cacheCanvas,T=this._limitCacheSize(this._getCacheCanvasDimensions()),M=c.minCacheSideLimit,F=T.width,U=T.height,G=T.zoomX,K=T.zoomY,q=F!==this.cacheWidth||U!==this.cacheHeight,N=q||this.zoomX!==G||this.zoomY!==K,k=0,z=0,J=!1;if(q){var Q=this._cacheCanvas.width,H=this._cacheCanvas.height,j=F>Q||U>H;J=j||(F<.9*Q||U<.9*H)&&Q>M&&H>M,j&&!T.capped&&(F>M||U>M)&&(k=.1*F,z=.1*U)}return this instanceof c.Text&&this.path&&(N=!0,J=!0,k+=this.getHeightOfLine(0)*this.zoomX,z+=this.getHeightOfLine(0)*this.zoomY),!!N&&(J?(A.width=Math.ceil(F+k),A.height=Math.ceil(U+z)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,A.width,A.height)),D=T.x/2,E=T.y/2,this.cacheTranslationX=Math.round(A.width/2-D)+D,this.cacheTranslationY=Math.round(A.height/2-E)+E,this.cacheWidth=F,this.cacheHeight=U,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(G,K),this.zoomX=G,this.zoomY=K,!0)},setOptions:function(m){this._setOptions(m),this._initGradient(m.fill,"fill"),this._initGradient(m.stroke,"stroke"),this._initPattern(m.fill,"fill"),this._initPattern(m.stroke,"stroke")},transform:function(m){var C=this.calcTransformMatrix(!(this.group&&!this.group._transformDone||this.group&&this.canvas&&m===this.canvas.contextTop));m.transform(C[0],C[1],C[2],C[3],C[4],C[5])},toObject:function(m){var _=c.Object.NUM_FRACTION_DIGITS,C={type:this.type,version:c.version,originX:this.originX,originY:this.originY,left:a(this.left,_),top:a(this.top,_),width:a(this.width,_),height:a(this.height,_),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:a(this.strokeWidth,_),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:a(this.strokeMiterLimit,_),scaleX:a(this.scaleX,_),scaleY:a(this.scaleY,_),angle:a(this.angle,_),flipX:this.flipX,flipY:this.flipY,opacity:a(this.opacity,_),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:a(this.skewX,_),skewY:a(this.skewY,_)};return this.clipPath&&!this.clipPath.excludeFromExport&&(C.clipPath=this.clipPath.toObject(m),C.clipPath.inverted=this.clipPath.inverted,C.clipPath.absolutePositioned=this.clipPath.absolutePositioned),c.util.populateWithProperties(this,C,m),this.includeDefaultValues||(C=this._removeDefaultValues(C)),C},toDatalessObject:function(m){return this.toObject(m)},_removeDefaultValues:function(m){var _=c.util.getKlass(m.type).prototype;return _.stateProperties.forEach(function(C){"left"!==C&&"top"!==C&&(m[C]===_[C]&&delete m[C],Array.isArray(m[C])&&Array.isArray(_[C])&&0===m[C].length&&0===_[C].length&&delete m[C])}),m},toString:function(){return"#<fabric."+l(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var m=c.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(m.scaleX),scaleY:Math.abs(m.scaleY)}},getTotalObjectScaling:function(){var m=this.getObjectScaling(),_=m.scaleX,C=m.scaleY;if(this.canvas){var D=this.canvas.getZoom(),E=this.canvas.getRetinaScaling();_*=D*E,C*=D*E}return{scaleX:_,scaleY:C}},getObjectOpacity:function(){var m=this.opacity;return this.group&&(m*=this.group.getObjectOpacity()),m},_set:function(m,_){var D=this[m]!==_,E=!1;return("scaleX"===m||"scaleY"===m)&&(_=this._constrainScale(_)),"scaleX"===m&&_<0?(this.flipX=!this.flipX,_*=-1):"scaleY"===m&&_<0?(this.flipY=!this.flipY,_*=-1):"shadow"!==m||!_||_ instanceof c.Shadow?"dirty"===m&&this.group&&this.group.set("dirty",_):_=new c.Shadow(_),this[m]=_,D&&(E=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(m)>-1?(this.dirty=!0,E&&this.group.set("dirty",!0)):E&&this.stateProperties.indexOf(m)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:c.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||!this.width&&!this.height&&0===this.strokeWidth||!this.visible},render:function(m){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(m.save(),this._setupCompositeOperation(m),this.drawSelectionBackground(m),this.transform(m),this._setOpacity(m),this._setShadow(m,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(m)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(m),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),m.restore())},renderCache:function(m){m=m||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,m.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&"transparent"!==this.stroke&&0!==this.strokeWidth},hasFill:function(){return this.fill&&"transparent"!==this.fill},needsItsOwnCache:function(){return!("stroke"!==this.paintFirst||!this.hasFill()||!this.hasStroke()||"object"!=typeof this.shadow)||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawClipPathOnCache:function(m,_){if(m.save(),m.globalCompositeOperation=_.inverted?"destination-out":"destination-in",_.absolutePositioned){var C=c.util.invertTransform(this.calcTransformMatrix());m.transform(C[0],C[1],C[2],C[3],C[4],C[5])}_.transform(m),m.scale(1/_.zoomX,1/_.zoomY),m.drawImage(_._cacheCanvas,-_.cacheTranslationX,-_.cacheTranslationY),m.restore()},drawObject:function(m,_){var C=this.fill,D=this.stroke;_?(this.fill="black",this.stroke="",this._setClippingProperties(m)):this._renderBackground(m),this._render(m),this._drawClipPath(m,this.clipPath),this.fill=C,this.stroke=D},_drawClipPath:function(m,_){_&&(_.canvas=this.canvas,_.shouldCache(),_._transformDone=!0,_.renderCache({forClipping:!0}),this.drawClipPathOnCache(m,_))},drawCacheOnCanvas:function(m){m.scale(1/this.zoomX,1/this.zoomY),m.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(m){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!m&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!m){var _=this.cacheWidth/this.zoomX,C=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-_/2,-C/2,_,C)}return!0}return!1},_renderBackground:function(m){if(this.backgroundColor){var _=this._getNonTransformedDimensions();m.fillStyle=this.backgroundColor,m.fillRect(-_.x/2,-_.y/2,_.x,_.y),this._removeShadow(m)}},_setOpacity:function(m){this.group&&!this.group._transformDone?m.globalAlpha=this.getObjectOpacity():m.globalAlpha*=this.opacity},_setStrokeStyles:function(m,_){var C=_.stroke;C&&(m.lineWidth=_.strokeWidth,m.lineCap=_.strokeLineCap,m.lineDashOffset=_.strokeDashOffset,m.lineJoin=_.strokeLineJoin,m.miterLimit=_.strokeMiterLimit,C.toLive?"percentage"===C.gradientUnits||C.gradientTransform||C.patternTransform?this._applyPatternForTransformedGradient(m,C):(m.strokeStyle=C.toLive(m,this),this._applyPatternGradientTransform(m,C)):m.strokeStyle=_.stroke)},_setFillStyles:function(m,_){var C=_.fill;C&&(C.toLive?(m.fillStyle=C.toLive(m,this),this._applyPatternGradientTransform(m,_.fill)):m.fillStyle=C)},_setClippingProperties:function(m){m.globalAlpha=1,m.strokeStyle="transparent",m.fillStyle="#000000"},_setLineDash:function(m,_){_&&0!==_.length&&(1&_.length&&_.push.apply(_,_),m.setLineDash(_))},_renderControls:function(m,_){var C,D,E,A=this.getViewportTransform(),T=this.calcTransformMatrix();D=void 0!==(_=_||{}).hasBorders?_.hasBorders:this.hasBorders,E=void 0!==_.hasControls?_.hasControls:this.hasControls,T=c.util.multiplyTransformMatrices(A,T),C=c.util.qrDecompose(T),m.save(),m.translate(C.translateX,C.translateY),m.lineWidth=1*this.borderScaleFactor,this.group||(m.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(C.angle-=180),m.rotate(f(this.group?C.angle:this.angle)),_.forActiveSelection||this.group?D&&this.drawBordersInGroup(m,C,_):D&&this.drawBorders(m,_),E&&this.drawControls(m,_),m.restore()},_setShadow:function(m){if(this.shadow){var _,C=this.shadow,D=this.canvas,E=D&&D.viewportTransform[0]||1,A=D&&D.viewportTransform[3]||1;_=C.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),D&&D._isRetinaScaling()&&(E*=c.devicePixelRatio,A*=c.devicePixelRatio),m.shadowColor=C.color,m.shadowBlur=C.blur*c.browserShadowBlurConstant*(E+A)*(_.scaleX+_.scaleY)/4,m.shadowOffsetX=C.offsetX*E*_.scaleX,m.shadowOffsetY=C.offsetY*A*_.scaleY}},_removeShadow:function(m){this.shadow&&(m.shadowColor="",m.shadowBlur=m.shadowOffsetX=m.shadowOffsetY=0)},_applyPatternGradientTransform:function(m,_){if(!_||!_.toLive)return{offsetX:0,offsetY:0};var C=_.gradientTransform||_.patternTransform,D=-this.width/2+_.offsetX||0,E=-this.height/2+_.offsetY||0;return"percentage"===_.gradientUnits?m.transform(this.width,0,0,this.height,D,E):m.transform(1,0,0,1,D,E),C&&m.transform(C[0],C[1],C[2],C[3],C[4],C[5]),{offsetX:D,offsetY:E}},_renderPaintInOrder:function(m){"stroke"===this.paintFirst?(this._renderStroke(m),this._renderFill(m)):(this._renderFill(m),this._renderStroke(m))},_render:function(){},_renderFill:function(m){this.fill&&(m.save(),this._setFillStyles(m,this),"evenodd"===this.fillRule?m.fill("evenodd"):m.fill(),m.restore())},_renderStroke:function(m){if(this.stroke&&0!==this.strokeWidth){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(m),m.save(),this.strokeUniform&&this.group){var _=this.getObjectScaling();m.scale(1/_.scaleX,1/_.scaleY)}else this.strokeUniform&&m.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(m,this.strokeDashArray),this._setStrokeStyles(m,this),m.stroke(),m.restore()}},_applyPatternForTransformedGradient:function(m,_){var C,D=this._limitCacheSize(this._getCacheCanvasDimensions()),E=c.util.createCanvasElement(),A=this.canvas.getRetinaScaling(),T=D.x/this.scaleX/A,M=D.y/this.scaleY/A;E.width=T,E.height=M,(C=E.getContext("2d")).beginPath(),C.moveTo(0,0),C.lineTo(T,0),C.lineTo(T,M),C.lineTo(0,M),C.closePath(),C.translate(T/2,M/2),C.scale(D.zoomX/this.scaleX/A,D.zoomY/this.scaleY/A),this._applyPatternGradientTransform(C,_),C.fillStyle=_.toLive(m),C.fill(),m.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),m.scale(A*this.scaleX/D.zoomX,A*this.scaleY/D.zoomY),m.strokeStyle=C.createPattern(E,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var m=c.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",m.scaleX),this.set("scaleY",m.scaleY),this.angle=m.angle,this.skewX=m.skewX,this.skewY=0}},_removeTransformMatrix:function(m){var _=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),_=c.util.transformPoint(_,this.transformMatrix)),this.transformMatrix=null,m&&(this.scaleX*=m.scaleX,this.scaleY*=m.scaleY,this.cropX=m.cropX,this.cropY=m.cropY,_.x+=m.offsetLeft,_.y+=m.offsetTop,this.width=m.width,this.height=m.height),this.setPositionByOrigin(_,"center","center")},clone:function(m,_){var C=this.toObject(_);this.constructor.fromObject?this.constructor.fromObject(C,m):c.Object._fromObject("Object",C,m)},cloneAsImage:function(m,_){var C=this.toCanvasElement(_);return m&&m(new c.Image(C)),this},toCanvasElement:function(m){m||(m={});var _=c.util,C=_.saveObjectTransform(this),D=this.group,E=this.shadow,A=Math.abs,T=(m.multiplier||1)*(m.enableRetinaScaling?c.devicePixelRatio:1);delete this.group,m.withoutTransform&&_.resetObjectTransform(this),m.withoutShadow&&(this.shadow=null);var M,F,G,K=c.util.createCanvasElement(),q=this.getBoundingRect(!0,!0),$=this.shadow,N={x:0,y:0};$&&(F=$.blur,M=$.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),N.x=2*Math.round(A($.offsetX)+F)*A(M.scaleX),N.y=2*Math.round(A($.offsetY)+F)*A(M.scaleY)),G=q.height+N.y,K.width=Math.ceil(q.width+N.x),K.height=Math.ceil(G);var k=new c.StaticCanvas(K,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});"jpeg"===m.format&&(k.backgroundColor="#fff"),this.setPositionByOrigin(new c.Point(k.width/2,k.height/2),"center","center");var z=this.canvas;k.add(this);var J=k.toCanvasElement(T||1,m);return this.shadow=E,this.set("canvas",z),D&&(this.group=D),this.set(C).setCoords(),k._objects=[],k.dispose(),k=null,J},toDataURL:function(m){return m||(m={}),c.util.toDataURL(this.toCanvasElement(m),m.format||"png",m.quality||1)},isType:function(m){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===m},complexity:function(){return 1},toJSON:function(m){return this.toObject(m)},rotate:function(m){var _=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return _&&this._setOriginToCenter(),this.set("angle",m),_&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(m,_){_=_||this.canvas.getPointer(m);var C=new c.Point(_.x,_.y),D=this._getLeftTopCoords();return this.angle&&(C=c.util.rotatePoint(C,D,f(-this.angle))),{x:C.x-D.x,y:C.y-D.y}},_setupCompositeOperation:function(m){this.globalCompositeOperation&&(m.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){c.runningAnimations&&c.runningAnimations.cancelByTarget(this)}}),c.util.createAccessors&&c.util.createAccessors(c.Object),d(c.Object.prototype,c.Observable),c.Object.NUM_FRACTION_DIGITS=2,c.Object.ENLIVEN_PROPS=["clipPath"],c.Object._fromObject=function(m,_,C,D){var E=c[m];_=p(_,!0),c.util.enlivenPatterns([_.fill,_.stroke],function(A){void 0!==A[0]&&(_.fill=A[0]),void 0!==A[1]&&(_.stroke=A[1]),c.util.enlivenObjectEnlivables(_,_,function(){var T=D?new E(_[D],_):new E(_);C&&C(T)})})},c.Object.__uid=0)}(e),X=S.util.degreesToRadians,ee={left:-.5,center:0,right:.5},le={top:-.5,center:0,bottom:.5},S.util.object.extend(S.Object.prototype,{translateToGivenOrigin:function(h,c,d,p,a){var l,f,y,m=h.x,_=h.y;return"string"==typeof c?c=ee[c]:c-=.5,"string"==typeof p?p=ee[p]:p-=.5,"string"==typeof d?d=le[d]:d-=.5,"string"==typeof a?a=le[a]:a-=.5,f=a-d,((l=p-c)||f)&&(y=this._getTransformedDimensions(),m=h.x+l*y.x,_=h.y+f*y.y),new S.Point(m,_)},translateToCenterPoint:function(h,c,d){var p=this.translateToGivenOrigin(h,c,d,"center","center");return this.angle?S.util.rotatePoint(p,h,X(this.angle)):p},translateToOriginPoint:function(h,c,d){var p=this.translateToGivenOrigin(h,"center","center",c,d);return this.angle?S.util.rotatePoint(p,h,X(this.angle)):p},getCenterPoint:function(){var h=new S.Point(this.left,this.top);return this.translateToCenterPoint(h,this.originX,this.originY)},getPointByOrigin:function(h,c){var d=this.getCenterPoint();return this.translateToOriginPoint(d,h,c)},toLocalPoint:function(h,c,d){var p,a,l=this.getCenterPoint();return p=void 0!==c&&void 0!==d?this.translateToGivenOrigin(l,"center","center",c,d):new S.Point(this.left,this.top),a=new S.Point(h.x,h.y),this.angle&&(a=S.util.rotatePoint(a,l,-X(this.angle))),a.subtractEquals(p)},setPositionByOrigin:function(h,c,d){var p=this.translateToCenterPoint(h,c,d),a=this.translateToOriginPoint(p,this.originX,this.originY);this.set("left",a.x),this.set("top",a.y)},adjustPosition:function(h){var c,d,p=X(this.angle),a=this.getScaledWidth(),l=S.util.cos(p)*a,f=S.util.sin(p)*a;this.left+=l*((d="string"==typeof h?ee[h]:h-.5)-(c="string"==typeof this.originX?ee[this.originX]:this.originX-.5)),this.top+=f*(d-c),this.setCoords(),this.originX=h},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var h=this.getCenterPoint();this.originX="center",this.originY="center",this.left=h.x,this.top=h.y},_resetOrigin:function(){var h=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=h.x,this.top=h.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var h=S.util,c=h.degreesToRadians,d=h.multiplyTransformMatrices,p=h.transformPoint;h.object.extend(S.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(a,l){return l?a?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),a?this.aCoords:this.lineCoords)},getCoords:function(a,l){return f=this._getCoords(a,l),[new S.Point(f.tl.x,f.tl.y),new S.Point(f.tr.x,f.tr.y),new S.Point(f.br.x,f.br.y),new S.Point(f.bl.x,f.bl.y)];var f},intersectsWithRect:function(a,l,f,y){var m=this.getCoords(f,y);return"Intersection"===S.Intersection.intersectPolygonRectangle(m,a,l).status},intersectsWithObject:function(a,l,f){return"Intersection"===S.Intersection.intersectPolygonPolygon(this.getCoords(l,f),a.getCoords(l,f)).status||a.isContainedWithinObject(this,l,f)||this.isContainedWithinObject(a,l,f)},isContainedWithinObject:function(a,l,f){for(var y=this.getCoords(l,f),_=0,C=a._getImageLines(l?a.aCoords:a.lineCoords);_<4;_++)if(!a.containsPoint(y[_],C))return!1;return!0},isContainedWithinRect:function(a,l,f,y){var m=this.getBoundingRect(f,y);return m.left>=a.x&&m.left+m.width<=l.x&&m.top>=a.y&&m.top+m.height<=l.y},containsPoint:function(a,l,f,y){var m=this._getCoords(f,y),_=(l=l||this._getImageLines(m),this._findCrossPoints(a,l));return 0!==_&&_%2==1},isOnScreen:function(a){if(!this.canvas)return!1;var l=this.canvas.vptCoords.tl,f=this.canvas.vptCoords.br;return!!this.getCoords(!0,a).some(function(y){return y.x<=f.x&&y.x>=l.x&&y.y<=f.y&&y.y>=l.y})||!!this.intersectsWithRect(l,f,!0,a)||this._containsCenterOfCanvas(l,f,a)},_containsCenterOfCanvas:function(a,l,f){return!!this.containsPoint({x:(a.x+l.x)/2,y:(a.y+l.y)/2},null,!0,f)},isPartiallyOnScreen:function(a){if(!this.canvas)return!1;var l=this.canvas.vptCoords.tl,f=this.canvas.vptCoords.br;return!!this.intersectsWithRect(l,f,!0,a)||this.getCoords(!0,a).every(function(y){return(y.x>=f.x||y.x<=l.x)&&(y.y>=f.y||y.y<=l.y)})&&this._containsCenterOfCanvas(l,f,a)},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_findCrossPoints:function(a,l){var f,y,m,_=0;for(var C in l)if(!((m=l[C]).o.y<a.y&&m.d.y<a.y||m.o.y>=a.y&&m.d.y>=a.y||(m.o.x===m.d.x&&m.o.x>=a.x?y=m.o.x:(f=(m.d.y-m.o.y)/(m.d.x-m.o.x),y=-(a.y-0*a.x-(m.o.y-f*m.o.x))/(0-f)),y>=a.x&&(_+=1),2!==_)))break;return _},getBoundingRect:function(a,l){var f=this.getCoords(a,l);return h.makeBoundingBoxFromPoints(f)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(a){return Math.abs(a)<this.minScaleLimit?a<0?-this.minScaleLimit:this.minScaleLimit:0===a?1e-4:a},scale:function(a){return this._set("scaleX",a),this._set("scaleY",a),this.setCoords()},scaleToWidth:function(a,l){var f=this.getBoundingRect(l).width/this.getScaledWidth();return this.scale(a/this.width/f)},scaleToHeight:function(a,l){var f=this.getBoundingRect(l).height/this.getScaledHeight();return this.scale(a/this.height/f)},calcLineCoords:function(){var a=this.getViewportTransform(),l=this.padding,f=c(this.angle),y=h.cos(f)*l,m=h.sin(f)*l,_=y+m,C=y-m,D=this.calcACoords(),E={tl:p(D.tl,a),tr:p(D.tr,a),bl:p(D.bl,a),br:p(D.br,a)};return l&&(E.tl.x-=C,E.tl.y-=_,E.tr.x+=_,E.tr.y-=C,E.bl.x-=_,E.bl.y+=C,E.br.x+=C,E.br.y+=_),E},calcOCoords:function(){var a=this._calcRotateMatrix(),l=this._calcTranslateMatrix(),f=this.getViewportTransform(),y=d(f,l),m=d(y,a),_=(m=d(m,[1/f[0],0,0,1/f[3],0,0]),this._calculateCurrentDimensions()),C={};return this.forEachControl(function(D,E,A){C[E]=D.positionHandler(_,m,A)}),C},calcACoords:function(){var a=this._calcRotateMatrix(),l=this._calcTranslateMatrix(),f=d(l,a),y=this._getTransformedDimensions(),m=y.x/2,_=y.y/2;return{tl:p({x:-m,y:-_},f),tr:p({x:m,y:-_},f),bl:p({x:-m,y:_},f),br:p({x:m,y:_},f)}},setCoords:function(a){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),a||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return h.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var a=this.getCenterPoint();return[1,0,0,1,a.x,a.y]},transformMatrixKey:function(a){var l="_",f="";return!a&&this.group&&(f=this.group.transformMatrixKey(a)+l),f+this.top+l+this.left+l+this.scaleX+l+this.scaleY+l+this.skewX+l+this.skewY+l+this.angle+l+this.originX+l+this.originY+l+this.width+l+this.height+l+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(a){var l=this.calcOwnMatrix();if(a||!this.group)return l;var f=this.transformMatrixKey(a),y=this.matrixCache||(this.matrixCache={});return y.key===f?y.value:(this.group&&(l=d(this.group.calcTransformMatrix(!1),l)),y.key=f,y.value=l,l)},calcOwnMatrix:function(){var a=this.transformMatrixKey(!0),l=this.ownMatrixCache||(this.ownMatrixCache={});if(l.key===a)return l.value;var f=this._calcTranslateMatrix(),y={angle:this.angle,translateX:f[4],translateY:f[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return l.key=a,l.value=h.composeMatrix(y),l.value},_getNonTransformedDimensions:function(){var a=this.strokeWidth;return{x:this.width+a,y:this.height+a}},_getTransformedDimensions:function(a,l){void 0===a&&(a=this.skewX),void 0===l&&(l=this.skewY);var f,y,m,_=0===a&&0===l;if(this.strokeUniform?(y=this.width,m=this.height):(y=(f=this._getNonTransformedDimensions()).x,m=f.y),_)return this._finalizeDimensions(y*this.scaleX,m*this.scaleY);var C=h.sizeAfterTransform(y,m,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:a,skewY:l});return this._finalizeDimensions(C.x,C.y)},_finalizeDimensions:function(a,l){return this.strokeUniform?{x:a+this.strokeWidth,y:l+this.strokeWidth}:{x:a,y:l}},_calculateCurrentDimensions:function(){var a=this.getViewportTransform(),l=this._getTransformedDimensions();return p(l,a,!0).scalarAdd(2*this.padding)}})}(),S.util.object.extend(S.Object.prototype,{sendToBack:function(){return this.group?S.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?S.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(h){return this.group?S.StaticCanvas.prototype.sendBackwards.call(this.group,this,h):this.canvas&&this.canvas.sendBackwards(this,h),this},bringForward:function(h){return this.group?S.StaticCanvas.prototype.bringForward.call(this.group,this,h):this.canvas&&this.canvas.bringForward(this,h),this},moveTo:function(h){return this.group&&"activeSelection"!==this.group.type?S.StaticCanvas.prototype.moveTo.call(this.group,this,h):this.canvas&&this.canvas.moveTo(this,h),this}}),function(){function h(d,p){if(p){if(p.toLive)return d+": url(#SVGID_"+p.id+"); ";var a=new S.Color(p),l=d+": "+a.toRgb()+"; ",f=a.getAlpha();return 1!==f&&(l+=d+"-opacity: "+f.toString()+"; "),l}return d+": none; "}var c=S.util.toFixed;S.util.object.extend(S.Object.prototype,{getSvgStyles:function(d){var p=this.fillRule?this.fillRule:"nonzero",a=this.strokeWidth?this.strokeWidth:"0",l=this.strokeDashArray?this.strokeDashArray.join(" "):"none",f=this.strokeDashOffset?this.strokeDashOffset:"0",y=this.strokeLineCap?this.strokeLineCap:"butt",m=this.strokeLineJoin?this.strokeLineJoin:"miter",_=this.strokeMiterLimit?this.strokeMiterLimit:"4",C=void 0!==this.opacity?this.opacity:"1",D=this.visible?"":" visibility: hidden;",E=d?"":this.getSvgFilter(),A=h("fill",this.fill);return[h("stroke",this.stroke),"stroke-width: ",a,"; ","stroke-dasharray: ",l,"; ","stroke-linecap: ",y,"; ","stroke-dashoffset: ",f,"; ","stroke-linejoin: ",m,"; ","stroke-miterlimit: ",_,"; ",A,"fill-rule: ",p,"; ","opacity: ",C,";",E,D].join("")},getSvgSpanStyles:function(d,p){var a="; ",l=d.fontFamily?"font-family: "+(-1===d.fontFamily.indexOf("'")&&-1===d.fontFamily.indexOf('"')?"'"+d.fontFamily+"'":d.fontFamily)+a:"",f=d.strokeWidth?"stroke-width: "+d.strokeWidth+a:"",y=d.fontSize?"font-size: "+d.fontSize+"px"+a:"",m=d.fontStyle?"font-style: "+d.fontStyle+a:"",_=d.fontWeight?"font-weight: "+d.fontWeight+a:"",C=d.fill?h("fill",d.fill):"",D=d.stroke?h("stroke",d.stroke):"",E=this.getSvgTextDecoration(d);return E&&(E="text-decoration: "+E+a),[D,f,l,y,m,_,E,C,d.deltaY?"baseline-shift: "+-d.deltaY+"; ":"",p?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(d){return["overline","underline","line-through"].filter(function(p){return d[p.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(d,p){var a=d?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+S.util.matrixToSVG(a)+(p||"")+'" '},_setSVGBg:function(d){if(this.backgroundColor){var p=S.Object.NUM_FRACTION_DIGITS;d.push("\t\t<rect ",this._getFillAttributes(this.backgroundColor),' x="',c(-this.width/2,p),'" y="',c(-this.height/2,p),'" width="',c(this.width,p),'" height="',c(this.height,p),'"></rect>\n')}},toSVG:function(d){return this._createBaseSVGMarkup(this._toSVG(d),{reviver:d})},toClipPathSVG:function(d){return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(d),{reviver:d})},_createBaseClipPathSVGMarkup:function(d,p){var a=(p=p||{}).reviver,f=[this.getSvgTransform(!0,p.additionalTransform||""),this.getSvgCommons()].join(""),y=d.indexOf("COMMON_PARTS");return d[y]=f,a?a(d.join("")):d.join("")},_createBaseSVGMarkup:function(d,p){var a,l,f=(p=p||{}).noStyle,y=p.reviver,m=f?"":'style="'+this.getSvgStyles()+'" ',_=p.withShadow?'style="'+this.getSvgFilter()+'" ':"",C=this.clipPath,D=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",E=C&&C.absolutePositioned,A=this.stroke,T=this.fill,M=this.shadow,F=[],U=d.indexOf("COMMON_PARTS"),G=p.additionalTransform;return C&&(C.clipPathId="CLIPPATH_"+S.Object.__uid++,l='<clipPath id="'+C.clipPathId+'" >\n'+C.toClipPathSVG(y)+"</clipPath>\n"),E&&F.push("<g ",_,this.getSvgCommons()," >\n"),F.push("<g ",this.getSvgTransform(!1),E?"":_+this.getSvgCommons()," >\n"),a=[m,D,f?"":this.addPaintOrder()," ",G?'transform="'+G+'" ':""].join(""),d[U]=a,T&&T.toLive&&F.push(T.toSVG(this)),A&&A.toLive&&F.push(A.toSVG(this)),M&&F.push(M.toSVG(this)),C&&F.push(l),F.push(d.join("")),F.push("</g>\n"),E&&F.push("</g>\n"),y?y(F.join("")):F.join("")},addPaintOrder:function(){return"fill"!==this.paintFirst?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var h=S.util.object.extend,c="stateProperties";function d(a,l,f){var y={};f.forEach(function(m){y[m]=a[m]}),h(a[l],y,!0)}function p(a,l,f){if(a===l)return!0;if(Array.isArray(a)){if(!Array.isArray(l)||a.length!==l.length)return!1;for(var y=0,m=a.length;y<m;y++)if(!p(a[y],l[y]))return!1;return!0}if(a&&"object"==typeof a){var _,C=Object.keys(a);if(!l||"object"!=typeof l||!f&&C.length!==Object.keys(l).length)return!1;for(y=0,m=C.length;y<m;y++)if("canvas"!==(_=C[y])&&"group"!==_&&!p(a[_],l[_]))return!1;return!0}}S.util.object.extend(S.Object.prototype,{hasStateChanged:function(a){var l="_"+(a=a||c);return Object.keys(this[l]).length<this[a].length||!p(this[l],this,!0)},saveState:function(a){var l=a&&a.propertySet||c,f="_"+l;return this[f]?(d(this,f,this[l]),a&&a.stateProperties&&d(this,f,a.stateProperties),this):this.setupState(a)},setupState:function(a){var l=(a=a||{}).propertySet||c;return a.propertySet=l,this["_"+l]={},this.saveState(a),this}})}(),function(){var h=S.util.degreesToRadians;S.util.object.extend(S.Object.prototype,{_findTargetCorner:function(c,d){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var p,a,l,f=c.x,y=c.y,m=Object.keys(this.oCoords),_=m.length-1;for(this.__corner=0;_>=0;_--)if(this.isControlVisible(l=m[_])&&(a=this._getImageLines(d?this.oCoords[l].touchCorner:this.oCoords[l].corner),0!==(p=this._findCrossPoints({x:f,y},a))&&p%2==1))return this.__corner=l,l;return!1},forEachControl:function(c){for(var d in this.controls)c(this.controls[d],d,this)},_setCornerCoords:function(){var c=this.oCoords;for(var d in c){var p=this.controls[d];c[d].corner=p.calcCornerCoords(this.angle,this.cornerSize,c[d].x,c[d].y,!1),c[d].touchCorner=p.calcCornerCoords(this.angle,this.touchCornerSize,c[d].x,c[d].y,!0)}},drawSelectionBackground:function(c){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;c.save();var d=this.getCenterPoint(),p=this._calculateCurrentDimensions(),a=this.canvas.viewportTransform;return c.translate(d.x,d.y),c.scale(1/a[0],1/a[3]),c.rotate(h(this.angle)),c.fillStyle=this.selectionBackgroundColor,c.fillRect(-p.x/2,-p.y/2,p.x,p.y),c.restore(),this},drawBorders:function(c,d){d=d||{};var p=this._calculateCurrentDimensions(),a=this.borderScaleFactor,l=p.x+a,f=p.y+a,y=void 0!==d.hasControls?d.hasControls:this.hasControls,m=!1;return c.save(),c.strokeStyle=d.borderColor||this.borderColor,this._setLineDash(c,d.borderDashArray||this.borderDashArray),c.strokeRect(-l/2,-f/2,l,f),y&&(c.beginPath(),this.forEachControl(function(_,C,D){_.withConnection&&_.getVisibility(D,C)&&(m=!0,c.moveTo(_.x*l,_.y*f),c.lineTo(_.x*l+_.offsetX,_.y*f+_.offsetY))}),m&&c.stroke()),c.restore(),this},drawBordersInGroup:function(c,d,p){p=p||{};var a=S.util.sizeAfterTransform(this.width,this.height,d),l=this.strokeWidth,f=this.strokeUniform,y=this.borderScaleFactor,m=a.x+l*(f?this.canvas.getZoom():d.scaleX)+y,_=a.y+l*(f?this.canvas.getZoom():d.scaleY)+y;return c.save(),this._setLineDash(c,p.borderDashArray||this.borderDashArray),c.strokeStyle=p.borderColor||this.borderColor,c.strokeRect(-m/2,-_/2,m,_),c.restore(),this},drawControls:function(c,d){d=d||{},c.save();var p,a,l=this.canvas.getRetinaScaling();return c.setTransform(l,0,0,l,0,0),c.strokeStyle=c.fillStyle=d.cornerColor||this.cornerColor,this.transparentCorners||(c.strokeStyle=d.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(c,d.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(p=this.group.calcTransformMatrix()),this.forEachControl(function(f,y,m){a=m.oCoords[y],f.getVisibility(m,y)&&(p&&(a=S.util.transformPoint(a,p)),f.render(c,a.x,a.y,d,m))}),c.restore(),this},isControlVisible:function(c){return this.controls[c]&&this.controls[c].getVisibility(this,c)},setControlVisible:function(c,d){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[c]=d,this},setControlsVisibility:function(c){for(var d in c||(c={}),c)this.setControlVisible(d,c[d]);return this},onDeselect:function(){},onSelect:function(){}})}(),S.util.object.extend(S.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(h,c){var d=function(){},p=(c=c||{}).onComplete||d,a=c.onChange||d,l=this;return S.util.animate({target:this,startValue:h.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(f){h.set("left",f),l.requestRenderAll(),a()},onComplete:function(){h.setCoords(),p()}})},fxCenterObjectV:function(h,c){var d=function(){},p=(c=c||{}).onComplete||d,a=c.onChange||d,l=this;return S.util.animate({target:this,startValue:h.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(f){h.set("top",f),l.requestRenderAll(),a()},onComplete:function(){h.setCoords(),p()}})},fxRemove:function(h,c){var d=function(){},p=(c=c||{}).onComplete||d,a=c.onChange||d,l=this;return S.util.animate({target:this,startValue:h.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(f){h.set("opacity",f),l.requestRenderAll(),a()},onComplete:function(){l.remove(h),p()}})}}),S.util.object.extend(S.Object.prototype,{animate:function(){if(arguments[0]&&"object"==typeof arguments[0]){var h,d=[],p=[];for(h in arguments[0])d.push(h);for(var a=0,l=d.length;a<l;a++)p.push(this._animate(h=d[a],arguments[0][h],arguments[1],a!==l-1));return p}return this._animate.apply(this,arguments)},_animate:function(h,c,d,p){var a,l=this;c=c.toString(),d=d?S.util.object.clone(d):{},~h.indexOf(".")&&(a=h.split("."));var f=l.colorProperties.indexOf(h)>-1||a&&l.colorProperties.indexOf(a[1])>-1,y=a?this.get(a[0])[a[1]]:this.get(h);"from"in d||(d.from=y),f||(c=~c.indexOf("=")?y+parseFloat(c.replace("=","")):parseFloat(c));var m={target:this,startValue:d.from,endValue:c,byValue:d.by,easing:d.easing,duration:d.duration,abort:d.abort&&function(_,C,D){return d.abort.call(l,_,C,D)},onChange:function(_,C,D){a?l[a[0]][a[1]]=_:l.set(h,_),p||d.onChange&&d.onChange(_,C,D)},onComplete:function(_,C,D){p||(l.setCoords(),d.onComplete&&d.onComplete(_,C,D))}};return f?S.util.animateColor(m.startValue,m.endValue,m.duration,m):S.util.animate(m)}}),function(h){var c=h.fabric||(h.fabric={}),d=c.util.object.extend,p=c.util.object.clone,a={x1:1,x2:1,y1:1,y2:1};function l(f,y){var m=f.origin,_=f.axis1,C=f.axis2,D=f.dimension,E=y.nearest,A=y.center,T=y.farthest;return function(){switch(this.get(m)){case E:return Math.min(this.get(_),this.get(C));case A:return Math.min(this.get(_),this.get(C))+.5*this.get(D);case T:return Math.max(this.get(_),this.get(C))}}}c.Line?c.warn("fabric.Line is already defined"):(c.Line=c.util.createClass(c.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:c.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(f,y){f||(f=[0,0,0,0]),this.callSuper("initialize",y),this.set("x1",f[0]),this.set("y1",f[1]),this.set("x2",f[2]),this.set("y2",f[3]),this._setWidthHeight(y)},_setWidthHeight:function(f){f||(f={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in f?f.left:this._getLeftToOriginX(),this.top="top"in f?f.top:this._getTopToOriginY()},_set:function(f,y){return this.callSuper("_set",f,y),void 0!==a[f]&&this._setWidthHeight(),this},_getLeftToOriginX:l({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:l({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(f){f.beginPath();var y=this.calcLinePoints();f.moveTo(y.x1,y.y1),f.lineTo(y.x2,y.y2),f.lineWidth=this.strokeWidth;var m=f.strokeStyle;f.strokeStyle=this.stroke||f.fillStyle,this.stroke&&this._renderStroke(f),f.strokeStyle=m},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(f){return d(this.callSuper("toObject",f),this.calcLinePoints())},_getNonTransformedDimensions:function(){var f=this.callSuper("_getNonTransformedDimensions");return"butt"===this.strokeLineCap&&(0===this.width&&(f.y-=this.strokeWidth),0===this.height&&(f.x-=this.strokeWidth)),f},calcLinePoints:function(){var f=this.x1<=this.x2?-1:1,y=this.y1<=this.y2?-1:1;return{x1:f*this.width*.5,x2:f*this.width*-.5,y1:y*this.height*.5,y2:y*this.height*-.5}},_toSVG:function(){var f=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,'" />\n']}}),c.Line.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),c.Line.fromElement=function(f,y,m){m=m||{};var _=c.parseAttributes(f,c.Line.ATTRIBUTE_NAMES);y(new c.Line([_.x1||0,_.y1||0,_.x2||0,_.y2||0],d(_,m)))},c.Line.fromObject=function(f,y){var m=p(f,!0);m.points=[f.x1,f.y1,f.x2,f.y2],c.Object._fromObject("Line",m,function(_){delete _.points,y&&y(_)},"points")})}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.degreesToRadians;c.Circle?c.warn("fabric.Circle is already defined."):(c.Circle=c.util.createClass(c.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:c.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(p,a){return this.callSuper("_set",p,a),"radius"===p&&this.setRadius(a),this},toObject:function(p){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(p))},_toSVG:function(){var p,a=(this.endAngle-this.startAngle)%360;if(0===a)p=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,'" />\n'];else{var l=d(this.startAngle),f=d(this.endAngle),y=this.radius;p=['<path d="M '+c.util.cos(l)*y+" "+c.util.sin(l)*y," A "+y+" "+y," 0 ",+(a>180?"1":"0")+" 1"," "+c.util.cos(f)*y+" "+c.util.sin(f)*y,'" ',"COMMON_PARTS"," />\n"]}return p},_render:function(p){p.beginPath(),p.arc(0,0,this.radius,d(this.startAngle),d(this.endAngle),!1),this._renderPaintInOrder(p)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(p){return this.radius=p,this.set("width",2*p).set("height",2*p)}}),c.Circle.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),c.Circle.fromElement=function(p,a){var l,f=c.parseAttributes(p,c.Circle.ATTRIBUTE_NAMES);if(!("radius"in(l=f)&&l.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");f.left=(f.left||0)-f.radius,f.top=(f.top||0)-f.radius,a(new c.Circle(f))},c.Circle.fromObject=function(p,a){c.Object._fromObject("Circle",p,a)})}(e),function(h){var c=h.fabric||(h.fabric={});c.Triangle?c.warn("fabric.Triangle is already defined"):(c.Triangle=c.util.createClass(c.Object,{type:"triangle",width:100,height:100,_render:function(d){var p=this.width/2,a=this.height/2;d.beginPath(),d.moveTo(-p,a),d.lineTo(0,-a),d.lineTo(p,a),d.closePath(),this._renderPaintInOrder(d)},_toSVG:function(){var d=this.width/2,p=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-d+" "+p,"0 "+-p,d+" "+p].join(","),'" />']}}),c.Triangle.fromObject=function(d,p){return c.Object._fromObject("Triangle",d,p)})}(e),function(h){var c=h.fabric||(h.fabric={}),d=2*Math.PI;c.Ellipse?c.warn("fabric.Ellipse is already defined."):(c.Ellipse=c.util.createClass(c.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:c.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(p){this.callSuper("initialize",p),this.set("rx",p&&p.rx||0),this.set("ry",p&&p.ry||0)},_set:function(p,a){switch(this.callSuper("_set",p,a),p){case"rx":this.rx=a,this.set("width",2*a);break;case"ry":this.ry=a,this.set("height",2*a)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(p){return this.callSuper("toObject",["rx","ry"].concat(p))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,'" />\n']},_render:function(p){p.beginPath(),p.save(),p.transform(1,0,0,this.ry/this.rx,0,0),p.arc(0,0,this.rx,0,d,!1),p.restore(),this._renderPaintInOrder(p)}}),c.Ellipse.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),c.Ellipse.fromElement=function(p,a){var l=c.parseAttributes(p,c.Ellipse.ATTRIBUTE_NAMES);l.left=(l.left||0)-l.rx,l.top=(l.top||0)-l.ry,a(new c.Ellipse(l))},c.Ellipse.fromObject=function(p,a){c.Object._fromObject("Ellipse",p,a)})}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.object.extend;c.Rect?c.warn("fabric.Rect is already defined"):(c.Rect=c.util.createClass(c.Object,{stateProperties:c.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:c.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(p){this.callSuper("initialize",p),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(p){var a=this.rx?Math.min(this.rx,this.width/2):0,l=this.ry?Math.min(this.ry,this.height/2):0,f=this.width,y=this.height,m=-this.width/2,_=-this.height/2,C=0!==a||0!==l,D=.4477152502;p.beginPath(),p.moveTo(m+a,_),p.lineTo(m+f-a,_),C&&p.bezierCurveTo(m+f-D*a,_,m+f,_+D*l,m+f,_+l),p.lineTo(m+f,_+y-l),C&&p.bezierCurveTo(m+f,_+y-D*l,m+f-D*a,_+y,m+f-a,_+y),p.lineTo(m+a,_+y),C&&p.bezierCurveTo(m+D*a,_+y,m,_+y-D*l,m,_+y-l),p.lineTo(m,_+l),C&&p.bezierCurveTo(m,_+D*l,m+D*a,_,m+a,_),p.closePath(),this._renderPaintInOrder(p)},toObject:function(p){return this.callSuper("toObject",["rx","ry"].concat(p))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,'" />\n']}}),c.Rect.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),c.Rect.fromElement=function(p,a,l){if(!p)return a(null);l=l||{};var f=c.parseAttributes(p,c.Rect.ATTRIBUTE_NAMES);f.left=f.left||0,f.top=f.top||0,f.height=f.height||0,f.width=f.width||0;var y=new c.Rect(d(l?c.util.object.clone(l):{},f));y.visible=y.visible&&y.width>0&&y.height>0,a(y)},c.Rect.fromObject=function(p,a){return c.Object._fromObject("Rect",p,a)})}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.object.extend,p=c.util.array.min,a=c.util.array.max,l=c.util.toFixed,f=c.util.projectStrokeOnPoints;c.Polyline?c.warn("fabric.Polyline is already defined"):(c.Polyline=c.util.createClass(c.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:c.Object.prototype.cacheProperties.concat("points"),initialize:function(y,m){m=m||{},this.points=y||[],this.callSuper("initialize",m),this._setPositionDimensions(m)},_projectStrokeOnPoints:function(){return f(this.points,this,!0)},_setPositionDimensions:function(y){var m,_=this._calcDimensions(y),C=this.exactBoundingBox?this.strokeWidth:0;this.width=_.width-C,this.height=_.height-C,y.fromSVG||(m=this.translateToGivenOrigin({x:_.left-this.strokeWidth/2+C/2,y:_.top-this.strokeWidth/2+C/2},"left","top",this.originX,this.originY)),void 0===y.left&&(this.left=y.fromSVG?_.left:m.x),void 0===y.top&&(this.top=y.fromSVG?_.top:m.y),this.pathOffset={x:_.left+this.width/2+C/2,y:_.top+this.height/2+C/2}},_calcDimensions:function(){var y=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,m=p(y,"x")||0,_=p(y,"y")||0;return{left:m,top:_,width:(a(y,"x")||0)-m,height:(a(y,"y")||0)-_}},toObject:function(y){return d(this.callSuper("toObject",y),{points:this.points.concat()})},_toSVG:function(){for(var y=[],m=this.pathOffset.x,_=this.pathOffset.y,C=c.Object.NUM_FRACTION_DIGITS,D=0,E=this.points.length;D<E;D++)y.push(l(this.points[D].x-m,C),",",l(this.points[D].y-_,C)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',y.join(""),'" />\n']},commonRender:function(y){var m,_=this.points.length,C=this.pathOffset.x,D=this.pathOffset.y;if(!_||isNaN(this.points[_-1].y))return!1;y.beginPath(),y.moveTo(this.points[0].x-C,this.points[0].y-D);for(var E=0;E<_;E++)y.lineTo((m=this.points[E]).x-C,m.y-D);return!0},_render:function(y){this.commonRender(y)&&this._renderPaintInOrder(y)},complexity:function(){return this.get("points").length}}),c.Polyline.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polyline.fromElementGenerator=function(y){return function(m,_,C){if(!m)return _(null);C||(C={});var D=c.parsePointsAttribute(m.getAttribute("points")),E=c.parseAttributes(m,c[y].ATTRIBUTE_NAMES);E.fromSVG=!0,_(new c[y](D,d(E,C)))}},c.Polyline.fromElement=c.Polyline.fromElementGenerator("Polyline"),c.Polyline.fromObject=function(y,m){return c.Object._fromObject("Polyline",y,m,"points")})}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.projectStrokeOnPoints;c.Polygon?c.warn("fabric.Polygon is already defined"):(c.Polygon=c.util.createClass(c.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return d(this.points,this)},_render:function(p){this.commonRender(p)&&(p.closePath(),this._renderPaintInOrder(p))}}),c.Polygon.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(),c.Polygon.fromElement=c.Polyline.fromElementGenerator("Polygon"),c.Polygon.fromObject=function(p,a){c.Object._fromObject("Polygon",p,a,"points")})}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.array.min,p=c.util.array.max,a=c.util.object.extend,l=c.util.object.clone,f=c.util.toFixed;c.Path?c.warn("fabric.Path is already defined"):(c.Path=c.util.createClass(c.Object,{type:"path",path:null,cacheProperties:c.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:c.Object.prototype.stateProperties.concat("path"),initialize:function(y,m){delete(m=l(m||{})).path,this.callSuper("initialize",m),this._setPath(y||[],m)},_setPath:function(y,m){this.path=c.util.makePathSimpler(Array.isArray(y)?y:c.util.parsePath(y)),c.Polyline.prototype._setPositionDimensions.call(this,m||{})},_renderPathCommands:function(y){var m,_=0,C=0,D=0,E=0,M=-this.pathOffset.x,F=-this.pathOffset.y;y.beginPath();for(var U=0,G=this.path.length;U<G;++U)switch((m=this.path[U])[0]){case"L":y.lineTo((D=m[1])+M,(E=m[2])+F);break;case"M":_=D=m[1],C=E=m[2],y.moveTo(D+M,E+F);break;case"C":y.bezierCurveTo(m[1]+M,m[2]+F,m[3]+M,m[4]+F,(D=m[5])+M,(E=m[6])+F);break;case"Q":y.quadraticCurveTo(m[1]+M,m[2]+F,m[3]+M,m[4]+F),D=m[3],E=m[4];break;case"z":case"Z":D=_,E=C,y.closePath()}},_render:function(y){this._renderPathCommands(y),this._renderPaintInOrder(y)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(y){return a(this.callSuper("toObject",y),{path:this.path.map(function(m){return m.slice()})})},toDatalessObject:function(y){var m=this.toObject(["sourcePath"].concat(y));return m.sourcePath&&delete m.path,m},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',c.util.joinPath(this.path),'" stroke-linecap="round" ',"/>\n"]},_getOffsetTransform:function(){var y=c.Object.NUM_FRACTION_DIGITS;return" translate("+f(-this.pathOffset.x,y)+", "+f(-this.pathOffset.y,y)+")"},toClipPathSVG:function(y){var m=this._getOffsetTransform();return"\t"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:y,additionalTransform:m})},toSVG:function(y){var m=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:y,additionalTransform:m})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var y,m,_=[],C=[],D=0,E=0,A=0,T=0,M=0,F=this.path.length;M<F;++M){switch((y=this.path[M])[0]){case"L":A=y[1],T=y[2],m=[];break;case"M":D=A=y[1],E=T=y[2],m=[];break;case"C":m=c.util.getBoundsOfCurve(A,T,y[1],y[2],y[3],y[4],y[5],y[6]),A=y[5],T=y[6];break;case"Q":m=c.util.getBoundsOfCurve(A,T,y[1],y[2],y[1],y[2],y[3],y[4]),A=y[3],T=y[4];break;case"z":case"Z":A=D,T=E}m.forEach(function(K){_.push(K.x),C.push(K.y)}),_.push(A),C.push(T)}var U=d(_)||0,G=d(C)||0;return{left:U,top:G,width:(p(_)||0)-U,height:(p(C)||0)-G}}}),c.Path.fromObject=function(y,m){"string"==typeof y.sourcePath?c.loadSVGFromURL(y.sourcePath,function(C){var D=C[0];D.setOptions(y),m&&m(D)}):c.Object._fromObject("Path",y,m,"path")},c.Path.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat(["d"]),c.Path.fromElement=function(y,m,_){var C=c.parseAttributes(y,c.Path.ATTRIBUTE_NAMES);C.fromSVG=!0,m(new c.Path(C.d,a(C,_)))})}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.array.min,p=c.util.array.max;c.Group||(c.Group=c.util.createClass(c.Object,c.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(a,l,f){l=l||{},this._objects=[],f&&this.callSuper("initialize",l),this._objects=a||[];for(var y=this._objects.length;y--;)this._objects[y].group=this;if(f)this._updateObjectsACoords();else{var m=l&&l.centerPoint;void 0!==l.originX&&(this.originX=l.originX),void 0!==l.originY&&(this.originY=l.originY),m||this._calcBounds(),this._updateObjectsCoords(m),delete l.centerPoint,this.callSuper("initialize",l)}this.setCoords()},_updateObjectsACoords:function(){for(var a=this._objects.length;a--;)this._objects[a].setCoords(!0)},_updateObjectsCoords:function(a){a=a||this.getCenterPoint();for(var l=this._objects.length;l--;)this._updateObjectCoords(this._objects[l],a)},_updateObjectCoords:function(a,l){a.set({left:a.left-l.x,top:a.top-l.y}),a.group=this,a.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(a){var l=!!this.group;return this._restoreObjectsState(),c.util.resetObjectTransform(this),a&&(l&&c.util.removeTransformFromObject(a,this.group.calcTransformMatrix()),this._objects.push(a),a.group=this,a._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,l?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(a){return this._restoreObjectsState(),c.util.resetObjectTransform(this),this.remove(a),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(a){this.dirty=!0,a.group=this,a._set("canvas",this.canvas)},_onObjectRemoved:function(a){this.dirty=!0,delete a.group},_set:function(a,l){var f=this._objects.length;if(this.useSetOnGroup)for(;f--;)this._objects[f].setOnGroup(a,l);if("canvas"===a)for(;f--;)this._objects[f]._set(a,l);c.Object.prototype._set.call(this,a,l)},toObject:function(a){var l=this.includeDefaultValues,f=this._objects.filter(function(m){return!m.excludeFromExport}).map(function(m){var _=m.includeDefaultValues;m.includeDefaultValues=l;var C=m.toObject(a);return m.includeDefaultValues=_,C}),y=c.Object.prototype.toObject.call(this,a);return y.objects=f,y},toDatalessObject:function(a){var l,f=this.sourcePath;if(f)l=f;else{var y=this.includeDefaultValues;l=this._objects.map(function(_){var C=_.includeDefaultValues;_.includeDefaultValues=y;var D=_.toDatalessObject(a);return _.includeDefaultValues=C,D})}var m=c.Object.prototype.toDatalessObject.call(this,a);return m.objects=l,m},render:function(a){this._transformDone=!0,this.callSuper("render",a),this._transformDone=!1},shouldCache:function(){var a=c.Object.prototype.shouldCache.call(this);if(a)for(var l=0,f=this._objects.length;l<f;l++)if(this._objects[l].willDrawShadow())return this.ownCaching=!1,!1;return a},willDrawShadow:function(){if(c.Object.prototype.willDrawShadow.call(this))return!0;for(var a=0,l=this._objects.length;a<l;a++)if(this._objects[a].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(a){for(var l=0,f=this._objects.length;l<f;l++)this._objects[l].render(a);this._drawClipPath(a,this.clipPath)},isCacheDirty:function(a){if(this.callSuper("isCacheDirty",a))return!0;if(!this.statefullCache)return!1;for(var l=0,f=this._objects.length;l<f;l++)if(this._objects[l].isCacheDirty(!0)){if(this._cacheCanvas){var y=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-y/2,-m/2,y,m)}return!0}return!1},_restoreObjectsState:function(){var a=this.calcOwnMatrix();return this._objects.forEach(function(l){c.util.addTransformToObject(l,a),delete l.group,l.setCoords()}),this},destroy:function(){return this._objects.forEach(function(a){a.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(a){a.dispose&&a.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var a=this._objects,l=this.canvas;this._objects=[];var f=this.toObject();delete f.objects;var y=new c.ActiveSelection([]);return y.set(f),y.type="activeSelection",l.remove(this),a.forEach(function(m){m.group=y,m.dirty=!0,l.add(m)}),y.canvas=l,y._objects=a,l._activeObject=y,y.setCoords(),y}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(a){a.setCoords(!0)}),this},_calcBounds:function(a){for(var l,f,y,m,_=[],C=[],D=["tr","br","bl","tl"],E=0,A=this._objects.length,T=D.length;E<A;++E){for(y=(l=this._objects[E]).calcACoords(),m=0;m<T;m++)_.push(y[f=D[m]].x),C.push(y[f].y);l.aCoords=y}this._getBounds(_,C,a)},_getBounds:function(a,l,f){var y=new c.Point(d(a),d(l)),m=new c.Point(p(a),p(l)),_=y.y||0,C=y.x||0,E=m.y-y.y||0;this.width=m.x-y.x||0,this.height=E,f||this.setPositionByOrigin({x:C,y:_},"left","top")},_toSVG:function(a){for(var l=["<g ","COMMON_PARTS"," >\n"],f=0,y=this._objects.length;f<y;f++)l.push("\t\t",this._objects[f].toSVG(a));return l.push("</g>\n"),l},getSvgStyles:function(){var l=this.visible?"":" visibility: hidden;";return[void 0!==this.opacity&&1!==this.opacity?"opacity: "+this.opacity+";":"",this.getSvgFilter(),l].join("")},toClipPathSVG:function(a){for(var l=[],f=0,y=this._objects.length;f<y;f++)l.push("\t",this._objects[f].toClipPathSVG(a));return this._createBaseClipPathSVGMarkup(l,{reviver:a})}}),c.Group.fromObject=function(a,l){var f=a.objects,y=c.util.object.clone(a,!0);delete y.objects,"string"!=typeof f?c.util.enlivenObjects(f,function(m){var _=c.util.object.clone(a,!0);delete _.objects,c.util.enlivenObjectEnlivables(a,_,function(){l&&l(new c.Group(m,_,!0))})}):c.loadSVGFromURL(f,function(m){var _=c.util.groupSVGElements(m,a,f);_.set(y),l&&l(_)})})}(e),function(h){var c=h.fabric||(h.fabric={});c.ActiveSelection||(c.ActiveSelection=c.util.createClass(c.Group,{type:"activeSelection",initialize:function(d,p){p=p||{},this._objects=d||[];for(var a=this._objects.length;a--;)this._objects[a].group=this;p.originX&&(this.originX=p.originX),p.originY&&(this.originY=p.originY),this._calcBounds(),this._updateObjectsCoords(),c.Object.prototype.initialize.call(this,p),this.setCoords()},toGroup:function(){var d=this._objects.concat();this._objects=[];var p=c.Object.prototype.toObject.call(this),a=new c.Group([]);if(delete p.type,a.set(p),d.forEach(function(f){f.canvas.remove(f),f.group=a}),a._objects=d,!this.canvas)return a;var l=this.canvas;return l.add(a),l._activeObject=a,a.setCoords(),a},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(d,p,a){d.save(),d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",d,p),void 0===(a=a||{}).hasControls&&(a.hasControls=!1),a.forActiveSelection=!0;for(var l=0,f=this._objects.length;l<f;l++)this._objects[l]._renderControls(d,a);d.restore()}}),c.ActiveSelection.fromObject=function(d,p){c.util.enlivenObjects(d.objects,function(a){delete d.objects,p&&p(new c.ActiveSelection(a,d,!0))})})}(e),function(h){var c=S.util.object.extend;h.fabric||(h.fabric={}),h.fabric.Image?S.warn("fabric.Image is already defined."):(S.Image=S.util.createClass(S.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:S.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:S.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(d,p){p||(p={}),this.filters=[],this.cacheKey="texture"+S.Object.__uid++,this.callSuper("initialize",p),this._initElement(d,p)},getElement:function(){return this._element||{}},setElement:function(d,p){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=d,this._originalElement=d,this._initConfig(p),0!==this.filters.length&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(d){var p=S.filterBackend;p&&p.evictCachesForKey&&p.evictCachesForKey(d)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(d){S.util.cleanUpJsdomNode(this[d]),this[d]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var d=this.getElement();return{width:d.naturalWidth||d.width,height:d.naturalHeight||d.height}},_stroke:function(d){if(this.stroke&&0!==this.strokeWidth){var p=this.width/2,a=this.height/2;d.beginPath(),d.moveTo(-p,-a),d.lineTo(p,-a),d.lineTo(p,a),d.lineTo(-p,a),d.lineTo(-p,-a),d.closePath()}},toObject:function(d){var p=[];this.filters.forEach(function(l){l&&p.push(l.toObject())});var a=c(this.callSuper("toObject",["cropX","cropY"].concat(d)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:p});return this.resizeFilter&&(a.resizeFilter=this.resizeFilter.toObject()),a},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var d,p=[],a=[],l=this._element,f=-this.width/2,y=-this.height/2,m="",_="";if(!l)return[];if(this.hasCrop()){var C=S.Object.__uid++;p.push('<clipPath id="imageCrop_'+C+'">\n','\t<rect x="'+f+'" y="'+y+'" width="'+this.width+'" height="'+this.height+'" />\n',"</clipPath>\n"),m=' clip-path="url(#imageCrop_'+C+')" '}if(this.imageSmoothing||(_='" image-rendering="optimizeSpeed'),a.push("\t<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',f-this.cropX,'" y="',y-this.cropY,'" width="',l.width||l.naturalWidth,'" height="',l.height||l.height,_,'"',m,"></image>\n"),this.stroke||this.strokeDashArray){var D=this.fill;this.fill=null,d=["\t<rect ",'x="',f,'" y="',y,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),'"/>\n'],this.fill=D}return"fill"!==this.paintFirst?p.concat(d,a):p.concat(a,d)},getSrc:function(d){var p=d?this._element:this._originalElement;return p?p.toDataURL?p.toDataURL():this.srcFromAttribute?p.getAttribute("src"):p.src:this.src||""},setSrc:function(d,p,a){return S.util.loadImage(d,function(l,f){this.setElement(l,a),this._setWidthHeight(),p&&p(this,f)},this,a&&a.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var d=this.resizeFilter,p=this.minimumScaleTrigger,a=this.getTotalObjectScaling(),l=a.scaleX,f=a.scaleY,y=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!d||l>p&&f>p)return this._element=y,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=l,void(this._lastScaleY=f);S.filterBackend||(S.filterBackend=S.initFilterBackend());var m=S.util.createCanvasElement(),_=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,C=y.width,D=y.height;m.width=C,m.height=D,this._element=m,this._lastScaleX=d.scaleX=l,this._lastScaleY=d.scaleY=f,S.filterBackend.applyFilters([d],y,C,D,this._element,_),this._filterScalingX=m.width/this._originalElement.width,this._filterScalingY=m.height/this._originalElement.height},applyFilters:function(d){if(d=(d=d||this.filters||[]).filter(function(y){return y&&!y.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),0===d.length)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var p=this._originalElement,a=p.naturalWidth||p.width,l=p.naturalHeight||p.height;if(this._element===this._originalElement){var f=S.util.createCanvasElement();f.width=a,f.height=l,this._element=f,this._filteredEl=f}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,a,l),this._lastScaleX=1,this._lastScaleY=1;return S.filterBackend||(S.filterBackend=S.initFilterBackend()),S.filterBackend.applyFilters(d,this._originalElement,a,l,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(d){S.util.setImageSmoothing(d,this.imageSmoothing),!0!==this.isMoving&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(d),this._renderPaintInOrder(d)},drawCacheOnCanvas:function(d){S.util.setImageSmoothing(d,this.imageSmoothing),S.Object.prototype.drawCacheOnCanvas.call(this,d)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(d){var p=this._element;if(p){var a=this._filterScalingX,l=this._filterScalingY,f=this.width,y=this.height,m=Math.min,_=Math.max,C=_(this.cropX,0),D=_(this.cropY,0),E=p.naturalWidth||p.width,A=p.naturalHeight||p.height,T=C*a,M=D*l,F=m(f*a,E-T),U=m(y*l,A-M),G=-f/2,K=-y/2,q=m(f,E/a-C),$=m(y,A/l-D);p&&d.drawImage(p,T,M,F,U,G,K,q,$)}},_needsResize:function(){var d=this.getTotalObjectScaling();return d.scaleX!==this._lastScaleX||d.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(d,p){this.setElement(S.util.getById(d),p),S.util.addClass(this.getElement(),S.Image.CSS_CANVAS)},_initConfig:function(d){d||(d={}),this.setOptions(d),this._setWidthHeight(d)},_initFilters:function(d,p){d&&d.length?S.util.enlivenObjects(d,function(a){p&&p(a)},"fabric.Image.filters"):p&&p()},_setWidthHeight:function(d){d||(d={});var p=this.getElement();this.width=d.width||p.naturalWidth||p.width||0,this.height=d.height||p.naturalHeight||p.height||0},parsePreserveAspectRatioAttribute:function(){var d,p=S.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),a=this._element.width,l=this._element.height,f=1,y=1,m=0,_=0,C=0,D=0,E=this.width,A=this.height,T={width:E,height:A};return!p||"none"===p.alignX&&"none"===p.alignY?(f=E/a,y=A/l):("meet"===p.meetOrSlice&&(d=(E-a*(f=y=S.util.findScaleToFit(this._element,T)))/2,"Min"===p.alignX&&(m=-d),"Max"===p.alignX&&(m=d),d=(A-l*y)/2,"Min"===p.alignY&&(_=-d),"Max"===p.alignY&&(_=d)),"slice"===p.meetOrSlice&&(d=a-E/(f=y=S.util.findScaleToCover(this._element,T)),"Mid"===p.alignX&&(C=d/2),"Max"===p.alignX&&(C=d),d=l-A/y,"Mid"===p.alignY&&(D=d/2),"Max"===p.alignY&&(D=d),a=E/f,l=A/y)),{width:a,height:l,scaleX:f,scaleY:y,offsetLeft:m,offsetTop:_,cropX:C,cropY:D}}}),S.Image.CSS_CANVAS="canvas-img",S.Image.prototype.getSvgSrc=S.Image.prototype.getSrc,S.Image.fromObject=function(d,p){var a=S.util.object.clone(d);S.util.loadImage(a.src,function(l,f){f?p&&p(null,!0):S.Image.prototype._initFilters.call(a,a.filters,function(y){a.filters=y||[],S.Image.prototype._initFilters.call(a,[a.resizeFilter],function(m){a.resizeFilter=m[0],S.util.enlivenObjectEnlivables(a,a,function(){var _=new S.Image(l,a);p(_,!1)})})})},null,a.crossOrigin)},S.Image.fromURL=function(d,p,a){S.util.loadImage(d,function(l,f){p&&p(new S.Image(l,a),f)},null,a&&a.crossOrigin)},S.Image.ATTRIBUTE_NAMES=S.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),S.Image.fromElement=function(d,p,a){var l=S.parseAttributes(d,S.Image.ATTRIBUTE_NAMES);S.Image.fromURL(l["xlink:href"],p,c(a?S.util.object.clone(a):{},l))})}(e),S.util.object.extend(S.Object.prototype,{_getAngleValueForStraighten:function(){var h=this.angle%360;return h>0?90*Math.round((h-1)/90):90*Math.round(h/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(h){var c=function(){},d=(h=h||{}).onComplete||c,p=h.onChange||c,a=this;return S.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(l){a.rotate(l),p()},onComplete:function(){a.setCoords(),d()}})}}),S.util.object.extend(S.StaticCanvas.prototype,{straightenObject:function(h){return h.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(h){return h.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function h(d,p){var a="precision "+p+" float;\nvoid main(){}",l=d.createShader(d.FRAGMENT_SHADER);return d.shaderSource(l,a),d.compileShader(l),!!d.getShaderParameter(l,d.COMPILE_STATUS)}function c(d){d&&d.tileSize&&(this.tileSize=d.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}S.isWebglSupported=function(d){if(S.isLikelyNode)return!1;d=d||S.WebglFilterBackend.prototype.tileSize;var p=document.createElement("canvas"),a=p.getContext("webgl")||p.getContext("experimental-webgl"),l=!1;if(a){S.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),l=S.maxTextureSize>=d;for(var f=["highp","mediump","lowp"],y=0;y<3;y++)if(h(a,f[y])){S.webGlPrecision=f[y];break}}return this.isSupported=l,l},S.WebglFilterBackend=c,c.prototype={tileSize:2048,resources:{},setupGLContext:function(d,p){this.dispose(),this.createWebGLCanvas(d,p),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(d,p)},chooseFastestCopyGLTo2DMethod:function(d,p){var a,l=void 0!==window.performance;try{new ImageData(1,1),a=!0}catch{a=!1}var f=typeof ArrayBuffer<"u",y=typeof Uint8ClampedArray<"u";if(l&&a&&f&&y){var m=S.util.createCanvasElement(),_=new ArrayBuffer(d*p*4);if(S.forceGLPutImageData)return this.imageBuffer=_,void(this.copyGLTo2D=Qe);var C,D,E={imageBuffer:_,destinationWidth:d,destinationHeight:p,targetCanvas:m};m.width=d,m.height=p,C=window.performance.now(),be.call(E,this.gl,E),D=window.performance.now()-C,C=window.performance.now(),Qe.call(E,this.gl,E),D>window.performance.now()-C?(this.imageBuffer=_,this.copyGLTo2D=Qe):this.copyGLTo2D=be}},createWebGLCanvas:function(d,p){var a=S.util.createCanvasElement();a.width=d,a.height=p;var l={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},f=a.getContext("webgl",l);f||(f=a.getContext("experimental-webgl",l)),f&&(f.clearColor(0,0,0,0),this.canvas=a,this.gl=f)},applyFilters:function(d,p,a,l,f,y){var m,_=this.gl;y&&(m=this.getCachedTexture(y,p));var E,A,F,U,C={originalWidth:p.width||p.originalWidth,originalHeight:p.height||p.originalHeight,sourceWidth:a,sourceHeight:l,destinationWidth:a,destinationHeight:l,context:_,sourceTexture:this.createTexture(_,a,l,!m&&p),targetTexture:this.createTexture(_,a,l),originalTexture:m||this.createTexture(_,a,l,!m&&p),passes:d.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:f},D=_.createFramebuffer();return _.bindFramebuffer(_.FRAMEBUFFER,D),d.forEach(function(E){E&&E.applyTo(C)}),U=(E=C).destinationHeight,(A=E.targetCanvas).width===(F=E.destinationWidth)&&A.height===U||(A.width=F,A.height=U),this.copyGLTo2D(_,C),_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(C.sourceTexture),_.deleteTexture(C.targetTexture),_.deleteFramebuffer(D),f.getContext("2d").setTransform(1,0,0,1,0,0),C},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(d,p,a,l){var f=d.createTexture();return d.bindTexture(d.TEXTURE_2D,f),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),l?d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,l):d.texImage2D(d.TEXTURE_2D,0,d.RGBA,p,a,0,d.RGBA,d.UNSIGNED_BYTE,null),f},getCachedTexture:function(d,p){if(this.textureCache[d])return this.textureCache[d];var a=this.createTexture(this.gl,p.width,p.height,p);return this.textureCache[d]=a,a},evictCachesForKey:function(d){this.textureCache[d]&&(this.gl.deleteTexture(this.textureCache[d]),delete this.textureCache[d])},copyGLTo2D:be,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var d=this.gl,p={renderer:"",vendor:""};if(!d)return p;var a=d.getExtension("WEBGL_debug_renderer_info");if(a){var l=d.getParameter(a.UNMASKED_RENDERER_WEBGL),f=d.getParameter(a.UNMASKED_VENDOR_WEBGL);l&&(p.renderer=l.toLowerCase()),f&&(p.vendor=f.toLowerCase())}return this.gpuInfo=p,p}}}(),function(){var h=function(){};function c(){}S.Canvas2dFilterBackend=c,c.prototype={evictCachesForKey:h,dispose:h,clearWebGLCaches:h,resources:{},applyFilters:function(d,p,a,l,f){var y=f.getContext("2d");y.drawImage(p,0,0,a,l);var m={sourceWidth:a,sourceHeight:l,imageData:y.getImageData(0,0,a,l),originalEl:p,originalImageData:y.getImageData(0,0,a,l),canvasEl:f,ctx:y,filterBackend:this};return d.forEach(function(_){_.applyTo(m)}),m.imageData.width===a&&m.imageData.height===l||(f.width=m.imageData.width,f.height=m.imageData.height),y.putImageData(m.imageData,0,0),m}}}(),S.Image=S.Image||{},S.Image.filters=S.Image.filters||{},S.Image.filters.BaseFilter=S.util.createClass({type:"BaseFilter",vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvoid main() {\nvTexCoord = aPosition;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D uTexture;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\n}",initialize:function(h){h&&this.setOptions(h)},setOptions:function(h){for(var c in h)this[c]=h[c]},createProgram:function(h,c,d){c=c||this.fragmentSource,d=d||this.vertexSource,"highp"!==S.webGlPrecision&&(c=c.replace(/precision highp float/g,"precision "+S.webGlPrecision+" float"));var p=h.createShader(h.VERTEX_SHADER);if(h.shaderSource(p,d),h.compileShader(p),!h.getShaderParameter(p,h.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+h.getShaderInfoLog(p));var a=h.createShader(h.FRAGMENT_SHADER);if(h.shaderSource(a,c),h.compileShader(a),!h.getShaderParameter(a,h.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+h.getShaderInfoLog(a));var l=h.createProgram();if(h.attachShader(l,p),h.attachShader(l,a),h.linkProgram(l),!h.getProgramParameter(l,h.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+h.getProgramInfoLog(l));var f=this.getAttributeLocations(h,l),y=this.getUniformLocations(h,l)||{};return y.uStepW=h.getUniformLocation(l,"uStepW"),y.uStepH=h.getUniformLocation(l,"uStepH"),{program:l,attributeLocations:f,uniformLocations:y}},getAttributeLocations:function(h,c){return{aPosition:h.getAttribLocation(c,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(h,c,d){var p=c.aPosition,a=h.createBuffer();h.bindBuffer(h.ARRAY_BUFFER,a),h.enableVertexAttribArray(p),h.vertexAttribPointer(p,2,h.FLOAT,!1,0,0),h.bufferData(h.ARRAY_BUFFER,d,h.STATIC_DRAW)},_setupFrameBuffer:function(h){var c,d,p=h.context;h.passes>1?(d=h.destinationHeight,h.sourceWidth===(c=h.destinationWidth)&&h.sourceHeight===d||(p.deleteTexture(h.targetTexture),h.targetTexture=h.filterBackend.createTexture(p,c,d)),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,h.targetTexture,0)):(p.bindFramebuffer(p.FRAMEBUFFER,null),p.finish())},_swapTextures:function(h){h.passes--,h.pass++;var c=h.targetTexture;h.targetTexture=h.sourceTexture,h.sourceTexture=c},isNeutralState:function(){var h=this.mainParameter,c=S.Image.filters[this.type].prototype;if(h){if(Array.isArray(c[h])){for(var d=c[h].length;d--;)if(this[h][d]!==c[h][d])return!1;return!0}return c[h]===this[h]}return!1},applyTo:function(h){h.webgl?(this._setupFrameBuffer(h),this.applyToWebGL(h),this._swapTextures(h)):this.applyTo2d(h)},retrieveShader:function(h){return h.programCache.hasOwnProperty(this.type)||(h.programCache[this.type]=this.createProgram(h.context)),h.programCache[this.type]},applyToWebGL:function(h){var c=h.context,d=this.retrieveShader(h);c.bindTexture(c.TEXTURE_2D,0===h.pass&&h.originalTexture?h.originalTexture:h.sourceTexture),c.useProgram(d.program),this.sendAttributeData(c,d.attributeLocations,h.aPosition),c.uniform1f(d.uniformLocations.uStepW,1/h.sourceWidth),c.uniform1f(d.uniformLocations.uStepH,1/h.sourceHeight),this.sendUniformData(c,d.uniformLocations),c.viewport(0,0,h.destinationWidth,h.destinationHeight),c.drawArrays(c.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(h,c,d){h.activeTexture(d),h.bindTexture(h.TEXTURE_2D,c),h.activeTexture(h.TEXTURE0)},unbindAdditionalTexture:function(h,c){h.activeTexture(c),h.bindTexture(h.TEXTURE_2D,null),h.activeTexture(h.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(h){this[this.mainParameter]=h},sendUniformData:function(){},createHelpLayer:function(h){if(!h.helpLayer){var c=document.createElement("canvas");c.width=h.sourceWidth,c.height=h.sourceHeight,h.helpLayer=c}},toObject:function(){var h={type:this.type},c=this.mainParameter;return c&&(h[c]=this[c]),h},toJSON:function(){return this.toObject()}}),S.Image.filters.BaseFilter.fromObject=function(h,c){var d=new S.Image.filters[h.type](h);return c&&c(d),d},function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.ColorMatrix=(0,c.util.createClass)(d.BaseFilter,{type:"ColorMatrix",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nuniform mat4 uColorMatrix;\nuniform vec4 uConstants;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor *= uColorMatrix;\ncolor += uConstants;\ngl_FragColor = color;\n}",matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(a){this.callSuper("initialize",a),this.matrix=this.matrix.slice(0)},applyTo2d:function(a){var l,f,y,m,_,C=a.imageData.data,D=C.length,E=this.matrix,A=this.colorsOnly;for(_=0;_<D;_+=4)l=C[_],f=C[_+1],y=C[_+2],A?(C[_]=l*E[0]+f*E[1]+y*E[2]+255*E[4],C[_+1]=l*E[5]+f*E[6]+y*E[7]+255*E[9],C[_+2]=l*E[10]+f*E[11]+y*E[12]+255*E[14]):(C[_]=l*E[0]+f*E[1]+y*E[2]+(m=C[_+3])*E[3]+255*E[4],C[_+1]=l*E[5]+f*E[6]+y*E[7]+m*E[8]+255*E[9],C[_+2]=l*E[10]+f*E[11]+y*E[12]+m*E[13]+255*E[14],C[_+3]=l*E[15]+f*E[16]+y*E[17]+m*E[18]+255*E[19])},getUniformLocations:function(a,l){return{uColorMatrix:a.getUniformLocation(l,"uColorMatrix"),uConstants:a.getUniformLocation(l,"uConstants")}},sendUniformData:function(a,l){var f=this.matrix,m=[f[4],f[9],f[14],f[19]];a.uniformMatrix4fv(l.uColorMatrix,!1,[f[0],f[1],f[2],f[3],f[5],f[6],f[7],f[8],f[10],f[11],f[12],f[13],f[15],f[16],f[17],f[18]]),a.uniform4fv(l.uConstants,m)}}),c.Image.filters.ColorMatrix.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Brightness=(0,c.util.createClass)(d.BaseFilter,{type:"Brightness",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBrightness;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += uBrightness;\ngl_FragColor = color;\n}",brightness:0,mainParameter:"brightness",applyTo2d:function(a){if(0!==this.brightness){var l,f=a.imageData.data,y=f.length,m=Math.round(255*this.brightness);for(l=0;l<y;l+=4)f[l]=f[l]+m,f[l+1]=f[l+1]+m,f[l+2]=f[l+2]+m}},getUniformLocations:function(a,l){return{uBrightness:a.getUniformLocation(l,"uBrightness")}},sendUniformData:function(a,l){a.uniform1f(l.uBrightness,this.brightness)}}),c.Image.filters.Brightness.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.object.extend,p=c.Image.filters;p.Convolute=(0,c.util.createClass)(p.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_3_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[9];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 3.0; h+=1.0) {\nfor (float w = 0.0; w < 3.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_5_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_5_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[25];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 5.0; h+=1.0) {\nfor (float w = 0.0; w < 5.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_7_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_7_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[49];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 7.0; h+=1.0) {\nfor (float w = 0.0; w < 7.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}",Convolute_9_1:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 0);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\n}\n}\ngl_FragColor = color;\n}",Convolute_9_0:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uMatrix[81];\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = vec4(0, 0, 0, 1);\nfor (float h = 0.0; h < 9.0; h+=1.0) {\nfor (float w = 0.0; w < 9.0; w+=1.0) {\nvec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\ncolor.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\n}\n}\nfloat alpha = texture2D(uTexture, vTexCoord).a;\ngl_FragColor = color;\ngl_FragColor.a = alpha;\n}"},retrieveShader:function(l){var f=Math.sqrt(this.matrix.length),y=this.type+"_"+f+"_"+(this.opaque?1:0),m=this.fragmentSource[y];return l.programCache.hasOwnProperty(y)||(l.programCache[y]=this.createProgram(l.context,m)),l.programCache[y]},applyTo2d:function(l){var f,y,m,_,C,D,E,A,T,M,F,U,G,K=l.imageData,q=K.data,$=this.matrix,N=Math.round(Math.sqrt($.length)),k=Math.floor(N/2),z=K.width,J=K.height,Q=l.ctx.createImageData(z,J),H=Q.data,j=this.opaque?1:0;for(F=0;F<J;F++)for(M=0;M<z;M++){for(C=4*(F*z+M),f=0,y=0,m=0,_=0,G=0;G<N;G++)for(U=0;U<N;U++)D=M+U-k,(E=F+G-k)<0||E>=J||D<0||D>=z||(f+=q[A=4*(E*z+D)]*(T=$[G*N+U]),y+=q[A+1]*T,m+=q[A+2]*T,j||(_+=q[A+3]*T));H[C]=f,H[C+1]=y,H[C+2]=m,H[C+3]=j?q[C+3]:_}l.imageData=Q},getUniformLocations:function(l,f){return{uMatrix:l.getUniformLocation(f,"uMatrix"),uOpaque:l.getUniformLocation(f,"uOpaque"),uHalfSize:l.getUniformLocation(f,"uHalfSize"),uSize:l.getUniformLocation(f,"uSize")}},sendUniformData:function(l,f){l.uniform1fv(f.uMatrix,this.matrix)},toObject:function(){return d(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),c.Image.filters.Convolute.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Grayscale=(0,c.util.createClass)(d.BaseFilter,{type:"Grayscale",fragmentSource:{average:"precision highp float;\nuniform sampler2D uTexture;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat average = (color.r + color.b + color.g) / 3.0;\ngl_FragColor = vec4(average, average, average, color.a);\n}",lightness:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\ngl_FragColor = vec4(average, average, average, col.a);\n}",luminosity:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uMode;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 col = texture2D(uTexture, vTexCoord);\nfloat average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\ngl_FragColor = vec4(average, average, average, col.a);\n}"},mode:"average",mainParameter:"mode",applyTo2d:function(a){var l,f,y=a.imageData.data,m=y.length,_=this.mode;for(l=0;l<m;l+=4)"average"===_?f=(y[l]+y[l+1]+y[l+2])/3:"lightness"===_?f=(Math.min(y[l],y[l+1],y[l+2])+Math.max(y[l],y[l+1],y[l+2]))/2:"luminosity"===_&&(f=.21*y[l]+.72*y[l+1]+.07*y[l+2]),y[l]=f,y[l+1]=f,y[l+2]=f},retrieveShader:function(a){var l=this.type+"_"+this.mode;return a.programCache.hasOwnProperty(l)||(a.programCache[l]=this.createProgram(a.context,this.fragmentSource[this.mode])),a.programCache[l]},getUniformLocations:function(a,l){return{uMode:a.getUniformLocation(l,"uMode")}},sendUniformData:function(a,l){a.uniform1i(l.uMode,1)},isNeutralState:function(){return!1}}),c.Image.filters.Grayscale.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Invert=(0,c.util.createClass)(d.BaseFilter,{type:"Invert",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform int uInvert;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nif (uInvert == 1) {\ngl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\n} else {\ngl_FragColor = color;\n}\n}",invert:!0,mainParameter:"invert",applyTo2d:function(a){var l,f=a.imageData.data,y=f.length;for(l=0;l<y;l+=4)f[l]=255-f[l],f[l+1]=255-f[l+1],f[l+2]=255-f[l+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(a,l){return{uInvert:a.getUniformLocation(l,"uInvert")}},sendUniformData:function(a,l){a.uniform1i(l.uInvert,this.invert)}}),c.Image.filters.Invert.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.object.extend,p=c.Image.filters;p.Noise=(0,c.util.createClass)(p.BaseFilter,{type:"Noise",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uStepH;\nuniform float uNoise;\nuniform float uSeed;\nvarying vec2 vTexCoord;\nfloat rand(vec2 co, float seed, float vScale) {\nreturn fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\n}\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ncolor.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\ngl_FragColor = color;\n}",mainParameter:"noise",noise:0,applyTo2d:function(l){if(0!==this.noise){var f,y,_,m=l.imageData.data,C=this.noise;for(f=0,_=m.length;f<_;f+=4)y=(.5-Math.random())*C,m[f]+=y,m[f+1]+=y,m[f+2]+=y}},getUniformLocations:function(l,f){return{uNoise:l.getUniformLocation(f,"uNoise"),uSeed:l.getUniformLocation(f,"uSeed")}},sendUniformData:function(l,f){l.uniform1f(f.uNoise,this.noise/255),l.uniform1f(f.uSeed,Math.random())},toObject:function(){return d(this.callSuper("toObject"),{noise:this.noise})}}),c.Image.filters.Noise.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Pixelate=(0,c.util.createClass)(d.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uBlocksize;\nuniform float uStepW;\nuniform float uStepH;\nvarying vec2 vTexCoord;\nvoid main() {\nfloat blockW = uBlocksize * uStepW;\nfloat blockH = uBlocksize * uStepW;\nint posX = int(vTexCoord.x / blockW);\nint posY = int(vTexCoord.y / blockH);\nfloat fposX = float(posX);\nfloat fposY = float(posY);\nvec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\nvec4 color = texture2D(uTexture, squareCoords);\ngl_FragColor = color;\n}",applyTo2d:function(a){var l,f,y,m,_,C,D,E,A,T,M,F=a.imageData,U=F.data,G=F.height,K=F.width;for(f=0;f<G;f+=this.blocksize)for(y=0;y<K;y+=this.blocksize)for(m=U[l=4*f*K+4*y],_=U[l+1],C=U[l+2],D=U[l+3],T=Math.min(f+this.blocksize,G),M=Math.min(y+this.blocksize,K),E=f;E<T;E++)for(A=y;A<M;A++)U[l=4*E*K+4*A]=m,U[l+1]=_,U[l+2]=C,U[l+3]=D},isNeutralState:function(){return 1===this.blocksize},getUniformLocations:function(a,l){return{uBlocksize:a.getUniformLocation(l,"uBlocksize"),uStepW:a.getUniformLocation(l,"uStepW"),uStepH:a.getUniformLocation(l,"uStepH")}},sendUniformData:function(a,l){a.uniform1f(l.uBlocksize,this.blocksize)}}),c.Image.filters.Pixelate.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.object.extend,p=c.Image.filters;p.RemoveColor=(0,c.util.createClass)(p.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uLow;\nuniform vec4 uHigh;\nvarying vec2 vTexCoord;\nvoid main() {\ngl_FragColor = texture2D(uTexture, vTexCoord);\nif(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\ngl_FragColor.a = 0.0;\n}\n}",distance:.02,useAlpha:!1,applyTo2d:function(l){var f,y,m,_,C=l.imageData.data,D=255*this.distance,E=new c.Color(this.color).getSource(),A=[E[0]-D,E[1]-D,E[2]-D],T=[E[0]+D,E[1]+D,E[2]+D];for(f=0;f<C.length;f+=4)m=C[f+1],_=C[f+2],(y=C[f])>A[0]&&m>A[1]&&_>A[2]&&y<T[0]&&m<T[1]&&_<T[2]&&(C[f+3]=0)},getUniformLocations:function(l,f){return{uLow:l.getUniformLocation(f,"uLow"),uHigh:l.getUniformLocation(f,"uHigh")}},sendUniformData:function(l,f){var y=new c.Color(this.color).getSource(),m=parseFloat(this.distance),C=[y[0]/255+m,y[1]/255+m,y[2]/255+m,1];l.uniform4fv(f.uLow,[0+y[0]/255-m,0+y[1]/255-m,0+y[2]/255-m,1]),l.uniform4fv(f.uHigh,C)},toObject:function(){return d(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),c.Image.filters.RemoveColor.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters,p=c.util.createClass,a={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var l in a)d[l]=p(d.ColorMatrix,{type:l,matrix:a[l],mainParameter:!1,colorsOnly:!0}),c.Image.filters[l].fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric,d=c.Image.filters;d.BlendColor=(0,c.util.createClass)(d.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:"gl_FragColor.rgb *= uColor.rgb;\n",screen:"gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\n",add:"gl_FragColor.rgb += uColor.rgb;\n",diff:"gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\n",subtract:"gl_FragColor.rgb -= uColor.rgb;\n",lighten:"gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\n",darken:"gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\n",exclusion:"gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\n",overlay:"if (uColor.r < 0.5) {\ngl_FragColor.r *= 2.0 * uColor.r;\n} else {\ngl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\n}\nif (uColor.g < 0.5) {\ngl_FragColor.g *= 2.0 * uColor.g;\n} else {\ngl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\n}\nif (uColor.b < 0.5) {\ngl_FragColor.b *= 2.0 * uColor.b;\n} else {\ngl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\n}\n",tint:"gl_FragColor.rgb *= (1.0 - uColor.a);\ngl_FragColor.rgb += uColor.rgb;\n"},buildSource:function(a){return"precision highp float;\nuniform sampler2D uTexture;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\ngl_FragColor = color;\nif (color.a > 0.0) {\n"+this.fragmentSource[a]+"}\n}"},retrieveShader:function(a){var l,f=this.type+"_"+this.mode;return a.programCache.hasOwnProperty(f)||(l=this.buildSource(this.mode),a.programCache[f]=this.createProgram(a.context,l)),a.programCache[f]},applyTo2d:function(a){var l,f,y,m,_,C,D,E=a.imageData.data,A=E.length,T=1-this.alpha;l=(D=new c.Color(this.color).getSource())[0]*this.alpha,f=D[1]*this.alpha,y=D[2]*this.alpha;for(var M=0;M<A;M+=4)switch(m=E[M],_=E[M+1],C=E[M+2],this.mode){case"multiply":E[M]=m*l/255,E[M+1]=_*f/255,E[M+2]=C*y/255;break;case"screen":E[M]=255-(255-m)*(255-l)/255,E[M+1]=255-(255-_)*(255-f)/255,E[M+2]=255-(255-C)*(255-y)/255;break;case"add":E[M]=m+l,E[M+1]=_+f,E[M+2]=C+y;break;case"diff":case"difference":E[M]=Math.abs(m-l),E[M+1]=Math.abs(_-f),E[M+2]=Math.abs(C-y);break;case"subtract":E[M]=m-l,E[M+1]=_-f,E[M+2]=C-y;break;case"darken":E[M]=Math.min(m,l),E[M+1]=Math.min(_,f),E[M+2]=Math.min(C,y);break;case"lighten":E[M]=Math.max(m,l),E[M+1]=Math.max(_,f),E[M+2]=Math.max(C,y);break;case"overlay":E[M]=l<128?2*m*l/255:255-2*(255-m)*(255-l)/255,E[M+1]=f<128?2*_*f/255:255-2*(255-_)*(255-f)/255,E[M+2]=y<128?2*C*y/255:255-2*(255-C)*(255-y)/255;break;case"exclusion":E[M]=l+m-2*l*m/255,E[M+1]=f+_-2*f*_/255,E[M+2]=y+C-2*y*C/255;break;case"tint":E[M]=l+m*T,E[M+1]=f+_*T,E[M+2]=y+C*T}},getUniformLocations:function(a,l){return{uColor:a.getUniformLocation(l,"uColor")}},sendUniformData:function(a,l){var f=new c.Color(this.color).getSource();f[0]=this.alpha*f[0]/255,f[1]=this.alpha*f[1]/255,f[2]=this.alpha*f[2]/255,f[3]=this.alpha,a.uniform4fv(l.uColor,f)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),c.Image.filters.BlendColor.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric,d=c.Image.filters;d.BlendImage=(0,c.util.createClass)(d.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:"attribute vec2 aPosition;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nuniform mat3 uTransformMatrix;\nvoid main() {\nvTexCoord = aPosition;\nvTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\ngl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\n}",fragmentSource:{multiply:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.rgba *= color2.rgba;\ngl_FragColor = color;\n}",mask:"precision highp float;\nuniform sampler2D uTexture;\nuniform sampler2D uImage;\nuniform vec4 uColor;\nvarying vec2 vTexCoord;\nvarying vec2 vTexCoord2;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec4 color2 = texture2D(uImage, vTexCoord2);\ncolor.a = color2.a;\ngl_FragColor = color;\n}"},retrieveShader:function(a){var l=this.type+"_"+this.mode,f=this.fragmentSource[this.mode];return a.programCache.hasOwnProperty(l)||(a.programCache[l]=this.createProgram(a.context,f)),a.programCache[l]},applyToWebGL:function(a){var l=a.context,f=this.createTexture(a.filterBackend,this.image);this.bindAdditionalTexture(l,f,l.TEXTURE1),this.callSuper("applyToWebGL",a),this.unbindAdditionalTexture(l,l.TEXTURE1)},createTexture:function(a,l){return a.getCachedTexture(l.cacheKey,l._element)},calculateMatrix:function(){var a=this.image;return[1/a.scaleX,0,0,0,1/a.scaleY,0,-a.left/a._element.width,-a.top/a._element.height,1]},applyTo2d:function(a){var l,f,y,m,_,C,D,E,A,T,M,F=a.imageData,U=a.filterBackend.resources,G=F.data,K=G.length,q=F.width,$=F.height,N=this.image;U.blendImage||(U.blendImage=c.util.createCanvasElement()),T=(A=U.blendImage).getContext("2d"),A.width!==q||A.height!==$?(A.width=q,A.height=$):T.clearRect(0,0,q,$),T.setTransform(N.scaleX,0,0,N.scaleY,N.left,N.top),T.drawImage(N._element,0,0,q,$),M=T.getImageData(0,0,q,$).data;for(var k=0;k<K;k+=4)switch(_=G[k],C=G[k+1],D=G[k+2],E=G[k+3],l=M[k],f=M[k+1],y=M[k+2],m=M[k+3],this.mode){case"multiply":G[k]=_*l/255,G[k+1]=C*f/255,G[k+2]=D*y/255,G[k+3]=E*m/255;break;case"mask":G[k+3]=m}},getUniformLocations:function(a,l){return{uTransformMatrix:a.getUniformLocation(l,"uTransformMatrix"),uImage:a.getUniformLocation(l,"uImage")}},sendUniformData:function(a,l){var f=this.calculateMatrix();a.uniform1i(l.uImage,1),a.uniformMatrix3fv(l.uTransformMatrix,!1,f)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),c.Image.filters.BlendImage.fromObject=function(a,l){c.Image.fromObject(a.image,function(f){var y=c.util.object.clone(a);y.image=f,l(new c.Image.filters.BlendImage(y))})}}(e),function(h){var c=h.fabric||(h.fabric={}),d=Math.pow,p=Math.floor,a=Math.sqrt,l=Math.abs,f=Math.round,y=Math.sin,m=Math.ceil,_=c.Image.filters;_.Resize=(0,c.util.createClass)(_.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(D,E){return{uDelta:D.getUniformLocation(E,"uDelta"),uTaps:D.getUniformLocation(E,"uTaps")}},sendUniformData:function(D,E){D.uniform2fv(E.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),D.uniform1fv(E.uTaps,this.taps)},retrieveShader:function(D){var E=this.getFilterWindow(),A=this.type+"_"+E;if(!D.programCache.hasOwnProperty(A)){var T=this.generateShader(E);D.programCache[A]=this.createProgram(D.context,T)}return D.programCache[A]},getFilterWindow:function(){return Math.ceil(this.lanczosLobes/this.tempScale)},getTaps:function(){for(var D=this.lanczosCreate(this.lanczosLobes),E=this.tempScale,A=this.getFilterWindow(),T=new Array(A),M=1;M<=A;M++)T[M-1]=D(M*E);return T},generateShader:function(D){for(var E=new Array(D),A=this.fragmentSourceTOP,T=1;T<=D;T++)E[T-1]=T+".0 * uDelta";return A+="uniform float uTaps["+D+"];\n",A+="void main() {\n",A+="  vec4 color = texture2D(uTexture, vTexCoord);\n",A+="  float sum = 1.0;\n",E.forEach(function(M,F){A+="  color += texture2D(uTexture, vTexCoord + "+M+") * uTaps["+F+"];\n",A+="  color += texture2D(uTexture, vTexCoord - "+M+") * uTaps["+F+"];\n",A+="  sum += 2.0 * uTaps["+F+"];\n"}),A+="  gl_FragColor = color / sum;\n",A+="}"},fragmentSourceTOP:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\n",applyTo:function(D){D.webgl?(D.passes++,this.width=D.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=D.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),D.destinationWidth=this.dW,this._setupFrameBuffer(D),this.applyToWebGL(D),this._swapTextures(D),D.sourceWidth=D.destinationWidth,this.height=D.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),D.destinationHeight=this.dH,this._setupFrameBuffer(D),this.applyToWebGL(D),this._swapTextures(D),D.sourceHeight=D.destinationHeight):this.applyTo2d(D)},isNeutralState:function(){return 1===this.scaleX&&1===this.scaleY},lanczosCreate:function(D){return function(E){if(E>=D||E<=-D)return 0;if(E<1.1920929e-7&&E>-1.1920929e-7)return 1;var A=(E*=Math.PI)/D;return y(E)/E*y(A)/A}},applyTo2d:function(D){var E=D.imageData,A=this.scaleX,T=this.scaleY;this.rcpScaleX=1/A,this.rcpScaleY=1/T;var M,F=E.width,U=E.height,G=f(F*A),K=f(U*T);"sliceHack"===this.resizeType?M=this.sliceByTwo(D,F,U,G,K):"hermite"===this.resizeType?M=this.hermiteFastResize(D,F,U,G,K):"bilinear"===this.resizeType?M=this.bilinearFiltering(D,F,U,G,K):"lanczos"===this.resizeType&&(M=this.lanczosResize(D,F,U,G,K)),D.imageData=M},sliceByTwo:function(D,E,A,T,M){var F,U,G=D.imageData,K=.5,q=!1,$=!1,N=E*K,k=A*K,z=c.filterBackend.resources,J=0,Q=0,H=E,j=0;for(z.sliceByTwo||(z.sliceByTwo=document.createElement("canvas")),((F=z.sliceByTwo).width<1.5*E||F.height<A)&&(F.width=1.5*E,F.height=A),(U=F.getContext("2d")).clearRect(0,0,1.5*E,A),U.putImageData(G,0,0),T=p(T),M=p(M);!q||!$;)E=N,A=k,T<p(N*K)?N=p(N*K):(N=T,q=!0),M<p(k*K)?k=p(k*K):(k=M,$=!0),U.drawImage(F,J,Q,E,A,H,j,N,k),J=H,Q=j,j+=k;return U.getImageData(J,Q,T,M)},lanczosResize:function(D,E,A,T,M){var F=D.imageData.data,U=D.ctx.createImageData(T,M),G=U.data,K=this.lanczosCreate(this.lanczosLobes),q=this.rcpScaleX,$=this.rcpScaleY,N=2/this.rcpScaleX,k=2/this.rcpScaleY,z=m(q*this.lanczosLobes/2),J=m($*this.lanczosLobes/2),Q={},H={},j={};return function Y(te){var Z,re,he,ce,ae,de,ue,fe,ve,me,Oe;for(H.x=(te+.5)*q,j.x=p(H.x),Z=0;Z<M;Z++){for(H.y=(Z+.5)*$,j.y=p(H.y),ae=0,de=0,ue=0,fe=0,ve=0,re=j.x-z;re<=j.x+z;re++)if(!(re<0||re>=E)){me=p(1e3*l(re-H.x)),Q[me]||(Q[me]={});for(var We=j.y-J;We<=j.y+J;We++)We<0||We>=A||(Oe=p(1e3*l(We-H.y)),Q[me][Oe]||(Q[me][Oe]=K(a(d(me*N,2)+d(Oe*k,2))/1e3)),(he=Q[me][Oe])>0&&(ae+=he,de+=he*F[ce=4*(We*E+re)],ue+=he*F[ce+1],fe+=he*F[ce+2],ve+=he*F[ce+3]))}G[ce=4*(Z*T+te)]=de/ae,G[ce+1]=ue/ae,G[ce+2]=fe/ae,G[ce+3]=ve/ae}return++te<T?Y(te):U}(0)},bilinearFiltering:function(D,E,A,T,M){var F,U,G,K,q,$,N,z,J=0,Q=this.rcpScaleX,H=this.rcpScaleY,j=4*(E-1),Y=D.imageData.data,te=D.ctx.createImageData(T,M),Z=te.data;for(G=0;G<M;G++)for(K=0;K<T;K++)for(q=Q*K-(F=p(Q*K)),$=H*G-(U=p(H*G)),z=4*(U*E+F),N=0;N<4;N++)Z[J++]=Y[z+N]*(1-q)*(1-$)+Y[z+4+N]*q*(1-$)+Y[z+j+N]*$*(1-q)+Y[z+j+4+N]*q*$;return te},hermiteFastResize:function(D,E,A,T,M){for(var F=this.rcpScaleX,U=this.rcpScaleY,G=m(F/2),K=m(U/2),q=D.imageData.data,$=D.ctx.createImageData(T,M),N=$.data,k=0;k<M;k++)for(var z=0;z<T;z++){for(var J=4*(z+k*T),Q=0,H=0,j=0,Y=0,te=0,Z=0,re=0,he=(k+.5)*U,ce=p(k*U);ce<(k+1)*U;ce++)for(var ae=l(he-(ce+.5))/K,de=(z+.5)*F,ue=ae*ae,fe=p(z*F);fe<(z+1)*F;fe++){var ve=l(de-(fe+.5))/G,me=a(ue+ve*ve);me>1&&me<-1||(Q=2*me*me*me-3*me*me+1)>0&&(re+=Q*q[3+(ve=4*(fe+ce*E))],j+=Q,q[ve+3]<255&&(Q=Q*q[ve+3]/250),Y+=Q*q[ve],te+=Q*q[ve+1],Z+=Q*q[ve+2],H+=Q)}N[J]=Y/H,N[J+1]=te/H,N[J+2]=Z/H,N[J+3]=re/j}return $},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),c.Image.filters.Resize.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Contrast=(0,c.util.createClass)(d.BaseFilter,{type:"Contrast",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uContrast;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\ncolor.rgb = contrastF * (color.rgb - 0.5) + 0.5;\ngl_FragColor = color;\n}",contrast:0,mainParameter:"contrast",applyTo2d:function(a){if(0!==this.contrast){var l,f=a.imageData.data,y=f.length,m=Math.floor(255*this.contrast),_=259*(m+255)/(255*(259-m));for(l=0;l<y;l+=4)f[l]=_*(f[l]-128)+128,f[l+1]=_*(f[l+1]-128)+128,f[l+2]=_*(f[l+2]-128)+128}},getUniformLocations:function(a,l){return{uContrast:a.getUniformLocation(l,"uContrast")}},sendUniformData:function(a,l){a.uniform1f(l.uContrast,this.contrast)}}),c.Image.filters.Contrast.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Saturation=(0,c.util.createClass)(d.BaseFilter,{type:"Saturation",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uSaturation;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat rgMax = max(color.r, color.g);\nfloat rgbMax = max(rgMax, color.b);\ncolor.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\ncolor.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\ncolor.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\ngl_FragColor = color;\n}",saturation:0,mainParameter:"saturation",applyTo2d:function(a){if(0!==this.saturation){var l,f,y=a.imageData.data,m=y.length,_=-this.saturation;for(l=0;l<m;l+=4)f=Math.max(y[l],y[l+1],y[l+2]),y[l]+=f!==y[l]?(f-y[l])*_:0,y[l+1]+=f!==y[l+1]?(f-y[l+1])*_:0,y[l+2]+=f!==y[l+2]?(f-y[l+2])*_:0}},getUniformLocations:function(a,l){return{uSaturation:a.getUniformLocation(l,"uSaturation")}},sendUniformData:function(a,l){a.uniform1f(l.uSaturation,-this.saturation)}}),c.Image.filters.Saturation.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Vibrance=(0,c.util.createClass)(d.BaseFilter,{type:"Vibrance",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform float uVibrance;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nfloat max = max(color.r, max(color.g, color.b));\nfloat avg = (color.r + color.g + color.b) / 3.0;\nfloat amt = (abs(max - avg) * 2.0) * uVibrance;\ncolor.r += max != color.r ? (max - color.r) * amt : 0.00;\ncolor.g += max != color.g ? (max - color.g) * amt : 0.00;\ncolor.b += max != color.b ? (max - color.b) * amt : 0.00;\ngl_FragColor = color;\n}",vibrance:0,mainParameter:"vibrance",applyTo2d:function(a){if(0!==this.vibrance){var l,f,m,_=a.imageData.data,C=_.length,D=-this.vibrance;for(l=0;l<C;l+=4)f=Math.max(_[l],_[l+1],_[l+2]),m=2*Math.abs(f-(_[l]+_[l+1]+_[l+2])/3)/255*D,_[l]+=f!==_[l]?(f-_[l])*m:0,_[l+1]+=f!==_[l+1]?(f-_[l+1])*m:0,_[l+2]+=f!==_[l+2]?(f-_[l+2])*m:0}},getUniformLocations:function(a,l){return{uVibrance:a.getUniformLocation(l,"uVibrance")}},sendUniformData:function(a,l){a.uniform1f(l.uVibrance,-this.vibrance)}}),c.Image.filters.Vibrance.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Blur=(0,c.util.createClass)(d.BaseFilter,{type:"Blur",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec2 uDelta;\nvarying vec2 vTexCoord;\nconst float nSamples = 15.0;\nvec3 v3offset = vec3(12.9898, 78.233, 151.7182);\nfloat random(vec3 scale) {\nreturn fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\n}\nvoid main() {\nvec4 color = vec4(0.0);\nfloat total = 0.0;\nfloat offset = random(v3offset);\nfor (float t = -nSamples; t <= nSamples; t++) {\nfloat percent = (t + offset - 0.5) / nSamples;\nfloat weight = 1.0 - abs(percent);\ncolor += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\ntotal += weight;\n}\ngl_FragColor = color / total;\n}",blur:0,mainParameter:"blur",applyTo:function(a){a.webgl?(this.aspectRatio=a.sourceWidth/a.sourceHeight,a.passes++,this._setupFrameBuffer(a),this.horizontal=!0,this.applyToWebGL(a),this._swapTextures(a),this._setupFrameBuffer(a),this.horizontal=!1,this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},applyTo2d:function(a){a.imageData=this.simpleBlur(a)},simpleBlur:function(a){var l,f,y=a.filterBackend.resources,m=a.imageData.width,_=a.imageData.height;y.blurLayer1||(y.blurLayer1=c.util.createCanvasElement(),y.blurLayer2=c.util.createCanvasElement()),f=y.blurLayer2,(l=y.blurLayer1).width===m&&l.height===_||(f.width=l.width=m,f.height=l.height=_);var C,D,E,A,T=l.getContext("2d"),M=f.getContext("2d"),F=.06*this.blur*.5;for(T.putImageData(a.imageData,0,0),M.clearRect(0,0,m,_),A=-15;A<=15;A++)E=F*(D=A/15)*m+(C=(Math.random()-.5)/4),M.globalAlpha=1-Math.abs(D),M.drawImage(l,E,C),T.drawImage(f,0,0),M.globalAlpha=1,M.clearRect(0,0,f.width,f.height);for(A=-15;A<=15;A++)E=F*(D=A/15)*_+(C=(Math.random()-.5)/4),M.globalAlpha=1-Math.abs(D),M.drawImage(l,C,E),T.drawImage(f,0,0),M.globalAlpha=1,M.clearRect(0,0,f.width,f.height);a.ctx.drawImage(l,0,0);var U=a.ctx.getImageData(0,0,l.width,l.height);return T.globalAlpha=1,T.clearRect(0,0,l.width,l.height),U},getUniformLocations:function(a,l){return{delta:a.getUniformLocation(l,"uDelta")}},sendUniformData:function(a,l){var f=this.chooseRightDelta();a.uniform2fv(l.delta,f)},chooseRightDelta:function(){var a,l=1,f=[0,0];return this.horizontal?this.aspectRatio>1&&(l=1/this.aspectRatio):this.aspectRatio<1&&(l=this.aspectRatio),a=l*this.blur*.12,this.horizontal?f[0]=a:f[1]=a,f}}),d.Blur.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Gamma=(0,c.util.createClass)(d.BaseFilter,{type:"Gamma",fragmentSource:"precision highp float;\nuniform sampler2D uTexture;\nuniform vec3 uGamma;\nvarying vec2 vTexCoord;\nvoid main() {\nvec4 color = texture2D(uTexture, vTexCoord);\nvec3 correction = (1.0 / uGamma);\ncolor.r = pow(color.r, correction.r);\ncolor.g = pow(color.g, correction.g);\ncolor.b = pow(color.b, correction.b);\ngl_FragColor = color;\ngl_FragColor.rgb *= color.a;\n}",gamma:[1,1,1],mainParameter:"gamma",initialize:function(a){this.gamma=[1,1,1],d.BaseFilter.prototype.initialize.call(this,a)},applyTo2d:function(a){var l,f=a.imageData.data,y=this.gamma,m=f.length,_=1/y[0],C=1/y[1],D=1/y[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),l=0,m=256;l<m;l++)this.rVals[l]=255*Math.pow(l/255,_),this.gVals[l]=255*Math.pow(l/255,C),this.bVals[l]=255*Math.pow(l/255,D);for(l=0,m=f.length;l<m;l+=4)f[l]=this.rVals[f[l]],f[l+1]=this.gVals[f[l+1]],f[l+2]=this.bVals[f[l+2]]},getUniformLocations:function(a,l){return{uGamma:a.getUniformLocation(l,"uGamma")}},sendUniformData:function(a,l){a.uniform3fv(l.uGamma,this.gamma)}}),c.Image.filters.Gamma.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.Composed=(0,c.util.createClass)(d.BaseFilter,{type:"Composed",subFilters:[],initialize:function(a){this.callSuper("initialize",a),this.subFilters=this.subFilters.slice(0)},applyTo:function(a){a.passes+=this.subFilters.length-1,this.subFilters.forEach(function(l){l.applyTo(a)})},toObject:function(){return c.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(a){return a.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(a){return!a.isNeutralState()})}}),c.Image.filters.Composed.fromObject=function(a,l){var f=(a.subFilters||[]).map(function(m){return new c.Image.filters[m.type](m)}),y=new c.Image.filters.Composed({subFilters:f});return l&&l(y),y}}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.Image.filters;d.HueRotation=(0,c.util.createClass)(d.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var a=this.rotation*Math.PI,l=c.util.cos(a),f=c.util.sin(a),y=1/3,m=Math.sqrt(y)*f,_=1-l;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=l+_/3,this.matrix[1]=y*_-m,this.matrix[2]=y*_+m,this.matrix[5]=y*_+m,this.matrix[6]=l+y*_,this.matrix[7]=y*_-m,this.matrix[10]=y*_-m,this.matrix[11]=y*_+m,this.matrix[12]=l+y*_},isNeutralState:function(a){return this.calculateMatrix(),d.BaseFilter.prototype.isNeutralState.call(this,a)},applyTo:function(a){this.calculateMatrix(),d.BaseFilter.prototype.applyTo.call(this,a)}}),c.Image.filters.HueRotation.fromObject=c.Image.filters.BaseFilter.fromObject}(e),function(h){var c=h.fabric||(h.fabric={}),d=c.util.object.clone;if(c.Text)c.warn("fabric.Text is already defined");else{var p="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");c.Text=c.util.createClass(c.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:c.Object.prototype.stateProperties.concat(p),cacheProperties:c.Object.prototype.cacheProperties.concat(p),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(a,l){this.styles=l&&l.styles||{},this.text=a,this.__skipDimension=!0,this.callSuper("initialize",l),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var a=this.path;a&&(a.segmentsInfo=c.util.getPathSegmentsInfo(a.path))},getMeasuringContext:function(){return c._measuringContext||(c._measuringContext=this.canvas&&this.canvas.contextCache||c.util.createCanvasElement().getContext("2d")),c._measuringContext},_splitText:function(){var a=this._splitTextIntoLines(this.text);return this.textLines=a.lines,this._textLines=a.graphemeLines,this._unwrappedTextLines=a._unwrappedLines,this._text=a.graphemeText,a},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var a,l,y,m,_,C,D=0,E=this._textLines.length;D<E;D++)if(("justify"===this.textAlign||D!==E-1&&!this.isEndOfWrapping(D))&&(y=0,m=this._textLines[D],(l=this.getLineWidth(D))<this.width&&(C=this.textLines[D].match(this._reSpacesAndTabs)))){a=(this.width-l)/C.length;for(var A=0,T=m.length;A<=T;A++)_=this.__charBounds[D][A],this._reSpaceAndTab.test(m[A])?(_.width+=a,_.kernedWidth+=a,_.left+=y,y+=a):_.left+=y}},isEndOfWrapping:function(a){return a===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var a=this.callSuper("_getCacheCanvasDimensions"),l=this.fontSize;return a.width+=l*a.zoomX,a.height+=l*a.zoomY,a},_render:function(a){var l=this.path;l&&!l.isNotVisible()&&l._render(a),this._setTextStyles(a),this._renderTextLinesBackground(a),this._renderTextDecoration(a,"underline"),this._renderText(a),this._renderTextDecoration(a,"overline"),this._renderTextDecoration(a,"linethrough")},_renderText:function(a){"stroke"===this.paintFirst?(this._renderTextStroke(a),this._renderTextFill(a)):(this._renderTextFill(a),this._renderTextStroke(a))},_setTextStyles:function(a,l,f){if(a.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":a.textBaseline="middle";break;case"ascender":a.textBaseline="top";break;case"descender":a.textBaseline="bottom"}a.font=this._getFontDeclaration(l,f)},calcTextWidth:function(){for(var a=this.getLineWidth(0),l=1,f=this._textLines.length;l<f;l++){var y=this.getLineWidth(l);y>a&&(a=y)}return a},_renderTextLine:function(a,l,f,y,m,_){this._renderChars(a,l,f,y,m,_)},_renderTextLinesBackground:function(a){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var l,f,y,m,_,C,D,E=a.fillStyle,A=this._getLeftOffset(),T=this._getTopOffset(),M=0,F=0,U=this.path,G=0,K=this._textLines.length;G<K;G++)if(l=this.getHeightOfLine(G),this.textBackgroundColor||this.styleHas("textBackgroundColor",G)){y=this._textLines[G],f=this._getLineLeftOffset(G),F=0,M=0,m=this.getValueOfPropertyAt(G,0,"textBackgroundColor");for(var q=0,$=y.length;q<$;q++)_=this.__charBounds[G][q],C=this.getValueOfPropertyAt(G,q,"textBackgroundColor"),U?(a.save(),a.translate(_.renderLeft,_.renderTop),a.rotate(_.angle),a.fillStyle=C,C&&a.fillRect(-_.width/2,-l/this.lineHeight*(1-this._fontSizeFraction),_.width,l/this.lineHeight),a.restore()):C!==m?(D=A+f+M,"rtl"===this.direction&&(D=this.width-D-F),a.fillStyle=m,m&&a.fillRect(D,T,F,l/this.lineHeight),M=_.left,F=_.width,m=C):F+=_.kernedWidth;C&&!U&&(D=A+f+M,"rtl"===this.direction&&(D=this.width-D-F),a.fillStyle=C,a.fillRect(D,T,F,l/this.lineHeight)),T+=l}else T+=l;a.fillStyle=E,this._removeShadow(a)}},getFontCache:function(a){var l=a.fontFamily.toLowerCase();c.charWidthsCache[l]||(c.charWidthsCache[l]={});var f=c.charWidthsCache[l],y=a.fontStyle.toLowerCase()+"_"+(a.fontWeight+"").toLowerCase();return f[y]||(f[y]={}),f[y]},_measureChar:function(a,l,f,y){var m,_,C,D,E=this.getFontCache(l),A=f+a,T=this._getFontDeclaration(l)===this._getFontDeclaration(y),M=l.fontSize/this.CACHE_FONT_SIZE;if(f&&void 0!==E[f]&&(C=E[f]),void 0!==E[a]&&(D=m=E[a]),T&&void 0!==E[A]&&(D=(_=E[A])-C),void 0===m||void 0===C||void 0===_){var F=this.getMeasuringContext();this._setTextStyles(F,l,!0)}return void 0===m&&(D=m=F.measureText(a).width,E[a]=m),void 0===C&&T&&f&&(C=F.measureText(f).width,E[f]=C),T&&void 0===_&&(_=F.measureText(A).width,E[A]=_,D=_-C),{width:m*M,kernedWidth:D*M}},getHeightOfChar:function(a,l){return this.getValueOfPropertyAt(a,l,"fontSize")},measureLine:function(a){var l=this._measureLine(a);return 0!==this.charSpacing&&(l.width-=this._getWidthOfCharSpacing()),l.width<0&&(l.width=0),l},_measureLine:function(a){var l,f,y,m,_,C,D=0,E=this._textLines[a],A=new Array(E.length),T=0,M=this.path,F="right"===this.pathSide;for(this.__charBounds[a]=A,l=0;l<E.length;l++)m=this._getGraphemeBox(f=E[l],a,l,y),A[l]=m,D+=m.kernedWidth,y=f;if(A[l]={left:m?m.left+m.width:0,width:0,kernedWidth:0,height:this.fontSize},M){switch(C=M.segmentsInfo[M.segmentsInfo.length-1].length,(_=c.util.getPointOnPath(M.path,0,M.segmentsInfo)).x+=M.pathOffset.x,_.y+=M.pathOffset.y,this.textAlign){case"left":T=F?C-D:0;break;case"center":T=(C-D)/2;break;case"right":T=F?0:C-D}for(T+=this.pathStartOffset*(F?-1:1),l=F?E.length-1:0;F?l>=0:l<E.length;F?l--:l++)T>C?T%=C:T<0&&(T+=C),this._setGraphemeOnPath(T,m=A[l],_),T+=m.kernedWidth}return{width:D,numOfSpaces:0}},_setGraphemeOnPath:function(a,l,f){var m=this.path,_=c.util.getPointOnPath(m.path,a+l.kernedWidth/2,m.segmentsInfo);l.renderLeft=_.x-f.x,l.renderTop=_.y-f.y,l.angle=_.angle+("right"===this.pathSide?Math.PI:0)},_getGraphemeBox:function(a,l,f,y,m){var _,C=this.getCompleteStyleDeclaration(l,f),D=y?this.getCompleteStyleDeclaration(l,f-1):{},E=this._measureChar(a,C,y,D),A=E.kernedWidth,T=E.width;0!==this.charSpacing&&(T+=_=this._getWidthOfCharSpacing(),A+=_);var M={width:T,left:0,height:C.fontSize,kernedWidth:A,deltaY:C.deltaY};if(f>0&&!m){var F=this.__charBounds[l][f-1];M.left=F.left+F.width+E.kernedWidth-E.width}return M},getHeightOfLine:function(a){if(this.__lineHeights[a])return this.__lineHeights[a];for(var l=this._textLines[a],f=this.getHeightOfChar(a,0),y=1,m=l.length;y<m;y++)f=Math.max(this.getHeightOfChar(a,y),f);return this.__lineHeights[a]=f*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var a,l=0,f=0,y=this._textLines.length;f<y;f++)a=this.getHeightOfLine(f),l+=f===y-1?a/this.lineHeight:a;return l},_getLeftOffset:function(){return"ltr"===this.direction?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(a,l){a.save();for(var f=0,y=this._getLeftOffset(),m=this._getTopOffset(),_=0,C=this._textLines.length;_<C;_++){var D=this.getHeightOfLine(_),E=D/this.lineHeight,A=this._getLineLeftOffset(_);this._renderTextLine(l,a,this._textLines[_],y+A,m+f+E,_),f+=D}a.restore()},_renderTextFill:function(a){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(a,"fillText")},_renderTextStroke:function(a){(this.stroke&&0!==this.strokeWidth||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(a),a.save(),this._setLineDash(a,this.strokeDashArray),a.beginPath(),this._renderTextCommon(a,"strokeText"),a.closePath(),a.restore())},_renderChars:function(a,l,f,y,m,_){var C,D,E,A,M=this.getHeightOfLine(_),F=-1!==this.textAlign.indexOf("justify"),U="",G=0,K=this.path,q=!F&&0===this.charSpacing&&this.isEmptyStyles(_)&&!K,$="ltr"===this.direction,N="ltr"===this.direction?1:-1,k=l.canvas.getAttribute("dir");if(l.save(),k!==this.direction&&(l.canvas.setAttribute("dir",$?"ltr":"rtl"),l.direction=$?"ltr":"rtl",l.textAlign=$?"left":"right"),m-=M*this._fontSizeFraction/this.lineHeight,q)return this._renderChar(a,l,_,0,f.join(""),y,m,M),void l.restore();for(var z=0,J=f.length-1;z<=J;z++)A=z===J||this.charSpacing||K,U+=f[z],E=this.__charBounds[_][z],0===G?(y+=N*(E.kernedWidth-E.width),G+=E.width):G+=E.kernedWidth,F&&!A&&this._reSpaceAndTab.test(f[z])&&(A=!0),A||(C=C||this.getCompleteStyleDeclaration(_,z),D=this.getCompleteStyleDeclaration(_,z+1),A=this._hasStyleChanged(C,D)),A&&(K?(l.save(),l.translate(E.renderLeft,E.renderTop),l.rotate(E.angle),this._renderChar(a,l,_,z,U,-G/2,0,M),l.restore()):this._renderChar(a,l,_,z,U,y,m,M),U="",C=D,y+=N*G,G=0);l.restore()},_applyPatternGradientTransformText:function(a){var l,f=c.util.createCanvasElement(),y=this.width+this.strokeWidth,m=this.height+this.strokeWidth;return f.width=y,f.height=m,(l=f.getContext("2d")).beginPath(),l.moveTo(0,0),l.lineTo(y,0),l.lineTo(y,m),l.lineTo(0,m),l.closePath(),l.translate(y/2,m/2),l.fillStyle=a.toLive(l),this._applyPatternGradientTransform(l,a),l.fill(),l.createPattern(f,"no-repeat")},handleFiller:function(a,l,f){var y,m;return f.toLive?"percentage"===f.gradientUnits||f.gradientTransform||f.patternTransform?(a.translate(y=-this.width/2,m=-this.height/2),a[l]=this._applyPatternGradientTransformText(f),{offsetX:y,offsetY:m}):(a[l]=f.toLive(a,this),this._applyPatternGradientTransform(a,f)):(a[l]=f,{offsetX:0,offsetY:0})},_setStrokeStyles:function(a,l){return a.lineWidth=l.strokeWidth,a.lineCap=this.strokeLineCap,a.lineDashOffset=this.strokeDashOffset,a.lineJoin=this.strokeLineJoin,a.miterLimit=this.strokeMiterLimit,this.handleFiller(a,"strokeStyle",l.stroke)},_setFillStyles:function(a,l){return this.handleFiller(a,"fillStyle",l.fill)},_renderChar:function(a,l,f,y,m,_,C){var D,E,A=this._getStyleDeclaration(f,y),T=this.getCompleteStyleDeclaration(f,y),M="fillText"===a&&T.fill,F="strokeText"===a&&T.stroke&&T.strokeWidth;(F||M)&&(l.save(),M&&(D=this._setFillStyles(l,T)),F&&(E=this._setStrokeStyles(l,T)),l.font=this._getFontDeclaration(T),A&&A.textBackgroundColor&&this._removeShadow(l),A&&A.deltaY&&(C+=A.deltaY),M&&l.fillText(m,_-D.offsetX,C-D.offsetY),F&&l.strokeText(m,_-E.offsetX,C-E.offsetY),l.restore())},setSuperscript:function(a,l){return this._setScript(a,l,this.superscript)},setSubscript:function(a,l){return this._setScript(a,l,this.subscript)},_setScript:function(a,l,f){var y=this.get2DCursorLocation(a,!0),m=this.getValueOfPropertyAt(y.lineIndex,y.charIndex,"fontSize"),_=this.getValueOfPropertyAt(y.lineIndex,y.charIndex,"deltaY");return this.setSelectionStyles({fontSize:m*f.size,deltaY:_+m*f.baseline},a,l),this},_hasStyleChanged:function(a,l){return a.fill!==l.fill||a.stroke!==l.stroke||a.strokeWidth!==l.strokeWidth||a.fontSize!==l.fontSize||a.fontFamily!==l.fontFamily||a.fontWeight!==l.fontWeight||a.fontStyle!==l.fontStyle||a.deltaY!==l.deltaY},_hasStyleChangedForSvg:function(a,l){return this._hasStyleChanged(a,l)||a.overline!==l.overline||a.underline!==l.underline||a.linethrough!==l.linethrough},_getLineLeftOffset:function(a){var l=this.getLineWidth(a),f=this.width-l,y=this.textAlign,m=this.direction,_=0,C=this.isEndOfWrapping(a);return"justify"===y||"justify-center"===y&&!C||"justify-right"===y&&!C||"justify-left"===y&&!C?0:("center"===y&&(_=f/2),"right"===y&&(_=f),"justify-center"===y&&(_=f/2),"justify-right"===y&&(_=f),"rtl"===m&&(_-=f),_)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var a=this._forceClearCache;return a||(a=this.hasStateChanged("_dimensionAffectingProps")),a&&(this.dirty=!0,this._forceClearCache=!1),a},getLineWidth:function(a){if(void 0!==this.__lineWidths[a])return this.__lineWidths[a];var l=this.measureLine(a).width;return this.__lineWidths[a]=l,l},_getWidthOfCharSpacing:function(){return 0!==this.charSpacing?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(a,l,f){var y=this._getStyleDeclaration(a,l);return y&&void 0!==y[f]?y[f]:this[f]},_renderTextDecoration:function(a,l){if(this[l]||this.styleHas(l)){for(var f,y,m,_,C,D,E,A,T,M,F,U,G,K,q,$,N=this._getLeftOffset(),k=this._getTopOffset(),z=this.path,J=this._getWidthOfCharSpacing(),Q=this.offsets[l],H=0,j=this._textLines.length;H<j;H++)if(f=this.getHeightOfLine(H),this[l]||this.styleHas(l,H)){E=this._textLines[H],K=f/this.lineHeight,_=this._getLineLeftOffset(H),M=0,F=0,A=this.getValueOfPropertyAt(H,0,l),$=this.getValueOfPropertyAt(H,0,"fill"),T=k+K*(1-this._fontSizeFraction),y=this.getHeightOfChar(H,0),C=this.getValueOfPropertyAt(H,0,"deltaY");for(var Y=0,te=E.length;Y<te;Y++)if(U=this.__charBounds[H][Y],G=this.getValueOfPropertyAt(H,Y,l),q=this.getValueOfPropertyAt(H,Y,"fill"),m=this.getHeightOfChar(H,Y),D=this.getValueOfPropertyAt(H,Y,"deltaY"),z&&G&&q)a.save(),a.fillStyle=$,a.translate(U.renderLeft,U.renderTop),a.rotate(U.angle),a.fillRect(-U.kernedWidth/2,Q*m+D,U.kernedWidth,this.fontSize/15),a.restore();else if((G!==A||q!==$||m!==y||D!==C)&&F>0){var Z=N+_+M;"rtl"===this.direction&&(Z=this.width-Z-F),A&&$&&(a.fillStyle=$,a.fillRect(Z,T+Q*y+C,F,this.fontSize/15)),M=U.left,F=U.width,A=G,$=q,y=m,C=D}else F+=U.kernedWidth;Z=N+_+M,"rtl"===this.direction&&(Z=this.width-Z-F),a.fillStyle=q,G&&q&&a.fillRect(Z,T+Q*y+C,F-J,this.fontSize/15),k+=f}else k+=f;this._removeShadow(a)}},_getFontDeclaration:function(a,l){var f=a||this,y=this.fontFamily,m=c.Text.genericFonts.indexOf(y.toLowerCase())>-1,_=void 0===y||y.indexOf("'")>-1||y.indexOf(",")>-1||y.indexOf('"')>-1||m?f.fontFamily:'"'+f.fontFamily+'"';return[c.isLikelyNode?f.fontWeight:f.fontStyle,c.isLikelyNode?f.fontStyle:f.fontWeight,l?this.CACHE_FONT_SIZE+"px":f.fontSize+"px",_].join(" ")},render:function(a){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",a)))},_splitTextIntoLines:function(a){for(var l=a.split(this._reNewline),f=new Array(l.length),y=["\n"],m=[],_=0;_<l.length;_++)f[_]=c.util.string.graphemeSplit(l[_]),m=m.concat(f[_],y);return m.pop(),{_unwrappedLines:f,lines:l,graphemeText:m,graphemeLines:f}},toObject:function(a){var l=p.concat(a),f=this.callSuper("toObject",l);return f.styles=d(this.styles,!0),f.path&&(f.path=this.path.toObject()),f},set:function(a,l){this.callSuper("set",a,l);var f=!1,y=!1;if("object"==typeof a)for(var m in a)"path"===m&&this.setPathInfo(),f=f||-1!==this._dimensionAffectingProps.indexOf(m),y=y||"path"===m;else f=-1!==this._dimensionAffectingProps.indexOf(a),y="path"===a;return y&&this.setPathInfo(),f&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),c.Text.ATTRIBUTE_NAMES=c.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),c.Text.DEFAULT_SVG_FONT_SIZE=16,c.Text.fromElement=function(a,l,f){if(!a)return l(null);var y=c.parseAttributes(a,c.Text.ATTRIBUTE_NAMES),m=y.textAnchor||"left";if((f=c.util.object.extend(f?d(f):{},y)).top=f.top||0,f.left=f.left||0,y.textDecoration){var _=y.textDecoration;-1!==_.indexOf("underline")&&(f.underline=!0),-1!==_.indexOf("overline")&&(f.overline=!0),-1!==_.indexOf("line-through")&&(f.linethrough=!0),delete f.textDecoration}"dx"in y&&(f.left+=y.dx),"dy"in y&&(f.top+=y.dy),"fontSize"in f||(f.fontSize=c.Text.DEFAULT_SVG_FONT_SIZE);var C="";"textContent"in a?C=a.textContent:"firstChild"in a&&null!==a.firstChild&&"data"in a.firstChild&&null!==a.firstChild.data&&(C=a.firstChild.data),C=C.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var D=f.strokeWidth;f.strokeWidth=0;var E=new c.Text(C,f),A=E.getScaledHeight()/E.height,T=((E.height+E.strokeWidth)*E.lineHeight-E.height)*A,M=E.getScaledHeight()+T,F=0;"center"===m&&(F=E.getScaledWidth()/2),"right"===m&&(F=E.getScaledWidth()),E.set({left:E.left-F,top:E.top-(M-E.fontSize*(.07+E._fontSizeFraction))/E.lineHeight,strokeWidth:void 0!==D?D:1}),l(E)},c.Text.fromObject=function(a,l){var f=d(a),y=a.path;return delete f.path,c.Object._fromObject("Text",f,function(m){y?c.Object._fromObject("Path",y,function(_){m.set("path",_),l(m)},"path"):l(m)},"text")},c.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],c.util.createAccessors&&c.util.createAccessors(c.Text)}}(e),S.util.object.extend(S.Text.prototype,{isEmptyStyles:function(h){if(!this.styles||void 0!==h&&!this.styles[h])return!0;var c=void 0===h?this.styles:{line:this.styles[h]};for(var d in c)for(var p in c[d])for(var a in c[d][p])return!1;return!0},styleHas:function(h,c){if(!this.styles||!h||""===h||void 0!==c&&!this.styles[c])return!1;var d=void 0===c?this.styles:{0:this.styles[c]};for(var p in d)for(var a in d[p])if(void 0!==d[p][a][h])return!0;return!1},cleanStyle:function(h){if(!this.styles||!h||""===h)return!1;var c,d,p=this.styles,a=0,l=!0,f=0;for(var y in p){for(var m in c=0,p[y]){var _;a++,(_=p[y][m]).hasOwnProperty(h)?(d?_[h]!==d&&(l=!1):d=_[h],_[h]===this[h]&&delete _[h]):l=!1,0!==Object.keys(_).length?c++:delete p[y][m]}0===c&&delete p[y]}for(var C=0;C<this._textLines.length;C++)f+=this._textLines[C].length;l&&a===f&&(this[h]=d,this.removeStyle(h))},removeStyle:function(h){if(this.styles&&h&&""!==h){var c,d,p,a=this.styles;for(d in a){for(p in c=a[d])delete c[p][h],0===Object.keys(c[p]).length&&delete c[p];0===Object.keys(c).length&&delete a[d]}}},_extendStyles:function(h,c){var d=this.get2DCursorLocation(h);this._getLineStyle(d.lineIndex)||this._setLineStyle(d.lineIndex),this._getStyleDeclaration(d.lineIndex,d.charIndex)||this._setStyleDeclaration(d.lineIndex,d.charIndex,{}),S.util.object.extend(this._getStyleDeclaration(d.lineIndex,d.charIndex),c)},get2DCursorLocation:function(h,c){void 0===h&&(h=this.selectionStart);for(var d=c?this._unwrappedTextLines:this._textLines,p=d.length,a=0;a<p;a++){if(h<=d[a].length)return{lineIndex:a,charIndex:h};h-=d[a].length+this.missingNewlineOffset(a)}return{lineIndex:a-1,charIndex:d[a-1].length<h?d[a-1].length:h}},getSelectionStyles:function(h,c,d){void 0===h&&(h=this.selectionStart||0),void 0===c&&(c=this.selectionEnd||h);for(var p=[],a=h;a<c;a++)p.push(this.getStyleAtPosition(a,d));return p},getStyleAtPosition:function(h,c){var d=this.get2DCursorLocation(h);return(c?this.getCompleteStyleDeclaration(d.lineIndex,d.charIndex):this._getStyleDeclaration(d.lineIndex,d.charIndex))||{}},setSelectionStyles:function(h,c,d){void 0===c&&(c=this.selectionStart||0),void 0===d&&(d=this.selectionEnd||c);for(var p=c;p<d;p++)this._extendStyles(p,h);return this._forceClearCache=!0,this},_getStyleDeclaration:function(h,c){var d=this.styles&&this.styles[h];return d?d[c]:null},getCompleteStyleDeclaration:function(h,c){for(var d,p=this._getStyleDeclaration(h,c)||{},a={},l=0;l<this._styleProperties.length;l++)a[d=this._styleProperties[l]]=void 0===p[d]?this[d]:p[d];return a},_setStyleDeclaration:function(h,c,d){this.styles[h][c]=d},_deleteStyleDeclaration:function(h,c){delete this.styles[h][c]},_getLineStyle:function(h){return!!this.styles[h]},_setLineStyle:function(h){this.styles[h]={}},_deleteLineStyle:function(h){delete this.styles[h]}}),function(){function h(c){c.textDecoration&&(c.textDecoration.indexOf("underline")>-1&&(c.underline=!0),c.textDecoration.indexOf("line-through")>-1&&(c.linethrough=!0),c.textDecoration.indexOf("overline")>-1&&(c.overline=!0),delete c.textDecoration)}S.IText=S.util.createClass(S.Text,S.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(c,d){this.callSuper("initialize",c,d),this.initBehavior()},setSelectionStart:function(c){c=Math.max(c,0),this._updateAndFire("selectionStart",c)},setSelectionEnd:function(c){c=Math.min(c,this.text.length),this._updateAndFire("selectionEnd",c)},_updateAndFire:function(c,d){this[c]!==d&&(this._fireSelectionChanged(),this[c]=d),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(c){this.clearContextTop(),this.callSuper("render",c),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(c){this.callSuper("_render",c)},clearContextTop:function(c){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var d=this.canvas.contextTop,p=this.canvas.viewportTransform;d.save(),d.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this.transform(d),this._clearTextArea(d),c||d.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var c=this._getCursorBoundaries(),d=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(c,d):this.renderSelection(c,d),d.restore()}},_clearTextArea:function(c){var d=this.width+4,p=this.height+4;c.clearRect(-d/2,-p/2,d,p)},_getCursorBoundaries:function(c){void 0===c&&(c=this.selectionStart);var d=this._getLeftOffset(),p=this._getTopOffset(),a=this._getCursorBoundariesOffsets(c);return{left:d,top:p,leftOffset:a.left,topOffset:a.top}},_getCursorBoundariesOffsets:function(c){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var d,p,a,l,f=0,y=0,m=this.get2DCursorLocation(c);a=m.charIndex,p=m.lineIndex;for(var _=0;_<p;_++)f+=this.getHeightOfLine(_);d=this._getLineLeftOffset(p);var C=this.__charBounds[p][a];return C&&(y=C.left),0!==this.charSpacing&&a===this._textLines[p].length&&(y-=this._getWidthOfCharSpacing()),l={top:f,left:d+(y>0?y:0)},"rtl"===this.direction&&(l.left*=-1),this.cursorOffsetCache=l,this.cursorOffsetCache},renderCursor:function(c,d){var p=this.get2DCursorLocation(),a=p.lineIndex,l=p.charIndex>0?p.charIndex-1:0,f=this.getValueOfPropertyAt(a,l,"fontSize"),y=this.scaleX*this.canvas.getZoom(),m=this.cursorWidth/y,_=c.topOffset,C=this.getValueOfPropertyAt(a,l,"deltaY");_+=(1-this._fontSizeFraction)*this.getHeightOfLine(a)/this.lineHeight-f*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(c,d),d.fillStyle=this.cursorColor||this.getValueOfPropertyAt(a,l,"fill"),d.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,d.fillRect(c.left+c.leftOffset-m/2,_+c.top+C,m,f)},renderSelection:function(c,d){for(var p=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,a=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,l=-1!==this.textAlign.indexOf("justify"),f=this.get2DCursorLocation(p),y=this.get2DCursorLocation(a),m=f.lineIndex,_=y.lineIndex,C=f.charIndex<0?0:f.charIndex,D=y.charIndex<0?0:y.charIndex,E=m;E<=_;E++){var A,T=this._getLineLeftOffset(E)||0,M=this.getHeightOfLine(E),F=0,U=0;if(E===m&&(F=this.__charBounds[m][C].left),E>=m&&E<_)U=l&&!this.isEndOfWrapping(E)?this.width:this.getLineWidth(E)||5;else if(E===_)if(0===D)U=this.__charBounds[_][D].left;else{var G=this._getWidthOfCharSpacing();U=this.__charBounds[_][D-1].left+this.__charBounds[_][D-1].width-G}A=M,(this.lineHeight<1||E===_&&this.lineHeight>1)&&(M/=this.lineHeight);var K=c.left+T+F,q=U-F,$=M,N=0;this.inCompositionMode?(d.fillStyle=this.compositionColor||"black",$=1,N=M):d.fillStyle=this.selectionColor,"rtl"===this.direction&&(K=this.width-K-q),d.fillRect(K,c.top+c.topOffset+N,q,$),c.topOffset+=A}},getCurrentCharFontSize:function(){var c=this._getCurrentCharIndex();return this.getValueOfPropertyAt(c.l,c.c,"fontSize")},getCurrentCharColor:function(){var c=this._getCurrentCharIndex();return this.getValueOfPropertyAt(c.l,c.c,"fill")},_getCurrentCharIndex:function(){var c=this.get2DCursorLocation(this.selectionStart,!0);return{l:c.lineIndex,c:c.charIndex>0?c.charIndex-1:0}}}),S.IText.fromObject=function(c,d){if(h(c),c.styles)for(var p in c.styles)for(var a in c.styles[p])h(c.styles[p][a]);S.Object._fromObject("IText",c,d,"text")}}(),ye=S.util.object.clone,S.util.object.extend(S.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var h=this;this.on("added",function(){var c=h.canvas;c&&(c._hasITextHandlers||(c._hasITextHandlers=!0,h._initCanvasHandlers(c)),c._iTextInstances=c._iTextInstances||[],c._iTextInstances.push(h))})},initRemovedHandler:function(){var h=this;this.on("removed",function(){var c=h.canvas;c&&(c._iTextInstances=c._iTextInstances||[],S.util.removeFromArray(c._iTextInstances,h),0===c._iTextInstances.length&&(c._hasITextHandlers=!1,h._removeCanvasHandlers(c)))})},_initCanvasHandlers:function(h){h._mouseUpITextHandler=function(){h._iTextInstances&&h._iTextInstances.forEach(function(c){c.__isMousedown=!1})},h.on("mouse:up",h._mouseUpITextHandler)},_removeCanvasHandlers:function(h){h.off("mouse:up",h._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(h,c,d,p){var a;return a={isAborted:!1,abort:function(){this.isAborted=!0}},h.animate("_currentCursorOpacity",c,{duration:d,onComplete:function(){a.isAborted||h[p]()},onChange:function(){h.canvas&&h.selectionStart===h.selectionEnd&&h.renderCursorOrSelection()},abort:function(){return a.isAborted}}),a},_onTickComplete:function(){var h=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){h._currentTickCompleteState=h._animateCursor(h,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(h){var c=this,d=h?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){c._tick()},d)},abortCursorAnimation:function(){var h=this._currentTickState||this._currentTickCompleteState,c=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,h&&c&&c.clearContext(c.contextTop||c.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(h){var c=0,d=h-1;if(this._reSpace.test(this._text[d]))for(;this._reSpace.test(this._text[d]);)c++,d--;for(;/\S/.test(this._text[d])&&d>-1;)c++,d--;return h-c},findWordBoundaryRight:function(h){var c=0,d=h;if(this._reSpace.test(this._text[d]))for(;this._reSpace.test(this._text[d]);)c++,d++;for(;/\S/.test(this._text[d])&&d<this._text.length;)c++,d++;return h+c},findLineBoundaryLeft:function(h){for(var c=0,d=h-1;!/\n/.test(this._text[d])&&d>-1;)c++,d--;return h-c},findLineBoundaryRight:function(h){for(var c=0,d=h;!/\n/.test(this._text[d])&&d<this._text.length;)c++,d++;return h+c},searchWordBoundary:function(h,c){for(var d=this._text,p=this._reSpace.test(d[h])?h-1:h,a=d[p],l=S.reNonWord;!l.test(a)&&p>0&&p<d.length;)a=d[p+=c];return l.test(a)&&(p+=1===c?0:1),p},selectWord:function(h){var c=this.searchWordBoundary(h=h||this.selectionStart,-1),d=this.searchWordBoundary(h,1);this.selectionStart=c,this.selectionEnd=d,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(h){var c=this.findLineBoundaryLeft(h=h||this.selectionStart),d=this.findLineBoundaryRight(h);return this.selectionStart=c,this.selectionEnd=d,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(h){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(h),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(h){h._iTextInstances&&h._iTextInstances.forEach(function(c){c.selected=!1,c.isEditing&&c.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(h){if(this.__isMousedown&&this.isEditing){var c=this.getSelectionStartFromPointer(h.e),d=this.selectionStart,p=this.selectionEnd;(c===this.__selectionStartOnMouseDown&&d!==p||d!==c&&p!==c)&&(c>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=c):(this.selectionStart=c,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===d&&this.selectionEnd===p||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(h,c,d){var p=d.slice(0,h),a=S.util.string.graphemeSplit(p).length;if(h===c)return{selectionStart:a,selectionEnd:a};var l=d.slice(h,c);return{selectionStart:a,selectionEnd:a+S.util.string.graphemeSplit(l).length}},fromGraphemeToStringSelection:function(h,c,d){var p=d.slice(0,h).join("").length;return h===c?{selectionStart:p,selectionEnd:p}:{selectionStart:p,selectionEnd:p+d.slice(h,c).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var h=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=h.selectionStart,this.hiddenTextarea.selectionEnd=h.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var h=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=h.selectionEnd,this.inCompositionMode||(this.selectionStart=h.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var h=this._calcTextareaPosition();this.hiddenTextarea.style.left=h.left,this.hiddenTextarea.style.top=h.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var h=this.inCompositionMode?this.compositionStart:this.selectionStart,c=this._getCursorBoundaries(h),d=this.get2DCursorLocation(h),l=this.getValueOfPropertyAt(d.lineIndex,d.charIndex,"fontSize")*this.lineHeight,f=c.leftOffset,y=this.calcTransformMatrix(),m={x:c.left+f,y:c.top+c.topOffset+l},_=this.canvas.getRetinaScaling(),C=this.canvas.upperCanvasEl,D=C.width/_,E=C.height/_,A=D-l,T=E-l,M=C.clientWidth/D,F=C.clientHeight/E;return m=S.util.transformPoint(m,y),(m=S.util.transformPoint(m,this.canvas.viewportTransform)).x*=M,m.y*=F,m.x<0&&(m.x=0),m.x>A&&(m.x=A),m.y<0&&(m.y=0),m.y>T&&(m.y=T),m.x+=this.canvas._offset.left,m.y+=this.canvas._offset.top,{left:m.x+"px",top:m.y+"px",fontSize:l+"px",charHeight:l}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var h=this._textBeforeEdit!==this.text,c=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,c&&(c.blur&&c.blur(),c.parentNode&&c.parentNode.removeChild(c)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),h&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),h&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var h in this.styles)this._textLines[h]||delete this.styles[h]},removeStyleFromTo:function(h,c){var d,p,a=this.get2DCursorLocation(h,!0),l=this.get2DCursorLocation(c,!0),f=a.lineIndex,y=a.charIndex,m=l.lineIndex,_=l.charIndex;if(f!==m){if(this.styles[f])for(d=y;d<this._unwrappedTextLines[f].length;d++)delete this.styles[f][d];if(this.styles[m])for(d=_;d<this._unwrappedTextLines[m].length;d++)(p=this.styles[m][d])&&(this.styles[f]||(this.styles[f]={}),this.styles[f][y+d-_]=p);for(d=f+1;d<=m;d++)delete this.styles[d];this.shiftLineStyles(m,f-m)}else if(this.styles[f]){p=this.styles[f];var C,D,E=_-y;for(d=y;d<_;d++)delete p[d];for(D in this.styles[f])(C=parseInt(D,10))>=_&&(p[C-E]=p[D],delete p[D])}},shiftLineStyles:function(h,c){var d=ye(this.styles);for(var p in this.styles){var a=parseInt(p,10);a>h&&(this.styles[a+c]=d[a],d[a-c]||delete this.styles[a])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(h,c,d,p){var a,l={},f=!1,y=this._unwrappedTextLines[h].length===c;for(var m in d||(d=1),this.shiftLineStyles(h,d),this.styles[h]&&(a=this.styles[h][0===c?c:c-1]),this.styles[h]){var _=parseInt(m,10);_>=c&&(f=!0,l[_-c]=this.styles[h][m],y&&0===c||delete this.styles[h][m])}var C=!1;for(f&&!y&&(this.styles[h+d]=l,C=!0),C&&d--;d>0;)p&&p[d-1]?this.styles[h+d]={0:ye(p[d-1])}:a?this.styles[h+d]={0:ye(a)}:delete this.styles[h+d],d--;this._forceClearCache=!0},insertCharStyleObject:function(h,c,d,p){this.styles||(this.styles={});var a=this.styles[h],l=a?ye(a):{};for(var f in d||(d=1),l){var y=parseInt(f,10);y>=c&&(a[y+d]=l[y],l[y-d]||delete a[y])}if(this._forceClearCache=!0,p)for(;d--;)Object.keys(p[d]).length&&(this.styles[h]||(this.styles[h]={}),this.styles[h][c+d]=ye(p[d]));else if(a)for(var m=a[c?c-1:1];m&&d--;)this.styles[h][c+d]=ye(m)},insertNewStyleBlock:function(h,c,d){for(var p=this.get2DCursorLocation(c,!0),a=[0],l=0,f=0;f<h.length;f++)"\n"===h[f]?a[++l]=0:a[l]++;for(a[0]>0&&(this.insertCharStyleObject(p.lineIndex,p.charIndex,a[0],d),d=d&&d.slice(a[0]+1)),l&&this.insertNewlineStyleObject(p.lineIndex,p.charIndex+a[0],l),f=1;f<l;f++)a[f]>0?this.insertCharStyleObject(p.lineIndex+f,0,a[f],d):d&&this.styles[p.lineIndex+f]&&d[0]&&(this.styles[p.lineIndex+f][0]=d[0]),d=d&&d.slice(a[f]+1);a[f]>0&&this.insertCharStyleObject(p.lineIndex+f,0,a[f],d)},setSelectionStartEndWithShift:function(h,c,d){d<=h?(c===h?this._selectionDirection="left":"right"===this._selectionDirection&&(this._selectionDirection="left",this.selectionEnd=h),this.selectionStart=d):d>h&&d<c?"right"===this._selectionDirection?this.selectionEnd=d:this.selectionStart=d:(c===h?this._selectionDirection="right":"left"===this._selectionDirection&&(this._selectionDirection="right",this.selectionStart=c),this.selectionEnd=d)},setSelectionInBoundaries:function(){var h=this.text.length;this.selectionStart>h?this.selectionStart=h:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>h?this.selectionEnd=h:this.selectionEnd<0&&(this.selectionEnd=0)}}),S.util.object.extend(S.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(h){if(this.canvas){this.__newClickTime=+new Date;var c=h.pointer;this.isTripleClick(c)&&(this.fire("tripleclick",h),this._stopEvent(h.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=c,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(h){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===h.x&&this.__lastPointer.y===h.y},_stopEvent:function(h){h.preventDefault&&h.preventDefault(),h.stopPropagation&&h.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(h){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(h.e))},tripleClickHandler:function(h){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(h.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(h){!this.canvas||!this.editable||h.e.button&&1!==h.e.button||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(h.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(h){!this.canvas||!this.editable||h.e.button&&1!==h.e.button||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(h){if(this.__isMousedown=!1,!(!this.editable||this.group||h.transform&&h.transform.actionPerformed||h.e.button&&1!==h.e.button)){if(this.canvas){var c=this.canvas._activeObject;if(c&&c!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(h.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(h){var c=this.getSelectionStartFromPointer(h);h.shiftKey?this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,c):(this.selectionStart=c,this.selectionEnd=c),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(h){for(var c,d=this.getLocalPointer(h),p=0,a=0,l=0,f=0,y=0,m=0,_=this._textLines.length;m<_&&l<=d.y;m++)l+=this.getHeightOfLine(m)*this.scaleY,y=m,m>0&&(f+=this._textLines[m-1].length+this.missingNewlineOffset(m-1));a=this._getLineLeftOffset(y)*this.scaleX,c=this._textLines[y],"rtl"===this.direction&&(d.x=this.width*this.scaleX-d.x+a);for(var C=0,D=c.length;C<D&&(p=a,(a+=this.__charBounds[y][C].kernedWidth*this.scaleX)<=d.x);C++)f++;return this._getNewSelectionStartFromOffset(d,p,a,f,D)},_getNewSelectionStartFromOffset:function(h,c,d,p,a){var f=d-h.x,y=p+(f>h.x-c||f<0?0:1);return this.flipX&&(y=a-y),y>this._text.length&&(y=this._text.length),y}}),S.util.object.extend(S.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=S.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var h=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+h.top+"; left: "+h.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uff70top: "+h.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):S.document.body.appendChild(this.hiddenTextarea),S.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),S.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),S.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),S.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),S.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),S.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),S.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),S.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),S.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(S.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(h){if(this.isEditing){var c="rtl"===this.direction?this.keysMapRtl:this.keysMap;if(h.keyCode in c)this[c[h.keyCode]](h);else{if(!(h.keyCode in this.ctrlKeysMapDown)||!h.ctrlKey&&!h.metaKey)return;this[this.ctrlKeysMapDown[h.keyCode]](h)}h.stopImmediatePropagation(),h.preventDefault(),h.keyCode>=33&&h.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(h){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:h.keyCode in this.ctrlKeysMapUp&&(h.ctrlKey||h.metaKey)&&(this[this.ctrlKeysMapUp[h.keyCode]](h),h.stopImmediatePropagation(),h.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(h){var c=this.fromPaste;if(this.fromPaste=!1,h&&h.stopPropagation(),this.isEditing){var d,p,a,l,f,y=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,m=this._text.length,_=y.length,C=_-m,D=this.selectionStart,E=this.selectionEnd,A=D!==E;if(""===this.hiddenTextarea.value)return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var T=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),M=D>T.selectionStart;A?(d=this._text.slice(D,E),C+=E-D):_<m&&(d=M?this._text.slice(E+C,E):this._text.slice(D,D-C)),p=y.slice(T.selectionEnd-C,T.selectionEnd),d&&d.length&&(p.length&&(a=this.getSelectionStyles(D,D+1,!1),a=p.map(function(){return a[0]})),A?(l=D,f=E):M?(l=E-d.length,f=E):(l=E,f=E+d.length),this.removeStyleFromTo(l,f)),p.length&&(c&&p.join("")===S.copiedText&&!S.disableStyleCopyPaste&&(a=S.copiedTextStyle),this.insertNewStyleBlock(p,D,a)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(h){this.compositionStart=h.target.selectionStart,this.compositionEnd=h.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(S.copiedText=this.getSelectedText(),S.copiedTextStyle=S.disableStyleCopyPaste?null:this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(h){return h&&h.clipboardData||S.window.clipboardData},_getWidthBeforeCursor:function(h,c){var d,p=this._getLineLeftOffset(h);return c>0&&(p+=(d=this.__charBounds[h][c-1]).left+d.width),p},getDownCursorOffset:function(h,c){var d=this._getSelectionForOffset(h,c),p=this.get2DCursorLocation(d),a=p.lineIndex;if(a===this._textLines.length-1||h.metaKey||34===h.keyCode)return this._text.length-d;var l=p.charIndex,f=this._getWidthBeforeCursor(a,l),y=this._getIndexOnLine(a+1,f);return this._textLines[a].slice(l).length+y+1+this.missingNewlineOffset(a)},_getSelectionForOffset:function(h,c){return h.shiftKey&&this.selectionStart!==this.selectionEnd&&c?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(h,c){var d=this._getSelectionForOffset(h,c),p=this.get2DCursorLocation(d),a=p.lineIndex;if(0===a||h.metaKey||33===h.keyCode)return-d;var l=p.charIndex,f=this._getWidthBeforeCursor(a,l),y=this._getIndexOnLine(a-1,f),m=this._textLines[a].slice(0,l),_=this.missingNewlineOffset(a-1);return-this._textLines[a-1].length+y-m.length+(1-_)},_getIndexOnLine:function(h,c){for(var d,p,a=this._textLines[h],l=this._getLineLeftOffset(h),f=0,y=0,m=a.length;y<m;y++)if((l+=d=this.__charBounds[h][y].width)>c){p=!0;var C=l,D=Math.abs(l-d-c);f=Math.abs(C-c)<D?y:y-1;break}return p||(f=a.length-1),f},moveCursorDown:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",h)},moveCursorUp:function(h){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorUpOrDown("Up",h)},_moveCursorUpOrDown:function(h,c){var d=this["get"+h+"CursorOffset"](c,"right"===this._selectionDirection);c.shiftKey?this.moveCursorWithShift(d):this.moveCursorWithoutShift(d),0!==d&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(h){return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,"left"===this._selectionDirection?this.selectionStart+h:this.selectionEnd+h),0!==h},moveCursorWithoutShift:function(h){return h<0?(this.selectionStart+=h,this.selectionEnd=this.selectionStart):(this.selectionEnd+=h,this.selectionStart=this.selectionEnd),0!==h},moveCursorLeft:function(h){0===this.selectionStart&&0===this.selectionEnd||this._moveCursorLeftOrRight("Left",h)},_move:function(h,c,d){var p;if(h.altKey)p=this["findWordBoundary"+d](this[c]);else{if(!h.metaKey&&35!==h.keyCode&&36!==h.keyCode)return this[c]+="Left"===d?-1:1,!0;p=this["findLineBoundary"+d](this[c])}if(void 0!==typeof p&&this[c]!==p)return this[c]=p,!0},_moveLeft:function(h,c){return this._move(h,c,"Left")},_moveRight:function(h,c){return this._move(h,c,"Right")},moveCursorLeftWithoutShift:function(h){var c=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&0!==this.selectionStart&&(c=this._moveLeft(h,"selectionStart")),this.selectionEnd=this.selectionStart,c},moveCursorLeftWithShift:function(h){return"right"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveLeft(h,"selectionEnd"):0!==this.selectionStart?(this._selectionDirection="left",this._moveLeft(h,"selectionStart")):void 0},moveCursorRight:function(h){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",h)},_moveCursorLeftOrRight:function(h,c){var d="moveCursor"+h+"With";this._currentCursorOpacity=1,this[d+=c.shiftKey?"Shift":"outShift"](c)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(h){return"left"===this._selectionDirection&&this.selectionStart!==this.selectionEnd?this._moveRight(h,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(h,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(h){var c=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(c=this._moveRight(h,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,c},removeChars:function(h,c){void 0===c&&(c=h+1),this.removeStyleFromTo(h,c),this._text.splice(h,c-h),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(h,c,d,p){void 0===p&&(p=d),p>d&&this.removeStyleFromTo(d,p);var a=S.util.string.graphemeSplit(h);this.insertNewStyleBlock(a,d,c),this._text=[].concat(this._text.slice(0,d),a,this._text.slice(p)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var h=S.util.toFixed,c=/  +/g;S.util.object.extend(S.Text.prototype,{_toSVG:function(){var d=this._getSVGLeftTopOffsets(),p=this._getSVGTextAndBg(d.textTop,d.textLeft);return this._wrapSVGTextAndBg(p)},toSVG:function(d){return this._createBaseSVGMarkup(this._toSVG(),{reviver:d,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(d){var p=this.getSvgTextDecoration(this);return[d.textBgRects.join(""),'\t\t<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",p?'text-decoration="'+p+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",d.textSpans.join(""),"</text>\n"]},_getSVGTextAndBg:function(d,p){var a,l=[],f=[],y=d;this._setSVGBg(f);for(var m=0,_=this._textLines.length;m<_;m++)a=this._getLineLeftOffset(m),(this.textBackgroundColor||this.styleHas("textBackgroundColor",m))&&this._setSVGTextLineBg(f,m,p+a,y),this._setSVGTextLineText(l,m,p+a,y),y+=this.getHeightOfLine(m);return{textSpans:l,textBgRects:f}},_createTextCharSpan:function(d,p,a,l){var f=d!==d.trim()||d.match(c),y=this.getSvgSpanStyles(p,f),m=y?'style="'+y+'"':"",_=p.deltaY,C="",D=S.Object.NUM_FRACTION_DIGITS;return _&&(C=' dy="'+h(_,D)+'" '),['<tspan x="',h(a,D),'" y="',h(l,D),'" ',C,m,">",S.util.string.escapeXml(d),"</tspan>"].join("")},_setSVGTextLineText:function(d,p,a,l){var f,y,m,_,C,D=this.getHeightOfLine(p),E=-1!==this.textAlign.indexOf("justify"),A="",T=0,M=this._textLines[p];l+=D*(1-this._fontSizeFraction)/this.lineHeight;for(var F=0,U=M.length-1;F<=U;F++)C=F===U||this.charSpacing,A+=M[F],m=this.__charBounds[p][F],0===T?(a+=m.kernedWidth-m.width,T+=m.width):T+=m.kernedWidth,E&&!C&&this._reSpaceAndTab.test(M[F])&&(C=!0),C||(f=f||this.getCompleteStyleDeclaration(p,F),y=this.getCompleteStyleDeclaration(p,F+1),C=this._hasStyleChangedForSvg(f,y)),C&&(_=this._getStyleDeclaration(p,F)||{},d.push(this._createTextCharSpan(A,_,a,l)),A="",f=y,a+=T,T=0)},_pushTextBgRect:function(d,p,a,l,f,y){var m=S.Object.NUM_FRACTION_DIGITS;d.push("\t\t<rect ",this._getFillAttributes(p),' x="',h(a,m),'" y="',h(l,m),'" width="',h(f,m),'" height="',h(y,m),'"></rect>\n')},_setSVGTextLineBg:function(d,p,a,l){for(var f,y,m=this._textLines[p],_=this.getHeightOfLine(p)/this.lineHeight,C=0,D=0,E=this.getValueOfPropertyAt(p,0,"textBackgroundColor"),A=0,T=m.length;A<T;A++)f=this.__charBounds[p][A],(y=this.getValueOfPropertyAt(p,A,"textBackgroundColor"))!==E?(E&&this._pushTextBgRect(d,E,a+D,l,C,_),D=f.left,C=f.width,E=y):C+=f.kernedWidth;y&&this._pushTextBgRect(d,y,a+D,l,C,_)},_getFillAttributes:function(d){var p=d&&"string"==typeof d?new S.Color(d):"";return p&&p.getSource()&&1!==p.getAlpha()?'opacity="'+p.getAlpha()+'" fill="'+p.setAlpha(1).toRgb()+'"':'fill="'+d+'"'},_getSVGLineTopOffset:function(d){for(var p,a=0,l=0;l<d;l++)a+=this.getHeightOfLine(l);return p=this.getHeightOfLine(l),{lineTop:a,offset:(this._fontSizeMult-this._fontSizeFraction)*p/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(d){return S.Object.prototype.getSvgStyles.call(this,d)+" white-space: pre;"}})}(),function(h){var c=h.fabric||(h.fabric={});c.Textbox=c.util.createClass(c.IText,c.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:c.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),-1!==this.textAlign.indexOf("justify")&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(d){for(var p=0,a=0,l=0,f={},y=0;y<d.graphemeLines.length;y++)"\n"===d.graphemeText[l]&&y>0?(a=0,l++,p++):!this.splitByGrapheme&&this._reSpaceAndTab.test(d.graphemeText[l])&&y>0&&(a++,l++),f[y]={line:p,offset:a},l+=d.graphemeLines[y].length,a+=d.graphemeLines[y].length;return f},styleHas:function(d,p){if(this._styleMap&&!this.isWrapping){var a=this._styleMap[p];a&&(p=a.line)}return c.Text.prototype.styleHas.call(this,d,p)},isEmptyStyles:function(d){if(!this.styles)return!0;var p,a,l=0,f=!1,y=this._styleMap[d],m=this._styleMap[d+1];for(var _ in y&&(d=y.line,l=y.offset),m&&(f=m.line===d,p=m.offset),a=void 0===d?this.styles:{line:this.styles[d]})for(var C in a[_])if(C>=l&&(!f||C<p))for(var D in a[_][C])return!1;return!0},_getStyleDeclaration:function(d,p){if(this._styleMap&&!this.isWrapping){var a=this._styleMap[d];if(!a)return null;d=a.line,p=a.offset+p}return this.callSuper("_getStyleDeclaration",d,p)},_setStyleDeclaration:function(d,p,a){var l=this._styleMap[d];this.styles[d=l.line][p=l.offset+p]=a},_deleteStyleDeclaration:function(d,p){var a=this._styleMap[d];delete this.styles[d=a.line][p=a.offset+p]},_getLineStyle:function(d){return!!this.styles[this._styleMap[d].line]},_setLineStyle:function(d){this.styles[this._styleMap[d].line]={}},_wrapText:function(d,p){var a,l=[];for(this.isWrapping=!0,a=0;a<d.length;a++)l=l.concat(this._wrapLine(d[a],a,p));return this.isWrapping=!1,l},_measureWord:function(d,p,a){var l,f=0;a=a||0;for(var y=0,m=d.length;y<m;y++)f+=this._getGraphemeBox(d[y],p,y+a,l,!0).kernedWidth,l=d[y];return f},_wrapLine:function(d,p,a,l){var f=0,y=this.splitByGrapheme,m=[],_=[],C=y?c.util.string.graphemeSplit(d):d.split(this._wordJoiners),D="",E=0,A=y?"":" ",T=0,M=0,F=0,U=!0,G=this._getWidthOfCharSpacing();l=l||0,0===C.length&&C.push([]),a-=l;for(var K=0;K<C.length;K++)D=y?C[K]:c.util.string.graphemeSplit(C[K]),T=this._measureWord(D,p,E),E+=D.length,(f+=M+T-G)>a&&!U?(m.push(_),_=[],f=T,U=!0):f+=G,U||y||_.push(A),_=_.concat(D),M=y?0:this._measureWord([A],p,E),E++,U=!1,T>F&&(F=T);return K&&m.push(_),F+l>this.dynamicMinWidth&&(this.dynamicMinWidth=F-G+l),m},isEndOfWrapping:function(d){return!this._styleMap[d+1]||this._styleMap[d+1].line!==this._styleMap[d].line},missingNewlineOffset:function(d){return this.splitByGrapheme?this.isEndOfWrapping(d)?1:0:1},_splitTextIntoLines:function(d){for(var p=c.Text.prototype._splitTextIntoLines.call(this,d),a=this._wrapText(p.lines,this.width),l=new Array(a.length),f=0;f<a.length;f++)l[f]=a[f].join("");return p.lines=l,p.graphemeLines=a,p},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var d={};for(var p in this._styleMap)this._textLines[p]&&(d[this._styleMap[p].line]=1);for(var p in this.styles)d[p]||delete this.styles[p]},toObject:function(d){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(d))}}),c.Textbox.fromObject=function(d,p){return c.Object._fromObject("Textbox",d,p,"text")}}(e),function(){var h=S.controlsUtils,c=h.scaleSkewCursorStyleHandler,d=h.scaleCursorStyleHandler,p=h.scalingEqually,a=h.scalingYOrSkewingX,l=h.scalingXOrSkewingY,f=h.scaleOrSkewActionName,y=S.Object.prototype.controls;if(y.ml=new S.Control({x:-.5,y:0,cursorStyleHandler:c,actionHandler:l,getActionName:f}),y.mr=new S.Control({x:.5,y:0,cursorStyleHandler:c,actionHandler:l,getActionName:f}),y.mb=new S.Control({x:0,y:.5,cursorStyleHandler:c,actionHandler:a,getActionName:f}),y.mt=new S.Control({x:0,y:-.5,cursorStyleHandler:c,actionHandler:a,getActionName:f}),y.tl=new S.Control({x:-.5,y:-.5,cursorStyleHandler:d,actionHandler:p}),y.tr=new S.Control({x:.5,y:-.5,cursorStyleHandler:d,actionHandler:p}),y.bl=new S.Control({x:-.5,y:.5,cursorStyleHandler:d,actionHandler:p}),y.br=new S.Control({x:.5,y:.5,cursorStyleHandler:d,actionHandler:p}),y.mtr=new S.Control({x:0,y:-.5,actionHandler:h.rotationWithSnapping,cursorStyleHandler:h.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),S.Textbox){var m=S.Textbox.prototype.controls={};m.mtr=y.mtr,m.tr=y.tr,m.br=y.br,m.tl=y.tl,m.bl=y.bl,m.mt=y.mt,m.mb=y.mb,m.mr=new S.Control({x:.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:c,actionName:"resizing"}),m.ml=new S.Control({x:-.5,y:0,actionHandler:h.changeWidth,cursorStyleHandler:c,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},k_={};function mi(t){var e=k_[t];if(void 0!==e)return e.exports;var n=k_[t]={exports:{}};return Rx[t](n,n.exports,mi),n.exports}mi.d=(t,e)=>{for(var n in e)mi.o(e,n)&&!mi.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},mi.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var N_={};(()=>{let t;mi.d(N_,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?mi(653).fabric:{version:"5.2.1"}})();var Le=N_.R;const Js=typeof self>"u";let lo,Gn,Qs,ea,Je;if(typeof navigator<"u"&&(lo=navigator,Gn=lo.userAgent,Qs=lo.platform,ea=lo.mediaDevices),!Js){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:lo.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Qs,search:"Win"},Mac:{str:Qs},Linux:{str:Qs}};let n="unknownBrowser",i=0,r="unknownOS";for(let o in t){const s=t[o]||{};let v=s.verStr||Gn,w=s.verSearch||o;if(w instanceof Array||(w=[w]),-1!=(s.str||Gn).indexOf(s.search||o)){n=o;for(let b of w){let I=v.indexOf(b);if(-1!=I){i=parseFloat(v.substring(I+b.length+1));break}}break}}for(let o in e){const s=e[o]||{};if(-1!=(s.str||Gn).indexOf(s.search||o)){r=o;break}}"Linux"==r&&-1!=Gn.indexOf("Windows NT")&&(r="HarmonyOS"),Je={browser:n,version:i,OS:r}}Js&&(Je={browser:"ssr",version:0,OS:"ssr"});const Fx=typeof WebAssembly<"u"&&Gn&&!(/Safari/.test(Gn)&&!/Chrome/.test(Gn)&&/\(.+\s11_2_([2-6]).*\)/.test(Gn)),Px=!(typeof Worker>"u"),B_=!(!ea||!ea.getUserMedia),Lx=function(){var t=ne(function*(){let e=!1;if(B_)try{(yield ea.getUserMedia({video:!0})).getTracks().forEach(n=>{n.stop()}),e=!0}catch{}return e});return function(){return t.apply(this,arguments)}}(),kx=(()=>{if(!Js&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(-1!=e)t=t.substring(0,e);else{let n=t.indexOf("#");-1!=n&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();class $t{constructor(e,n){this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,this._setFabricObject(e),this._mediaType=e.type,this.styleSelector="default",this.styleId=n}get mediaType(){return this._mediaType}get drawingLayerId(){return this._drawingLayerId}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.styleSelector="selected"}),this._fabricObject.on("deselected",()=>{this.styleSelector=this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?"selected":"default","textbox"===this._fabricObject.type&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}_on(e,n){if(!n)return;const i=e.toLowerCase(),r=this.mapEvent_Callbacks.get(i);if(!r)throw new Error(`Event '${e}' does not exist.`);let o=r.get(n);o||(o=s=>{const u=s.e;if(!u)return void(n&&n.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const g={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let v,w,b,I;const x=u.target.getBoundingClientRect();v=x.left,w=x.top,b=v+window.scrollX,I=w+window.scrollY;const O=this._drawingLayer.fabricCanvas.lowerCanvasEl.width,R=this._drawingLayer.fabricCanvas.lowerCanvasEl.height,P=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).width),V=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).height),W=P/V,L=O/R,X=this._drawingLayer._getObjectFit();let ee,le,ye,S,pe=1;if("contain"===X)W<L?(pe=P/O,ee=v+this.get("x")*pe,le=w+this.get("y")*pe+(V-R*pe)/2,ye=b+this.get("x")*pe,S=I+this.get("y")*pe+(V-R*pe)/2):(pe=V/R,ee=v+this.get("x")*pe+(P-O*pe)/2,le=w+this.get("y")*pe,ye=b+this.get("x")*pe+(P-O*pe)/2,S=I+this.get("y")*pe);else if("cover"===X)if(W<L){pe=V/R;let be=this.get("x")*pe-(O*pe-P)/2;be=Math.max(be,0),be=Math.min(be,P),ee=v+be,le=w+this.get("y")*pe,ye=b+be,S=I+this.get("y")*pe}else{pe=P/O;let be=this.get("y")*pe-(R*pe-V)/2;be=Math.max(be,0),be=Math.min(be,V),ee=v+this.get("x")*pe,le=w+be,ye=b+this.get("x")*pe,S=I+be}g.itemClientX=Math.round(ee),g.itemClientY=Math.round(le),g.itemPageX=Math.round(ye),g.itemPageY=Math.round(S)}for(let v of Object.getOwnPropertyNames(g))Object.defineProperty(u,v,{value:g[v],writable:!0});n&&n.apply(this,[u])},r.set(n,o),this._fabricObject.on("dblclick"===i?"mousedblclick":i,o))}on(e,n){this._on(e,n)}_off(e,n){const i=e.toLowerCase(),r=this.mapEvent_Callbacks.get(i);if(!r)throw new Error(`Event '${e}' does not exist.`);let o=r.get(n);o&&(r.delete(n),this._fabricObject.off("dblclick"===i?"mousedblclick":i,o))}off(e,n){this._off(e,n)}_setEditable(e){const n=this._fabricObject;e?(n.selectable=!0,n.hasControls=!0,n.hoverCursor=null):(n.selectable=!1,n.hasControls=!1,n.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,n){if(this.hasNote(e.name)&&!n)throw new Error("A note with the same name already exists, please use a different name.");const i=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[i])}getNote(e){const n=this.mapNoteName_Content.get(e);return n?1===n.length?{name:e,content:n[0]?JSON.parse(JSON.stringify(n[0])):n[0]}:{name:e,content:JSON.parse(JSON.stringify(n))}:null}getNotes(){const e=[];for(let n of this.mapNoteName_Content){let i=1===n[1].length?n[1][0]:n[1];i=i&&JSON.parse(JSON.stringify(i)),e.push({name:n[0],content:i})}return e}updateNote(e,n,i){const r=this.mapNoteName_Content.get(e);if(!r)throw new Error("The note name does not exist.");i||(r.length=0),n=n&&JSON.parse(JSON.stringify(n)),r.push(n)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}_extendSet(e,n){return!1}_extendGet(e){}set(e,n){if(!this._extendSet(e,n))if("x"===e){const i=this._fabricObject.group;i?(this._fabricObject.set("left",n-i.left-i.width/2),i.addWithUpdate()):this._fabricObject.set("left",n)}else if("y"===e){const i=this._fabricObject.group;i?(this._fabricObject.set("top",n-i.top-i.height/2),i.addWithUpdate()):this._fabricObject.set("top",n)}else"styleId"===e?this.styleId=n:this._fabricObject.set(e,n);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let n=this._extendGet(e);if(void 0===n)if("x"===e){const i=this._fabricObject.group;n=i?this._fabricObject.get("left")+i.left+i.width/2:this._fabricObject.get("left")}else if("y"===e){const i=this._fabricObject.group;n=i?this._fabricObject.get("top")+i.top+i.height/2:this._fabricObject.get("top")}else n=["type","mediaType"].includes(e)?this.mediaType:"styleSelector"===e?this.styleSelector:"styleId"===e?this.styleId:"drawingLayerId"===e?this.drawingLayerId:this._fabricObject.get(e);return n}setAttribute(e,n){this.set(e,n)}getAttribute(e){return this.get(e)}}function yu(t,e,n){return Le.util.transformPoint({x:n.points[this.pointIndex].x-n.pathOffset.x,y:n.points[this.pointIndex].y-n.pathOffset.y},n.calcTransformMatrix())}function j_(t){let e=new Le.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new Le.Point(t.width+e.x,t.height+e.y)}function Cu(t,e,n,i){let r=e.target,o=r.controls[r.__corner],s=r.toLocalPoint(new Le.Point(n,i),"center","center"),u=j_(r),g=r._getTransformedDimensions(0,0);return r.points[o.pointIndex]={x:s.x*u.x/g.x+r.pathOffset.x,y:s.y*u.y/g.y+r.pathOffset.y},!0}function wu(t,e){return function(n,i,r,o){let s=i.target,u=Le.util.transformPoint({x:s.points[t].x-s.pathOffset.x,y:s.points[t].y-s.pathOffset.y},s.calcTransformMatrix()),g=e(n,i,r,o);s._setPositionDimensions({});let v=j_(s);return s.setPositionByOrigin(u,(s.points[t].x-s.pathOffset.x)/v.x+.5,(s.points[t].y-s.pathOffset.y)/v.y+.5),g}}$t.arrMediaTypes=["rect","arc","polygon","image","text","line","path"],$t.arrStyleSelectors=["default","selected"];class V_ extends $t{constructor(e,n){super(new Le.Polygon(e,{objectCaching:!1}),n);const i=this._fabricObject;let r=i.points.length-1;i.controls=i.points.reduce(function(o,s,u){return o["p"+u]=new Le.Control({positionHandler:yu,actionHandler:wu(u>0?u-1:r,Cu),actionName:"modifyPolygon",pointIndex:u}),o},{})}_extendSet(e,n){if("vertices"===e){const i=this._fabricObject;if(i.group){const o=i.group;i.points=n.map(s=>({x:s.x-o.left-o.width/2,y:s.y-o.top-o.height/2})),o.addWithUpdate()}else i.points=n;const r=i.points.length-1;return i.controls=i.points.reduce(function(o,s,u){return o["p"+u]=new Le.Control({positionHandler:yu,actionHandler:wu(u>0?u-1:r,Cu),actionName:"modifyPolygon",pointIndex:u}),o},{}),i._setPositionDimensions({}),!0}}_extendGet(e){if("vertices"===e){const n=[],i=this._fabricObject;if(i.selectable&&!i.group)for(let r in i.oCoords)n.push({x:i.oCoords[r].x,y:i.oCoords[r].y});else for(let r of i.points){const u=Le.util.transformPoint({x:r.x-i.pathOffset.x,y:r.y-i.pathOffset.y},i.calcTransformMatrix());n.push({x:u.x,y:u.y})}return n}}}const U_=t=>{let e=t.split("\n").map(i=>i.split("\t"));return(n=>{for(let i=0;;i++){let r=-1;for(let o=0;o<n.length;o++){let s=n[o][i];void 0!==s&&s.length>r&&(r=s.length)}if(-1===r)break;for(let o=0;o<n.length;o++){if(i>=n[o].length-1)continue;let s=" ".repeat(r+2-n[o][i].length);n[o][i]=n[o][i].concat(s)}}})(e),(n=>{let i="";for(let r=0;r<n.length;r++)i=i.concat(...n[r],r===n.length-1?"":"\n");return i})(e)};class H_ extends $t{constructor(e,n,i,r,o){if("number"!=typeof r||r<=0)throw new RangeError("Invalid width.");super(new Le.Textbox(U_(e),{left:n,top:i,width:r}),o),this._mediaType="text",this._text=e}_extendSet(e,n){if("text"===e)return this._text=n,this._fabricObject.set("text",U_(n)),!0}_extendGet(e){if("text"===e)return this._text}}typeof document<"u"&&typeof window<"u"&&(Le.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Le.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Le.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Le.Object.prototype.transparentCorners=!1,Le.Object.prototype.cornerSize=20,Le.Object.prototype.touchCornerSize=100,Le.Object.prototype.cornerColor="rgb(254,142,20)",Le.Object.prototype.cornerStyle="circle",Le.Object.prototype.strokeUniform=!0,Le.Object.prototype.hasBorders=!1,Le.Canvas.prototype.containerClass="",Le.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var n,i=this.upperCanvasEl,r=Le.util.getPointer(t,i),o=i.getBoundingClientRect(),s=o.width||0,u=o.height||0;s&&u||("top"in o&&"bottom"in o&&(u=Math.abs(o.top-o.bottom)),"right"in o&&"left"in o&&(s=Math.abs(o.right-o.left))),this.calcOffset(),r.x=r.x-this._offset.left,r.y=r.y-this._offset.top,e||(r=this.restorePointerVpt(r));var g=this.getRetinaScaling();if(1!==g&&(r.x/=g,r.y/=g),0!==s&&0!==u){var v=window.getComputedStyle(i).objectFit,w=i.width,b=i.height;n={width:w/s,height:b/u};var P=w/b,V=s/u;return"contain"===v?P>V?{x:r.x*n.width,y:(r.y-(u-s/P)/2)*n.width}:{x:(r.x-(s-u*P)/2)*n.height,y:r.y*n.height}:"cover"===v?P>V?{x:(w-n.height*s)/2+r.x*n.height,y:r.y*n.height}:{x:r.x*n.width,y:(b-n.width*u)/2+r.y*n.width}:{x:r.x*n.width,y:r.y*n.height}}return{x:r.x*(n={width:1,height:1}).width,y:r.y*n.height}},Le.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),null===this.mainTouchId&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var n=this.upperCanvasEl,i=this._getEventPrefix();Le.util.addListener(Le.document,"touchend",this._onTouchEnd,{passive:!1}),Le.util.addListener(Le.document,"touchmove",this._onMouseMove,{passive:!1}),Le.util.removeListener(n,i+"down",this._onMouseDown)},Le.Textbox.prototype._wrapLine=function(t,e,n,i){const r=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g);var s=0,u=this.splitByGrapheme||!(!r||!r.length),g=[],v=[],w=u?Le.util.string.graphemeSplit(t):t.split(this._wordJoiners),b="",I=0,x=u?"":" ",O=0,R=0,P=0,V=!0,W=this._getWidthOfCharSpacing();i=i||0,0===w.length&&w.push([]),n-=i;for(var L=0;L<w.length;L++)b=u?w[L]:Le.util.string.graphemeSplit(w[L]),O=this._measureWord(b,e,I),I+=b.length,(s+=R+O-W)>n&&!V?(g.push(v),v=[],s=O,V=!0):s+=W,V||u||v.push(x),v=v.concat(b),R=u?0:this._measureWord([x],e,I),I++,V=!1,O>P&&(P=O);return L&&g.push(v),P+i>this.dynamicMinWidth&&(this.dynamicMinWidth=P-W+i),g});class Nx{constructor(e,n,i,r){let o,s;switch(this.mapMediaType_Style=new Map,this.mode="viewer",this.onSelectionChange=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=e.getFabricCanvas():(this.fabricCanvas=new Le.Canvas(e,Object.assign(r,{allowTouchScrolling:!0})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",function(u){const g=u.selected,v=[];for(let w of g){const b=w.getDrawingItem()._drawingLayer;b&&!v.includes(b)&&v.push(b)}for(let w of v){const b=[];for(let I of g){const x=I.getDrawingItem();x._drawingLayer===w&&b.push(x)}setTimeout(()=>{w.onSelectionChange&&w.onSelectionChange(b,[])},0)}}),this.fabricCanvas.on("before:selection:cleared",function(u){const g=this.getActiveObjects(),v=[];for(let w of g){const b=w.getDrawingItem()._drawingLayer;b&&!v.includes(b)&&v.push(b)}for(let w of v){const b=[];for(let I of g){const x=I.getDrawingItem();x._drawingLayer===w&&b.push(x)}setTimeout(()=>{const I=[];for(let x of b)w.hasDrawingItem(x)&&I.push(x);I.length>0&&w.onSelectionChange&&w.onSelectionChange([],I)},0)}}),this.fabricCanvas.on("selection:updated",function(u){const g=u.selected,v=u.deselected,w=[];for(let b of g){const I=b.getDrawingItem()._drawingLayer;I&&!w.includes(I)&&w.push(I)}for(let b of v){const I=b.getDrawingItem()._drawingLayer;I&&!w.includes(I)&&w.push(I)}for(let b of w){const I=[],x=[];for(let O of g){const R=O.getDrawingItem();R._drawingLayer===b&&I.push(R)}for(let O of v){const R=O.getDrawingItem();R._drawingLayer===b&&x.push(R)}setTimeout(()=>{b.onSelectionChange&&b.onSelectionChange(I,x)},0)}}),this.fabricCanvas.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas),this.id=n,this._mapDrawingStyles=i,n){case 1:o=i.get(1),s=i.get(5);break;case 2:o=i.get(2),s=i.get(6);break;case 3:o=i.get(3),s=i.get(7);break;default:o=i.get(4),s=i.get(8)}for(let u of $t.arrMediaTypes)this.mapMediaType_Style.set(u,{default:o,selected:s})}getId(){return this.id}_getDrawingStyle(e,n){if("number"!=typeof e)throw new Error("Invalid style id.");const i=this._mapDrawingStyles.get(e);return i?n?JSON.parse(JSON.stringify(i)):i:null}setVisible(e){if(e){for(let n of this._arrFabricObject)n.visible=!0;this._visible=!0}else{for(let n of this._arrFabricObject)n.visible=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(e){return e.styleId?e.styleId:this.mapMediaType_Style.get(e._mediaType)[e.styleSelector].styleId}_getItemCurrentStyle(e){return e.styleId?this._getDrawingStyle(e.styleId):e._mapStyle.get(e.styleSelector)||null}_changeMediaTypeCurStyleInStyleSelector(e,n,i,r){let o;switch(e){case"rect":o=this.fabricCanvas.getObjects("rect");break;case"arc":o=this.fabricCanvas.getObjects("circle");break;case"polygon":o=this.fabricCanvas.getObjects("polygon");break;case"image":o=this.fabricCanvas.getObjects("image");break;case"text":o=this.fabricCanvas.getObjects("textbox");break;case"line":o=this.fabricCanvas.getObjects("line");break;case"path":o=this.fabricCanvas.getObjects("path")}for(let s of o){if(!this._arrFabricObject.includes(s))continue;const u=s.getDrawingItem();u.styleSelector===n&&this._changeItemStyle(u,i,!0)}r||this.fabricCanvas.renderAll()}_changeItemStyle(e,n,i){if(!e||!n)return;const r=e._getFabricObject();"number"==typeof e.styleId&&(n=this._getDrawingStyle(e.styleId)),r.strokeWidth=n.lineWidth,"fill"===n.paintMode?(r.fill=n.fillStyle,r.stroke=n.fillStyle):"stroke"===n.paintMode?(r.fill="transparent",r.stroke=n.strokeStyle):"strokeAndFill"===n.paintMode&&(r.fill=n.fillStyle,r.stroke=n.strokeStyle),r.fontFamily&&(r.fontFamily=n.fontFamily),r.fontSize&&(r.fontSize=n.fontSize),r.group||(r.dirty=!0),i||this.fabricCanvas.renderAll()}_updateGroupItem(e,n,i){if(!e||!n)return;const r=e.getChildItems();if("add"===i){if(r.includes(n))return;const o=n._getFabricObject();if(this.fabricCanvas.getObjects().includes(o)){if(!this._arrFabricObject.includes(o))throw new Error("Existed in other drawing layers.");n._zIndex=null}else{let s;if(n.styleId)s=this._getDrawingStyle(n.styleId);else{s=this.mapMediaType_Style.get(n._mediaType)[e.styleSelector];const u=()=>{this._changeItemStyle(n,this.mapMediaType_Style.get(n._mediaType).selected,!0)},g=()=>{this._changeItemStyle(n,this.mapMediaType_Style.get(n._mediaType).default,!0)};n._on("selected",u),n._on("deselected",g),n._funcChangeStyleToSelected=u,n._funcChangeStyleToDefault=g}n._drawingLayer=this,n._drawingLayerId=this.id,this._changeItemStyle(n,s,!0)}e._fabricObject.addWithUpdate(n._getFabricObject())}else{if("remove"!==i||!r.includes(n))return;n._zIndex=null,n._drawingLayer=null,n._drawingLayerId=null,n._off("selected",n._funcChangeStyleToSelected),n._off("deselected",n._funcChangeStyleToDefault),n._funcChangeStyleToSelected=null,n._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(n._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,n){let i=e._getFabricObject();const r=this.fabricCanvas.getObjects();let o,s;if(r.includes(i)){if(this._arrFabricObject.includes(i))return;throw new Error("Existed in other drawing layers.")}if("group"===e._mediaType){o=e.getChildItems();for(let v of o)if(v._drawingLayer&&v._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(n&&"object"==typeof n&&!Array.isArray(n))for(let v in n)i.set(v,n[v]);if(o){for(let v of o){const w=this.mapMediaType_Style.get(v._mediaType);for(let b of $t.arrStyleSelectors)v._mapStyle.set(b,w[b]);if(v.styleId)s=this._getDrawingStyle(v.styleId);else{s=w.default;const b=()=>{this._changeItemStyle(v,this.mapMediaType_Style.get(v._mediaType).selected,!0)},I=()=>{this._changeItemStyle(v,this.mapMediaType_Style.get(v._mediaType).default,!0)};v._on("selected",b),v._on("deselected",I),v._funcChangeStyleToSelected=b,v._funcChangeStyleToDefault=I}v._drawingLayer=this,v._drawingLayerId=this.id,this._changeItemStyle(v,s,!0)}i.dirty=!0,this.fabricCanvas.renderAll()}else{const v=this.mapMediaType_Style.get(e._mediaType);for(let w of $t.arrStyleSelectors)e._mapStyle.set(w,v[w]);if(e.styleId)s=this._getDrawingStyle(e.styleId);else{s=v.default;const w=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).selected)},b=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).default)};e._on("selected",w),e._on("deselected",b),e._funcChangeStyleToSelected=w,e._funcChangeStyleToDefault=b}this._changeItemStyle(e,s)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const u=this._arrFabricObject.length;let g=r.length;if(u)g=r.indexOf(this._arrFabricObject[u-1])+1;else for(let v=0;v<r.length;v++)if(e._zIndex<r[v].getDrawingItem()._zIndex){g=v;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(i),i.visible=!!this._visible,this.fabricCanvas.insertAt(i,g,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if("viewer"===this.mode)e._setEditable(!1);else{if("editor"!==this.mode)throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e)}addDrawingItems(e){for(let n of e)this.addDrawingItem(n)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,"group"===e._mediaType){const i=e.getChildItems();for(let r of i)r._zIndex=null,r._drawingLayer=null,r._drawingLayerId=null,r._off("selected",r._funcChangeStyleToSelected),r._off("deselected",r._funcChangeStyleToDefault),r._funcChangeStyleToSelected=null,r._funcChangeStyleToDefault=null,r._mapStyle.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapStyle.clear();const n=e._getFabricObject();"selected"===e.styleSelector&&(n.group?n.group.removeWithUpdate(n):this.fabricCanvas._activeObject=null,e.styleSelector="default"),this.fabricCanvas.remove(n),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(n),1)}removeDrawingItems(e){for(let n of e)this.removeDrawingItem(n)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&"function"==typeof e?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),n=[];for(let i of e)this._arrFabricObject.includes(i)&&n.push(i.getDrawingItem());return n}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}setDrawingStyle(e,n,i){n=n?n.toLocaleLowerCase():"all",i=i?i.toLocaleLowerCase():"all";let r,o=this._getDrawingStyle(e);if("all"===n){const s=this.mapMediaType_Style.keys();for(let u of s)if(r=this.mapMediaType_Style.get(u),"all"===i)for(let g of $t.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(u,g,o,!0),r[g]=o;for(let v of this._arrDrwaingItem)v._mapStyle.set(g,o)}else{this._changeMediaTypeCurStyleInStyleSelector(u,i,o,!0),r[i]=o;for(let g of this._arrDrwaingItem)g._mapStyle.set(i,o)}this.fabricCanvas.renderAll()}else if(r=this.mapMediaType_Style.get(n),"all"===i)for(let s of $t.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(n,s,o,!0),r[s]=o;for(let u of this._arrDrwaingItem)u._mediaType===n&&u._mapStyle.set(s,o)}else{this._changeMediaTypeCurStyleInStyleSelector(n,i,o,!0),r[i]=o;for(let s of this._arrDrwaingItem)s._mediaType===n&&s._mapStyle.set(i,o)}}setMode(e){if("viewer"===(e=e.toLocaleLowerCase())){for(let n of this._arrDrwaingItem)n._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if("editor"!==e)throw new RangeError("Invalid value.");for(let n of this._arrDrwaingItem)n._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,n){this.fabricCanvas.setDimensions(e,n)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const n=this._getItemCurrentStyle(e);this._changeItemStyle(e,n,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),1===this._manager._arrDrawingLayer.length&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}class Bx{constructor(){this._arrDrawingLayer=[],this._mapDrawingStyles=new Map([[1,{id:1,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[2,{id:2,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[3,{id:3,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[4,{id:4,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[5,{id:5,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[6,{id:6,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[7,{id:7,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[8,{id:8,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]]),this._defaultStyleTemplate={lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}}createDrawingStyle(e){if(!e)throw new Error("Invalid style definition.");let n;if(e.hasOwnProperty("id")){if(this._mapDrawingStyles.has(e.id))throw new Error("Existing drawing style id.");n=e.id}else{let r=100;for(;this._mapDrawingStyles.has(r);)r++;n=r}const i=JSON.parse(JSON.stringify(e));i.id=n;for(let r in this._defaultStyleTemplate)i.hasOwnProperty(r)||(i[r]=this._defaultStyleTemplate[r]);return this._mapDrawingStyles.set(n,i),i.id}_getDrawingStyle(e,n){if("number"!=typeof e)throw new Error("Invalid style id.");const i=this._mapDrawingStyles.get(e);return i?n?JSON.parse(JSON.stringify(i)):i:null}getDrawingStyle(e){return this._getDrawingStyle(e,!0)}getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(this._mapDrawingStyles.values())))}_updateDrawingStyle(e,n){const i=this._mapDrawingStyles.get(e);if(i)for(let r in n)i.hasOwnProperty(r)&&(i[r]=n[r])}updateDrawingStyle(e,n){this._updateDrawingStyle(e,n);for(let i of this._arrDrawingLayer)i.renderAll()}createDrawingLayer(e,n){const i=o=>{for(let s of this._arrDrawingLayer)if(s.getId()===o)return!0;return!1};if(void 0===n){for(let o=100;;o++)if(!i(o)){n=o;break}}else if(i(n))throw new Error("Existed drawing layer id.");const r=new Nx(e,n,this._mapDrawingStyles,{enableRetinaScaling:!1});return r._manager=this,this._arrDrawingLayer.push(r),this._switchPointerEvent(),r}deleteDrawingLayer(e){const n=this.getDrawingLayer(e);if(!n)return;const i=this._arrDrawingLayer;n.dispose(),i.splice(i.indexOf(n),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let n of this._arrDrawingLayer)if(n.getId()===e)return n;return null}getDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),n=[];for(let i of e)n.push(i.getDrawingItem());return n}setDimensions(e,n){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,n)}setObjectFit(e){for(let n of this._arrDrawingLayer)n&&n._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=e?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class jx{constructor(e){this._controlTarget=null,this._arrUsers=[],this._mapAction_UserArgs=new Map,this._mapProperty_UserValue=new Map,this._mapAction_Callbacks=new Map,this._controlTarget=e}setControlTarget(e){this._controlTarget=e}getControlTarget(){return this._controlTarget}register(e){this._arrUsers.includes(e)||this._arrUsers.push(e)}logout(e){const n=this._arrUsers.indexOf(e);-1!==n&&(this.clearUserDisiredAction({user:e}),this.clearUserDisiredValue({user:e}),this._arrUsers.splice(n,1))}getRegisteredUsers(){return this._arrUsers}ifUserExisted(e){return this._arrUsers.includes(e)}setDisiredValue(e,n,i,r){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");r&&(this._controlTarget[n]=i),this._mapProperty_UserValue.get(n)?this._mapProperty_UserValue.get(n).set(e,i):this._mapProperty_UserValue.set(n,new Map([[e,i]]))}clearUserDisiredValue(e){if(e&&(e.user||e.property)){if(e.property&&e.user){const n=this._mapProperty_UserValue.get(e.property);if(!n)return;n.delete(e.user)}else if(e.property)this._mapProperty_UserValue.delete(e.property);else if(e.user)for(let n of this._mapProperty_UserValue.values())n.delete(e.user)}else this._mapProperty_UserValue=new Map}getValue(e){if(!this._controlTarget)throw new Error("Control target is not set.");return this._controlTarget[e]}getPropertyDisiredValue(e){if(this._mapProperty_UserValue.get(e)){const n=[],i=this._mapProperty_UserValue.get(e);for(let r of i.values())n.push(r);return n}return null}setDisiredAction(e,n,i,r){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");return i||(i=[]),r?this._controlTarget[n](...i):(this._mapAction_UserArgs.get(n)?this._mapAction_UserArgs.get(n).set(e,i):this._mapAction_UserArgs.set(n,new Map([[e,i]])),this._render(n))}clearUserDisiredAction(e){if(e&&(e.user||e.actionName)){if(e.actionName&&e.user){const n=this._mapAction_UserArgs.get(e.actionName);if(!n)return;n.delete(e.user)}else if(e.actionName)this._mapAction_UserArgs.delete(e.actionName);else if(e.user)for(let n of this._mapAction_UserArgs.values())n.delete(e.user);this.render()}else this._mapAction_UserArgs=new Map}addCallback(e,n){const i=this._mapAction_Callbacks.get(e);i?i.push(n):this._mapAction_Callbacks.set(e,[n])}removeCallback(e,n){const i=this._mapAction_Callbacks.get(e);if(!i)return;const r=i.indexOf(n);-1!==r&&i.splice(r,1)}clearCallback(e){e?this._mapAction_Callbacks.delete(e):this._mapAction_Callbacks.clear()}_fireCallback(e){const n=this._mapAction_Callbacks.get(e);if(n)for(let i of n){if(!i)return;setTimeout(i.bind(this._controlTarget),0)}}_render(e){const n=this._mapAction_UserArgs.get(e);if(!n)throw new Error("Unrecorded action.");if(n.size===this._arrUsers.length){let i=[];for(let r of n.values())r.length>0&&(i=r);if(this._controlTarget[e]){const r=this._controlTarget[e](...i);return this._mapAction_UserArgs.delete(e),this._fireCallback(e),r}}}render(e){if(e)return this._render(e);for(let n of this._mapAction_UserArgs.keys())this._render(n)}}class Yt{static multiply(e,n){const i=[];for(let r=0;r<3;r++){const o=n.slice(3*r,3*r+3);for(let s=0;s<3;s++){const u=[e[s],e[s+3],e[s+6]].reduce((g,v,w)=>g+v*o[w],0);i.push(u)}}return i}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,n,i){return Yt.multiply(e,[1,0,0,0,1,0,n,i,1])}static rotate(e,n){var i=Math.cos(n),r=Math.sin(n);return Yt.multiply(e,[i,-r,0,r,i,0,0,0,1])}static scale(e,n,i){return Yt.multiply(e,[n,0,0,0,i,0,0,0,1])}}var Ne;!function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}(Ne||(Ne={}));const Xt=(t,e,n,i)=>{if(!n)return t;let r=e+Math.round((t-e)/n)*n;return i&&(r=Math.min(r,i)),r};class ie{constructor(){var e=this;this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this._predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this._mapCameraResolutions=new Map,this._bWebGLSupported=!0,this.extraBindings=[],this._cvsSingleFrameMode=null,this._cvsOriginalImage=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameInputContainer=null,this._clickIptSingleFrameMode=()=>{if(!this._isSingleFrameModeEnabled()||this.getDrawingLayers().some(i=>"editor"==i.getMode()))return;let n;if(this._singleFrameInputContainer)n=this._singleFrameInputContainer.firstElementChild;else{n=document.createElement("input"),n.setAttribute("type","file"),"camera"===this.singleFrameMode?(n.setAttribute("capture",""),n.setAttribute("accept","image/*")):1!=this.singleFrameMode&&"image"!==this.singleFrameMode||(n.removeAttribute("capture"),n.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),n.addEventListener("change",ne(function*(){const r=n.files[0];n.value="";const o=yield(b=ne(function*(I){let x=null,O=null;if(typeof createImageBitmap<"u")try{if(x=yield createImageBitmap(I),x)return x}catch{}var R;return x||(O=yield(R=I,new Promise((P,V)=>{let W=URL.createObjectURL(R),L=new Image;L.dbrObjUrl=W,L.src=W,L.onload=()=>{P(L)},L.onerror=X=>{V(new Error("Can't convert blob to image : "+(X instanceof Event?X.type:X)))}}))),O}),function(I){return b.apply(this,arguments)})(r),s=o instanceof HTMLImageElement?o.naturalWidth:o.width,u=o instanceof HTMLImageElement?o.naturalHeight:o.height;var b;e._imgWidth=s,e._imgHeight=u,(b=>{let I=e._cvsSingleFrameMode;if(!I){if(I=document.createElement("canvas"),!e._videoContainer)throw new Error("Unable to find video element");e._videoContainer.after(I),I.style.position="absolute",I.style.width="100%",I.style.height="100%",I.style.left="0",I.style.top="0",I.style.objectFit="contain",I.style.pointerEvents="none",e._cvsSingleFrameMode=I}I.width==s&&I.height==u||(I.width=s,I.height=u);const x=I.getContext("2d");x.clearRect(0,0,I.width,I.height),x.drawImage(b,0,0)})(o),e._updateScanRegionCanvas(),e._updateScanAreaDiv(),e._updateViewDecorator();for(let b of e._arrScanRegionOverlays)b&&e._updateScanRegionOverlay(b);let v;e._updateDrawingLayersSize();try{v=(b=>{const I=Date.now();if(0===s||0===u)return null;if(b instanceof HTMLImageElement&&!b.complete)throw new Error("The source is not loaded.");const x=e._scanRegion,O=e.getFrameSize(s,u,x,e.maxCvsSideLength);if(!O)return null;let R=!0;s===O.sWidth&&u===O.sHeight&&(R=!1);const P=e.mapPixelFormatString_Enum.get(e.framePixelFormat.toLowerCase()),V={data:null,region:x?JSON.parse(JSON.stringify(x)):null,sx:O.sx,sy:O.sy,width:O.dWidth,height:O.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:R,toCanvas:e._toCanvas,_sWidth:O.sWidth,_sHeight:O.sHeight,_bUseWebGL:null},W=e._getImageData(b,s,u,O,null,{pixelFormat:P});if(!W)return null;const L=Date.now();return ie._onLog&&ie._onLog("DCE: _getVideoData(region?) END: "+L),V.data=W.data,V.pixelFormat=V.colorMode=W.pixelFormat,V._bUseWebGL=W._bUseWebGL,V.timeSpent=L-I,V.timeStamp=L,V.stride=W.pixelFormat===Ne.GREY?V.width:4*V.width,V})(o)}catch(b){throw b}const w=e.mapCameraEvents.get("singleframeacquired");for(let b of w)if(b)try{const I={data:new Uint8Array(v.data),region:JSON.parse(JSON.stringify(v.region)),sx:v.sx,sy:v.sy,width:v.width,height:v.height,stride:v.stride,colorMode:v.colorMode,pixelFormat:v.pixelFormat,timeSpent:v.timeSpent,timeStamp:v.timeStamp,isCropped:v.isCropped,toCanvas:v.toCanvas,_sWidth:v._sWidth,_sHeight:v._sHeight,_bUseWebGL:v._bUseWebGL};yield b.apply(e,[I])}catch(I){console.error(I)}})),n.style.position="absolute",n.style.top="-9999px",n.style.backgroundColor="transparent",n.style.color="transparent";const i=document.createElement("div");i.append(n),i.style.position="absolute",i.style.width="1px",i.style.height="1px",i.style.overflow="hidden",i.style.pointerEvents="none",this._elContainer.prepend(i),this._singleFrameInputContainer=i}n?.click()},this.styleEls=[],this._framePixelFormat=void 0,this._defaultFramePixelFormat="rgba",this.mapPixelFormatString_Enum=new Map([["grey",Ne.GREY],["grey32",Ne.GREY32],["rgba",Ne.RGBA],["rbga",Ne.RBGA],["grba",Ne.GRBA],["gbra",Ne.GBRA],["brga",Ne.BRGA],["bgra",Ne.BGRA]]),this.shaderPixelFormat=Ne.RGBA,this.maxVideoCvsLength=3,this._reusedCvs=null,this._reusedWebGLCvs=null,this._tempDataContainer=null,this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._softwareScale=1,this._scaleCenter={x:0,y:0},this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,_focusArea:null},this._tapFocusEnabled=!0,this._focusSupported=!0,this._tapDoFocus=function(){var n=ne(function*(i){if(e._touchMoved)return void(e._touchMoved=!1);if(!e._tapFocusEnabled||!e._bOpen||e._isSingleFrameModeEnabled()||!e._video||e._video.paused||!e._videoTrack||!e._focusSupported||e.getDrawingLayers().some(ye=>"editor"==ye.getMode()))return;if(!e._focusParameters.fds&&(e._focusParameters.fds=(yield e.getCapabilities()).focusDistance,!e._focusParameters.fds))return void(e._focusSupported=!1);if(null==e._focusParameters.kTimeout&&(e._focusParameters.kTimeout=(e._focusParameters.maxTimeout-e._focusParameters.minTimeout)/(1/e._focusParameters.fds.min-1/e._focusParameters.fds.max)),1==e._focusParameters.isDoingFocus)return;let r,o,s,u;if(e._focusParameters.taskBackToContinous&&(clearTimeout(e._focusParameters.taskBackToContinous),e._focusParameters.taskBackToContinous=null),i instanceof MouseEvent)r=i.clientX,o=i.clientY;else{if(!(i instanceof TouchEvent))throw new Error("Unknown event type.");if(!i.changedTouches.length)return;r=i.changedTouches[0].clientX,o=i.changedTouches[0].clientY}const g=e.getVideoFit(),v=e._video.videoWidth,w=e._video.videoHeight,b=e._elContainer.getBoundingClientRect(),I=b.left,x=b.top,O=window.getComputedStyle(e._elContainer),R=parseFloat(O.width),P=parseFloat(O.height),V=R/P,W=v/w;let L=1;if("contain"===g)W>V?(L=R/v,s=(r-I)/L,u=(o-x-(P-R/W)/2)/L):(L=P/w,u=(o-x)/L,s=(r-I-(R-P*W)/2)/L);else{if("cover"!==g)throw new Error("Unsupported object-fit.");W>V?(L=P/w,u=(o-x)/L,s=(r-I+(P*W-R)/2)/L):(L=R/v,s=(r-I)/L,u=(o-x+(R/W-P)/2)/L)}const X={x:s+"px",y:u+"px"},ee=2*Math.round(Math.min(v,w)/e._focusParameters.defaultFocusAreaSizeRatio/2)+"px",le=ee;yield e._setLocalFocus(X,ee,le,e._focusParameters.tapFocusMinDistance,e._focusParameters.tapFocusMaxDistance),e._focusParameters.taskBackToContinous=setTimeout(()=>{e._videoTrack&&e._videoTrack.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},e._focusParameters.focusBackToContinousTime)});return function(i){return n.apply(this,arguments)}}(),this._touchMoved=!1,this._touchMoveEvent=()=>{this._touchMoved=!0},this._recordedStates={},this.playCallbackInfo=null,this._toCanvas=function(){const n=document.createElement("canvas");let i;if(n.width=this.width,n.height=this.height,"grey"===(this.pixelFormat||this.colorMode)){i=new Uint8ClampedArray(this.width*this.height*4);for(let o=0;o<i.length;o+=4)i[o]=this.data[o/4],i[o+1]=this.data[o/4],i[o+2]=this.data[o/4],i[o+3]=255}else i=new Uint8ClampedArray(this.data.buffer);const r=new ImageData(i,this.width,this.height);return n.getContext("2d").putImageData(r,0,0),n},this._onCameraSelChange=ne(function*(){yield e.selectCamera(e._selCam.value),e._bOpen||e.stop()}),this._onResolutionSelChange=ne(function*(){let n,i;if(e._selRsl&&-1!=e._selRsl.selectedIndex){let r=e._selRsl.options[e._selRsl.selectedIndex];n=r.getAttribute("data-width"),i=r.getAttribute("data-height")}yield e.setResolution(n,i),e._bOpen||e.stop()}),this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.isCameraEnhancer=!0,this.isDisposed=!1,this.disposed=!1,this.videoSrc=null,this.cameraOpenTimeout=4e3,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{if(!this._isSingleFrameModeEnabled())if("visible"===document.visibilityState){if(ie._onLog&&ie._onLog("DCE: document visible."),this._bOpen&&this._vc_bPlayingVideoBeforeHide)if(this.videoSrc)this._video.play();else if(this._video.srcObject){const n=this._video.srcObject.getTracks()[0];if(this._video.srcObject.active&&n)if(n.muted&&["iPhone","iPad","Mac"].includes(Je.OS)){if(Je.version>=17)return;this.play()}else this._video.play();else this.play()}}else if("hidden"===document.visibilityState)if(ie._onLog&&ie._onLog("DCE: document hidden."),["iPhone","iPad","Mac"].includes(Je.OS)){if(this._vc_bPlayingVideoBeforeHide=!0,Je.version>=17)return;this._video&&this._video.pause()}else this._video&&!this._video.paused?(this._vc_bPlayingVideoBeforeHide=!0,this._video.pause()):this._vc_bPlayingVideoBeforeHide=!1},this.containerClassName="dce-video-container",this._elContainer=null,this._videoContainer=null,this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=void 0,this._defaultBShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._layerBaseCvs=null,this._drawingLayerOfTip=null,this._tipArgs={x:void 0,y:void 0,width:void 0,duration:void 0,autoShowSuggestedTip:void 0},this._hideTipTimeoutId=null,this.onTipSuggested=null,this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateLayersTimeout=500,this._updateLayers=()=>{this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none");for(let n of this._arrScanRegionOverlays)n&&(n.style.display="none");this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout(()=>{if(!this.isDisposed||!this.disposed){this.ifShowScanRegionMask&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this.showScanRegionLaser(),this._cvsViewDecorator&&this.showViewDecorator(),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let n of this._arrScanRegionOverlays)n&&(n.style.display="",this._updateScanRegionOverlay(n));this._updateDrawingLayersSize(),this._updateVideoContainerStyle()}},this._updateLayersTimeout)},this._windowResizeListener=()=>{this._windowWidth!==document.documentElement.clientWidth&&(this._windowWidth=document.documentElement.clientWidth,this._updateLayers())},this.mapCameraEvents=new Map([["cameraopen",[]],["cameraclose",[]],["camerachange",[]],["resolutionchange",[]],["played",[]],["singleframeacquired",[]],["frameaddedtobuffer",[]]]),this._controler=null,this._singleFrameMode=!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}static getVersion(){return this._version}static detectEnvironment(){return ne(function*(){return yield ne(function*(){return{wasm:Fx,worker:Px,getUserMedia:B_,camera:yield Lx(),browser:Je.browser,version:Je.version,OS:Je.OS}})()})()}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");ie._engineResourcePath=(n=>{if(null==n&&(n="./"),!Js){let i=document.createElement("a");i.href=n,n=i.href}return n.endsWith("/")||(n+="/"),n})(e)}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let n;try{n=window[e];const i="__storage_test__";return n.setItem(i,i),n.removeItem(i),!0}catch(i){return i instanceof DOMException&&(22===i.code||1014===i.code||"QuotaExceededError"===i.name||"NS_ERROR_DOM_QUOTA_REACHED"===i.name)&&n&&0!==n.length}}static isDCEFrame(e){return!(!e||"object"!=typeof e||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}static testCameraAccess(){return ne(function*(){try{if(!navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return{ok:!1,message:"Insecure context."};(yield navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()})}catch(e){if("OverconstrainedError"===e.name||"NotFoundError"===e.name)return{ok:!1,message:"No camera detected."};if("NotAllowedError"===e.name)return{ok:!1,message:"No permission to access camera."};if("AbortError"===e.name)return{ok:!1,message:"Some problem occurred which prevented the device from being used."};if("NotReadableError"===e.name)return{ok:!1,message:"A hardware error occurred."};if("SecurityError"===e.name)return{ok:!1,message:"User media support is disabled."};throw e}return{ok:!0,message:"Successfully accessed the camera."}})()}set maxCvsSideLength(e){if(e<=0)throw new Error("Invalid value.");this._maxCvsSideLength=e}get maxCvsSideLength(){if(void 0!==this._maxCvsSideLength)return this._maxCvsSideLength;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxCvsSideLength");if(e&&1===e.length)return e[0]}return this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){ie._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return null===(e=ie._defaultUIElementURL)||void 0===e?void 0:e.replace("@engineResourcePath/",ie.engineResourcePath)}getUIElement(){return this.UIElement}setUIElement(e){var n=this;return ne(function*(){if(n._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if("string"==typeof e||e instanceof String){if(!e.trim().startsWith("<")){let r=yield fetch(e);if(!r.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+r.statusText);e=yield r.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let i=document.createElement("div");i.innerHTML=e;for(let r=0;r<i.childElementCount;++r){let o=i.children[r];o instanceof HTMLStyleElement&&(n.styleEls.push(o),document.head.append(o))}(e=1==i.childElementCount?i.children[0]:i).remove()}n.UIElement=e,n._uiOriginalState={display:e&&e.style.display,inDom:document.body.contains(e)}})()}appendAndShowUI(){this.UIElement&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),"none"==this.UIElement.style.display&&(this.UIElement.style.display=""))}hideUI(){this.UIElement&&(this.UIElement.style.display="none")}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){var n;if("boolean"!=typeof e&&!["image","camera"].includes(e))throw new Error("Invalid value.");if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e;const i=null===(n=this._singleFrameInputContainer)||void 0===n?void 0:n.firstElementChild;i&&("camera"===e?(i.setAttribute("capture",""),i.setAttribute("accept","image/*")):1!=e&&"image"!==e||(i.removeAttribute("capture"),i.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")))}set frameColorMode(e){this._framePixelFormat=e}get frameColorMode(){if(void 0!==this._framePixelFormat)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&1===e.length)return e[0]}return this._defaultFramePixelFormat}set framePixelFormat(e){this._framePixelFormat=e}get framePixelFormat(){if(void 0!==this._framePixelFormat)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&1===e.length)return e[0]}return this._defaultFramePixelFormat}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let n of this._arrScanRegionOverlays)n&&this._updateScanRegionOverlay(n);this._updateDrawingLayersSize(),this.ifShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this.ifShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this.showScanRegionOverlays(),this._drawingLayersManager.setVisible(!0)}else this._softwareScale=1}set ifSaveLastUsedCamera(e){e?ie.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this._isSingleFrameModeEnabled())){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let n of this._arrScanRegionOverlays)n&&this._updateScanRegionOverlay(n);this._updateVideoContainerStyle(),this._drawingLayersManager.setObjectFit(e)}}getVideoFit(){return this.videoFit}_showElClassName(){this._videoContainer&&this._videoContainer.classList.add("div-video-container"),this._cvsScanRegion&&this._cvsScanRegion.classList.add("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.add("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.add("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.add("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.add("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.add("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.add("cvs-single-frame"),this._singleFrameInputContainer&&this._singleFrameInputContainer.classList.add("div-single-frame-input-container")}_hideElClassName(){this._videoContainer&&(this._videoContainer.className=""),this._cvsScanRegion&&(this._cvsScanRegion.className=""),this._cvsViewDecorator&&(this._cvsViewDecorator.className=""),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.className=""),this._layerBaseCvs&&(this._layerBaseCvs.className=""),this._layerBaseCvs&&(this._layerBaseCvs.className=""),this._cvsOriginalImage&&(this._cvsOriginalImage.className=""),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.className=""),this._singleFrameInputContainer&&(this._singleFrameInputContainer.className="")}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&("none"==this._cvsScanRegion.style.display&&(this._cvsScanRegion.style.display=""),this._recordedStates.maskShow=!0)}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none",this._recordedStates.maskShow=!1)}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){if(void 0!==this._bShowScanRegionLaser)return this._bShowScanRegionLaser;if(this._controler){const e=this._controler.getPropertyDisiredValue("ifShowScanRegionLaser");if(e&&e.length){let n=0;for(let i of e)i||n++;return n!==this._controler.getRegisteredUsers().length}}return this._defaultBShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&("none"==this._divScanLight.style.display&&(this._divScanLight.style.display="block"),this._recordedStates.laserShow=!0)}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none",this._recordedStates.laserShow=!1)}_checkValidRegion(e){return!(null!==e&&(!e||!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))||e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0||e.regionMeasuredByPercentage&&(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100)))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("Invalid region.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let n of this._arrScanRegionOverlays)n&&this._updateScanRegionOverlay(n)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}_calculateCvsSize(){var e,n;let i,r,o;if(this._isSingleFrameModeEnabled()?(i=this._imgWidth,r=this._imgHeight,o="contain"):(i=null===(e=this._video)||void 0===e?void 0:e.videoWidth,r=null===(n=this._video)||void 0===n?void 0:n.videoHeight,o=this.getVideoFit()),!i||!r)throw new Error("Invalid content dimensions.");return{width:i,height:r,objectFit:o}}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(this._updateScanRegionOverlay(e),!this._scanRegionOverlayContainer){const n=document.createElement("div");if(this._scanRegionOverlayContainer=n,n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.overflow="hidden",n.style.pointerEvents="none",this._layerBaseCvs)this._layerBaseCvs.parentElement.after(n);else if(this._cvsScanRegion)this._cvsScanRegion.after(n);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(n);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(n);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(n)}this._recordedStates.overlayShow=!0}return this._scanRegionOverlayContainer.append(e),this._arrScanRegionOverlays.push(e),e}removeScanRegionOverlayCanvas(e){const n=this._arrScanRegionOverlays.indexOf(e);-1!==n&&(e.remove(),this._arrScanRegionOverlays.splice(n,1))}_updateScanRegionOverlay(e){if(!e)return;let n;try{n=this._calculateCvsSize()}catch(X){if("Invalid content dimensions."===(X.message||X))return;throw X}const{width:i,height:r,objectFit:o}=n;if(i<=0||r<=0)return e.width=0,void(e.height=0);const s=this._getRegionInPixels(i,r,this._scanRegion),u=this.getFrameSize(i,r,this._scanRegion,this.maxCvsSideLength),g=u.dWidth,v=u.dHeight;e.width==g&&e.height==v||(e.width=g,e.height=v);const w=window.getComputedStyle(this._elContainer),b=parseFloat(w.width),I=parseFloat(w.height),x=b/I,O=i/r;let R,P,V,W,L=1;"contain"===o?(O>x?(L=b/i,R=0,P=(I-r*L)/2):(L=I/r,R=(b-i*L)/2,P=0),R+=s.regionLeft*L,P+=s.regionTop*L,V=(s.regionRight-s.regionLeft)*L,W=(s.regionBottom-s.regionTop)*L):"cover"===o?(O>x?(L=I/r,R=s.regionLeft*L-(i*L-b)/2,P=s.regionTop*L):(L=b/i,R=s.regionLeft*L,P=s.regionTop*L-(r*L-I)/2),V=(s.regionRight-s.regionLeft)*L,W=(s.regionBottom-s.regionTop)*L):(R=0,P=0,V=0,W=0),e.style.position="absolute",e.style.left=R+"px",e.style.top=P+"px",e.style.width=V+"px",e.style.height=W+"px"}showScanRegionOverlays(){this._scanRegionOverlayContainer&&("none"==this._scanRegionOverlayContainer.style.display&&(this._scanRegionOverlayContainer.style.display=""),this._recordedStates.overlayShow=!0)}hideScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none",this._recordedStates.overlayShow=!1)}setViewDecorator(e,n){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));if(!n)throw new Error("Invalid area.");this._assertOpen();let i=[];if("string"==typeof e?i.push(e):Array.isArray(e)&&(i=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator){if(this._cvsViewDecorator=document.createElement("canvas"),this._scanRegionOverlayContainer)this._scanRegionOverlayContainer.after(this._cvsViewDecorator);else if(this._layerBaseCvs)this._layerBaseCvs.parentElement.after(this._cvsViewDecorator);else if(this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsViewDecorator);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsViewDecorator)}this._recordedStates.decoratorShow=!0}this._decoratorArea=JSON.parse(JSON.stringify(n)),this._decoratorType.length=0;const r=["rectangle","focus"],o=["crossline","crosshair"];let s=!1,u=!1;for(let g of i)g=g.toLowerCase(),r.includes(g)&&!s&&(s=!0,this._decoratorType.push(g)),o.includes(g)&&!u&&(u=!0,!this._decoratorType.includes(g)&&this._decoratorType.push(g));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&("none"==this._cvsViewDecorator.style.display&&(this._cvsViewDecorator.style.display=""),this._recordedStates.decoratorShow=!0)}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none",this._recordedStates.decoratorShow=!1)}setViewDecoratorLineWidth(e,n){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=n,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,n){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=n,this._updateViewDecorator()}setViewDecoratorFillStyle(e,n){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=n,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,n){if("string"!=typeof e)throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=n,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen||!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this._isSingleFrameModeEnabled())e="contain";else{if(!this._video)return;e=this.getVideoFit()}const n=this._cvsViewDecorator;n.style.position="absolute",n.style.width="100%",n.style.height="100%",n.style.left="0",n.style.top="0",n.style.objectFit=e,n.style.pointerEvents="none";const i=this.getVisibleRegion(!0);if(!i)return;const r=i.regionRight-i.regionLeft,o=i.regionBottom-i.regionTop;if(n.width==r&&n.height==o||(n.width=r,n.height=o),r<=0||o<=0)return;const s=n.getContext("2d");s.clearRect(0,0,n.width,n.height);const u=this._decoratorArea.x/100*r,g=this._decoratorArea.y/100*o,v=this._decoratorArea.width/100*r,w=this._decoratorArea.height/100*o;for(let b of this._decoratorType){if("rectangle"===b){s.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,s.fillRect(0,0,n.width,n.height),s.clearRect(Math.round(u),Math.round(g),Math.round(v),Math.round(w)),s.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,s.fillRect(Math.round(u),Math.round(g),Math.round(v),Math.round(w)),s.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,s.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const I=s.lineWidth/2;s.strokeRect(Math.round(u-I),Math.round(g-I),Math.round(v+s.lineWidth),Math.round(w+s.lineWidth))}if("focus"===b){s.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,s.fillRect(0,0,n.width,n.height),s.clearRect(Math.round(u),Math.round(g),Math.round(v),Math.round(w)),s.fillStyle=this._viewDecoratorInfo.focus.fillStyle,s.fillRect(Math.round(u),Math.round(g),Math.round(v),Math.round(w)),s.lineWidth=this._viewDecoratorInfo.focus.lineWidth,s.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const I=s.lineWidth/2,x=[0,.25,.75,1],O=[0,.25,.75,1];s.beginPath();for(let R=0;R<x.length;R++)if(0==R||3==R)for(let P=0;P<O.length;P+=2)s.moveTo(Math.round(u+x[R]*v),Math.round(g+O[P]*w)),s.lineTo(Math.round(u+x[R]*v),Math.round(g+O[P+1]*w));for(let R=0;R<O.length;R++)if(0==R||3==R)for(let P=0;P<x.length;P+=2)s.moveTo(Math.round(u+x[P]*v-I),Math.round(g+O[R]*w)),s.lineTo(Math.round(u+x[P+1]*v+I),Math.round(g+O[R]*w));s.stroke()}if("crossline"===b&&(s.beginPath(),s.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,s.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,s.moveTo(Math.round(u),Math.round(g+w/2)),s.lineTo(Math.round(u+v),Math.round(g+w/2)),s.moveTo(Math.round(u+v/2),Math.round(g)),s.lineTo(Math.round(u+v/2),Math.round(g+w)),s.stroke()),"crosshair"===b){s.beginPath();const I=.05*Math.min(v,w);s.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,s.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,s.moveTo(Math.round(u+(v-I)/2),Math.round(g+w/2)),s.lineTo(Math.round(u+(v+I)/2),Math.round(g+w/2)),s.moveTo(Math.round(u+v/2),Math.round(g+(w-I)/2)),s.lineTo(Math.round(u+v/2),Math.round(g+(w+I)/2)),s.stroke()}}}getVisibleRegion(e){let n;this._assertOpen();try{n=this._calculateCvsSize()}catch(u){if("Invalid content dimensions."===(u.message||u))return null;throw u}const{width:i,height:r,objectFit:o}=n;let s=(()=>{const u=parseFloat(window.getComputedStyle(this._elContainer).width),g=parseFloat(window.getComputedStyle(this._elContainer).height);let v,w={regionBottom:r,regionRight:i,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return"cover"===o?u/g<i/r?(v=g/r,w.regionLeft=Math.floor((i-u/v)/2),w.regionRight=Math.ceil(i-w.regionLeft),w.regionTop=0,w.regionBottom=r):(v=u/i,w.regionTop=Math.floor((r-g/v)/2),w.regionBottom=Math.ceil(r-w.regionTop),w.regionLeft=0,w.regionRight=i):"none"===o&&(u<i&&g<r?(w.regionLeft=Math.floor((i-u)/2),w.regionRight=Math.ceil(i-w.regionLeft),w.regionTop=Math.floor((r-g)/2),w.regionBottom=Math.ceil(r-w.regionTop)):u<i?(w.regionLeft=Math.floor((i-u)/2),w.regionRight=Math.ceil(i-w.regionLeft),w.regionTop=0,w.regionBottom=r):g<r&&(w.regionTop=Math.floor((r-g)/2),w.regionBottom=Math.ceil(r-w.regionTop),w.regionLeft=0,w.regionRight=i)),w})();return e?s.regionMeasuredByPercentage=!1:(s.regionBottom=Math.ceil(s.regionBottom/r*100),s.regionRight=Math.ceil(s.regionRight/i*100),s.regionLeft=Math.floor(s.regionLeft/i*100),s.regionTop=Math.floor(s.regionTop/r*100),s.regionMeasuredByPercentage=!0),s}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,n,i){if(!(e<=0||n<=0))return i?i.regionMeasuredByPercentage?{regionLeft:Math.round(i.regionLeft/100*e),regionTop:Math.round(i.regionTop/100*n),regionRight:Math.round(i.regionRight/100*e),regionBottom:Math.round(i.regionBottom/100*n),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(i)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:n,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;let e;try{e=this._calculateCvsSize()}catch(g){if("Invalid content dimensions."===(g.message||g))return;throw g}const{width:n,height:i,objectFit:r}=e;if(n<=0||i<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const o=this._getRegionInPixels(n,i,this._scanRegion);if(!this._cvsScanRegion){if(this._cvsScanRegion=document.createElement("canvas"),this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsScanRegion);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsScanRegion);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsScanRegion)}this._recordedStates.maskShow=!0}const s=this._cvsScanRegion;s.style.position="absolute",s.style.width="100%",s.style.height="100%",s.style.left="0",s.style.top="0",s.style.objectFit=r,s.style.pointerEvents="none",s.width==n&&s.height==i||(s.width=n,s.height=i);const u=s.getContext("2d");if(u.clearRect(0,0,s.width,s.height),0!=o.regionLeft||o.regionRight!=n||0!=o.regionTop||o.regionBottom!=i){const g=o.regionLeft,v=o.regionTop,w=o.regionRight-o.regionLeft,b=o.regionBottom-o.regionTop;u.fillStyle=this.regionMaskFillStyle,u.fillRect(0,0,s.width,s.height),u.clearRect(Math.round(g),Math.round(v),Math.round(w),Math.round(b)),u.strokeStyle=this.regionMaskStrokeStyle,u.lineWidth=this.regionMaskLineWidth;const I=u.lineWidth/2;u.strokeRect(Math.round(g-I),Math.round(v-I),Math.round(w+u.lineWidth),Math.round(b+u.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;let e;try{e=this._calculateCvsSize()}catch(P){if("Invalid content dimensions."===(P.message||P))return;throw P}const{width:n,height:i,objectFit:r}=e;if(!this._divScanArea)return;if(n<=0||i<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const o=this._getRegionInPixels(n,i,this._scanRegion),s=window.getComputedStyle(this._elContainer),u=parseFloat(s.width),g=parseFloat(s.height),v=u/g,w=n/i;let b,I,x,O,R=1;if("contain"===r)v<w?(R=u/n,b=0,I=(g-i*R)/2):(R=g/i,b=(u-n*R)/2,I=0),b+=o.regionLeft*R,I+=o.regionTop*R,x=(o.regionRight-o.regionLeft)*R,O=(o.regionBottom-o.regionTop)*R;else if("cover"===r)if(v<w){R=g/i,b=o.regionLeft*R-(n*R-u)/2,b=Math.max(b,0),b=Math.min(b,parseFloat(s.width)),I=o.regionTop*R;let P=o.regionRight*R-(n*R-u)/2;P=Math.max(P,0),P=Math.min(P,parseFloat(s.width)),x=P-b,O=(o.regionBottom-o.regionTop)*R}else{R=u/n,b=o.regionLeft*R,I=o.regionTop*R-(i*R-g)/2,I=Math.max(I,0),I=Math.min(I,parseFloat(s.height));let P=o.regionBottom*R-(i*R-g)/2;P=Math.max(P,0),P=Math.min(P,parseFloat(s.height)),x=(o.regionRight-o.regionLeft)*R,O=P-I}else b=0,I=0,x=0,O=0;this._divScanArea.style.left=b+"px",this._divScanArea.style.top=I+"px",this._divScanArea.style.width=x+"px",this._divScanArea.style.height=O+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){if(void 0!==this._croppingRegions)return this._croppingRegions;if(this._controler){const e=this._controler.getPropertyDisiredValue("croppingRegions");if(e&&1===e.length)return e[0]}return this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'Invalid value.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){if(void 0!==this._loopInterval)return this._loopInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("loopInterval");if(e&&1===e.length)return e[0]}return this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("Invalid value.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){if(void 0!==this._maxNumberOfFramesInBuffer)return this._maxNumberOfFramesInBuffer;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxNumberOfFramesInBuffer");if(e&&1===e.length)return e[0]}return this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){if(void 0!==this._refreshInterval)return this._refreshInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("refreshInterval");if(e&&1===e.length)return e[0]}return this._defaultRefreshInterval}static createInstance(e){var n=this;return ne(function*(){let i=new ie;("string"==typeof e||e instanceof String)&&(e=JSON.parse(e));for(let r in e)i[r]=e[r];return n._hasEngineResourceLoaded=!0,ie.onWarning&&(location&&"file:"===location.protocol?setTimeout(()=>{ie.onWarning&&ie.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):!1!==window.isSecureContext&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{ie.onWarning&&ie.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),i._drawingLayersManager=new Bx,i})()}static playVideo(e,n,i){return ne(function*(){if(!e)throw new Error("Invalid 'videoEl'.");if(!n)throw new Error("Invalid 'source'.");return"string"==typeof n||n instanceof String?e.src=n:e.srcObject=n,new Promise((r,o)=>{let s;const u=()=>{e.removeEventListener("loadstart",w),e.removeEventListener("abort",b),e.removeEventListener("play",I),e.removeEventListener("error",x)},g=()=>{s&&clearTimeout(s),u(),r(e)},v=O=>{s&&clearTimeout(s),u(),o(O)},w=()=>{e.addEventListener("abort",b,{once:!0})},b=()=>{const O=new Error("Video playing was interrupted.");O.name="AbortError",v(O)},I=()=>{g()},x=()=>{v(new Error(`Video error ${e.error.code}: ${e.error.message}.`))};e.addEventListener("loadstart",w,{once:!0}),e.autoplay?(e.addEventListener("play",I,{once:!0}),e.addEventListener("error",x,{once:!0})):(e.load(),e.play().then(()=>{g()}).catch(O=>{v(O)})),i&&(s=setTimeout(()=>{u(),o(new Error("Failed to play video. Timeout."))},i))})})()}static findBestRearCameraInIOS(e){if(!e||!e.length)return null;const n=["back","baksidan","bakre","bak","\u5f8c\u7f6e","\u540e\u7f6e","\u80cc\u9762","\u062e\u0644\u0641\u064a\u0629","\u0437\u0430\u0434\u043d\u0430","posteriore","posterior","zadn\xed","bagside","r\xfcck","\u03c0\u03af\u03c3\u03c9","trasera","taka","arri\xe8re","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u092c\u0948\u0915","stra\u017enja","h\xe1ts\xf3","belakang","a\u0440\u0442\u049b\u044b","\ud6c4\uba74","achterzijde","tylny","traseira","spate","\u0437\u0430\u0434\u043d\u044f\u044f","\u0437\u0430\u0434\u043d\u0435\u0439","zadn\xe1","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07","arka","sau"],i=["triple","\u4e09\u955c\u5934","\u4e09\u93e1\u982d","\u30c8\u30ea\u30d7\u30eb","\u062b\u0644\u0627\u062b\u064a\u0629","\u0442\u0440\u043e\u0439\u043d\u0430","trojn\xfd","\u03c4\u03c1\u03b9\u03c0\u03bb\u03ae","kolmois","\u05de\u05e9\u05d5\u05dc\u05e9\u05ea","\u091f\u094d\u0930\u093f\u092a\u0932","trostruka","tiga","tripla","\u04af\u0448\u0442\u0456\u043a","\ud2b8\ub9ac\ud50c","trippelt","trippel","tr\xf3jobiektywowy","tripl\u0103","\u0442\u0440\u043e\u0439\u043d\u0430\u044f","trojit\xe1","\u0e2a\u0e32\u0e21","\xfc\xe7l\xfc","\u043f\u043e\u0442\u0440\u043e\u0454\u043d\u0430","ba camera"],r=["dual wide","dual-weitwinkel","dual con gran angular","dual","doble","double","\u53cc\u5e7f\u89d2","\u96d9\u5ee3\u89d2","\u30c7\u30e5\u30a2\u30eb\u5e83\u89d2","\u0645\u0632\u062f\u0648\u062c\u0629 \u0639\u0631\u064a\u0636\u0629","\u0434\u0432\u043e\u0439\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u044a\u0433\u044a\u043b\u043d\u0430","du\xe1ln\xed \u0161iroko\xfahl\xfd","\u03b4\u03b9\u03c0\u03bb\u03ae \u03b5\u03c5\u03c1\u03b5\u03af\u03b1","laajakulmainen kaksois","\u05db\u05e4\u05d5\u05dc\u05d4 \u05e8\u05d7\u05d1\u05d4","\u0921\u094d\u092f\u0941\u0905\u0932 \u0935\u093e\u0907\u0921","dvostruka \u0161iroka","kett\u0151s, sz\xe9les l\xe1t\xf3sz\xf6g\u0171","ganda","doppia con grandangolo","\u049b\u043e\u0441 \u043a\u0435\u04a3 \u0431\u04b1\u0440\u044b\u0448\u0442\u044b","\ub4c0\uc5bc \uc640\uc774\ub4dc","dwikamera","dobbelt vidvinkelkamera","dwuobiektywowy","dupla grande-angular","grande angular dupla","dubl\u0103","\u0434\u0432\u043e\u0439\u043d\u0430\u044f \u0448\u0438\u0440\u043e\u043a\u043e\u0443\u0433\u043e\u043b\u044c\u043d\u0430\u044f","du\xe1lna \u0161irokouhl\xe1","dubbel vidvinkel","\u0e04\u0e39\u0e48\u0e14\u0e49\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07\u0e21\u0e38\u0e21\u0e01\u0e27\u0e49\u0e32\u0e07","\xe7ift geni\u015f","\u0437\u0434\u0432\u043e\u0454\u043d\u0430 \u0448\u0438\u0440\u043e\u043a\u043e\u043a\u0443\u0442\u043d\u0430","k\xe9p r\u1ed9ng m\u1eb7t sau"],o=e.filter(g=>{const v=g.label.toLowerCase();return n.some(w=>v.includes(w))});if(!o.length)return null;const s=o.find(g=>{const v=g.label.toLowerCase();return i.some(w=>v.includes(w))});if(s)return s.deviceId;const u=o.find(g=>{const v=g.label.toLowerCase();return r.some(w=>v.includes(w))});return u?u.deviceId:o[0].deviceId}static findBestRearCamera(e){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(Je.OS))return ie.findBestRearCameraInIOS(e);const n=["rear","back","r\xfcck","arri\xe8re","trasera","tr\xe1s","traseira","posteriore","posterior","\u540e\u9762","\u5f8c\u9762","\u80cc\u9762","\u540e\u7f6e","\u5f8c\u7f6e","\u80cc\u7f6e","\u0437\u0430\u0434\u043d\u0435\u0439","\u062e\u0644\u0641\u064a\u0629","\ud6c4","arka","achterzijde","\u0e2b\u0e25\u0e31\u0e07","baksidan","bagside","sau","bak","tylny","taka","\u05d0\u05d7\u05d5\u05e8\u05d9\u05ea","\u03c0\u03af\u03c3\u03c9","spate","h\xe1ts\xf3","zadn\xed","darrere","zadn\xe1","\u0437\u0430\u0434\u043d\u044f","stra\u017enja","belakang","\u092c\u0948\u0915","\u0437\u0430\u0434\u043d\u0430","a\u0440\u0442\u049b\u044b","\u0437\u0430\u0434\u043d\u044f\u044f","bakre","\u0e32\u0e19\u0e2b\u0e25\u0e31\u0e07"];for(let i of e){const r=i.label.toLowerCase();if(r&&n.some(o=>r.includes(o))&&/\b0(\b)?/.test(r))return i.deviceId}return["Android","HarmonyOS"].includes(Je.OS)?e[e.length-1].deviceId:null}_isSingleFrameModeEnabled(){return 0!=this.singleFrameMode}play(e,n,i,r){var o=this;return ne(function*(){let s;if(o._video&&o.videoSrc){ie._onLog&&(s=Date.now(),ie._onLog("DCE: start loading static video: "+s));const v=yield ie.playVideo(o._video,o.videoSrc,o.cameraOpenTimeout);if(ie._onLog&&ie._onLog("DCE: finish loading static video. Costs: "+(Date.now()-s)),!o._video)return v.pause(),o.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};const w={width:o._video.videoWidth,height:o._video.videoHeight,deviceId:o._currentCamera&&o._currentCamera.deviceId};o.playCallbackInfo=JSON.parse(JSON.stringify(w));const b=o.mapCameraEvents.get("played");for(let I of b){if(!I)continue;const x=JSON.parse(JSON.stringify(w));setTimeout(()=>{o.isDisposed&&o.disposed||I.apply(o,[x])},0)}return o._recordedStates.videoPlaying=!0,w}if(o._isSingleFrameModeEnabled())return r&&r.notTriggerSingleFrameClick||o._clickIptSingleFrameMode(),o.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};if(!o._video)throw new Error("'video' is null or undefined.");const u=++o.iPlayRound;if(o.promisePlay&&(yield o.promisePlay,u<o.iPlayRound))return o.playCallbackInfo={width:o._video.videoWidth,height:o._video.videoHeight,deviceId:o._currentCamera&&o._currentCamera.deviceId},{width:o._video.videoWidth,height:o._video.videoHeight,deviceId:o._currentCamera&&o._currentCamera.deviceId};o.promisePlay=ne(function*(){var v;try{o._video&&o._video.srcObject&&o.stop(),ie._onLog&&ie._onLog("DCE: ======before video========");const w=()=>{if(!o._video)throw x&&x.getTracks().forEach(ee=>{ee.stop()}),o._videoTrack=null,o._currentCamera=null,new Error("'video' is null or undefined.")},b=o.getVideoSettings();let I,x;if("boolean"==typeof b.video&&(b.video={}),e)delete b.video.facingMode,b.video.deviceId={exact:e};else if(!b.video.deviceId)if(o._lastDeviceId)delete b.video.facingMode,b.video.deviceId={exact:o._lastDeviceId};else if(o.ifSaveLastUsedCamera&&ie.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete b.video.facingMode,b.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const ee=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),le=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));ee&&le&&(b.video.width=ee,b.video.height=le)}else if(!o.ifSkipCameraInspection&&b.video.facingMode){if(yield o.getAllCameras(!1),!o._video)throw new Error("'video' is null or undefined.");let ee=b.video.facingMode;if(ee instanceof Array&&ee.length&&(ee=ee[0]),ee=ee.exact||ee.ideal||ee,"environment"===ee){I=!0;const le=ie.findBestRearCamera(o._allCameras);le&&(delete b.video.facingMode,b.video.deviceId={exact:le})}}n&&(b.video.width={ideal:n}),i&&(b.video.height={ideal:i}),ie._onLog&&ie._onLog("DCE: ======try getUserMedia========");let O=[0,500],R=null;const P=function(){var ee=ne(function*(le){for(let ye of O){ye&&(yield new Promise(S=>setTimeout(S,ye))),w();try{ie._onLog&&ie._onLog("DCE: ask "+JSON.stringify(le)),x=yield navigator.mediaDevices.getUserMedia(le);break}catch(S){if(w(),"NotFoundError"===S.name||"NotAllowedError"===S.name)throw S;R=S,ie._onLog&&ie._onLog("DCE: "+S.message||0)}}w()});return function(ye){return ee.apply(this,arguments)}}();let V;if(yield P(b),x||(ie._onLog&&ie._onLog("DCE: ======try getUserMedia again========"),V=JSON.parse(JSON.stringify(b)),"object"==typeof V.video&&(["iPhone","iPad"].includes(Je.OS)?(n>=1280||i>=1280?V.video.width=1280:n>=640||i>=640?V.video.width=640:(n<640||i<640)&&(V.video.width=320),delete V.video.height):I&&!b.video.deviceId?(delete V.video.facingMode,o._allCameras.length&&(V.video.deviceId={ideal:o._allCameras[o._allCameras.length-1].deviceId})):V.video=!0),ie._onLog&&ie._onLog("DCE: "+V),yield P(V)),x||(O=[1e3,2e3],yield P(b)),x||(yield P(V)),!x)throw R;const W=()=>{const ee=x.getVideoTracks();let le,ye;if(ee.length&&(le=o._videoTrack=ee[0]),o._video&&le){const S=le.getSettings();if(S)for(let pe of o._allCameras)if(S.deviceId===pe.deviceId){pe._checked=!0,pe.label=le.label,ye=pe;break}}o._currentCamera=ye};if(yield o.getAllCameras(!1),w(),I&&!o.ifSkipCameraInspection){W();const ee=ie.findBestRearCamera(o._allCameras),le=null===(v=o._currentCamera)||void 0===v?void 0:v.deviceId;ee&&ee!=le&&(x.getTracks().forEach(ye=>{ye.stop()}),O=[0,500,1e3,2e3],b.video.deviceId={exact:ee},yield P(b))}ie._onLog&&ie._onLog("DCE: ======play video========"),w(),yield ie.playVideo(o._video,x,o.cameraOpenTimeout),w(),ie._onLog&&ie._onLog("DCE: ======played video========"),o._bgLoading&&(o._bgLoading.style.animationPlayState="paused");const L="got "+o._video.videoWidth+"x"+o._video.videoHeight;o._optGotRsl&&(o._optGotRsl.setAttribute("data-width",o._video.videoWidth),o._optGotRsl.setAttribute("data-height",o._video.videoHeight),o._optGotRsl.innerText=L,o._selRsl&&o._optGotRsl.parentNode==o._selRsl&&(o._selRsl.value="got")),ie._onLog&&ie._onLog("DCE: got "+L),W(),o._renderSelCameraInfo();const X={width:o._video.videoWidth,height:o._video.videoHeight,deviceId:o._currentCamera&&o._currentCamera.deviceId};if(X.deviceId&&(o._lastDeviceId=X.deviceId,o.ifSaveLastUsedCamera&&ie.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",o._lastDeviceId),b.video.width&&b.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(b.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(b.video.height))))),!r||!r.notTriggerPlayedEvent){const ee=o.mapCameraEvents.get("played");for(let le of ee){if(!le)continue;const ye=JSON.parse(JSON.stringify(X));setTimeout(()=>{o.isDisposed&&o.disposed||le.apply(o,[ye])},0)}}return o.promisePlay=null,X}catch(w){throw o.promisePlay=null,o._bgLoading&&(o._bgLoading.style.display="none"),"NotFoundError"===w.name&&(DOMException?w=new DOMException("No camera available, please use a device with an accessible camera.",w.name):(w=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),w}})(),ie._onLog&&(s=Date.now(),ie._onLog("DCE: start opening camera: "+s));const g=yield o.promisePlay;return ie._onLog&&ie._onLog("DCE: finish opening camera. Costs: "+(Date.now()-s)),o.playCallbackInfo=JSON.parse(JSON.stringify(g)),o._recordedStates.videoPlaying=!0,g})()}resume(){var e=this;return ne(function*(){e._assertOpen(),e._video&&(yield e._video.play(),e._recordedStates.videoPlaying=!0),e.ifShowScanRegionLaser&&e.showScanRegionLaser()})()}pause(){this._assertOpen(),this._video&&(this._video.pause(),this._recordedStates.videoPlaying=!1),this.ifShowScanRegionLaser&&this.hideScanRegionLaser()}isPaused(){var e;return!this._isSingleFrameModeEnabled()&&!0===(null===(e=this._video)||void 0===e?void 0:e.paused)}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");const e=[this.UIElement];for(let n=0;n<e.length;++n)for(let i of e[n].children)e.push(i);for(let n of e){if(!this._video&&n.classList.contains(this.containerClassName)){this._elContainer=n;const i=document.createElement("video");i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%",i.style.objectFit=this.getVideoFit(),i.setAttribute("autoplay","true"),i.setAttribute("playsinline","true"),i.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Je.OS)&&Je.version>=17&&i.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),this._video=i;const r=document.createElement("div");r.append(i),r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",r.style.overflow="hidden",this._videoContainer=r,n.prepend(r)}else!this._divScanArea&&n.classList.contains("dce-scanarea")?this._divScanArea=n:!this._divScanLight&&n.classList.contains("dce-scanlight")?this._divScanLight=n:!this._bgLoading&&n.classList.contains("dce-bg-loading")?this._bgLoading=n:!this._bgCamera&&n.classList.contains("dce-bg-camera")?this._bgCamera=n:!this._selCam&&n.classList.contains("dce-sel-camera")?this._selCam=n:!this._selRsl&&n.classList.contains("dce-sel-resolution")?(this._selRsl=n,this.videoSrc||this._isSingleFrameModeEnabled()||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&n.classList.contains("dce-opt-gotResolution")?this._optGotRsl=n:!this._btnClose&&n.classList.contains("dce-btn-close")?this._btnClose=n:!this._selMinLtr&&n.classList.contains("dlr-sel-minletter")?(this._selMinLtr=n,this._selMinLtr.options.length||(this._selMinLtr.innerHTML=[this._optGotMinLtr?"":'<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._optGotMinLtr||this._selMinLtr.options[0])):!this._optGotMinLtr&&n.classList.contains("dlr-opt-gotMinLtr")&&(this._optGotMinLtr=n);if(this.extraBindings&&this.extraBindings.length)for(let i of this.extraBindings)try{i(n)}catch{}}if(!this._video)throw this._unbindUI(),Error(`Can not find the video container element with class '${this.containerClassName}'`);this._isSingleFrameModeEnabled()||this.videoSrc?(this._isSingleFrameModeEnabled()&&(this._elContainer&&(this._elContainer.addEventListener("click",this._clickIptSingleFrameMode),this._elContainer.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._elContainer&&(["Android","HarmonyOS"].includes(Je.OS)?(this._elContainer.addEventListener("touchend",this._tapDoFocus),this._elContainer.addEventListener("touchmove",this._touchMoveEvent)):this._elContainer.addEventListener("click",this._tapDoFocus)),this._selCam&&(this._selCam.style.display="block",this._selCam.addEventListener("change",this._onCameraSelChange)),this._selRsl&&(this._selRsl.style.display="block",this._selRsl.addEventListener("change",this._onResolutionSelChange)),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._bgLoading&&(this._bgLoading.style.display="block")),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&(this._resizeObserver||(this._resizeObserver=new ResizeObserver(n=>{for(let i of n)i.target===this._elContainer&&this._updateLayers()})),this._elContainer&&this._resizeObserver.observe(this._elContainer)),this._windowWidth=document.documentElement.clientWidth,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){this._isSingleFrameModeEnabled()?(this._elContainer&&(this._elContainer.removeEventListener("click",this._clickIptSingleFrameMode),this._elContainer.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._elContainer&&(this._elContainer.removeEventListener("click",this._tapDoFocus),this._elContainer.removeEventListener("touchend",this._tapDoFocus),this._elContainer.removeEventListener("touchmove",this._touchMoveEvent)),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._drawingLayersManager.setVisible(!1),this._hideOriginalImageCvs(),this._videoContainer&&this._videoContainer.remove(),this._video=null,this._videoContainer=null,this._elContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}open(e){var n=this;return ne(function*(){n.UIElement||(yield n.setUIElement(ie.defaultUIElementURL)),n._bindUI(),e&&n.appendAndShowUI();let i=yield n.play();n.bOpen=!0,n._focusParameters.fds=null,n._focusParameters.kTimeout=void 0,n._focusSupported=!0,n._tapFocusEnabled&&!n._isSingleFrameModeEnabled()&&(n._focusParameters.fds=(yield n.getCapabilities()).focusDistance,n._focusParameters.fds||(n._focusSupported=!1,n._tapFocusEnabled=!1));const r=n.mapCameraEvents.get("cameraopen");for(let o of r){if(!o)continue;const s=JSON.parse(JSON.stringify(i));setTimeout(()=>{n.isDisposed&&n.disposed||o.apply(n,[s])},0)}return i})()}close(e){if(!this._video)return;this.stop(),this._hideOriginalImage(!1),this.hideTip(),this._unbindUI(),e&&this.hideUI(),this.stopFetchingLoop(),this.bOpen=!1;const n=this.mapCameraEvents.get("cameraclose");for(let i of n){if(!i)continue;const r={width:0,height:0,deviceId:null};setTimeout(()=>{this.isDisposed&&this.disposed||i.apply(this,[r])},0)}}stop(){this._video&&this._video.srcObject&&(ie._onLog&&ie._onLog("DCE: ======stop video========"),this._video.srcObject.getTracks().forEach(e=>{e.stop()}),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(ie._onLog&&ie._onLog("DCE: ======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0,this._reusedCvs&&this._reusedCvs.ctx2d&&this._reusedCvs.ctx2d.clearRect(0,0,this._reusedCvs.width,this._reusedCvs.height),this.forceLoseContext()}getAllCameras(e=!0){var n=this;return ne(function*(){let i=(yield navigator.mediaDevices.enumerateDevices()).filter(s=>"videoinput"===s.kind);if(e&&i&&i.length&&!i[0].deviceId){let s=yield navigator.mediaDevices.getUserMedia({video:!0});i=(yield navigator.mediaDevices.enumerateDevices()).filter(u=>"videoinput"===u.kind),s.getTracks().forEach(u=>{u.stop()})}const r=[],o=[];if(n._allCameras)for(let s of n._allCameras)s._checked&&o.push(s);for(let s=0;s<i.length;s++){let u,g=i[s];for(let v of o)if(g.deviceId==v.deviceId){u=v;break}u||(u={deviceId:g.deviceId,label:g.label?g.label:"camera "+s,_checked:!1}),u.deviceId&&r.push(u)}return n._allCameras=r,ie._onLog&&ie._onLog("DCE: "+JSON.stringify(n._allCameras)),r})()}_renderSelCameraInfo(){if(!this._selCam)return;let e;this._selCam.textContent="";for(let n of this._allCameras){const i=document.createElement("option");i.value=n.deviceId,i.innerText=n.label,this._selCam.append(i),n.deviceId&&this._currentCamera&&this._currentCamera.deviceId==n.deviceId&&(e=i)}this._selCam.value=e?e.value:""}getSelectedCamera(){if(!this._bOpen){let e="";const n=this.videoSettings.video.deviceId;n&&(e=n.exact||n.ideal||n);for(let i of this._allCameras)if(i.deviceId===e)return JSON.parse(JSON.stringify(i));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}selectCamera(e){var n=this;return ne(function*(){let i="";if(e&&(i=e.deviceId||e),n.videoSettings.video.deviceId={exact:i},!n._bOpen||n._video.paused)return null;let r=null;n._currentCamera&&(r=n._currentCamera.deviceId);const o=n._video.videoWidth,s=n._video.videoHeight,u=yield n.play(e.deviceId||e);if(n._focusParameters.fds=null,n._focusParameters.kTimeout=void 0,n._focusSupported=!0,n._tapFocusEnabled&&!n._isSingleFrameModeEnabled()&&(n._focusParameters.fds=(yield n.getCapabilities()).focusDistance,n._focusParameters.fds||(n._focusSupported=!1,n._tapFocusEnabled=!1)),r!==u.deviceId){const g=n.mapCameraEvents.get("camerachange");for(let v of g){if(!v)continue;const w=JSON.parse(JSON.stringify(u));setTimeout(()=>{n.isDisposed&&n.disposed||v.apply(n,[w])},0)}}if(o!==u.width||s!==u.height){n._updateScanRegionCanvas(),n._updateScanAreaDiv(),n._updateViewDecorator();for(let v of n._arrScanRegionOverlays)v&&n._updateScanRegionOverlay(v);n._updateDrawingLayersSize(),n._updateVideoContainerStyle();const g=n.mapCameraEvents.get("resolutionchange");for(let v of g){if(!v)continue;const w=JSON.parse(JSON.stringify(u));setTimeout(()=>{n.isDisposed&&n.disposed||v.apply(n,[w])},0)}}return u})()}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,n=0;const i=this.videoSettings.video.width,r=this.videoSettings.video.height;return i&&(e=i.exact||i.ideal||i),r&&(n=r.exact||r.ideal||r),[e,n]}}setResolution(e,n){var i=this;return ne(function*(){let r,o;if(e instanceof Array?(r=e[0],o=e[1]):(r=e,o=n),i.videoSettings.video.width={ideal:r},i.videoSettings.video.height={ideal:o},!i._bOpen||i._video.paused)return null;const s=i._video.videoWidth,u=i._video.videoHeight,g=yield i.play(null,r,o);if(s!==g.width||u!==g.height){i._updateScanRegionCanvas(),i._updateScanAreaDiv(),i._updateViewDecorator();for(let w of i._arrScanRegionOverlays)w&&i._updateScanRegionOverlay(w);i._updateDrawingLayersSize(),i._updateVideoContainerStyle();const v=i.mapCameraEvents.get("resolutionchange");for(let w of v){if(!w)continue;const b=JSON.parse(JSON.stringify(g));setTimeout(()=>{i.isDisposed&&i.disposed||w.apply(i,[b])},0)}}return g})()}getResolutions(e){var n=this;return ne(function*(){var i,r;let o="";const s=(g,v)=>{const w=n._mapCameraResolutions.get(g);if(!w||!w.length)return!1;for(let b of w)if(b[0]===v.width&&b[1]===v.height)return!0;return!1},u=function(){var g=ne(function*(v,w,b){const I={video:{deviceId:{exact:v},width:{ideal:w},height:{ideal:b}}};let x=null;try{x=yield navigator.mediaDevices.getUserMedia(I)}catch{return null}if(!x)return null;const O=x.getVideoTracks();let R=null;try{const P=O[0].getSettings();R={width:P.width,height:P.height}}catch{const V=document.createElement("video");V.srcObject=x,R={width:V.videoWidth,height:V.videoHeight},V.srcObject=null}return O.forEach(P=>{P.stop()}),R});return function(w,b,I){return g.apply(this,arguments)}}();if(!n._bOpen){const g=null===(r=null===(i=n.videoSettings)||void 0===i?void 0:i.video)||void 0===r?void 0:r.deviceId;if(!g||(o=g.hasOwnProperty("exact")?n.videoSettings.video.deviceId.exact:g.hasOwnProperty("ideal")?n.videoSettings.video.deviceId.ideal:n.videoSettings.video.deviceId,!o))return null;let v=n._mapCameraResolutions.get(o);if(v&&!e)return n._mapCameraResolutions.get(o);n._mapCameraResolutions.set(o,[]),v=n._mapCameraResolutions.get(o);for(let w of n._predefinedResolutions){const b=yield u(o,w.width,w.height);b&&!s(o,b)&&v.push([b.width,b.height])}return v}if(n._currentCamera){o=n._currentCamera.deviceId;let g=n._mapCameraResolutions.get(o);if(g&&!e)return n._mapCameraResolutions.get(o);n._mapCameraResolutions.set(o,[]),g=n._mapCameraResolutions.get(o);let v=n._videoTrack;for(let w of n._predefinedResolutions){yield v.applyConstraints({width:{ideal:w.width},height:{ideal:w.height}});const b=v.getSettings(),I={width:b.width,height:b.height};s(o,I)||g.push([I.width,I.height])}return n._video.srcObject.getTracks().forEach(w=>{w.stop()}),yield n.play(o,null,null,{notTriggerPlayedEvent:!0}),g}return null})()}on(e,n){if(!n)return;const i=this.mapCameraEvents.get(e.toLowerCase());if(!i)throw new Error(`Event '${e}' does not exist.`);i.includes(n)||i.push(n)}off(e,n){const i=this.mapCameraEvents.get(e.toLowerCase());if(!i)throw new Error(`Event '${e}' does not exist.`);const r=i.indexOf(n);-1!==r&&i.splice(r,1)}offAll(e){if(e){if("string"==typeof e){const n=this.mapCameraEvents.get(e);n&&(n.length=0)}}else for(let n of this.mapCameraEvents.values())n&&(n.length=0)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){if(this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen)return this.play()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getCapabilities()' is unavailable in singleFrameMode.");return this._videoTrack&&this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings():null}getConstraints(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getConstraints()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getConstraints():null}applyConstraints(e){var n=this;return ne(function*(){if(n._assertOpen(),n._isSingleFrameModeEnabled())throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!n._videoTrack)throw new Error('"_videoTrack" is null.');if(!n._videoTrack.applyConstraints)throw Error("Not supported.");return yield n._videoTrack.applyConstraints(e)})()}turnOnTorch(){var e=this;return ne(function*(){if(e._assertOpen(),e._isSingleFrameModeEnabled())throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(e.getCapabilities().torch)return yield e._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")})()}turnOffTorch(){var e=this;return ne(function*(){if(e._assertOpen(),e._isSingleFrameModeEnabled())throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(e.getCapabilities().torch)return yield e._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")})()}setColorTemperature(e){var n=this;return ne(function*(){if(n._assertOpen(),n._isSingleFrameModeEnabled())throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let i=n.getCapabilities().colorTemperature;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),yield n._videoTrack.applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]})})()}getColorTemperature(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getColorTemperature()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().colorTemperature||0:null}setExposureCompensation(e){var n=this;return ne(function*(){if(n._assertOpen(),n._isSingleFrameModeEnabled())throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let i=n.getCapabilities().exposureCompensation;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),yield n._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})})()}getExposureCompensation(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getExposureCompensation()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().exposureCompensation||0:null}_setHardwareScale(e){var n=this;return ne(function*(){if(n._assertOpen(),n._isSingleFrameModeEnabled())throw new Error("'_setHardwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");if(!n._videoTrack)return;const i=n.getCapabilities().zoom;if(!i)throw new Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),e=Xt(e,i.min,i.step,i.max),yield n._videoTrack.applyConstraints({advanced:[{zoom:e}]}),e})()}_getHardwareScale(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().zoom||1:null}_setSoftwareScale(e,n){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setSoftwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");n&&this._setScaleCenter(n),this._softwareScale=e,this._scaleVideo(e,n)}_getSoftwareScale(){return this._softwareScale}_setScaleCenter(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setScaleCenter()' is unavailable in singleFrameMode.");if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid center.");const n=this._video.videoWidth,i=this._video.videoHeight;let r=0,o=0;if(e.x.endsWith("px"))r=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");r=parseFloat(e.x)/100*n}if(e.y.endsWith("px"))o=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");o=parseFloat(e.y)/100*i}if(NaN==r||NaN==o)throw new Error("Invalid scale center.");this._scaleCenter={x:r,y:o}}_resetScaleCenter(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_resetScaleCenter()' is unavailable in singleFrameMode.");this._scaleCenter={x:this._video.videoWidth/2,y:this._video.videoHeight/2}}_isVideoCenter(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_isVideoCenter()' is unavailable in singleFrameMode.");return e&&e.x==this._video.videoWidth/2&&e.y==this._video.videoHeight/2}_setZoom(e){var n=this;return ne(function*(){if(n._assertOpen(),n._isSingleFrameModeEnabled())throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");n._resetScaleCenter();try{if(n._isVideoCenter(n._scaleCenter)){const i=yield n._setHardwareScale(e);let r=n._getHardwareScale();1==r&&1!=i&&(r=i),n._setSoftwareScale(e>r?e/r:1)}else yield n._setHardwareScale(1),n._setSoftwareScale(e)}catch(i){if("Not supported."!==(i.message||i))throw i;n._setSoftwareScale(e)}})()}setZoom(e){var n=this;return ne(function*(){if("number"!=typeof e&&"object"!=typeof e)throw new TypeError("Illegal type of argument.");if("number"==typeof e)return n._setZoom(e);if(n._assertOpen(),n._isSingleFrameModeEnabled())throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e){if("number"!=typeof e.factor)throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid value.");e.centerPoint?n._setScaleCenter(e.centerPoint):n._resetScaleCenter();try{if(n._isVideoCenter(n._scaleCenter)){const i=yield n._setHardwareScale(e.factor);let r=n._getHardwareScale();1==r&&1!=i&&(r=i),n._setSoftwareScale(e.factor>r?e.factor/r:1)}else yield n._setHardwareScale(1),n._setSoftwareScale(e.factor)}catch(i){if("Not supported."!==(i.message||i))throw i;n._setSoftwareScale(e.factor)}}})()}getZoom(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?this._getHardwareScale()*this._softwareScale:null}getZoomSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?{factor:this._getHardwareScale()*this._softwareScale}:null}resetZoom(){var e=this;return ne(function*(){yield e.setZoom({factor:1})})()}setFrameRate(e){var n=this;return ne(function*(){if(n._assertOpen(),n._isSingleFrameModeEnabled())throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let i=n.getCapabilities().frameRate;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),yield n._videoTrack.applyConstraints({width:{ideal:Math.max(n._video.videoWidth,n._video.videoHeight)},frameRate:e})})()}getFrameRate(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getFrameRate()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().frameRate:null}_setFocus(e,n){var i=this;return ne(function*(){if(i._assertOpen(),i._isSingleFrameModeEnabled())throw new Error("'setFocus()' is unavailable in singleFrameMode.");if("string"!=typeof e)throw Error("Invalid focus mode.");e=e.toLowerCase();const r=i.getCapabilities().focusMode,o=i.getCapabilities().focusDistance;if(!r)throw Error("Not supported.");if(!r.includes(e))throw Error("Unsupported mode.");if(n>=0){if(!o)throw Error("Manual focus unsupported.");return n<o.min?n=o.min:n>o.max&&(n=o.max),n=Xt(n,o.min,o.step,o.max),yield i._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:n}]})}return yield i._videoTrack.applyConstraints({advanced:[{focusMode:e}]})})()}setFocus(e,n){var i=this;return ne(function*(){if("string"==typeof e)return i._setFocus(e,n);if(i._assertOpen(),i._isSingleFrameModeEnabled())throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(!e)return;const r=i.getCapabilities(),o=r.focusMode,s=r.focusDistance;if(!o)throw Error("Not supported.");if("string"!=typeof e.mode)throw Error("Invalid focus mode.");const u=e.mode.toLowerCase();if(!o.includes(u))throw Error("Unsupported focus mode.");if("manual"!==u)return i._focusParameters._focusArea=null,yield i._videoTrack.applyConstraints({advanced:[{focusMode:u}]});if(!s)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let g=e.distance;return g<s.min?g=s.min:g>s.max&&(g=s.max),g=Xt(g,s.min,s.step,s.max),i._focusParameters._focusArea=null,yield i._videoTrack.applyConstraints({advanced:[{focusMode:u,focusDistance:g}]})}if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const g=e.area.centerPoint;let v=e.area.width,w=e.area.height;if(!v||!w){const b=i._video.videoWidth,I=i._video.videoHeight;v||(v=2*Math.round(Math.min(b,I)/i._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),w||(w=2*Math.round(Math.min(b,I)/i._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}i._focusParameters._focusArea={centerPoint:{x:g.x,y:g.y},width:v,height:w},yield i._setLocalFocus(g,v,w)}})()}getFocus(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings().focusMode;return e?"continuous"===e?{mode:e}:{mode:e,distance:this._videoTrack.getSettings().focusDistance}:null}getFocusSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings(),n=e.focusMode;return n?"manual"===n?this._focusParameters._focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters._focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:n}:null}_setFocusAndGetContract(e,n){var i=this;return ne(function*(){const r=x=>{if(!i._bOpen||!i._videoTrack||i.video.paused||x.focusTaskId!=i._focusParameters.curFocusTaskId){i._bOpen&&i._videoTrack&&!i.video.paused||(i._focusParameters.isDoingFocus=0);const O=new Error(`Focus task ${x.focusTaskId} canceled.`);throw O.name="DeprecatedTaskError",O}1===i._focusParameters.isDoingFocus&&Date.now()-x.timeStart>i._focusParameters.focusCancelableTime&&(i._focusParameters.isDoingFocus=-1)};let o;n=Xt(n,i._focusParameters.fds.min,i._focusParameters.fds.step,i._focusParameters.fds.max),yield i._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]}),r(e),o=null==i._focusParameters.oldDistance?i._focusParameters.kTimeout*Math.max(Math.abs(1/i._focusParameters.fds.min-1/n),Math.abs(1/i._focusParameters.fds.max-1/n))+i._focusParameters.minTimeout:i._focusParameters.kTimeout*Math.abs(1/i._focusParameters.oldDistance-1/n)+i._focusParameters.minTimeout,i._focusParameters.oldDistance=n,yield new Promise(x=>{setTimeout(x,o)}),r(e);let s=e.focusL-e.focusW/2,u=e.focusT-e.focusH/2,g=e.focusW,v=e.focusH;if(s>=i.video.videoWidth||u>=i.video.videoHeight)throw new Error("Invalid area.");s+g>i.video.videoWidth&&(g=i.video.videoWidth-s),u+v>i.video.videoHeight&&(v=i.video.videoHeight-u);const w=i._getImageData(i.video,i.video.videoWidth,i.video.videoHeight,{sx:s,sy:u,sWidth:g,sHeight:v,dWidth:g,dHeight:v},null,{pixelFormat:Ne.RGBA});if(!w)return i._setFocusAndGetContract(e,n);const b=w.data;let I=0;for(let x=0,O=b.length-8;x<O;++x){let R=b[x]-b[x+8];++x;let P=b[x]-b[x+8];++x;let V=b[x]-b[x+8];++x,I+=R*R+P*P+V*V}return-I})()}_doFocusDetail(e,n,i,r,o,s,u){var g=this;return ne(function*(){let v;if(n=Xt(n,g._focusParameters.fds.min,g._focusParameters.fds.step,g._focusParameters.fds.max),r=Xt(r,g._focusParameters.fds.min,g._focusParameters.fds.step,g._focusParameters.fds.max),s?s=Xt(s,g._focusParameters.fds.min,g._focusParameters.fds.step,g._focusParameters.fds.max):(s=Xt(Math.sqrt((n||g._focusParameters.fds.step)*(r||g._focusParameters.fds.step)),g._focusParameters.fds.min,g._focusParameters.fds.step,g._focusParameters.fds.max),u=yield g._setFocusAndGetContract(e,s)),u<=i&&u<=o?v=3:i<o&&i<u?v=1:o<i&&o<u&&(v=2),(r-n)/2<=g._focusParameters.fds.step)return 3===v||(1===v?yield g._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]}):2===v&&(yield g._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}))),!0;if(1===v)return yield g._doFocusDetail(e,n,i,s,u);if(2===v)return yield g._doFocusDetail(e,s,u,r,o);if(3!==v)return i=yield g._setFocusAndGetContract(e,n),o=yield g._setFocusAndGetContract(e,r),yield g._doFocusDetail(e,n,i,r,o);let w=Xt(Math.sqrt((n||g._focusParameters.fds.step)*(s||g._focusParameters.fds.step)),g._focusParameters.fds.min,g._focusParameters.fds.step,g._focusParameters.fds.max),b=Xt(Math.sqrt((r||g._focusParameters.fds.step)*(s||g._focusParameters.fds.step)),g._focusParameters.fds.min,g._focusParameters.fds.step,g._focusParameters.fds.max);if(Math.abs(1/g._focusParameters.oldDistance-1/w)<=Math.abs(1/g._focusParameters.oldDistance-1/b)){let I=yield g._setFocusAndGetContract(e,w);if(I<u)return yield g._doFocusDetail(e,n,i,s,u,w,I);if(I==u)return yield g._doFocusDetail(e,w,I,s,u);let x=yield g._setFocusAndGetContract(e,b);if(I>u&&u<x)return yield g._doFocusDetail(e,w,I,b,x,s,u);if(u==x)return yield g._doFocusDetail(e,s,u,b,x);if(u>x)return yield g._doFocusDetail(e,s,u,r,o,b,x)}else{let I=yield g._setFocusAndGetContract(e,b);if(u>I)return yield g._doFocusDetail(e,s,u,r,o,b,I);if(u==I)return yield g._doFocusDetail(e,s,u,b,I);let x=yield g._setFocusAndGetContract(e,w);if(x>u&&u<I)return yield g._doFocusDetail(e,w,x,b,I,s,u);if(x==u)return yield g._doFocusDetail(e,w,x,s,u);if(x<u)return yield g._doFocusDetail(e,n,i,s,u,w,x)}return!1})()}_setLocalFocus(e,n,i,r,o){var s=this;return ne(function*(){if(1==s._focusParameters.isDoingFocus)return!1;if(!e||"string"!=typeof e.x||"string"!=typeof e.y)throw new Error("Invalid centerPoint.");if(!n||"string"!=typeof n)throw new Error("Invalid width.");if(!i||"string"!=typeof i)throw new Error("Invalid height.");const u=s._video.videoWidth,g=s._video.videoHeight;let v=0,w=0;if(e.x.endsWith("px"))v=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid centerPoint.");v=parseFloat(e.x)/100*u}if(e.y.endsWith("px"))w=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid centerPoint.");w=parseFloat(e.y)/100*g}if(NaN==v||NaN==w)throw new Error("Invalid centerPoint.");let b=0;if(n.endsWith("px"))b=parseFloat(n);else{if(!n.endsWith("%"))throw new Error("Invalid width.");b=parseFloat(n)/100*u}if(NaN==b)throw new Error("Invalid width.");let I=0;if(i.endsWith("px"))I=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid height.");I=parseFloat(i)/100*g}if(NaN==I)throw new Error("Invalid height.");if(1!==s._softwareScale){const R=s._softwareScale,P=s._scaleCenter;b/=R,I/=R,v=(1-1/R)*P.x+v/R,w=(1-1/R)*P.y+w/R}if(!s._focusSupported)throw new Error("Manual focus unsupported.");if(!s._focusParameters.fds&&(s._focusParameters.fds=(yield s.getCapabilities()).focusDistance,!s._focusParameters.fds))throw s._focusSupported=!1,new Error("Manual focus unsupported.");null==s._focusParameters.kTimeout&&(s._focusParameters.kTimeout=(s._focusParameters.maxTimeout-s._focusParameters.minTimeout)/(1/s._focusParameters.fds.min-1/s._focusParameters.fds.max)),s._focusParameters.isDoingFocus=1;const x={focusL:v,focusT:w,focusW:b,focusH:I,focusTaskId:++s._focusParameters.curFocusTaskId,timeStart:Date.now()},O=function(){var R=ne(function*(P,V,W){try{(null==V||V<s._focusParameters.fds.min)&&(V=s._focusParameters.fds.min),(null==W||W>s._focusParameters.fds.max)&&(W=s._focusParameters.fds.max),s._focusParameters.oldDistance=null;let L=Xt(Math.sqrt(W*(V||s._focusParameters.fds.step)),s._focusParameters.fds.min,s._focusParameters.fds.step,s._focusParameters.fds.max),X=Xt(Math.sqrt((V||s._focusParameters.fds.step)*L),s._focusParameters.fds.min,s._focusParameters.fds.step,s._focusParameters.fds.max),ee=Xt(Math.sqrt(L*W),s._focusParameters.fds.min,s._focusParameters.fds.step,s._focusParameters.fds.max),le=yield s._setFocusAndGetContract(P,ee),ye=yield s._setFocusAndGetContract(P,X),S=yield s._setFocusAndGetContract(P,L);if(ye>S&&S<le){const pe=yield s._doFocusDetail(P,X,ye,ee,le,L,S);return s._focusParameters.isDoingFocus=0,pe}if(ye<S&&ye<le){let pe=yield s._setFocusAndGetContract(P,V);const be=yield s._doFocusDetail(P,V,pe,L,S,X,ye);return s._focusParameters.isDoingFocus=0,be}if(S>le&&ye>le){let pe=yield s._setFocusAndGetContract(P,W);const be=yield s._doFocusDetail(P,L,S,W,pe,ee,le);return s._focusParameters.isDoingFocus=0,be}if(ye==S&&S<le){const pe=yield s._doFocusDetail(P,X,ye,L,S);return s._focusParameters.isDoingFocus=0,pe}if(S==le&&ye>S){const pe=yield s._doFocusDetail(P,L,S,ee,le);return s._focusParameters.isDoingFocus=0,pe}return O(P,V,W)}catch(L){if("DeprecatedTaskError"!==L.name)throw L}});return function(V,W,L){return R.apply(this,arguments)}}();return O(x,r,o)})()}enableTapToFocus(){var e=this;return ne(function*(){if(e._assertOpen(),e._isSingleFrameModeEnabled())throw new Error("'enableTapToFocus()' is unavailable in singleFrameMode.");if(!e._videoTrack)throw new Error("Video is not playing.");if(!e._focusSupported)throw new Error("Tapping to focus unsupported.");if(!e._focusParameters.fds&&(e._focusParameters.fds=(yield e.getCapabilities()).focusDistance,!e._focusParameters.fds))throw e._focusSupported=!1,e._tapFocusEnabled=!1,new Error("Tapping to focus unsupported.");e._tapFocusEnabled=!0})()}disableTapToFocus(){this._tapFocusEnabled=!1}isTapToFocusEnabled(){return this._tapFocusEnabled}_updateVideoContainerStyle(){if(!this._video||this._isSingleFrameModeEnabled())return;const e=this._getSoftwareScale(),n=this._videoContainer;if("contain"===this.videoFit&&e>1){const i=this._video.videoWidth,r=this._video.videoHeight,o=window.getComputedStyle(this._elContainer),s=parseFloat(o.width),u=parseFloat(o.height),g=i/r;if(s/u<g){let v=s/g;n.style.left="0",n.style.top=(u-v)/2/u*100+"%",n.style.width="100%",n.style.height=v/u*100+"%"}else{let v=u*g;n.style.left=(s-v)/2/s*100+"%",n.style.top="0",n.style.width=v/s*100+"%",n.style.height="100%"}}else n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%"}_scaleVideo(e,n){if(this._video&&!this._isSingleFrameModeEnabled()){if(e<1)throw new RangeError("Invalid scale value.");if(n&&this._setScaleCenter(n),1===e)this._video.style.transform="";else{const i=this.getVideoFit(),r=this._video.videoWidth,o=this._video.videoHeight,s=window.getComputedStyle(this._elContainer),u=parseFloat(s.width),g=parseFloat(s.height),v=u/g,w=r/o;let b=1;"contain"===i?b=v<w?u/(r/e):g/(o/e):"cover"===i&&(b=w>v?g/(r/e):u/(o/e)),this._video.style.transform=`translate(${b*(1-1/e)*(r/2-this._scaleCenter.x)}px, ${b*(1-1/e)*(o/2-this._scaleCenter.y)}px) scale(${e})`}this._updateVideoContainerStyle()}}getFrameSize(e,n,i,r){if(!e||!n)return null;let o,s,u,g,v=e,w=n;const b={regionLeft:0,regionTop:0,regionRight:v,regionBottom:w,regionMeasuredByPercentage:!1};i?(i.regionMeasuredByPercentage?(b.regionLeft=i.regionLeft*v/100,b.regionTop=i.regionTop*w/100,b.regionRight=i.regionRight*v/100,b.regionBottom=i.regionBottom*w/100):(b.regionLeft=i.regionLeft,b.regionTop=i.regionTop,b.regionRight=i.regionRight,b.regionBottom=i.regionBottom),o=Math.round(b.regionLeft),s=Math.round(b.regionTop),v=Math.round(b.regionRight-b.regionLeft),w=Math.round(b.regionBottom-b.regionTop)):(o=0,s=0,v=Math.round(v),w=Math.round(w));const I=Math.max(v,w);if(r&&r>0&&I>r){const x=r/I;v>w?(u=r,g=Math.round(w*x)):(u=Math.round(v*x),g=r)}else u=v,g=w;return u<=0||g<=0?null:{sx:o,sy:s,sWidth:v,sHeight:w,dWidth:u,dHeight:g}}getFrame(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoData()}getImage(){return this.getFrame()}_drawImage(e,n,i,r,o,s,u){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!i||!r)return null;if(n instanceof HTMLVideoElement&&4!==n.readyState||n instanceof HTMLImageElement&&!n.complete)throw new Error("The source is not loaded.");let g;ie._onLog&&(g=Date.now(),ie._onLog("DCE: _drawImage(), START: "+g));let v=0,w=0,b=i,I=r,x=0,O=0,R=i,P=r;o&&(o.sx&&(v=Math.round(o.sx)),o.sy&&(w=Math.round(o.sy)),o.sWidth&&(b=Math.round(o.sWidth)),o.sHeight&&(I=Math.round(o.sHeight)),o.dx&&(x=Math.round(o.dx)),o.dy&&(O=Math.round(o.dy)),o.dWidth&&(R=Math.round(o.dWidth)),o.dHeight&&(P=Math.round(o.dHeight)));let V=Ne.RGBA;u&&u.pixelFormat&&(V=u.pixelFormat);const W=e;if(!u||!u.bUseWebGL){ie._onLog&&ie._onLog("DCE: _drawImage() in context2d."),W.ctx2d||(W.ctx2d=W.getContext("2d",{willReadFrequently:!0}));const L=W.ctx2d;if(!L)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(W.width<x+R||W.height<O+P)&&(W.width=x+R,W.height=O+P),L.drawImage(n,v,w,b,I,x,O,R,P),ie._onLog&&ie._onLog("DCE: _drawImage() in context2d end. Costs: "+(Date.now()-g)),{context:L,pixelFormat:Ne.RGBA,_bUseWebGL:!1}}ie._onLog&&ie._onLog("DCE: _drawImage() in WebGL.");try{(W.width<x+R||W.height<O+P)&&(W.width=x+R,W.height=O+P,W.ctxWebGL&&W.ctxWebGL.viewport(0,0,x+R,O+P));const L=W.ctxWebGL||W.getContext("webgl",{antialias:!1})||W.getContext("experimental-webgl",{antialias:!1});if(!L){ie._onLog&&ie._onLog("DCE: WebGL unavailable.");const S=new Error("WebGL error: unable to initialize WebGL. Your browser or machine may not support it.");throw S.name="WebGLError",S}if(!W.ctxWebGL||V!==this.shaderPixelFormat){W.ctxWebGL=L;const S=a=>{const l=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,l),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),a.STATIC_DRAW);const f=a.createBuffer();return a.bindBuffer(a.ARRAY_BUFFER,f),a.bufferData(a.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),a.STATIC_DRAW),{positions:l,texCoords:f}},pe=a=>{const l=a.createTexture();return a.bindTexture(a.TEXTURE_2D,l),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),l},be=(a,l)=>{const f=a.createProgram();if(l.forEach(y=>a.attachShader(f,y)),a.linkProgram(f),!a.getProgramParameter(f,a.LINK_STATUS)){const y=new Error(`An error occured linking the program: ${a.getProgramInfoLog(f)}.`);throw y.name="WebGLError",y}return a.useProgram(f),f},Qe=(a,l,f)=>{const y=a.createShader(l);if(a.shaderSource(y,f),a.compileShader(y),!a.getShaderParameter(y,a.COMPILE_STATUS)){const m=new Error(`An error occured compiling the shader: ${a.getShaderInfoLog(y)}.`);throw m.name="WebGLError",m}return y},h="\n                        attribute vec2 a_position;\n                        attribute vec2 a_texCoord;\n    \n                        uniform mat3 u_matrix;\n                        uniform mat3 u_textureMatrix;\n    \n                        varying vec2 v_texCoord;\n                        void main(void) {\n                        gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);\n                        v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;\n                        }\n                    ";let c="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(V)&&(c=V.slice(0,3));const d=`\n                        precision mediump float;\n                        varying vec2 v_texCoord;\n                        uniform sampler2D u_image;\n                        uniform float uColorFactor;\n    \n                        void main() {\n                            vec4 sample = texture2D(u_image, v_texCoord);\n                            float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;\n                            gl_FragColor = vec4(sample.${c} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);\n                        }\n                    `,p=be(L,[Qe(L,L.VERTEX_SHADER,h),Qe(L,L.FRAGMENT_SHADER,d)]);this._webGLProgramInfo={program:p,attribLocations:{vertexPosition:L.getAttribLocation(p,"a_position"),texPosition:L.getAttribLocation(p,"a_texCoord")},uniformLocations:{uSampler:L.getUniformLocation(p,"u_image"),uColorFactor:L.getUniformLocation(p,"uColorFactor"),uMatrix:L.getUniformLocation(p,"u_matrix"),uTextureMatrix:L.getUniformLocation(p,"u_textureMatrix")}},this._webGLBuffers=S(L),this._webGLTexture=pe(L),this.shaderPixelFormat=V}const X=(S,pe,be)=>{S.bindBuffer(S.ARRAY_BUFFER,pe),S.enableVertexAttribArray(be),S.vertexAttribPointer(be,2,S.FLOAT,!1,0,0)},le=(S,pe,be,Qe)=>{S.clearColor(0,0,0,1),S.clearDepth(1),S.enable(S.DEPTH_TEST),S.depthFunc(S.LEQUAL),S.clear(S.COLOR_BUFFER_BIT|S.DEPTH_BUFFER_BIT),X(S,be.positions,pe.attribLocations.vertexPosition),X(S,be.texCoords,pe.attribLocations.texPosition),S.activeTexture(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,Qe),S.uniform1i(pe.uniformLocations.uSampler,0),S.uniform1f(pe.uniformLocations.uColorFactor,[Ne.GREY,Ne.GREY32].includes(V)?1:0);let h,c,d=Yt.translate(Yt.identity(),-1,-1);d=Yt.scale(d,2,2),d=Yt.scale(d,1/S.canvas.width,1/S.canvas.height),h=Yt.translate(d,x,O),h=Yt.scale(h,R,P),S.uniformMatrix3fv(pe.uniformLocations.uMatrix,!1,h),c=Yt.translate(Yt.identity(),v/i,w/r),c=Yt.scale(c,b/i,I/r),S.uniformMatrix3fv(pe.uniformLocations.uTextureMatrix,!1,c),S.drawArrays(S.TRIANGLES,0,6)};let ye;if(((S,pe,be)=>{const Qe=S.RGBA,h=S.RGBA,c=S.UNSIGNED_BYTE;S.bindTexture(S.TEXTURE_2D,this._webGLTexture),S.texImage2D(S.TEXTURE_2D,0,Qe,h,c,be)})(L,0,n),le(L,this._webGLProgramInfo,this._webGLBuffers,this._webGLTexture),s){if(s.length<R*P*4)throw new Error("Unexpected size of the 'bufferContainer'.");ye=s}else ye=new Uint8Array(R*P*4);if(L.readPixels(x,O,R,P,L.RGBA,L.UNSIGNED_BYTE,ye),255!==ye[3]){ie._onLog&&ie._onLog("DCE: WebGL drawing incorrect."),this._bWebGLSupported=!1;const S=new Error("WebGL error: incorrect WebGL drawing.");throw S.name="WebGLError",S}return ie._onLog&&ie._onLog("DCE: _drawImage() in WebGL end. Costs: "+(Date.now()-g)),{context:L,pixelFormat:V===Ne.GREY?Ne.GREY32:V,_bUseWebGL:!0}}catch(L){throw this._bWebGLSupported=!1,L.name="WebGLError",L}}_readCvsData(e,n,i){let r,o=0,s=0,u=e.canvas.width,g=e.canvas.height;if(n&&(n.x&&(o=n.x),n.y&&(s=n.y),n.width&&(u=n.width),n.height&&(g=n.height)),e instanceof WebGLRenderingContext){const v=e;if(i){if(i.length<u*g*4)throw new Error("Unexpected size of the 'bufferContainer'.");v.readPixels(o,s,u,g,v.RGBA,v.UNSIGNED_BYTE,i),r=new Uint8Array(i.buffer,0,u*g*4)}else r=new Uint8Array(u*g*4),v.readPixels(o,s,u,g,v.RGBA,v.UNSIGNED_BYTE,r)}else if(e instanceof CanvasRenderingContext2D){let v;if(v=e.getImageData(o,s,u,g),r=new Uint8Array(v.data.buffer),i){if(i.length<r.length)throw new Error("Unexpected size of the 'bufferContainer'.");i.set(r)}}return r}_transformPixelFormat(e,n,i,r){let o,s;if(ie._onLog&&(o=Date.now(),ie._onLog("DCE: _transformPixelFormat(), START: "+o)),n===i)return ie._onLog&&ie._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-o)),r?new Uint8Array(e):e;const u=[Ne.RGBA,Ne.RBGA,Ne.GRBA,Ne.GBRA,Ne.BRGA,Ne.BGRA];if(u.includes(n))if(i===Ne.GREY){s=new Uint8Array(e.length/4);for(let g=0;g<e.length;g+=4)s[g/4]=.21*e[g]+.71*e[g+1]+.07*e[g+2]}else if(i===Ne.GREY32){s=r?new Uint8Array(e):e;for(let g=0;g<e.length;g+=4){const v=.21*e[g]+.71*e[g+1]+.07*e[g+2];s[g]=v,s[g+1]=v,s[g+2]=v}}else{if(!u.includes(i))throw new Error("Unable to transform.");if(r){s=new Uint8Array(e);const g=n.indexOf("r"),v=n.indexOf("g"),w=n.indexOf("b"),b=i.indexOf("r"),I=i.indexOf("g"),x=i.indexOf("b");for(let O=0;O<e.length;O+=4)s[O+b]=e[O+g],s[O+I]=e[O+v],s[O+x]=e[O+w]}else{s=e;const g=n.indexOf("r"),v=n.indexOf("g"),w=n.indexOf("b"),b=i.indexOf("r"),I=i.indexOf("g"),x=i.indexOf("b");for(let O=0;O<e.length;O+=4){let R=[e[O],e[O+1],e[O+2]];s[O+b]=R[g],s[O+I]=R[v],s[O+x]=R[w]}}}else if(n===Ne.GREY){if(i!==Ne.GREY32)throw new Error("Unable to transform.");s=new Uint8Array(4*e.length);for(let g=0;g<e.length;g++)s[4*g]=e[g],s[4*g+1]=e[g],s[4*g+2]=e[g],s[4*g+3]=255}else{if(n!==Ne.GREY32)throw new Error("Unable to transform.");if(i!==Ne.GREY)throw new Error("Unable to transform.");s=new Uint8Array(e.length/4);for(let g=0;g<e.length;g+=4)s[g/4]=e[g]}return ie._onLog&&ie._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-o)),s}_getImageData(e,n,i,r,o,s){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!n||!i)return null;if(r.sx>n||r.sy>i||r.sx+r.sWidth>n||r.sy+r.sHeight>i)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&4!==e.readyState||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let u;ie._onLog&&(u=Date.now(),ie._onLog("DCE: _getImageData(), START: "+u));const g=Math.round(r.sx),v=Math.round(r.sy),w=Math.round(r.sWidth),b=Math.round(r.sHeight),I=Math.round(r.dWidth),x=Math.round(r.dHeight);let O=Ne.RGBA;s&&s.pixelFormat&&(O=s.pixelFormat);let R,P,V,W=this._bWebGLSupported;s&&0==s.bUseWebGL&&(W=!1),W?(this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),R=this._reusedWebGLCvs):(this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),R=this._reusedCvs);try{if(W)if(ie._onLog&&ie._onLog("DCE: _getImageData() in WebGL."),o)if(O===Ne.GREY){if(V=new Uint8Array(I*x*4),P=this._drawImage(R,e,n,i,{sx:g,sy:v,sWidth:w,sHeight:b,dWidth:I,dHeight:x},V,{pixelFormat:O,bUseWebGL:W}),V=this._transformPixelFormat(V,P.pixelFormat,O),o){if(o.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");o.set(V)}}else P=this._drawImage(R,e,n,i,{sx:g,sy:v,sWidth:w,sHeight:b,dWidth:I,dHeight:x},o,{pixelFormat:O,bUseWebGL:W}),V=new Uint8Array(o.buffer,0,I*x*4),V=this._transformPixelFormat(V,P.pixelFormat,O);else O===Ne.GREY?((!this._tempDataContainer||this._tempDataContainer.length<I*x*4)&&(this._tempDataContainer=new Uint8Array(I*x*4)),V=new Uint8Array(this._tempDataContainer.buffer,0,I*x*4)):V=new Uint8Array(I*x*4),P=this._drawImage(R,e,n,i,{sx:g,sy:v,sWidth:w,sHeight:b,dWidth:I,dHeight:x},V,{pixelFormat:O,bUseWebGL:W}),V=this._transformPixelFormat(V,P.pixelFormat,O);else if(ie._onLog&&ie._onLog("DCE: _getImageData() in context2d."),P=this._drawImage(R,e,n,i,{sx:g,sy:v,sWidth:w,sHeight:b,dWidth:I,dHeight:x},null,{pixelFormat:Ne.RGBA,bUseWebGL:W}),V=this._readCvsData(P.context,{width:I,height:x},null),V=this._transformPixelFormat(V,P.pixelFormat,O),o){if(o.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");o.set(V)}}catch(L){if("WebGLError"===L.name)return ie._onLog&&ie._onLog("DCE: _getImageData() in WebGL failed, try again in context2d."),this.forceLoseContext(),this._bWebGLSupported=!1,this._getImageData(e,n,i,{sx:g,sy:v,sWidth:w,sHeight:b,dWidth:I,dHeight:x},o,s);throw L}return ie._onLog&&ie._onLog("DCE: _getImageData() end. Costs: "+(Date.now()-u)),{data:V,pixelFormat:O,_bUseWebGL:P._bUseWebGL}}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._reusedWebGLCvs=null}_getVideoData(e,n){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getVideoData()' is unavailable in singleFrameMode.");if(!this._video||4!==this._video.readyState)return null;const i=Date.now();ie._onLog&&ie._onLog("DCE: _getVideoData() START: "+i);let r=this._scanRegion;n&&n.hasOwnProperty("region")&&(r=n.region);let o=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase());n&&n.pixelFormat&&(o=this.mapPixelFormatString_Enum.get(n.pixelFormat.toLowerCase()));let s=this._softwareScale;n&&n.scale&&(s=n.scale);const u=this._video.videoWidth,g=this._video.videoHeight;let v=this._scaleCenter;if(n&&n.scaleCenter){if("string"!=typeof n.scaleCenter.x||"string"!=typeof n.scaleCenter.y)throw new Error("Invalid scale center.");let R=0,P=0;if(n.scaleCenter.x.endsWith("px"))R=parseFloat(n.scaleCenter.x);else{if(!n.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");R=parseFloat(n.scaleCenter.x)/100*u}if(n.scaleCenter.y.endsWith("px"))P=parseFloat(n.scaleCenter.y);else{if(!n.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");P=parseFloat(n.scaleCenter.y)/100*g}if(NaN==R||NaN==P)throw new Error("Invalid scale center.");v.x=Math.round(R),v.y=Math.round(P)}if(0===u||0===g)return null;const w=this.getFrameSize(u,g,r,this.maxCvsSideLength);if(!w)return null;let b=!0;u===w.sWidth&&g===w.sHeight&&(b=!1);const I={data:null,region:r?JSON.parse(JSON.stringify(r)):null,sx:w.sx,sy:w.sy,width:w.dWidth,height:w.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:b,toCanvas:this._toCanvas,_sWidth:w.sWidth,_sHeight:w.sHeight,_bUseWebGL:null};1!==s&&(w.sWidth=Math.round(w.sWidth/s),w.sHeight=Math.round(w.sHeight/s),w.sx=Math.round((1-1/s)*v.x+w.sx/s),w.sy=Math.round((1-1/s)*v.y+w.sy/s));const x=this._getImageData(this._video,u,g,w,e,{pixelFormat:o});if(!x)return null;const O=Date.now();return ie._onLog&&ie._onLog("DCE: _getVideoData() END: "+O),I.data=x.data,I.pixelFormat=I.colorMode=x.pixelFormat,I._bUseWebGL=x._bUseWebGL,I.timeSpent=O-i,I.timeStamp=O,I.stride=x.pixelFormat===Ne.GREY?I.width:4*I.width,I}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.isDisposed&&this.disposed)return;if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();const n=()=>{ie._onLog&&ie._onLog("DCE: start fetching a frame into buffer: "+Date.now());const r=this.getCurrentRegion();let o=this._getVideoData(null,{region:r});if(!o)return void(ie._onLog&&ie._onLog("DCE: get a invalid frame, abandon it: "+Date.now()));for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(o),ie._onLog&&ie._onLog("DCE: finish fetching a frame into buffer: "+Date.now());const s=this.mapCameraEvents.get("frameaddedtobuffer");for(let u of s)u&&setTimeout(()=>{this.isDisposed&&this.disposed||u.apply(this)},0)},i=()=>{this.isDisposed&&this.disposed||(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout(()=>{this.isDisposed&&this.disposed||(this._bOpen&&this.isFetchingLoopStarted()?(ie._onLog&&ie._onLog("DCE: second timeout executes: "+Date.now()),n(),i()):this.stopFetchingLoop())},this.refreshInterval)))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(n(),this.refreshInterval>0&&i()):0===this.refreshInterval&&n()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._fetchingLoop(!0)},this.loopInterval)}startFetchingLoop(){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this._isSingleFrameModeEnabled())throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,this._recordedStates.fetchingLoopStart=!0,ie._onLog&&ie._onLog("DCE: start fetching loop: "+Date.now()),this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(ie._onLog&&ie._onLog("DCE: stop fetching loop: "+Date.now()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1,this._recordedStates.fetchingLoopStart=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.pop()):null}clearFrameBuffer(){this._frameQueue&&(this._frameQueue.length=0)}_createDrawingLayerBaseCvs(){let e;this._assertOpen();try{e=this._calculateCvsSize()}catch(s){throw s}let{width:n,height:i,objectFit:r}=e;(n<=0||i<=0)&&(n=2,i=2);const o=document.createElement("canvas");if(o.width==n&&o.height==i||(o.width=n,o.height=i),o.style.objectFit=r,this._cvsScanRegion)this._cvsScanRegion.after(o);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(o);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(o);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(o)}return o}_updateDrawingLayersSize(e){let n;try{n=e&&e.width&&e.height&&e.objectFit?{width:e.width,height:e.height,objectFit:e.objectFit}:this._calculateCvsSize()}catch(s){if("Invalid content dimensions."===(s.message||s))return;throw s}const{width:i,height:r,objectFit:o}=n;this._drawingLayersManager.setDimensions({width:i,height:r},{backstoreOnly:!0}),this._drawingLayersManager.setObjectFit(o)}_createDrawingLayer(e){return this._layerBaseCvs||(this._layerBaseCvs=this._createDrawingLayerBaseCvs()),this._drawingLayersManager.createDrawingLayer(this._layerBaseCvs,e)}deleteDrawingLayer(e){this._drawingLayersManager.deleteDrawingLayer(e),this._drawingLayersManager.getDrawingLayers().length||this._layerBaseCvs&&(this._layerBaseCvs.remove(),this._layerBaseCvs=null)}createDrawingLayer(){return this._createDrawingLayer()}getDrawingLayer(e){return this._drawingLayersManager.getDrawingLayer(e)||([1,2,3].includes(e)?this._createDrawingLayer(e):null)}getDrawingLayers(){return this._drawingLayersManager.getDrawingLayers().filter(e=>e.getId()>=0)}getSelectedDrawingItems(){return this._drawingLayersManager.getSelectedDrawingItems()}createDrawingStyle(e){return this._drawingLayersManager.createDrawingStyle(e)}getDrawingStyle(e){return this._drawingLayersManager.getDrawingStyle(e)}getDrawingStyles(){return this._drawingLayersManager.getDrawingStyles()}updateDrawingStyle(e,n){return this._drawingLayersManager.updateDrawingStyle(e,n)}clearDrawingLayers(){const e=this.getDrawingLayers();for(let n of e)this.deleteDrawingLayer(n.getId())}showTip(e,n,i,r,o=3e3,s=!0){this._assertOpen(),this._tipArgs.x=e,this._tipArgs.y=n,this._tipArgs.width=i,this._tipArgs.autoShowSuggestedTip=!!s,this._drawingLayerOfTip||(this._drawingLayerOfTip=this._createDrawingLayer(-1)),this._tipStyleId||(this._tipStyleId=this.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip.clearDrawingItems();const u=new H_(r||"",e,n,i,this._tipStyleId);u._fabricObject.paddingTop=15,u._fabricObject.calcTextHeight=function(){for(var g=0,v=0,w=this._textLines.length;v<w;v++)g+=this.getHeightOfLine(v);return g+2*this.paddingTop},u._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},u.setAttribute("backgroundColor","rgba(50, 50, 52, .8)"),u.setAttribute("lineHeight",1.3),u.setAttribute("textAlign","center"),this._drawingLayerOfTip.addDrawingItem(u),this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._tipArgs.duration=void 0===o?3e3:o,this._tipArgs.duration>0&&(this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}_hideTip(){this._drawingLayerOfTip&&(this.deleteDrawingLayer(this._drawingLayerOfTip.getId()),this._drawingLayerOfTip=null,this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId))}hideTip(){this._hideTip(),this._tipArgs.x=null,this._tipArgs.y=null,this._tipArgs.width=null,this._tipArgs.autoShowSuggestedTip=null}updateTipMessage(e){if(!this._drawingLayerOfTip)throw new Error("The Tip is not showing.");this._drawingLayerOfTip.getDrawingItems()[0].setAttribute("text",e),this._drawingLayerOfTip.renderAll(),this._tipArgs.duration>0&&(this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}suggestTip(e,n){this._tipArgs.autoShowSuggestedTip&&(this._drawingLayerOfTip?this.updateTipMessage(n):void 0!==this._tipArgs.x&&this.showTip(this._tipArgs.x,this._tipArgs.y,this._tipArgs.width,n,this._tipArgs.duration)),this.onTipSuggested&&setTimeout(()=>{this.isDisposed&&this.disposed||this.onTipSuggested.apply(this,[e,n])},0)}_createControler(){if(this._controler||(this._controler=new jx(this)),this._controler)return this._controler}_destroyControler(){this._controler=null}setOriginalImage(e,n,i){if(!e||!n||!i)throw new Error("Invalid arguments");this._originalImageData={imageData:e,width:n,height:i};let r=this._cvsOriginalImage;r||(r=document.createElement("canvas"),r.style.position="absolute",r.style.width="100%",r.style.height="100%",r.style.left="0",r.style.top="0",r.style.backgroundColor="white",r.style.objectFit="contain",this._cvsOriginalImage=r),r.width===n&&r.height===i||(r.width=n,r.height=i);const o=r.getContext("2d");o.clearRect(0,0,r.width,r.height),e instanceof Uint8Array||e instanceof Uint8ClampedArray?(e instanceof Uint8Array&&(e=new Uint8ClampedArray(e.buffer)),o.putImageData(new ImageData(e,n,i),0,0)):e instanceof HTMLCanvasElement&&o.drawImage(e,0,0),document.body.contains(r)&&""===r.style.display&&this._updateDrawingLayersSize({width:n,height:i,objectFit:"contain"})}getOriginalImage(){return this._originalImageData?Object.assign({},this._originalImageData):null}deleteOriginalImage(){var e=this;return ne(function*(){yield e.hideOriginalImage(),e._cvsOriginalImage&&(e._cvsOriginalImage.remove(),e._cvsOriginalImage=null),e._originalImageData=null})()}_showOriginalImageCvs(){this._cvsOriginalImage&&"none"==this._cvsOriginalImage.style.display&&(this._cvsOriginalImage.style.display="")}_hideOriginalImageCvs(){this._cvsOriginalImage&&(this._cvsOriginalImage.style.display="none")}showOriginalImage(){if(!this._originalImageData)throw new Error("No original image is set.");const e=this._cvsOriginalImage;if(""===e.style.display&&document.body.contains(e))return;const{width:n,height:i}=this._originalImageData;if(this._updateDrawingLayersSize({width:n,height:i,objectFit:"contain"}),this._bOpen&&(this._video&&!this._video.paused&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._recordedStates.fetchingLoopStart=!0),this.ifShowScanRegionMask&&this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this.ifShowScanRegionLaser&&this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none"),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none"),this._selCam&&(this._selCam.parentElement.style.display="none")),!document.body.contains(e))if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(e)}this._showOriginalImageCvs()}_hideOriginalImage(e){var n=this;return ne(function*(){n._originalImageData&&n._cvsOriginalImage&&"none"!==n._cvsOriginalImage.style.display&&(n._updateDrawingLayersSize(),n._bOpen&&e&&(n._video&&n._recordedStates.videoPlaying&&(yield n.play(null,null,null,{notTriggerSingleFrameClick:!0})),n._recordedStates.fetchingLoopStart&&!n._isSingleFrameModeEnabled()&&n.startFetchingLoop(),n.ifShowScanRegionMask&&n._cvsScanRegion&&n._recordedStates.maskShow&&n.showScanRegionMask(),n.ifShowScanRegionLaser&&n._divScanLight&&n._recordedStates.laserShow&&n.showScanRegionLaser(),n._cvsViewDecorator&&n._recordedStates.decoratorShow&&n.showViewDecorator(),n._scanRegionOverlayContainer&&n._recordedStates.overlayShow&&n.showScanRegionOverlays()),n._selCam&&(n._selCam.parentElement.style.display=""),n._hideOriginalImageCvs())})()}hideOriginalImage(){var e=this;return ne(function*(){return e._hideOriginalImage(!0)})()}transformCoord(e){if(!this.isOpen())throw new Error("Unavailable when the camera is not open.");if(this._isSingleFrameModeEnabled()&&!this._cvsSingleFrameMode)throw new Error("No image is selected. ");const n=this._elContainer.getBoundingClientRect();let i,r,o,s,u,g=n.left,v=n.top,w=g+window.scrollX,b=v+window.scrollY;this._isSingleFrameModeEnabled()?(i=this._cvsSingleFrameMode.width,r=this._cvsSingleFrameMode.height,o=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).width),s=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).height),u="contain"):(i=this.video.videoWidth,r=this.video.videoHeight,o=parseFloat(window.getComputedStyle(this._elContainer).width),s=parseFloat(window.getComputedStyle(this._elContainer).height),u=this.videoFit);const I=o/s,x=i/r;let O,R,P,V,W=1;if("contain"===u)I<x?(W=o/i,O=g+e.x*W,R=v+e.y*W+(s-r*W)/2,P=w+e.x*W,V=b+e.y*W+(s-r*W)/2):(W=s/r,O=g+e.x*W+(o-i*W)/2,R=v+e.y*W,P=w+e.x*W+(o-i*W)/2,V=b+e.y*W);else if("cover"===u)if(I<x){W=s/r;let L=e.x*W-(i*W-o)/2;L=Math.max(L,0),L=Math.min(L,o),O=g+L,R=v+e.y*W,P=w+L,V=b+e.y*W}else{W=o/i;let L=e.y*W-(r*W-s)/2;L=Math.max(L,0),L=Math.min(L,s),O=g+e.x*W,R=v+L,P=w+e.x*W,V=b+L}return{clientX:O,clientY:R,pageX:P,pageY:V}}convertToPageCoordinates(e){const n=this.transformCoord(e);return{x:n.pageX,y:n.pageY}}convertToClientCoordinates(e){const n=this.transformCoord(e);return{x:n.clientX,y:n.clientY}}dispose(e){this.UIElement&&(this.UIElement.style.display=this._uiOriginalState&&this._uiOriginalState.inDom?this._uiOriginalState.display:"none"),this.clearDrawingLayers(),this.close(),this.forceLoseContext(),this.setViewDecorator(null,null),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.remove(),this._arrScanRegionOverlays.length=0,e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null;for(let n in this)delete this[n];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"isDisposed",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}ie._jsVersion="3.3.9",ie._jsEditVersion="20231205",ie._version="JS "+ie._jsVersion+"."+ie._jsEditVersion,ie.browserInfo=Je,ie._hasEngineResourceLoaded=!1,ie._engineResourcePath=kx,ie._defaultUIElementURL="@engineResourcePath/dce.ui.html";const Vx={DT_Arc:class extends $t{constructor(t,e,n,i,r,o){super(new Le.Circle({left:t,top:e,radius:n,startAngle:i,endAngle:r}),o),this._mediaType="arc"}},DT_Polygon:V_,DT_Rect:class extends $t{constructor(t,e,n,i,r){super(new Le.Rect({left:t,top:e,width:n,height:i}),r)}},DT_Image:class extends $t{constructor(t,e,n,i){super(new Le.Image(t,{left:e,top:n}),i),this.image=t}_extendSet(t,e){if("image"===t){if(e instanceof HTMLImageElement)return this._fabricObject.setElement(e),this.image=e,!0;if(e instanceof HTMLCanvasElement){const n=new Image;return n.src=e.toDataURL(),this._fabricObject.setElement(n),this.image=e,!0}throw new Error("Unsupported value.")}}_extendGet(t){if("image"===t)return this.image}},DT_Text:H_,DT_Line:class extends V_{constructor(t,e,n){super([t,e],n),this._mediaType="line"}_extendSet(t,e){if("startPoint"===t||"endPoint"===t){e="startPoint"===t?[e,this.get("endPoint")]:[this.get("startPoint"),e];const n=this._fabricObject;if(n.group){const r=n.group;n.points=e.map(o=>({x:o.x-r.left-r.width/2,y:o.y-r.top-r.height/2})),r.addWithUpdate()}else n.points=e;const i=n.points.length-1;return n.controls=n.points.reduce(function(r,o,s){return r["p"+s]=new Le.Control({positionHandler:yu,actionHandler:wu(s>0?s-1:i,Cu),actionName:"modifyPolygon",pointIndex:s}),r},{}),n._setPositionDimensions({}),!0}}_extendGet(t){if("startPoint"===t||"endPoint"===t){const e=[],n=this._fabricObject;if(n.selectable&&!n.group)for(let i in n.oCoords)e.push({x:n.oCoords[i].x,y:n.oCoords[i].y});else for(let i of n.points){const s=Le.util.transformPoint({x:i.x-n.pathOffset.x,y:i.y-n.pathOffset.y},n.calcTransformMatrix());e.push({x:s.x,y:s.y})}return"startPoint"===t?e[0]:e[1]}}},DT_Group:class extends $t{constructor(t){super(new Le.Group(t.map(e=>e._getFabricObject()))),this._fabricObject.on("selected",()=>{this.styleSelector="selected";const e=this._fabricObject._objects;for(let n of e)setTimeout(()=>{n&&n.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.styleSelector="default";const e=this._fabricObject._objects;for(let n of e)setTimeout(()=>{n&&n.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)})}getChildItems(){return this._fabricObject._objects.map(t=>t.getDrawingItem())}addChildItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"add"):this._fabricObject.addWithUpdate(t._getFabricObject())}removeChildItem(t){t&&t.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"remove"):this._fabricObject.removeWithUpdate(t._getFabricObject()))}}};function Ux(t,e,n){return(n.x-t.x)*(e.y-t.y)==(e.x-t.x)*(n.y-t.y)&&Math.min(t.x,e.x)<=n.x&&n.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=n.y&&n.y<=Math.max(t.y,e.y)}function Su(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function ta(t,e,n,i){let r=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]),o=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]);return!((r^o)>=0&&0!==r&&0!==o||(r=n[0]*(t[1]-i[1])+i[0]*(n[1]-t[1])+t[0]*(i[1]-n[1]),o=n[0]*(e[1]-i[1])+i[0]*(n[1]-e[1])+e[0]*(i[1]-n[1]),(r^o)>=0&&0!==r&&0!==o))}var bu,Du,G_,W_,z_,$_,Y_,X_,q_,Z_,K_,J_,Q_,ev,tv,nv,iv,rv,ov,sv,av,lv,cv,uv,dv,hv,fv,gv;class qt extends B{constructor(){super(),this._barcodeFillStyle="rgba(254,180,32,0.3)",this._barcodeStrokeStyle="rgba(254,180,32,0.9)",this._barcodeLineWidth=1,this._barcodeFillStyleBeforeVerification="rgba(248,252,0,0.2)",this._barcodeStrokeStyleBeforeVerification="transparent",this._barcodeLineWidthBeforeVerification=2,this.bFilterRegionInJs=!0,this._onPlayed=null}static set _onLog(e){(function(n,i,r,o,s){if("function"==typeof i?n!==i||!s:!i.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");s?s.value=r:i.set(n,r)})(qt,bu,e,0,Du),ie._onLog=e}static get _onLog(){return function(e,n,i,r){if("function"==typeof n?e!==n||!r:!n.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r?r.value:n.get(e)}(qt,bu,0,Du)}static get version(){return this._version+`(DCE ${ie.getVersion()})`}static _fireHTTPSWarnning(){qt.onWarning&&location&&"https:"!==location.protocol&&setTimeout(()=>{qt.onWarning&&qt.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}static testCameraAccess(){return ne(function*(){return ie.testCameraAccess()})()}_fireResolutionWarning(){if(!this.singleFrameMode&&this.onWarning&&this.dce.isOpen()){const e=this.dce.getConstraints();e&&e.width<1280&&e.height<720&&setTimeout(()=>{this.onWarning&&this.onWarning({id:3,message:"Camera resolution too low, please use a higher resolution (720P or better)."})},0)}}getUIElement(){return this.dce.getUIElement()}setUIElement(e){var n=this;return ne(function*(){yield n.dce.setUIElement(e)})()}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){var n=this;if("boolean"!=typeof e&&!["image","camera"].includes(e))throw new Error("Invalid value.");this.dce.singleFrameMode=e,e&&(this.dce.ifShowScanRegionLaser=!1,ne(function*(){let i=yield n.getScanSettings();i.oneDTrustFrameCount=1,yield n.updateScanSettings(i)})())}get onUnduplicatedRead(){return this.onUniqueRead}set onUnduplicatedRead(e){this.onUniqueRead=e}get video(){return this.dce&&this.dce.video}set videoSrc(e){this.dce&&(this.dce.videoSrc=e)}get videoSrc(){return this.dce&&this.dce.videoSrc}set onTipSuggested(e){this.dce&&(this.dce.onTipSuggested=e)}get onTipSuggested(){return this.dce&&this.dce.onTipSuggested}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}set barcodeFillStyle(e){this._barcodeFillStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{fillStyle:e})}get barcodeFillStyle(){return this._barcodeFillStyle}set barcodeStrokeStyle(e){this._barcodeStrokeStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{strokeStyle:e})}get barcodeStrokeStyle(){return this._barcodeStrokeStyle}set barcodeLineWidth(e){this._barcodeLineWidth=e,this.dce&&this.dce.updateDrawingStyle(3,{lineWidth:e})}get barcodeLineWidth(){return this._barcodeLineWidth}set barcodeFillStyleBeforeVerification(e){this._barcodeFillStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{fillStyle:e})}get barcodeFillStyleBeforeVerification(){return this._barcodeFillStyleBeforeVerification}set barcodeStrokeStyleBeforeVerification(e){this._barcodeStrokeStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{strokeStyle:e})}get barcodeStrokeStyleBeforeVerification(){return this._barcodeStrokeStyleBeforeVerification}set barcodeLineWidthBeforeVerification(e){this._barcodeLineWidthBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{lineWidth:e})}get barcodeLineWidthBeforeVerification(){return this._barcodeLineWidthBeforeVerification}set regionMaskFillStyle(e){this.dce.setScanRegionMaskStyle({fillStyle:e})}get regionMaskFillStyle(){return this.dce.regionMaskFillStyle}set regionMaskStrokeStyle(e){this.dce.setScanRegionMaskStyle({strokeStyle:e})}get regionMaskStrokeStyle(){return this.dce.regionMaskStrokeStyle}set regionMaskLineWidth(e){this.dce.setScanRegionMaskStyle({lineWidth:e})}get regionMaskLineWidth(){return this.dce.regionMaskLineWidth}set region(e){this._region=e,this.dce&&(e?e instanceof Array||this.dce.setScanRegion(e):this.dce.setScanRegion(null)),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e,this.dce.framePixelFormat=e?"rgba":"grey"}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}createDCEInstance(){var e=this;return ne(function*(){e.dce||(B._onLog&&B._onLog("createDCEInstance()"),ie.defaultUIElementURL=null,e.dce=yield ie.createInstance(),e.dce.refreshInterval=200,e.dce.framePixelFormat="grey",e.dce.maxCvsSideLength=e.maxCvsSideLength,e._drawingItemNamespace=Vx,["iPhone","iPad","Android","HarmonyOS"].includes(B.browserInfo.OS)||e.dce.setResolution(1920,1080),e._styleIdBeforeVerification=e.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"}),e.barcodeLineWidth=e._barcodeLineWidth,e.dce.on("cameraChange",()=>{e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null),e.array_decodeFrameTimeCost.length=0,e.array_getFrameTimeCost.length=0,e._intervalGetVideoFrame=0}),e.dce.on("resolutionChange",()=>{e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null),e.array_decodeFrameTimeCost.length=0,e.array_getFrameTimeCost.length=0,e._intervalGetVideoFrame=0}),e.dce.on("cameraClose",()=>{e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null),e.array_decodeFrameTimeCost.length=0,e.array_getFrameTimeCost.length=0,e._intervalGetVideoFrame=0,e._bPauseScan=!1}),e.dce.on("singleFrameAcquired",function(){var n=ne(function*(i){if(!i||!i.data)return;let r;e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null),e.ifSaveOriginalImageInACanvas&&(e.oriCanvas=null,e.oriCanvasData={width:i.width,height:i.height,pixelFormat:i.pixelFormat,data:new Uint8Array(i.data),toCanvas:i.toCanvas});const{data:o,sx:s,sy:u,width:g,height:v,stride:w,pixelFormat:b,timeStamp:I,_sWidth:x,_sHeight:O}=i,R={timeStamp:I};if("grey"===b)r=yield e._decodeBuffer_Uint8Array(o,g,v,w,Ze.IPF_GrayScaled,0,R);else if("rgba"===b)r=yield e._decodeBuffer_Uint8Array(o,g,v,w,Ze.IPF_ABGR_8888,0,R);else{if("bgra"!==b)throw new Error(`Pixel format '${b}' is not supported.`);r=yield e._decodeBuffer_Uint8Array(o,g,v,w,Ze.IPF_ARGB_8888,0,R)}if(yield e.clearMapDecodeRecord(),B.recalculateResultLocation(r,s,u,x,O,g,v),e._drawResults(r),e.onFrameRead&&e.isOpen()&&!e._bPauseScan){let P=e._cloneDecodeResults(r);e.onFrameRead(P)}if(e.onUniqueRead&&e.isOpen()&&!e._bPauseScan)for(let P of r)e.onUniqueRead(P.barcodeText,e._cloneDecodeResults(P))});return function(i){return n.apply(this,arguments)}}()))})()}set maxCvsSideLength(e){this._maxCvsSideLength=e,this.dce.maxCvsSideLength=e}get maxCvsSideLength(){return this._maxCvsSideLength}static createInstance(e){return ne(function*(){const n=new qt;n._instanceID=yield qt.createInstanceInWorker(!0),yield n.createDCEInstance(),"string"==typeof e&&(e=JSON.parse(e));for(let i in e)n[i]=e[i];return yield n.dce.setUIElement(qt.defaultUIElementURL),n.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),qt._fireHTTPSWarnning(),n.singleFrameMode||(yield n.updateRuntimeSettings("single")),n})()}decodeCurrentFrame(e){var n=this;return ne(function*(){n._assertOpen();let i=null;e&&e.region&&(i=e.region);const r=n.dce._getVideoData(null,{region:i});return n._decode_DCEFrame(r)})()}updateRuntimeSettings(e){var n=this;return ne(function*(){let i;if("string"==typeof e)if("speed"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,r.region&&(i.region=r.region),i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9}else if("balance"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,r.region&&(i.region=r.region),i.expectedBarcodesCount=512,i.deblurLevel=3,i.localizationModes=[2,16,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if("coverage"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,r.region&&(i.region=r.region),i.expectedBarcodesCount=512,i.deblurLevel=5,i.scaleDownThreshold=1e5,i.localizationModes=[2,16,4,8,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if("single"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,r.region&&(i.region=r.region)}else if("dense"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),n.maxCvsSideLength=4096,i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,r.region&&(i.region=r.region),i.expectedBarcodesCount=0,i.deblurLevel=7,i.scaleDownThreshold=1e5,i.localizationModes=[2,8,0,0,0,0,0,0],i.minResultConfidence=0,i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if("distance"==e){let r=yield n.getRuntimeSettings();yield n.resetRuntimeSettings(),n.maxCvsSideLength=4096,i=yield n.getRuntimeSettings(),i.barcodeFormatIds=r.barcodeFormatIds,i.barcodeFormatIds_2=r.barcodeFormatIds_2,r.region&&(i.region=r.region),i.expectedBarcodesCount=0,i.scaleDownThreshold=1e5,i.localizationModes=[2,8,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else i=JSON.parse(e);else{if("object"!=typeof e)throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(e)),i.region instanceof Array){let r=e.region;[r.regionLeft,r.regionTop,r.regionLeft,r.regionBottom,r.regionMeasuredByPercentage].some(o=>void 0!==o)&&(i.region={regionLeft:r.regionLeft||0,regionTop:r.regionTop||0,regionRight:r.regionRight||0,regionBottom:r.regionBottom||0,regionMeasuredByPercentage:r.regionMeasuredByPercentage||0})}}if(!B._bUseFullFeature){if(i.barcodeFormatIds&~(zt.BF_ONED|zt.BF_QR_CODE|zt.BF_PDF417|zt.BF_DATAMATRIX)||0!=i.barcodeFormatIds_2)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(0!=i.intermediateResultTypes)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let r=i.region;if(n.userDefinedRegion=n.bFilterRegionInJs?JSON.parse(JSON.stringify(r)):null,r instanceof Array)if(r.length){for(let o=0;o<r.length;++o){let s=r[o];s&&((s.regionLeft||s.regionTop||s.regionRight||s.regionBottom||s.regionMeasuredByPercentage)&&(s.regionLeft||s.regionTop||100!=s.regionRight||100!=s.regionBottom||!s.regionMeasuredByPercentage)||(r[o]=null))}n.region=r}else n.region=null;else n.region=r&&(r.regionLeft||r.regionTop||r.regionRight||r.regionBottom||r.regionMeasuredByPercentage)&&(r.regionLeft||r.regionTop||100!=r.regionRight||100!=r.regionBottom||!r.regionMeasuredByPercentage)?r:null;n.bFilterRegionInJs&&(i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}(n.autoZoom||n.autoFocus)&&(i.intermediateResultTypes|=sr.IRT_TYPED_BARCODE_ZONE),yield new Promise((r,o)=>{let s=B._nextTaskID++;B._taskCallbackMap.set(s,u=>{if(u.success){try{n._handleRetJsonString(u.updateReturn)}catch(g){o(g)}return r()}{let g=new Error(u.message);return g.stack=u.stack+"\n"+g.stack,o(g)}}),B._dbrWorker.postMessage({type:"updateRuntimeSettings",id:s,instanceID:n._instanceID,body:{settings:JSON.stringify(i)}})}),"string"==typeof e&&["speed","balance","coverage","dense","distance"].includes(e)&&(yield n.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","1"),yield n.setModeArgument("BinarizationModes",0,"BlockSizeX","0"),yield n.setModeArgument("BinarizationModes",0,"BlockSizeY","0"))})()}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}set onPlayed(e){this.dce.off("played",this._onPlayed),this._onPlayed=e,this.dce.on("played",this._onPlayed)}get onPlayed(){return this._onPlayed}getAllCameras(){var e=this;return ne(function*(){return e.dce.getAllCameras()})()}getCurrentCamera(){var e=this;return ne(function*(){return e.dce.getSelectedCamera()})()}setCurrentCamera(e){var n=this;return ne(function*(){const i=yield n.dce.selectCamera(e);return n._fireResolutionWarning(),i})()}getResolution(){return this.dce.getResolution()}setResolution(e,n){var i=this;return ne(function*(){const r=yield i.dce.setResolution(e,n);return i._fireResolutionWarning(),r})()}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}setVideoFit(e){return this.dce&&this.dce.setVideoFit(e)}getVideoFit(){return this.dce&&this.dce.getVideoFit()}set ifShowScanRegionMask(e){this.dce&&(this.dce.ifShowScanRegionMask=e)}get ifShowScanRegionMask(){return this.dce&&this.dce.ifShowScanRegionMask}set ifSaveLastUsedCamera(e){this.dce&&(this.dce.ifSaveLastUsedCamera=e)}get ifSaveLastUsedCamera(){return this.dce&&this.dce.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){this.dce&&(this.dce.ifSkipCameraInspection=e)}get ifSkipCameraInspection(){return this.dce&&this.dce.ifSkipCameraInspection}stop(){this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.dce.stop(),this.dce.ifShowScanRegionLaser=!1,this.dce.hideViewDecorator(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this.dce.pause()}play(e,n,i){var r=this;return ne(function*(){r.dce.ifShowScanRegionLaser=!0;const o=yield r.dce.play(e,n,i);return r._fireResolutionWarning(),o})()}pauseScan(e){this._assertOpen(),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce.ifShowScanRegionLaser=!1,this.dce.stopFetchingLoop()}resumeScan(){this._assertOpen(),this._bPauseScan=!1,this.dce.ifShowScanRegionLaser=!0}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}applyConstraints(e){var n=this;return ne(function*(){return n.dce.applyConstraints(e)})()}turnOnTorch(){var e=this;return ne(function*(){return e.dce.turnOnTorch()})()}turnOffTorch(){var e=this;return ne(function*(){return e.dce.turnOffTorch()})()}setColorTemperature(e){var n=this;return ne(function*(){return n.dce.setColorTemperature(e)})()}getColorTemperature(){return this.dce.getColorTemperature()}setExposureCompensation(e){var n=this;return ne(function*(){return n.dce.setExposureCompensation(e)})()}getExposureCompensation(){return this.dce.getExposureCompensation()}setZoom(e){var n=this;return ne(function*(){return n.dce.setZoom(e)})()}getZoomSettings(){return this.dce.getZoomSettings()}resetZoom(){return this.dce.resetZoom()}setFrameRate(e){var n=this;return ne(function*(){return n.dce.setFrameRate(e)})()}getFrameRate(){return this.dce.getFrameRate()}setFocus(e,n){var i=this;return ne(function*(){return i.dce.setFocus(e,n)})()}getFocus(){return this.dce.getFocus()}getFocusSettings(){return this.dce.getFocusSettings()}_loopReadVideo(){var e=this;return ne(function*(){if(e.bDestroyed)return e.dce&&e.dce.stopFetchingLoop(),e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),void e._drawResults(null);if(!e.isOpen())return e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null),void(yield e.clearMapDecodeRecord());if(!e.dce.video||e.dce.video.paused||e._bPauseScan)return B._onLog&&B._onLog("Video or scan is paused. Ask in 1s."),yield e.clearMapDecodeRecord(),e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),void(e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},e._intervalDetectVideoPause));B._onLog&&B._onLog("======= once read ======="),B._onLog&&(e._timeStartDecode=Date.now());const n=e._getVideoFrame();if(!n)return B._onLog&&B._onLog("Get invalid frame."),e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._drawResults(null),e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),void(e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},0));ne(function*(){n._bUseWebGL||"grey"!==n.pixelFormat||(e.dce.framePixelFormat="rgba");let i=[];e.ifSaveOriginalImageInACanvas&&(e.oriCanvas=null,e.oriCanvasData={width:n.width,height:n.height,pixelFormat:n.pixelFormat,data:new Uint8Array(n.data),toCanvas:n.toCanvas});const{data:r,sx:o,sy:s,width:u,height:g,stride:v,pixelFormat:w,timeStamp:b,_sWidth:I,_sHeight:x}=n,O={timeStamp:b};if("grey"===w)i=yield e._decodeBuffer_Uint8Array(r,u,g,v,Ze.IPF_GrayScaled,0,O);else if("rgba"===w)i=yield e._decodeBuffer_Uint8Array(r,u,g,v,Ze.IPF_ABGR_8888,0,O);else{if("bgra"!==w)throw new Error(`Pixel format '${w}' is not supported.`);i=yield e._decodeBuffer_Uint8Array(r,u,g,v,Ze.IPF_ARGB_8888,0,O)}if(B.recalculateResultLocation(i,o,s,I,x,u,g),e._drawResults(0==e._resultHighlightingDuration?null:i),e._clearResultsCanvasTimeoutId&&clearTimeout(e._clearResultsCanvasTimeoutId),e._resultHighlightingDuration>0&&(e._clearResultsCanvasTimeoutId=setTimeout(()=>{e.bDestroyed||e._drawResults(null)},e._resultHighlightingDuration)),e.isOpen()&&e.dce.video&&!e.dce.video.paused&&!e._bPauseScan&&(e.autoZoom||e.autoFocus||e.autoSuggestTip))if(i.length)e.autoZoomInFrameArray.length=0,e.autoZoomOutFrameCount=0,e.frameArrayInIdealZoom.length=0,e.suggestTipFrameArray.length=0,e.autoZoom&&e.autoFocus&&(e.nextActionInIdealZoom="focus"),e.autoFocusFrameArray.length=0,e.noIntermediateResultsCount=0;else{const R=function(){var X=ne(function*(){return new Promise((ee,le)=>{let ye=B._nextTaskID++;B._taskCallbackMap.set(ye,S=>{if(S.success)return ee(S.results);{let pe=new Error(S.message);return pe.stack=S.stack+"\n"+pe.stack,le(pe)}}),B._dbrWorker.postMessage({type:"getIntermediateResults",id:ye,instanceID:e._instanceID,body:{isCharge:!1}})})});return function(){return X.apply(this,arguments)}}(),P=yield R(),V=(X,ee,le,ye,S,pe,be)=>{let Qe=pe/ye,h=be/S;X.x1=X.x1/Qe+ee,X.x2=X.x2/Qe+ee,X.x3=X.x3/Qe+ee,X.x4=X.x4/Qe+ee,X.y1=X.y1/h+le,X.y2=X.y2/h+le,X.y3=X.y3/h+le,X.y4=X.y4/h+le},L=(X=>{if(!X)return null;const ee={};let le,ye,S,pe,be;{const C=e.video.videoWidth*(1-e.autoZoomDetectionArea)/2,D=e.video.videoWidth*(1+e.autoZoomDetectionArea)/2,T=e.video.videoHeight*(1-e.autoZoomDetectionArea)/2,F=e.video.videoHeight*(1+e.autoZoomDetectionArea)/2;be={x1:C,x2:D,x3:D,x4:C,y1:T,y2:T,y3:F,y4:F}}const Qe=(C,D)=>{const E=(T,M)=>{if(!T&&!M)throw new Error("Invalid arguments.");return function(F,U,G){let K=!1;const q=F.length;if(q<=2)return!1;for(let $=0;$<q;$++){const N=F[$],k=F[($+1)%q];if(Ux(N,k,{x:U,y:G}))return!0;Su(N.y-G)>0!=Su(k.y-G)>0&&Su(U-(G-N.y)*(N.x-k.x)/(N.y-k.y)-N.x)<0&&(K=!K)}return K}([{x:M.x1,y:M.y1},{x:M.x2,y:M.y2},{x:M.x3,y:M.y3},{x:M.x4,y:M.y4}],T.x,T.y)},A=(T,M)=>!!(ta([T[0],T[1]],[T[2],T[3]],[M.x1,M.y1],[M.x2,M.y2])||ta([T[0],T[1]],[T[2],T[3]],[M.x2,M.y2],[M.x3,M.y3])||ta([T[0],T[1]],[T[2],T[3]],[M.x3,M.y3],[M.x4,M.y4])||ta([T[0],T[1]],[T[2],T[3]],[M.x4,M.y4],[M.x1,M.y1]));return!!(E({x:C.x1,y:C.y1},D)||E({x:C.x2,y:C.y2},D)||E({x:C.x3,y:C.y3},D)||E({x:C.x4,y:C.y4},D))||!!(E({x:D.x1,y:D.y1},C)||E({x:D.x2,y:D.y2},C)||E({x:D.x3,y:D.y3},C)||E({x:D.x4,y:D.y4},C))||!!(A([D.x1,D.y1,D.x2,D.y2],C)||A([D.x2,D.y2,D.x3,D.y3],C)||A([D.x3,D.y3,D.x4,D.y4],C)||A([D.x4,D.y4,D.x1,D.y1],C))},h=[];for(let C of X){if(C.resultType!==sr.IRT_TYPED_BARCODE_ZONE)continue;const D=C.scaleDownRatio;for(let E of C.results){if(!E)continue;const A={x1:E.x1=E.x1*D,x2:E.x2=E.x2*D,x3:E.x3=E.x3*D,x4:E.x4=E.x4*D,y1:E.y1=E.y1*D,y2:E.y2=E.y2*D,y3:E.y4=E.y3*D,y4:E.y4=E.y4*D};V(A,o,s,I,x,u,g),Qe(be,A)&&h.push(E)}}const c=(C=>{if(!C||!C.length)return null;const D=M=>{const F=(M.x1+M.x2+M.x3+M.x4)/4,U=(M.y1+M.y2+M.y3+M.y4)/4;return(F-u/2)*(F-u/2)+(U-g/2)*(U-g/2)};let E,A=C.filter(M=>M.barcodeFormat==zt.BF_QR_CODE||M.barcodeFormat==zt.BF_DATAMATRIX);if(A.length||(A=C.filter(M=>M.barcodeFormat==zt.BF_ONED),A.length||(A=C)),!A.length)return null;E=A[0];let T=D(E);if(1!=A.length)for(let M=1;M<A.length;M++){const F=D(A[M]);(A[M].confidence>1.1*E.confidence||A[M].confidence>.9*E.confidence&&F<T)&&(E=A[M],T=F)}return E})(h);if(!c)return null;const d=c.x1,p=c.x2,a=c.x3,l=c.x4,f=c.y1,y=c.y2,m=c.y3,_=c.y4;return le=Math.min(d,p,a,l),ye=Math.max(d,p,a,l),S=Math.min(f,y,m,_),pe=Math.max(f,y,m,_),ee.x1=ee.x4=le,ee.x2=ee.x3=ye,ee.y1=ee.y2=S,ee.y3=ee.y4=pe,ee.result=c,ee})(P);if(L&&L.x1){if(e.autoZoomOutFrameCount=0,e.noIntermediateResultsCount=0,e.suggestTipFrameArray.push(!0),e.suggestTipFrameArray.splice(0,e.suggestTipFrameArray.length-e.suggestTipFrameLimit[0]),e.autoSuggestTip&&e.suggestTipFrameArray.filter(X=>!0===X).length>=e.suggestTipFrameLimit[1]){e.suggestTipFrameArray.length=0;const X=L.x3-L.x1,ee=L.y3-L.y1;L.result.moduleSize<e.tinyBarcodeTipModuleSizeLimit?e.dce&&e.dce.suggestTip("tiny-barcode","Please zoom in or move closer."):X>ee?X>u*e.hugeBarcodeTipLimit?e.dce&&e.dce.suggestTip("huge-barcode","Please zoom out or move farther."):X>.6*u&&Math.max(e.video.videoWidth,e.video.videoHeight)<=1280&&Math.min(e.video.videoWidth,e.video.videoHeight)<=720&&e.dce&&e.dce.suggestTip("low-resolution","Please use a higher resolution."):X<=ee&&(ee>g*e.hugeBarcodeTipLimit?e.dce&&e.dce.suggestTip("huge-barcode","Please zoom out or move farther."):ee>.6*g&&Math.max(e.video.videoWidth,e.video.videoHeight)<=1280&&Math.min(e.video.videoWidth,e.video.videoHeight)<=720&&e.dce&&e.dce.suggestTip("low-resolution","Please use a higher resolution."))}if(e.autoZoom){const X=e.autoZoomIdealArea[1];let ee=(1-e.autoZoomTargetBorder)/2;const le=L.x1/I,ye=(I-L.x3)/I,S=L.y1/x,pe=(x-L.y3)/x;if(le>X&&ye>X&&S>X&&pe>X&&L.result.moduleSize<e.autoZoomInIdealModuleSize){if(e.autoZoomInFrameArray.push(!0),e.autoZoomInFrameArray.splice(0,e.autoZoomInFrameArray.length-e.autoZoomInFrameLimit[0]),e.frameArrayInIdealZoom.length=0,e.autoFocus&&(e.nextActionInIdealZoom="focus",e.setFocus({mode:"continuous"}).catch(()=>{})),e.autoZoomInFrameArray.filter(be=>!0===be).length>=e.autoZoomInFrameLimit[1]){e.autoZoomInFrameArray.length=0;const be=[(.5-ee)/(.5-le),(.5-ee)/(.5-ye),(.5-ee)/(.5-S),(.5-ee)/(.5-pe)].filter(p=>p>0),Qe=Math.min(...be,e.autoZoomInIdealModuleSize/L.result.moduleSize),h=e.dce.getZoomSettings().factor;let c=Math.max(Math.pow(h*Qe,1/e.autoZoomInMaxTimes),e.autoZoomInMinStep);c=Math.min(c,Qe);const d=h*c;yield e.setZoom({factor:d}),e.dce.clearFrameBuffer()}}else if(e.autoZoomInFrameArray.length=0,e.frameArrayInIdealZoom.push(!0),e.frameArrayInIdealZoom.splice(0,e.frameArrayInIdealZoom.length-e.frameLimitInIdealZoom[0]),e.frameArrayInIdealZoom.filter(be=>!0===be).length>=e.frameLimitInIdealZoom[1])if(e.frameArrayInIdealZoom.length=0,"focus"===e.nextActionInIdealZoom&&e.autoFocus){V(L,o,s,I,x,u,g);try{yield e.setFocus({mode:"manual",area:{centerPoint:{x:(L.x1+L.x3)/2+"px",y:(L.y1+L.y3)/2+"px"},width:L.x3-L.x1+"px",height:L.y3-L.y1+"px"}})}catch{}e.dce.clearFrameBuffer(),e.nextActionInIdealZoom="zoomOut"}else{if("zoomOut"!==e.nextActionInIdealZoom&&e.autoFocus)throw new Error("Invalid action.");if(e.enableZoomOutInIdealZoom){ee=e.autoZoomIdealArea[1]+e.autoZoomOutStepRate_2;const be=[(.5-ee)/(.5-le),(.5-ee)/(.5-ye),(.5-ee)/(.5-S),(.5-ee)/(.5-pe)].filter(h=>h>0);let Qe=Math.min(...be)*e.dce.getZoomSettings().factor;yield e.setZoom({factor:Qe}),e.dce.clearFrameBuffer(),e.autoFocus&&(e.nextActionInIdealZoom="focus",e.setFocus({mode:"continuous"}).catch(h=>{}))}}}else if(e.autoFocus&&(e.autoFocusFrameArray.push(!0),e.autoFocusFrameArray.splice(0,e.autoFocusFrameArray.length-e.autoFocusFrameLimit[0]),e.autoFocusFrameArray.filter(X=>!0===X).length>=e.autoFocusFrameLimit[1])){e.autoFocusFrameArray.length=0;try{V(L,o,s,I,x,u,g),yield e.setFocus({mode:"manual",area:{centerPoint:{x:(L.x1+L.x3)/2+"px",y:(L.y1+L.y3)/2+"px"},width:L.x3-L.x1+"px",height:L.y3-L.y1+"px"}})}catch{}e.dce.clearFrameBuffer()}}else if(e.noIntermediateResultsCount++,e.suggestTipFrameArray.push(!1),e.autoZoom){if(e.autoZoomInFrameArray.push(!1),e.autoZoomInFrameArray.splice(0,e.autoZoomInFrameArray.length-e.autoZoomInFrameLimit[0]),e.autoZoomOutFrameCount++,e.frameArrayInIdealZoom.push(!1),e.frameArrayInIdealZoom.splice(0,e.frameArrayInIdealZoom.length-e.frameLimitInIdealZoom[0]),e.autoZoomOutFrameCount>=e.autoZoomOutFrameLimit){e.autoZoomOutFrameCount=0;const X=e.getZoomSettings().factor;if(X>e.autoZoomOutMinValue){const ee=Math.max((X-1)*e.autoZoomOutStepRate,e.autoZoomOutMinStep),le=Math.max(X-ee,e.autoZoomOutMinValue);yield e.setZoom({factor:le}),e.dce.clearFrameBuffer()}}e.autoFocus&&(e.nextActionInIdealZoom="focus",e.setFocus({mode:"continuous"}).catch(X=>{}))}else e.autoFocus&&(e.autoFocusFrameArray.length=0,e.setFocus({mode:"continuous"}).catch(X=>{}))}return i})().then(i=>{if(B._onLog&&B._onLog(i),e.captureAndDecodeInParallel){let r=e.array_decodeFrameTimeCost,o=e.array_getFrameTimeCost,s=e._indexCurrentDecodingFrame;const u=()=>{let g=0;if(e.region instanceof Array){let v=0,w=0;v=s+1>=e.region.length?0:s+1,w=v+1>=e.region.length?0:v+1,g=r[v]&&r[v].length&&o[w]&&o[w].length?Math.min(...r[v])-Math.max(...o[w]):0}else if(o&&o.length){let v=Math.min(...r),w=Math.max(...o);v&&w&&(g=v-w)}else g=0;return g>0?g:0};(()=>{if(e.region instanceof Array){for(r[s]&&r[s]instanceof Array||(r[s]=[]);r[s].length>=5;)r[s].shift();r[s].push(e._lastInnerDecodeDuration)}else{for(;r.length>=5;)r.shift();r.push(e._lastInnerDecodeDuration)}})(),e._intervalGetVideoFrame=u()+e.intervalTime,B._onLog&&B._onLog("Next fetching frame loop interval: "+e._intervalGetVideoFrame)}if(e.isOpen()&&e.dce.video&&!e.dce.video.paused&&!e._bPauseScan){if(e.bPlaySoundOnSuccessfulRead&&i.length){let r=!1;!0===e.bPlaySoundOnSuccessfulRead||"frame"===e.bPlaySoundOnSuccessfulRead?r=i.some(o=>o.resultState>=0):"unique"===e.bPlaySoundOnSuccessfulRead&&(r=i.some(o=>0==o.resultState)),r&&e.beepSound&&(e.beepSound.stop(),e.beepSound.play())}if(navigator.vibrate&&e.bVibrateOnSuccessfulRead&&i.length){let r=!1;if(!0===e.bVibrateOnSuccessfulRead||"frame"===e.bVibrateOnSuccessfulRead?r=i.some(o=>o.resultState>=0):"unique"===e.bVibrateOnSuccessfulRead&&(r=i.some(o=>0==o.resultState)),r)try{navigator.vibrate(e.vibrateDuration)}catch(o){console.warn("Vibration not allowed. User interaction required: "+(o.message||o))}}if(e.onFrameRead){i=i.filter(o=>o.resultState>=0);const r=e._cloneDecodeResults(i);e.onFrameRead(r)}if(e.onUniqueRead){i=i.filter(o=>0==o.resultState);const r=e._cloneDecodeResults(i);for(let o of r)e.onUniqueRead(o.barcodeText,o)}}e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),e.intervalTime?e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},e.intervalTime):e._loopReadVideo()})})()}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){B._onLog&&B._onLog("Get frame in parallel.");let n=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,n||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dce.loopInterval=0,null;e=this.dce.getFrameFromBuffer(),(r=>{if(!r)return;let o=r.timeSpent,s=this.array_getFrameTimeCost;for(;s.length>=5;)s.shift();s.push(o)})(e)}else B._onLog&&B._onLog("Get frame in serial."),this.dce.stopFetchingLoop(),e=this.dce.getFrame();return e}open(){var e=this;return ne(function*(){e._bindUI();const n=yield e.dce.open();return e._bPauseScan=!1,e.singleFrameMode||(e.dce&&(e.dce.ifShowScanRegionLaser=!0),e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},0)),e._fireResolutionWarning(),n})()}openVideo(){var e=this;return ne(function*(){e._bindUI(),e.dce.ifShowScanRegionLaser=!1;const n=yield e.dce.open();return e._bPauseScan=!0,e.singleFrameMode||(e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},0)),e._fireResolutionWarning(),n})()}close(){this._drawResults(null),this.dce.close(),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}show(){var e=this;return ne(function*(){e._bindUI();const n=yield e.dce.open(!0);return e._bPauseScan=!1,e.singleFrameMode||(e.dce&&(e.dce.ifShowScanRegionLaser=!0),e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},0)),e._fireResolutionWarning(),n})()}showVideo(){var e=this;return ne(function*(){e._bindUI(),e.dce.ifShowScanRegionLaser=!1;const n=yield e.dce.open(!0);return e._bPauseScan=!0,e.singleFrameMode||(e._loopReadVideoTimeoutId&&clearTimeout(e._loopReadVideoTimeoutId),e._loopReadVideoTimeoutId=setTimeout(()=>{e._loopReadVideo()},0)),e._fireResolutionWarning(),n})()}hide(){this.dce.close(!0),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}showTip(e,n,i,r,o=3e3,s=!0){this.dce&&this.dce.showTip(e,n,i,r,o,s)}hideTip(){this.dce&&this.dce.hideTip()}updateTipMessage(e){this.dce&&this.dce.updateTipMessage(e)}enableTapToFocus(){var e=this;return ne(function*(){e.dce&&e.dce.enableTapToFocus()})()}disableTapToFocus(){this.dce&&this.dce.disableTapToFocus()}isTapToFocusEnabled(){return this.dce.isTapToFocusEnabled()}convertToPageCoordinates(e){return this.dce.convertToPageCoordinates(e)}convertToClientCoordinates(e){return this.dce.convertToClientCoordinates(e)}destroyContext(){this.close(),this.dce&&this.dce.dispose(!1),this.bDestroyed||super.destroyContext()}}bu=qt,Du={value:void 0},function(t){t[t.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",t[t.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",t[t.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",t[t.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",t[t.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",t[t.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",t[t.BICM_SKIP=0]="BICM_SKIP",t[t.BICM_REV=2147483648]="BICM_REV"}(G_||(G_={})),function(t){t[t.BCM_AUTO=1]="BCM_AUTO",t[t.BCM_GENERAL=2]="BCM_GENERAL",t[t.BCM_SKIP=0]="BCM_SKIP",t[t.BCM_REV=2147483648]="BCM_REV"}(W_||(W_={})),function(t){t[t.BF2_NULL=0]="BF2_NULL",t[t.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",t[t.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",t[t.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",t[t.BF2_POSTNET=2097152]="BF2_POSTNET",t[t.BF2_PLANET=4194304]="BF2_PLANET",t[t.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",t[t.BF2_RM4SCC=16777216]="BF2_RM4SCC",t[t.BF2_DOTCODE=2]="BF2_DOTCODE",t[t.BF2_PHARMACODE_ONE_TRACK=4]="BF2_PHARMACODE_ONE_TRACK",t[t.BF2_PHARMACODE_TWO_TRACK=8]="BF2_PHARMACODE_TWO_TRACK",t[t.BF2_PHARMACODE=12]="BF2_PHARMACODE",t[t.BF2_ALL=-1]="BF2_ALL"}(z_||(z_={})),function(t){t[t.BM_AUTO=1]="BM_AUTO",t[t.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",t[t.BM_SKIP=0]="BM_SKIP",t[t.BM_THRESHOLD=4]="BM_THRESHOLD",t[t.BM_REV=2147483648]="BM_REV"}($_||($_={})),function(t){t[t.ECCM_CONTRAST=1]="ECCM_CONTRAST"}(Y_||(Y_={})),function(t){t[t.CFM_GENERAL=1]="CFM_GENERAL"}(X_||(X_={})),function(t){t[t.CCM_AUTO=1]="CCM_AUTO",t[t.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",t[t.CCM_SKIP=0]="CCM_SKIP",t[t.CCM_REV=2147483648]="CCM_REV"}(q_||(q_={})),function(t){t[t.CICM_GENERAL=1]="CICM_GENERAL",t[t.CICM_SKIP=0]="CICM_SKIP",t[t.CICM_REV=2147483648]="CICM_REV"}(Z_||(Z_={})),function(t){t[t.CM_IGNORE=1]="CM_IGNORE",t[t.CM_OVERWRITE=2]="CM_OVERWRITE"}(K_||(K_={})),function(t){t[t.DM_SKIP=0]="DM_SKIP",t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING"}(J_||(J_={})),function(t){t[t.DRM_AUTO=1]="DRM_AUTO",t[t.DRM_GENERAL=2]="DRM_GENERAL",t[t.DRM_BROAD_WARP=4]="DRM_BROAD_WARP",t[t.DRM_LOCAL_REFERENCE=8]="DRM_LOCAL_REFERENCE",t[t.DRM_DEWRINKLE=16]="DRM_DEWRINKLE",t[t.DRM_SKIP=0]="DRM_SKIP",t[t.DRM_REV=2147483648]="DRM_REV"}(Q_||(Q_={})),function(t){t[t.DPMCRM_AUTO=1]="DPMCRM_AUTO",t[t.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",t[t.DPMCRM_SKIP=0]="DPMCRM_SKIP",t[t.DPMCRM_REV=2147483648]="DPMCRM_REV"}(ev||(ev={})),function(t){t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_REV=2147483648]="GTM_REV"}(tv||(tv={})),function(t){t[t.IPM_AUTO=1]="IPM_AUTO",t[t.IPM_GENERAL=2]="IPM_GENERAL",t[t.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",t[t.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",t[t.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",t[t.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",t[t.IPM_SKIP=0]="IPM_SKIP",t[t.IPM_REV=2147483648]="IPM_REV"}(nv||(nv={})),function(t){t[t.IRSM_MEMORY=1]="IRSM_MEMORY",t[t.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",t[t.IRSM_BOTH=4]="IRSM_BOTH"}(iv||(iv={})),function(t){t[t.LM_SKIP=0]="LM_SKIP",t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=2147483648]="LM_REV"}(rv||(rv={})),function(t){t[t.PDFRM_RASTER=1]="PDFRM_RASTER",t[t.PDFRM_AUTO=2]="PDFRM_AUTO",t[t.PDFRM_VECTOR=4]="PDFRM_VECTOR",t[t.PDFRM_REV=2147483648]="PDFRM_REV"}(ov||(ov={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(sv||(sv={})),function(t){t[t.RPM_AUTO=1]="RPM_AUTO",t[t.RPM_GENERAL=2]="RPM_GENERAL",t[t.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",t[t.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",t[t.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",t[t.RPM_SKIP=0]="RPM_SKIP",t[t.RPM_REV=2147483648]="RPM_REV"}(av||(av={})),function(t){t[t.RCT_PIXEL=1]="RCT_PIXEL",t[t.RCT_PERCENTAGE=2]="RCT_PERCENTAGE"}(lv||(lv={})),function(t){t[t.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",t[t.RT_RAW_TEXT=1]="RT_RAW_TEXT",t[t.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",t[t.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT"}(cv||(cv={})),function(t){t[t.SUM_AUTO=1]="SUM_AUTO",t[t.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",t[t.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",t[t.SUM_SKIP=0]="SUM_SKIP",t[t.SUM_REV=2147483648]="SUM_REV"}(uv||(uv={})),function(t){t[t.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",t[t.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",t[t.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",t[t.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",t[t.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",t[t.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED"}(dv||(dv={})),function(t){t[t.TFM_AUTO=1]="TFM_AUTO",t[t.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",t[t.TFM_SKIP=0]="TFM_SKIP",t[t.TFM_REV=2147483648]="TFM_REV"}(hv||(hv={})),function(t){t[t.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",t[t.TROM_POSITION=2]="TROM_POSITION",t[t.TROM_FORMAT=4]="TROM_FORMAT",t[t.TROM_SKIP=0]="TROM_SKIP",t[t.TROM_REV=2147483648]="TROM_REV"}(fv||(fv={})),function(t){t[t.TDM_AUTO=1]="TDM_AUTO",t[t.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",t[t.TDM_SKIP=0]="TDM_SKIP",t[t.TDM_REV=2147483648]="TDM_REV"}(gv||(gv={})),B.license="DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAwLWRicl9qc19zYW1wbGVzIiwib3JnYW5pemF0aW9uSUQiOiIyMDAwMDAifQ==",B.engineResourcePath="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.6.32/dist/";let Hx=(()=>{class t{constructor(){this.pScanner=null}ngOnInit(){var n=this;return ne(function*(){try{const i=yield n.pScanner=qt.createInstance();yield i.setUIElement(document.querySelector(".dce-video-container").parentElement),i.onFrameRead=r=>{for(const o of r)console.log(o.barcodeText)},i.onUniqueRead=(r,o)=>{alert(r)},yield i.open()}catch(i){let r;r=i.message?.includes("network connection error")?"Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":i.message||i,console.error(r),alert(r)}})()}ngOnDestroy(){var n=this;return ne(function*(){n.pScanner&&(yield n.pScanner).destroyContext(),console.log("BarcodeScanner Component Unmount")})()}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=_r({type:t,selectors:[["app-video-decode"]],decls:35,vars:0,consts:[[2,"position","relative","width","100%","height","100%","min-width","100px","min-height","100px","background","#ddd"],["viewBox","0 0 1792 1792",1,"dce-bg-loading",2,"display","none","position","absolute","left","0","top","0","right","0","bottom","0","margin","auto","width","40%","height","40%","fill","#aaa","animation","1s linear infinite dce-rotate"],["d","M1760 896q0 176-68.5 336t-184 275.5-275.5 184-336 68.5-336-68.5-275.5-184-184-275.5-68.5-336q0-213 97-398.5t265-305.5 374-151v228q-221 45-366.5 221t-145.5 406q0 130 51 248.5t136.5 204 204 136.5 248.5 51 248.5-51 204-136.5 136.5-204 51-248.5q0-230-145.5-406t-366.5-221v-228q206 31 374 151t265 305.5 97 398.5z"],["viewBox","0 0 2048 1792",1,"dce-bg-camera",2,"display","none","position","absolute","left","0","top","0","right","0","bottom","0","margin","auto","width","40%","height","40%","fill","#aaa"],["d","M1024 672q119 0 203.5 84.5t84.5 203.5-84.5 203.5-203.5 84.5-203.5-84.5-84.5-203.5 84.5-203.5 203.5-84.5zm704-416q106 0 181 75t75 181v896q0 106-75 181t-181 75h-1408q-106 0-181-75t-75-181v-896q0-106 75-181t181-75h224l51-136q19-49 69.5-84.5t103.5-35.5h512q53 0 103.5 35.5t69.5 84.5l51 136h224zm-704 1152q185 0 316.5-131.5t131.5-316.5-131.5-316.5-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5z"],[1,"dce-video-container",2,"position","absolute","left","0","top","0","width","100%","height","100%"],[1,"dce-scanarea",2,"position","absolute","left","0","top","0","width","100%","height","100%","pointer-events","none"],[1,"dce-scanlight",2,"display","none","position","absolute","width","100%","height","3%","border-radius","50%","box-shadow","0px 0px 2vw 1px #00e5ff","background","#fff","animation","3s infinite dce-scanlight","user-select","none"],[2,"position","absolute","left","0","top","0"],[1,"dce-sel-camera",2,"display","block"],[1,"dce-sel-resolution",2,"display","block","margin-top","5px"],[1,"dce-btn-close",2,"position","absolute","right","0","top","0"],["width","16","height","16","viewBox","0 0 1792 1792"],["d","M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"],[1,"dbr-msg-poweredby",2,"position","absolute","left","50%","bottom","10%","transform","translateX(-50%)","pointer-events","none"],["viewBox","0 0 94 17",2,"height","max(3vmin,17px)","fill","#FFFFFF"],["d","M0.9,14V4.3h2.3c0.6,0,1,0.1,1.4,0.3c0.3,0.2,0.6,0.5,0.7,0.9s0.2,0.8,0.2,1.4c0,0.5-0.1,0.9-0.2,1.3\n\t\tC5.1,8.5,4.9,8.8,4.5,9.1C4.2,9.3,3.7,9.4,3.2,9.4H1.8V14H0.9z M1.8,8.7h1.2c0.4,0,0.7-0.1,1-0.2S4.3,8.2,4.4,8\n\t\tc0.1-0.3,0.2-0.6,0.2-1.1c0-0.5,0-0.9-0.1-1.2C4.3,5.4,4.2,5.2,3.9,5.1S3.4,5,2.9,5H1.8V8.7z"],["d","M8.1,14.1c-0.5,0-0.8-0.1-1.1-0.3s-0.5-0.5-0.6-0.9s-0.2-0.9-0.2-1.4V9.6c0-0.6,0.1-1,0.2-1.4\n\t\tC6.5,7.8,6.7,7.5,7,7.3S7.6,7,8.1,7C8.6,7,9,7.1,9.2,7.3s0.5,0.5,0.6,0.9C9.9,8.5,9.9,9,9.9,9.6v1.9c0,0.6-0.1,1-0.2,1.4\n\t\tc-0.1,0.4-0.3,0.7-0.6,0.9S8.6,14.1,8.1,14.1z M8.1,13.4c0.3,0,0.5-0.1,0.7-0.2C8.9,13,9,12.8,9,12.5c0-0.3,0-0.6,0-1v-2\n\t\tc0-0.4,0-0.7,0-1C9,8.2,8.9,8,8.8,7.9C8.6,7.7,8.4,7.6,8.1,7.6c-0.3,0-0.5,0.1-0.7,0.2C7.3,8,7.2,8.2,7.2,8.5c0,0.3-0.1,0.6-0.1,1\n\t\tv2c0,0.4,0,0.7,0.1,1c0,0.3,0.1,0.5,0.3,0.7C7.6,13.4,7.8,13.4,8.1,13.4z"],["d","M12,14l-1.1-6.9h0.7l0.9,5.8l1.1-5.8h0.8l1.1,5.8l0.8-5.8H17L15.9,14H15l-1.1-5.6L12.8,14H12z"],["d","M19.8,14.1c-0.4,0-0.8-0.1-1.1-0.3s-0.5-0.5-0.6-0.9c-0.1-0.4-0.2-0.9-0.2-1.6V9.6c0-0.7,0.1-1.2,0.2-1.6\n\t\tc0.1-0.4,0.3-0.7,0.6-0.8C19,7,19.3,7,19.8,7c0.5,0,0.9,0.1,1.1,0.3c0.3,0.2,0.4,0.5,0.5,0.9c0.1,0.4,0.1,1,0.1,1.6v0.6h-2.8v1.2\n\t\tc0,0.4,0,0.8,0.1,1.1c0.1,0.3,0.2,0.4,0.3,0.6s0.3,0.2,0.6,0.2c0.2,0,0.3,0,0.5-0.1c0.1-0.1,0.3-0.2,0.3-0.4s0.1-0.5,0.1-0.8v-0.5\n\t\th0.9V12c0,0.6-0.1,1.1-0.4,1.5S20.4,14.1,19.8,14.1z M18.8,9.9h1.9V9.4c0-0.4,0-0.7-0.1-0.9c0-0.3-0.1-0.5-0.3-0.6S20,7.6,19.8,7.6\n\t\tc-0.2,0-0.4,0.1-0.6,0.2c-0.1,0.1-0.3,0.3-0.3,0.6c-0.1,0.3-0.1,0.7-0.1,1.1V9.9z"],["d","M22.8,14V7.1h0.9V8c0.2-0.4,0.5-0.6,0.8-0.8C24.8,7.1,25,7,25.3,7c0,0,0,0,0.1,0s0.1,0,0.1,0v0.9\n\t\tc-0.1,0-0.1,0-0.2-0.1c-0.1,0-0.2,0-0.2,0c-0.3,0-0.5,0.1-0.7,0.2c-0.2,0.1-0.4,0.3-0.6,0.6V14H22.8z"],["d","M28,14.1c-0.4,0-0.8-0.1-1.1-0.3s-0.5-0.5-0.6-0.9c-0.1-0.4-0.2-0.9-0.2-1.6V9.6c0-0.7,0.1-1.2,0.2-1.6\n\t\tc0.1-0.4,0.3-0.7,0.6-0.8C27.3,7,27.6,7,28,7c0.5,0,0.9,0.1,1.1,0.3c0.3,0.2,0.4,0.5,0.5,0.9c0.1,0.4,0.1,1,0.1,1.6v0.6H27v1.2\n\t\tc0,0.4,0,0.8,0.1,1.1c0.1,0.3,0.2,0.4,0.3,0.6s0.3,0.2,0.6,0.2c0.2,0,0.3,0,0.5-0.1c0.1-0.1,0.3-0.2,0.3-0.4s0.1-0.5,0.1-0.8v-0.5\n\t\th0.9V12c0,0.6-0.1,1.1-0.4,1.5S28.7,14.1,28,14.1z M27,9.9H29V9.4c0-0.4,0-0.7-0.1-0.9c0-0.3-0.1-0.5-0.3-0.6S28.3,7.6,28,7.6\n\t\tc-0.2,0-0.4,0.1-0.6,0.2c-0.1,0.1-0.3,0.3-0.3,0.6C27.1,8.6,27,9,27,9.5V9.9z"],["d","M32.6,14.1c-0.6,0-1-0.2-1.3-0.7c-0.3-0.4-0.4-1.2-0.4-2.2V9.9c0-0.6,0-1.1,0.1-1.6c0.1-0.4,0.2-0.8,0.5-1\n\t\tc0.2-0.2,0.6-0.4,1-0.4C32.8,7,33,7,33.2,7.1c0.2,0.1,0.4,0.3,0.5,0.4V4.3h0.9V14h-0.9v-0.5c-0.1,0.2-0.3,0.3-0.5,0.4\n\t\tC33,14,32.8,14.1,32.6,14.1z M32.7,13.4c0.2,0,0.4,0,0.5-0.1c0.2-0.1,0.3-0.2,0.5-0.3V8.1c-0.1-0.1-0.3-0.2-0.4-0.3\n\t\tc-0.2-0.1-0.4-0.2-0.6-0.2c-0.4,0-0.6,0.2-0.8,0.5S31.8,9,31.8,9.6v1.6c0,0.5,0,0.9,0.1,1.2c0.1,0.3,0.1,0.6,0.3,0.7\n\t\tC32.3,13.3,32.5,13.4,32.7,13.4z"],["d","M40.5,14.1c-0.3,0-0.5-0.1-0.7-0.2c-0.2-0.1-0.4-0.3-0.5-0.4V14h-0.9V4.3h0.9v3.4c0.1-0.2,0.3-0.3,0.5-0.5\n\t\tC40.1,7,40.3,7,40.6,7C41,7,41.2,7,41.4,7.2c0.2,0.2,0.4,0.4,0.5,0.6c0.1,0.3,0.2,0.6,0.2,0.9s0.1,0.7,0.1,1v1.5\n\t\tc0,0.6,0,1.1-0.1,1.5c-0.1,0.4-0.3,0.8-0.5,1C41.3,14,41,14.1,40.5,14.1z M40.4,13.4c0.3,0,0.5-0.1,0.6-0.3\n\t\tc0.1-0.2,0.2-0.4,0.3-0.8s0.1-0.7,0.1-1.2V9.7c0-0.5,0-0.8-0.1-1.1S41.1,8,41,7.9c-0.1-0.2-0.3-0.2-0.6-0.2c-0.2,0-0.4,0.1-0.6,0.2\n\t\tc-0.2,0.1-0.3,0.2-0.5,0.4v4.7c0.1,0.1,0.3,0.3,0.5,0.4C40,13.4,40.2,13.4,40.4,13.4z"],["d","M43.2,15.7V15c0.4,0,0.7,0,0.9-0.1c0.2-0.1,0.3-0.1,0.4-0.3c0.1-0.1,0.1-0.2,0.1-0.4c0-0.1,0-0.3-0.1-0.5\n\t\tc0-0.2-0.1-0.4-0.2-0.6L43,7.1h0.9l1.2,5.9l1.2-5.9h0.9l-1.7,7.4c-0.1,0.3-0.2,0.5-0.3,0.7c-0.2,0.2-0.4,0.3-0.6,0.4\n\t\tc-0.3,0.1-0.6,0.1-1,0.1H43.2z"],["d","M50.6,14V4.3h2.1c0.7,0,1.2,0.1,1.6,0.4c0.4,0.2,0.6,0.6,0.8,1c0.2,0.4,0.2,0.9,0.2,1.5V11\n\t\tc0,0.6-0.1,1.1-0.2,1.6s-0.4,0.8-0.8,1S53.5,14,52.8,14H50.6z M51.5,13.3h1.2c0.5,0,0.9-0.1,1.1-0.3s0.4-0.5,0.5-0.9\n\t\ts0.1-0.8,0.1-1.3V7.2c0-0.5,0-0.9-0.1-1.2s-0.2-0.6-0.5-0.8S53.2,5,52.7,5h-1.2V13.3z"],["d","M56.5,15.7V15c0.4,0,0.7,0,0.9-0.1c0.2-0.1,0.3-0.1,0.4-0.3c0.1-0.1,0.1-0.2,0.1-0.4c0-0.1,0-0.3-0.1-0.5\n\t\tc0-0.2-0.1-0.4-0.2-0.6l-1.4-6.1h0.9l1.2,5.9l1.2-5.9h0.9l-1.7,7.4c-0.1,0.3-0.2,0.5-0.3,0.7s-0.4,0.3-0.6,0.4s-0.6,0.1-1,0.1H56.5\n\t\tz"],["d","M61.3,14V7.1h0.9v0.7c0.2-0.2,0.5-0.4,0.8-0.6C63.2,7,63.5,7,63.8,7C64,7,64.2,7,64.4,7.1s0.3,0.3,0.4,0.5\n\t\tc0.1,0.2,0.1,0.5,0.1,0.8V14H64V8.6c0-0.4-0.1-0.6-0.2-0.8c-0.1-0.1-0.3-0.2-0.5-0.2c-0.2,0-0.4,0.1-0.6,0.2s-0.4,0.3-0.6,0.5V14\n\t\tH61.3z"],["d","M67.4,14.1c-0.3,0-0.5-0.1-0.7-0.2c-0.2-0.1-0.4-0.3-0.5-0.6C66,13.1,66,12.8,66,12.6c0-0.4,0.1-0.7,0.2-0.9\n\t\ts0.3-0.5,0.5-0.7c0.2-0.2,0.5-0.4,0.9-0.6c0.4-0.2,0.8-0.4,1.3-0.6V9.3c0-0.4,0-0.8-0.1-1c-0.1-0.2-0.1-0.4-0.3-0.5\n\t\tc-0.1-0.1-0.3-0.2-0.5-0.2c-0.2,0-0.3,0-0.5,0.1c-0.1,0.1-0.3,0.2-0.3,0.4c-0.1,0.2-0.1,0.4-0.1,0.7V9l-0.9,0\n\t\tc0-0.7,0.2-1.2,0.5-1.6C66.8,7.1,67.3,7,68,7c0.6,0,1.1,0.2,1.3,0.6c0.3,0.4,0.4,1,0.4,1.7v3.4c0,0.1,0,0.3,0,0.5\n\t\tc0,0.2,0,0.4,0,0.5c0,0.2,0,0.3,0,0.4h-0.8c0-0.2-0.1-0.3-0.1-0.5c0-0.2,0-0.3-0.1-0.5c-0.1,0.3-0.3,0.5-0.5,0.7\n\t\tS67.7,14.1,67.4,14.1z M67.6,13.4c0.2,0,0.3,0,0.5-0.1c0.1-0.1,0.3-0.2,0.4-0.3s0.2-0.3,0.3-0.4v-2.2c-0.3,0.2-0.6,0.3-0.9,0.5\n\t\tc-0.2,0.1-0.4,0.3-0.6,0.4c-0.2,0.1-0.3,0.3-0.3,0.5s-0.1,0.4-0.1,0.6c0,0.4,0.1,0.6,0.2,0.8C67.2,13.3,67.4,13.4,67.6,13.4z"],["d","M70.9,14V7.1h0.8v0.7c0.2-0.3,0.5-0.5,0.8-0.6c0.3-0.1,0.6-0.2,0.9-0.2c0.2,0,0.5,0.1,0.7,0.2s0.3,0.4,0.4,0.7\n\t\tc0.2-0.3,0.5-0.5,0.8-0.7c0.3-0.2,0.6-0.2,0.9-0.2c0.2,0,0.4,0,0.6,0.1s0.3,0.3,0.4,0.5c0.1,0.2,0.2,0.5,0.2,0.9V14h-0.8V8.6\n\t\tc0-0.4-0.1-0.7-0.2-0.8s-0.3-0.2-0.5-0.2c-0.2,0-0.4,0.1-0.7,0.2S74.7,8,74.5,8.3c0,0,0,0.1,0,0.1s0,0.1,0,0.1V14h-0.8V8.6\n\t\tc0-0.4-0.1-0.7-0.2-0.8c-0.1-0.1-0.3-0.2-0.5-0.2c-0.2,0-0.4,0.1-0.7,0.2c-0.2,0.1-0.4,0.3-0.6,0.5V14H70.9z"],["d","M80.2,14.1c-0.6,0-1-0.2-1.3-0.5c-0.3-0.4-0.5-0.8-0.6-1.4l0.7-0.2c0,0.5,0.2,0.9,0.4,1.2\n\t\tc0.2,0.2,0.5,0.4,0.8,0.4c0.3,0,0.5-0.1,0.7-0.3c0.2-0.2,0.2-0.4,0.2-0.7c0-0.2-0.1-0.5-0.2-0.7c-0.1-0.2-0.4-0.5-0.6-0.7l-0.9-0.8\n\t\tc-0.3-0.3-0.5-0.5-0.7-0.8c-0.2-0.3-0.2-0.6-0.2-0.9c0-0.3,0.1-0.6,0.2-0.8c0.1-0.2,0.3-0.4,0.6-0.5C79.5,7,79.8,7,80.2,7\n\t\tc0.5,0,0.9,0.2,1.2,0.5c0.3,0.3,0.4,0.8,0.4,1.3L81.2,9c0-0.3-0.1-0.6-0.1-0.8s-0.2-0.4-0.3-0.5c-0.1-0.1-0.3-0.1-0.5-0.1\n\t\tc-0.3,0-0.5,0.1-0.6,0.2c-0.2,0.1-0.2,0.4-0.2,0.6c0,0.2,0,0.4,0.1,0.6c0.1,0.2,0.2,0.3,0.4,0.5l1,0.9c0.2,0.2,0.4,0.3,0.6,0.5\n\t\tc0.2,0.2,0.3,0.4,0.4,0.6c0.1,0.2,0.2,0.5,0.2,0.8c0,0.4-0.1,0.7-0.2,0.9c-0.1,0.2-0.4,0.4-0.6,0.6C80.9,14,80.6,14.1,80.2,14.1z"],["d","M84.7,14.1c-0.5,0-0.8-0.1-1.1-0.3c-0.3-0.2-0.5-0.5-0.6-0.9s-0.2-0.9-0.2-1.4V9.6c0-0.6,0.1-1,0.2-1.4\n\t\tc0.1-0.4,0.3-0.7,0.6-0.9C83.9,7.1,84.3,7,84.7,7c0.5,0,0.9,0.1,1.1,0.3s0.5,0.5,0.6,0.9c0.1,0.4,0.2,0.9,0.2,1.4v1.9\n\t\tc0,0.6-0.1,1-0.2,1.4s-0.3,0.7-0.6,0.9S85.2,14.1,84.7,14.1z M84.7,13.4c0.3,0,0.5-0.1,0.7-0.2c0.1-0.2,0.2-0.4,0.3-0.7\n\t\tc0-0.3,0-0.6,0-1v-2c0-0.4,0-0.7,0-1c0-0.3-0.1-0.5-0.3-0.7c-0.1-0.2-0.4-0.2-0.7-0.2c-0.3,0-0.5,0.1-0.7,0.2\n\t\tc-0.1,0.2-0.2,0.4-0.3,0.7c0,0.3-0.1,0.6-0.1,1v2c0,0.4,0,0.7,0.1,1c0,0.3,0.1,0.5,0.3,0.7C84.2,13.4,84.4,13.4,84.7,13.4z"],["d","M88.2,14V7.7h-0.9V7.1h0.9V6.3c0-0.3,0-0.6,0.1-0.9c0.1-0.3,0.2-0.5,0.4-0.6c0.2-0.2,0.5-0.2,0.8-0.2\n\t\tc0.1,0,0.2,0,0.4,0c0.1,0,0.2,0,0.3,0.1v0.6c-0.1,0-0.2,0-0.2,0c-0.1,0-0.2,0-0.2,0c-0.3,0-0.4,0.1-0.5,0.2s-0.1,0.4-0.1,0.8v0.8\n\t\th1.1v0.6h-1.1V14H88.2z"],["d","M92.7,14.1c-0.3,0-0.6-0.1-0.8-0.2s-0.3-0.3-0.4-0.5c-0.1-0.2-0.1-0.5-0.1-0.8V7.6h-0.9V7.1h0.9V4.9h0.9v2.1\n\t\th1.2v0.6h-1.2v4.8c0,0.3,0,0.6,0.1,0.7c0.1,0.1,0.2,0.2,0.5,0.2c0.1,0,0.2,0,0.2,0s0.2,0,0.3,0V14c-0.1,0-0.2,0-0.4,0.1\n\t\tC92.9,14.1,92.8,14.1,92.7,14.1z"]],template:function(i,r){1&i&&(_t(0,"div",0),Lo(),_t(1,"svg",1),Wt(2,"path",2),kt(),_t(3,"svg",3),Wt(4,"path",4),kt(),Ba(),Wt(5,"div",5),_t(6,"div",6),Wt(7,"div",7),kt(),_t(8,"div",8),Wt(9,"select",9)(10,"select",10),kt(),_t(11,"button",11),Lo(),_t(12,"svg",12),Wt(13,"path",13),kt()(),Ba(),_t(14,"div",14),Lo(),_t(15,"svg",15)(16,"g"),Wt(17,"path",16)(18,"path",17)(19,"path",18)(20,"path",19)(21,"path",20)(22,"path",21)(23,"path",22)(24,"path",23)(25,"path",24)(26,"path",25)(27,"path",26)(28,"path",27)(29,"path",28)(30,"path",29)(31,"path",30)(32,"path",31)(33,"path",32)(34,"path",33),kt()()()())},styles:["@keyframes _ngcontent-%COMP%_dce-rotate {\n\t\tfrom { transform: rotate(0turn); }\n\t\tto { transform: rotate(1turn); }\n\t}\n\t@keyframes _ngcontent-%COMP%_dce-scanlight {\n\t\tfrom { top: 0; }\n\t\tto { top: 97%; }\n\t}"]})}return t})(),Gx=(()=>{class t{constructor(){var n=this;this.pReader=null,this.decodeImg=function(){var i=ne(function*(r){try{const s=yield(yield n.pReader).decode(r.target.files[0]);for(const u of s)alert(u.barcodeText);s.length||alert("No barcode found")}catch(o){let s;s=o.message?.includes("network connection error")?"Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":o.message||o,console.error(s),alert(s)}r.target.value=""});return function(r){return i.apply(this,arguments)}}()}ngOnInit(){var n=this;return ne(function*(){n.pReader=B.createInstance()})()}ngOnDestroy(){var n=this;return ne(function*(){n.pReader&&(yield n.pReader).destroyContext(),console.log("ImgDecode Component Unmount")})()}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=_r({type:t,selectors:[["app-img-decode"]],decls:2,vars:0,consts:[[1,"ImgDecode"],["type","file",3,"change"]],template:function(i,r){1&i&&(_t(0,"div",0)(1,"input",1),Gr("change",function(s){return r.decodeImg(s)}),kt()())},styles:[".ImgDecode[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;width:100%;border:1px solid black}"]})}return t})();function Wx(t,e){1&t&&Wt(0,"app-video-decode")}function zx(t,e){1&t&&Wt(0,"app-img-decode")}const $x=function(t){return{"margin-right":"10px","background-color":t}},Yx=function(t){return{"background-color":t}};let Xx=(()=>{class t{constructor(){this.bShowScanner=!0,this.bShowImgDecode=!1}ngOnInit(){return ne(function*(){try{yield qt.loadWasm()}catch(n){let i;i=n.message?.includes("network connection error")?"Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":n.message||n,console.error(i),alert(i)}})()}showScanner(){this.bShowScanner=!0,this.bShowImgDecode=!1}showImgDecode(){this.bShowScanner=!1,this.bShowImgDecode=!0}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=_r({type:t,selectors:[["app-hello-world"]],decls:12,vars:8,consts:[[1,"helloWorld"],["alt","logo","src","data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNTAgMjUwIj4KICAgIDxwYXRoIGZpbGw9IiNERDAwMzEiIGQ9Ik0xMjUgMzBMMzEuOSA2My4ybDE0LjIgMTIzLjFMMTI1IDIzMGw3OC45LTQzLjcgMTQuMi0xMjMuMXoiIC8+CiAgICA8cGF0aCBmaWxsPSIjQzMwMDJGIiBkPSJNMTI1IDMwdjIyLjItLjFWMjMwbDc4LjktNDMuNyAxNC4yLTEyMy4xTDEyNSAzMHoiIC8+CiAgICA8cGF0aCAgZmlsbD0iI0ZGRkZGRiIgZD0iTTEyNSA1Mi4xTDY2LjggMTgyLjZoMjEuN2wxMS43LTI5LjJoNDkuNGwxMS43IDI5LjJIMTgzTDEyNSA1Mi4xem0xNyA4My4zaC0zNGwxNy00MC45IDE3IDQwLjl6IiAvPgogIDwvc3ZnPg==",2,"height","25px"],[3,"ngStyle","click"],[1,"container"],[4,"ngIf"]],template:function(i,r){1&i&&(_t(0,"div",0)(1,"h1"),_s(2,"Hello World for Angular"),Wt(3,"img",1),kt(),_t(4,"div")(5,"button",2),Gr("click",function(){return r.showScanner()}),_s(6,"Video Decode"),kt(),_t(7,"button",2),Gr("click",function(){return r.showImgDecode()}),_s(8,"Image Decode"),kt()(),_t(9,"div",3),Ql(10,Wx,1,0,"app-video-decode",4),Ql(11,zx,1,0,"app-img-decode",4),kt()()),2&i&&(Br(5),Qi("ngStyle",vc(4,$x,r.bShowScanner?"rgb(255,174,55)":"white")),Br(2),Qi("ngStyle",vc(6,Yx,r.bShowScanner?"white":"rgb(255,174,55)")),Br(3),Qi("ngIf",r.bShowScanner),Br(1),Qi("ngIf",r.bShowImgDecode))},dependencies:[Jm,t_,Hx,Gx],styles:[".helloWorld[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%;color:#455a64}button[_ngcontent-%COMP%]{font-size:1.5rem;margin:1.5vh 0;border:1px solid black;background-color:#fff;color:#000}.container[_ngcontent-%COMP%]{margin:2vmin auto;height:70vh;width:80vw}h1[_ngcontent-%COMP%]{font-size:1.5em}"]})}return t})(),qx=(()=>{class t{constructor(){this.title="read-video-angular"}static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275cmp=_r({type:t,selectors:[["app-root"]],decls:1,vars:0,template:function(i,r){1&i&&Wt(0,"app-hello-world")},dependencies:[Xx]})}return t})(),Zx=(()=>{class t{static#e=this.\u0275fac=function(i){return new(i||t)};static#t=this.\u0275mod=vr({type:t,bootstrap:[qx]});static#n=this.\u0275inj=vi({imports:[px]})}return t})();gx().bootstrapModule(Zx).catch(t=>console.error(t))}},it=>{it(it.s=206)}]);