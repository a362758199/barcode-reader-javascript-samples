(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))o(h);new MutationObserver(h=>{for(const g of h)if(g.type==="childList")for(const p of g.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&o(p)}).observe(document,{childList:!0,subtree:!0});function r(h){const g={};return h.integrity&&(g.integrity=h.integrity),h.referrerPolicy&&(g.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?g.credentials="include":h.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function o(h){if(h.ep)return;h.ep=!0;const g=r(h);fetch(h.href,g)}})();function xr(t,e){const r=Object.create(null),o=t.split(",");for(let h=0;h<o.length;h++)r[o[h]]=!0;return e?h=>!!r[h.toLowerCase()]:h=>!!r[h]}const Re={},Ft=[],$e=()=>{},io=()=>!1,Bi=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),Tr=t=>t.startsWith("onUpdate:"),Fe=Object.assign,Ir=(t,e)=>{const r=t.indexOf(e);r>-1&&t.splice(r,1)},ro=Object.prototype.hasOwnProperty,Ce=(t,e)=>ro.call(t,e),ve=Array.isArray,ei=t=>ji(t)==="[object Map]",no=t=>ji(t)==="[object Set]",be=t=>typeof t=="function",Pe=t=>typeof t=="string",Ni=t=>typeof t=="symbol",Me=t=>t!==null&&typeof t=="object",os=t=>(Me(t)||be(t))&&be(t.then)&&be(t.catch),so=Object.prototype.toString,ji=t=>so.call(t),oo=t=>ji(t).slice(8,-1),ao=t=>ji(t)==="[object Object]",Er=t=>Pe(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,bi=xr(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Vi=t=>{const e=Object.create(null);return r=>e[r]||(e[r]=t(r))},lo=/-(\w)/g,Bt=Vi(t=>t.replace(lo,(e,r)=>r?r.toUpperCase():"")),co=/\B([A-Z])/g,Wt=Vi(t=>t.replace(co,"-$1").toLowerCase()),as=Vi(t=>t.charAt(0).toUpperCase()+t.slice(1)),Ji=Vi(t=>t?`on${as(t)}`:""),Ot=(t,e)=>!Object.is(t,e),$i=(t,e)=>{for(let r=0;r<t.length;r++)t[r](e)},Ii=(t,e,r)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:r})},ho=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let qr;const or=()=>qr||(qr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function ri(t){if(ve(t)){const e={};for(let r=0;r<t.length;r++){const o=t[r],h=Pe(o)?_o(o):ri(o);if(h)for(const g in h)e[g]=h[g]}return e}else if(Pe(t)||Me(t))return t}const uo=/;(?![^(]*\))/g,fo=/:([^]+)/,go=/\/\*[^]*?\*\//g;function _o(t){const e={};return t.replace(go,"").split(uo).forEach(r=>{if(r){const o=r.split(fo);o.length>1&&(e[o[0].trim()]=o[1].trim())}}),e}function Or(t){let e="";if(Pe(t))e=t;else if(ve(t))for(let r=0;r<t.length;r++){const o=Or(t[r]);o&&(e+=o+" ")}else if(Me(t))for(const r in t)t[r]&&(e+=r+" ");return e.trim()}const po="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",mo=xr(po);function ls(t){return!!t||t===""}let Ke;class vo{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Ke,!e&&Ke&&(this.index=(Ke.scopes||(Ke.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const r=Ke;try{return Ke=this,e()}finally{Ke=r}}}on(){Ke=this}off(){Ke=this.parent}stop(e){if(this._active){let r,o;for(r=0,o=this.effects.length;r<o;r++)this.effects[r].stop();for(r=0,o=this.cleanups.length;r<o;r++)this.cleanups[r]();if(this.scopes)for(r=0,o=this.scopes.length;r<o;r++)this.scopes[r].stop(!0);if(!this.detached&&this.parent&&!e){const h=this.parent.scopes.pop();h&&h!==this&&(this.parent.scopes[this.index]=h,h.index=this.index)}this.parent=void 0,this._active=!1}}}function yo(t,e=Ke){e&&e.active&&e.effects.push(t)}function bo(){return Ke}const Ar=t=>{const e=new Set(t);return e.w=0,e.n=0,e},cs=t=>(t.w&pt)>0,hs=t=>(t.n&pt)>0,So=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=pt},wo=t=>{const{deps:e}=t;if(e.length){let r=0;for(let o=0;o<e.length;o++){const h=e[o];cs(h)&&!hs(h)?h.delete(t):e[r++]=h,h.w&=~pt,h.n&=~pt}e.length=r}},ar=new WeakMap;let $t=0,pt=1;const lr=30;let qe;const xt=Symbol(""),cr=Symbol("");class Rr{constructor(e,r=null,o){this.fn=e,this.scheduler=r,this.active=!0,this.deps=[],this.parent=void 0,yo(this,o)}run(){if(!this.active)return this.fn();let e=qe,r=gt;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=qe,qe=this,gt=!0,pt=1<<++$t,$t<=lr?So(this):Zr(this),this.fn()}finally{$t<=lr&&wo(this),pt=1<<--$t,qe=this.parent,gt=r,this.parent=void 0,this.deferStop&&this.stop()}}stop(){qe===this?this.deferStop=!0:this.active&&(Zr(this),this.onStop&&this.onStop(),this.active=!1)}}function Zr(t){const{deps:e}=t;if(e.length){for(let r=0;r<e.length;r++)e[r].delete(t);e.length=0}}let gt=!0;const us=[];function Gt(){us.push(gt),gt=!1}function Ht(){const t=us.pop();gt=t===void 0?!0:t}function Ue(t,e,r){if(gt&&qe){let o=ar.get(t);o||ar.set(t,o=new Map);let h=o.get(r);h||o.set(r,h=Ar()),ds(h)}}function ds(t,e){let r=!1;$t<=lr?hs(t)||(t.n|=pt,r=!cs(t)):r=!t.has(qe),r&&(t.add(qe),qe.deps.push(t))}function ht(t,e,r,o,h,g){const p=ar.get(t);if(!p)return;let v=[];if(e==="clear")v=[...p.values()];else if(r==="length"&&ve(t)){const S=Number(o);p.forEach((w,x)=>{(x==="length"||!Ni(x)&&x>=S)&&v.push(w)})}else switch(r!==void 0&&v.push(p.get(r)),e){case"add":ve(t)?Er(r)&&v.push(p.get("length")):(v.push(p.get(xt)),ei(t)&&v.push(p.get(cr)));break;case"delete":ve(t)||(v.push(p.get(xt)),ei(t)&&v.push(p.get(cr)));break;case"set":ei(t)&&v.push(p.get(xt));break}if(v.length===1)v[0]&&hr(v[0]);else{const S=[];for(const w of v)w&&S.push(...w);hr(Ar(S))}}function hr(t,e){const r=ve(t)?t:[...t];for(const o of r)o.computed&&Jr(o);for(const o of r)o.computed||Jr(o)}function Jr(t,e){(t!==qe||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const Co=xr("__proto__,__v_isRef,__isVue"),fs=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Ni)),$r=xo();function xo(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...r){const o=xe(this);for(let g=0,p=this.length;g<p;g++)Ue(o,"get",g+"");const h=o[e](...r);return h===-1||h===!1?o[e](...r.map(xe)):h}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...r){Gt();const o=xe(this)[e].apply(this,r);return Ht(),o}}),t}function To(t){const e=xe(this);return Ue(e,"has",t),e.hasOwnProperty(t)}class gs{constructor(e=!1,r=!1){this._isReadonly=e,this._shallow=r}get(e,r,o){const h=this._isReadonly,g=this._shallow;if(r==="__v_isReactive")return!h;if(r==="__v_isReadonly")return h;if(r==="__v_isShallow")return g;if(r==="__v_raw"&&o===(h?g?No:vs:g?ms:ps).get(e))return e;const p=ve(e);if(!h){if(p&&Ce($r,r))return Reflect.get($r,r,o);if(r==="hasOwnProperty")return To}const v=Reflect.get(e,r,o);return(Ni(r)?fs.has(r):Co(r))||(h||Ue(e,"get",r),g)?v:Ne(v)?p&&Er(r)?v:v.value:Me(v)?h?ys(v):Lr(v):v}}class _s extends gs{constructor(e=!1){super(!1,e)}set(e,r,o,h){let g=e[r];if(Nt(g)&&Ne(g)&&!Ne(o))return!1;if(!this._shallow&&(!Ei(o)&&!Nt(o)&&(g=xe(g),o=xe(o)),!ve(e)&&Ne(g)&&!Ne(o)))return g.value=o,!0;const p=ve(e)&&Er(r)?Number(r)<e.length:Ce(e,r),v=Reflect.set(e,r,o,h);return e===xe(h)&&(p?Ot(o,g)&&ht(e,"set",r,o):ht(e,"add",r,o)),v}deleteProperty(e,r){const o=Ce(e,r);e[r];const h=Reflect.deleteProperty(e,r);return h&&o&&ht(e,"delete",r,void 0),h}has(e,r){const o=Reflect.has(e,r);return(!Ni(r)||!fs.has(r))&&Ue(e,"has",r),o}ownKeys(e){return Ue(e,"iterate",ve(e)?"length":xt),Reflect.ownKeys(e)}}class Io extends gs{constructor(e=!1){super(!0,e)}set(e,r){return!0}deleteProperty(e,r){return!0}}const Eo=new _s,Oo=new Io,Ao=new _s(!0),Dr=t=>t,Ui=t=>Reflect.getPrototypeOf(t);function ui(t,e,r=!1,o=!1){t=t.__v_raw;const h=xe(t),g=xe(e);r||(Ot(e,g)&&Ue(h,"get",e),Ue(h,"get",g));const{has:p}=Ui(h),v=o?Dr:r?Pr:ni;if(p.call(h,e))return v(t.get(e));if(p.call(h,g))return v(t.get(g));t!==h&&t.get(e)}function di(t,e=!1){const r=this.__v_raw,o=xe(r),h=xe(t);return e||(Ot(t,h)&&Ue(o,"has",t),Ue(o,"has",h)),t===h?r.has(t):r.has(t)||r.has(h)}function fi(t,e=!1){return t=t.__v_raw,!e&&Ue(xe(t),"iterate",xt),Reflect.get(t,"size",t)}function Qr(t){t=xe(t);const e=xe(this);return Ui(e).has.call(e,t)||(e.add(t),ht(e,"add",t,t)),this}function en(t,e){e=xe(e);const r=xe(this),{has:o,get:h}=Ui(r);let g=o.call(r,t);g||(t=xe(t),g=o.call(r,t));const p=h.call(r,t);return r.set(t,e),g?Ot(e,p)&&ht(r,"set",t,e):ht(r,"add",t,e),this}function tn(t){const e=xe(this),{has:r,get:o}=Ui(e);let h=r.call(e,t);h||(t=xe(t),h=r.call(e,t)),o&&o.call(e,t);const g=e.delete(t);return h&&ht(e,"delete",t,void 0),g}function rn(){const t=xe(this),e=t.size!==0,r=t.clear();return e&&ht(t,"clear",void 0,void 0),r}function gi(t,e){return function(o,h){const g=this,p=g.__v_raw,v=xe(p),S=e?Dr:t?Pr:ni;return!t&&Ue(v,"iterate",xt),p.forEach((w,x)=>o.call(h,S(w),S(x),g))}}function _i(t,e,r){return function(...o){const h=this.__v_raw,g=xe(h),p=ei(g),v=t==="entries"||t===Symbol.iterator&&p,S=t==="keys"&&p,w=h[t](...o),x=r?Dr:e?Pr:ni;return!e&&Ue(g,"iterate",S?cr:xt),{next(){const{value:E,done:A}=w.next();return A?{value:E,done:A}:{value:v?[x(E[0]),x(E[1])]:x(E),done:A}},[Symbol.iterator](){return this}}}}function dt(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function Ro(){const t={get(g){return ui(this,g)},get size(){return fi(this)},has:di,add:Qr,set:en,delete:tn,clear:rn,forEach:gi(!1,!1)},e={get(g){return ui(this,g,!1,!0)},get size(){return fi(this)},has:di,add:Qr,set:en,delete:tn,clear:rn,forEach:gi(!1,!0)},r={get(g){return ui(this,g,!0)},get size(){return fi(this,!0)},has(g){return di.call(this,g,!0)},add:dt("add"),set:dt("set"),delete:dt("delete"),clear:dt("clear"),forEach:gi(!0,!1)},o={get(g){return ui(this,g,!0,!0)},get size(){return fi(this,!0)},has(g){return di.call(this,g,!0)},add:dt("add"),set:dt("set"),delete:dt("delete"),clear:dt("clear"),forEach:gi(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(g=>{t[g]=_i(g,!1,!1),r[g]=_i(g,!0,!1),e[g]=_i(g,!1,!0),o[g]=_i(g,!0,!0)}),[t,r,e,o]}const[Do,Mo,Lo,Fo]=Ro();function Mr(t,e){const r=e?t?Fo:Lo:t?Mo:Do;return(o,h,g)=>h==="__v_isReactive"?!t:h==="__v_isReadonly"?t:h==="__v_raw"?o:Reflect.get(Ce(r,h)&&h in o?r:o,h,g)}const Po={get:Mr(!1,!1)},ko={get:Mr(!1,!0)},Bo={get:Mr(!0,!1)},ps=new WeakMap,ms=new WeakMap,vs=new WeakMap,No=new WeakMap;function jo(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Vo(t){return t.__v_skip||!Object.isExtensible(t)?0:jo(oo(t))}function Lr(t){return Nt(t)?t:Fr(t,!1,Eo,Po,ps)}function Uo(t){return Fr(t,!1,Ao,ko,ms)}function ys(t){return Fr(t,!0,Oo,Bo,vs)}function Fr(t,e,r,o,h){if(!Me(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const g=h.get(t);if(g)return g;const p=Vo(t);if(p===0)return t;const v=new Proxy(t,p===2?o:r);return h.set(t,v),v}function Pt(t){return Nt(t)?Pt(t.__v_raw):!!(t&&t.__v_isReactive)}function Nt(t){return!!(t&&t.__v_isReadonly)}function Ei(t){return!!(t&&t.__v_isShallow)}function bs(t){return Pt(t)||Nt(t)}function xe(t){const e=t&&t.__v_raw;return e?xe(e):t}function Ss(t){return Ii(t,"__v_skip",!0),t}const ni=t=>Me(t)?Lr(t):t,Pr=t=>Me(t)?ys(t):t;function ws(t){gt&&qe&&(t=xe(t),ds(t.dep||(t.dep=Ar())))}function Cs(t,e){t=xe(t);const r=t.dep;r&&hr(r)}function Ne(t){return!!(t&&t.__v_isRef===!0)}function si(t){return Wo(t,!1)}function Wo(t,e){return Ne(t)?t:new Go(t,e)}class Go{constructor(e,r){this.__v_isShallow=r,this.dep=void 0,this.__v_isRef=!0,this._rawValue=r?e:xe(e),this._value=r?e:ni(e)}get value(){return ws(this),this._value}set value(e){const r=this.__v_isShallow||Ei(e)||Nt(e);e=r?e:xe(e),Ot(e,this._rawValue)&&(this._rawValue=e,this._value=r?e:ni(e),Cs(this))}}function Ho(t){return Ne(t)?t.value:t}const Yo={get:(t,e,r)=>Ho(Reflect.get(t,e,r)),set:(t,e,r,o)=>{const h=t[e];return Ne(h)&&!Ne(r)?(h.value=r,!0):Reflect.set(t,e,r,o)}};function xs(t){return Pt(t)?t:new Proxy(t,Yo)}class Xo{constructor(e,r,o,h){this._setter=r,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new Rr(e,()=>{this._dirty||(this._dirty=!0,Cs(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!h,this.__v_isReadonly=o}get value(){const e=xe(this);return ws(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function zo(t,e,r=!1){let o,h;const g=be(t);return g?(o=t,h=$e):(o=t.get,h=t.set),new Xo(o,h,g||!h,r)}function _t(t,e,r,o){let h;try{h=o?t(...o):t()}catch(g){Wi(g,e,r)}return h}function Qe(t,e,r,o){if(be(t)){const g=_t(t,e,r,o);return g&&os(g)&&g.catch(p=>{Wi(p,e,r)}),g}const h=[];for(let g=0;g<t.length;g++)h.push(Qe(t[g],e,r,o));return h}function Wi(t,e,r,o=!0){const h=e?e.vnode:null;if(e){let g=e.parent;const p=e.proxy,v=r;for(;g;){const w=g.ec;if(w){for(let x=0;x<w.length;x++)if(w[x](t,p,v)===!1)return}g=g.parent}const S=e.appContext.config.errorHandler;if(S){_t(S,null,10,[t,p,v]);return}}Ko(t,r,h,o)}function Ko(t,e,r,o=!0){console.error(t)}let oi=!1,ur=!1;const Be=[];let it=0;const kt=[];let st=null,St=0;const Ts=Promise.resolve();let kr=null;function qo(t){const e=kr||Ts;return t?e.then(this?t.bind(this):t):e}function Zo(t){let e=it+1,r=Be.length;for(;e<r;){const o=e+r>>>1,h=Be[o],g=ai(h);g<t||g===t&&h.pre?e=o+1:r=o}return e}function Br(t){(!Be.length||!Be.includes(t,oi&&t.allowRecurse?it+1:it))&&(t.id==null?Be.push(t):Be.splice(Zo(t.id),0,t),Is())}function Is(){!oi&&!ur&&(ur=!0,kr=Ts.then(Os))}function Jo(t){const e=Be.indexOf(t);e>it&&Be.splice(e,1)}function $o(t){ve(t)?kt.push(...t):(!st||!st.includes(t,t.allowRecurse?St+1:St))&&kt.push(t),Is()}function nn(t,e=oi?it+1:0){for(;e<Be.length;e++){const r=Be[e];r&&r.pre&&(Be.splice(e,1),e--,r())}}function Es(t){if(kt.length){const e=[...new Set(kt)];if(kt.length=0,st){st.push(...e);return}for(st=e,st.sort((r,o)=>ai(r)-ai(o)),St=0;St<st.length;St++)st[St]();st=null,St=0}}const ai=t=>t.id==null?1/0:t.id,Qo=(t,e)=>{const r=ai(t)-ai(e);if(r===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return r};function Os(t){ur=!1,oi=!0,Be.sort(Qo);const e=$e;try{for(it=0;it<Be.length;it++){const r=Be[it];r&&r.active!==!1&&_t(r,null,14)}}finally{it=0,Be.length=0,Es(),oi=!1,kr=null,(Be.length||kt.length)&&Os()}}function ea(t,e,...r){if(t.isUnmounted)return;const o=t.vnode.props||Re;let h=r;const g=e.startsWith("update:"),p=g&&e.slice(7);if(p&&p in o){const x=`${p==="modelValue"?"model":p}Modifiers`,{number:E,trim:A}=o[x]||Re;A&&(h=r.map(W=>Pe(W)?W.trim():W)),E&&(h=r.map(ho))}let v,S=o[v=Ji(e)]||o[v=Ji(Bt(e))];!S&&g&&(S=o[v=Ji(Wt(e))]),S&&Qe(S,t,6,h);const w=o[v+"Once"];if(w){if(!t.emitted)t.emitted={};else if(t.emitted[v])return;t.emitted[v]=!0,Qe(w,t,6,h)}}function As(t,e,r=!1){const o=e.emitsCache,h=o.get(t);if(h!==void 0)return h;const g=t.emits;let p={},v=!1;if(!be(t)){const S=w=>{const x=As(w,e,!0);x&&(v=!0,Fe(p,x))};!r&&e.mixins.length&&e.mixins.forEach(S),t.extends&&S(t.extends),t.mixins&&t.mixins.forEach(S)}return!g&&!v?(Me(t)&&o.set(t,null),null):(ve(g)?g.forEach(S=>p[S]=null):Fe(p,g),Me(t)&&o.set(t,p),p)}function Gi(t,e){return!t||!Bi(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ce(t,e[0].toLowerCase()+e.slice(1))||Ce(t,Wt(e))||Ce(t,e))}let Ze=null,Hi=null;function Oi(t){const e=Ze;return Ze=t,Hi=t&&t.type.__scopeId||null,e}function ta(t){Hi=t}function ia(){Hi=null}function ra(t,e=Ze,r){if(!e||t._n)return t;const o=(...h)=>{o._d&&gn(-1);const g=Oi(e);let p;try{p=t(...h)}finally{Oi(g),o._d&&gn(1)}return p};return o._n=!0,o._c=!0,o._d=!0,o}function Qi(t){const{type:e,vnode:r,proxy:o,withProxy:h,props:g,propsOptions:[p],slots:v,attrs:S,emit:w,render:x,renderCache:E,data:A,setupState:W,ctx:Y,inheritAttrs:z}=t;let q,te;const J=Oi(t);try{if(r.shapeFlag&4){const ee=h||o,he=ee;q=tt(x.call(he,ee,E,g,W,A,Y)),te=S}else{const ee=e;q=tt(ee.length>1?ee(g,{attrs:S,slots:v,emit:w}):ee(g,null)),te=e.props?S:na(S)}}catch(ee){ii.length=0,Wi(ee,t,1),q=rt(At)}let Z=q;if(te&&z!==!1){const ee=Object.keys(te),{shapeFlag:he}=Z;ee.length&&he&7&&(p&&ee.some(Tr)&&(te=sa(te,p)),Z=jt(Z,te))}return r.dirs&&(Z=jt(Z),Z.dirs=Z.dirs?Z.dirs.concat(r.dirs):r.dirs),r.transition&&(Z.transition=r.transition),q=Z,Oi(J),q}const na=t=>{let e;for(const r in t)(r==="class"||r==="style"||Bi(r))&&((e||(e={}))[r]=t[r]);return e},sa=(t,e)=>{const r={};for(const o in t)(!Tr(o)||!(o.slice(9)in e))&&(r[o]=t[o]);return r};function oa(t,e,r){const{props:o,children:h,component:g}=t,{props:p,children:v,patchFlag:S}=e,w=g.emitsOptions;if(e.dirs||e.transition)return!0;if(r&&S>=0){if(S&1024)return!0;if(S&16)return o?sn(o,p,w):!!p;if(S&8){const x=e.dynamicProps;for(let E=0;E<x.length;E++){const A=x[E];if(p[A]!==o[A]&&!Gi(w,A))return!0}}}else return(h||v)&&(!v||!v.$stable)?!0:o===p?!1:o?p?sn(o,p,w):!0:!!p;return!1}function sn(t,e,r){const o=Object.keys(e);if(o.length!==Object.keys(t).length)return!0;for(let h=0;h<o.length;h++){const g=o[h];if(e[g]!==t[g]&&!Gi(r,g))return!0}return!1}function aa({vnode:t,parent:e},r){for(;e&&e.subTree===t;)(t=e.vnode).el=r,e=e.parent}const la=Symbol.for("v-ndc"),ca=t=>t.__isSuspense;function ha(t,e){e&&e.pendingBranch?ve(t)?e.effects.push(...t):e.effects.push(t):$o(t)}const pi={};function er(t,e,r){return Rs(t,e,r)}function Rs(t,e,{immediate:r,deep:o,flush:h,onTrack:g,onTrigger:p}=Re){var v;const S=bo()===((v=Le)==null?void 0:v.scope)?Le:null;let w,x=!1,E=!1;if(Ne(t)?(w=()=>t.value,x=Ei(t)):Pt(t)?(w=()=>t,o=!0):ve(t)?(E=!0,x=t.some(ee=>Pt(ee)||Ei(ee)),w=()=>t.map(ee=>{if(Ne(ee))return ee.value;if(Pt(ee))return Lt(ee);if(be(ee))return _t(ee,S,2)})):be(t)?e?w=()=>_t(t,S,2):w=()=>{if(!(S&&S.isUnmounted))return A&&A(),Qe(t,S,3,[W])}:w=$e,e&&o){const ee=w;w=()=>Lt(ee())}let A,W=ee=>{A=J.onStop=()=>{_t(ee,S,4),A=J.onStop=void 0}},Y;if(ci)if(W=$e,e?r&&Qe(e,S,3,[w(),E?[]:void 0,W]):w(),h==="sync"){const ee=nl();Y=ee.__watcherHandles||(ee.__watcherHandles=[])}else return $e;let z=E?new Array(t.length).fill(pi):pi;const q=()=>{if(J.active)if(e){const ee=J.run();(o||x||(E?ee.some((he,fe)=>Ot(he,z[fe])):Ot(ee,z)))&&(A&&A(),Qe(e,S,3,[ee,z===pi?void 0:E&&z[0]===pi?[]:z,W]),z=ee)}else J.run()};q.allowRecurse=!!e;let te;h==="sync"?te=q:h==="post"?te=()=>Ve(q,S&&S.suspense):(q.pre=!0,S&&(q.id=S.uid),te=()=>Br(q));const J=new Rr(w,te);e?r?q():z=J.run():h==="post"?Ve(J.run.bind(J),S&&S.suspense):J.run();const Z=()=>{J.stop(),S&&S.scope&&Ir(S.scope.effects,J)};return Y&&Y.push(Z),Z}function ua(t,e,r){const o=this.proxy,h=Pe(t)?t.includes(".")?Ds(o,t):()=>o[t]:t.bind(o,o);let g;be(e)?g=e:(g=e.handler,r=e);const p=Le;Vt(this);const v=Rs(h,g.bind(o),r);return p?Vt(p):It(),v}function Ds(t,e){const r=e.split(".");return()=>{let o=t;for(let h=0;h<r.length&&o;h++)o=o[r[h]];return o}}function Lt(t,e){if(!Me(t)||t.__v_skip||(e=e||new Set,e.has(t)))return t;if(e.add(t),Ne(t))Lt(t.value,e);else if(ve(t))for(let r=0;r<t.length;r++)Lt(t[r],e);else if(no(t)||ei(t))t.forEach(r=>{Lt(r,e)});else if(ao(t))for(const r in t)Lt(t[r],e);return t}function yt(t,e,r,o){const h=t.dirs,g=e&&e.dirs;for(let p=0;p<h.length;p++){const v=h[p];g&&(v.oldValue=g[p].value);let S=v.dir[o];S&&(Gt(),Qe(S,r,8,[t.el,v,t,e]),Ht())}}/*! #__NO_SIDE_EFFECTS__ */function Yi(t,e){return be(t)?(()=>Fe({name:t.name},e,{setup:t}))():t}const Si=t=>!!t.type.__asyncLoader,Ms=t=>t.type.__isKeepAlive;function da(t,e){Ls(t,"a",e)}function fa(t,e){Ls(t,"da",e)}function Ls(t,e,r=Le){const o=t.__wdc||(t.__wdc=()=>{let h=r;for(;h;){if(h.isDeactivated)return;h=h.parent}return t()});if(Xi(e,o,r),r){let h=r.parent;for(;h&&h.parent;)Ms(h.parent.vnode)&&ga(o,e,r,h),h=h.parent}}function ga(t,e,r,o){const h=Xi(e,t,o,!0);Fs(()=>{Ir(o[e],h)},r)}function Xi(t,e,r=Le,o=!1){if(r){const h=r[t]||(r[t]=[]),g=e.__weh||(e.__weh=(...p)=>{if(r.isUnmounted)return;Gt(),Vt(r);const v=Qe(e,r,t,p);return It(),Ht(),v});return o?h.unshift(g):h.push(g),g}}const ut=t=>(e,r=Le)=>(!ci||t==="sp")&&Xi(t,(...o)=>e(...o),r),_a=ut("bm"),Nr=ut("m"),pa=ut("bu"),ma=ut("u"),jr=ut("bum"),Fs=ut("um"),va=ut("sp"),ya=ut("rtg"),ba=ut("rtc");function Sa(t,e=Le){Xi("ec",t,e)}const dr=t=>t?Xs(t)?Yr(t)||t.proxy:dr(t.parent):null,ti=Fe(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>dr(t.parent),$root:t=>dr(t.root),$emit:t=>t.emit,$options:t=>Vr(t),$forceUpdate:t=>t.f||(t.f=()=>Br(t.update)),$nextTick:t=>t.n||(t.n=qo.bind(t.proxy)),$watch:t=>ua.bind(t)}),tr=(t,e)=>t!==Re&&!t.__isScriptSetup&&Ce(t,e),wa={get({_:t},e){const{ctx:r,setupState:o,data:h,props:g,accessCache:p,type:v,appContext:S}=t;let w;if(e[0]!=="$"){const W=p[e];if(W!==void 0)switch(W){case 1:return o[e];case 2:return h[e];case 4:return r[e];case 3:return g[e]}else{if(tr(o,e))return p[e]=1,o[e];if(h!==Re&&Ce(h,e))return p[e]=2,h[e];if((w=t.propsOptions[0])&&Ce(w,e))return p[e]=3,g[e];if(r!==Re&&Ce(r,e))return p[e]=4,r[e];fr&&(p[e]=0)}}const x=ti[e];let E,A;if(x)return e==="$attrs"&&Ue(t,"get",e),x(t);if((E=v.__cssModules)&&(E=E[e]))return E;if(r!==Re&&Ce(r,e))return p[e]=4,r[e];if(A=S.config.globalProperties,Ce(A,e))return A[e]},set({_:t},e,r){const{data:o,setupState:h,ctx:g}=t;return tr(h,e)?(h[e]=r,!0):o!==Re&&Ce(o,e)?(o[e]=r,!0):Ce(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(g[e]=r,!0)},has({_:{data:t,setupState:e,accessCache:r,ctx:o,appContext:h,propsOptions:g}},p){let v;return!!r[p]||t!==Re&&Ce(t,p)||tr(e,p)||(v=g[0])&&Ce(v,p)||Ce(o,p)||Ce(ti,p)||Ce(h.config.globalProperties,p)},defineProperty(t,e,r){return r.get!=null?t._.accessCache[e]=0:Ce(r,"value")&&this.set(t,e,r.value,null),Reflect.defineProperty(t,e,r)}};function on(t){return ve(t)?t.reduce((e,r)=>(e[r]=null,e),{}):t}let fr=!0;function Ca(t){const e=Vr(t),r=t.proxy,o=t.ctx;fr=!1,e.beforeCreate&&an(e.beforeCreate,t,"bc");const{data:h,computed:g,methods:p,watch:v,provide:S,inject:w,created:x,beforeMount:E,mounted:A,beforeUpdate:W,updated:Y,activated:z,deactivated:q,beforeDestroy:te,beforeUnmount:J,destroyed:Z,unmounted:ee,render:he,renderTracked:fe,renderTriggered:_e,errorCaptured:y,serverPrefetch:ge,expose:pe,inheritAttrs:Te,components:l,directives:s,filters:a}=e;if(w&&xa(w,o,null),p)for(const n in p){const c=p[n];be(c)&&(o[n]=c.bind(r))}if(h){const n=h.call(r,r);Me(n)&&(t.data=Lr(n))}if(fr=!0,g)for(const n in g){const c=g[n],_=be(c)?c.bind(r,r):be(c.get)?c.get.bind(r,r):$e,d=!be(c)&&be(c.set)?c.set.bind(r):$e,f=il({get:_,set:d});Object.defineProperty(o,n,{enumerable:!0,configurable:!0,get:()=>f.value,set:m=>f.value=m})}if(v)for(const n in v)Ps(v[n],o,r,n);if(S){const n=be(S)?S.call(r):S;Reflect.ownKeys(n).forEach(c=>{Ra(c,n[c])})}x&&an(x,t,"c");function i(n,c){ve(c)?c.forEach(_=>n(_.bind(r))):c&&n(c.bind(r))}if(i(_a,E),i(Nr,A),i(pa,W),i(ma,Y),i(da,z),i(fa,q),i(Sa,y),i(ba,fe),i(ya,_e),i(jr,J),i(Fs,ee),i(va,ge),ve(pe))if(pe.length){const n=t.exposed||(t.exposed={});pe.forEach(c=>{Object.defineProperty(n,c,{get:()=>r[c],set:_=>r[c]=_})})}else t.exposed||(t.exposed={});he&&t.render===$e&&(t.render=he),Te!=null&&(t.inheritAttrs=Te),l&&(t.components=l),s&&(t.directives=s)}function xa(t,e,r=$e){ve(t)&&(t=gr(t));for(const o in t){const h=t[o];let g;Me(h)?"default"in h?g=wi(h.from||o,h.default,!0):g=wi(h.from||o):g=wi(h),Ne(g)?Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get:()=>g.value,set:p=>g.value=p}):e[o]=g}}function an(t,e,r){Qe(ve(t)?t.map(o=>o.bind(e.proxy)):t.bind(e.proxy),e,r)}function Ps(t,e,r,o){const h=o.includes(".")?Ds(r,o):()=>r[o];if(Pe(t)){const g=e[t];be(g)&&er(h,g)}else if(be(t))er(h,t.bind(r));else if(Me(t))if(ve(t))t.forEach(g=>Ps(g,e,r,o));else{const g=be(t.handler)?t.handler.bind(r):e[t.handler];be(g)&&er(h,g,t)}}function Vr(t){const e=t.type,{mixins:r,extends:o}=e,{mixins:h,optionsCache:g,config:{optionMergeStrategies:p}}=t.appContext,v=g.get(e);let S;return v?S=v:!h.length&&!r&&!o?S=e:(S={},h.length&&h.forEach(w=>Ai(S,w,p,!0)),Ai(S,e,p)),Me(e)&&g.set(e,S),S}function Ai(t,e,r,o=!1){const{mixins:h,extends:g}=e;g&&Ai(t,g,r,!0),h&&h.forEach(p=>Ai(t,p,r,!0));for(const p in e)if(!(o&&p==="expose")){const v=Ta[p]||r&&r[p];t[p]=v?v(t[p],e[p]):e[p]}return t}const Ta={data:ln,props:cn,emits:cn,methods:Qt,computed:Qt,beforeCreate:je,created:je,beforeMount:je,mounted:je,beforeUpdate:je,updated:je,beforeDestroy:je,beforeUnmount:je,destroyed:je,unmounted:je,activated:je,deactivated:je,errorCaptured:je,serverPrefetch:je,components:Qt,directives:Qt,watch:Ea,provide:ln,inject:Ia};function ln(t,e){return e?t?function(){return Fe(be(t)?t.call(this,this):t,be(e)?e.call(this,this):e)}:e:t}function Ia(t,e){return Qt(gr(t),gr(e))}function gr(t){if(ve(t)){const e={};for(let r=0;r<t.length;r++)e[t[r]]=t[r];return e}return t}function je(t,e){return t?[...new Set([].concat(t,e))]:e}function Qt(t,e){return t?Fe(Object.create(null),t,e):e}function cn(t,e){return t?ve(t)&&ve(e)?[...new Set([...t,...e])]:Fe(Object.create(null),on(t),on(e??{})):e}function Ea(t,e){if(!t)return e;if(!e)return t;const r=Fe(Object.create(null),t);for(const o in e)r[o]=je(t[o],e[o]);return r}function ks(){return{app:null,config:{isNativeTag:io,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Oa=0;function Aa(t,e){return function(o,h=null){be(o)||(o=Fe({},o)),h!=null&&!Me(h)&&(h=null);const g=ks(),p=new WeakSet;let v=!1;const S=g.app={_uid:Oa++,_component:o,_props:h,_container:null,_context:g,_instance:null,version:sl,get config(){return g.config},set config(w){},use(w,...x){return p.has(w)||(w&&be(w.install)?(p.add(w),w.install(S,...x)):be(w)&&(p.add(w),w(S,...x))),S},mixin(w){return g.mixins.includes(w)||g.mixins.push(w),S},component(w,x){return x?(g.components[w]=x,S):g.components[w]},directive(w,x){return x?(g.directives[w]=x,S):g.directives[w]},mount(w,x,E){if(!v){const A=rt(o,h);return A.appContext=g,x&&e?e(A,w):t(A,w,E),v=!0,S._container=w,w.__vue_app__=S,Yr(A.component)||A.component.proxy}},unmount(){v&&(t(null,S._container),delete S._container.__vue_app__)},provide(w,x){return g.provides[w]=x,S},runWithContext(w){Ri=S;try{return w()}finally{Ri=null}}};return S}}let Ri=null;function Ra(t,e){if(Le){let r=Le.provides;const o=Le.parent&&Le.parent.provides;o===r&&(r=Le.provides=Object.create(o)),r[t]=e}}function wi(t,e,r=!1){const o=Le||Ze;if(o||Ri){const h=o?o.parent==null?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides:Ri._context.provides;if(h&&t in h)return h[t];if(arguments.length>1)return r&&be(e)?e.call(o&&o.proxy):e}}function Da(t,e,r,o=!1){const h={},g={};Ii(g,Ki,1),t.propsDefaults=Object.create(null),Bs(t,e,h,g);for(const p in t.propsOptions[0])p in h||(h[p]=void 0);r?t.props=o?h:Uo(h):t.type.props?t.props=h:t.props=g,t.attrs=g}function Ma(t,e,r,o){const{props:h,attrs:g,vnode:{patchFlag:p}}=t,v=xe(h),[S]=t.propsOptions;let w=!1;if((o||p>0)&&!(p&16)){if(p&8){const x=t.vnode.dynamicProps;for(let E=0;E<x.length;E++){let A=x[E];if(Gi(t.emitsOptions,A))continue;const W=e[A];if(S)if(Ce(g,A))W!==g[A]&&(g[A]=W,w=!0);else{const Y=Bt(A);h[Y]=_r(S,v,Y,W,t,!1)}else W!==g[A]&&(g[A]=W,w=!0)}}}else{Bs(t,e,h,g)&&(w=!0);let x;for(const E in v)(!e||!Ce(e,E)&&((x=Wt(E))===E||!Ce(e,x)))&&(S?r&&(r[E]!==void 0||r[x]!==void 0)&&(h[E]=_r(S,v,E,void 0,t,!0)):delete h[E]);if(g!==v)for(const E in g)(!e||!Ce(e,E))&&(delete g[E],w=!0)}w&&ht(t,"set","$attrs")}function Bs(t,e,r,o){const[h,g]=t.propsOptions;let p=!1,v;if(e)for(let S in e){if(bi(S))continue;const w=e[S];let x;h&&Ce(h,x=Bt(S))?!g||!g.includes(x)?r[x]=w:(v||(v={}))[x]=w:Gi(t.emitsOptions,S)||(!(S in o)||w!==o[S])&&(o[S]=w,p=!0)}if(g){const S=xe(r),w=v||Re;for(let x=0;x<g.length;x++){const E=g[x];r[E]=_r(h,S,E,w[E],t,!Ce(w,E))}}return p}function _r(t,e,r,o,h,g){const p=t[r];if(p!=null){const v=Ce(p,"default");if(v&&o===void 0){const S=p.default;if(p.type!==Function&&!p.skipFactory&&be(S)){const{propsDefaults:w}=h;r in w?o=w[r]:(Vt(h),o=w[r]=S.call(null,e),It())}else o=S}p[0]&&(g&&!v?o=!1:p[1]&&(o===""||o===Wt(r))&&(o=!0))}return o}function Ns(t,e,r=!1){const o=e.propsCache,h=o.get(t);if(h)return h;const g=t.props,p={},v=[];let S=!1;if(!be(t)){const x=E=>{S=!0;const[A,W]=Ns(E,e,!0);Fe(p,A),W&&v.push(...W)};!r&&e.mixins.length&&e.mixins.forEach(x),t.extends&&x(t.extends),t.mixins&&t.mixins.forEach(x)}if(!g&&!S)return Me(t)&&o.set(t,Ft),Ft;if(ve(g))for(let x=0;x<g.length;x++){const E=Bt(g[x]);hn(E)&&(p[E]=Re)}else if(g)for(const x in g){const E=Bt(x);if(hn(E)){const A=g[x],W=p[E]=ve(A)||be(A)?{type:A}:Fe({},A);if(W){const Y=fn(Boolean,W.type),z=fn(String,W.type);W[0]=Y>-1,W[1]=z<0||Y<z,(Y>-1||Ce(W,"default"))&&v.push(E)}}}const w=[p,v];return Me(t)&&o.set(t,w),w}function hn(t){return t[0]!=="$"}function un(t){const e=t&&t.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:t===null?"null":""}function dn(t,e){return un(t)===un(e)}function fn(t,e){return ve(e)?e.findIndex(r=>dn(r,t)):be(e)&&dn(e,t)?0:-1}const js=t=>t[0]==="_"||t==="$stable",Ur=t=>ve(t)?t.map(tt):[tt(t)],La=(t,e,r)=>{if(e._n)return e;const o=ra((...h)=>Ur(e(...h)),r);return o._c=!1,o},Vs=(t,e,r)=>{const o=t._ctx;for(const h in t){if(js(h))continue;const g=t[h];if(be(g))e[h]=La(h,g,o);else if(g!=null){const p=Ur(g);e[h]=()=>p}}},Us=(t,e)=>{const r=Ur(e);t.slots.default=()=>r},Fa=(t,e)=>{if(t.vnode.shapeFlag&32){const r=e._;r?(t.slots=xe(e),Ii(e,"_",r)):Vs(e,t.slots={})}else t.slots={},e&&Us(t,e);Ii(t.slots,Ki,1)},Pa=(t,e,r)=>{const{vnode:o,slots:h}=t;let g=!0,p=Re;if(o.shapeFlag&32){const v=e._;v?r&&v===1?g=!1:(Fe(h,e),!r&&v===1&&delete h._):(g=!e.$stable,Vs(e,h)),p=e}else e&&(Us(t,e),p={default:1});if(g)for(const v in h)!js(v)&&p[v]==null&&delete h[v]};function pr(t,e,r,o,h=!1){if(ve(t)){t.forEach((A,W)=>pr(A,e&&(ve(e)?e[W]:e),r,o,h));return}if(Si(o)&&!h)return;const g=o.shapeFlag&4?Yr(o.component)||o.component.proxy:o.el,p=h?null:g,{i:v,r:S}=t,w=e&&e.r,x=v.refs===Re?v.refs={}:v.refs,E=v.setupState;if(w!=null&&w!==S&&(Pe(w)?(x[w]=null,Ce(E,w)&&(E[w]=null)):Ne(w)&&(w.value=null)),be(S))_t(S,v,12,[p,x]);else{const A=Pe(S),W=Ne(S);if(A||W){const Y=()=>{if(t.f){const z=A?Ce(E,S)?E[S]:x[S]:S.value;h?ve(z)&&Ir(z,g):ve(z)?z.includes(g)||z.push(g):A?(x[S]=[g],Ce(E,S)&&(E[S]=x[S])):(S.value=[g],t.k&&(x[t.k]=S.value))}else A?(x[S]=p,Ce(E,S)&&(E[S]=p)):W&&(S.value=p,t.k&&(x[t.k]=p))};p?(Y.id=-1,Ve(Y,r)):Y()}}}const Ve=ha;function ka(t){return Ba(t)}function Ba(t,e){const r=or();r.__VUE__=!0;const{insert:o,remove:h,patchProp:g,createElement:p,createText:v,createComment:S,setText:w,setElementText:x,parentNode:E,nextSibling:A,setScopeId:W=$e,insertStaticContent:Y}=t,z=(O,M,D,L=null,k=null,V=null,G=!1,P=null,F=!!M.dynamicChildren)=>{if(O===M)return;O&&!Kt(O,M)&&(L=R(O),m(O,k,V,!0),O=null),M.patchFlag===-2&&(F=!1,M.dynamicChildren=null);const{type:N,ref:K,shapeFlag:H}=M;switch(N){case zi:q(O,M,D,L);break;case At:te(O,M,D,L);break;case Ci:O==null&&J(M,D,L,G);break;case ot:l(O,M,D,L,k,V,G,P,F);break;default:H&1?he(O,M,D,L,k,V,G,P,F):H&6?s(O,M,D,L,k,V,G,P,F):(H&64||H&128)&&N.process(O,M,D,L,k,V,G,P,F,U)}K!=null&&k&&pr(K,O&&O.ref,V,M||O,!M)},q=(O,M,D,L)=>{if(O==null)o(M.el=v(M.children),D,L);else{const k=M.el=O.el;M.children!==O.children&&w(k,M.children)}},te=(O,M,D,L)=>{O==null?o(M.el=S(M.children||""),D,L):M.el=O.el},J=(O,M,D,L)=>{[O.el,O.anchor]=Y(O.children,M,D,L,O.el,O.anchor)},Z=({el:O,anchor:M},D,L)=>{let k;for(;O&&O!==M;)k=A(O),o(O,D,L),O=k;o(M,D,L)},ee=({el:O,anchor:M})=>{let D;for(;O&&O!==M;)D=A(O),h(O),O=D;h(M)},he=(O,M,D,L,k,V,G,P,F)=>{G=G||M.type==="svg",O==null?fe(M,D,L,k,V,G,P,F):ge(O,M,k,V,G,P,F)},fe=(O,M,D,L,k,V,G,P)=>{let F,N;const{type:K,props:H,shapeFlag:$,transition:ie,dirs:re}=O;if(F=O.el=p(O.type,V,H&&H.is,H),$&8?x(F,O.children):$&16&&y(O.children,F,null,L,k,V&&K!=="foreignObject",G,P),re&&yt(O,null,L,"created"),_e(F,O,O.scopeId,G,L),H){for(const oe in H)oe!=="value"&&!bi(oe)&&g(F,oe,null,H[oe],V,O.children,L,k,T);"value"in H&&g(F,"value",null,H.value),(N=H.onVnodeBeforeMount)&&et(N,L,O)}re&&yt(O,null,L,"beforeMount");const ne=Na(k,ie);ne&&ie.beforeEnter(F),o(F,M,D),((N=H&&H.onVnodeMounted)||ne||re)&&Ve(()=>{N&&et(N,L,O),ne&&ie.enter(F),re&&yt(O,null,L,"mounted")},k)},_e=(O,M,D,L,k)=>{if(D&&W(O,D),L)for(let V=0;V<L.length;V++)W(O,L[V]);if(k){let V=k.subTree;if(M===V){const G=k.vnode;_e(O,G,G.scopeId,G.slotScopeIds,k.parent)}}},y=(O,M,D,L,k,V,G,P,F=0)=>{for(let N=F;N<O.length;N++){const K=O[N]=P?ft(O[N]):tt(O[N]);z(null,K,M,D,L,k,V,G,P)}},ge=(O,M,D,L,k,V,G)=>{const P=M.el=O.el;let{patchFlag:F,dynamicChildren:N,dirs:K}=M;F|=O.patchFlag&16;const H=O.props||Re,$=M.props||Re;let ie;D&&bt(D,!1),(ie=$.onVnodeBeforeUpdate)&&et(ie,D,M,O),K&&yt(M,O,D,"beforeUpdate"),D&&bt(D,!0);const re=k&&M.type!=="foreignObject";if(N?pe(O.dynamicChildren,N,P,D,L,re,V):G||c(O,M,P,null,D,L,re,V,!1),F>0){if(F&16)Te(P,M,H,$,D,L,k);else if(F&2&&H.class!==$.class&&g(P,"class",null,$.class,k),F&4&&g(P,"style",H.style,$.style,k),F&8){const ne=M.dynamicProps;for(let oe=0;oe<ne.length;oe++){const ae=ne[oe],ce=H[ae],de=$[ae];(de!==ce||ae==="value")&&g(P,ae,ce,de,k,O.children,D,L,T)}}F&1&&O.children!==M.children&&x(P,M.children)}else!G&&N==null&&Te(P,M,H,$,D,L,k);((ie=$.onVnodeUpdated)||K)&&Ve(()=>{ie&&et(ie,D,M,O),K&&yt(M,O,D,"updated")},L)},pe=(O,M,D,L,k,V,G)=>{for(let P=0;P<M.length;P++){const F=O[P],N=M[P],K=F.el&&(F.type===ot||!Kt(F,N)||F.shapeFlag&70)?E(F.el):D;z(F,N,K,null,L,k,V,G,!0)}},Te=(O,M,D,L,k,V,G)=>{if(D!==L){if(D!==Re)for(const P in D)!bi(P)&&!(P in L)&&g(O,P,D[P],null,G,M.children,k,V,T);for(const P in L){if(bi(P))continue;const F=L[P],N=D[P];F!==N&&P!=="value"&&g(O,P,N,F,G,M.children,k,V,T)}"value"in L&&g(O,"value",D.value,L.value)}},l=(O,M,D,L,k,V,G,P,F)=>{const N=M.el=O?O.el:v(""),K=M.anchor=O?O.anchor:v("");let{patchFlag:H,dynamicChildren:$,slotScopeIds:ie}=M;ie&&(P=P?P.concat(ie):ie),O==null?(o(N,D,L),o(K,D,L),y(M.children,D,K,k,V,G,P,F)):H>0&&H&64&&$&&O.dynamicChildren?(pe(O.dynamicChildren,$,D,k,V,G,P),(M.key!=null||k&&M===k.subTree)&&Ws(O,M,!0)):c(O,M,D,K,k,V,G,P,F)},s=(O,M,D,L,k,V,G,P,F)=>{M.slotScopeIds=P,O==null?M.shapeFlag&512?k.ctx.activate(M,D,L,G,F):a(M,D,L,k,V,G,F):u(O,M,F)},a=(O,M,D,L,k,V,G)=>{const P=O.component=qa(O,L,k);if(Ms(O)&&(P.ctx.renderer=U),Ja(P),P.asyncDep){if(k&&k.registerDep(P,i),!O.el){const F=P.subTree=rt(At);te(null,F,M,D)}return}i(P,O,M,D,k,V,G)},u=(O,M,D)=>{const L=M.component=O.component;if(oa(O,M,D))if(L.asyncDep&&!L.asyncResolved){n(L,M,D);return}else L.next=M,Jo(L.update),L.update();else M.el=O.el,L.vnode=M},i=(O,M,D,L,k,V,G)=>{const P=()=>{if(O.isMounted){let{next:K,bu:H,u:$,parent:ie,vnode:re}=O,ne=K,oe;bt(O,!1),K?(K.el=re.el,n(O,K,G)):K=re,H&&$i(H),(oe=K.props&&K.props.onVnodeBeforeUpdate)&&et(oe,ie,K,re),bt(O,!0);const ae=Qi(O),ce=O.subTree;O.subTree=ae,z(ce,ae,E(ce.el),R(ce),O,k,V),K.el=ae.el,ne===null&&aa(O,ae.el),$&&Ve($,k),(oe=K.props&&K.props.onVnodeUpdated)&&Ve(()=>et(oe,ie,K,re),k)}else{let K;const{el:H,props:$}=M,{bm:ie,m:re,parent:ne}=O,oe=Si(M);if(bt(O,!1),ie&&$i(ie),!oe&&(K=$&&$.onVnodeBeforeMount)&&et(K,ne,M),bt(O,!0),H&&Q){const ae=()=>{O.subTree=Qi(O),Q(H,O.subTree,O,k,null)};oe?M.type.__asyncLoader().then(()=>!O.isUnmounted&&ae()):ae()}else{const ae=O.subTree=Qi(O);z(null,ae,D,L,O,k,V),M.el=ae.el}if(re&&Ve(re,k),!oe&&(K=$&&$.onVnodeMounted)){const ae=M;Ve(()=>et(K,ne,ae),k)}(M.shapeFlag&256||ne&&Si(ne.vnode)&&ne.vnode.shapeFlag&256)&&O.a&&Ve(O.a,k),O.isMounted=!0,M=D=L=null}},F=O.effect=new Rr(P,()=>Br(N),O.scope),N=O.update=()=>F.run();N.id=O.uid,bt(O,!0),N()},n=(O,M,D)=>{M.component=O;const L=O.vnode.props;O.vnode=M,O.next=null,Ma(O,M.props,L,D),Pa(O,M.children,D),Gt(),nn(),Ht()},c=(O,M,D,L,k,V,G,P,F=!1)=>{const N=O&&O.children,K=O?O.shapeFlag:0,H=M.children,{patchFlag:$,shapeFlag:ie}=M;if($>0){if($&128){d(N,H,D,L,k,V,G,P,F);return}else if($&256){_(N,H,D,L,k,V,G,P,F);return}}ie&8?(K&16&&T(N,k,V),H!==N&&x(D,H)):K&16?ie&16?d(N,H,D,L,k,V,G,P,F):T(N,k,V,!0):(K&8&&x(D,""),ie&16&&y(H,D,L,k,V,G,P,F))},_=(O,M,D,L,k,V,G,P,F)=>{O=O||Ft,M=M||Ft;const N=O.length,K=M.length,H=Math.min(N,K);let $;for($=0;$<H;$++){const ie=M[$]=F?ft(M[$]):tt(M[$]);z(O[$],ie,D,null,k,V,G,P,F)}N>K?T(O,k,V,!0,!1,H):y(M,D,L,k,V,G,P,F,H)},d=(O,M,D,L,k,V,G,P,F)=>{let N=0;const K=M.length;let H=O.length-1,$=K-1;for(;N<=H&&N<=$;){const ie=O[N],re=M[N]=F?ft(M[N]):tt(M[N]);if(Kt(ie,re))z(ie,re,D,null,k,V,G,P,F);else break;N++}for(;N<=H&&N<=$;){const ie=O[H],re=M[$]=F?ft(M[$]):tt(M[$]);if(Kt(ie,re))z(ie,re,D,null,k,V,G,P,F);else break;H--,$--}if(N>H){if(N<=$){const ie=$+1,re=ie<K?M[ie].el:L;for(;N<=$;)z(null,M[N]=F?ft(M[N]):tt(M[N]),D,re,k,V,G,P,F),N++}}else if(N>$)for(;N<=H;)m(O[N],k,V,!0),N++;else{const ie=N,re=N,ne=new Map;for(N=re;N<=$;N++){const Ie=M[N]=F?ft(M[N]):tt(M[N]);Ie.key!=null&&ne.set(Ie.key,N)}let oe,ae=0;const ce=$-re+1;let de=!1,ue=0;const me=new Array(ce);for(N=0;N<ce;N++)me[N]=0;for(N=ie;N<=H;N++){const Ie=O[N];if(ae>=ce){m(Ie,k,V,!0);continue}let De;if(Ie.key!=null)De=ne.get(Ie.key);else for(oe=re;oe<=$;oe++)if(me[oe-re]===0&&Kt(Ie,M[oe])){De=oe;break}De===void 0?m(Ie,k,V,!0):(me[De-re]=N+1,De>=ue?ue=De:de=!0,z(Ie,M[De],D,null,k,V,G,P,F),ae++)}const we=de?ja(me):Ft;for(oe=we.length-1,N=ce-1;N>=0;N--){const Ie=re+N,De=M[Ie],nt=Ie+1<K?M[Ie+1].el:L;me[N]===0?z(null,De,D,nt,k,V,G,P,F):de&&(oe<0||N!==we[oe]?f(De,D,nt,2):oe--)}}},f=(O,M,D,L,k=null)=>{const{el:V,type:G,transition:P,children:F,shapeFlag:N}=O;if(N&6){f(O.component.subTree,M,D,L);return}if(N&128){O.suspense.move(M,D,L);return}if(N&64){G.move(O,M,D,U);return}if(G===ot){o(V,M,D);for(let H=0;H<F.length;H++)f(F[H],M,D,L);o(O.anchor,M,D);return}if(G===Ci){Z(O,M,D);return}if(L!==2&&N&1&&P)if(L===0)P.beforeEnter(V),o(V,M,D),Ve(()=>P.enter(V),k);else{const{leave:H,delayLeave:$,afterLeave:ie}=P,re=()=>o(V,M,D),ne=()=>{H(V,()=>{re(),ie&&ie()})};$?$(V,re,ne):ne()}else o(V,M,D)},m=(O,M,D,L=!1,k=!1)=>{const{type:V,props:G,ref:P,children:F,dynamicChildren:N,shapeFlag:K,patchFlag:H,dirs:$}=O;if(P!=null&&pr(P,null,D,O,!0),K&256){M.ctx.deactivate(O);return}const ie=K&1&&$,re=!Si(O);let ne;if(re&&(ne=G&&G.onVnodeBeforeUnmount)&&et(ne,M,O),K&6)I(O.component,D,L);else{if(K&128){O.suspense.unmount(D,L);return}ie&&yt(O,null,M,"beforeUnmount"),K&64?O.type.remove(O,M,D,k,U,L):N&&(V!==ot||H>0&&H&64)?T(N,M,D,!1,!0):(V===ot&&H&384||!k&&K&16)&&T(F,M,D),L&&b(O)}(re&&(ne=G&&G.onVnodeUnmounted)||ie)&&Ve(()=>{ne&&et(ne,M,O),ie&&yt(O,null,M,"unmounted")},D)},b=O=>{const{type:M,el:D,anchor:L,transition:k}=O;if(M===ot){C(D,L);return}if(M===Ci){ee(O);return}const V=()=>{h(D),k&&!k.persisted&&k.afterLeave&&k.afterLeave()};if(O.shapeFlag&1&&k&&!k.persisted){const{leave:G,delayLeave:P}=k,F=()=>G(D,V);P?P(O.el,V,F):F()}else V()},C=(O,M)=>{let D;for(;O!==M;)D=A(O),h(O),O=D;h(M)},I=(O,M,D)=>{const{bum:L,scope:k,update:V,subTree:G,um:P}=O;L&&$i(L),k.stop(),V&&(V.active=!1,m(G,O,M,D)),P&&Ve(P,M),Ve(()=>{O.isUnmounted=!0},M),M&&M.pendingBranch&&!M.isUnmounted&&O.asyncDep&&!O.asyncResolved&&O.suspenseId===M.pendingId&&(M.deps--,M.deps===0&&M.resolve())},T=(O,M,D,L=!1,k=!1,V=0)=>{for(let G=V;G<O.length;G++)m(O[G],M,D,L,k)},R=O=>O.shapeFlag&6?R(O.component.subTree):O.shapeFlag&128?O.suspense.next():A(O.anchor||O.el),B=(O,M,D)=>{O==null?M._vnode&&m(M._vnode,null,null,!0):z(M._vnode||null,O,M,null,null,null,D),nn(),Es(),M._vnode=O},U={p:z,um:m,m:f,r:b,mt:a,mc:y,pc:c,pbc:pe,n:R,o:t};let X,Q;return e&&([X,Q]=e(U)),{render:B,hydrate:X,createApp:Aa(B,X)}}function bt({effect:t,update:e},r){t.allowRecurse=e.allowRecurse=r}function Na(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function Ws(t,e,r=!1){const o=t.children,h=e.children;if(ve(o)&&ve(h))for(let g=0;g<o.length;g++){const p=o[g];let v=h[g];v.shapeFlag&1&&!v.dynamicChildren&&((v.patchFlag<=0||v.patchFlag===32)&&(v=h[g]=ft(h[g]),v.el=p.el),r||Ws(p,v)),v.type===zi&&(v.el=p.el)}}function ja(t){const e=t.slice(),r=[0];let o,h,g,p,v;const S=t.length;for(o=0;o<S;o++){const w=t[o];if(w!==0){if(h=r[r.length-1],t[h]<w){e[o]=h,r.push(o);continue}for(g=0,p=r.length-1;g<p;)v=g+p>>1,t[r[v]]<w?g=v+1:p=v;w<t[r[g]]&&(g>0&&(e[o]=r[g-1]),r[g]=o)}}for(g=r.length,p=r[g-1];g-- >0;)r[g]=p,p=e[p];return r}const Va=t=>t.__isTeleport,ot=Symbol.for("v-fgt"),zi=Symbol.for("v-txt"),At=Symbol.for("v-cmt"),Ci=Symbol.for("v-stc"),ii=[];let Je=null;function Tt(t=!1){ii.push(Je=t?null:[])}function Ua(){ii.pop(),Je=ii[ii.length-1]||null}let li=1;function gn(t){li+=t}function Gs(t){return t.dynamicChildren=li>0?Je||Ft:null,Ua(),li>0&&Je&&Je.push(t),t}function Wr(t,e,r,o,h,g){return Gs(ct(t,e,r,o,h,g,!0))}function Di(t,e,r,o,h){return Gs(rt(t,e,r,o,h,!0))}function Wa(t){return t?t.__v_isVNode===!0:!1}function Kt(t,e){return t.type===e.type&&t.key===e.key}const Ki="__vInternal",Hs=({key:t})=>t??null,xi=({ref:t,ref_key:e,ref_for:r})=>(typeof t=="number"&&(t=""+t),t!=null?Pe(t)||Ne(t)||be(t)?{i:Ze,r:t,k:e,f:!!r}:t:null);function ct(t,e=null,r=null,o=0,h=null,g=t===ot?0:1,p=!1,v=!1){const S={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Hs(e),ref:e&&xi(e),scopeId:Hi,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:g,patchFlag:o,dynamicProps:h,dynamicChildren:null,appContext:null,ctx:Ze};return v?(Gr(S,r),g&128&&t.normalize(S)):r&&(S.shapeFlag|=Pe(r)?8:16),li>0&&!p&&Je&&(S.patchFlag>0||g&6)&&S.patchFlag!==32&&Je.push(S),S}const rt=Ga;function Ga(t,e=null,r=null,o=0,h=null,g=!1){if((!t||t===la)&&(t=At),Wa(t)){const v=jt(t,e,!0);return r&&Gr(v,r),li>0&&!g&&Je&&(v.shapeFlag&6?Je[Je.indexOf(t)]=v:Je.push(v)),v.patchFlag|=-2,v}if(tl(t)&&(t=t.__vccOpts),e){e=Ha(e);let{class:v,style:S}=e;v&&!Pe(v)&&(e.class=Or(v)),Me(S)&&(bs(S)&&!ve(S)&&(S=Fe({},S)),e.style=ri(S))}const p=Pe(t)?1:ca(t)?128:Va(t)?64:Me(t)?4:be(t)?2:0;return ct(t,e,r,o,h,p,g,!0)}function Ha(t){return t?bs(t)||Ki in t?Fe({},t):t:null}function jt(t,e,r=!1){const{props:o,ref:h,patchFlag:g,children:p}=t,v=e?Xa(o||{},e):o;return{__v_isVNode:!0,__v_skip:!0,type:t.type,props:v,key:v&&Hs(v),ref:e&&e.ref?r&&h?ve(h)?h.concat(xi(e)):[h,xi(e)]:xi(e):h,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:p,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==ot?g===-1?16:g|16:g,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&jt(t.ssContent),ssFallback:t.ssFallback&&jt(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce}}function Ys(t=" ",e=0){return rt(zi,null,t,e)}function Ya(t,e){const r=rt(Ci,null,t);return r.staticCount=e,r}function _n(t="",e=!1){return e?(Tt(),Di(At,null,t)):rt(At,null,t)}function tt(t){return t==null||typeof t=="boolean"?rt(At):ve(t)?rt(ot,null,t.slice()):typeof t=="object"?ft(t):rt(zi,null,String(t))}function ft(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:jt(t)}function Gr(t,e){let r=0;const{shapeFlag:o}=t;if(e==null)e=null;else if(ve(e))r=16;else if(typeof e=="object")if(o&65){const h=e.default;h&&(h._c&&(h._d=!1),Gr(t,h()),h._c&&(h._d=!0));return}else{r=32;const h=e._;!h&&!(Ki in e)?e._ctx=Ze:h===3&&Ze&&(Ze.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else be(e)?(e={default:e,_ctx:Ze},r=32):(e=String(e),o&64?(r=16,e=[Ys(e)]):r=8);t.children=e,t.shapeFlag|=r}function Xa(...t){const e={};for(let r=0;r<t.length;r++){const o=t[r];for(const h in o)if(h==="class")e.class!==o.class&&(e.class=Or([e.class,o.class]));else if(h==="style")e.style=ri([e.style,o.style]);else if(Bi(h)){const g=e[h],p=o[h];p&&g!==p&&!(ve(g)&&g.includes(p))&&(e[h]=g?[].concat(g,p):p)}else h!==""&&(e[h]=o[h])}return e}function et(t,e,r,o=null){Qe(t,e,7,[r,o])}const za=ks();let Ka=0;function qa(t,e,r){const o=t.type,h=(e?e.appContext:t.appContext)||za,g={uid:Ka++,vnode:t,type:o,parent:e,appContext:h,root:null,next:null,subTree:null,effect:null,update:null,scope:new vo(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(h.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ns(o,h),emitsOptions:As(o,h),emit:null,emitted:null,propsDefaults:Re,inheritAttrs:o.inheritAttrs,ctx:Re,data:Re,props:Re,attrs:Re,slots:Re,refs:Re,setupState:Re,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return g.ctx={_:g},g.root=e?e.root:g,g.emit=ea.bind(null,g),t.ce&&t.ce(g),g}let Le=null;const Za=()=>Le||Ze;let Hr,Mt,pn="__VUE_INSTANCE_SETTERS__";(Mt=or()[pn])||(Mt=or()[pn]=[]),Mt.push(t=>Le=t),Hr=t=>{Mt.length>1?Mt.forEach(e=>e(t)):Mt[0](t)};const Vt=t=>{Hr(t),t.scope.on()},It=()=>{Le&&Le.scope.off(),Hr(null)};function Xs(t){return t.vnode.shapeFlag&4}let ci=!1;function Ja(t,e=!1){ci=e;const{props:r,children:o}=t.vnode,h=Xs(t);Da(t,r,h,e),Fa(t,o);const g=h?$a(t,e):void 0;return ci=!1,g}function $a(t,e){const r=t.type;t.accessCache=Object.create(null),t.proxy=Ss(new Proxy(t.ctx,wa));const{setup:o}=r;if(o){const h=t.setupContext=o.length>1?el(t):null;Vt(t),Gt();const g=_t(o,t,0,[t.props,h]);if(Ht(),It(),os(g)){if(g.then(It,It),e)return g.then(p=>{mn(t,p,e)}).catch(p=>{Wi(p,t,0)});t.asyncDep=g}else mn(t,g,e)}else zs(t,e)}function mn(t,e,r){be(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Me(e)&&(t.setupState=xs(e)),zs(t,r)}let vn;function zs(t,e,r){const o=t.type;if(!t.render){if(!e&&vn&&!o.render){const h=o.template||Vr(t).template;if(h){const{isCustomElement:g,compilerOptions:p}=t.appContext.config,{delimiters:v,compilerOptions:S}=o,w=Fe(Fe({isCustomElement:g,delimiters:v},p),S);o.render=vn(h,w)}}t.render=o.render||$e}{Vt(t),Gt();try{Ca(t)}finally{Ht(),It()}}}function Qa(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get(e,r){return Ue(t,"get","$attrs"),e[r]}}))}function el(t){const e=r=>{t.exposed=r||{}};return{get attrs(){return Qa(t)},slots:t.slots,emit:t.emit,expose:e}}function Yr(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(xs(Ss(t.exposed)),{get(e,r){if(r in e)return e[r];if(r in ti)return ti[r](t)},has(e,r){return r in e||r in ti}}))}function tl(t){return be(t)&&"__vccOpts"in t}const il=(t,e)=>zo(t,e,ci),rl=Symbol.for("v-scx"),nl=()=>wi(rl),sl="3.3.10",ol="http://www.w3.org/2000/svg",wt=typeof document<"u"?document:null,yn=wt&&wt.createElement("template"),al={insert:(t,e,r)=>{e.insertBefore(t,r||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,r,o)=>{const h=e?wt.createElementNS(ol,t):wt.createElement(t,r?{is:r}:void 0);return t==="select"&&o&&o.multiple!=null&&h.setAttribute("multiple",o.multiple),h},createText:t=>wt.createTextNode(t),createComment:t=>wt.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>wt.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,r,o,h,g){const p=r?r.previousSibling:e.lastChild;if(h&&(h===g||h.nextSibling))for(;e.insertBefore(h.cloneNode(!0),r),!(h===g||!(h=h.nextSibling)););else{yn.innerHTML=o?`<svg>${t}</svg>`:t;const v=yn.content;if(o){const S=v.firstChild;for(;S.firstChild;)v.appendChild(S.firstChild);v.removeChild(S)}e.insertBefore(v,r)}return[p?p.nextSibling:e.firstChild,r?r.previousSibling:e.lastChild]}},ll=Symbol("_vtc");function cl(t,e,r){const o=t[ll];o&&(e=(e?[e,...o]:[...o]).join(" ")),e==null?t.removeAttribute("class"):r?t.setAttribute("class",e):t.className=e}const hl=Symbol("_vod");function ul(t,e,r){const o=t.style,h=Pe(r);if(r&&!h){if(e&&!Pe(e))for(const g in e)r[g]==null&&mr(o,g,"");for(const g in r)mr(o,g,r[g])}else{const g=o.display;h?e!==r&&(o.cssText=r):e&&t.removeAttribute("style"),hl in t&&(o.display=g)}}const bn=/\s*!important$/;function mr(t,e,r){if(ve(r))r.forEach(o=>mr(t,e,o));else if(r==null&&(r=""),e.startsWith("--"))t.setProperty(e,r);else{const o=dl(t,e);bn.test(r)?t.setProperty(Wt(o),r.replace(bn,""),"important"):t[o]=r}}const Sn=["Webkit","Moz","ms"],ir={};function dl(t,e){const r=ir[e];if(r)return r;let o=Bt(e);if(o!=="filter"&&o in t)return ir[e]=o;o=as(o);for(let h=0;h<Sn.length;h++){const g=Sn[h]+o;if(g in t)return ir[e]=g}return e}const wn="http://www.w3.org/1999/xlink";function fl(t,e,r,o,h){if(o&&e.startsWith("xlink:"))r==null?t.removeAttributeNS(wn,e.slice(6,e.length)):t.setAttributeNS(wn,e,r);else{const g=mo(e);r==null||g&&!ls(r)?t.removeAttribute(e):t.setAttribute(e,g?"":r)}}function gl(t,e,r,o,h,g,p){if(e==="innerHTML"||e==="textContent"){o&&p(o,h,g),t[e]=r??"";return}const v=t.tagName;if(e==="value"&&v!=="PROGRESS"&&!v.includes("-")){t._value=r;const w=v==="OPTION"?t.getAttribute("value"):t.value,x=r??"";w!==x&&(t.value=x),r==null&&t.removeAttribute(e);return}let S=!1;if(r===""||r==null){const w=typeof t[e];w==="boolean"?r=ls(r):r==null&&w==="string"?(r="",S=!0):w==="number"&&(r=0,S=!0)}try{t[e]=r}catch{}S&&t.removeAttribute(e)}function _l(t,e,r,o){t.addEventListener(e,r,o)}function pl(t,e,r,o){t.removeEventListener(e,r,o)}const Cn=Symbol("_vei");function ml(t,e,r,o,h=null){const g=t[Cn]||(t[Cn]={}),p=g[e];if(o&&p)p.value=o;else{const[v,S]=vl(e);if(o){const w=g[e]=Sl(o,h);_l(t,v,w,S)}else p&&(pl(t,v,p,S),g[e]=void 0)}}const xn=/(?:Once|Passive|Capture)$/;function vl(t){let e;if(xn.test(t)){e={};let o;for(;o=t.match(xn);)t=t.slice(0,t.length-o[0].length),e[o[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Wt(t.slice(2)),e]}let rr=0;const yl=Promise.resolve(),bl=()=>rr||(yl.then(()=>rr=0),rr=Date.now());function Sl(t,e){const r=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=r.attached)return;Qe(wl(o,r.value),e,5,[o])};return r.value=t,r.attached=bl(),r}function wl(t,e){if(ve(e)){const r=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{r.call(t),t._stopped=!0},e.map(o=>h=>!h._stopped&&o&&o(h))}else return e}const Tn=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,Cl=(t,e,r,o,h=!1,g,p,v,S)=>{e==="class"?cl(t,o,h):e==="style"?ul(t,r,o):Bi(e)?Tr(e)||ml(t,e,r,o,p):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):xl(t,e,o,h))?gl(t,e,o,g,p,v,S):(e==="true-value"?t._trueValue=o:e==="false-value"&&(t._falseValue=o),fl(t,e,o,h))};function xl(t,e,r,o){if(o)return!!(e==="innerHTML"||e==="textContent"||e in t&&Tn(e)&&be(r));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const h=t.tagName;return!(h==="IMG"||h==="VIDEO"||h==="CANVAS"||h==="SOURCE")}return Tn(e)&&Pe(r)?!1:e in t}const Tl=Fe({patchProp:Cl},al);let In;function Il(){return In||(In=ka(Tl))}const El=(...t)=>{const e=Il().createApp(...t),{mount:r}=e;return e.mount=o=>{const h=Ol(o);if(!h)return;const g=e._component;!be(g)&&!g.render&&!g.template&&(g.template=h.innerHTML),h.innerHTML="";const p=r(h,!1,h instanceof SVGElement);return h instanceof Element&&(h.removeAttribute("v-cloak"),h.setAttribute("data-v-app","")),p},e};function Ol(t){return Pe(t)?document.querySelector(t):t}const Al=""+new URL("logo-7e7c7361.svg",import.meta.url).href;/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */function Rl(t,e,r,o){t.prototype._pos=[0,0,0],t.prototype._orientation=[0,0,-1,0,1,0],t.prototype.stereo=function(g){var p=this;if(!p.ctx||!p.ctx.listener)return p;for(var v=p._howls.length-1;v>=0;v--)p._howls[v].stereo(g);return p},t.prototype.pos=function(g,p,v){var S=this;if(!S.ctx||!S.ctx.listener)return S;if(p=typeof p!="number"?S._pos[1]:p,v=typeof v!="number"?S._pos[2]:v,typeof g=="number")S._pos=[g,p,v],typeof S.ctx.listener.positionX<"u"?(S.ctx.listener.positionX.setTargetAtTime(S._pos[0],e.ctx.currentTime,.1),S.ctx.listener.positionY.setTargetAtTime(S._pos[1],e.ctx.currentTime,.1),S.ctx.listener.positionZ.setTargetAtTime(S._pos[2],e.ctx.currentTime,.1)):S.ctx.listener.setPosition(S._pos[0],S._pos[1],S._pos[2]);else return S._pos;return S},t.prototype.orientation=function(g,p,v,S,w,x){var E=this;if(!E.ctx||!E.ctx.listener)return E;var A=E._orientation;if(p=typeof p!="number"?A[1]:p,v=typeof v!="number"?A[2]:v,S=typeof S!="number"?A[3]:S,w=typeof w!="number"?A[4]:w,x=typeof x!="number"?A[5]:x,typeof g=="number")E._orientation=[g,p,v,S,w,x],typeof E.ctx.listener.forwardX<"u"?(E.ctx.listener.forwardX.setTargetAtTime(g,e.ctx.currentTime,.1),E.ctx.listener.forwardY.setTargetAtTime(p,e.ctx.currentTime,.1),E.ctx.listener.forwardZ.setTargetAtTime(v,e.ctx.currentTime,.1),E.ctx.listener.upX.setTargetAtTime(S,e.ctx.currentTime,.1),E.ctx.listener.upY.setTargetAtTime(w,e.ctx.currentTime,.1),E.ctx.listener.upZ.setTargetAtTime(x,e.ctx.currentTime,.1)):E.ctx.listener.setOrientation(g,p,v,S,w,x);else return A;return E},r.prototype.init=function(g){return function(p){var v=this;return v._orientation=p.orientation||[1,0,0],v._stereo=p.stereo||null,v._pos=p.pos||null,v._pannerAttr={coneInnerAngle:typeof p.coneInnerAngle<"u"?p.coneInnerAngle:360,coneOuterAngle:typeof p.coneOuterAngle<"u"?p.coneOuterAngle:360,coneOuterGain:typeof p.coneOuterGain<"u"?p.coneOuterGain:0,distanceModel:typeof p.distanceModel<"u"?p.distanceModel:"inverse",maxDistance:typeof p.maxDistance<"u"?p.maxDistance:1e4,panningModel:typeof p.panningModel<"u"?p.panningModel:"HRTF",refDistance:typeof p.refDistance<"u"?p.refDistance:1,rolloffFactor:typeof p.rolloffFactor<"u"?p.rolloffFactor:1},v._onstereo=p.onstereo?[{fn:p.onstereo}]:[],v._onpos=p.onpos?[{fn:p.onpos}]:[],v._onorientation=p.onorientation?[{fn:p.onorientation}]:[],g.call(this,p)}}(r.prototype.init),r.prototype.stereo=function(g,p){var v=this;if(!v._webAudio)return v;if(v._state!=="loaded")return v._queue.push({event:"stereo",action:function(){v.stereo(g,p)}}),v;var S=typeof e.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof p>"u")if(typeof g=="number")v._stereo=g,v._pos=[g,0,0];else return v._stereo;for(var w=v._getSoundIds(p),x=0;x<w.length;x++){var E=v._soundById(w[x]);if(E)if(typeof g=="number")E._stereo=g,E._pos=[g,0,0],E._node&&(E._pannerAttr.panningModel="equalpower",(!E._panner||!E._panner.pan)&&h(E,S),S==="spatial"?typeof E._panner.positionX<"u"?(E._panner.positionX.setValueAtTime(g,e.ctx.currentTime),E._panner.positionY.setValueAtTime(0,e.ctx.currentTime),E._panner.positionZ.setValueAtTime(0,e.ctx.currentTime)):E._panner.setPosition(g,0,0):E._panner.pan.setValueAtTime(g,e.ctx.currentTime)),v._emit("stereo",E._id);else return E._stereo}return v},r.prototype.pos=function(g,p,v,S){var w=this;if(!w._webAudio)return w;if(w._state!=="loaded")return w._queue.push({event:"pos",action:function(){w.pos(g,p,v,S)}}),w;if(p=typeof p!="number"?0:p,v=typeof v!="number"?-.5:v,typeof S>"u")if(typeof g=="number")w._pos=[g,p,v];else return w._pos;for(var x=w._getSoundIds(S),E=0;E<x.length;E++){var A=w._soundById(x[E]);if(A)if(typeof g=="number")A._pos=[g,p,v],A._node&&((!A._panner||A._panner.pan)&&h(A,"spatial"),typeof A._panner.positionX<"u"?(A._panner.positionX.setValueAtTime(g,e.ctx.currentTime),A._panner.positionY.setValueAtTime(p,e.ctx.currentTime),A._panner.positionZ.setValueAtTime(v,e.ctx.currentTime)):A._panner.setPosition(g,p,v)),w._emit("pos",A._id);else return A._pos}return w},r.prototype.orientation=function(g,p,v,S){var w=this;if(!w._webAudio)return w;if(w._state!=="loaded")return w._queue.push({event:"orientation",action:function(){w.orientation(g,p,v,S)}}),w;if(p=typeof p!="number"?w._orientation[1]:p,v=typeof v!="number"?w._orientation[2]:v,typeof S>"u")if(typeof g=="number")w._orientation=[g,p,v];else return w._orientation;for(var x=w._getSoundIds(S),E=0;E<x.length;E++){var A=w._soundById(x[E]);if(A)if(typeof g=="number")A._orientation=[g,p,v],A._node&&(A._panner||(A._pos||(A._pos=w._pos||[0,0,-.5]),h(A,"spatial")),typeof A._panner.orientationX<"u"?(A._panner.orientationX.setValueAtTime(g,e.ctx.currentTime),A._panner.orientationY.setValueAtTime(p,e.ctx.currentTime),A._panner.orientationZ.setValueAtTime(v,e.ctx.currentTime)):A._panner.setOrientation(g,p,v)),w._emit("orientation",A._id);else return A._orientation}return w},r.prototype.pannerAttr=function(){var g=this,p=arguments,v,S,w;if(!g._webAudio)return g;if(p.length===0)return g._pannerAttr;if(p.length===1)if(typeof p[0]=="object")v=p[0],typeof S>"u"&&(v.pannerAttr||(v.pannerAttr={coneInnerAngle:v.coneInnerAngle,coneOuterAngle:v.coneOuterAngle,coneOuterGain:v.coneOuterGain,distanceModel:v.distanceModel,maxDistance:v.maxDistance,refDistance:v.refDistance,rolloffFactor:v.rolloffFactor,panningModel:v.panningModel}),g._pannerAttr={coneInnerAngle:typeof v.pannerAttr.coneInnerAngle<"u"?v.pannerAttr.coneInnerAngle:g._coneInnerAngle,coneOuterAngle:typeof v.pannerAttr.coneOuterAngle<"u"?v.pannerAttr.coneOuterAngle:g._coneOuterAngle,coneOuterGain:typeof v.pannerAttr.coneOuterGain<"u"?v.pannerAttr.coneOuterGain:g._coneOuterGain,distanceModel:typeof v.pannerAttr.distanceModel<"u"?v.pannerAttr.distanceModel:g._distanceModel,maxDistance:typeof v.pannerAttr.maxDistance<"u"?v.pannerAttr.maxDistance:g._maxDistance,refDistance:typeof v.pannerAttr.refDistance<"u"?v.pannerAttr.refDistance:g._refDistance,rolloffFactor:typeof v.pannerAttr.rolloffFactor<"u"?v.pannerAttr.rolloffFactor:g._rolloffFactor,panningModel:typeof v.pannerAttr.panningModel<"u"?v.pannerAttr.panningModel:g._panningModel});else return w=g._soundById(parseInt(p[0],10)),w?w._pannerAttr:g._pannerAttr;else p.length===2&&(v=p[0],S=parseInt(p[1],10));for(var x=g._getSoundIds(S),E=0;E<x.length;E++)if(w=g._soundById(x[E]),w){var A=w._pannerAttr;A={coneInnerAngle:typeof v.coneInnerAngle<"u"?v.coneInnerAngle:A.coneInnerAngle,coneOuterAngle:typeof v.coneOuterAngle<"u"?v.coneOuterAngle:A.coneOuterAngle,coneOuterGain:typeof v.coneOuterGain<"u"?v.coneOuterGain:A.coneOuterGain,distanceModel:typeof v.distanceModel<"u"?v.distanceModel:A.distanceModel,maxDistance:typeof v.maxDistance<"u"?v.maxDistance:A.maxDistance,refDistance:typeof v.refDistance<"u"?v.refDistance:A.refDistance,rolloffFactor:typeof v.rolloffFactor<"u"?v.rolloffFactor:A.rolloffFactor,panningModel:typeof v.panningModel<"u"?v.panningModel:A.panningModel};var W=w._panner;W||(w._pos||(w._pos=g._pos||[0,0,-.5]),h(w,"spatial"),W=w._panner),W.coneInnerAngle=A.coneInnerAngle,W.coneOuterAngle=A.coneOuterAngle,W.coneOuterGain=A.coneOuterGain,W.distanceModel=A.distanceModel,W.maxDistance=A.maxDistance,W.refDistance=A.refDistance,W.rolloffFactor=A.rolloffFactor,W.panningModel=A.panningModel}return g},o.prototype.init=function(g){return function(){var p=this,v=p._parent;p._orientation=v._orientation,p._stereo=v._stereo,p._pos=v._pos,p._pannerAttr=v._pannerAttr,g.call(this),p._stereo?v.stereo(p._stereo):p._pos&&v.pos(p._pos[0],p._pos[1],p._pos[2],p._id)}}(o.prototype.init),o.prototype.reset=function(g){return function(){var p=this,v=p._parent;return p._orientation=v._orientation,p._stereo=v._stereo,p._pos=v._pos,p._pannerAttr=v._pannerAttr,p._stereo?v.stereo(p._stereo):p._pos?v.pos(p._pos[0],p._pos[1],p._pos[2],p._id):p._panner&&(p._panner.disconnect(0),p._panner=void 0,v._refreshBuffer(p)),g.call(this)}}(o.prototype.reset);var h=function(g,p){p=p||"spatial",p==="spatial"?(g._panner=e.ctx.createPanner(),g._panner.coneInnerAngle=g._pannerAttr.coneInnerAngle,g._panner.coneOuterAngle=g._pannerAttr.coneOuterAngle,g._panner.coneOuterGain=g._pannerAttr.coneOuterGain,g._panner.distanceModel=g._pannerAttr.distanceModel,g._panner.maxDistance=g._pannerAttr.maxDistance,g._panner.refDistance=g._pannerAttr.refDistance,g._panner.rolloffFactor=g._pannerAttr.rolloffFactor,g._panner.panningModel=g._pannerAttr.panningModel,typeof g._panner.positionX<"u"?(g._panner.positionX.setValueAtTime(g._pos[0],e.ctx.currentTime),g._panner.positionY.setValueAtTime(g._pos[1],e.ctx.currentTime),g._panner.positionZ.setValueAtTime(g._pos[2],e.ctx.currentTime)):g._panner.setPosition(g._pos[0],g._pos[1],g._pos[2]),typeof g._panner.orientationX<"u"?(g._panner.orientationX.setValueAtTime(g._orientation[0],e.ctx.currentTime),g._panner.orientationY.setValueAtTime(g._orientation[1],e.ctx.currentTime),g._panner.orientationZ.setValueAtTime(g._orientation[2],e.ctx.currentTime)):g._panner.setOrientation(g._orientation[0],g._orientation[1],g._orientation[2])):(g._panner=e.ctx.createStereoPanner(),g._panner.pan.setValueAtTime(g._stereo,e.ctx.currentTime)),g._panner.connect(g._node),g._paused||g._parent.pause(g._id,!0).play(g._id,!0)}}/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */var Xr=function(){this.init()};Xr.prototype={init:function(){var t=this||le;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator=typeof window<"u"&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||le;if(t=parseFloat(t),e.ctx||Ti(),typeof t<"u"&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,le.ctx.currentTime);for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var o=e._howls[r]._getSoundIds(),h=0;h<o.length;h++){var g=e._howls[r]._soundById(o[h]);g&&g._node&&(g._node.volume=g._volume*t)}return e}return e._volume},mute:function(t){var e=this||le;e.ctx||Ti(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,le.ctx.currentTime);for(var r=0;r<e._howls.length;r++)if(!e._howls[r]._webAudio)for(var o=e._howls[r]._getSoundIds(),h=0;h<o.length;h++){var g=e._howls[r]._soundById(o[h]);g&&g._node&&(g._node.muted=t?!0:g._muted)}return e},stop:function(){for(var t=this||le,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||le,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&typeof t.ctx.close<"u"&&(t.ctx.close(),t.ctx=null,Ti()),t},codecs:function(t){return(this||le)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||le;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if(typeof Audio<"u")try{var e=new Audio;typeof e.oncanplaythrough>"u"&&(t._canPlayEvent="canplay")}catch{t.noAudio=!0}else t.noAudio=!0;try{var e=new Audio;e.muted&&(t.noAudio=!0)}catch{}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||le,e=null;try{e=typeof Audio<"u"?new Audio:null}catch{return t}if(!e||typeof e.canPlayType!="function")return t;var r=e.canPlayType("audio/mpeg;").replace(/^no$/,""),o=t._navigator?t._navigator.userAgent:"",h=o.match(/OPR\/([0-6].)/g),g=h&&parseInt(h[0].split("/")[1],10)<33,p=o.indexOf("Safari")!==-1&&o.indexOf("Chrome")===-1,v=o.match(/Version\/(.*?) /),S=p&&v&&parseInt(v[1],10)<15;return t._codecs={mp3:!!(!g&&(r||e.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!r,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!S&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!S&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||le;if(!(t._audioUnlocked||!t.ctx)){t._audioUnlocked=!1,t.autoUnlock=!1,!t._mobileUnloaded&&t.ctx.sampleRate!==44100&&(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(r){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var o=new Audio;o._unlocked=!0,t._releaseHtml5Audio(o)}catch{t.noAudio=!0;break}for(var h=0;h<t._howls.length;h++)if(!t._howls[h]._webAudio)for(var g=t._howls[h]._getSoundIds(),p=0;p<g.length;p++){var v=t._howls[h]._soundById(g[p]);v&&v._node&&!v._node._unlocked&&(v._node._unlocked=!0,v._node.load())}t._autoResume();var S=t.ctx.createBufferSource();S.buffer=t._scratchBuffer,S.connect(t.ctx.destination),typeof S.start>"u"?S.noteOn(0):S.start(0),typeof t.ctx.resume=="function"&&t.ctx.resume(),S.onended=function(){S.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var w=0;w<t._howls.length;w++)t._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||le;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=new Audio().play();return e&&typeof Promise<"u"&&(e instanceof Promise||typeof e.then=="function")&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(t){var e=this||le;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(!(!t.autoSuspend||!t.ctx||typeof t.ctx.suspend>"u"||!le.usingWebAudio)){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio){for(var r=0;r<t._howls[e]._sounds.length;r++)if(!t._howls[e]._sounds[r]._paused)return t}return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var o=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(o,o)}},3e4),t}},_autoResume:function(){var t=this;if(!(!t.ctx||typeof t.ctx.resume>"u"||!le.usingWebAudio))return t.state==="running"&&t.ctx.state!=="interrupted"&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):t.state==="suspended"||t.state==="running"&&t.ctx.state==="interrupted"?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):t.state==="suspending"&&(t._resumeAfterSuspend=!0),t}};var le=new Xr,Mi=function(t){var e=this;if(!t.src||t.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}e.init(t)};Mi.prototype={init:function(t){var e=this;return le.ctx||Ti(),e._autoplay=t.autoplay||!1,e._format=typeof t.format!="string"?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload=typeof t.preload=="boolean"||t.preload==="metadata"?t.preload:!0,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src=typeof t.src!="string"?t.src:[t.src],e._volume=t.volume!==void 0?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:t.xhr&&t.xhr.withCredentials?t.xhr.withCredentials:!1},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=le.usingWebAudio&&!e._html5,typeof le.ctx<"u"&&le.ctx&&le.autoUnlock&&le._unlockAudio(),le._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&e._preload!=="none"&&e.load(),e},load:function(){var t=this,e=null;if(le.noAudio){t._emit("loaderror",null,"No audio support.");return}typeof t._src=="string"&&(t._src=[t._src]);for(var r=0;r<t._src.length;r++){var o,h;if(t._format&&t._format[r])o=t._format[r];else{if(h=t._src[r],typeof h!="string"){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}o=/^data:audio\/([^;,]+);/i.exec(h),o||(o=/\.([^.]+)$/.exec(h.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),o&&le.codecs(o)){e=t._src[r];break}}if(!e){t._emit("loaderror",null,"No codec support for selected audio sources.");return}return t._src=e,t._state="loading",window.location.protocol==="https:"&&e.slice(0,5)==="http:"&&(t._html5=!0,t._webAudio=!1),new Li(t),t._webAudio&&Dl(t),t},play:function(t,e){var r=this,o=null;if(typeof t=="number")o=t,t=null;else{if(typeof t=="string"&&r._state==="loaded"&&!r._sprite[t])return null;if(typeof t>"u"&&(t="__default",!r._playLock)){for(var h=0,g=0;g<r._sounds.length;g++)r._sounds[g]._paused&&!r._sounds[g]._ended&&(h++,o=r._sounds[g]._id);h===1?t=null:o=null}}var p=o?r._soundById(o):r._inactiveSound();if(!p)return null;if(o&&!t&&(t=p._sprite||"__default"),r._state!=="loaded"){p._sprite=t,p._ended=!1;var v=p._id;return r._queue.push({event:"play",action:function(){r.play(v)}}),v}if(o&&!p._paused)return e||r._loadQueue("play"),p._id;r._webAudio&&le._autoResume();var S=Math.max(0,p._seek>0?p._seek:r._sprite[t][0]/1e3),w=Math.max(0,(r._sprite[t][0]+r._sprite[t][1])/1e3-S),x=w*1e3/Math.abs(p._rate),E=r._sprite[t][0]/1e3,A=(r._sprite[t][0]+r._sprite[t][1])/1e3;p._sprite=t,p._ended=!1;var W=function(){p._paused=!1,p._seek=S,p._start=E,p._stop=A,p._loop=!!(p._loop||r._sprite[t][2])};if(S>=A){r._ended(p);return}var Y=p._node;if(r._webAudio){var z=function(){r._playLock=!1,W(),r._refreshBuffer(p);var Z=p._muted||r._muted?0:p._volume;Y.gain.setValueAtTime(Z,le.ctx.currentTime),p._playStart=le.ctx.currentTime,typeof Y.bufferSource.start>"u"?p._loop?Y.bufferSource.noteGrainOn(0,S,86400):Y.bufferSource.noteGrainOn(0,S,w):p._loop?Y.bufferSource.start(0,S,86400):Y.bufferSource.start(0,S,w),x!==1/0&&(r._endTimers[p._id]=setTimeout(r._ended.bind(r,p),x)),e||setTimeout(function(){r._emit("play",p._id),r._loadQueue()},0)};le.state==="running"&&le.ctx.state!=="interrupted"?z():(r._playLock=!0,r.once("resume",z),r._clearTimer(p._id))}else{var q=function(){Y.currentTime=S,Y.muted=p._muted||r._muted||le._muted||Y.muted,Y.volume=p._volume*le.volume(),Y.playbackRate=p._rate;try{var Z=Y.play();if(Z&&typeof Promise<"u"&&(Z instanceof Promise||typeof Z.then=="function")?(r._playLock=!0,W(),Z.then(function(){r._playLock=!1,Y._unlocked=!0,e?r._loadQueue():r._emit("play",p._id)}).catch(function(){r._playLock=!1,r._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),p._ended=!0,p._paused=!0})):e||(r._playLock=!1,W(),r._emit("play",p._id)),Y.playbackRate=p._rate,Y.paused){r._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}t!=="__default"||p._loop?r._endTimers[p._id]=setTimeout(r._ended.bind(r,p),x):(r._endTimers[p._id]=function(){r._ended(p),Y.removeEventListener("ended",r._endTimers[p._id],!1)},Y.addEventListener("ended",r._endTimers[p._id],!1))}catch(ee){r._emit("playerror",p._id,ee)}};Y.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(Y.src=r._src,Y.load());var te=window&&window.ejecta||!Y.readyState&&le._navigator.isCocoonJS;if(Y.readyState>=3||te)q();else{r._playLock=!0,r._state="loading";var J=function(){r._state="loaded",q(),Y.removeEventListener(le._canPlayEvent,J,!1)};Y.addEventListener(le._canPlayEvent,J,!1),r._clearTimer(p._id)}}return p._id},pause:function(t){var e=this;if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var r=e._getSoundIds(t),o=0;o<r.length;o++){e._clearTimer(r[o]);var h=e._soundById(r[o]);if(h&&!h._paused&&(h._seek=e.seek(r[o]),h._rateSeek=0,h._paused=!0,e._stopFade(r[o]),h._node))if(e._webAudio){if(!h._node.bufferSource)continue;typeof h._node.bufferSource.stop>"u"?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),e._cleanBuffer(h._node)}else(!isNaN(h._node.duration)||h._node.duration===1/0)&&h._node.pause();arguments[1]||e._emit("pause",h?h._id:null)}return e},stop:function(t,e){var r=this;if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"stop",action:function(){r.stop(t)}}),r;for(var o=r._getSoundIds(t),h=0;h<o.length;h++){r._clearTimer(o[h]);var g=r._soundById(o[h]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,r._stopFade(o[h]),g._node&&(r._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),r._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&r._clearSound(g._node))),e||r._emit("stop",g._id))}return r},mute:function(t,e){var r=this;if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"mute",action:function(){r.mute(t,e)}}),r;if(typeof e>"u")if(typeof t=="boolean")r._muted=t;else return r._muted;for(var o=r._getSoundIds(e),h=0;h<o.length;h++){var g=r._soundById(o[h]);g&&(g._muted=t,g._interval&&r._stopFade(g._id),r._webAudio&&g._node?g._node.gain.setValueAtTime(t?0:g._volume,le.ctx.currentTime):g._node&&(g._node.muted=le._muted?!0:t),r._emit("mute",g._id))}return r},volume:function(){var t=this,e=arguments,r,o;if(e.length===0)return t._volume;if(e.length===1||e.length===2&&typeof e[1]>"u"){var h=t._getSoundIds(),g=h.indexOf(e[0]);g>=0?o=parseInt(e[0],10):r=parseFloat(e[0])}else e.length>=2&&(r=parseFloat(e[0]),o=parseInt(e[1],10));var p;if(typeof r<"u"&&r>=0&&r<=1){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,e)}}),t;typeof o>"u"&&(t._volume=r),o=t._getSoundIds(o);for(var v=0;v<o.length;v++)p=t._soundById(o[v]),p&&(p._volume=r,e[2]||t._stopFade(o[v]),t._webAudio&&p._node&&!p._muted?p._node.gain.setValueAtTime(r,le.ctx.currentTime):p._node&&!p._muted&&(p._node.volume=r*le.volume()),t._emit("volume",p._id))}else return p=o?t._soundById(o):t._sounds[0],p?p._volume:0;return t},fade:function(t,e,r,o){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"fade",action:function(){h.fade(t,e,r,o)}}),h;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),r=parseFloat(r),h.volume(t,o);for(var g=h._getSoundIds(o),p=0;p<g.length;p++){var v=h._soundById(g[p]);if(v){if(o||h._stopFade(g[p]),h._webAudio&&!v._muted){var S=le.ctx.currentTime,w=S+r/1e3;v._volume=t,v._node.gain.setValueAtTime(t,S),v._node.gain.linearRampToValueAtTime(e,w)}h._startFadeInterval(v,t,e,r,g[p],typeof o>"u")}}return h},_startFadeInterval:function(t,e,r,o,h,g){var p=this,v=e,S=r-e,w=Math.abs(S/.01),x=Math.max(4,w>0?o/w:o),E=Date.now();t._fadeTo=r,t._interval=setInterval(function(){var A=(Date.now()-E)/o;E=Date.now(),v+=S*A,v=Math.round(v*100)/100,S<0?v=Math.max(r,v):v=Math.min(r,v),p._webAudio?t._volume=v:p.volume(v,t._id,!0),g&&(p._volume=v),(r<e&&v<=r||r>e&&v>=r)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,p.volume(r,t._id),p._emit("fade",t._id))},x)},_stopFade:function(t){var e=this,r=e._soundById(t);return r&&r._interval&&(e._webAudio&&r._node.gain.cancelScheduledValues(le.ctx.currentTime),clearInterval(r._interval),r._interval=null,e.volume(r._fadeTo,t),r._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t=this,e=arguments,r,o,h;if(e.length===0)return t._loop;if(e.length===1)if(typeof e[0]=="boolean")r=e[0],t._loop=r;else return h=t._soundById(parseInt(e[0],10)),h?h._loop:!1;else e.length===2&&(r=e[0],o=parseInt(e[1],10));for(var g=t._getSoundIds(o),p=0;p<g.length;p++)h=t._soundById(g[p]),h&&(h._loop=r,t._webAudio&&h._node&&h._node.bufferSource&&(h._node.bufferSource.loop=r,r&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop,t.playing(g[p])&&(t.pause(g[p],!0),t.play(g[p],!0)))));return t},rate:function(){var t=this,e=arguments,r,o;if(e.length===0)o=t._sounds[0]._id;else if(e.length===1){var h=t._getSoundIds(),g=h.indexOf(e[0]);g>=0?o=parseInt(e[0],10):r=parseFloat(e[0])}else e.length===2&&(r=parseFloat(e[0]),o=parseInt(e[1],10));var p;if(typeof r=="number"){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,e)}}),t;typeof o>"u"&&(t._rate=r),o=t._getSoundIds(o);for(var v=0;v<o.length;v++)if(p=t._soundById(o[v]),p){t.playing(o[v])&&(p._rateSeek=t.seek(o[v]),p._playStart=t._webAudio?le.ctx.currentTime:p._playStart),p._rate=r,t._webAudio&&p._node&&p._node.bufferSource?p._node.bufferSource.playbackRate.setValueAtTime(r,le.ctx.currentTime):p._node&&(p._node.playbackRate=r);var S=t.seek(o[v]),w=(t._sprite[p._sprite][0]+t._sprite[p._sprite][1])/1e3-S,x=w*1e3/Math.abs(p._rate);(t._endTimers[o[v]]||!p._paused)&&(t._clearTimer(o[v]),t._endTimers[o[v]]=setTimeout(t._ended.bind(t,p),x)),t._emit("rate",p._id)}}else return p=t._soundById(o),p?p._rate:t._rate;return t},seek:function(){var t=this,e=arguments,r,o;if(e.length===0)t._sounds.length&&(o=t._sounds[0]._id);else if(e.length===1){var h=t._getSoundIds(),g=h.indexOf(e[0]);g>=0?o=parseInt(e[0],10):t._sounds.length&&(o=t._sounds[0]._id,r=parseFloat(e[0]))}else e.length===2&&(r=parseFloat(e[0]),o=parseInt(e[1],10));if(typeof o>"u")return 0;if(typeof r=="number"&&(t._state!=="loaded"||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,e)}}),t;var p=t._soundById(o);if(p)if(typeof r=="number"&&r>=0){var v=t.playing(o);v&&t.pause(o,!0),p._seek=r,p._ended=!1,t._clearTimer(o),!t._webAudio&&p._node&&!isNaN(p._node.duration)&&(p._node.currentTime=r);var S=function(){v&&t.play(o,!0),t._emit("seek",o)};if(v&&!t._webAudio){var w=function(){t._playLock?setTimeout(w,0):S()};setTimeout(w,0)}else S()}else if(t._webAudio){var x=t.playing(o)?le.ctx.currentTime-p._playStart:0,E=p._rateSeek?p._rateSeek-p._seek:0;return p._seek+(E+x*Math.abs(p._rate))}else return p._node.currentTime;return t},playing:function(t){var e=this;if(typeof t=="number"){var r=e._soundById(t);return r?!r._paused:!1}for(var o=0;o<e._sounds.length;o++)if(!e._sounds[o]._paused)return!0;return!1},duration:function(t){var e=this,r=e._duration,o=e._soundById(t);return o&&(r=e._sprite[o._sprite][1]/1e3),r},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,r=0;r<e.length;r++)e[r]._paused||t.stop(e[r]._id),t._webAudio||(t._clearSound(e[r]._node),e[r]._node.removeEventListener("error",e[r]._errorFn,!1),e[r]._node.removeEventListener(le._canPlayEvent,e[r]._loadFn,!1),e[r]._node.removeEventListener("ended",e[r]._endFn,!1),le._releaseHtml5Audio(e[r]._node)),delete e[r]._node,t._clearTimer(e[r]._id);var o=le._howls.indexOf(t);o>=0&&le._howls.splice(o,1);var h=!0;for(r=0;r<le._howls.length;r++)if(le._howls[r]._src===t._src||t._src.indexOf(le._howls[r]._src)>=0){h=!1;break}return Et&&h&&delete Et[t._src],le.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,r,o){var h=this,g=h["_on"+t];return typeof e=="function"&&g.push(o?{id:r,fn:e,once:o}:{id:r,fn:e}),h},off:function(t,e,r){var o=this,h=o["_on"+t],g=0;if(typeof e=="number"&&(r=e,e=null),e||r)for(g=0;g<h.length;g++){var p=r===h[g].id;if(e===h[g].fn&&p||!e&&p){h.splice(g,1);break}}else if(t)o["_on"+t]=[];else{var v=Object.keys(o);for(g=0;g<v.length;g++)v[g].indexOf("_on")===0&&Array.isArray(o[v[g]])&&(o[v[g]]=[])}return o},once:function(t,e,r){var o=this;return o.on(t,e,r,1),o},_emit:function(t,e,r){for(var o=this,h=o["_on"+t],g=h.length-1;g>=0;g--)(!h[g].id||h[g].id===e||t==="load")&&(setTimeout((function(p){p.call(this,e,r)}).bind(o,h[g].fn),0),h[g].once&&o.off(t,h[g].fn,h[g].id));return o._loadQueue(t),o},_loadQueue:function(t){var e=this;if(e._queue.length>0){var r=e._queue[0];r.event===t&&(e._queue.shift(),e._loadQueue()),t||r.action()}return e},_ended:function(t){var e=this,r=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var o=!!(t._loop||e._sprite[r][2]);if(e._emit("end",t._id),!e._webAudio&&o&&e.stop(t._id,!0).play(t._id),e._webAudio&&o){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=le.ctx.currentTime;var h=(t._stop-t._start)*1e3/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),h)}return e._webAudio&&!o&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),le._autoSuspend()),!e._webAudio&&!o&&e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if(typeof e._endTimers[t]!="function")clearTimeout(e._endTimers[t]);else{var r=e._soundById(t);r&&r._node&&r._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,r=0;r<e._sounds.length;r++)if(t===e._sounds[r]._id)return e._sounds[r];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new Li(t)},_drain:function(){var t=this,e=t._pool,r=0,o=0;if(!(t._sounds.length<e)){for(o=0;o<t._sounds.length;o++)t._sounds[o]._ended&&r++;for(o=t._sounds.length-1;o>=0;o--){if(r<=e)return;t._sounds[o]._ended&&(t._webAudio&&t._sounds[o]._node&&t._sounds[o]._node.disconnect(0),t._sounds.splice(o,1),r--)}}},_getSoundIds:function(t){var e=this;if(typeof t>"u"){for(var r=[],o=0;o<e._sounds.length;o++)r.push(e._sounds[o]._id);return r}else return[t]},_refreshBuffer:function(t){var e=this;return t._node.bufferSource=le.ctx.createBufferSource(),t._node.bufferSource.buffer=Et[e._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,le.ctx.currentTime),e},_cleanBuffer:function(t){var e=this,r=le._navigator&&le._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return e;if(le._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),r))try{t.bufferSource.buffer=le._scratchBuffer}catch{}return t.bufferSource=null,e},_clearSound:function(t){var e=/MSIE |Trident\//.test(le._navigator&&le._navigator.userAgent);e||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var Li=function(t){this._parent=t,this.init()};Li.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++le._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,r=le._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=typeof le.ctx.createGain>"u"?le.ctx.createGainNode():le.ctx.createGain(),t._node.gain.setValueAtTime(r,le.ctx.currentTime),t._node.paused=!0,t._node.connect(le.masterGain)):le.noAudio||(t._node=le._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(le._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=e._preload===!0?"auto":e._preload,t._node.volume=r*le.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++le._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(t._node.duration*10)/10,Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(le._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(t._node.duration*10)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=e._duration*1e3),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var Et={},Dl=function(t){var e=t._src;if(Et[e]){t._duration=Et[e].duration,Ks(t);return}if(/^data:[^;]+;base64,/.test(e)){for(var r=atob(e.split(",")[1]),o=new Uint8Array(r.length),h=0;h<r.length;++h)o[h]=r.charCodeAt(h);En(o.buffer,t)}else{var g=new XMLHttpRequest;g.open(t._xhr.method,e,!0),g.withCredentials=t._xhr.withCredentials,g.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(p){g.setRequestHeader(p,t._xhr.headers[p])}),g.onload=function(){var p=(g.status+"")[0];if(p!=="0"&&p!=="2"&&p!=="3"){t._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}En(g.response,t)},g.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete Et[e],t.load())},Ml(g)}},Ml=function(t){try{t.send()}catch{t.onerror()}},En=function(t,e){var r=function(){e._emit("loaderror",null,"Decoding audio data failed.")},o=function(h){h&&e._sounds.length>0?(Et[e._src]=h,Ks(e,h)):r()};typeof Promise<"u"&&le.ctx.decodeAudioData.length===1?le.ctx.decodeAudioData(t).then(o).catch(r):le.ctx.decodeAudioData(t,o,r)},Ks=function(t,e){e&&!t._duration&&(t._duration=e.duration),Object.keys(t._sprite).length===0&&(t._sprite={__default:[0,t._duration*1e3]}),t._state!=="loaded"&&(t._state="loaded",t._emit("load"),t._loadQueue())},Ti=function(){if(le.usingWebAudio){try{typeof AudioContext<"u"?le.ctx=new AudioContext:typeof webkitAudioContext<"u"?le.ctx=new webkitAudioContext:le.usingWebAudio=!1}catch{le.usingWebAudio=!1}le.ctx||(le.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(le._navigator&&le._navigator.platform),e=le._navigator&&le._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=e?parseInt(e[1],10):null;if(t&&r&&r<9){var o=/safari/.test(le._navigator&&le._navigator.userAgent.toLowerCase());le._navigator&&!o&&(le.usingWebAudio=!1)}le.usingWebAudio&&(le.masterGain=typeof le.ctx.createGain>"u"?le.ctx.createGainNode():le.ctx.createGain(),le.masterGain.gain.setValueAtTime(le._muted?0:le._volume,le.ctx.currentTime),le.masterGain.connect(le.ctx.destination)),le._setup()}};Rl(Xr,le,Mi,Li);/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2023, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 9.6.32 (js 20231027)
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/barcode-reader/sdk-javascript/
 */const mt=typeof self>"u",On=mt?{}:self;let qt,at,mi,Fi,ke;if(typeof navigator<"u"&&(qt=navigator,at=qt.userAgent,mi=qt.platform,Fi=qt.mediaDevices),!mt){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:qt.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:mi,search:"Win"},Mac:{str:mi},Linux:{str:mi}};let r="unknownBrowser",o=0,h="unknownOS";for(let g in t){const p=t[g]||{};let v=p.str||at,S=p.search||g,w=p.verStr||at,x=p.verSearch||g;if(x instanceof Array||(x=[x]),v.indexOf(S)!=-1){r=g;for(let E of x){let A=w.indexOf(E);if(A!=-1){o=parseFloat(w.substring(A+E.length+1));break}}break}}for(let g in e){const p=e[g]||{};let v=p.str||at,S=p.search||g;if(v.indexOf(S)!=-1){h=g;break}}h=="Linux"&&at.indexOf("Windows NT")!=-1&&(h="HarmonyOS"),ke={browser:r,version:o,OS:h}}mt&&(ke={browser:"ssr",version:0,OS:"ssr"});const Ll=typeof WebAssembly<"u"&&at&&!(/Safari/.test(at)&&!/Chrome/.test(at)&&/\(.+\s11_2_([2-6]).*\)/.test(at)),Fl=!(typeof Worker>"u"),qs=!(!Fi||!Fi.getUserMedia),Pl=async()=>{let t=!1;if(qs)try{(await Fi.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};ke.browser==="Chrome"&&ke.version>66||ke.browser==="Safari"&&ke.version>13||ke.browser==="OPR"&&ke.version>43||ke.browser==="Edge"&&ke.version;const kl=(()=>{if(!mt&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Zt=" is not allowed to change after `createInstance` or `loadWasm` is called.",Bl=!mt&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",Nl=!mt&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",An=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!mt){let r=document.createElement("a");r.href=t[e],t[e]=r.href}t[e].endsWith("/")||(t[e]+="/")}}return t};var Ee,Pi,vr,Ye,Ut;(function(t){t[t.IPF_Binary=0]="IPF_Binary",t[t.IPF_BinaryInverted=1]="IPF_BinaryInverted",t[t.IPF_GrayScaled=2]="IPF_GrayScaled",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888"})(Ee||(Ee={})),function(t){t[t.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",t[t.DBR_SUCCESS=0]="DBR_SUCCESS",t[t.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",t[t.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",t[t.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",t[t.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",t[t.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",t[t.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",t[t.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",t[t.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",t[t.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",t[t.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",t[t.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",t[t.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",t[t.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",t[t.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",t[t.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",t[t.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",t[t.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",t[t.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",t[t.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",t[t.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",t[t.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",t[t.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",t[t.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",t[t.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",t[t.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",t[t.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",t[t.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",t[t.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",t[t.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",t[t.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",t[t.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",t[t.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",t[t.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",t[t.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",t[t.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",t[t.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",t[t.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",t[t.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",t[t.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",t[t.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",t[t.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",t[t.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",t[t.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",t[t.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",t[t.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",t[t.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",t[t.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",t[t.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",t[t.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",t[t.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",t[t.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",t[t.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",t[t.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",t[t.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",t[t.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",t[t.DBR_PANORAMA_LICENSE_INVALID=-10060]="DBR_PANORAMA_LICENSE_INVALID",t[t.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",t[t.DBR_PHARMACODE_LICENSE_INVALID=-10062]="DBR_PHARMACODE_LICENSE_INVALID",t[t.DBR_IMAGE_ORIENTATION_INVALID=-10063]="DBR_IMAGE_ORIENTATION_INVALID",t[t.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",t[t.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",t[t.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",t[t.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS"}(Pi||(Pi={})),function(t){t[t.IMRDT_IMAGE=1]="IMRDT_IMAGE",t[t.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",t[t.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",t[t.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",t[t.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",t[t.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL"}(vr||(vr={})),function(t){t[t.BF_ALL=-29360129]="BF_ALL",t[t.BF_ONED=3147775]="BF_ONED",t[t.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",t[t.BF_CODE_39=1]="BF_CODE_39",t[t.BF_CODE_128=2]="BF_CODE_128",t[t.BF_CODE_93=4]="BF_CODE_93",t[t.BF_CODABAR=8]="BF_CODABAR",t[t.BF_ITF=16]="BF_ITF",t[t.BF_EAN_13=32]="BF_EAN_13",t[t.BF_EAN_8=64]="BF_EAN_8",t[t.BF_UPC_A=128]="BF_UPC_A",t[t.BF_UPC_E=256]="BF_UPC_E",t[t.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",t[t.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",t[t.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",t[t.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",t[t.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",t[t.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",t[t.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",t[t.BF_PATCHCODE=262144]="BF_PATCHCODE",t[t.BF_PDF417=33554432]="BF_PDF417",t[t.BF_QR_CODE=67108864]="BF_QR_CODE",t[t.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",t[t.BF_AZTEC=268435456]="BF_AZTEC",t[t.BF_MAXICODE=536870912]="BF_MAXICODE",t[t.BF_MICRO_QR=1073741824]="BF_MICRO_QR",t[t.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",t[t.BF_GS1_COMPOSITE=-2147483648]="BF_GS1_COMPOSITE",t[t.BF_MSI_CODE=1048576]="BF_MSI_CODE",t[t.BF_CODE_11=2097152]="BF_CODE_11",t[t.BF_NULL=0]="BF_NULL"}(Ye||(Ye={})),function(t){t[t.IRT_NO_RESULT=0]="IRT_NO_RESULT",t[t.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",t[t.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",t[t.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",t[t.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",t[t.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",t[t.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",t[t.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",t[t.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",t[t.IRT_CONTOUR=256]="IRT_CONTOUR",t[t.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",t[t.IRT_FORM=1024]="IRT_FORM",t[t.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",t[t.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",t[t.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL"}(Ut||(Ut={}));const Rn=t=>t&&typeof t=="object"&&typeof t.then=="function";class Zs extends Promise{constructor(e){let r,o;super((h,g)=>{r=h,o=g}),this._s="pending",this.resolve=h=>{this.isPending&&(Rn(h)?this.task=h:(this._s="fulfilled",r(h)))},this.reject=h=>{this.isPending&&(this._s="rejected",o(h))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let r;this._task=e,Rn(e)?r=e:typeof e=="function"&&(r=new Promise(e)),r&&(async()=>{try{const o=await r;e===this._task&&this.resolve(o)}catch(o){e===this._task&&this.reject(o)}})()}get isEmpty(){return this._task==null}}const nr=["iPhone","iPad","Android","HarmonyOS"].includes(ke.OS)?2048:4096;class j{constructor(){this._instanceID=void 0,this._ifSaveOriginalImageInACanvas=!1,this.oriCanvas=null,this.oriCanvasData=null,this.canvas=null,this.bFilterRegionInJs=!1,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0,this.intervalTime=0,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this._arrPolygons=[],this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.captureAndDecodeInParallel=!0,this.autoSuggestTip=!1,this.suggestTipFrameArray=[],this.suggestTipFrameLimit=[5,3],this.noIntermediateResultsCount=0,this.noIntermediateResultsTipLimit=100,this.tinyBarcodeTipModuleSizeLimit=3,this.hugeBarcodeTipLimit=.9,this.autoZoomInFrameArray=[],this.autoZoomInFrameLimit=[5,3],this.autoZoomInStepRate=1/3,this.autoZoomInMaxStep=1.5,this.autoZoomInMaxTimes=5,this.autoZoomInMinStep=Math.pow(10,1/this.autoZoomInMaxTimes),this.autoZoomInIdealModuleSize=6,this.autoZoomOutFrameCount=0,this.autoZoomOutFrameLimit=3,this.autoZoomOutStepRate=1/3,this.autoZoomOutMinValue=1,this.autoZoomOutMinStep=2,this.autoZoomOutStepRate_2=.05,this.autoZoomOutMinValue_2=2,this.frameArrayInIdealZoom=[],this.frameLimitInIdealZoom=[5,3],this.enableZoomOutInIdealZoom=!1,this.nextActionInIdealZoom="focus",this.autoFocusFrameArray=[],this.autoFocusFrameLimit=[5,3],this.autoZoomIdealArea=[0,.05],this.autoZoomTargetBorder=.9,this.autoZoomDetectionArea=.5,this.autoZoom=!1,this.autoFocus=!1,this._resultHighlightingDuration=-1,this._dce=null,this._imgSource=null,this._maxCvsSideLength=nr,this._promiseStartScan=null,this.beepSound=new Mi({src:[this._soundSource],onplayerror:(e,r)=>{console.warn(`Sound '${e}' playback failure: ${r}`)}})}static get version(){return this._version}static get license(){return this._license}static set license(e){((r,o)=>{const h=r;if(!h._pLoad.isEmpty)throw new Error("`license`"+Zt);h._license=o})(j,e)}static get productKeys(){return this._license}static set productKeys(e){j.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){j.license=e}static get organizationID(){return this._license}static set organizationID(e){j.license=e}static set sessionPassword(e){((r,o)=>{const h=r;if(!h._pLoad.isEmpty)throw new Error("`sessionPassword`"+Zt);h._sessionPassword=o})(j,e)}static get sessionPassword(){return this._sessionPassword}static async detectEnvironment(){return await(async()=>({wasm:Ll,worker:Fl,getUserMedia:qs,camera:await Pl(),browser:ke.browser,version:ke.version,OS:ke.OS}))()}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");j._engineResourcePath=(r=>{if(r==null&&(r="./"),!mt){let o=document.createElement("a");o.href=r,r=o.href}return r.endsWith("/")||(r+="/"),r})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((r,o)=>{const h=r;if(!h._pLoad.isEmpty)throw new Error("`licenseServer`"+Zt);h._licenseServer=An(o)})(j,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((r,o)=>{const h=r;if(!h._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Zt);h._deviceFriendlyName=o||""})(j,e)}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if(!this._pLoad.isEmpty)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");j.__bUseFullFeature=e}static isImageSource(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"getImage"in e}static isDSImage(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"width"in e&&"height"in e&&"pixelFormat"in e}static isDCEFrame(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e,this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}static isWasmLoaded(){return this._pLoad.isFulfilled}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static get defaultUIElementURL(){var e;return(e=j._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",j.engineResourcePath)}static set defaultUIElementURL(e){j._defaultUIElementURL=e}static _fireHTTPSWarnning(){j.onWarning&&location&&location.protocol!=="https:"&&setTimeout(()=>{j.onWarning&&j.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}get soundSource(){return this._soundSource}set soundSource(e){this._soundSource=e,this.beepSound=new Mi({src:[this._soundSource],onplayerror:(r,o)=>{console.warn(`Sound '${r}' playback failure: ${o}`)}})}get whenToPlaySoundforSuccessfulRead(){return this.bPlaySoundOnSuccessfulRead===!0?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead=e!=="never"&&e}get whenToVibrateforSuccessfulRead(){return this.bVibrateOnSuccessfulRead===!0?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead=e!=="never"&&e}set dce(e){this._dce=e}get dce(){return!this._dce||this._dce.isDisposed||this._dce.disposed?null:this._dce}set maxCvsSideLength(e){this._maxCvsSideLength=e,this._dceControler&&this._dceControler.setDisiredValue(this,"maxCvsSideLength",e)}get maxCvsSideLength(){return this._maxCvsSideLength}async _registerDCEControler(){if(!this.dce)return;j._onLog&&j._onLog("_registerDCEControler()");const e=this.dce;this._dceControler=e._createControler();const r=this._dceControler;r.register(this),r.setDisiredValue(this,"refreshInterval",200),r.setDisiredValue(this,"maxCvsSideLength",this._maxCvsSideLength),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"});try{}catch(g){g.name==="ReferenceError"&&window&&(window.ResizeObserver=void 0)}const o=e.getUIElement(),h=this.dce.constructor;if(h._defaultUIElementURL==="@engineResourcePath/dce.ui.html")try{o?o===r._innerSetUI&&(await e.setUIElement(`${h.engineResourcePath}dce.ui.html`),r._innerSetUI=e.getUIElement()):(await e.setUIElement(`${h.engineResourcePath}dbr.ui.html`),r._innerSetUI=e.getUIElement())}catch{await e.setUIElement(h.defaultUIElementURL)}else o||await e.setUIElement(h.defaultUIElementURL);this.callbackCameraChange=()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackResolutionChange=()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackCameraClose=()=>{this.stopScanning(!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1},this.callbackSingleFrameAcquired=async g=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null);let p=await this._decode_DCEFrame(g,{bCopyData:!1}),v=null;if(p&&p.length){const{sx:S,sy:w,width:x,height:E,_sWidth:A,_sHeight:W}=g;v=p.map(Y=>({localizationResult:JSON.parse(JSON.stringify(Y.localizationResult))})),j.recalculateResultLocation(v,S,w,A,W,x,E)}if(this._drawResults(v,p),await this.clearMapDecodeRecord(),this.onImageRead&&this.dce.isOpen()&&!this._bPauseScan){let S=this._cloneDecodeResults(p);this.onImageRead(S)}if(this.onUniqueRead&&this.dce.isOpen()&&!this._bPauseScan)for(let S of p)this.onUniqueRead(S.barcodeText,this._cloneDecodeResults(S))},e.on("cameraChange",this.callbackCameraChange),e.on("resolutionChange",this.callbackResolutionChange),e.on("cameraClose",this.callbackCameraClose),e.on("singleFrameAcquired",this.callbackSingleFrameAcquired)}_logoutDCEControler(){this.dce&&this._dceControler&&(j._onLog&&j._onLog("_logoutDCEControler()"),this._dceControler.logout(this),this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this._dceControler=null,this.dce=null)}async setImageSource(e,r){if(e==null)return this._imgSource=null,this._logoutDCEControler(),void(this._drawingItemNamespace=null);if(e&&e.isCameraEnhancer)this.dce=e,await this._registerDCEControler(),this._imgSource=null;else{if(!j.isImageSource(e))throw new Error("Invalid value.");this._logoutDCEControler(),this._imgSource=e}r&&r.resultsHighlightBaseShapes&&(this._drawingItemNamespace=r.resultsHighlightBaseShapes)}static async loadWasm(){if(this._pLoad.isEmpty){let{lt:e,l:r,ls:o,sp:h,rmk:g}=(p=>{const v=p;if(v._pLoad.isEmpty){let S,w,x=v._license||"",E=JSON.parse(JSON.stringify(v._licenseServer)),A=v._sessionPassword,W=0;if(x.startsWith("t")||x.startsWith("f"))W=0;else if(x.length===0||x.startsWith("P")||x.startsWith("L")||x.startsWith("Y")||x.startsWith("A"))W=1;else{W=2;const Y=x.indexOf(":");if(Y!=-1&&(x=x.substring(Y+1)),x.startsWith("DLS2")){let z;try{let q=x.substring(4);q=atob(q),z=JSON.parse(q)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(x=z.handshakeCode?z.handshakeCode:z.organizationID?z.organizationID:"",typeof x=="number"&&(x=JSON.stringify(x)),E.length===0){let q=[];z.mainServerURL&&(q[0]=z.mainServerURL),z.standbyServerURL&&(q[1]=z.standbyServerURL),E=An(q)}!A&&z.sessionPassword&&(A=z.sessionPassword),S=z.remark}(x==="200001"||x.startsWith("200001-"))&&(E&&E.length||(x="")),x||(W=1)}if(W&&(On.crypto||(w="Please upgrade your browser to support online key."),On.crypto.subtle||(w="Require https to use online key in this browser.")),w){if(W!==1)throw new Error(w);W=0,console.warn(w),v._lastErrorCode=-1,v._lastErrorString=w}return W===1&&(x="",console.warn("Applying for a public trial license ...")),{lt:W,l:x,ls:E,sp:A,rmk:S}}throw new Error("Can't preprocess license again"+Zt)})(j);this._pLoad.task=async(p,v)=>{let S=j.engineResourcePath+j._workerName;j.engineResourcePath.startsWith(location.origin)||(S=await fetch(S).then(w=>w.blob()).then(w=>URL.createObjectURL(w))),j._dbrWorker=new Worker(S),j._dbrWorker.onerror=w=>{let x=new Error(w.message);v(x)},j._dbrWorker.onmessage=async w=>{let x=w.data?w.data:w;switch(x.type){case"log":j._onLog&&j._onLog(x.message);break;case"load":{x.message&&(x.message=x.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let E,A=!1;e===1&&(A=!0,x.message||(x.message="Using a temporary license. [Register for a 30-day trial license >>>](https://www.dynamsoft.com/customer/license/trialLicense?product=dbr&deploymenttype=browser)")),x.success?(j._dbrWorker.onerror=null,j._version=x.version+"(JS "+j._jsVersion+"."+j._jsEditVersion+")",j._onLog&&j._onLog("load dbr worker success"),x.message&&console.warn(x.message)):(E=new Error(x.message),E.stack=x.stack+`
`+E.stack,E.ltsErrorCode=x.ltsErrorCode,A||x.ltsErrorCode==111&&x.message.toLowerCase().indexOf("trial license")!=-1&&(A=!0)),A&&j.showDialog(x.success?"warn":"error",x.message),x.success?p():v(E);break}case"task":{let E=x.id,A=x.body;try{j._taskCallbackMap.get(E)(A),j._taskCallbackMap.delete(E)}catch(W){throw j._taskCallbackMap.delete(E),W}break}default:j._onLog&&j._onLog(w)}},j._dbrWorker.postMessage({type:"loadWasm",engineResourcePath:j.engineResourcePath,bUseFullFeature:j._bUseFullFeature,bd:j._bWasmDebug,v:j._jsVersion,brtk:!!e,bptk:e===1,l:r,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:ke,cv:j.authCacheVersion,fn:j.deviceFriendlyName,ls:o,sp:h,rmk:g})}}await this._pLoad}static async showDialog(e,r){await(async(o,h,g)=>{if(!o._bNeverShowDialog)try{let p=await fetch(o.engineResourcePath+"dls.license.dialog.html");if(!p.ok)throw Error("Get license dialog fail. Network Error: "+p.statusText);let v=await p.text();if(!v.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let S=document.createElement("div");S.innerHTML=v;let w=[];for(let J=0;J<S.childElementCount;++J){let Z=S.children[J];Z instanceof HTMLStyleElement&&(w.push(Z),document.head.append(Z))}let x=S.childElementCount==1?S.children[0]:S;x.remove();let E,A,W,Y,z,q=[x],te=x.children;for(let J of te)q.push(J);for(let J=0;J<q.length;++J)for(let Z of q[J].children)q.push(Z);for(let J of q)if(!E&&J.classList.contains("dls-license-mask"))E=J,J.addEventListener("click",Z=>{if(J==Z.target){x.remove();for(let ee of w)ee.remove()}});else if(!A&&J.classList.contains("dls-license-icon-close"))A=J,J.addEventListener("click",()=>{x.remove();for(let Z of w)Z.remove()});else if(!W&&J.classList.contains("dls-license-icon-error"))W=J,h!="error"&&J.remove();else if(!Y&&J.classList.contains("dls-license-icon-warn"))Y=J,h!="warn"&&J.remove();else if(!z&&J.classList.contains("dls-license-msg-content")){z=J;let Z=g;for(;Z;){let ee=Z.indexOf("["),he=Z.indexOf("]",ee),fe=Z.indexOf("(",he),_e=Z.indexOf(")",fe);if(ee==-1||he==-1||fe==-1||_e==-1){J.appendChild(new Text(Z));break}ee>0&&J.appendChild(new Text(Z.substring(0,ee)));let y=document.createElement("a"),ge=Z.substring(ee+1,he);y.innerText=ge;let pe=Z.substring(fe+1,_e);y.setAttribute("href",pe),y.setAttribute("target","_blank"),J.appendChild(y),Z=Z.substring(_e+1)}}document.body.appendChild(x)}catch(p){o._onLog&&o._onLog(p.message||p)}})(this,e,r)}static async createInstanceInWorker(e=!1){return await j.loadWasm(),await new Promise((r,o)=>{let h=j._nextTaskID++;j._taskCallbackMap.set(h,g=>{if(g.success)return r(g.instanceID);{let p=new Error(g.message);return p.stack=g.stack+`
`+p.stack,o(p)}}),j._dbrWorker.postMessage({type:"createInstance",id:h,bScanner:e})})}static async createInstance(){const e=new j;return e._instanceID=await j.createInstanceInWorker(),j._fireHTTPSWarnning(),e}async clearMapDecodeRecord(){return await new Promise((e,r)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,h=>{if(h.success)return e();{let g=new Error(h.message);return g.stack=h.stack+`
`+g.stack,r(g)}}),j._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:o,instanceID:this._instanceID})})}async decode(e){j._onLog&&j._onLog("decode(source: any)"),j._onLog&&(this._timeStartDecode=Date.now());{let r={};return!this.region||this.region instanceof Array||(r.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?await this._decode_Blob(e,r):e instanceof ArrayBuffer?await this._decode_ArrayBuffer(e,r):e instanceof Uint8Array||e instanceof Uint8ClampedArray?await this._decode_Uint8Array(e,r):e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?await this._decode_Image(e,r):e instanceof HTMLCanvasElement?await this._decode_Canvas(e,r):e instanceof HTMLVideoElement?await this._decode_Video(e,r):typeof e=="string"?e.substring(0,11)=="data:image/"?await this._decode_Base64(e,r):await this._decode_Url(e,r):j.isDCEFrame(e)?(r.bCopyData=!0,await this._decode_DCEFrame(e,r)):j.isDSImage(e)?(r.bCopyData=!0,await this._decode_DSImage(e,r)):await Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}async decodeBase64String(e){let r={};return!this.region||this.region instanceof Array||(r.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,r)}async decodeUrl(e){let r={};return!this.region||this.region instanceof Array||(r.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,r)}async _decodeBuffer_Uint8Array(e,r,o,h,g,p,v){return await new Promise((S,w)=>{let x=j._nextTaskID++;j._taskCallbackMap.set(x,E=>{if(E.success){let A,W=j._onLog?Date.now():0;j._onLog&&j._onLog("worker return result: "+W),this._lastInnerDecodeDuration=E.duration;try{A=this._handleRetJsonString(E.decodeReturn)}catch(Y){return w(Y)}if(j._onLog){let Y=Date.now();j._onLog("DBR getting message from worker timestamp: "+W),j._onLog("From DBR staring decoding to entering worker costs: "+(this._timeEnterInnerDBR-this._timeStartDecode)),j._onLog("From DBR entering worker to returning message from worker costs: "+(W-this._timeEnterInnerDBR)),j._onLog("Handling results from DBR worker costs: "+(Y-W)),j._onLog("Total decoding image costs: "+(Y-this._timeStartDecode))}return S(A)}{let A=new Error(E.message);return A.stack=E.stack+`
`+A.stack,w(A)}}),this._timeEnterInnerDBR=Date.now(),j._onLog&&j._onLog("Sending buffer to worker timestamp:"+this._timeEnterInnerDBR),j._dbrWorker.postMessage({type:"decodeBuffer",id:x,instanceID:this._instanceID,body:{buffer:e,width:r,height:o,stride:h,format:g,orientation:p,config:v}},[e.buffer]),j._onLog&&v&&v.timeStamp&&j._onLog("Delay of decoding image: "+(this._timeEnterInnerDBR-v.timeStamp))})}async _decodeBuffer_Blob(e,r,o,h,g,p,v){j._onLog&&j._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const S=e.arrayBuffer?await e.arrayBuffer():await new Promise((w,x)=>{let E=new FileReader;E.readAsArrayBuffer(e),E.onload=()=>{w(E.result)},E.onerror=()=>{x(E.error)}});return await this._decodeBuffer_Uint8Array(new Uint8Array(S),r,o,h,g,p,v)}async decodeBuffer(e,r,o,h,g,p,v){let S;return j._onLog&&j._onLog("decodeBuffer(buffer,width,height,stride,format)"),j._onLog&&(this._timeStartDecode=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?S=await this._decodeBuffer_Uint8Array(e,r,o,h,g,p,v):e instanceof ArrayBuffer?S=await this._decodeBuffer_Uint8Array(new Uint8Array(e),r,o,h,g,p,v):e instanceof Blob&&(S=await this._decodeBuffer_Blob(e,r,o,h,g,p,v)),S}async _decodeFileInMemory_Uint8Array(e){return await new Promise((r,o)=>{let h=j._nextTaskID++;j._taskCallbackMap.set(h,g=>{if(g.success){let p;this._lastInnerDecodeDuration=g.duration;try{p=this._handleRetJsonString(g.decodeReturn)}catch(v){return o(v)}return r(p)}{let p=new Error(g.message);return p.stack=g.stack+`
`+p.stack,o(p)}}),j._dbrWorker.postMessage({type:"decodeFileInMemory",id:h,instanceID:this._instanceID,body:{bytes:e}})})}async getRuntimeSettings(){return await new Promise((e,r)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,h=>{if(h.success){let g=JSON.parse(h.results);return this.userDefinedRegion!=null&&(g.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(g)}{let g=new Error(h.message);return g.stack=h.stack+`
`+g.stack,r(g)}}),j._dbrWorker.postMessage({type:"getRuntimeSettings",id:o,instanceID:this._instanceID})})}async updateRuntimeSettings(e){let r;if(typeof e=="string")if(e=="speed"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,r.region=o.region,r.deblurLevel=3,r.expectedBarcodesCount=0,r.localizationModes=[2,0,0,0,0,0,0,0]}else if(e=="balance"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,r.region=o.region,r.deblurLevel=5,r.expectedBarcodesCount=512,r.localizationModes=[2,16,0,0,0,0,0,0]}else if(e=="coverage"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,r.region=o.region}else if(e=="dense"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,r.region=o.region,r.deblurLevel=9,r.expectedBarcodesCount=0,r.localizationModes=[2,8,0,0,0,0,0,0]}else if(e=="distance"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,r.region=o.region,r.deblurLevel=3,r.expectedBarcodesCount=0,r.localizationModes=[2,8,0,0,0,0,0,0]}else r=JSON.parse(e);else{if(typeof e!="object")throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(r=JSON.parse(JSON.stringify(e)),r.region instanceof Array){let o=r.region;[o.regionLeft,o.regionTop,o.regionLeft,o.regionBottom,o.regionMeasuredByPercentage].some(h=>h!==void 0)&&(r.region={regionLeft:o.regionLeft||0,regionTop:o.regionTop||0,regionRight:o.regionRight||0,regionBottom:o.regionBottom||0,regionMeasuredByPercentage:o.regionMeasuredByPercentage||0})}}if(!j._bUseFullFeature){if(r.barcodeFormatIds&~(Ye.BF_ONED|Ye.BF_QR_CODE|Ye.BF_PDF417|Ye.BF_DATAMATRIX)||r.barcodeFormatIds_2!=0)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(r.intermediateResultTypes!=0)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(this.bFilterRegionInJs){let o=r.region;if(o instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(o)),(o.regionLeft||o.regionTop||o.regionRight||o.regionBottom||o.regionMeasuredByPercentage)&&(o.regionLeft||o.regionTop||o.regionRight!=100||o.regionBottom!=100||!o.regionMeasuredByPercentage)?this.region=o:this.region=null,r.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return(this.autoZoom||this.autoFocus)&&(r.intermediateResultTypes|=Ut.IRT_TYPED_BARCODE_ZONE),await new Promise((o,h)=>{let g=j._nextTaskID++;j._taskCallbackMap.set(g,p=>{if(p.success){try{this._handleRetJsonString(p.updateReturn)}catch(v){h(v)}return o()}{let v=new Error(p.message);return v.stack=p.stack+`
`+v.stack,h(v)}}),j._dbrWorker.postMessage({type:"updateRuntimeSettings",id:g,instanceID:this._instanceID,body:{settings:JSON.stringify(r)}})})}async resetRuntimeSettings(){return this.userDefinedRegion=null,this.region=null,this.maxCvsSideLength=nr,await new Promise((e,r)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,h=>{if(h.success)return e();{let g=new Error(h.message);return g.stack=h.stack+`
`+g.stack,r(g)}}),j._dbrWorker.postMessage({type:"resetRuntimeSettings",id:o,instanceID:this._instanceID})})}async _resetRuntimeSettingsToCppDefault(){return this.userDefinedRegion=null,this.region=null,this.maxCvsSideLength=nr,await new Promise((e,r)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,h=>{if(h.success)return e();{let g=new Error(h.message);return g.stack=h.stack+`
`+g.stack,r(g)}}),j._dbrWorker.postMessage({type:"resetRuntimeSettingsToCppDefault",id:o,instanceID:this._instanceID})})}async outputRuntimeSettingsToString(){if(!j._bUseFullFeature)throw Error("outputRuntimeSettingsToString() is not supported in the compact version. Please try the full-featured version.");return await new Promise((e,r)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,h=>{if(h.success)return e(h.results);{let g=new Error(h.message);return g.stack=h.stack+`
`+g.stack,r(g)}}),j._dbrWorker.postMessage({type:"outputRuntimeSettingsToString",id:o,instanceID:this._instanceID})})}async initRuntimeSettingsWithString(e){if(!j._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if(typeof e=="string")e=e;else{if(typeof e!="object")throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return await new Promise((r,o)=>{let h=j._nextTaskID++;j._taskCallbackMap.set(h,g=>{if(g.success){try{this._handleRetJsonString(g.initReturn)}catch(p){o(p)}return r()}{let p=new Error(g.message);return p.stack=g.stack+`
`+p.stack,o(p)}}),j._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:h,instanceID:this._instanceID,body:{settings:e}})})}async _decode_Blob(e,r){j._onLog&&j._onLog("_decode_Blob(blob: Blob)");let o=null,h=null;if(typeof createImageBitmap<"u")try{o=await createImageBitmap(e)}catch{}o||(h=await function(p){return new Promise((v,S)=>{let w=URL.createObjectURL(p),x=new Image;x.dbrObjUrl=w,x.src=w,x.onload=()=>{v(x)},x.onerror=E=>{S(new Error("Can't convert blob to image : "+(E instanceof Event?E.type:E)))}})}(e));let g=await this._decode_Image(o||h,r);return o&&o.close(),g}async _decode_ArrayBuffer(e,r){return await this._decode_Blob(new Blob([e]),r)}async _decode_Uint8Array(e,r){return await this._decode_Blob(new Blob([e]),r)}async _decode_Image(e,r){j._onLog&&j._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),r=r||{};let o,h,g=e instanceof HTMLImageElement?e.naturalWidth:e.width,p=e instanceof HTMLImageElement?e.naturalHeight:e.height,v=Math.max(g,p);if(v>this._maxCvsSideLength){let x=this._maxCvsSideLength/v;o=Math.round(g*x),h=Math.round(p*x)}else o=g,h=p;this.canvas||(this.canvas=document.createElement("canvas"));const S=this.canvas;S.width===o&&S.height===h||(S.width=o,S.height=h),S.ctx2d||(S.ctx2d=S.getContext("2d",{willReadFrequently:!0})),S.ctx2d.drawImage(e,0,0,g,p,0,0,o,h),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl);let w=await this._decode_Canvas(S,r);if(this.ifSaveOriginalImageInACanvas){const x=document.createElement("canvas");x.width=e.width,x.height=e.height,x.getContext("2d").drawImage(e,0,0),this.oriCanvas=x,this.oriCanvasData=null}return j.recalculateResultLocation(w,0,0,g,p,o,h),w}async _decode_Canvas(e,r){if(j._onLog&&j._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if(e.width===0||e.height===0)throw Error("The width or height of the 'canvas' is 0.");this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=e,this.oriCanvasData=null);let o=(e.ctx2d||e.getContext("2d",{willReadFrequently:!0})).getImageData(0,0,e.width,e.height).data;return await this._decodeBuffer_Uint8Array(o,e.width,e.height,4*e.width,Ee.IPF_ABGR_8888,0,r)}async _decode_Video(e,r){if(j._onLog&&j._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";r=r||{};let o,h,g=e.videoWidth,p=e.videoHeight,v=Math.max(g,p);if(v>this._maxCvsSideLength){let x=this._maxCvsSideLength/v;o=Math.round(g*x),h=Math.round(p*x)}else o=g,h=p;this.canvas||(this.canvas=document.createElement("canvas"));const S=this.canvas;S.width===o&&S.height===h||(S.width=o,S.height=h),S.ctx2d||(S.ctx2d=S.getContext("2d",{willReadFrequently:!0})),S.ctx2d.drawImage(e,0,0,g,p,0,0,o,h);let w=await this._decode_Canvas(S,r);if(this.ifSaveOriginalImageInACanvas){const x=document.createElement("canvas");x.width=e.videoWidth,x.height=e.videoHeight,x.getContext("2d").drawImage(e,0,0),this.oriCanvas=x,this.oriCanvasData=null}return j.recalculateResultLocation(w,0,0,g,p,o,h),w}async _decode_DCEFrame(e,r){if(j._onLog&&j._onLog("_decode_DCEFrame(dceFrame)"),!j.isDCEFrame(e))return[];let o=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,colorMode:e.colorMode,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{width:h,height:g,colorMode:p,pixelFormat:v,stride:S,timeStamp:w}=e;let x;x=r&&r.bCopyData?new Uint8Array(e.data):e.data;let E=null;if(r?(E=JSON.parse(JSON.stringify(r)),E.timeStamp=w):E={timeStamp:w},v&&S)if(v==="grey")o=await this._decodeBuffer_Uint8Array(x,h,g,S,Ee.IPF_GrayScaled,0,E);else if(v==="rgba")o=await this._decodeBuffer_Uint8Array(x,h,g,S,Ee.IPF_ABGR_8888,0,E);else{if(v!=="bgra")throw new Error(`Pixel format '${v}' is not supported to decode.`);o=await this._decodeBuffer_Uint8Array(x,h,g,S,Ee.IPF_ARGB_8888,0,E)}else if(p==="grey")o=await this._decodeBuffer_Uint8Array(x,h,g,h,Ee.IPF_GrayScaled,0,E);else if(p==="rgba")o=await this._decodeBuffer_Uint8Array(x,h,g,4*h,Ee.IPF_ABGR_8888,0,E);else{if(p!=="bgra")throw new Error(`Color mode '${p}' is not supported to decode.`);o=await this._decodeBuffer_Uint8Array(x,h,g,4*h,Ee.IPF_ARGB_8888,0,E)}return o}async _decode_DSImage(e,r){if(j._onLog&&j._onLog("_decode_DSImage(dsImage)"),!j.isDSImage(e))return null;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat.toLowerCase(),data:new Uint8Array(e.data),toCanvas:function(){const w=document.createElement("canvas");let x;switch(w.width=this.width,w.height=this.height,this.pixelFormat){case"grey":x=new Uint8ClampedArray(this.width*this.height*4);for(let A=0;A<x.length;A+=4)x[A]=this.data[A/4],x[A+1]=this.data[A/4],x[A+2]=this.data[A/4],x[A+3]=255;break;case"rgb":x=new Uint8ClampedArray(this.width*this.height*4);for(let A=0;A<x.length;A+=4)x[A]=this.data[A],x[A+1]=this.data[A+1],x[A+2]=this.data[A+2],x[A+3]=255;break;case"bgr":x=new Uint8ClampedArray(this.width*this.height*4);for(let A=0;A<x.length;A+=4)x[A]=this.data[A],x[A+1]=this.data[A+1],x[A+2]=this.data[A+2],x[A+3]=255;break;case"rgba":case"bgra":x=new Uint8ClampedArray(this.data);break;default:throw new Error("The content of 2D Canvas is currently limited to the sRGB color space.")}const E=new ImageData(x,this.width,this.height);return w.getContext("2d").putImageData(E,0,0),w}});const{width:o,height:h}=e;let g,p,v,S=e.pixelFormat.toLowerCase();switch(g=r&&r.bCopyData?new Uint8Array(e.data):e.data,S){case"grey":v=Ee.IPF_GrayScaled,p=o;break;case"rgb":v=Ee.IPF_BGR_888,p=3*o;break;case"bgr":v=Ee.IPF_RGB_888,p=3*o;break;case"rgba":v=Ee.IPF_ABGR_8888,p=4*o;break;case"bgra":v=Ee.IPF_ARGB_8888,p=4*o;break;default:throw new Error("The pixel format is not supported to decode.")}return await this._decodeBuffer_Uint8Array(g,o,h,p,v,0,r)}async _decode_Base64(e,r){if(j._onLog&&j._onLog("_decode_Base64(base64Str)"),typeof e!="string")return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");e.substring(0,11)=="data:image/"&&(e=e.substring(e.indexOf(",")+1));{let o=atob(e),h=o.length,g=new Uint8Array(h);for(;h--;)g[h]=o.charCodeAt(h);return await this._decode_Blob(new Blob([g]),r)}}async _decode_Url(e,r){if(j._onLog&&j._onLog("_decode_Url(url)"),typeof e!="string")throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");e=e;{let o=await new Promise((h,g)=>{let p=new XMLHttpRequest;p.open("GET",e,!0),p.responseType="blob",p.send(),p.onloadend=async()=>{h(p.response)},p.onerror=()=>{g(new Error("Network Error: "+p.statusText))}});return await this._decode_Blob(o,r)}}async _decode_FilePath(e,r){throw j._onLog&&j._onLog("_decode_FilePath(path)"),Error("'_decode_FilePath(path, config)': The method is only supported in node environment.")}static recalculateResultLocation(e,r,o,h,g,p,v){if(e.length>0)for(let S of e){let w=S.localizationResult;w.resultCoordinateType==2&&(w.x1*=.01*p,w.x2*=.01*p,w.x3*=.01*p,w.x4*=.01*p,w.y1*=.01*v,w.y2*=.01*v,w.y3*=.01*v,w.y4*=.01*v);let x=p/h,E=v/g;w.x1=w.x1/x+r,w.x2=w.x2/x+r,w.x3=w.x3/x+r,w.x4=w.x4/x+r,w.y1=w.y1/E+o,w.y2=w.y2/E+o,w.y3=w.y3/E+o,w.y4=w.y4/E+o,w.resultCoordinateType==2&&(w.x1*=100/h,w.x2*=100/h,w.x3*=100/h,w.x4*=100/h,w.y1*=100/g,w.y2*=100/g,w.y3*=100/g,w.y4*=100/g),w.x1=Math.round(w.x1),w.x2=Math.round(w.x2),w.x3=Math.round(w.x3),w.x4=Math.round(w.x4),w.y1=Math.round(w.y1),w.y2=Math.round(w.y2),w.y3=Math.round(w.y3),w.y4=Math.round(w.y4)}}static BarcodeReaderException(e,r){let o,h=Pi.DBR_UNKNOWN;return typeof e=="number"?(h=e,o=new Error(r)):o=new Error(e),o.code=h,o}_handleRetJsonString(e){let r=Pi;if(e.textResults){for(let o=0;o<e.textResults.length;o++){let h=e.textResults[o];try{let g=h.barcodeText,p="";for(let v=0;v<g.length;v++)p+=String.fromCharCode(g[v]);try{h.barcodeText=decodeURIComponent(escape(p))}catch{h.barcodeText=p}}catch{h.barcodeText=""}if(h.exception!=null){j._setWarnnedEx.has(h.exception)||(j._setWarnnedEx.add(h.exception),console.warn(h.exception));let g={};h.exception.split(";").forEach(p=>{let v=p.indexOf(":");g[p.substring(0,v)]=p.substring(v+1)}),h.exception=g}}return e.decodeRecords?this.decodeRecords=e.decodeRecords:this.decodeRecords={},this._lastErrorCode=e.exception,this._lastErrorString=e.description,e.exception&&!j._setWarnnedEx.has(e.description)&&(j._setWarnnedEx.add(e.description),console.warn(e.description)),e.textResults}if(e.exception==r.DBR_SUCCESS)return e.data;throw j.BarcodeReaderException(e.exception,e.description)}async setModeArgument(e,r,o,h){return await new Promise((g,p)=>{let v=j._nextTaskID++;j._taskCallbackMap.set(v,S=>{if(S.success){try{this._handleRetJsonString(S.setReturn)}catch(w){return p(w)}return g()}{let w=new Error(S.message);return w.stack=S.stack+`
`+w.stack,p(w)}}),j._dbrWorker.postMessage({type:"setModeArgument",id:v,instanceID:this._instanceID,body:{modeName:e,index:r,argumentName:o,argumentValue:h}})})}async getModeArgument(e,r,o){return await new Promise((h,g)=>{let p=j._nextTaskID++;j._taskCallbackMap.set(p,v=>{if(v.success){let S;try{S=this._handleRetJsonString(v.getReturn)}catch(w){return g(w)}return h(S)}{let S=new Error(v.message);return S.stack=v.stack+`
`+S.stack,g(S)}}),j._dbrWorker.postMessage({type:"getModeArgument",id:p,instanceID:this._instanceID,body:{modeName:e,index:r,argumentName:o}})})}async getIntermediateResults(){return await new Promise((e,r)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,h=>{if(h.success)return e(h.results);{let g=new Error(h.message);return g.stack=h.stack+`
`+g.stack,r(g)}}),j._dbrWorker.postMessage({type:"getIntermediateResults",id:o,instanceID:this._instanceID,body:{isCharge:!0}})})}async getIntermediateCanvas(){let e=await this.getIntermediateResults(),r=[];for(let o of e)if(o.dataType==vr.IMRDT_IMAGE)for(let h of o.results){const g=h.bytes;let p;switch(j._onLog&&j._onLog(" "+g.length+" "+g.byteLength+" "+h.width+" "+h.height+" "+h.stride+" "+h.format),h.format){case Ee.IPF_ABGR_8888:p=new Uint8ClampedArray(g);break;case Ee.IPF_RGB_888:{const w=g.length/3;p=new Uint8ClampedArray(4*w);for(let x=0;x<w;++x)p[4*x]=g[3*x+2],p[4*x+1]=g[3*x+1],p[4*x+2]=g[3*x],p[4*x+3]=255;break}case Ee.IPF_GrayScaled:{const w=g.length;p=new Uint8ClampedArray(4*w);for(let x=0;x<w;x++)p[4*x]=p[4*x+1]=p[4*x+2]=g[x],p[4*x+3]=255;break}case Ee.IPF_Binary:case Ee.IPF_BinaryInverted:{const w=g.length,x=h.width,E=h.height,A=h.stride;p=new Uint8ClampedArray(x*E*4);for(let W=0;W<w;W++){let Y=g[W],z=W%A*8,q=Math.floor(W/A);for(let te=0;te<8;te++){let J=z+te,Z=4*(q*x+J);if(J>=x)break;p[Z]=p[Z+1]=p[Z+2]=(128&Y)/128*255,p[Z+3]=255,Y<<=1}}break}default:console.warn("unknow intermediate image",h)}if(!p)continue;let v=new ImageData(p,h.width,h.height),S=document.createElement("canvas");S.width=h.width,S.height=h.height,S.getContext("2d").putImageData(v,0,0),r.push(S)}return r}async getScanSettings(){return await new Promise((e,r)=>{let o=j._nextTaskID++;j._taskCallbackMap.set(o,h=>{if(h.success){let g=h.results;return g.intervalTime=this.intervalTime,g.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,g.soundOnSuccessfullRead=this.soundSource,g.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,g.vibrateDuration=this.vibrateDuration,g.captureAndDecodeInParallel=this.captureAndDecodeInParallel,g.autoZoom=this.autoZoom,g.autoFocus=this.autoFocus,g.autoSuggestTip=this.autoSuggestTip,e(g)}{let g=new Error(h.message);return g.stack+=`
`+h.stack,r(g)}}),j._dbrWorker.postMessage({type:"getScanSettings",id:o,instanceID:this._instanceID})})}async updateScanSettings(e){if(!e)return;const r=JSON.parse(JSON.stringify(e));if(r.autoZoom||r.autoFocus||r.autoSuggestTip){if(!j._bUseFullFeature)throw new Error("'autoZoom', 'autoFocus' and 'autoSuggestTip' are not supported in the compact version. Please try the full-featured version.");const o=await this.getRuntimeSettings();o.intermediateResultTypes|=Ut.IRT_TYPED_BARCODE_ZONE,await this.updateRuntimeSettings(o)}return r.hasOwnProperty("intervalTime")&&(this.intervalTime=Math.max(r.intervalTime,0),delete r.intervalTime),r.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=r.whenToPlaySoundforSuccessfulRead,delete r.whenToPlaySoundforSuccessfulRead),r.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundSource=r.soundOnSuccessfullRead,delete r.soundOnSuccessfullRead),r.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=r.whenToVibrateforSuccessfulRead,delete r.whenToVibrateforSuccessfulRead),r.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=r.vibrateDuration,delete r.vibrateDuration),r.hasOwnProperty("captureAndDecodeInParallel")&&(this.captureAndDecodeInParallel=r.captureAndDecodeInParallel,delete r.captureAndDecodeInParallel),r.hasOwnProperty("autoZoom")&&(this.autoZoom&&this.autoZoom!=r.autoZoom&&this.dce&&this.dce.setZoom({factor:1}).catch(()=>{}),this.autoZoom=r.autoZoom,delete r.autoZoom),r.hasOwnProperty("autoFocus")&&(this.autoFocus=r.autoFocus,this.dce&&this.dce.setFocus({mode:"continuous"}).catch(()=>{}),delete r.autoFocus),r.hasOwnProperty("autoSuggestTip")&&(this.autoSuggestTip=r.autoSuggestTip,delete r.autoFocus),await new Promise((o,h)=>{let g=j._nextTaskID++;j._taskCallbackMap.set(g,p=>{if(p.success)return o();{let v=new Error(p.message);return v.stack+=`
`+p.stack,h(v)}}),j._dbrWorker.postMessage({type:"updateScanSettings",id:g,instanceID:this._instanceID,body:{settings:r}})})}_cloneDecodeResults(e){if(e instanceof Array){let r=[];for(let o of e)r.push(this._cloneDecodeResults(o));return r}return JSON.parse(JSON.stringify(e,(h,g)=>h=="oriVideoCanvas"||h=="searchRegionCanvas"?void 0:g))}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),void this._drawResults(null);if(this.dce&&!this.dce.isOpen())return this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce&&!this._imgSource||this._bPauseScan)return j._onLog&&j._onLog("Scan is paused, or imageSource is not set. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause));j._onLog&&j._onLog("======= once read ======="),j._onLog&&(this._timeStartDecode=Date.now());let e=null,r=null;if(this.dce)e=this._getVideoFrame();else if(this._imgSource&&(r=await this._imgSource.getImage(),!j.isDSImage(r)))throw new Error("Invalid DSImage.");if(!e&&!r)return j._onLog&&j._onLog("Get invalid frame."),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0));(async()=>{let o=[];if(e){o=await this._decode_DCEFrame(e,{bScanner:!0,bCopyData:!1});let h=null;if(o&&o.length){const{sx:g,sy:p,width:v,height:S,_sWidth:w,_sHeight:x}=e;h=o.map(E=>({resultState:E.resultState,localizationResult:JSON.parse(JSON.stringify(E.localizationResult))})),j.recalculateResultLocation(h,g,p,w,x,v,S)}this._resultHighlightingDuration==0?this._drawResults(null):this._drawResults(h,o),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._resultHighlightingDuration>0&&(this._clearResultsCanvasTimeoutId=setTimeout(()=>{this.bDestroyed||this._drawResults(null)},this._resultHighlightingDuration))}else r&&(o=await this._decode_DSImage(r,{bScanner:!0,bCopyData:!1}));return o})().then(o=>{if(j._onLog&&j._onLog(o),this.dce&&this.captureAndDecodeInParallel){let h=this.array_decodeFrameTimeCost,g=this.array_getFrameTimeCost;const p=()=>{let v=0;if(g&&g.length){let S=Math.min(...h),w=Math.max(...g);S&&w&&(v=S-w)}else v=0;return v>0?v:0};(()=>{for(;h.length>=5;)h.shift();h.push(this._lastInnerDecodeDuration)})(),this._intervalGetVideoFrame=p()+this.intervalTime}if((this.dce&&this.dce.isOpen()||this._imgSource)&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&o.length){let h=!1;this.bPlaySoundOnSuccessfulRead===!0||this.bPlaySoundOnSuccessfulRead==="frame"?h=o.some(g=>g.resultState>=0):this.bPlaySoundOnSuccessfulRead==="unique"&&(h=o.some(g=>g.resultState==0)),h&&this.beepSound&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&o.length){let h=!1;if(this.bVibrateOnSuccessfulRead===!0||this.bVibrateOnSuccessfulRead==="frame"?h=o.some(g=>g.resultState>=0):this.bVibrateOnSuccessfulRead==="unique"&&(h=o.some(g=>g.resultState==0)),h)try{navigator.vibrate(this.vibrateDuration)}catch(g){console.warn("Vibration not allowed. User interaction required: "+(g.message||g))}}if(this.onImageRead){o=o.filter(g=>g.resultState>=0);const h=this._cloneDecodeResults(o);this.onImageRead(h)}if(this.onUniqueRead){o=o.filter(g=>g.resultState==0);const h=this._cloneDecodeResults(o);for(let g of h)this.onUniqueRead(g.barcodeText,g)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this.intervalTime):this._loopReadVideo()}).catch(o=>{this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),j._onLog&&j._onLog(o.message||o),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},Math.max(this.intervalTime,1e3)),o.message=="platform error"||console.warn(o.message)})}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){if(j._onLog&&j._onLog("Get frame in parallel."),this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",this._intervalGetVideoFrame),!this.dce.numberOfFramesInBuffer)return this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",0),null;e=this.dce.getFrameFromBuffer(),(o=>{if(!o)return;let h=o.timeSpent,g=this.array_getFrameTimeCost;for(;g.length>=5;)g.shift();g.push(h)})(e)}else j._onLog&&j._onLog("Get frame in serial."),this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),e=this.dce.getFrame();return e}_drawResults(e,r){if(!this.dce||this.dce.disposed||this._bPauseScan||!this._drawingItemNamespace||!this._drawingItemNamespace.DT_Polygon)return;if(!this._dbrDrawingLayer){if(!this.dce.isOpen()||!(this.dce.singleFrameMode||this.dce.video&&this.dce._videoTrack))return;this._dbrDrawingLayer=this.dce.getDrawingLayer(3)}const o=this._dbrDrawingLayer;e||(e=[]);let h=this._arrPolygons;for(let g=0;g<e.length;g++){let p,v=e[g].localizationResult;h[g]?(p=h[g],o.hasDrawingItem(p)||o.addDrawingItem(p),p.set("vertices",[{x:v.x1,y:v.y1},{x:v.x2,y:v.y2},{x:v.x3,y:v.y3},{x:v.x4,y:v.y4}]),(p.set||p.setAttribute).call(p,"vertices",[{x:v.x1,y:v.y1},{x:v.x2,y:v.y2},{x:v.x3,y:v.y3},{x:v.x4,y:v.y4}])):(p=new this._drawingItemNamespace.DT_Polygon([{x:v.x1,y:v.y1},{x:v.x2,y:v.y2},{x:v.x3,y:v.y3},{x:v.x4,y:v.y4}]),o.addDrawingItem(p),h[g]=p),e[g].resultState===-1?(p.styleId=this._styleIdBeforeVerification,p._mapStyle.set("default",this.dce.getDrawingStyle(this._styleIdBeforeVerification)),p._mapStyle.set("selected",this.dce.getDrawingStyle(this._styleIdBeforeVerification))):(p.styleId=null,p._mapStyle.set("default",this.dce.getDrawingStyle(3)),p._mapStyle.set("selected",this.dce.getDrawingStyle(7))),r&&r[g]?p.addNote({name:"Barcode_Result",content:r[g]},!0):p.addNote({name:"Barcode_Result",content:e[g]},!0)}for(let g=e.length;g<h.length;g++)h[g].deleteNote("Barcode_Result"),o.removeDrawingItem(h[g]);o.renderAll()}async startScanning(e){if(!this.dce&&!this._imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");if(this._promiseStartScan&&this._promiseStartScan.isPending)return this._promiseStartScan;this._promiseStartScan=new Zs;let r=null;if(this.dce){if(this.dce.isOpen())if(e&&this.dce.appendAndShowUI(),this.dce.playCallbackInfo)r=JSON.parse(JSON.stringify(this.dce.playCallbackInfo));else{const o=this.dce.getSelectedCamera();r={width:this.dce.video.videoWidth,height:this.dce.video.videoHeight,deviceId:o&&o.deviceId}}else if(r=await this.dce.open(e),!this._promiseStartScan)return null;this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"close"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}return this._bPauseScan=!1,this.dce&&this.dce.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},0)),this._promiseStartScan.resolve(r),r}stopScanning(e){this.dce&&(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"close",[e]))),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._promiseStartScan=null}pauseScanning(e){if(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce){if(this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"stopFetchingLoop"))}}resumeScanning(){if(this._bPauseScan=!1,this.dce){if(this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.startFetchingLoop(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}}destroyContext(){if(j._onLog&&j._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0,(this.dce||this._promiseStartScan)&&this.stopScanning(),this.setImageSource(null);let e=j._nextTaskID++;j._taskCallbackMap.set(e,r=>{if(!r.success){let o=new Error(r.message);throw o.stack=r.stack+`
`+o.stack,o}}),j._dbrWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}j._jsVersion="9.6.32",j._jsEditVersion="20231027",j._version=`loading...(JS ${j._jsVersion}.${j._jsEditVersion})`,j._license=Bl,j._sessionPassword=Nl,j.browserInfo=ke,j._workerName=`dbr-${j._jsVersion}.browser.worker.js`,j._engineResourcePath=kl,j._licenseServer=[],j._deviceFriendlyName="",j._isShowRelDecodeTimeInResults=!1,j._bWasmDebug=!1,j._bNeverShowDialog=!1,j.__bUseFullFeature=!0,j._nextTaskID=0,j._taskCallbackMap=new Map,j._pLoad=new Zs,j._lastErrorCode=0,j._lastErrorString="",j._setWarnnedEx=new Set,j._defaultUIElementURL="@engineResourcePath/dbr.ui.html";var jl={653:(t,e,r)=>{var o,h,g,p,v,S,w,x,E,A,W,Y,z,q,te,J,Z,ee,he,fe,_e,y=y||{version:"5.2.1"};if(e.fabric=y,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?y.document=document:y.document=document.implementation.createHTMLDocument(""),y.window=window;else{var ge=new(r(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;y.document=ge.document,y.jsdomImplForWrapper=r(898).implForWrapper,y.nodeCanvas=r(245).Canvas,y.window=ge,DOMParser=y.window.DOMParser}function pe(l,s){var a=l.canvas,u=s.targetCanvas,i=u.getContext("2d");i.translate(0,u.height),i.scale(1,-1);var n=a.height-u.height;i.drawImage(a,0,n,u.width,u.height,0,0,u.width,u.height)}function Te(l,s){var a=s.targetCanvas.getContext("2d"),u=s.destinationWidth,i=s.destinationHeight,n=u*i*4,c=new Uint8Array(this.imageBuffer,0,n),_=new Uint8ClampedArray(this.imageBuffer,0,n);l.readPixels(0,0,u,i,l.RGBA,l.UNSIGNED_BYTE,c);var d=new ImageData(_,u,i);a.putImageData(d,0,0)}y.isTouchSupported="ontouchstart"in y.window||"ontouchstart"in y.document||y.window&&y.window.navigator&&y.window.navigator.maxTouchPoints>0,y.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",y.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],y.DPI=96,y.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",y.commaWsp="(?:\\s+,?\\s*|,\\s*)",y.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,y.reNonWord=/[ \n\.,;!\?\-]/,y.fontPaths={},y.iMatrix=[1,0,0,1,0,0],y.svgNS="http://www.w3.org/2000/svg",y.perfLimitSizeTotal=2097152,y.maxCacheSideLimit=4096,y.minCacheSideLimit=256,y.charWidthsCache={},y.textureSize=2048,y.disableStyleCopyPaste=!1,y.enableGLFiltering=!0,y.devicePixelRatio=y.window.devicePixelRatio||y.window.webkitDevicePixelRatio||y.window.mozDevicePixelRatio||1,y.browserShadowBlurConstant=1,y.arcToSegmentsCache={},y.boundsOfCurveCache={},y.cachesBoundsOfCurve=!0,y.forceGLPutImageData=!1,y.initFilterBackend=function(){return y.enableGLFiltering&&y.isWebglSupported&&y.isWebglSupported(y.textureSize)?(console.log("max texture size: "+y.maxTextureSize),new y.WebglFilterBackend({tileSize:y.textureSize})):y.Canvas2dFilterBackend?new y.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=y),function(){function l(a,u){if(this.__eventListeners[a]){var i=this.__eventListeners[a];u?i[i.indexOf(u)]=!1:y.util.array.fill(i,!1)}}function s(a,u){var i=(function(){u.apply(this,arguments),this.off(a,i)}).bind(this);this.on(a,i)}y.Observable={fire:function(a,u){if(!this.__eventListeners)return this;var i=this.__eventListeners[a];if(!i)return this;for(var n=0,c=i.length;n<c;n++)i[n]&&i[n].call(this,u||{});return this.__eventListeners[a]=i.filter(function(_){return _!==!1}),this},on:function(a,u){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in a)this.on(i,a[i]);else this.__eventListeners[a]||(this.__eventListeners[a]=[]),this.__eventListeners[a].push(u);return this},once:function(a,u){if(arguments.length===1)for(var i in a)s.call(this,i,a[i]);else s.call(this,a,u);return this},off:function(a,u){if(!this.__eventListeners)return this;if(arguments.length===0)for(a in this.__eventListeners)l.call(this,a);else if(arguments.length===1&&typeof arguments[0]=="object")for(var i in a)l.call(this,i,a[i]);else l.call(this,a,u);return this}}}(),y.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var l=0,s=arguments.length;l<s;l++)this._onObjectAdded(arguments[l]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(l,s,a){var u=this._objects;return a?u[s]=l:u.splice(s,0,l),this._onObjectAdded&&this._onObjectAdded(l),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var l,s=this._objects,a=!1,u=0,i=arguments.length;u<i;u++)(l=s.indexOf(arguments[u]))!==-1&&(a=!0,s.splice(l,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[u]));return this.renderOnAddRemove&&a&&this.requestRenderAll(),this},forEachObject:function(l,s){for(var a=this.getObjects(),u=0,i=a.length;u<i;u++)l.call(s,a[u],u,a);return this},getObjects:function(l){return l===void 0?this._objects.concat():this._objects.filter(function(s){return s.type===l})},item:function(l){return this._objects[l]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(l,s){return this._objects.indexOf(l)>-1||!!s&&this._objects.some(function(a){return typeof a.contains=="function"&&a.contains(l,!0)})},complexity:function(){return this._objects.reduce(function(l,s){return l+(s.complexity?s.complexity():0)},0)}},y.CommonMethods={_setOptions:function(l){for(var s in l)this.set(s,l[s])},_initGradient:function(l,s){!l||!l.colorStops||l instanceof y.Gradient||this.set(s,new y.Gradient(l))},_initPattern:function(l,s,a){!l||!l.source||l instanceof y.Pattern?a&&a():this.set(s,new y.Pattern(l,a))},_setObject:function(l){for(var s in l)this._set(s,l[s])},set:function(l,s){return typeof l=="object"?this._setObject(l):this._set(l,s),this},_set:function(l,s){this[l]=s},toggle:function(l){var s=this.get(l);return typeof s=="boolean"&&this.set(l,!s),this},get:function(l){return this[l]}},o=e,h=Math.sqrt,g=Math.atan2,p=Math.pow,v=Math.PI/180,S=Math.PI/2,y.util={cos:function(l){if(l===0)return 1;switch(l<0&&(l=-l),l/S){case 1:case 3:return 0;case 2:return-1}return Math.cos(l)},sin:function(l){if(l===0)return 0;var s=1;switch(l<0&&(s=-1),l/S){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(l)},removeFromArray:function(l,s){var a=l.indexOf(s);return a!==-1&&l.splice(a,1),l},getRandomInt:function(l,s){return Math.floor(Math.random()*(s-l+1))+l},degreesToRadians:function(l){return l*v},radiansToDegrees:function(l){return l/v},rotatePoint:function(l,s,a){var u=new y.Point(l.x-s.x,l.y-s.y),i=y.util.rotateVector(u,a);return new y.Point(i.x,i.y).addEquals(s)},rotateVector:function(l,s){var a=y.util.sin(s),u=y.util.cos(s);return{x:l.x*u-l.y*a,y:l.x*a+l.y*u}},createVector:function(l,s){return new y.Point(s.x-l.x,s.y-l.y)},calcAngleBetweenVectors:function(l,s){return Math.acos((l.x*s.x+l.y*s.y)/(Math.hypot(l.x,l.y)*Math.hypot(s.x,s.y)))},getHatVector:function(l){return new y.Point(l.x,l.y).multiply(1/Math.hypot(l.x,l.y))},getBisector:function(l,s,a){var u=y.util.createVector(l,s),i=y.util.createVector(l,a),n=y.util.calcAngleBetweenVectors(u,i),c=n*(y.util.calcAngleBetweenVectors(y.util.rotateVector(u,n),i)===0?1:-1)/2;return{vector:y.util.getHatVector(y.util.rotateVector(u,c)),angle:n}},projectStrokeOnPoints:function(l,s,a){var u=[],i=s.strokeWidth/2,n=s.strokeUniform?new y.Point(1/s.scaleX,1/s.scaleY):new y.Point(1,1),c=function(_){var d=i/Math.hypot(_.x,_.y);return new y.Point(_.x*d*n.x,_.y*d*n.y)};return l.length<=1||l.forEach(function(_,d){var f,m,b=new y.Point(_.x,_.y);d===0?(m=l[d+1],f=a?c(y.util.createVector(m,b)).addEquals(b):l[l.length-1]):d===l.length-1?(f=l[d-1],m=a?c(y.util.createVector(f,b)).addEquals(b):l[0]):(f=l[d-1],m=l[d+1]);var C,I,T=y.util.getBisector(b,f,m),R=T.vector,B=T.angle;if(s.strokeLineJoin==="miter"&&(C=-i/Math.sin(B/2),I=new y.Point(R.x*C*n.x,R.y*C*n.y),Math.hypot(I.x,I.y)/i<=s.strokeMiterLimit))return u.push(b.add(I)),void u.push(b.subtract(I));C=-i*Math.SQRT2,I=new y.Point(R.x*C*n.x,R.y*C*n.y),u.push(b.add(I)),u.push(b.subtract(I))}),u},transformPoint:function(l,s,a){return a?new y.Point(s[0]*l.x+s[2]*l.y,s[1]*l.x+s[3]*l.y):new y.Point(s[0]*l.x+s[2]*l.y+s[4],s[1]*l.x+s[3]*l.y+s[5])},makeBoundingBoxFromPoints:function(l,s){if(s)for(var a=0;a<l.length;a++)l[a]=y.util.transformPoint(l[a],s);var u=[l[0].x,l[1].x,l[2].x,l[3].x],i=y.util.array.min(u),n=y.util.array.max(u)-i,c=[l[0].y,l[1].y,l[2].y,l[3].y],_=y.util.array.min(c);return{left:i,top:_,width:n,height:y.util.array.max(c)-_}},invertTransform:function(l){var s=1/(l[0]*l[3]-l[1]*l[2]),a=[s*l[3],-s*l[1],-s*l[2],s*l[0]],u=y.util.transformPoint({x:l[4],y:l[5]},a,!0);return a[4]=-u.x,a[5]=-u.y,a},toFixed:function(l,s){return parseFloat(Number(l).toFixed(s))},parseUnit:function(l,s){var a=/\D{0,2}$/.exec(l),u=parseFloat(l);switch(s||(s=y.Text.DEFAULT_SVG_FONT_SIZE),a[0]){case"mm":return u*y.DPI/25.4;case"cm":return u*y.DPI/2.54;case"in":return u*y.DPI;case"pt":return u*y.DPI/72;case"pc":return u*y.DPI/72*12;case"em":return u*s;default:return u}},falseFunction:function(){return!1},getKlass:function(l,s){return l=y.util.string.camelize(l.charAt(0).toUpperCase()+l.slice(1)),y.util.resolveNamespace(s)[l]},getSvgAttributes:function(l){var s=["instantiated_by_use","style","id","class"];switch(l){case"linearGradient":s=s.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":s=s.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":s=s.concat(["offset","stop-color","stop-opacity"])}return s},resolveNamespace:function(l){if(!l)return y;var s,a=l.split("."),u=a.length,i=o||y.window;for(s=0;s<u;++s)i=i[a[s]];return i},loadImage:function(l,s,a,u){if(l){var i=y.util.createImage(),n=function(){s&&s.call(a,i,!1),i=i.onload=i.onerror=null};i.onload=n,i.onerror=function(){y.log("Error loading "+i.src),s&&s.call(a,null,!0),i=i.onload=i.onerror=null},l.indexOf("data")!==0&&u!=null&&(i.crossOrigin=u),l.substring(0,14)==="data:image/svg"&&(i.onload=null,y.util.loadImageInDom(i,n)),i.src=l}else s&&s.call(a,l)},loadImageInDom:function(l,s){var a=y.document.createElement("div");a.style.width=a.style.height="1px",a.style.left=a.style.top="-100%",a.style.position="absolute",a.appendChild(l),y.document.querySelector("body").appendChild(a),l.onload=function(){s(),a.parentNode.removeChild(a),a=null}},enlivenObjects:function(l,s,a,u){var i=[],n=0,c=(l=l||[]).length;function _(){++n===c&&s&&s(i.filter(function(d){return d}))}c?l.forEach(function(d,f){d&&d.type?y.util.getKlass(d.type,a).fromObject(d,function(m,b){b||(i[f]=m),u&&u(d,m,b),_()}):_()}):s&&s(i)},enlivenObjectEnlivables:function(l,s,a){var u=y.Object.ENLIVEN_PROPS.filter(function(i){return!!l[i]});y.util.enlivenObjects(u.map(function(i){return l[i]}),function(i){var n={};u.forEach(function(c,_){n[c]=i[_],s&&(s[c]=i[_])}),a&&a(n)})},enlivenPatterns:function(l,s){function a(){++i===n&&s&&s(u)}var u=[],i=0,n=(l=l||[]).length;n?l.forEach(function(c,_){c&&c.source?new y.Pattern(c,function(d){u[_]=d,a()}):(u[_]=c,a())}):s&&s(u)},groupSVGElements:function(l,s,a){var u;return l&&l.length===1?l[0]:(s&&(s.width&&s.height?s.centerPoint={x:s.width/2,y:s.height/2}:(delete s.width,delete s.height)),u=new y.Group(l,s),a!==void 0&&(u.sourcePath=a),u)},populateWithProperties:function(l,s,a){if(a&&Array.isArray(a))for(var u=0,i=a.length;u<i;u++)a[u]in l&&(s[a[u]]=l[a[u]])},createCanvasElement:function(){return y.document.createElement("canvas")},copyCanvasElement:function(l){var s=y.util.createCanvasElement();return s.width=l.width,s.height=l.height,s.getContext("2d").drawImage(l,0,0),s},toDataURL:function(l,s,a){return l.toDataURL("image/"+s,a)},createImage:function(){return y.document.createElement("img")},multiplyTransformMatrices:function(l,s,a){return[l[0]*s[0]+l[2]*s[1],l[1]*s[0]+l[3]*s[1],l[0]*s[2]+l[2]*s[3],l[1]*s[2]+l[3]*s[3],a?0:l[0]*s[4]+l[2]*s[5]+l[4],a?0:l[1]*s[4]+l[3]*s[5]+l[5]]},qrDecompose:function(l){var s=g(l[1],l[0]),a=p(l[0],2)+p(l[1],2),u=h(a),i=(l[0]*l[3]-l[2]*l[1])/u,n=g(l[0]*l[2]+l[1]*l[3],a);return{angle:s/v,scaleX:u,scaleY:i,skewX:n/v,skewY:0,translateX:l[4],translateY:l[5]}},calcRotateMatrix:function(l){if(!l.angle)return y.iMatrix.concat();var s=y.util.degreesToRadians(l.angle),a=y.util.cos(s),u=y.util.sin(s);return[a,u,-u,a,0,0]},calcDimensionsMatrix:function(l){var s=l.scaleX===void 0?1:l.scaleX,a=l.scaleY===void 0?1:l.scaleY,u=[l.flipX?-s:s,0,0,l.flipY?-a:a,0,0],i=y.util.multiplyTransformMatrices,n=y.util.degreesToRadians;return l.skewX&&(u=i(u,[1,0,Math.tan(n(l.skewX)),1],!0)),l.skewY&&(u=i(u,[1,Math.tan(n(l.skewY)),0,1],!0)),u},composeMatrix:function(l){var s=[1,0,0,1,l.translateX||0,l.translateY||0],a=y.util.multiplyTransformMatrices;return l.angle&&(s=a(s,y.util.calcRotateMatrix(l))),(l.scaleX!==1||l.scaleY!==1||l.skewX||l.skewY||l.flipX||l.flipY)&&(s=a(s,y.util.calcDimensionsMatrix(l))),s},resetObjectTransform:function(l){l.scaleX=1,l.scaleY=1,l.skewX=0,l.skewY=0,l.flipX=!1,l.flipY=!1,l.rotate(0)},saveObjectTransform:function(l){return{scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,angle:l.angle,left:l.left,flipX:l.flipX,flipY:l.flipY,top:l.top}},isTransparent:function(l,s,a,u){u>0&&(s>u?s-=u:s=0,a>u?a-=u:a=0);var i,n=!0,c=l.getImageData(s,a,2*u||1,2*u||1),_=c.data.length;for(i=3;i<_&&(n=c.data[i]<=0)!=0;i+=4);return c=null,n},parsePreserveAspectRatioAttribute:function(l){var s,a="meet",u=l.split(" ");return u&&u.length&&((a=u.pop())!=="meet"&&a!=="slice"?(s=a,a="meet"):u.length&&(s=u.pop())),{meetOrSlice:a,alignX:s!=="none"?s.slice(1,4):"none",alignY:s!=="none"?s.slice(5,8):"none"}},clearFabricFontCache:function(l){(l=(l||"").toLowerCase())?y.charWidthsCache[l]&&delete y.charWidthsCache[l]:y.charWidthsCache={}},limitDimsByArea:function(l,s){var a=Math.sqrt(s*l),u=Math.floor(s/a);return{x:Math.floor(a),y:u}},capValue:function(l,s,a){return Math.max(l,Math.min(s,a))},findScaleToFit:function(l,s){return Math.min(s.width/l.width,s.height/l.height)},findScaleToCover:function(l,s){return Math.max(s.width/l.width,s.height/l.height)},matrixToSVG:function(l){return"matrix("+l.map(function(s){return y.util.toFixed(s,y.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(l,s){var a=y.util.invertTransform(s),u=y.util.multiplyTransformMatrices(a,l.calcOwnMatrix());y.util.applyTransformToObject(l,u)},addTransformToObject:function(l,s){y.util.applyTransformToObject(l,y.util.multiplyTransformMatrices(s,l.calcOwnMatrix()))},applyTransformToObject:function(l,s){var a=y.util.qrDecompose(s),u=new y.Point(a.translateX,a.translateY);l.flipX=!1,l.flipY=!1,l.set("scaleX",a.scaleX),l.set("scaleY",a.scaleY),l.skewX=a.skewX,l.skewY=a.skewY,l.angle=a.angle,l.setPositionByOrigin(u,"center","center")},sizeAfterTransform:function(l,s,a){var u=l/2,i=s/2,n=[{x:-u,y:-i},{x:u,y:-i},{x:-u,y:i},{x:u,y:i}],c=y.util.calcDimensionsMatrix(a),_=y.util.makeBoundingBoxFromPoints(n,c);return{x:_.width,y:_.height}},mergeClipPaths:function(l,s){var a=l,u=s;a.inverted&&!u.inverted&&(a=s,u=l),y.util.applyTransformToObject(u,y.util.multiplyTransformMatrices(y.util.invertTransform(a.calcTransformMatrix()),u.calcTransformMatrix()));var i=a.inverted&&u.inverted;return i&&(a.inverted=u.inverted=!1),new y.Group([a],{clipPath:u,inverted:i})}},function(){var l=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},a={m:"l",M:"L"};function u(I,T,R,B,U,X,Q,O,M,D,L){var k=y.util.cos(I),V=y.util.sin(I),G=y.util.cos(T),P=y.util.sin(T),F=R*U*G-B*X*P+Q,N=B*U*G+R*X*P+O;return["C",D+M*(-R*U*V-B*X*k),L+M*(-B*U*V+R*X*k),F+M*(R*U*P+B*X*G),N+M*(B*U*P-R*X*G),F,N]}function i(I,T,R,B){var U=Math.atan2(T,I),X=Math.atan2(B,R);return X>=U?X-U:2*Math.PI-(U-X)}function n(I,T,R){for(var B=R[1],U=R[2],X=R[3],Q=R[4],O=R[5],M=function(k,V,G,P,F,N,K){var H=Math.PI,$=K*H/180,ie=y.util.sin($),re=y.util.cos($),ne=0,oe=0,ae=-re*k*.5-ie*V*.5,ce=-re*V*.5+ie*k*.5,de=(G=Math.abs(G))*G,ue=(P=Math.abs(P))*P,me=ce*ce,we=ae*ae,Ie=de*ue-de*me-ue*we,De=0;if(Ie<0){var nt=Math.sqrt(1-Ie/(de*ue));G*=nt,P*=nt}else De=(F===N?-1:1)*Math.sqrt(Ie/(de*me+ue*we));var Oe=De*G*ce/P,ze=-De*P*ae/G,Yt=re*Oe-ie*ze+.5*k,Rt=ie*Oe+re*ze+.5*V,vt=i(1,0,(ae-Oe)/G,(ce-ze)/P),Dt=i((ae-Oe)/G,(ce-ze)/P,(-ae-Oe)/G,(-ce-ze)/P);N===0&&Dt>0?Dt-=2*H:N===1&&Dt<0&&(Dt+=2*H);for(var Kr=Math.ceil(Math.abs(Dt/H*2)),hi=[],Xt=Dt/Kr,to=8/3*Math.sin(Xt/4)*Math.sin(Xt/4)/Math.sin(Xt/2),Zi=vt+Xt,zt=0;zt<Kr;zt++)hi[zt]=u(vt,Zi,re,ie,G,P,Yt,Rt,to,ne,oe),ne=hi[zt][5],oe=hi[zt][6],vt=Zi,Zi+=Xt;return hi}(R[6]-I,R[7]-T,B,U,Q,O,X),D=0,L=M.length;D<L;D++)M[D][1]+=I,M[D][2]+=T,M[D][3]+=I,M[D][4]+=T,M[D][5]+=I,M[D][6]+=T;return M}function c(I,T,R,B){return Math.sqrt((R-I)*(R-I)+(B-T)*(B-T))}function _(I,T,R,B,U,X,Q,O){return function(M){var D,L=(D=M)*D*D,k=function(P){return 3*P*P*(1-P)}(M),V=function(P){return 3*P*(1-P)*(1-P)}(M),G=function(P){return(1-P)*(1-P)*(1-P)}(M);return{x:Q*L+U*k+R*V+I*G,y:O*L+X*k+B*V+T*G}}}function d(I,T,R,B,U,X,Q,O){return function(M){var D=1-M,L=3*D*D*(R-I)+6*D*M*(U-R)+3*M*M*(Q-U),k=3*D*D*(B-T)+6*D*M*(X-B)+3*M*M*(O-X);return Math.atan2(k,L)}}function f(I,T,R,B,U,X){return function(Q){var O,M=(O=Q)*O,D=function(k){return 2*k*(1-k)}(Q),L=function(k){return(1-k)*(1-k)}(Q);return{x:U*M+R*D+I*L,y:X*M+B*D+T*L}}}function m(I,T,R,B,U,X){return function(Q){var O=1-Q,M=2*O*(R-I)+2*Q*(U-R),D=2*O*(B-T)+2*Q*(X-B);return Math.atan2(D,M)}}function b(I,T,R){var B,U,X={x:T,y:R},Q=0;for(U=1;U<=100;U+=1)B=I(U/100),Q+=c(X.x,X.y,B.x,B.y),X=B;return Q}function C(I){for(var T,R,B,U,X=0,Q=I.length,O=0,M=0,D=0,L=0,k=[],V=0;V<Q;V++){switch(B={x:O,y:M,command:(T=I[V])[0]},T[0]){case"M":B.length=0,D=O=T[1],L=M=T[2];break;case"L":B.length=c(O,M,T[1],T[2]),O=T[1],M=T[2];break;case"C":R=_(O,M,T[1],T[2],T[3],T[4],T[5],T[6]),U=d(O,M,T[1],T[2],T[3],T[4],T[5],T[6]),B.iterator=R,B.angleFinder=U,B.length=b(R,O,M),O=T[5],M=T[6];break;case"Q":R=f(O,M,T[1],T[2],T[3],T[4]),U=m(O,M,T[1],T[2],T[3],T[4]),B.iterator=R,B.angleFinder=U,B.length=b(R,O,M),O=T[3],M=T[4];break;case"Z":case"z":B.destX=D,B.destY=L,B.length=c(O,M,D,L),O=D,M=L}X+=B.length,k.push(B)}return k.push({length:X,x:O,y:M}),k}y.util.joinPath=function(I){return I.map(function(T){return T.join(" ")}).join(" ")},y.util.parsePath=function(I){var T,R,B,U,X,Q=[],O=[],M=y.rePathCommand,D="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",L="("+D+")"+y.commaWsp,k="([01])"+y.commaWsp+"?",V=new RegExp(L+"?"+L+"?"+L+k+k+L+"?("+D+")","g");if(!I||!I.match)return Q;for(var G,P=0,F=(X=I.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;P<F;P++){U=(T=X[P]).slice(1).trim(),O.length=0;var N=T.charAt(0);if(G=[N],N.toLowerCase()==="a")for(var K;K=V.exec(U);)for(var H=1;H<K.length;H++)O.push(K[H]);else for(;B=M.exec(U);)O.push(B[0]);H=0;for(var $=O.length;H<$;H++)R=parseFloat(O[H]),isNaN(R)||G.push(R);var ie=s[N.toLowerCase()],re=a[N]||N;if(G.length-1>ie)for(var ne=1,oe=G.length;ne<oe;ne+=ie)Q.push([N].concat(G.slice(ne,ne+ie))),N=re;else Q.push(G)}return Q},y.util.makePathSimpler=function(I){var T,R,B,U,X,Q,O=0,M=0,D=I.length,L=0,k=0,V=[];for(R=0;R<D;++R){switch(B=!1,(T=I[R].slice(0))[0]){case"l":T[0]="L",T[1]+=O,T[2]+=M;case"L":O=T[1],M=T[2];break;case"h":T[1]+=O;case"H":T[0]="L",T[2]=M,O=T[1];break;case"v":T[1]+=M;case"V":T[0]="L",M=T[1],T[1]=O,T[2]=M;break;case"m":T[0]="M",T[1]+=O,T[2]+=M;case"M":O=T[1],M=T[2],L=T[1],k=T[2];break;case"c":T[0]="C",T[1]+=O,T[2]+=M,T[3]+=O,T[4]+=M,T[5]+=O,T[6]+=M;case"C":X=T[3],Q=T[4],O=T[5],M=T[6];break;case"s":T[0]="S",T[1]+=O,T[2]+=M,T[3]+=O,T[4]+=M;case"S":U==="C"?(X=2*O-X,Q=2*M-Q):(X=O,Q=M),O=T[3],M=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=X,T[2]=Q,X=T[3],Q=T[4];break;case"q":T[0]="Q",T[1]+=O,T[2]+=M,T[3]+=O,T[4]+=M;case"Q":X=T[1],Q=T[2],O=T[3],M=T[4];break;case"t":T[0]="T",T[1]+=O,T[2]+=M;case"T":U==="Q"?(X=2*O-X,Q=2*M-Q):(X=O,Q=M),T[0]="Q",O=T[1],M=T[2],T[1]=X,T[2]=Q,T[3]=O,T[4]=M;break;case"a":T[0]="A",T[6]+=O,T[7]+=M;case"A":B=!0,V=V.concat(n(O,M,T)),O=T[6],M=T[7];break;case"z":case"Z":O=L,M=k}B||V.push(T),U=T[0]}return V},y.util.getSmoothPathFromPoints=function(I,T){var R,B=[],U=new y.Point(I[0].x,I[0].y),X=new y.Point(I[1].x,I[1].y),Q=I.length,O=1,M=0,D=Q>2;for(T=T||0,D&&(O=I[2].x<X.x?-1:I[2].x===X.x?0:1,M=I[2].y<X.y?-1:I[2].y===X.y?0:1),B.push(["M",U.x-O*T,U.y-M*T]),R=1;R<Q;R++){if(!U.eq(X)){var L=U.midPointFrom(X);B.push(["Q",U.x,U.y,L.x,L.y])}U=I[R],R+1<I.length&&(X=I[R+1])}return D&&(O=U.x>I[R-2].x?1:U.x===I[R-2].x?0:-1,M=U.y>I[R-2].y?1:U.y===I[R-2].y?0:-1),B.push(["L",U.x+O*T,U.y+M*T]),B},y.util.getPathSegmentsInfo=C,y.util.getBoundsOfCurve=function(I,T,R,B,U,X,Q,O){var M;if(y.cachesBoundsOfCurve&&(M=l.call(arguments),y.boundsOfCurveCache[M]))return y.boundsOfCurveCache[M];var D,L,k,V,G,P,F,N,K=Math.sqrt,H=Math.min,$=Math.max,ie=Math.abs,re=[],ne=[[],[]];L=6*I-12*R+6*U,D=-3*I+9*R-9*U+3*Q,k=3*R-3*I;for(var oe=0;oe<2;++oe)if(oe>0&&(L=6*T-12*B+6*X,D=-3*T+9*B-9*X+3*O,k=3*B-3*T),ie(D)<1e-12){if(ie(L)<1e-12)continue;0<(V=-k/L)&&V<1&&re.push(V)}else(F=L*L-4*k*D)<0||(0<(G=(-L+(N=K(F)))/(2*D))&&G<1&&re.push(G),0<(P=(-L-N)/(2*D))&&P<1&&re.push(P));for(var ae,ce,de,ue=re.length,me=ue;ue--;)ae=(de=1-(V=re[ue]))*de*de*I+3*de*de*V*R+3*de*V*V*U+V*V*V*Q,ne[0][ue]=ae,ce=de*de*de*T+3*de*de*V*B+3*de*V*V*X+V*V*V*O,ne[1][ue]=ce;ne[0][me]=I,ne[1][me]=T,ne[0][me+1]=Q,ne[1][me+1]=O;var we=[{x:H.apply(null,ne[0]),y:H.apply(null,ne[1])},{x:$.apply(null,ne[0]),y:$.apply(null,ne[1])}];return y.cachesBoundsOfCurve&&(y.boundsOfCurveCache[M]=we),we},y.util.getPointOnPath=function(I,T,R){R||(R=C(I));for(var B=0;T-R[B].length>0&&B<R.length-2;)T-=R[B].length,B++;var U,X=R[B],Q=T/X.length,O=X.command,M=I[B];switch(O){case"M":return{x:X.x,y:X.y,angle:0};case"Z":case"z":return(U=new y.Point(X.x,X.y).lerp(new y.Point(X.destX,X.destY),Q)).angle=Math.atan2(X.destY-X.y,X.destX-X.x),U;case"L":return(U=new y.Point(X.x,X.y).lerp(new y.Point(M[1],M[2]),Q)).angle=Math.atan2(M[2]-X.y,M[1]-X.x),U;case"C":case"Q":return function(D,L){for(var k,V,G,P=0,F=0,N=D.iterator,K={x:D.x,y:D.y},H=.01,$=D.angleFinder;F<L&&H>1e-4;)k=N(P),G=P,(V=c(K.x,K.y,k.x,k.y))+F>L?(P-=H,H/=2):(K=k,P+=H,F+=V);return k.angle=$(G),k}(X,T)}},y.util.transformPath=function(I,T,R){return R&&(T=y.util.multiplyTransformMatrices(T,[1,0,0,1,-R.x,-R.y])),I.map(function(B){for(var U=B.slice(0),X={},Q=1;Q<B.length-1;Q+=2)X.x=B[Q],X.y=B[Q+1],X=y.util.transformPoint(X,T),U[Q]=X.x,U[Q+1]=X.y;return U})}}(),function(){var l=Array.prototype.slice;function s(a,u,i){if(a&&a.length!==0){var n=a.length-1,c=u?a[n][u]:a[n];if(u)for(;n--;)i(a[n][u],c)&&(c=a[n][u]);else for(;n--;)i(a[n],c)&&(c=a[n]);return c}}y.util.array={fill:function(a,u){for(var i=a.length;i--;)a[i]=u;return a},invoke:function(a,u){for(var i=l.call(arguments,2),n=[],c=0,_=a.length;c<_;c++)n[c]=i.length?a[c][u].apply(a[c],i):a[c][u].call(a[c]);return n},min:function(a,u){return s(a,u,function(i,n){return i<n})},max:function(a,u){return s(a,u,function(i,n){return i>=n})}}}(),function(){function l(s,a,u){if(u)if(!y.isLikelyNode&&a instanceof Element)s=a;else if(a instanceof Array){s=[];for(var i=0,n=a.length;i<n;i++)s[i]=l({},a[i],u)}else if(a&&typeof a=="object")for(var c in a)c==="canvas"||c==="group"?s[c]=null:a.hasOwnProperty(c)&&(s[c]=l({},a[c],u));else s=a;else for(var c in a)s[c]=a[c];return s}y.util.object={extend:l,clone:function(s,a){return l({},s,a)}},y.util.object.extend(y.util,y.Observable)}(),function(){function l(s,a){var u=s.charCodeAt(a);if(isNaN(u))return"";if(u<55296||u>57343)return s.charAt(a);if(55296<=u&&u<=56319){if(s.length<=a+1)throw"High surrogate without following low surrogate";var i=s.charCodeAt(a+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return s.charAt(a)+s.charAt(a+1)}if(a===0)throw"Low surrogate without preceding high surrogate";var n=s.charCodeAt(a-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1}y.util.string={camelize:function(s){return s.replace(/-+(.)?/g,function(a,u){return u?u.toUpperCase():""})},capitalize:function(s,a){return s.charAt(0).toUpperCase()+(a?s.slice(1):s.slice(1).toLowerCase())},escapeXml:function(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(s){var a,u=0,i=[];for(u=0;u<s.length;u++)(a=l(s,u))!==!1&&i.push(a);return i}}}(),function(){var l=Array.prototype.slice,s=function(){},a=function(){for(var c in{toString:1})if(c==="toString")return!1;return!0}(),u=function(c,_,d){for(var f in _)f in c.prototype&&typeof c.prototype[f]=="function"&&(_[f]+"").indexOf("callSuper")>-1?c.prototype[f]=function(m){return function(){var b=this.constructor.superclass;this.constructor.superclass=d;var C=_[m].apply(this,arguments);if(this.constructor.superclass=b,m!=="initialize")return C}}(f):c.prototype[f]=_[f],a&&(_.toString!==Object.prototype.toString&&(c.prototype.toString=_.toString),_.valueOf!==Object.prototype.valueOf&&(c.prototype.valueOf=_.valueOf))};function i(){}function n(c){for(var _=null,d=this;d.constructor.superclass;){var f=d.constructor.superclass.prototype[c];if(d[c]!==f){_=f;break}d=d.constructor.superclass.prototype}return _?arguments.length>1?_.apply(this,l.call(arguments,1)):_.call(this):console.log("tried to callSuper "+c+", method not found in prototype chain",this)}y.util.createClass=function(){var c=null,_=l.call(arguments,0);function d(){this.initialize.apply(this,arguments)}typeof _[0]=="function"&&(c=_.shift()),d.superclass=c,d.subclasses=[],c&&(i.prototype=c.prototype,d.prototype=new i,c.subclasses.push(d));for(var f=0,m=_.length;f<m;f++)u(d,_[f],c);return d.prototype.initialize||(d.prototype.initialize=s),d.prototype.constructor=d,d.prototype.callSuper=n,d}}(),w=!!y.document.createElement("div").attachEvent,x=["touchstart","touchmove","touchend"],y.util.addListener=function(l,s,a,u){l&&l.addEventListener(s,a,!w&&u)},y.util.removeListener=function(l,s,a,u){l&&l.removeEventListener(s,a,!w&&u)},y.util.getPointer=function(l){var s=l.target,a=y.util.getScrollLeftTop(s),u=function(i){var n=i.changedTouches;return n&&n[0]?n[0]:i}(l);return{x:u.clientX+a.left,y:u.clientY+a.top}},y.util.isTouchEvent=function(l){return x.indexOf(l.type)>-1||l.pointerType==="touch"},A=typeof(E=y.document.createElement("div")).style.opacity=="string",W=typeof E.style.filter=="string",Y=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,z=function(l){return l},A?z=function(l,s){return l.style.opacity=s,l}:W&&(z=function(l,s){var a=l.style;return l.currentStyle&&!l.currentStyle.hasLayout&&(a.zoom=1),Y.test(a.filter)?(s=s>=.9999?"":"alpha(opacity="+100*s+")",a.filter=a.filter.replace(Y,s)):a.filter+=" alpha(opacity="+100*s+")",l}),y.util.setStyle=function(l,s){var a=l.style;if(!a)return l;if(typeof s=="string")return l.style.cssText+=";"+s,s.indexOf("opacity")>-1?z(l,s.match(/opacity:\s*(\d?\.?\d*)/)[1]):l;for(var u in s)u==="opacity"?z(l,s[u]):a[u==="float"||u==="cssFloat"?a.styleFloat===void 0?"cssFloat":"styleFloat":u]=s[u];return l},function(){var l,s,a,u,i=Array.prototype.slice,n=function(d){return i.call(d,0)};try{l=n(y.document.childNodes)instanceof Array}catch{}function c(d,f){var m=y.document.createElement(d);for(var b in f)b==="class"?m.className=f[b]:b==="for"?m.htmlFor=f[b]:m.setAttribute(b,f[b]);return m}function _(d){for(var f=0,m=0,b=y.document.documentElement,C=y.document.body||{scrollLeft:0,scrollTop:0};d&&(d.parentNode||d.host)&&((d=d.parentNode||d.host)===y.document?(f=C.scrollLeft||b.scrollLeft||0,m=C.scrollTop||b.scrollTop||0):(f+=d.scrollLeft||0,m+=d.scrollTop||0),d.nodeType!==1||d.style.position!=="fixed"););return{left:f,top:m}}l||(n=function(d){for(var f=new Array(d.length),m=d.length;m--;)f[m]=d[m];return f}),s=y.document.defaultView&&y.document.defaultView.getComputedStyle?function(d,f){var m=y.document.defaultView.getComputedStyle(d,null);return m?m[f]:void 0}:function(d,f){var m=d.style[f];return!m&&d.currentStyle&&(m=d.currentStyle[f]),m},a=y.document.documentElement.style,u="userSelect"in a?"userSelect":"MozUserSelect"in a?"MozUserSelect":"WebkitUserSelect"in a?"WebkitUserSelect":"KhtmlUserSelect"in a?"KhtmlUserSelect":"",y.util.makeElementUnselectable=function(d){return d.onselectstart!==void 0&&(d.onselectstart=y.util.falseFunction),u?d.style[u]="none":typeof d.unselectable=="string"&&(d.unselectable="on"),d},y.util.makeElementSelectable=function(d){return d.onselectstart!==void 0&&(d.onselectstart=null),u?d.style[u]="":typeof d.unselectable=="string"&&(d.unselectable=""),d},y.util.setImageSmoothing=function(d,f){d.imageSmoothingEnabled=d.imageSmoothingEnabled||d.webkitImageSmoothingEnabled||d.mozImageSmoothingEnabled||d.msImageSmoothingEnabled||d.oImageSmoothingEnabled,d.imageSmoothingEnabled=f},y.util.getById=function(d){return typeof d=="string"?y.document.getElementById(d):d},y.util.toArray=n,y.util.addClass=function(d,f){d&&(" "+d.className+" ").indexOf(" "+f+" ")===-1&&(d.className+=(d.className?" ":"")+f)},y.util.makeElement=c,y.util.wrapElement=function(d,f,m){return typeof f=="string"&&(f=c(f,m)),d.parentNode&&d.parentNode.replaceChild(f,d),f.appendChild(d),f},y.util.getScrollLeftTop=_,y.util.getElementOffset=function(d){var f,m,b=d&&d.ownerDocument,C={left:0,top:0},I={left:0,top:0},T={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!b)return I;for(var R in T)I[T[R]]+=parseInt(s(d,R),10)||0;return f=b.documentElement,d.getBoundingClientRect!==void 0&&(C=d.getBoundingClientRect()),m=_(d),{left:C.left+m.left-(f.clientLeft||0)+I.left,top:C.top+m.top-(f.clientTop||0)+I.top}},y.util.getNodeCanvas=function(d){var f=y.jsdomImplForWrapper(d);return f._canvas||f._image},y.util.cleanUpJsdomNode=function(d){if(y.isLikelyNode){var f=y.jsdomImplForWrapper(d);f&&(f._image=null,f._canvas=null,f._currentSrc=null,f._attributes=null,f._classList=null)}}}(),function(){function l(){}y.util.request=function(s,a){a||(a={});var u=a.method?a.method.toUpperCase():"GET",i=a.onComplete||function(){},n=new y.window.XMLHttpRequest,c=a.body||a.parameters;return n.onreadystatechange=function(){n.readyState===4&&(i(n),n.onreadystatechange=l)},u==="GET"&&(c=null,typeof a.parameters=="string"&&(s=function(_,d){return _+(/\?/.test(_)?"&":"?")+d}(s,a.parameters))),n.open(u,s,!0),u!=="POST"&&u!=="PUT"||n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(c),n}}(),y.log=console.log,y.warn=console.warn,function(){var l=y.util.object.extend,s=y.util.object.clone,a=[];function u(){return!1}function i(d,f,m,b){return-m*Math.cos(d/b*(Math.PI/2))+m+f}y.util.object.extend(a,{cancelAll:function(){var d=this.splice(0);return d.forEach(function(f){f.cancel()}),d},cancelByCanvas:function(d){if(!d)return[];var f=this.filter(function(m){return typeof m.target=="object"&&m.target.canvas===d});return f.forEach(function(m){m.cancel()}),f},cancelByTarget:function(d){var f=this.findAnimationsByTarget(d);return f.forEach(function(m){m.cancel()}),f},findAnimationIndex:function(d){return this.indexOf(this.findAnimation(d))},findAnimation:function(d){return this.find(function(f){return f.cancel===d})},findAnimationsByTarget:function(d){return d?this.filter(function(f){return f.target===d}):[]}});var n=y.window.requestAnimationFrame||y.window.webkitRequestAnimationFrame||y.window.mozRequestAnimationFrame||y.window.oRequestAnimationFrame||y.window.msRequestAnimationFrame||function(d){return y.window.setTimeout(d,1e3/60)},c=y.window.cancelAnimationFrame||y.window.clearTimeout;function _(){return n.apply(y.window,arguments)}y.util.animate=function(d){d||(d={});var f,m=!1,b=function(){var C=y.runningAnimations.indexOf(f);return C>-1&&y.runningAnimations.splice(C,1)[0]};return f=l(s(d),{cancel:function(){return m=!0,b()},currentValue:"startValue"in d?d.startValue:0,completionRate:0,durationRate:0}),y.runningAnimations.push(f),_(function(C){var I,T=C||+new Date,R=d.duration||500,B=T+R,U=d.onChange||u,X=d.abort||u,Q=d.onComplete||u,O=d.easing||i,M="startValue"in d&&d.startValue.length>0,D="startValue"in d?d.startValue:0,L="endValue"in d?d.endValue:100,k=d.byValue||(M?D.map(function(V,G){return L[G]-D[G]}):L-D);d.onStart&&d.onStart(),function V(G){var P=(I=G||+new Date)>B?R:I-T,F=P/R,N=M?D.map(function(H,$){return O(P,D[$],k[$],R)}):O(P,D,k,R),K=Math.abs(M?(N[0]-D[0])/k[0]:(N-D)/k);if(f.currentValue=M?N.slice():N,f.completionRate=K,f.durationRate=F,!m){if(!X(N,K,F))return I>B?(f.currentValue=M?L.slice():L,f.completionRate=1,f.durationRate=1,U(M?L.slice():L,1,1),Q(L,1,1),void b()):(U(N,K,F),void _(V));b()}}(T)}),f.cancel},y.util.requestAnimFrame=_,y.util.cancelAnimFrame=function(){return c.apply(y.window,arguments)},y.runningAnimations=a}(),function(){function l(s,a,u){var i="rgba("+parseInt(s[0]+u*(a[0]-s[0]),10)+","+parseInt(s[1]+u*(a[1]-s[1]),10)+","+parseInt(s[2]+u*(a[2]-s[2]),10);return(i+=","+(s&&a?parseFloat(s[3]+u*(a[3]-s[3])):1))+")"}y.util.animateColor=function(s,a,u,i){var n=new y.Color(s).getSource(),c=new y.Color(a).getSource(),_=i.onComplete,d=i.onChange;return i=i||{},y.util.animate(y.util.object.extend(i,{duration:u||500,startValue:n,endValue:c,byValue:c,easing:function(f,m,b,C){return l(m,b,i.colorEasing?i.colorEasing(f,C):1-Math.cos(f/C*(Math.PI/2)))},onComplete:function(f,m,b){if(_)return _(l(c,c,0),m,b)},onChange:function(f,m,b){if(d){if(Array.isArray(f))return d(l(f,f,0),m,b);d(f,m,b)}}}))}}(),function(){function l(i,n,c,_){return i<Math.abs(n)?(i=n,_=c/4):_=n===0&&i===0?c/(2*Math.PI)*Math.asin(1):c/(2*Math.PI)*Math.asin(n/i),{a:i,c:n,p:c,s:_}}function s(i,n,c){return i.a*Math.pow(2,10*(n-=1))*Math.sin((n*c-i.s)*(2*Math.PI)/i.p)}function a(i,n,c,_){return c-u(_-i,0,c,_)+n}function u(i,n,c,_){return(i/=_)<1/2.75?c*(7.5625*i*i)+n:i<2/2.75?c*(7.5625*(i-=1.5/2.75)*i+.75)+n:i<2.5/2.75?c*(7.5625*(i-=2.25/2.75)*i+.9375)+n:c*(7.5625*(i-=2.625/2.75)*i+.984375)+n}y.util.ease={easeInQuad:function(i,n,c,_){return c*(i/=_)*i+n},easeOutQuad:function(i,n,c,_){return-c*(i/=_)*(i-2)+n},easeInOutQuad:function(i,n,c,_){return(i/=_/2)<1?c/2*i*i+n:-c/2*(--i*(i-2)-1)+n},easeInCubic:function(i,n,c,_){return c*(i/=_)*i*i+n},easeOutCubic:function(i,n,c,_){return c*((i=i/_-1)*i*i+1)+n},easeInOutCubic:function(i,n,c,_){return(i/=_/2)<1?c/2*i*i*i+n:c/2*((i-=2)*i*i+2)+n},easeInQuart:function(i,n,c,_){return c*(i/=_)*i*i*i+n},easeOutQuart:function(i,n,c,_){return-c*((i=i/_-1)*i*i*i-1)+n},easeInOutQuart:function(i,n,c,_){return(i/=_/2)<1?c/2*i*i*i*i+n:-c/2*((i-=2)*i*i*i-2)+n},easeInQuint:function(i,n,c,_){return c*(i/=_)*i*i*i*i+n},easeOutQuint:function(i,n,c,_){return c*((i=i/_-1)*i*i*i*i+1)+n},easeInOutQuint:function(i,n,c,_){return(i/=_/2)<1?c/2*i*i*i*i*i+n:c/2*((i-=2)*i*i*i*i+2)+n},easeInSine:function(i,n,c,_){return-c*Math.cos(i/_*(Math.PI/2))+c+n},easeOutSine:function(i,n,c,_){return c*Math.sin(i/_*(Math.PI/2))+n},easeInOutSine:function(i,n,c,_){return-c/2*(Math.cos(Math.PI*i/_)-1)+n},easeInExpo:function(i,n,c,_){return i===0?n:c*Math.pow(2,10*(i/_-1))+n},easeOutExpo:function(i,n,c,_){return i===_?n+c:c*(1-Math.pow(2,-10*i/_))+n},easeInOutExpo:function(i,n,c,_){return i===0?n:i===_?n+c:(i/=_/2)<1?c/2*Math.pow(2,10*(i-1))+n:c/2*(2-Math.pow(2,-10*--i))+n},easeInCirc:function(i,n,c,_){return-c*(Math.sqrt(1-(i/=_)*i)-1)+n},easeOutCirc:function(i,n,c,_){return c*Math.sqrt(1-(i=i/_-1)*i)+n},easeInOutCirc:function(i,n,c,_){return(i/=_/2)<1?-c/2*(Math.sqrt(1-i*i)-1)+n:c/2*(Math.sqrt(1-(i-=2)*i)+1)+n},easeInElastic:function(i,n,c,_){var d=0;return i===0?n:(i/=_)==1?n+c:(d||(d=.3*_),-s(l(c,c,d,1.70158),i,_)+n)},easeOutElastic:function(i,n,c,_){var d=0;if(i===0)return n;if((i/=_)==1)return n+c;d||(d=.3*_);var f=l(c,c,d,1.70158);return f.a*Math.pow(2,-10*i)*Math.sin((i*_-f.s)*(2*Math.PI)/f.p)+f.c+n},easeInOutElastic:function(i,n,c,_){var d=0;if(i===0)return n;if((i/=_/2)==2)return n+c;d||(d=_*(.3*1.5));var f=l(c,c,d,1.70158);return i<1?-.5*s(f,i,_)+n:f.a*Math.pow(2,-10*(i-=1))*Math.sin((i*_-f.s)*(2*Math.PI)/f.p)*.5+f.c+n},easeInBack:function(i,n,c,_,d){return d===void 0&&(d=1.70158),c*(i/=_)*i*((d+1)*i-d)+n},easeOutBack:function(i,n,c,_,d){return d===void 0&&(d=1.70158),c*((i=i/_-1)*i*((d+1)*i+d)+1)+n},easeInOutBack:function(i,n,c,_,d){return d===void 0&&(d=1.70158),(i/=_/2)<1?c/2*(i*i*((1+(d*=1.525))*i-d))+n:c/2*((i-=2)*i*((1+(d*=1.525))*i+d)+2)+n},easeInBounce:a,easeOutBounce:u,easeInOutBounce:function(i,n,c,_){return i<_/2?.5*a(2*i,0,c,_)+n:.5*u(2*i-_,0,c,_)+.5*c+n}}}(),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.util.object.clone,i=s.util.toFixed,n=s.util.parseUnit,c=s.util.multiplyTransformMatrices,_={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},d={stroke:"strokeOpacity",fill:"fillOpacity"},f="font-size",m="clip-path";function b(D){return D in _?_[D]:D}function C(D,L,k,V){var G,P=Array.isArray(L);if(D!=="fill"&&D!=="stroke"||L!=="none"){if(D==="strokeUniform")return L==="non-scaling-stroke";if(D==="strokeDashArray")L=L==="none"?null:L.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(D==="transformMatrix")L=k&&k.transformMatrix?c(k.transformMatrix,s.parseTransformAttribute(L)):s.parseTransformAttribute(L);else if(D==="visible")L=L!=="none"&&L!=="hidden",k&&k.visible===!1&&(L=!1);else if(D==="opacity")L=parseFloat(L),k&&k.opacity!==void 0&&(L*=k.opacity);else if(D==="textAnchor")L=L==="start"?"left":L==="end"?"right":"center";else if(D==="charSpacing")G=n(L,V)/V*1e3;else if(D==="paintFirst"){var F=L.indexOf("fill"),N=L.indexOf("stroke");L="fill",(F>-1&&N>-1&&N<F||F===-1&&N>-1)&&(L="stroke")}else{if(D==="href"||D==="xlink:href"||D==="font")return L;if(D==="imageSmoothing")return L==="optimizeQuality";G=P?L.map(n):n(L,V)}}else L="";return!P&&isNaN(G)?L:G}function I(D){return new RegExp("^("+D.join("|")+")\\b","i")}function T(D,L){var k,V,G,P,F=[];for(G=0,P=L.length;G<P;G++)k=L[G],V=D.getElementsByTagName(k),F=F.concat(Array.prototype.slice.call(V));return F}function R(D,L){var k,V=!0;return(k=B(D,L.pop()))&&L.length&&(V=function(G,P){for(var F,N=!0;G.parentNode&&G.parentNode.nodeType===1&&P.length;)N&&(F=P.pop()),N=B(G=G.parentNode,F);return P.length===0}(D,L)),k&&V&&L.length===0}function B(D,L){var k,V,G=D.nodeName,P=D.getAttribute("class"),F=D.getAttribute("id");if(k=new RegExp("^"+G,"i"),L=L.replace(k,""),F&&L.length&&(k=new RegExp("#"+F+"(?![a-zA-Z\\-]+)","i"),L=L.replace(k,"")),P&&L.length)for(V=(P=P.split(" ")).length;V--;)k=new RegExp("\\."+P[V]+"(?![a-zA-Z\\-]+)","i"),L=L.replace(k,"");return L.length===0}function U(D,L){var k;if(D.getElementById&&(k=D.getElementById(L)),k)return k;var V,G,P,F=D.getElementsByTagName("*");for(G=0,P=F.length;G<P;G++)if(L===(V=F[G]).getAttribute("id"))return V}s.svgValidTagNamesRegEx=I(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),s.svgViewBoxElementsRegEx=I(["symbol","image","marker","pattern","view","svg"]),s.svgInvalidAncestorsRegEx=I(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),s.svgValidParentsRegEx=I(["symbol","g","a","svg","clipPath","defs"]),s.cssRules={},s.gradientDefs={},s.clipPaths={},s.parseTransformAttribute=function(){function D(N,K,H){N[H]=Math.tan(s.util.degreesToRadians(K[0]))}var L=s.iMatrix,k=s.reNum,V=s.commaWsp,G="(?:(?:(matrix)\\s*\\(\\s*("+k+")"+V+"("+k+")"+V+"("+k+")"+V+"("+k+")"+V+"("+k+")"+V+"("+k+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+k+")(?:"+V+"("+k+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+k+")(?:"+V+"("+k+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+k+")(?:"+V+"("+k+")"+V+"("+k+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+k+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+k+")\\s*\\)))",P=new RegExp("^\\s*(?:(?:"+G+"(?:"+V+"*"+G+")*)?)\\s*$"),F=new RegExp(G,"g");return function(N){var K=L.concat(),H=[];if(!N||N&&!P.test(N))return K;N.replace(F,function(ie){var re=new RegExp(G).exec(ie).filter(function(ae){return!!ae}),ne=re[1],oe=re.slice(2).map(parseFloat);switch(ne){case"translate":(function(ae,ce){ae[4]=ce[0],ce.length===2&&(ae[5]=ce[1])})(K,oe);break;case"rotate":oe[0]=s.util.degreesToRadians(oe[0]),function(ae,ce){var de=s.util.cos(ce[0]),ue=s.util.sin(ce[0]),me=0,we=0;ce.length===3&&(me=ce[1],we=ce[2]),ae[0]=de,ae[1]=ue,ae[2]=-ue,ae[3]=de,ae[4]=me-(de*me-ue*we),ae[5]=we-(ue*me+de*we)}(K,oe);break;case"scale":(function(ae,ce){var de=ce[0],ue=ce.length===2?ce[1]:ce[0];ae[0]=de,ae[3]=ue})(K,oe);break;case"skewX":D(K,oe,2);break;case"skewY":D(K,oe,1);break;case"matrix":K=oe}H.push(K.concat()),K=L.concat()});for(var $=H[0];H.length>1;)H.shift(),$=s.util.multiplyTransformMatrices($,H[0]);return $}}();var X=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function Q(D){if(!s.svgViewBoxElementsRegEx.test(D.nodeName))return{};var L,k,V,G,P,F,N=D.getAttribute("viewBox"),K=1,H=1,$=D.getAttribute("width"),ie=D.getAttribute("height"),re=D.getAttribute("x")||0,ne=D.getAttribute("y")||0,oe=D.getAttribute("preserveAspectRatio")||"",ae=!N||!(N=N.match(X)),ce=!$||!ie||$==="100%"||ie==="100%",de=ae&&ce,ue={},me="",we=0,Ie=0;if(ue.width=0,ue.height=0,ue.toBeParsed=de,ae&&(re||ne)&&D.parentNode&&D.parentNode.nodeName!=="#document"&&(me=" translate("+n(re)+" "+n(ne)+") ",P=(D.getAttribute("transform")||"")+me,D.setAttribute("transform",P),D.removeAttribute("x"),D.removeAttribute("y")),de)return ue;if(ae)return ue.width=n($),ue.height=n(ie),ue;if(L=-parseFloat(N[1]),k=-parseFloat(N[2]),V=parseFloat(N[3]),G=parseFloat(N[4]),ue.minX=L,ue.minY=k,ue.viewBoxWidth=V,ue.viewBoxHeight=G,ce?(ue.width=V,ue.height=G):(ue.width=n($),ue.height=n(ie),K=ue.width/V,H=ue.height/G),(oe=s.util.parsePreserveAspectRatioAttribute(oe)).alignX!=="none"&&(oe.meetOrSlice==="meet"&&(H=K=K>H?H:K),oe.meetOrSlice==="slice"&&(H=K=K>H?K:H),we=ue.width-V*K,Ie=ue.height-G*K,oe.alignX==="Mid"&&(we/=2),oe.alignY==="Mid"&&(Ie/=2),oe.alignX==="Min"&&(we=0),oe.alignY==="Min"&&(Ie=0)),K===1&&H===1&&L===0&&k===0&&re===0&&ne===0)return ue;if((re||ne)&&D.parentNode.nodeName!=="#document"&&(me=" translate("+n(re)+" "+n(ne)+") "),P=me+" matrix("+K+" 0 0 "+H+" "+(L*K+we)+" "+(k*H+Ie)+") ",D.nodeName==="svg"){for(F=D.ownerDocument.createElementNS(s.svgNS,"g");D.firstChild;)F.appendChild(D.firstChild);D.appendChild(F)}else(F=D).removeAttribute("x"),F.removeAttribute("y"),P=F.getAttribute("transform")+P;return F.setAttribute("transform",P),ue}function O(D,L){var k="xlink:href",V=U(D,L.getAttribute(k).slice(1));if(V&&V.getAttribute(k)&&O(D,V),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(P){V&&!L.hasAttribute(P)&&V.hasAttribute(P)&&L.setAttribute(P,V.getAttribute(P))}),!L.children.length)for(var G=V.cloneNode(!0);G.firstChild;)L.appendChild(G.firstChild);L.removeAttribute(k)}s.parseSVGDocument=function(D,L,k,V){if(D){(function(re){for(var ne=T(re,["use","svg:use"]),oe=0;ne.length&&oe<ne.length;){var ae=ne[oe],ce=ae.getAttribute("xlink:href")||ae.getAttribute("href");if(ce===null)return;var de,ue,me,we,Ie=ce.slice(1),De=ae.getAttribute("x")||0,nt=ae.getAttribute("y")||0,Oe=U(re,Ie).cloneNode(!0),ze=(Oe.getAttribute("transform")||"")+" translate("+De+", "+nt+")",Yt=ne.length,Rt=s.svgNS;if(Q(Oe),/^svg$/i.test(Oe.nodeName)){var vt=Oe.ownerDocument.createElementNS(Rt,"g");for(ue=0,we=(me=Oe.attributes).length;ue<we;ue++)de=me.item(ue),vt.setAttributeNS(Rt,de.nodeName,de.nodeValue);for(;Oe.firstChild;)vt.appendChild(Oe.firstChild);Oe=vt}for(ue=0,we=(me=ae.attributes).length;ue<we;ue++)(de=me.item(ue)).nodeName!=="x"&&de.nodeName!=="y"&&de.nodeName!=="xlink:href"&&de.nodeName!=="href"&&(de.nodeName==="transform"?ze=de.nodeValue+" "+ze:Oe.setAttribute(de.nodeName,de.nodeValue));Oe.setAttribute("transform",ze),Oe.setAttribute("instantiated_by_use","1"),Oe.removeAttribute("id"),ae.parentNode.replaceChild(Oe,ae),ne.length===Yt&&oe++}})(D);var G,P,F=s.Object.__uid++,N=Q(D),K=s.util.toArray(D.getElementsByTagName("*"));if(N.crossOrigin=V&&V.crossOrigin,N.svgUid=F,K.length===0&&s.isLikelyNode){var H=[];for(G=0,P=(K=D.selectNodes('//*[name(.)!="svg"]')).length;G<P;G++)H[G]=K[G];K=H}var $=K.filter(function(re){return Q(re),s.svgValidTagNamesRegEx.test(re.nodeName.replace("svg:",""))&&!function(ne,oe){for(;ne&&(ne=ne.parentNode);)if(ne.nodeName&&oe.test(ne.nodeName.replace("svg:",""))&&!ne.getAttribute("instantiated_by_use"))return!0;return!1}(re,s.svgInvalidAncestorsRegEx)});if(!$||$&&!$.length)L&&L([],{});else{var ie={};K.filter(function(re){return re.nodeName.replace("svg:","")==="clipPath"}).forEach(function(re){var ne=re.getAttribute("id");ie[ne]=s.util.toArray(re.getElementsByTagName("*")).filter(function(oe){return s.svgValidTagNamesRegEx.test(oe.nodeName.replace("svg:",""))})}),s.gradientDefs[F]=s.getGradientDefs(D),s.cssRules[F]=s.getCSSRules(D),s.clipPaths[F]=ie,s.parseElements($,function(re,ne){L&&(L(re,N,ne,K),delete s.gradientDefs[F],delete s.cssRules[F],delete s.clipPaths[F])},u(N),k,V)}}};var M=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");a(s,{parseFontDeclaration:function(D,L){var k=D.match(M);if(k){var V=k[1],G=k[3],P=k[4],F=k[5],N=k[6];V&&(L.fontStyle=V),G&&(L.fontWeight=isNaN(parseFloat(G))?G:parseFloat(G)),P&&(L.fontSize=n(P)),N&&(L.fontFamily=N),F&&(L.lineHeight=F==="normal"?1:F)}},getGradientDefs:function(D){var L,k=T(D,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),V=0,G={};for(V=k.length;V--;)(L=k[V]).getAttribute("xlink:href")&&O(D,L),G[L.getAttribute("id")]=L;return G},parseAttributes:function(D,L,k){if(D){var V,G,P,F={};k===void 0&&(k=D.getAttribute("svgUid")),D.parentNode&&s.svgValidParentsRegEx.test(D.parentNode.nodeName)&&(F=s.parseAttributes(D.parentNode,L,k));var N=L.reduce(function(oe,ae){return(V=D.getAttribute(ae))&&(oe[ae]=V),oe},{}),K=a(function(oe,ae){var ce={};for(var de in s.cssRules[ae])if(R(oe,de.split(" ")))for(var ue in s.cssRules[ae][de])ce[ue]=s.cssRules[ae][de][ue];return ce}(D,k),s.parseStyleAttribute(D));N=a(N,K),K[m]&&D.setAttribute(m,K[m]),G=P=F.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,N[f]&&(N[f]=G=n(N[f],P));var H,$,ie={};for(var re in N)$=C(H=b(re),N[re],F,G),ie[H]=$;ie&&ie.font&&s.parseFontDeclaration(ie.font,ie);var ne=a(F,ie);return s.svgValidParentsRegEx.test(D.nodeName)?ne:function(oe){for(var ae in d)if(oe[d[ae]]!==void 0&&oe[ae]!==""){if(oe[ae]===void 0){if(!s.Object.prototype[ae])continue;oe[ae]=s.Object.prototype[ae]}if(oe[ae].indexOf("url(")!==0){var ce=new s.Color(oe[ae]);oe[ae]=ce.setAlpha(i(ce.getAlpha()*oe[d[ae]],2)).toRgba()}}return oe}(ne)}},parseElements:function(D,L,k,V,G){new s.ElementsParser(D,L,k,V,G).parse()},parseStyleAttribute:function(D){var L={},k=D.getAttribute("style");return k&&(typeof k=="string"?function(V,G){var P,F;V.replace(/;\s*$/,"").split(";").forEach(function(N){var K=N.split(":");P=K[0].trim().toLowerCase(),F=K[1].trim(),G[P]=F})}(k,L):function(V,G){var P,F;for(var N in V)V[N]!==void 0&&(P=N.toLowerCase(),F=V[N],G[P]=F)}(k,L)),L},parsePointsAttribute:function(D){if(!D)return null;var L,k,V=[];for(L=0,k=(D=(D=D.replace(/,/g," ").trim()).split(/\s+/)).length;L<k;L+=2)V.push({x:parseFloat(D[L]),y:parseFloat(D[L+1])});return V},getCSSRules:function(D){var L,k,V=D.getElementsByTagName("style"),G={};for(L=0,k=V.length;L<k;L++){var P=V[L].textContent;(P=P.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&P.split("}").filter(function(F){return F.trim()}).forEach(function(F){var N=F.split("{"),K={},H=N[1].trim().split(";").filter(function(ne){return ne.trim()});for(L=0,k=H.length;L<k;L++){var $=H[L].split(":"),ie=$[0].trim(),re=$[1].trim();K[ie]=re}(F=N[0].trim()).split(",").forEach(function(ne){(ne=ne.replace(/^svg/i,"").trim())!==""&&(G[ne]?s.util.object.extend(G[ne],K):G[ne]=s.util.object.clone(K))})})}return G},loadSVGFromURL:function(D,L,k,V){D=D.replace(/^\n\s*/,"").trim(),new s.util.request(D,{method:"get",onComplete:function(G){var P=G.responseXML;if(!P||!P.documentElement)return L&&L(null),!1;s.parseSVGDocument(P.documentElement,function(F,N,K,H){L&&L(F,N,K,H)},k,V)}})},loadSVGFromString:function(D,L,k,V){var G=new s.window.DOMParser().parseFromString(D.trim(),"text/xml");s.parseSVGDocument(G.documentElement,function(P,F,N,K){L(P,F,N,K)},k,V)}})}(e),y.ElementsParser=function(l,s,a,u,i,n){this.elements=l,this.callback=s,this.options=a,this.reviver=u,this.svgUid=a&&a.svgUid||0,this.parsingOptions=i,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=n},(q=y.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},q.createObjects=function(){var l=this;this.elements.forEach(function(s,a){s.setAttribute("svgUid",l.svgUid),l.createObject(s,a)})},q.findTag=function(l){return y[y.util.string.capitalize(l.tagName.replace("svg:",""))]},q.createObject=function(l,s){var a=this.findTag(l);if(a&&a.fromElement)try{a.fromElement(l,this.createCallback(s,l),this.options)}catch(u){y.log(u)}else this.checkIfDone()},q.createCallback=function(l,s){var a=this;return function(u){var i;a.resolveGradient(u,s,"fill"),a.resolveGradient(u,s,"stroke"),u instanceof y.Image&&u._originalElement&&(i=u.parsePreserveAspectRatioAttribute(s)),u._removeTransformMatrix(i),a.resolveClipPath(u,s),a.reviver&&a.reviver(s,u),a.instances[l]=u,a.checkIfDone()}},q.extractPropertyDefinition=function(l,s,a){var u=l[s],i=this.regexUrl;if(i.test(u)){i.lastIndex=0;var n=i.exec(u)[1];return i.lastIndex=0,y[a][this.svgUid][n]}},q.resolveGradient=function(l,s,a){var u=this.extractPropertyDefinition(l,a,"gradientDefs");if(u){var i=s.getAttribute(a+"-opacity"),n=y.Gradient.fromElement(u,l,i,this.options);l.set(a,n)}},q.createClipPathCallback=function(l,s){return function(a){a._removeTransformMatrix(),a.fillRule=a.clipRule,s.push(a)}},q.resolveClipPath=function(l,s){var a,u,i,n,c=this.extractPropertyDefinition(l,"clipPath","clipPaths");if(c){i=[],u=y.util.invertTransform(l.calcTransformMatrix());for(var _=c[0].parentNode,d=s;d.parentNode&&d.getAttribute("clip-path")!==l.clipPath;)d=d.parentNode;d.parentNode.appendChild(_);for(var f=0;f<c.length;f++)a=c[f],this.findTag(a).fromElement(a,this.createClipPathCallback(l,i),this.options);c=i.length===1?i[0]:new y.Group(i),n=y.util.multiplyTransformMatrices(u,c.calcTransformMatrix()),c.clipPath&&this.resolveClipPath(c,d);var m=y.util.qrDecompose(n);c.flipX=!1,c.flipY=!1,c.set("scaleX",m.scaleX),c.set("scaleY",m.scaleY),c.angle=m.angle,c.skewX=m.skewX,c.skewY=0,c.setPositionByOrigin({x:m.translateX,y:m.translateY},"center","center"),l.clipPath=c}else delete l.clipPath},q.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(l){return l!=null}),this.callback(this.instances,this.elements))},function(l){var s=l.fabric||(l.fabric={});function a(u,i){this.x=u,this.y=i}s.Point?s.warn("fabric.Point is already defined"):(s.Point=a,a.prototype={type:"point",constructor:a,add:function(u){return new a(this.x+u.x,this.y+u.y)},addEquals:function(u){return this.x+=u.x,this.y+=u.y,this},scalarAdd:function(u){return new a(this.x+u,this.y+u)},scalarAddEquals:function(u){return this.x+=u,this.y+=u,this},subtract:function(u){return new a(this.x-u.x,this.y-u.y)},subtractEquals:function(u){return this.x-=u.x,this.y-=u.y,this},scalarSubtract:function(u){return new a(this.x-u,this.y-u)},scalarSubtractEquals:function(u){return this.x-=u,this.y-=u,this},multiply:function(u){return new a(this.x*u,this.y*u)},multiplyEquals:function(u){return this.x*=u,this.y*=u,this},divide:function(u){return new a(this.x/u,this.y/u)},divideEquals:function(u){return this.x/=u,this.y/=u,this},eq:function(u){return this.x===u.x&&this.y===u.y},lt:function(u){return this.x<u.x&&this.y<u.y},lte:function(u){return this.x<=u.x&&this.y<=u.y},gt:function(u){return this.x>u.x&&this.y>u.y},gte:function(u){return this.x>=u.x&&this.y>=u.y},lerp:function(u,i){return i===void 0&&(i=.5),i=Math.max(Math.min(1,i),0),new a(this.x+(u.x-this.x)*i,this.y+(u.y-this.y)*i)},distanceFrom:function(u){var i=this.x-u.x,n=this.y-u.y;return Math.sqrt(i*i+n*n)},midPointFrom:function(u){return this.lerp(u)},min:function(u){return new a(Math.min(this.x,u.x),Math.min(this.y,u.y))},max:function(u){return new a(Math.max(this.x,u.x),Math.max(this.y,u.y))},toString:function(){return this.x+","+this.y},setXY:function(u,i){return this.x=u,this.y=i,this},setX:function(u){return this.x=u,this},setY:function(u){return this.y=u,this},setFromPoint:function(u){return this.x=u.x,this.y=u.y,this},swap:function(u){var i=this.x,n=this.y;this.x=u.x,this.y=u.y,u.x=i,u.y=n},clone:function(){return new a(this.x,this.y)}})}(e),function(l){var s=l.fabric||(l.fabric={});function a(u){this.status=u,this.points=[]}s.Intersection?s.warn("fabric.Intersection is already defined"):(s.Intersection=a,s.Intersection.prototype={constructor:a,appendPoint:function(u){return this.points.push(u),this},appendPoints:function(u){return this.points=this.points.concat(u),this}},s.Intersection.intersectLineLine=function(u,i,n,c){var _,d=(c.x-n.x)*(u.y-n.y)-(c.y-n.y)*(u.x-n.x),f=(i.x-u.x)*(u.y-n.y)-(i.y-u.y)*(u.x-n.x),m=(c.y-n.y)*(i.x-u.x)-(c.x-n.x)*(i.y-u.y);if(m!==0){var b=d/m,C=f/m;0<=b&&b<=1&&0<=C&&C<=1?(_=new a("Intersection")).appendPoint(new s.Point(u.x+b*(i.x-u.x),u.y+b*(i.y-u.y))):_=new a}else _=new a(d===0||f===0?"Coincident":"Parallel");return _},s.Intersection.intersectLinePolygon=function(u,i,n){var c,_,d,f,m=new a,b=n.length;for(f=0;f<b;f++)c=n[f],_=n[(f+1)%b],d=a.intersectLineLine(u,i,c,_),m.appendPoints(d.points);return m.points.length>0&&(m.status="Intersection"),m},s.Intersection.intersectPolygonPolygon=function(u,i){var n,c=new a,_=u.length;for(n=0;n<_;n++){var d=u[n],f=u[(n+1)%_],m=a.intersectLinePolygon(d,f,i);c.appendPoints(m.points)}return c.points.length>0&&(c.status="Intersection"),c},s.Intersection.intersectPolygonRectangle=function(u,i,n){var c=i.min(n),_=i.max(n),d=new s.Point(_.x,c.y),f=new s.Point(c.x,_.y),m=a.intersectLinePolygon(c,d,u),b=a.intersectLinePolygon(d,_,u),C=a.intersectLinePolygon(_,f,u),I=a.intersectLinePolygon(f,c,u),T=new a;return T.appendPoints(m.points),T.appendPoints(b.points),T.appendPoints(C.points),T.appendPoints(I.points),T.points.length>0&&(T.status="Intersection"),T})}(e),function(l){var s=l.fabric||(l.fabric={});function a(i){i?this._tryParsingColor(i):this.setSource([0,0,0,1])}function u(i,n,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?i+6*(n-i)*c:c<.5?n:c<2/3?i+(n-i)*(2/3-c)*6:i}s.Color?s.warn("fabric.Color is already defined."):(s.Color=a,s.Color.prototype={_tryParsingColor:function(i){var n;i in a.colorNameMap&&(i=a.colorNameMap[i]),i==="transparent"&&(n=[255,255,255,0]),n||(n=a.sourceFromHex(i)),n||(n=a.sourceFromRgb(i)),n||(n=a.sourceFromHsl(i)),n||(n=[0,0,0,1]),n&&this.setSource(n)},_rgbToHsl:function(i,n,c){i/=255,n/=255,c/=255;var _,d,f,m=s.util.array.max([i,n,c]),b=s.util.array.min([i,n,c]);if(f=(m+b)/2,m===b)_=d=0;else{var C=m-b;switch(d=f>.5?C/(2-m-b):C/(m+b),m){case i:_=(n-c)/C+(n<c?6:0);break;case n:_=(c-i)/C+2;break;case c:_=(i-n)/C+4}_/=6}return[Math.round(360*_),Math.round(100*d),Math.round(100*f)]},getSource:function(){return this._source},setSource:function(i){this._source=i},toRgb:function(){var i=this.getSource();return"rgb("+i[0]+","+i[1]+","+i[2]+")"},toRgba:function(){var i=this.getSource();return"rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")"},toHsl:function(){var i=this.getSource(),n=this._rgbToHsl(i[0],i[1],i[2]);return"hsl("+n[0]+","+n[1]+"%,"+n[2]+"%)"},toHsla:function(){var i=this.getSource(),n=this._rgbToHsl(i[0],i[1],i[2]);return"hsla("+n[0]+","+n[1]+"%,"+n[2]+"%,"+i[3]+")"},toHex:function(){var i,n,c,_=this.getSource();return i=(i=_[0].toString(16)).length===1?"0"+i:i,n=(n=_[1].toString(16)).length===1?"0"+n:n,c=(c=_[2].toString(16)).length===1?"0"+c:c,i.toUpperCase()+n.toUpperCase()+c.toUpperCase()},toHexa:function(){var i,n=this.getSource();return i=(i=(i=Math.round(255*n[3])).toString(16)).length===1?"0"+i:i,this.toHex()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(i){var n=this.getSource();return n[3]=i,this.setSource(n),this},toGrayscale:function(){var i=this.getSource(),n=parseInt((.3*i[0]+.59*i[1]+.11*i[2]).toFixed(0),10),c=i[3];return this.setSource([n,n,n,c]),this},toBlackWhite:function(i){var n=this.getSource(),c=(.3*n[0]+.59*n[1]+.11*n[2]).toFixed(0),_=n[3];return i=i||127,c=Number(c)<Number(i)?0:255,this.setSource([c,c,c,_]),this},overlayWith:function(i){i instanceof a||(i=new a(i));var n,c=[],_=this.getAlpha(),d=this.getSource(),f=i.getSource();for(n=0;n<3;n++)c.push(Math.round(.5*d[n]+.5*f[n]));return c[3]=_,this.setSource(c),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},s.Color.fromRgb=function(i){return a.fromSource(a.sourceFromRgb(i))},s.Color.sourceFromRgb=function(i){var n=i.match(a.reRGBa);if(n){var c=parseInt(n[1],10)/(/%$/.test(n[1])?100:1)*(/%$/.test(n[1])?255:1),_=parseInt(n[2],10)/(/%$/.test(n[2])?100:1)*(/%$/.test(n[2])?255:1),d=parseInt(n[3],10)/(/%$/.test(n[3])?100:1)*(/%$/.test(n[3])?255:1);return[parseInt(c,10),parseInt(_,10),parseInt(d,10),n[4]?parseFloat(n[4]):1]}},s.Color.fromRgba=a.fromRgb,s.Color.fromHsl=function(i){return a.fromSource(a.sourceFromHsl(i))},s.Color.sourceFromHsl=function(i){var n=i.match(a.reHSLa);if(n){var c,_,d,f=(parseFloat(n[1])%360+360)%360/360,m=parseFloat(n[2])/(/%$/.test(n[2])?100:1),b=parseFloat(n[3])/(/%$/.test(n[3])?100:1);if(m===0)c=_=d=b;else{var C=b<=.5?b*(m+1):b+m-b*m,I=2*b-C;c=u(I,C,f+1/3),_=u(I,C,f),d=u(I,C,f-1/3)}return[Math.round(255*c),Math.round(255*_),Math.round(255*d),n[4]?parseFloat(n[4]):1]}},s.Color.fromHsla=a.fromHsl,s.Color.fromHex=function(i){return a.fromSource(a.sourceFromHex(i))},s.Color.sourceFromHex=function(i){if(i.match(a.reHex)){var n=i.slice(i.indexOf("#")+1),c=n.length===3||n.length===4,_=n.length===8||n.length===4,d=c?n.charAt(0)+n.charAt(0):n.substring(0,2),f=c?n.charAt(1)+n.charAt(1):n.substring(2,4),m=c?n.charAt(2)+n.charAt(2):n.substring(4,6),b=_?c?n.charAt(3)+n.charAt(3):n.substring(6,8):"FF";return[parseInt(d,16),parseInt(f,16),parseInt(m,16),parseFloat((parseInt(b,16)/255).toFixed(2))]}},s.Color.fromSource=function(i){var n=new a;return n.setSource(i),n})}(e),function(l){var s=l.fabric||(l.fabric={}),a=["e","se","s","sw","w","nw","n","ne","e"],u=["ns","nesw","ew","nwse"],i={},n="left",c="top",_="right",d="bottom",f="center",m={top:d,bottom:c,left:_,right:n,center:f},b=s.util.radiansToDegrees,C=Math.sign||function(P){return(P>0)-(P<0)||+P};function I(P,F){var N=P.angle+b(Math.atan2(F.y,F.x))+360;return Math.round(N%360/45)}function T(P,F){var N=F.transform.target,K=N.canvas,H=s.util.object.clone(F);H.target=N,K&&K.fire("object:"+P,H),N.fire(P,F)}function R(P,F){var N=F.canvas,K=P[N.uniScaleKey];return N.uniformScaling&&!K||!N.uniformScaling&&K}function B(P){return P.originX===f&&P.originY===f}function U(P,F,N){var K=P.lockScalingX,H=P.lockScalingY;return!((!K||!H)&&(F||!K&&!H||!N)&&(!K||F!=="x")&&(!H||F!=="y"))}function X(P,F,N,K){return{e:P,transform:F,pointer:{x:N,y:K}}}function Q(P){return function(F,N,K,H){var $=N.target,ie=$.getCenterPoint(),re=$.translateToOriginPoint(ie,N.originX,N.originY),ne=P(F,N,K,H);return $.setPositionByOrigin(re,N.originX,N.originY),ne}}function O(P,F){return function(N,K,H,$){var ie=F(N,K,H,$);return ie&&T(P,X(N,K,H,$)),ie}}function M(P,F,N,K,H){var $=P.target,ie=$.controls[P.corner],re=$.canvas.getZoom(),ne=$.padding/re,oe=$.toLocalPoint(new s.Point(K,H),F,N);return oe.x>=ne&&(oe.x-=ne),oe.x<=-ne&&(oe.x+=ne),oe.y>=ne&&(oe.y-=ne),oe.y<=ne&&(oe.y+=ne),oe.x-=ie.offsetX,oe.y-=ie.offsetY,oe}function D(P){return P.flipX!==P.flipY}function L(P,F,N,K,H){if(P[F]!==0){var $=H/P._getTransformedDimensions()[K]*P[N];P.set(N,$)}}function k(P,F,N,K){var H,$=F.target,ie=$._getTransformedDimensions(0,$.skewY),re=M(F,F.originX,F.originY,N,K),ne=Math.abs(2*re.x)-ie.x,oe=$.skewX;ne<2?H=0:(H=b(Math.atan2(ne/$.scaleX,ie.y/$.scaleY)),F.originX===n&&F.originY===d&&(H=-H),F.originX===_&&F.originY===c&&(H=-H),D($)&&(H=-H));var ae=oe!==H;if(ae){var ce=$._getTransformedDimensions().y;$.set("skewX",H),L($,"skewY","scaleY","y",ce)}return ae}function V(P,F,N,K){var H,$=F.target,ie=$._getTransformedDimensions($.skewX,0),re=M(F,F.originX,F.originY,N,K),ne=Math.abs(2*re.y)-ie.y,oe=$.skewY;ne<2?H=0:(H=b(Math.atan2(ne/$.scaleY,ie.x/$.scaleX)),F.originX===n&&F.originY===d&&(H=-H),F.originX===_&&F.originY===c&&(H=-H),D($)&&(H=-H));var ae=oe!==H;if(ae){var ce=$._getTransformedDimensions().x;$.set("skewY",H),L($,"skewX","scaleX","x",ce)}return ae}function G(P,F,N,K,H){H=H||{};var $,ie,re,ne,oe,ae,ce=F.target,de=ce.lockScalingX,ue=ce.lockScalingY,me=H.by,we=R(P,ce),Ie=U(ce,me,we),De=F.gestureScale;if(Ie)return!1;if(De)ie=F.scaleX*De,re=F.scaleY*De;else{if($=M(F,F.originX,F.originY,N,K),oe=me!=="y"?C($.x):1,ae=me!=="x"?C($.y):1,F.signX||(F.signX=oe),F.signY||(F.signY=ae),ce.lockScalingFlip&&(F.signX!==oe||F.signY!==ae))return!1;if(ne=ce._getTransformedDimensions(),we&&!me){var nt=Math.abs($.x)+Math.abs($.y),Oe=F.original,ze=nt/(Math.abs(ne.x*Oe.scaleX/ce.scaleX)+Math.abs(ne.y*Oe.scaleY/ce.scaleY));ie=Oe.scaleX*ze,re=Oe.scaleY*ze}else ie=Math.abs($.x*ce.scaleX/ne.x),re=Math.abs($.y*ce.scaleY/ne.y);B(F)&&(ie*=2,re*=2),F.signX!==oe&&me!=="y"&&(F.originX=m[F.originX],ie*=-1,F.signX=oe),F.signY!==ae&&me!=="x"&&(F.originY=m[F.originY],re*=-1,F.signY=ae)}var Yt=ce.scaleX,Rt=ce.scaleY;return me?(me==="x"&&ce.set("scaleX",ie),me==="y"&&ce.set("scaleY",re)):(!de&&ce.set("scaleX",ie),!ue&&ce.set("scaleY",re)),Yt!==ce.scaleX||Rt!==ce.scaleY}i.scaleCursorStyleHandler=function(P,F,N){var K=R(P,N),H="";if(F.x!==0&&F.y===0?H="x":F.x===0&&F.y!==0&&(H="y"),U(N,H,K))return"not-allowed";var $=I(N,F);return a[$]+"-resize"},i.skewCursorStyleHandler=function(P,F,N){var K="not-allowed";if(F.x!==0&&N.lockSkewingY||F.y!==0&&N.lockSkewingX)return K;var H=I(N,F)%4;return u[H]+"-resize"},i.scaleSkewCursorStyleHandler=function(P,F,N){return P[N.canvas.altActionKey]?i.skewCursorStyleHandler(P,F,N):i.scaleCursorStyleHandler(P,F,N)},i.rotationWithSnapping=O("rotating",Q(function(P,F,N,K){var H=F,$=H.target,ie=$.translateToOriginPoint($.getCenterPoint(),H.originX,H.originY);if($.lockRotation)return!1;var re,ne=Math.atan2(H.ey-ie.y,H.ex-ie.x),oe=Math.atan2(K-ie.y,N-ie.x),ae=b(oe-ne+H.theta);if($.snapAngle>0){var ce=$.snapAngle,de=$.snapThreshold||ce,ue=Math.ceil(ae/ce)*ce,me=Math.floor(ae/ce)*ce;Math.abs(ae-me)<de?ae=me:Math.abs(ae-ue)<de&&(ae=ue)}return ae<0&&(ae=360+ae),ae%=360,re=$.angle!==ae,$.angle=ae,re})),i.scalingEqually=O("scaling",Q(function(P,F,N,K){return G(P,F,N,K)})),i.scalingX=O("scaling",Q(function(P,F,N,K){return G(P,F,N,K,{by:"x"})})),i.scalingY=O("scaling",Q(function(P,F,N,K){return G(P,F,N,K,{by:"y"})})),i.scalingYOrSkewingX=function(P,F,N,K){return P[F.target.canvas.altActionKey]?i.skewHandlerX(P,F,N,K):i.scalingY(P,F,N,K)},i.scalingXOrSkewingY=function(P,F,N,K){return P[F.target.canvas.altActionKey]?i.skewHandlerY(P,F,N,K):i.scalingX(P,F,N,K)},i.changeWidth=O("resizing",Q(function(P,F,N,K){var H=F.target,$=M(F,F.originX,F.originY,N,K),ie=H.strokeWidth/(H.strokeUniform?H.scaleX:1),re=B(F)?2:1,ne=H.width,oe=Math.abs($.x*re/H.scaleX)-ie;return H.set("width",Math.max(oe,0)),ne!==oe})),i.skewHandlerX=function(P,F,N,K){var H,$=F.target,ie=$.skewX,re=F.originY;return!$.lockSkewingX&&(ie===0?H=M(F,f,f,N,K).x>0?n:_:(ie>0&&(H=re===c?n:_),ie<0&&(H=re===c?_:n),D($)&&(H=H===n?_:n)),F.originX=H,O("skewing",Q(k))(P,F,N,K))},i.skewHandlerY=function(P,F,N,K){var H,$=F.target,ie=$.skewY,re=F.originX;return!$.lockSkewingY&&(ie===0?H=M(F,f,f,N,K).y>0?c:d:(ie>0&&(H=re===n?c:d),ie<0&&(H=re===n?d:c),D($)&&(H=H===c?d:c)),F.originY=H,O("skewing",Q(V))(P,F,N,K))},i.dragHandler=function(P,F,N,K){var H=F.target,$=N-F.offsetX,ie=K-F.offsetY,re=!H.get("lockMovementX")&&H.left!==$,ne=!H.get("lockMovementY")&&H.top!==ie;return re&&H.set("left",$),ne&&H.set("top",ie),(re||ne)&&T("moving",X(P,F,N,K)),re||ne},i.scaleOrSkewActionName=function(P,F,N){var K=P[N.canvas.altActionKey];return F.x===0?K?"skewX":"scaleY":F.y===0?K?"skewY":"scaleX":void 0},i.rotationStyleHandler=function(P,F,N){return N.lockRotation?"not-allowed":F.cursorStyle},i.fireEvent=T,i.wrapWithFixedAnchor=Q,i.wrapWithFireEvent=O,i.getLocalPoint=M,s.controlsUtils=i}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.degreesToRadians,u=s.controlsUtils;u.renderCircleControl=function(i,n,c,_,d){_=_||{};var f,m=this.sizeX||_.cornerSize||d.cornerSize,b=this.sizeY||_.cornerSize||d.cornerSize,C=_.transparentCorners!==void 0?_.transparentCorners:d.transparentCorners,I=C?"stroke":"fill",T=!C&&(_.cornerStrokeColor||d.cornerStrokeColor),R=n,B=c;i.save(),i.fillStyle=_.cornerColor||d.cornerColor,i.strokeStyle=_.cornerStrokeColor||d.cornerStrokeColor,m>b?(f=m,i.scale(1,b/m),B=c*m/b):b>m?(f=b,i.scale(m/b,1),R=n*b/m):f=m,i.lineWidth=1,i.beginPath(),i.arc(R,B,f/2,0,2*Math.PI,!1),i[I](),T&&i.stroke(),i.restore()},u.renderSquareControl=function(i,n,c,_,d){_=_||{};var f=this.sizeX||_.cornerSize||d.cornerSize,m=this.sizeY||_.cornerSize||d.cornerSize,b=_.transparentCorners!==void 0?_.transparentCorners:d.transparentCorners,C=b?"stroke":"fill",I=!b&&(_.cornerStrokeColor||d.cornerStrokeColor),T=f/2,R=m/2;i.save(),i.fillStyle=_.cornerColor||d.cornerColor,i.strokeStyle=_.cornerStrokeColor||d.cornerStrokeColor,i.lineWidth=1,i.translate(n,c),i.rotate(a(d.angle)),i[C+"Rect"](-T,-R,f,m),I&&i.strokeRect(-T,-R,f,m),i.restore()}}(e),function(l){var s=l.fabric||(l.fabric={});s.Control=function(a){for(var u in a)this[u]=a[u]},s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(a,u){return u.cursorStyle},getActionName:function(a,u){return u.actionName},getVisibility:function(a,u){var i=a._controlsVisibility;return i&&i[u]!==void 0?i[u]:this.visible},setVisibility:function(a){this.visible=a},positionHandler:function(a,u){return s.util.transformPoint({x:this.x*a.x+this.offsetX,y:this.y*a.y+this.offsetY},u)},calcCornerCoords:function(a,u,i,n,c){var _,d,f,m,b=c?this.touchSizeX:this.sizeX,C=c?this.touchSizeY:this.sizeY;if(b&&C&&b!==C){var I=Math.atan2(C,b),T=Math.sqrt(b*b+C*C)/2,R=I-s.util.degreesToRadians(a),B=Math.PI/2-I-s.util.degreesToRadians(a);_=T*s.util.cos(R),d=T*s.util.sin(R),f=T*s.util.cos(B),m=T*s.util.sin(B)}else T=.7071067812*(b&&C?b:u),R=s.util.degreesToRadians(45-a),_=f=T*s.util.cos(R),d=m=T*s.util.sin(R);return{tl:{x:i-m,y:n-f},tr:{x:i+_,y:n-d},bl:{x:i-_,y:n+d},br:{x:i+m,y:n+f}}},render:function(a,u,i,n,c){((n=n||{}).cornerStyle||c.cornerStyle)==="circle"?s.controlsUtils.renderCircleControl.call(this,a,u,i,n,c):s.controlsUtils.renderSquareControl.call(this,a,u,i,n,c)}}}(e),function(){function l(a,u){var i,n,c,_,d=a.getAttribute("style"),f=a.getAttribute("offset")||0;if(f=(f=parseFloat(f)/(/%$/.test(f)?100:1))<0?0:f>1?1:f,d){var m=d.split(/\s*;\s*/);for(m[m.length-1]===""&&m.pop(),_=m.length;_--;){var b=m[_].split(/\s*:\s*/),C=b[0].trim(),I=b[1].trim();C==="stop-color"?i=I:C==="stop-opacity"&&(c=I)}}return i||(i=a.getAttribute("stop-color")||"rgb(0,0,0)"),c||(c=a.getAttribute("stop-opacity")),n=(i=new y.Color(i)).getAlpha(),c=isNaN(parseFloat(c))?1:parseFloat(c),c*=n*u,{offset:f,color:i.toRgb(),opacity:c}}var s=y.util.object.clone;y.Gradient=y.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(a){a||(a={}),a.coords||(a.coords={});var u,i=this;Object.keys(a).forEach(function(n){i[n]=a[n]}),this.id?this.id+="_"+y.Object.__uid++:this.id=y.Object.__uid++,u={x1:a.coords.x1||0,y1:a.coords.y1||0,x2:a.coords.x2||0,y2:a.coords.y2||0},this.type==="radial"&&(u.r1=a.coords.r1||0,u.r2=a.coords.r2||0),this.coords=u,this.colorStops=a.colorStops.slice()},addColorStop:function(a){for(var u in a){var i=new y.Color(a[u]);this.colorStops.push({offset:parseFloat(u),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(a){var u={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return y.util.populateWithProperties(this,u,a),u},toSVG:function(a,u){var i,n,c,_,d=s(this.coords,!0),f=(u=u||{},s(this.colorStops,!0)),m=d.r1>d.r2,b=this.gradientTransform?this.gradientTransform.concat():y.iMatrix.concat(),C=-this.offsetX,I=-this.offsetY,T=!!u.additionalTransform,R=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(f.sort(function(Q,O){return Q.offset-O.offset}),R==="objectBoundingBox"?(C/=a.width,I/=a.height):(C+=a.width/2,I+=a.height/2),a.type==="path"&&this.gradientUnits!=="percentage"&&(C-=a.pathOffset.x,I-=a.pathOffset.y),b[4]-=C,b[5]-=I,_='id="SVGID_'+this.id+'" gradientUnits="'+R+'"',_+=' gradientTransform="'+(T?u.additionalTransform+" ":"")+y.util.matrixToSVG(b)+'" ',this.type==="linear"?c=["<linearGradient ",_,' x1="',d.x1,'" y1="',d.y1,'" x2="',d.x2,'" y2="',d.y2,`">
`]:this.type==="radial"&&(c=["<radialGradient ",_,' cx="',m?d.x1:d.x2,'" cy="',m?d.y1:d.y2,'" r="',m?d.r1:d.r2,'" fx="',m?d.x2:d.x1,'" fy="',m?d.y2:d.y1,`">
`]),this.type==="radial"){if(m)for((f=f.concat()).reverse(),i=0,n=f.length;i<n;i++)f[i].offset=1-f[i].offset;var B=Math.min(d.r1,d.r2);if(B>0){var U=B/Math.max(d.r1,d.r2);for(i=0,n=f.length;i<n;i++)f[i].offset+=U*(1-f[i].offset)}}for(i=0,n=f.length;i<n;i++){var X=f[i];c.push("<stop ",'offset="',100*X.offset+"%",'" style="stop-color:',X.color,X.opacity!==void 0?";stop-opacity: "+X.opacity:";",`"/>
`)}return c.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),c.join("")},toLive:function(a){var u,i,n,c=y.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?u=a.createLinearGradient(c.x1,c.y1,c.x2,c.y2):this.type==="radial"&&(u=a.createRadialGradient(c.x1,c.y1,c.r1,c.x2,c.y2,c.r2)),i=0,n=this.colorStops.length;i<n;i++){var _=this.colorStops[i].color,d=this.colorStops[i].opacity,f=this.colorStops[i].offset;d!==void 0&&(_=new y.Color(_).setAlpha(d).toRgba()),u.addColorStop(f,_)}return u}}}),y.util.object.extend(y.Gradient,{fromElement:function(a,u,i,n){var c=parseFloat(i)/(/%$/.test(i)?100:1);c=c<0?0:c>1?1:c,isNaN(c)&&(c=1);var _,d,f,m,b=a.getElementsByTagName("stop"),C=a.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",I=a.getAttribute("gradientTransform")||"",T=[],R=0,B=0;for(a.nodeName==="linearGradient"||a.nodeName==="LINEARGRADIENT"?(_="linear",d=function(U){return{x1:U.getAttribute("x1")||0,y1:U.getAttribute("y1")||0,x2:U.getAttribute("x2")||"100%",y2:U.getAttribute("y2")||0}}(a)):(_="radial",d=function(U){return{x1:U.getAttribute("fx")||U.getAttribute("cx")||"50%",y1:U.getAttribute("fy")||U.getAttribute("cy")||"50%",r1:0,x2:U.getAttribute("cx")||"50%",y2:U.getAttribute("cy")||"50%",r2:U.getAttribute("r")||"50%"}}(a)),f=b.length;f--;)T.push(l(b[f],c));return m=y.parseTransformAttribute(I),function(U,X,Q,O){var M,D;Object.keys(X).forEach(function(L){(M=X[L])==="Infinity"?D=1:M==="-Infinity"?D=0:(D=parseFloat(X[L],10),typeof M=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(M)&&(D*=.01,O==="pixels"&&(L!=="x1"&&L!=="x2"&&L!=="r2"||(D*=Q.viewBoxWidth||Q.width),L!=="y1"&&L!=="y2"||(D*=Q.viewBoxHeight||Q.height)))),X[L]=D})}(0,d,n,C),C==="pixels"&&(R=-u.left,B=-u.top),new y.Gradient({id:a.getAttribute("id"),type:_,coords:d,colorStops:T,gradientUnits:C,gradientTransform:m,offsetX:R,offsetY:B})}})}(),te=y.util.toFixed,y.Pattern=y.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(l,s){if(l||(l={}),this.id=y.Object.__uid++,this.setOptions(l),!l.source||l.source&&typeof l.source!="string")s&&s(this);else{var a=this;this.source=y.util.createImage(),y.util.loadImage(l.source,function(u,i){a.source=u,s&&s(a,i)},null,this.crossOrigin)}},toObject:function(l){var s,a,u=y.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?s=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(s=this.source.toDataURL()),a={type:"pattern",source:s,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:te(this.offsetX,u),offsetY:te(this.offsetY,u),patternTransform:this.patternTransform?this.patternTransform.concat():null},y.util.populateWithProperties(this,a,l),a},toSVG:function(l){var s=typeof this.source=="function"?this.source():this.source,a=s.width/l.width,u=s.height/l.height,i=this.offsetX/l.width,n=this.offsetY/l.height,c="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(u=1,n&&(u+=Math.abs(n))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(a=1,i&&(a+=Math.abs(i))),s.src?c=s.src:s.toDataURL&&(c=s.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+i+'" y="'+n+'" width="'+a+'" height="'+u+`">
<image x="0" y="0" width="`+s.width+'" height="'+s.height+'" xlink:href="'+c+`"></image>
</pattern>
`},setOptions:function(l){for(var s in l)this[s]=l[s]},toLive:function(l){var s=this.source;return!s||s.src!==void 0&&(!s.complete||s.naturalWidth===0||s.naturalHeight===0)?"":l.createPattern(s,this.repeat)}}),function(l){var s=l.fabric||(l.fabric={}),a=s.util.toFixed;s.Shadow?s.warn("fabric.Shadow is already defined."):(s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(u){for(var i in typeof u=="string"&&(u=this._parseShadow(u)),u)this[i]=u[i];this.id=s.Object.__uid++},_parseShadow:function(u){var i=u.trim(),n=s.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(n[1],10)||0,offsetY:parseFloat(n[2],10)||0,blur:parseFloat(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(u){var i=40,n=40,c=s.Object.NUM_FRACTION_DIGITS,_=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-u.angle)),d=new s.Color(this.color);return u.width&&u.height&&(i=100*a((Math.abs(_.x)+this.blur)/u.width,c)+20,n=100*a((Math.abs(_.y)+this.blur)/u.height,c)+20),u.flipX&&(_.x*=-1),u.flipY&&(_.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+n+'%" height="'+(100+2*n)+'%" x="-'+i+'%" width="'+(100+2*i)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+a(this.blur?this.blur/2:0,c)+`"></feGaussianBlur>
	<feOffset dx="`+a(_.x,c)+'" dy="'+a(_.y,c)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+d.toRgb()+'" flood-opacity="'+d.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var u={},i=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(n){this[n]!==i[n]&&(u[n]=this[n])},this),u}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(y.StaticCanvas)y.warn("fabric.StaticCanvas is already defined.");else{var l=y.util.object.extend,s=y.util.getElementOffset,a=y.util.removeFromArray,u=y.util.toFixed,i=y.util.transformPoint,n=y.util.invertTransform,c=y.util.getNodeCanvas,_=y.util.createCanvasElement,d=new Error("Could not initialize `canvas` element");y.StaticCanvas=y.util.createClass(y.CommonMethods,{initialize:function(f,m){m||(m={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(f,m)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:y.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(f,m){var b=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(f),this._initOptions(m),this.interactive||this._initRetinaScaling(),m.overlayImage&&this.setOverlayImage(m.overlayImage,b),m.backgroundImage&&this.setBackgroundImage(m.backgroundImage,b),m.backgroundColor&&this.setBackgroundColor(m.backgroundColor,b),m.overlayColor&&this.setOverlayColor(m.overlayColor,b),this.calcOffset()},_isRetinaScaling:function(){return y.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,y.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var f=y.devicePixelRatio;this.__initRetinaScaling(f,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(f,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(f,m,b){m.setAttribute("width",this.width*f),m.setAttribute("height",this.height*f),b.scale(f,f)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(f,m,b){return this.__setBgOverlayImage("overlayImage",f,m,b)},setBackgroundImage:function(f,m,b){return this.__setBgOverlayImage("backgroundImage",f,m,b)},setOverlayColor:function(f,m){return this.__setBgOverlayColor("overlayColor",f,m)},setBackgroundColor:function(f,m){return this.__setBgOverlayColor("backgroundColor",f,m)},__setBgOverlayImage:function(f,m,b,C){return typeof m=="string"?y.util.loadImage(m,function(I,T){if(I){var R=new y.Image(I,C);this[f]=R,R.canvas=this}b&&b(I,T)},this,C&&C.crossOrigin):(C&&m.setOptions(C),this[f]=m,m&&(m.canvas=this),b&&b(m,!1)),this},__setBgOverlayColor:function(f,m,b){return this[f]=m,this._initGradient(m,f),this._initPattern(m,f,b),this},_createCanvasElement:function(){var f=_();if(!f||(f.style||(f.style={}),f.getContext===void 0))throw d;return f},_initOptions:function(f){var m=this.lowerCanvasEl;this._setOptions(f),this.width=this.width||parseInt(m.width,10)||0,this.height=this.height||parseInt(m.height,10)||0,this.lowerCanvasEl.style&&(m.width=this.width,m.height=this.height,m.style.width=this.width+"px",m.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(f){f&&f.getContext?this.lowerCanvasEl=f:this.lowerCanvasEl=y.util.getById(f)||this._createCanvasElement(),y.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(f,m){return this.setDimensions({width:f},m)},setHeight:function(f,m){return this.setDimensions({height:f},m)},setDimensions:function(f,m){var b;for(var C in m=m||{},f)b=f[C],m.cssOnly||(this._setBackstoreDimension(C,f[C]),b+="px",this.hasLostContext=!0),m.backstoreOnly||this._setCssDimension(C,b);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),m.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(f,m){return this.lowerCanvasEl[f]=m,this.upperCanvasEl&&(this.upperCanvasEl[f]=m),this.cacheCanvasEl&&(this.cacheCanvasEl[f]=m),this[f]=m,this},_setCssDimension:function(f,m){return this.lowerCanvasEl.style[f]=m,this.upperCanvasEl&&(this.upperCanvasEl.style[f]=m),this.wrapperEl&&(this.wrapperEl.style[f]=m),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(f){var m,b,C,I=this._activeObject,T=this.backgroundImage,R=this.overlayImage;for(this.viewportTransform=f,b=0,C=this._objects.length;b<C;b++)(m=this._objects[b]).group||m.setCoords(!0);return I&&I.setCoords(),T&&T.setCoords(!0),R&&R.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(f,m){var b=f,C=this.viewportTransform.slice(0);f=i(f,n(this.viewportTransform)),C[0]=m,C[3]=m;var I=i(f,C);return C[4]+=b.x-I.x,C[5]+=b.y-I.y,this.setViewportTransform(C)},setZoom:function(f){return this.zoomToPoint(new y.Point(0,0),f),this},absolutePan:function(f){var m=this.viewportTransform.slice(0);return m[4]=-f.x,m[5]=-f.y,this.setViewportTransform(m)},relativePan:function(f){return this.absolutePan(new y.Point(-f.x-this.viewportTransform[4],-f.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(f){this.stateful&&f.setupState(),f._set("canvas",this),f.setCoords(),this.fire("object:added",{target:f}),f.fire("added")},_onObjectRemoved:function(f){this.fire("object:removed",{target:f}),f.fire("removed"),delete f.canvas},clearContext:function(f){return f.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var f=this.contextContainer;return this.renderCanvas(f,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=y.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var f={},m=this.width,b=this.height,C=n(this.viewportTransform);return f.tl=i({x:0,y:0},C),f.br=i({x:m,y:b},C),f.tr=new y.Point(f.br.x,f.tl.y),f.bl=new y.Point(f.tl.x,f.br.y),this.vptCoords=f,f},cancelRequestedRender:function(){this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(f,m){var b=this.viewportTransform,C=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(f),y.util.setImageSmoothing(f,this.imageSmoothingEnabled),this.fire("before:render",{ctx:f}),this._renderBackground(f),f.save(),f.transform(b[0],b[1],b[2],b[3],b[4],b[5]),this._renderObjects(f,m),f.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),C&&(C.canvas=this,C.shouldCache(),C._transformDone=!0,C.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(f)),this._renderOverlay(f),this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),this.fire("after:render",{ctx:f})},drawClipPathOnCanvas:function(f){var m=this.viewportTransform,b=this.clipPath;f.save(),f.transform(m[0],m[1],m[2],m[3],m[4],m[5]),f.globalCompositeOperation="destination-in",b.transform(f),f.scale(1/b.zoomX,1/b.zoomY),f.drawImage(b._cacheCanvas,-b.cacheTranslationX,-b.cacheTranslationY),f.restore()},_renderObjects:function(f,m){var b,C;for(b=0,C=m.length;b<C;++b)m[b]&&m[b].render(f)},_renderBackgroundOrOverlay:function(f,m){var b=this[m+"Color"],C=this[m+"Image"],I=this.viewportTransform,T=this[m+"Vpt"];if(b||C){if(b){f.save(),f.beginPath(),f.moveTo(0,0),f.lineTo(this.width,0),f.lineTo(this.width,this.height),f.lineTo(0,this.height),f.closePath(),f.fillStyle=b.toLive?b.toLive(f,this):b,T&&f.transform(I[0],I[1],I[2],I[3],I[4],I[5]),f.transform(1,0,0,1,b.offsetX||0,b.offsetY||0);var R=b.gradientTransform||b.patternTransform;R&&f.transform(R[0],R[1],R[2],R[3],R[4],R[5]),f.fill(),f.restore()}C&&(f.save(),T&&f.transform(I[0],I[1],I[2],I[3],I[4],I[5]),C.render(f),f.restore())}},_renderBackground:function(f){this._renderBackgroundOrOverlay(f,"background")},_renderOverlay:function(f){this._renderBackgroundOrOverlay(f,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new y.Point(this.width/2,this.height/2)},centerObjectH:function(f){return this._centerObject(f,new y.Point(this.getCenterPoint().x,f.getCenterPoint().y))},centerObjectV:function(f){return this._centerObject(f,new y.Point(f.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(f){var m=this.getCenterPoint();return this._centerObject(f,m)},viewportCenterObject:function(f){var m=this.getVpCenter();return this._centerObject(f,m)},viewportCenterObjectH:function(f){var m=this.getVpCenter();return this._centerObject(f,new y.Point(m.x,f.getCenterPoint().y)),this},viewportCenterObjectV:function(f){var m=this.getVpCenter();return this._centerObject(f,new y.Point(f.getCenterPoint().x,m.y))},getVpCenter:function(){var f=this.getCenterPoint(),m=n(this.viewportTransform);return i(f,m)},_centerObject:function(f,m){return f.setPositionByOrigin(m,"center","center"),f.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(f){return this.toDatalessObject(f)},toObject:function(f){return this._toObjectMethod("toObject",f)},toDatalessObject:function(f){return this._toObjectMethod("toDatalessObject",f)},_toObjectMethod:function(f,m){var b=this.clipPath,C={version:y.version,objects:this._toObjects(f,m)};return b&&!b.excludeFromExport&&(C.clipPath=this._toObject(this.clipPath,f,m)),l(C,this.__serializeBgOverlay(f,m)),y.util.populateWithProperties(this,C,m),C},_toObjects:function(f,m){return this._objects.filter(function(b){return!b.excludeFromExport}).map(function(b){return this._toObject(b,f,m)},this)},_toObject:function(f,m,b){var C;this.includeDefaultValues||(C=f.includeDefaultValues,f.includeDefaultValues=!1);var I=f[m](b);return this.includeDefaultValues||(f.includeDefaultValues=C),I},__serializeBgOverlay:function(f,m){var b={},C=this.backgroundImage,I=this.overlayImage,T=this.backgroundColor,R=this.overlayColor;return T&&T.toObject?T.excludeFromExport||(b.background=T.toObject(m)):T&&(b.background=T),R&&R.toObject?R.excludeFromExport||(b.overlay=R.toObject(m)):R&&(b.overlay=R),C&&!C.excludeFromExport&&(b.backgroundImage=this._toObject(C,f,m)),I&&!I.excludeFromExport&&(b.overlayImage=this._toObject(I,f,m)),b},svgViewportTransformation:!0,toSVG:function(f,m){f||(f={}),f.reviver=m;var b=[];return this._setSVGPreamble(b,f),this._setSVGHeader(b,f),this.clipPath&&b.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(b,"background"),this._setSVGBgOverlayImage(b,"backgroundImage",m),this._setSVGObjects(b,m),this.clipPath&&b.push(`</g>
`),this._setSVGBgOverlayColor(b,"overlay"),this._setSVGBgOverlayImage(b,"overlayImage",m),b.push("</svg>"),b.join("")},_setSVGPreamble:function(f,m){m.suppressPreamble||f.push('<?xml version="1.0" encoding="',m.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(f,m){var b,C=m.width||this.width,I=m.height||this.height,T='viewBox="0 0 '+this.width+" "+this.height+'" ',R=y.Object.NUM_FRACTION_DIGITS;m.viewBox?T='viewBox="'+m.viewBox.x+" "+m.viewBox.y+" "+m.viewBox.width+" "+m.viewBox.height+'" ':this.svgViewportTransformation&&(b=this.viewportTransform,T='viewBox="'+u(-b[4]/b[0],R)+" "+u(-b[5]/b[3],R)+" "+u(this.width/b[0],R)+" "+u(this.height/b[3],R)+'" '),f.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',C,'" ','height="',I,'" ',T,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",y.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(m),`</defs>
`)},createSVGClipPathMarkup:function(f){var m=this.clipPath;return m?(m.clipPathId="CLIPPATH_"+y.Object.__uid++,'<clipPath id="'+m.clipPathId+`" >
`+this.clipPath.toClipPathSVG(f.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var f=this;return["background","overlay"].map(function(m){var b=f[m+"Color"];if(b&&b.toLive){var C=f[m+"Vpt"],I=f.viewportTransform,T={width:f.width/(C?I[0]:1),height:f.height/(C?I[3]:1)};return b.toSVG(T,{additionalTransform:C?y.util.matrixToSVG(I):""})}}).join("")},createSVGFontFacesMarkup:function(){var f,m,b,C,I,T,R,B,U="",X={},Q=y.fontPaths,O=[];for(this._objects.forEach(function D(L){O.push(L),L._objects&&L._objects.forEach(D)}),R=0,B=O.length;R<B;R++)if(m=(f=O[R]).fontFamily,f.type.indexOf("text")!==-1&&!X[m]&&Q[m]&&(X[m]=!0,f.styles))for(I in b=f.styles)for(T in C=b[I])!X[m=C[T].fontFamily]&&Q[m]&&(X[m]=!0);for(var M in X)U+=[`		@font-face {
`,"			font-family: '",M,`';
`,"			src: url('",Q[M],`');
`,`		}
`].join("");return U&&(U=['	<style type="text/css">',`<![CDATA[
`,U,"]]>",`</style>
`].join("")),U},_setSVGObjects:function(f,m){var b,C,I,T=this._objects;for(C=0,I=T.length;C<I;C++)(b=T[C]).excludeFromExport||this._setSVGObject(f,b,m)},_setSVGObject:function(f,m,b){f.push(m.toSVG(b))},_setSVGBgOverlayImage:function(f,m,b){this[m]&&!this[m].excludeFromExport&&this[m].toSVG&&f.push(this[m].toSVG(b))},_setSVGBgOverlayColor:function(f,m){var b=this[m+"Color"],C=this.viewportTransform,I=this.width,T=this.height;if(b)if(b.toLive){var R=b.repeat,B=y.util.invertTransform(C),U=this[m+"Vpt"]?y.util.matrixToSVG(B):"";f.push('<rect transform="'+U+" translate(",I/2,",",T/2,')"',' x="',b.offsetX-I/2,'" y="',b.offsetY-T/2,'" ','width="',R==="repeat-y"||R==="no-repeat"?b.source.width:I,'" height="',R==="repeat-x"||R==="no-repeat"?b.source.height:T,'" fill="url(#SVGID_'+b.id+')"',`></rect>
`)}else f.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',b,'"',`></rect>
`)},sendToBack:function(f){if(!f)return this;var m,b,C,I=this._activeObject;if(f===I&&f.type==="activeSelection")for(m=(C=I._objects).length;m--;)b=C[m],a(this._objects,b),this._objects.unshift(b);else a(this._objects,f),this._objects.unshift(f);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(f){if(!f)return this;var m,b,C,I=this._activeObject;if(f===I&&f.type==="activeSelection")for(C=I._objects,m=0;m<C.length;m++)b=C[m],a(this._objects,b),this._objects.push(b);else a(this._objects,f),this._objects.push(f);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(f,m){if(!f)return this;var b,C,I,T,R,B=this._activeObject,U=0;if(f===B&&f.type==="activeSelection")for(R=B._objects,b=0;b<R.length;b++)C=R[b],(I=this._objects.indexOf(C))>0+U&&(T=I-1,a(this._objects,C),this._objects.splice(T,0,C)),U++;else(I=this._objects.indexOf(f))!==0&&(T=this._findNewLowerIndex(f,I,m),a(this._objects,f),this._objects.splice(T,0,f));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(f,m,b){var C,I;if(b){for(C=m,I=m-1;I>=0;--I)if(f.intersectsWithObject(this._objects[I])||f.isContainedWithinObject(this._objects[I])||this._objects[I].isContainedWithinObject(f)){C=I;break}}else C=m-1;return C},bringForward:function(f,m){if(!f)return this;var b,C,I,T,R,B=this._activeObject,U=0;if(f===B&&f.type==="activeSelection")for(b=(R=B._objects).length;b--;)C=R[b],(I=this._objects.indexOf(C))<this._objects.length-1-U&&(T=I+1,a(this._objects,C),this._objects.splice(T,0,C)),U++;else(I=this._objects.indexOf(f))!==this._objects.length-1&&(T=this._findNewUpperIndex(f,I,m),a(this._objects,f),this._objects.splice(T,0,f));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(f,m,b){var C,I,T;if(b){for(C=m,I=m+1,T=this._objects.length;I<T;++I)if(f.intersectsWithObject(this._objects[I])||f.isContainedWithinObject(this._objects[I])||this._objects[I].isContainedWithinObject(f)){C=I;break}}else C=m+1;return C},moveTo:function(f,m){return a(this._objects,f),this._objects.splice(m,0,f),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(f){f.dispose&&f.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),y.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),y.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),l(y.StaticCanvas.prototype,y.Observable),l(y.StaticCanvas.prototype,y.Collection),l(y.StaticCanvas.prototype,y.DataURLExporter),l(y.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(f){var m=_();if(!m||!m.getContext)return null;var b=m.getContext("2d");return b&&f==="setLineDash"?b.setLineDash!==void 0:null}}),y.StaticCanvas.prototype.toJSON=y.StaticCanvas.prototype.toObject,y.isLikelyNode&&(y.StaticCanvas.prototype.createPNGStream=function(){var f=c(this.lowerCanvasEl);return f&&f.createPNGStream()},y.StaticCanvas.prototype.createJPEGStream=function(f){var m=c(this.lowerCanvasEl);return m&&m.createJPEGStream(f)})}}(),y.BaseBrush=y.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(l){l.strokeStyle=this.color,l.lineWidth=this.width,l.lineCap=this.strokeLineCap,l.miterLimit=this.strokeMiterLimit,l.lineJoin=this.strokeLineJoin,l.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(l){var s=this.canvas.viewportTransform;l.save(),l.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var l=this.canvas,s=this.shadow,a=l.contextTop,u=l.getZoom();l&&l._isRetinaScaling()&&(u*=y.devicePixelRatio),a.shadowColor=s.color,a.shadowBlur=s.blur*u,a.shadowOffsetX=s.offsetX*u,a.shadowOffsetY=s.offsetY*u}},needsFullRender:function(){return new y.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var l=this.canvas.contextTop;l.shadowColor="",l.shadowBlur=l.shadowOffsetX=l.shadowOffsetY=0},_isOutSideCanvas:function(l){return l.x<0||l.x>this.canvas.getWidth()||l.y<0||l.y>this.canvas.getHeight()}}),y.PencilBrush=y.util.createClass(y.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(l){this.canvas=l,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(l,s,a){var u=s.midPointFrom(a);return l.quadraticCurveTo(s.x,s.y,u.x,u.y),u},onMouseDown:function(l,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(l),this._captureDrawingPath(l),this._render())},onMouseMove:function(l,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(l))&&this._captureDrawingPath(l)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var a=this._points,u=a.length,i=this.canvas.contextTop;this._saveAndTransform(i),this.oldEnd&&(i.beginPath(),i.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(i,a[u-2],a[u-1],!0),i.stroke(),i.restore()}},onMouseUp:function(l){return!this.canvas._isMainEvent(l.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(l){var s=new y.Point(l.x,l.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(l){return!(this._points.length>1&&l.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(l),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(l){var s=new y.Point(l.x,l.y);return this._addPoint(s)},_render:function(l){var s,a,u=this._points[0],i=this._points[1];if(l=l||this.canvas.contextTop,this._saveAndTransform(l),l.beginPath(),this._points.length===2&&u.x===i.x&&u.y===i.y){var n=this.width/1e3;u=new y.Point(u.x,u.y),i=new y.Point(i.x,i.y),u.x-=n,i.x+=n}for(l.moveTo(u.x,u.y),s=1,a=this._points.length;s<a;s++)this._drawSegment(l,u,i),u=this._points[s],i=this._points[s+1];l.lineTo(u.x,u.y),l.stroke(),l.restore()},convertPointsToSVGPath:function(l){var s=this.width/1e3;return y.util.getSmoothPathFromPoints(l,s)},_isEmptySVGPath:function(l){return y.util.joinPath(l)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(l){var s=new y.Path(l,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new y.Shadow(this.shadow)),s},decimatePoints:function(l,s){if(l.length<=2)return l;var a,u=this.canvas.getZoom(),i=Math.pow(s/u,2),n=l.length-1,c=l[0],_=[c];for(a=1;a<n-1;a++)Math.pow(c.x-l[a].x,2)+Math.pow(c.y-l[a].y,2)>=i&&(c=l[a],_.push(c));return _.push(l[n]),_},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var l=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(l))this.canvas.requestRenderAll();else{var s=this.createPath(l);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:s}),this.canvas.add(s),this.canvas.requestRenderAll(),s.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:s})}}}),y.CircleBrush=y.util.createClass(y.BaseBrush,{width:10,initialize:function(l){this.canvas=l,this.points=[]},drawDot:function(l){var s=this.addPoint(l),a=this.canvas.contextTop;this._saveAndTransform(a),this.dot(a,s),a.restore()},dot:function(l,s){l.fillStyle=s.fill,l.beginPath(),l.arc(s.x,s.y,s.radius,0,2*Math.PI,!1),l.closePath(),l.fill()},onMouseDown:function(l){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(l)},_render:function(){var l,s,a=this.canvas.contextTop,u=this.points;for(this._saveAndTransform(a),l=0,s=u.length;l<s;l++)this.dot(a,u[l]);a.restore()},onMouseMove:function(l){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(l)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(l),this._render()):this.drawDot(l))},onMouseUp:function(){var l,s,a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var u=[];for(l=0,s=this.points.length;l<s;l++){var i=this.points[l],n=new y.Circle({radius:i.radius,left:i.x,top:i.y,originX:"center",originY:"center",fill:i.fill});this.shadow&&(n.shadow=new y.Shadow(this.shadow)),u.push(n)}var c=new y.Group(u);c.canvas=this.canvas,this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},addPoint:function(l){var s=new y.Point(l.x,l.y),a=y.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,u=new y.Color(this.color).setAlpha(y.util.getRandomInt(0,100)/100).toRgba();return s.radius=a,s.fill=u,this.points.push(s),s}}),y.SprayBrush=y.util.createClass(y.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(l){this.canvas=l,this.sprayChunks=[]},onMouseDown:function(l){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(l),this.render(this.sprayChunkPoints)},onMouseMove:function(l){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(l)||(this.addSprayChunk(l),this.render(this.sprayChunkPoints))},onMouseUp:function(){var l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],a=0,u=this.sprayChunks.length;a<u;a++)for(var i=this.sprayChunks[a],n=0,c=i.length;n<c;n++){var _=new y.Rect({width:i[n].width,height:i[n].width,left:i[n].x+1,top:i[n].y+1,originX:"center",originY:"center",fill:this.color});s.push(_)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var d=new y.Group(s);this.shadow&&d.set("shadow",new y.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:d}),this.canvas.add(d),this.canvas.fire("path:created",{path:d}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=l,this.canvas.requestRenderAll()},_getOptimizedRects:function(l){var s,a,u,i={};for(a=0,u=l.length;a<u;a++)i[s=l[a].left+""+l[a].top]||(i[s]=l[a]);var n=[];for(s in i)n.push(i[s]);return n},render:function(l){var s,a,u=this.canvas.contextTop;for(u.fillStyle=this.color,this._saveAndTransform(u),s=0,a=l.length;s<a;s++){var i=l[s];i.opacity!==void 0&&(u.globalAlpha=i.opacity),u.fillRect(i.x,i.y,i.width,i.width)}u.restore()},_render:function(){var l,s,a=this.canvas.contextTop;for(a.fillStyle=this.color,this._saveAndTransform(a),l=0,s=this.sprayChunks.length;l<s;l++)this.render(this.sprayChunks[l]);a.restore()},addSprayChunk:function(l){this.sprayChunkPoints=[];var s,a,u,i,n=this.width/2;for(i=0;i<this.density;i++){s=y.util.getRandomInt(l.x-n,l.x+n),a=y.util.getRandomInt(l.y-n,l.y+n),u=this.dotWidthVariance?y.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var c=new y.Point(s,a);c.width=u,this.randomOpacity&&(c.opacity=y.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c)}this.sprayChunks.push(this.sprayChunkPoints)}}),y.PatternBrush=y.util.createClass(y.PencilBrush,{getPatternSrc:function(){var l=y.util.createCanvasElement(),s=l.getContext("2d");return l.width=l.height=25,s.fillStyle=this.color,s.beginPath(),s.arc(10,10,10,0,2*Math.PI,!1),s.closePath(),s.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(l){return l.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(l){this.callSuper("_setBrushStyles",l),l.strokeStyle=this.getPattern(l)},createPath:function(l){var s=this.callSuper("createPath",l),a=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new y.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-a.x,offsetY:-a.y}),s}}),function(){var l=y.util.getPointer,s=y.util.degreesToRadians,a=y.util.isTouchEvent;for(var u in y.Canvas=y.util.createClass(y.StaticCanvas,{initialize:function(i,n){n||(n={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(i,n),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=y.PencilBrush&&new y.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var i,n,c,_=this.getActiveObjects();if(_.length>0&&!this.preserveObjectStacking){n=[],c=[];for(var d=0,f=this._objects.length;d<f;d++)i=this._objects[d],_.indexOf(i)===-1?n.push(i):c.push(i);_.length>1&&(this._activeObject._objects=c),n.push.apply(n,c)}else n=this._objects;return n},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var i=this.contextContainer;return this.renderCanvas(i,this._chooseObjectsToRender()),this},renderTopLayer:function(i){i.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(i),this.contextTopDirty=!0),i.restore()},renderTop:function(){var i=this.contextTop;return this.clearContext(i),this.renderTopLayer(i),this.fire("after:render"),this},_normalizePointer:function(i,n){var c=i.calcTransformMatrix(),_=y.util.invertTransform(c),d=this.restorePointerVpt(n);return y.util.transformPoint(d,_)},isTargetTransparent:function(i,n,c){if(i.shouldCache()&&i._cacheCanvas&&i!==this._activeObject){var _=this._normalizePointer(i,{x:n,y:c}),d=Math.max(i.cacheTranslationX+_.x*i.zoomX,0),f=Math.max(i.cacheTranslationY+_.y*i.zoomY,0);return y.util.isTransparent(i._cacheContext,Math.round(d),Math.round(f),this.targetFindTolerance)}var m=this.contextCache,b=i.selectionBackgroundColor,C=this.viewportTransform;return i.selectionBackgroundColor="",this.clearContext(m),m.save(),m.transform(C[0],C[1],C[2],C[3],C[4],C[5]),i.render(m),m.restore(),i.selectionBackgroundColor=b,y.util.isTransparent(m,n,c,this.targetFindTolerance)},_isSelectionKeyPressed:function(i){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(n){return i[n]===!0}):i[this.selectionKey]},_shouldClearSelection:function(i,n){var c=this.getActiveObjects(),_=this._activeObject;return!n||n&&_&&c.length>1&&c.indexOf(n)===-1&&_!==n&&!this._isSelectionKeyPressed(i)||n&&!n.evented||n&&!n.selectable&&_&&_!==n},_shouldCenterTransform:function(i,n,c){var _;if(i)return n==="scale"||n==="scaleX"||n==="scaleY"||n==="resizing"?_=this.centeredScaling||i.centeredScaling:n==="rotate"&&(_=this.centeredRotation||i.centeredRotation),_?!c:c},_getOriginFromCorner:function(i,n){var c={x:i.originX,y:i.originY};return n==="ml"||n==="tl"||n==="bl"?c.x="right":n!=="mr"&&n!=="tr"&&n!=="br"||(c.x="left"),n==="tl"||n==="mt"||n==="tr"?c.y="bottom":n!=="bl"&&n!=="mb"&&n!=="br"||(c.y="top"),c},_getActionFromCorner:function(i,n,c,_){if(!n||!i)return"drag";var d=_.controls[n];return d.getActionName(c,d,_)},_setupCurrentTransform:function(i,n,c){if(n){var _=this.getPointer(i),d=n.__corner,f=n.controls[d],m=c&&d?f.getActionHandler(i,n,f):y.controlsUtils.dragHandler,b=this._getActionFromCorner(c,d,i,n),C=this._getOriginFromCorner(n,d),I=i[this.centeredKey],T={target:n,action:b,actionHandler:m,corner:d,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,offsetX:_.x-n.left,offsetY:_.y-n.top,originX:C.x,originY:C.y,ex:_.x,ey:_.y,lastX:_.x,lastY:_.y,theta:s(n.angle),width:n.width*n.scaleX,shiftKey:i.shiftKey,altKey:I,original:y.util.saveObjectTransform(n)};this._shouldCenterTransform(n,b,I)&&(T.originX="center",T.originY="center"),T.original.originX=C.x,T.original.originY=C.y,this._currentTransform=T,this._beforeTransform(i)}},setCursor:function(i){this.upperCanvasEl.style.cursor=i},_drawSelection:function(i){var n=this._groupSelector,c=new y.Point(n.ex,n.ey),_=y.util.transformPoint(c,this.viewportTransform),d=new y.Point(n.ex+n.left,n.ey+n.top),f=y.util.transformPoint(d,this.viewportTransform),m=Math.min(_.x,f.x),b=Math.min(_.y,f.y),C=Math.max(_.x,f.x),I=Math.max(_.y,f.y),T=this.selectionLineWidth/2;this.selectionColor&&(i.fillStyle=this.selectionColor,i.fillRect(m,b,C-m,I-b)),this.selectionLineWidth&&this.selectionBorderColor&&(i.lineWidth=this.selectionLineWidth,i.strokeStyle=this.selectionBorderColor,m+=T,b+=T,C-=T,I-=T,y.Object.prototype._setLineDash.call(this,i,this.selectionDashArray),i.strokeRect(m,b,C-m,I-b))},findTarget:function(i,n){if(!this.skipTargetFind){var c,_,d=this.getPointer(i,!0),f=this._activeObject,m=this.getActiveObjects(),b=a(i),C=m.length>1&&!n||m.length===1;if(this.targets=[],C&&f._findTargetCorner(d,b)||m.length>1&&!n&&f===this._searchPossibleTargets([f],d))return f;if(m.length===1&&f===this._searchPossibleTargets([f],d)){if(!this.preserveObjectStacking)return f;c=f,_=this.targets,this.targets=[]}var I=this._searchPossibleTargets(this._objects,d);return i[this.altSelectionKey]&&I&&c&&I!==c&&(I=c,this.targets=_),I}},_checkTarget:function(i,n,c){if(n&&n.visible&&n.evented&&n.containsPoint(i)&&(!this.perPixelTargetFind&&!n.perPixelTargetFind||n.isEditing||!this.isTargetTransparent(n,c.x,c.y)))return!0},_searchPossibleTargets:function(i,n){for(var c,_,d=i.length;d--;){var f=i[d],m=f.group?this._normalizePointer(f.group,n):n;if(this._checkTarget(m,f,n)){(c=i[d]).subTargetCheck&&c instanceof y.Group&&(_=this._searchPossibleTargets(c._objects,n))&&this.targets.push(_);break}}return c},restorePointerVpt:function(i){return y.util.transformPoint(i,y.util.invertTransform(this.viewportTransform))},getPointer:function(i,n){if(this._absolutePointer&&!n)return this._absolutePointer;if(this._pointer&&n)return this._pointer;var c,_=l(i),d=this.upperCanvasEl,f=d.getBoundingClientRect(),m=f.width||0,b=f.height||0;m&&b||("top"in f&&"bottom"in f&&(b=Math.abs(f.top-f.bottom)),"right"in f&&"left"in f&&(m=Math.abs(f.right-f.left))),this.calcOffset(),_.x=_.x-this._offset.left,_.y=_.y-this._offset.top,n||(_=this.restorePointerVpt(_));var C=this.getRetinaScaling();return C!==1&&(_.x/=C,_.y/=C),c=m===0||b===0?{width:1,height:1}:{width:d.width/m,height:d.height/b},{x:_.x*c.width,y:_.y*c.height}},_createUpperCanvas:function(){var i=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),n=this.lowerCanvasEl,c=this.upperCanvasEl;c?c.className="":(c=this._createCanvasElement(),this.upperCanvasEl=c),y.util.addClass(c,"upper-canvas "+i),this.wrapperEl.appendChild(c),this._copyCanvasStyle(n,c),this._applyCanvasStyle(c),this.contextTop=c.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=y.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),y.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),y.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(i){var n=this.width||i.width,c=this.height||i.height;y.util.setStyle(i,{position:"absolute",width:n+"px",height:c+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),i.width=n,i.height=c,y.util.makeElementUnselectable(i)},_copyCanvasStyle:function(i,n){n.style.cssText=i.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var i=this._activeObject;return i?i.type==="activeSelection"&&i._objects?i._objects.slice(0):[i]:[]},_onObjectRemoved:function(i){i===this._activeObject&&(this.fire("before:selection:cleared",{target:i}),this._discardActiveObject(),this.fire("selection:cleared",{target:i}),i.fire("deselected")),i===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",i)},_fireSelectionEvents:function(i,n){var c=!1,_=this.getActiveObjects(),d=[],f=[];i.forEach(function(m){_.indexOf(m)===-1&&(c=!0,m.fire("deselected",{e:n,target:m}),f.push(m))}),_.forEach(function(m){i.indexOf(m)===-1&&(c=!0,m.fire("selected",{e:n,target:m}),d.push(m))}),i.length>0&&_.length>0?c&&this.fire("selection:updated",{e:n,selected:d,deselected:f}):_.length>0?this.fire("selection:created",{e:n,selected:d}):i.length>0&&this.fire("selection:cleared",{e:n,deselected:f})},setActiveObject:function(i,n){var c=this.getActiveObjects();return this._setActiveObject(i,n),this._fireSelectionEvents(c,n),this},_setActiveObject:function(i,n){return this._activeObject!==i&&!!this._discardActiveObject(n,i)&&!i.onSelect({e:n})&&(this._activeObject=i,!0)},_discardActiveObject:function(i,n){var c=this._activeObject;if(c){if(c.onDeselect({e:i,object:n}))return!1;this._activeObject=null}return!0},discardActiveObject:function(i){var n=this.getActiveObjects(),c=this.getActiveObject();return n.length&&this.fire("before:selection:cleared",{target:c,e:i}),this._discardActiveObject(i),this._fireSelectionEvents(n,i),this},dispose:function(){var i=this.wrapperEl;return this.removeListeners(),i.removeChild(this.upperCanvasEl),i.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(n){y.util.cleanUpJsdomNode(this[n]),this[n]=void 0}).bind(this)),i.parentNode&&i.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,y.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(i){var n=this._activeObject;n&&n._renderControls(i)},_toObject:function(i,n,c){var _=this._realizeGroupTransformOnObject(i),d=this.callSuper("_toObject",i,n,c);return this._unwindGroupTransformOnObject(i,_),d},_realizeGroupTransformOnObject:function(i){if(i.group&&i.group.type==="activeSelection"&&this._activeObject===i.group){var n={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(c){n[c]=i[c]}),y.util.addTransformToObject(i,this._activeObject.calcOwnMatrix()),n}return null},_unwindGroupTransformOnObject:function(i,n){n&&i.set(n)},_setSVGObject:function(i,n,c){var _=this._realizeGroupTransformOnObject(n);this.callSuper("_setSVGObject",i,n,c),this._unwindGroupTransformOnObject(n,_)},setViewportTransform:function(i){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),y.StaticCanvas.prototype.setViewportTransform.call(this,i)}}),y.StaticCanvas)u!=="prototype"&&(y.Canvas[u]=y.StaticCanvas[u])}(),function(){var l=y.util.addListener,s=y.util.removeListener,a={passive:!1};function u(i,n){return i.button&&i.button===n-1}y.util.object.extend(y.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(l,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(i,n){var c=this.upperCanvasEl,_=this._getEventPrefix();i(y.window,"resize",this._onResize),i(c,_+"down",this._onMouseDown),i(c,_+"move",this._onMouseMove,a),i(c,_+"out",this._onMouseOut),i(c,_+"enter",this._onMouseEnter),i(c,"wheel",this._onMouseWheel),i(c,"contextmenu",this._onContextMenu),i(c,"dblclick",this._onDoubleClick),i(c,"dragover",this._onDragOver),i(c,"dragenter",this._onDragEnter),i(c,"dragleave",this._onDragLeave),i(c,"drop",this._onDrop),this.enablePointerEvents||i(c,"touchstart",this._onTouchStart,a),typeof eventjs<"u"&&n in eventjs&&(eventjs[n](c,"gesture",this._onGesture),eventjs[n](c,"drag",this._onDrag),eventjs[n](c,"orientation",this._onOrientationChange),eventjs[n](c,"shake",this._onShake),eventjs[n](c,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var i=this._getEventPrefix();s(y.document,i+"up",this._onMouseUp),s(y.document,"touchend",this._onTouchEnd,a),s(y.document,i+"move",this._onMouseMove,a),s(y.document,"touchmove",this._onMouseMove,a)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(i,n){this.__onTransformGesture&&this.__onTransformGesture(i,n)},_onDrag:function(i,n){this.__onDrag&&this.__onDrag(i,n)},_onMouseWheel:function(i){this.__onMouseWheel(i)},_onMouseOut:function(i){var n=this._hoveredTarget;this.fire("mouse:out",{target:n,e:i}),this._hoveredTarget=null,n&&n.fire("mouseout",{e:i});var c=this;this._hoveredTargets.forEach(function(_){c.fire("mouse:out",{target:n,e:i}),_&&n.fire("mouseout",{e:i})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(_){_.isEditing&&_.hiddenTextarea.focus()})},_onMouseEnter:function(i){this._currentTransform||this.findTarget(i)||(this.fire("mouse:over",{target:null,e:i}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(i,n){this.__onOrientationChange&&this.__onOrientationChange(i,n)},_onShake:function(i,n){this.__onShake&&this.__onShake(i,n)},_onLongPress:function(i,n){this.__onLongPress&&this.__onLongPress(i,n)},_onDragOver:function(i){i.preventDefault();var n=this._simpleEventHandler("dragover",i);this._fireEnterLeaveEvents(n,i)},_onDrop:function(i){return this._simpleEventHandler("drop:before",i),this._simpleEventHandler("drop",i)},_onContextMenu:function(i){return this.stopContextMenu&&(i.stopPropagation(),i.preventDefault()),!1},_onDoubleClick:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"dblclick"),this._resetTransformEventData(i)},getPointerId:function(i){var n=i.changedTouches;return n?n[0]&&n[0].identifier:this.enablePointerEvents?i.pointerId:-1},_isMainEvent:function(i){return i.isPrimary===!0||i.isPrimary!==!1&&(i.type==="touchend"&&i.touches.length===0||!i.changedTouches||i.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(i){i.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(i)),this.__onMouseDown(i),this._resetTransformEventData();var n=this.upperCanvasEl,c=this._getEventPrefix();l(y.document,"touchend",this._onTouchEnd,a),l(y.document,"touchmove",this._onMouseMove,a),s(n,c+"down",this._onMouseDown)},_onMouseDown:function(i){this.__onMouseDown(i),this._resetTransformEventData();var n=this.upperCanvasEl,c=this._getEventPrefix();s(n,c+"move",this._onMouseMove,a),l(y.document,c+"up",this._onMouseUp),l(y.document,c+"move",this._onMouseMove,a)},_onTouchEnd:function(i){if(!(i.touches.length>0)){this.__onMouseUp(i),this._resetTransformEventData(),this.mainTouchId=null;var n=this._getEventPrefix();s(y.document,"touchend",this._onTouchEnd,a),s(y.document,"touchmove",this._onMouseMove,a);var c=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){l(c.upperCanvasEl,n+"down",c._onMouseDown),c._willAddMouseDown=0},400)}},_onMouseUp:function(i){this.__onMouseUp(i),this._resetTransformEventData();var n=this.upperCanvasEl,c=this._getEventPrefix();this._isMainEvent(i)&&(s(y.document,c+"up",this._onMouseUp),s(y.document,c+"move",this._onMouseMove,a),l(n,c+"move",this._onMouseMove,a))},_onMouseMove:function(i){!this.allowTouchScrolling&&i.preventDefault&&i.preventDefault(),this.__onMouseMove(i)},_onResize:function(){this.calcOffset()},_shouldRender:function(i){var n=this._activeObject;return!!(!!n!=!!i||n&&i&&n!==i)||(n&&n.isEditing,!1)},__onMouseUp:function(i){var n,c=this._currentTransform,_=this._groupSelector,d=!1,f=!_||_.left===0&&_.top===0;if(this._cacheTransformEventData(i),n=this._target,this._handleEvent(i,"up:before"),u(i,3))this.fireRightClick&&this._handleEvent(i,"up",3,f);else{if(u(i,2))return this.fireMiddleClick&&this._handleEvent(i,"up",2,f),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(i);else if(this._isMainEvent(i)){if(c&&(this._finalizeCurrentTransform(i),d=c.actionPerformed),!f){var m=n===this._activeObject;this._maybeGroupObjects(i),d||(d=this._shouldRender(n)||!m&&n===this._activeObject)}var b,C;if(n){if(b=n._findTargetCorner(this.getPointer(i,!0),y.util.isTouchEvent(i)),n.selectable&&n!==this._activeObject&&n.activeOn==="up")this.setActiveObject(n,i),d=!0;else{var I=n.controls[b],T=I&&I.getMouseUpHandler(i,n,I);T&&T(i,c,(C=this.getPointer(i)).x,C.y)}n.isMoving=!1}if(c&&(c.target!==n||c.corner!==b)){var R=c.target&&c.target.controls[c.corner],B=R&&R.getMouseUpHandler(i,n,I);C=C||this.getPointer(i),B&&B(i,c,C.x,C.y)}this._setCursorFromEvent(i,n),this._handleEvent(i,"up",1,f),this._groupSelector=null,this._currentTransform=null,n&&(n.__corner=0),d?this.requestRenderAll():f||this.renderTop()}}},_simpleEventHandler:function(i,n){var c=this.findTarget(n),_=this.targets,d={e:n,target:c,subTargets:_};if(this.fire(i,d),c&&c.fire(i,d),!_)return c;for(var f=0;f<_.length;f++)_[f].fire(i,d);return c},_handleEvent:function(i,n,c,_){var d=this._target,f=this.targets||[],m={e:i,target:d,subTargets:f,button:c||1,isClick:_||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};n==="up"&&(m.currentTarget=this.findTarget(i),m.currentSubTargets=this.targets),this.fire("mouse:"+n,m),d&&d.fire("mouse"+n,m);for(var b=0;b<f.length;b++)f[b].fire("mouse"+n,m)},_finalizeCurrentTransform:function(i){var n=this._currentTransform,c=n.target,_={e:i,target:c,transform:n,action:n.action};c._scaling&&(c._scaling=!1),c.setCoords(),(n.actionPerformed||this.stateful&&c.hasStateChanged())&&this._fire("modified",_)},_onMouseDownInDrawingMode:function(i){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(i).requestRenderAll();var n=this.getPointer(i);this.freeDrawingBrush.onMouseDown(n,{e:i,pointer:n}),this._handleEvent(i,"down")},_onMouseMoveInDrawingMode:function(i){if(this._isCurrentlyDrawing){var n=this.getPointer(i);this.freeDrawingBrush.onMouseMove(n,{e:i,pointer:n})}this.setCursor(this.freeDrawingCursor),this._handleEvent(i,"move")},_onMouseUpInDrawingMode:function(i){var n=this.getPointer(i);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:i,pointer:n}),this._handleEvent(i,"up")},__onMouseDown:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"down:before");var n=this._target;if(u(i,3))this.fireRightClick&&this._handleEvent(i,"down",3);else if(u(i,2))this.fireMiddleClick&&this._handleEvent(i,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(i);else if(this._isMainEvent(i)&&!this._currentTransform){var c=this._pointer;this._previousPointer=c;var _=this._shouldRender(n),d=this._shouldGroup(i,n);if(this._shouldClearSelection(i,n)?this.discardActiveObject(i):d&&(this._handleGrouping(i,n),n=this._activeObject),!this.selection||n&&(n.selectable||n.isEditing||n===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),n){var f=n===this._activeObject;n.selectable&&n.activeOn==="down"&&this.setActiveObject(n,i);var m=n._findTargetCorner(this.getPointer(i,!0),y.util.isTouchEvent(i));if(n.__corner=m,n===this._activeObject&&(m||!d)){this._setupCurrentTransform(i,n,f);var b=n.controls[m],C=(c=this.getPointer(i),b&&b.getMouseDownHandler(i,n,b));C&&C(i,this._currentTransform,c.x,c.y)}}this._handleEvent(i,"down"),(_||d)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(i){this._resetTransformEventData(),this._pointer=this.getPointer(i,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(i)||null},_beforeTransform:function(i){var n=this._currentTransform;this.stateful&&n.target.saveState(),this.fire("before:transform",{e:i,transform:n})},__onMouseMove:function(i){var n,c;if(this._handleEvent(i,"move:before"),this._cacheTransformEventData(i),this.isDrawingMode)this._onMouseMoveInDrawingMode(i);else if(this._isMainEvent(i)){var _=this._groupSelector;_?(c=this._absolutePointer,_.left=c.x-_.ex,_.top=c.y-_.ey,this.renderTop()):this._currentTransform?this._transformObject(i):(n=this.findTarget(i)||null,this._setCursorFromEvent(i,n),this._fireOverOutEvents(n,i)),this._handleEvent(i,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(i,n){var c=this._hoveredTarget,_=this._hoveredTargets,d=this.targets,f=Math.max(_.length,d.length);this.fireSyntheticInOutEvents(i,n,{oldTarget:c,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var m=0;m<f;m++)this.fireSyntheticInOutEvents(d[m],n,{oldTarget:_[m],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(i,n){var c=this._draggedoverTarget,_=this._hoveredTargets,d=this.targets,f=Math.max(_.length,d.length);this.fireSyntheticInOutEvents(i,n,{oldTarget:c,evtOut:"dragleave",evtIn:"dragenter"});for(var m=0;m<f;m++)this.fireSyntheticInOutEvents(d[m],n,{oldTarget:_[m],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=i},fireSyntheticInOutEvents:function(i,n,c){var _,d,f,m=c.oldTarget,b=m!==i,C=c.canvasEvtIn,I=c.canvasEvtOut;b&&(_={e:n,target:i,previousTarget:m},d={e:n,target:m,nextTarget:i}),f=i&&b,m&&b&&(I&&this.fire(I,d),m.fire(c.evtOut,d)),f&&(C&&this.fire(C,_),i.fire(c.evtIn,_))},__onMouseWheel:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"wheel"),this._resetTransformEventData()},_transformObject:function(i){var n=this.getPointer(i),c=this._currentTransform;c.reset=!1,c.shiftKey=i.shiftKey,c.altKey=i[this.centeredKey],this._performTransformAction(i,c,n),c.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(i,n,c){var _=c.x,d=c.y,f=n.action,m=!1,b=n.actionHandler;b&&(m=b(i,n,_,d)),f==="drag"&&m&&(n.target.isMoving=!0,this.setCursor(n.target.moveCursor||this.moveCursor)),n.actionPerformed=n.actionPerformed||m},_fire:y.controlsUtils.fireEvent,_setCursorFromEvent:function(i,n){if(!n)return this.setCursor(this.defaultCursor),!1;var c=n.hoverCursor||this.hoverCursor,_=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,d=(!_||!_.contains(n))&&n._findTargetCorner(this.getPointer(i,!0));d?this.setCursor(this.getCornerCursor(d,n,i)):(n.subTargetCheck&&this.targets.concat().reverse().map(function(f){c=f.hoverCursor||c}),this.setCursor(c))},getCornerCursor:function(i,n,c){var _=n.controls[i];return _.cursorStyleHandler(c,_,n)}})}(),J=Math.min,Z=Math.max,y.util.object.extend(y.Canvas.prototype,{_shouldGroup:function(l,s){var a=this._activeObject;return a&&this._isSelectionKeyPressed(l)&&s&&s.selectable&&this.selection&&(a!==s||a.type==="activeSelection")&&!s.onSelect({e:l})},_handleGrouping:function(l,s){var a=this._activeObject;a.__corner||(s!==a||(s=this.findTarget(l,!0))&&s.selectable)&&(a&&a.type==="activeSelection"?this._updateActiveSelection(s,l):this._createActiveSelection(s,l))},_updateActiveSelection:function(l,s){var a=this._activeObject,u=a._objects.slice(0);a.contains(l)?(a.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),a.size()===1&&this._setActiveObject(a.item(0),s)):(a.addWithUpdate(l),this._hoveredTarget=a,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(u,s)},_createActiveSelection:function(l,s){var a=this.getActiveObjects(),u=this._createGroup(l);this._hoveredTarget=u,this._setActiveObject(u,s),this._fireSelectionEvents(a,s)},_createGroup:function(l){var s=this._objects,a=s.indexOf(this._activeObject)<s.indexOf(l)?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new y.ActiveSelection(a,{canvas:this})},_groupSelectedObjects:function(l){var s,a=this._collectObjects(l);a.length===1?this.setActiveObject(a[0],l):a.length>1&&(s=new y.ActiveSelection(a.reverse(),{canvas:this}),this.setActiveObject(s,l))},_collectObjects:function(l){for(var s,a=[],u=this._groupSelector.ex,i=this._groupSelector.ey,n=u+this._groupSelector.left,c=i+this._groupSelector.top,_=new y.Point(J(u,n),J(i,c)),d=new y.Point(Z(u,n),Z(i,c)),f=!this.selectionFullyContained,m=u===n&&i===c,b=this._objects.length;b--&&!((s=this._objects[b])&&s.selectable&&s.visible&&(f&&s.intersectsWithRect(_,d,!0)||s.isContainedWithinRect(_,d,!0)||f&&s.containsPoint(_,null,!0)||f&&s.containsPoint(d,null,!0))&&(a.push(s),m)););return a.length>1&&(a=a.filter(function(C){return!C.onSelect({e:l})})),a},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}}),y.util.object.extend(y.StaticCanvas.prototype,{toDataURL:function(l){l||(l={});var s=l.format||"png",a=l.quality||1,u=(l.multiplier||1)*(l.enableRetinaScaling?this.getRetinaScaling():1),i=this.toCanvasElement(u,l);return y.util.toDataURL(i,s,a)},toCanvasElement:function(l,s){l=l||1;var a=((s=s||{}).width||this.width)*l,u=(s.height||this.height)*l,i=this.getZoom(),n=this.width,c=this.height,_=i*l,d=this.viewportTransform,f=(d[4]-(s.left||0))*l,m=(d[5]-(s.top||0))*l,b=this.interactive,C=[_,0,0,_,f,m],I=this.enableRetinaScaling,T=y.util.createCanvasElement(),R=this.contextTop;return T.width=a,T.height=u,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=C,this.width=a,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(T.getContext("2d"),this._objects),this.viewportTransform=d,this.width=n,this.height=c,this.calcViewportBoundaries(),this.interactive=b,this.enableRetinaScaling=I,this.contextTop=R,T}}),y.util.object.extend(y.StaticCanvas.prototype,{loadFromJSON:function(l,s,a){if(l){var u=typeof l=="string"?JSON.parse(l):y.util.object.clone(l),i=this,n=u.clipPath,c=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(_){i.clear(),i._setBgOverlay(u,function(){n?i._enlivenObjects([n],function(d){i.clipPath=d[0],i.__setupCanvas.call(i,u,_,c,s)}):i.__setupCanvas.call(i,u,_,c,s)})},a),this}},__setupCanvas:function(l,s,a,u){var i=this;s.forEach(function(n,c){i.insertAt(n,c)}),this.renderOnAddRemove=a,delete l.objects,delete l.backgroundImage,delete l.overlayImage,delete l.background,delete l.overlay,this._setOptions(l),this.renderAll(),u&&u()},_setBgOverlay:function(l,s){var a={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(l.backgroundImage||l.overlayImage||l.background||l.overlay){var u=function(){a.backgroundImage&&a.overlayImage&&a.backgroundColor&&a.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",l.backgroundImage,a,u),this.__setBgOverlay("overlayImage",l.overlayImage,a,u),this.__setBgOverlay("backgroundColor",l.background,a,u),this.__setBgOverlay("overlayColor",l.overlay,a,u)}else s&&s()},__setBgOverlay:function(l,s,a,u){var i=this;if(!s)return a[l]=!0,void(u&&u());l==="backgroundImage"||l==="overlayImage"?y.util.enlivenObjects([s],function(n){i[l]=n[0],a[l]=!0,u&&u()}):this["set"+y.util.string.capitalize(l,!0)](s,function(){a[l]=!0,u&&u()})},_enlivenObjects:function(l,s,a){l&&l.length!==0?y.util.enlivenObjects(l,function(u){s&&s(u)},null,a):s&&s([])},_toDataURL:function(l,s){this.clone(function(a){s(a.toDataURL(l))})},_toDataURLWithMultiplier:function(l,s,a){this.clone(function(u){a(u.toDataURLWithMultiplier(l,s))})},clone:function(l,s){var a=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(u){u.loadFromJSON(a,function(){l&&l(u)})})},cloneWithoutData:function(l){var s=y.util.createCanvasElement();s.width=this.width,s.height=this.height;var a=new y.Canvas(s);this.backgroundImage?(a.setBackgroundImage(this.backgroundImage.src,function(){a.renderAll(),l&&l(a)}),a.backgroundImageOpacity=this.backgroundImageOpacity,a.backgroundImageStretch=this.backgroundImageStretch):l&&l(a)}}),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.util.object.clone,i=s.util.toFixed,n=s.util.string.capitalize,c=s.util.degreesToRadians,_=!s.isLikelyNode;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:_,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(d){d&&this.setOptions(d)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(d){var f=s.perfLimitSizeTotal,m=d.width,b=d.height,C=s.maxCacheSideLimit,I=s.minCacheSideLimit;if(m<=C&&b<=C&&m*b<=f)return m<I&&(d.width=I),b<I&&(d.height=I),d;var T=m/b,R=s.util.limitDimsByArea(T,f),B=s.util.capValue,U=B(I,R.x,C),X=B(I,R.y,C);return m>U&&(d.zoomX/=m/U,d.width=U,d.capped=!0),b>X&&(d.zoomY/=b/X,d.height=X,d.capped=!0),d},_getCacheCanvasDimensions:function(){var d=this.getTotalObjectScaling(),f=this._getTransformedDimensions(0,0),m=f.x*d.scaleX/this.scaleX,b=f.y*d.scaleY/this.scaleY;return{width:m+2,height:b+2,zoomX:d.scaleX,zoomY:d.scaleY,x:m,y:b}},_updateCacheCanvas:function(){var d=this.canvas;if(this.noScaleCache&&d&&d._currentTransform){var f=d._currentTransform.target,m=d._currentTransform.action;if(this===f&&m.slice&&m.slice(0,5)==="scale")return!1}var b,C,I=this._cacheCanvas,T=this._limitCacheSize(this._getCacheCanvasDimensions()),R=s.minCacheSideLimit,B=T.width,U=T.height,X=T.zoomX,Q=T.zoomY,O=B!==this.cacheWidth||U!==this.cacheHeight,M=this.zoomX!==X||this.zoomY!==Q,D=O||M,L=0,k=0,V=!1;if(O){var G=this._cacheCanvas.width,P=this._cacheCanvas.height,F=B>G||U>P;V=F||(B<.9*G||U<.9*P)&&G>R&&P>R,F&&!T.capped&&(B>R||U>R)&&(L=.1*B,k=.1*U)}return this instanceof s.Text&&this.path&&(D=!0,V=!0,L+=this.getHeightOfLine(0)*this.zoomX,k+=this.getHeightOfLine(0)*this.zoomY),!!D&&(V?(I.width=Math.ceil(B+L),I.height=Math.ceil(U+k)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,I.width,I.height)),b=T.x/2,C=T.y/2,this.cacheTranslationX=Math.round(I.width/2-b)+b,this.cacheTranslationY=Math.round(I.height/2-C)+C,this.cacheWidth=B,this.cacheHeight=U,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(X,Q),this.zoomX=X,this.zoomY=Q,!0)},setOptions:function(d){this._setOptions(d),this._initGradient(d.fill,"fill"),this._initGradient(d.stroke,"stroke"),this._initPattern(d.fill,"fill"),this._initPattern(d.stroke,"stroke")},transform:function(d){var f=this.group&&!this.group._transformDone||this.group&&this.canvas&&d===this.canvas.contextTop,m=this.calcTransformMatrix(!f);d.transform(m[0],m[1],m[2],m[3],m[4],m[5])},toObject:function(d){var f=s.Object.NUM_FRACTION_DIGITS,m={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:i(this.left,f),top:i(this.top,f),width:i(this.width,f),height:i(this.height,f),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,f),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:i(this.strokeMiterLimit,f),scaleX:i(this.scaleX,f),scaleY:i(this.scaleY,f),angle:i(this.angle,f),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,f),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:i(this.skewX,f),skewY:i(this.skewY,f)};return this.clipPath&&!this.clipPath.excludeFromExport&&(m.clipPath=this.clipPath.toObject(d),m.clipPath.inverted=this.clipPath.inverted,m.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,m,d),this.includeDefaultValues||(m=this._removeDefaultValues(m)),m},toDatalessObject:function(d){return this.toObject(d)},_removeDefaultValues:function(d){var f=s.util.getKlass(d.type).prototype;return f.stateProperties.forEach(function(m){m!=="left"&&m!=="top"&&(d[m]===f[m]&&delete d[m],Array.isArray(d[m])&&Array.isArray(f[m])&&d[m].length===0&&f[m].length===0&&delete d[m])}),d},toString:function(){return"#<fabric."+n(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var d=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(d.scaleX),scaleY:Math.abs(d.scaleY)}},getTotalObjectScaling:function(){var d=this.getObjectScaling(),f=d.scaleX,m=d.scaleY;if(this.canvas){var b=this.canvas.getZoom(),C=this.canvas.getRetinaScaling();f*=b*C,m*=b*C}return{scaleX:f,scaleY:m}},getObjectOpacity:function(){var d=this.opacity;return this.group&&(d*=this.group.getObjectOpacity()),d},_set:function(d,f){var m=d==="scaleX"||d==="scaleY",b=this[d]!==f,C=!1;return m&&(f=this._constrainScale(f)),d==="scaleX"&&f<0?(this.flipX=!this.flipX,f*=-1):d==="scaleY"&&f<0?(this.flipY=!this.flipY,f*=-1):d!=="shadow"||!f||f instanceof s.Shadow?d==="dirty"&&this.group&&this.group.set("dirty",f):f=new s.Shadow(f),this[d]=f,b&&(C=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(d)>-1?(this.dirty=!0,C&&this.group.set("dirty",!0)):C&&this.stateProperties.indexOf(d)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(d){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(d.save(),this._setupCompositeOperation(d),this.drawSelectionBackground(d),this.transform(d),this._setOpacity(d),this._setShadow(d,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(d)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(d),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),d.restore())},renderCache:function(d){d=d||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,d.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(d,f){if(d.save(),f.inverted?d.globalCompositeOperation="destination-out":d.globalCompositeOperation="destination-in",f.absolutePositioned){var m=s.util.invertTransform(this.calcTransformMatrix());d.transform(m[0],m[1],m[2],m[3],m[4],m[5])}f.transform(d),d.scale(1/f.zoomX,1/f.zoomY),d.drawImage(f._cacheCanvas,-f.cacheTranslationX,-f.cacheTranslationY),d.restore()},drawObject:function(d,f){var m=this.fill,b=this.stroke;f?(this.fill="black",this.stroke="",this._setClippingProperties(d)):this._renderBackground(d),this._render(d),this._drawClipPath(d,this.clipPath),this.fill=m,this.stroke=b},_drawClipPath:function(d,f){f&&(f.canvas=this.canvas,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCache(d,f))},drawCacheOnCanvas:function(d){d.scale(1/this.zoomX,1/this.zoomY),d.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(d){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!d&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!d){var f=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-m/2,f,m)}return!0}return!1},_renderBackground:function(d){if(this.backgroundColor){var f=this._getNonTransformedDimensions();d.fillStyle=this.backgroundColor,d.fillRect(-f.x/2,-f.y/2,f.x,f.y),this._removeShadow(d)}},_setOpacity:function(d){this.group&&!this.group._transformDone?d.globalAlpha=this.getObjectOpacity():d.globalAlpha*=this.opacity},_setStrokeStyles:function(d,f){var m=f.stroke;m&&(d.lineWidth=f.strokeWidth,d.lineCap=f.strokeLineCap,d.lineDashOffset=f.strokeDashOffset,d.lineJoin=f.strokeLineJoin,d.miterLimit=f.strokeMiterLimit,m.toLive?m.gradientUnits==="percentage"||m.gradientTransform||m.patternTransform?this._applyPatternForTransformedGradient(d,m):(d.strokeStyle=m.toLive(d,this),this._applyPatternGradientTransform(d,m)):d.strokeStyle=f.stroke)},_setFillStyles:function(d,f){var m=f.fill;m&&(m.toLive?(d.fillStyle=m.toLive(d,this),this._applyPatternGradientTransform(d,f.fill)):d.fillStyle=m)},_setClippingProperties:function(d){d.globalAlpha=1,d.strokeStyle="transparent",d.fillStyle="#000000"},_setLineDash:function(d,f){f&&f.length!==0&&(1&f.length&&f.push.apply(f,f),d.setLineDash(f))},_renderControls:function(d,f){var m,b,C,I=this.getViewportTransform(),T=this.calcTransformMatrix();b=(f=f||{}).hasBorders!==void 0?f.hasBorders:this.hasBorders,C=f.hasControls!==void 0?f.hasControls:this.hasControls,T=s.util.multiplyTransformMatrices(I,T),m=s.util.qrDecompose(T),d.save(),d.translate(m.translateX,m.translateY),d.lineWidth=1*this.borderScaleFactor,this.group||(d.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(m.angle-=180),d.rotate(c(this.group?m.angle:this.angle)),f.forActiveSelection||this.group?b&&this.drawBordersInGroup(d,m,f):b&&this.drawBorders(d,f),C&&this.drawControls(d,f),d.restore()},_setShadow:function(d){if(this.shadow){var f,m=this.shadow,b=this.canvas,C=b&&b.viewportTransform[0]||1,I=b&&b.viewportTransform[3]||1;f=m.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),b&&b._isRetinaScaling()&&(C*=s.devicePixelRatio,I*=s.devicePixelRatio),d.shadowColor=m.color,d.shadowBlur=m.blur*s.browserShadowBlurConstant*(C+I)*(f.scaleX+f.scaleY)/4,d.shadowOffsetX=m.offsetX*C*f.scaleX,d.shadowOffsetY=m.offsetY*I*f.scaleY}},_removeShadow:function(d){this.shadow&&(d.shadowColor="",d.shadowBlur=d.shadowOffsetX=d.shadowOffsetY=0)},_applyPatternGradientTransform:function(d,f){if(!f||!f.toLive)return{offsetX:0,offsetY:0};var m=f.gradientTransform||f.patternTransform,b=-this.width/2+f.offsetX||0,C=-this.height/2+f.offsetY||0;return f.gradientUnits==="percentage"?d.transform(this.width,0,0,this.height,b,C):d.transform(1,0,0,1,b,C),m&&d.transform(m[0],m[1],m[2],m[3],m[4],m[5]),{offsetX:b,offsetY:C}},_renderPaintInOrder:function(d){this.paintFirst==="stroke"?(this._renderStroke(d),this._renderFill(d)):(this._renderFill(d),this._renderStroke(d))},_render:function(){},_renderFill:function(d){this.fill&&(d.save(),this._setFillStyles(d,this),this.fillRule==="evenodd"?d.fill("evenodd"):d.fill(),d.restore())},_renderStroke:function(d){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(d),d.save(),this.strokeUniform&&this.group){var f=this.getObjectScaling();d.scale(1/f.scaleX,1/f.scaleY)}else this.strokeUniform&&d.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(d,this.strokeDashArray),this._setStrokeStyles(d,this),d.stroke(),d.restore()}},_applyPatternForTransformedGradient:function(d,f){var m,b=this._limitCacheSize(this._getCacheCanvasDimensions()),C=s.util.createCanvasElement(),I=this.canvas.getRetinaScaling(),T=b.x/this.scaleX/I,R=b.y/this.scaleY/I;C.width=T,C.height=R,(m=C.getContext("2d")).beginPath(),m.moveTo(0,0),m.lineTo(T,0),m.lineTo(T,R),m.lineTo(0,R),m.closePath(),m.translate(T/2,R/2),m.scale(b.zoomX/this.scaleX/I,b.zoomY/this.scaleY/I),this._applyPatternGradientTransform(m,f),m.fillStyle=f.toLive(d),m.fill(),d.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),d.scale(I*this.scaleX/b.zoomX,I*this.scaleY/b.zoomY),d.strokeStyle=m.createPattern(C,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var d=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",d.scaleX),this.set("scaleY",d.scaleY),this.angle=d.angle,this.skewX=d.skewX,this.skewY=0}},_removeTransformMatrix:function(d){var f=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),f=s.util.transformPoint(f,this.transformMatrix)),this.transformMatrix=null,d&&(this.scaleX*=d.scaleX,this.scaleY*=d.scaleY,this.cropX=d.cropX,this.cropY=d.cropY,f.x+=d.offsetLeft,f.y+=d.offsetTop,this.width=d.width,this.height=d.height),this.setPositionByOrigin(f,"center","center")},clone:function(d,f){var m=this.toObject(f);this.constructor.fromObject?this.constructor.fromObject(m,d):s.Object._fromObject("Object",m,d)},cloneAsImage:function(d,f){var m=this.toCanvasElement(f);return d&&d(new s.Image(m)),this},toCanvasElement:function(d){d||(d={});var f=s.util,m=f.saveObjectTransform(this),b=this.group,C=this.shadow,I=Math.abs,T=(d.multiplier||1)*(d.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,d.withoutTransform&&f.resetObjectTransform(this),d.withoutShadow&&(this.shadow=null);var R,B,U,X,Q=s.util.createCanvasElement(),O=this.getBoundingRect(!0,!0),M=this.shadow,D={x:0,y:0};M&&(B=M.blur,R=M.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),D.x=2*Math.round(I(M.offsetX)+B)*I(R.scaleX),D.y=2*Math.round(I(M.offsetY)+B)*I(R.scaleY)),U=O.width+D.x,X=O.height+D.y,Q.width=Math.ceil(U),Q.height=Math.ceil(X);var L=new s.StaticCanvas(Q,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});d.format==="jpeg"&&(L.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(L.width/2,L.height/2),"center","center");var k=this.canvas;L.add(this);var V=L.toCanvasElement(T||1,d);return this.shadow=C,this.set("canvas",k),b&&(this.group=b),this.set(m).setCoords(),L._objects=[],L.dispose(),L=null,V},toDataURL:function(d){return d||(d={}),s.util.toDataURL(this.toCanvasElement(d),d.format||"png",d.quality||1)},isType:function(d){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===d},complexity:function(){return 1},toJSON:function(d){return this.toObject(d)},rotate:function(d){var f=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return f&&this._setOriginToCenter(),this.set("angle",d),f&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(d,f){f=f||this.canvas.getPointer(d);var m=new s.Point(f.x,f.y),b=this._getLeftTopCoords();return this.angle&&(m=s.util.rotatePoint(m,b,c(-this.angle))),{x:m.x-b.x,y:m.y-b.y}},_setupCompositeOperation:function(d){this.globalCompositeOperation&&(d.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),a(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(d,f,m,b){var C=s[d];f=u(f,!0),s.util.enlivenPatterns([f.fill,f.stroke],function(I){I[0]!==void 0&&(f.fill=I[0]),I[1]!==void 0&&(f.stroke=I[1]),s.util.enlivenObjectEnlivables(f,f,function(){var T=b?new C(f[b],f):new C(f);m&&m(T)})})},s.Object.__uid=0)}(e),ee=y.util.degreesToRadians,he={left:-.5,center:0,right:.5},fe={top:-.5,center:0,bottom:.5},y.util.object.extend(y.Object.prototype,{translateToGivenOrigin:function(l,s,a,u,i){var n,c,_,d=l.x,f=l.y;return typeof s=="string"?s=he[s]:s-=.5,typeof u=="string"?u=he[u]:u-=.5,typeof a=="string"?a=fe[a]:a-=.5,typeof i=="string"?i=fe[i]:i-=.5,c=i-a,((n=u-s)||c)&&(_=this._getTransformedDimensions(),d=l.x+n*_.x,f=l.y+c*_.y),new y.Point(d,f)},translateToCenterPoint:function(l,s,a){var u=this.translateToGivenOrigin(l,s,a,"center","center");return this.angle?y.util.rotatePoint(u,l,ee(this.angle)):u},translateToOriginPoint:function(l,s,a){var u=this.translateToGivenOrigin(l,"center","center",s,a);return this.angle?y.util.rotatePoint(u,l,ee(this.angle)):u},getCenterPoint:function(){var l=new y.Point(this.left,this.top);return this.translateToCenterPoint(l,this.originX,this.originY)},getPointByOrigin:function(l,s){var a=this.getCenterPoint();return this.translateToOriginPoint(a,l,s)},toLocalPoint:function(l,s,a){var u,i,n=this.getCenterPoint();return u=s!==void 0&&a!==void 0?this.translateToGivenOrigin(n,"center","center",s,a):new y.Point(this.left,this.top),i=new y.Point(l.x,l.y),this.angle&&(i=y.util.rotatePoint(i,n,-ee(this.angle))),i.subtractEquals(u)},setPositionByOrigin:function(l,s,a){var u=this.translateToCenterPoint(l,s,a),i=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",i.x),this.set("top",i.y)},adjustPosition:function(l){var s,a,u=ee(this.angle),i=this.getScaledWidth(),n=y.util.cos(u)*i,c=y.util.sin(u)*i;s=typeof this.originX=="string"?he[this.originX]:this.originX-.5,a=typeof l=="string"?he[l]:l-.5,this.left+=n*(a-s),this.top+=c*(a-s),this.setCoords(),this.originX=l},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var l=this.getCenterPoint();this.originX="center",this.originY="center",this.left=l.x,this.top=l.y},_resetOrigin:function(){var l=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=l.x,this.top=l.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var l=y.util,s=l.degreesToRadians,a=l.multiplyTransformMatrices,u=l.transformPoint;l.object.extend(y.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(i,n){return n?i?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),i?this.aCoords:this.lineCoords)},getCoords:function(i,n){return c=this._getCoords(i,n),[new y.Point(c.tl.x,c.tl.y),new y.Point(c.tr.x,c.tr.y),new y.Point(c.br.x,c.br.y),new y.Point(c.bl.x,c.bl.y)];var c},intersectsWithRect:function(i,n,c,_){var d=this.getCoords(c,_);return y.Intersection.intersectPolygonRectangle(d,i,n).status==="Intersection"},intersectsWithObject:function(i,n,c){return y.Intersection.intersectPolygonPolygon(this.getCoords(n,c),i.getCoords(n,c)).status==="Intersection"||i.isContainedWithinObject(this,n,c)||this.isContainedWithinObject(i,n,c)},isContainedWithinObject:function(i,n,c){for(var _=this.getCoords(n,c),d=n?i.aCoords:i.lineCoords,f=0,m=i._getImageLines(d);f<4;f++)if(!i.containsPoint(_[f],m))return!1;return!0},isContainedWithinRect:function(i,n,c,_){var d=this.getBoundingRect(c,_);return d.left>=i.x&&d.left+d.width<=n.x&&d.top>=i.y&&d.top+d.height<=n.y},containsPoint:function(i,n,c,_){var d=this._getCoords(c,_),f=(n=n||this._getImageLines(d),this._findCrossPoints(i,n));return f!==0&&f%2==1},isOnScreen:function(i){if(!this.canvas)return!1;var n=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br;return!!this.getCoords(!0,i).some(function(_){return _.x<=c.x&&_.x>=n.x&&_.y<=c.y&&_.y>=n.y})||!!this.intersectsWithRect(n,c,!0,i)||this._containsCenterOfCanvas(n,c,i)},_containsCenterOfCanvas:function(i,n,c){var _={x:(i.x+n.x)/2,y:(i.y+n.y)/2};return!!this.containsPoint(_,null,!0,c)},isPartiallyOnScreen:function(i){if(!this.canvas)return!1;var n=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br;return!!this.intersectsWithRect(n,c,!0,i)||this.getCoords(!0,i).every(function(_){return(_.x>=c.x||_.x<=n.x)&&(_.y>=c.y||_.y<=n.y)})&&this._containsCenterOfCanvas(n,c,i)},_getImageLines:function(i){return{topline:{o:i.tl,d:i.tr},rightline:{o:i.tr,d:i.br},bottomline:{o:i.br,d:i.bl},leftline:{o:i.bl,d:i.tl}}},_findCrossPoints:function(i,n){var c,_,d,f=0;for(var m in n)if(!((d=n[m]).o.y<i.y&&d.d.y<i.y||d.o.y>=i.y&&d.d.y>=i.y||(d.o.x===d.d.x&&d.o.x>=i.x?_=d.o.x:(c=(d.d.y-d.o.y)/(d.d.x-d.o.x),_=-(i.y-0*i.x-(d.o.y-c*d.o.x))/(0-c)),_>=i.x&&(f+=1),f!==2)))break;return f},getBoundingRect:function(i,n){var c=this.getCoords(i,n);return l.makeBoundingBoxFromPoints(c)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(i){return Math.abs(i)<this.minScaleLimit?i<0?-this.minScaleLimit:this.minScaleLimit:i===0?1e-4:i},scale:function(i){return this._set("scaleX",i),this._set("scaleY",i),this.setCoords()},scaleToWidth:function(i,n){var c=this.getBoundingRect(n).width/this.getScaledWidth();return this.scale(i/this.width/c)},scaleToHeight:function(i,n){var c=this.getBoundingRect(n).height/this.getScaledHeight();return this.scale(i/this.height/c)},calcLineCoords:function(){var i=this.getViewportTransform(),n=this.padding,c=s(this.angle),_=l.cos(c)*n,d=l.sin(c)*n,f=_+d,m=_-d,b=this.calcACoords(),C={tl:u(b.tl,i),tr:u(b.tr,i),bl:u(b.bl,i),br:u(b.br,i)};return n&&(C.tl.x-=m,C.tl.y-=f,C.tr.x+=f,C.tr.y-=m,C.bl.x-=f,C.bl.y+=m,C.br.x+=m,C.br.y+=f),C},calcOCoords:function(){var i=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),c=this.getViewportTransform(),_=a(c,n),d=a(_,i),f=(d=a(d,[1/c[0],0,0,1/c[3],0,0]),this._calculateCurrentDimensions()),m={};return this.forEachControl(function(b,C,I){m[C]=b.positionHandler(f,d,I)}),m},calcACoords:function(){var i=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),c=a(n,i),_=this._getTransformedDimensions(),d=_.x/2,f=_.y/2;return{tl:u({x:-d,y:-f},c),tr:u({x:d,y:-f},c),bl:u({x:-d,y:f},c),br:u({x:d,y:f},c)}},setCoords:function(i){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),i||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return l.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var i=this.getCenterPoint();return[1,0,0,1,i.x,i.y]},transformMatrixKey:function(i){var n="_",c="";return!i&&this.group&&(c=this.group.transformMatrixKey(i)+n),c+this.top+n+this.left+n+this.scaleX+n+this.scaleY+n+this.skewX+n+this.skewY+n+this.angle+n+this.originX+n+this.originY+n+this.width+n+this.height+n+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(i){var n=this.calcOwnMatrix();if(i||!this.group)return n;var c=this.transformMatrixKey(i),_=this.matrixCache||(this.matrixCache={});return _.key===c?_.value:(this.group&&(n=a(this.group.calcTransformMatrix(!1),n)),_.key=c,_.value=n,n)},calcOwnMatrix:function(){var i=this.transformMatrixKey(!0),n=this.ownMatrixCache||(this.ownMatrixCache={});if(n.key===i)return n.value;var c=this._calcTranslateMatrix(),_={angle:this.angle,translateX:c[4],translateY:c[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return n.key=i,n.value=l.composeMatrix(_),n.value},_getNonTransformedDimensions:function(){var i=this.strokeWidth;return{x:this.width+i,y:this.height+i}},_getTransformedDimensions:function(i,n){i===void 0&&(i=this.skewX),n===void 0&&(n=this.skewY);var c,_,d,f=i===0&&n===0;if(this.strokeUniform?(_=this.width,d=this.height):(_=(c=this._getNonTransformedDimensions()).x,d=c.y),f)return this._finalizeDimensions(_*this.scaleX,d*this.scaleY);var m=l.sizeAfterTransform(_,d,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:i,skewY:n});return this._finalizeDimensions(m.x,m.y)},_finalizeDimensions:function(i,n){return this.strokeUniform?{x:i+this.strokeWidth,y:n+this.strokeWidth}:{x:i,y:n}},_calculateCurrentDimensions:function(){var i=this.getViewportTransform(),n=this._getTransformedDimensions();return u(n,i,!0).scalarAdd(2*this.padding)}})}(),y.util.object.extend(y.Object.prototype,{sendToBack:function(){return this.group?y.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?y.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(l){return this.group?y.StaticCanvas.prototype.sendBackwards.call(this.group,this,l):this.canvas&&this.canvas.sendBackwards(this,l),this},bringForward:function(l){return this.group?y.StaticCanvas.prototype.bringForward.call(this.group,this,l):this.canvas&&this.canvas.bringForward(this,l),this},moveTo:function(l){return this.group&&this.group.type!=="activeSelection"?y.StaticCanvas.prototype.moveTo.call(this.group,this,l):this.canvas&&this.canvas.moveTo(this,l),this}}),function(){function l(a,u){if(u){if(u.toLive)return a+": url(#SVGID_"+u.id+"); ";var i=new y.Color(u),n=a+": "+i.toRgb()+"; ",c=i.getAlpha();return c!==1&&(n+=a+"-opacity: "+c.toString()+"; "),n}return a+": none; "}var s=y.util.toFixed;y.util.object.extend(y.Object.prototype,{getSvgStyles:function(a){var u=this.fillRule?this.fillRule:"nonzero",i=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):"none",c=this.strokeDashOffset?this.strokeDashOffset:"0",_=this.strokeLineCap?this.strokeLineCap:"butt",d=this.strokeLineJoin?this.strokeLineJoin:"miter",f=this.strokeMiterLimit?this.strokeMiterLimit:"4",m=this.opacity!==void 0?this.opacity:"1",b=this.visible?"":" visibility: hidden;",C=a?"":this.getSvgFilter(),I=l("fill",this.fill);return[l("stroke",this.stroke),"stroke-width: ",i,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",_,"; ","stroke-dashoffset: ",c,"; ","stroke-linejoin: ",d,"; ","stroke-miterlimit: ",f,"; ",I,"fill-rule: ",u,"; ","opacity: ",m,";",C,b].join("")},getSvgSpanStyles:function(a,u){var i="; ",n=a.fontFamily?"font-family: "+(a.fontFamily.indexOf("'")===-1&&a.fontFamily.indexOf('"')===-1?"'"+a.fontFamily+"'":a.fontFamily)+i:"",c=a.strokeWidth?"stroke-width: "+a.strokeWidth+i:"",_=a.fontSize?"font-size: "+a.fontSize+"px"+i:"",d=a.fontStyle?"font-style: "+a.fontStyle+i:"",f=a.fontWeight?"font-weight: "+a.fontWeight+i:"",m=a.fill?l("fill",a.fill):"",b=a.stroke?l("stroke",a.stroke):"",C=this.getSvgTextDecoration(a);return C&&(C="text-decoration: "+C+i),[b,c,n,_,d,f,C,m,a.deltaY?"baseline-shift: "+-a.deltaY+"; ":"",u?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(a){return["overline","underline","line-through"].filter(function(u){return a[u.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(a,u){var i=a?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+y.util.matrixToSVG(i)+(u||"")+'" '},_setSVGBg:function(a){if(this.backgroundColor){var u=y.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,u),'" y="',s(-this.height/2,u),'" width="',s(this.width,u),'" height="',s(this.height,u),`"></rect>
`)}},toSVG:function(a){return this._createBaseSVGMarkup(this._toSVG(a),{reviver:a})},toClipPathSVG:function(a){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(a),{reviver:a})},_createBaseClipPathSVGMarkup:function(a,u){var i=(u=u||{}).reviver,n=u.additionalTransform||"",c=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),_=a.indexOf("COMMON_PARTS");return a[_]=c,i?i(a.join("")):a.join("")},_createBaseSVGMarkup:function(a,u){var i,n,c=(u=u||{}).noStyle,_=u.reviver,d=c?"":'style="'+this.getSvgStyles()+'" ',f=u.withShadow?'style="'+this.getSvgFilter()+'" ':"",m=this.clipPath,b=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",C=m&&m.absolutePositioned,I=this.stroke,T=this.fill,R=this.shadow,B=[],U=a.indexOf("COMMON_PARTS"),X=u.additionalTransform;return m&&(m.clipPathId="CLIPPATH_"+y.Object.__uid++,n='<clipPath id="'+m.clipPathId+`" >
`+m.toClipPathSVG(_)+`</clipPath>
`),C&&B.push("<g ",f,this.getSvgCommons(),` >
`),B.push("<g ",this.getSvgTransform(!1),C?"":f+this.getSvgCommons(),` >
`),i=[d,b,c?"":this.addPaintOrder()," ",X?'transform="'+X+'" ':""].join(""),a[U]=i,T&&T.toLive&&B.push(T.toSVG(this)),I&&I.toLive&&B.push(I.toSVG(this)),R&&B.push(R.toSVG(this)),m&&B.push(n),B.push(a.join("")),B.push(`</g>
`),C&&B.push(`</g>
`),_?_(B.join("")):B.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var l=y.util.object.extend,s="stateProperties";function a(i,n,c){var _={};c.forEach(function(d){_[d]=i[d]}),l(i[n],_,!0)}function u(i,n,c){if(i===n)return!0;if(Array.isArray(i)){if(!Array.isArray(n)||i.length!==n.length)return!1;for(var _=0,d=i.length;_<d;_++)if(!u(i[_],n[_]))return!1;return!0}if(i&&typeof i=="object"){var f,m=Object.keys(i);if(!n||typeof n!="object"||!c&&m.length!==Object.keys(n).length)return!1;for(_=0,d=m.length;_<d;_++)if((f=m[_])!=="canvas"&&f!=="group"&&!u(i[f],n[f]))return!1;return!0}}y.util.object.extend(y.Object.prototype,{hasStateChanged:function(i){var n="_"+(i=i||s);return Object.keys(this[n]).length<this[i].length||!u(this[n],this,!0)},saveState:function(i){var n=i&&i.propertySet||s,c="_"+n;return this[c]?(a(this,c,this[n]),i&&i.stateProperties&&a(this,c,i.stateProperties),this):this.setupState(i)},setupState:function(i){var n=(i=i||{}).propertySet||s;return i.propertySet=n,this["_"+n]={},this.saveState(i),this}})}(),function(){var l=y.util.degreesToRadians;y.util.object.extend(y.Object.prototype,{_findTargetCorner:function(s,a){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var u,i,n,c=s.x,_=s.y,d=Object.keys(this.oCoords),f=d.length-1;for(this.__corner=0;f>=0;f--)if(n=d[f],this.isControlVisible(n)&&(i=this._getImageLines(a?this.oCoords[n].touchCorner:this.oCoords[n].corner),(u=this._findCrossPoints({x:c,y:_},i))!==0&&u%2==1))return this.__corner=n,n;return!1},forEachControl:function(s){for(var a in this.controls)s(this.controls[a],a,this)},_setCornerCoords:function(){var s=this.oCoords;for(var a in s){var u=this.controls[a];s[a].corner=u.calcCornerCoords(this.angle,this.cornerSize,s[a].x,s[a].y,!1),s[a].touchCorner=u.calcCornerCoords(this.angle,this.touchCornerSize,s[a].x,s[a].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var a=this.getCenterPoint(),u=this._calculateCurrentDimensions(),i=this.canvas.viewportTransform;return s.translate(a.x,a.y),s.scale(1/i[0],1/i[3]),s.rotate(l(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-u.x/2,-u.y/2,u.x,u.y),s.restore(),this},drawBorders:function(s,a){a=a||{};var u=this._calculateCurrentDimensions(),i=this.borderScaleFactor,n=u.x+i,c=u.y+i,_=a.hasControls!==void 0?a.hasControls:this.hasControls,d=!1;return s.save(),s.strokeStyle=a.borderColor||this.borderColor,this._setLineDash(s,a.borderDashArray||this.borderDashArray),s.strokeRect(-n/2,-c/2,n,c),_&&(s.beginPath(),this.forEachControl(function(f,m,b){f.withConnection&&f.getVisibility(b,m)&&(d=!0,s.moveTo(f.x*n,f.y*c),s.lineTo(f.x*n+f.offsetX,f.y*c+f.offsetY))}),d&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,a,u){u=u||{};var i=y.util.sizeAfterTransform(this.width,this.height,a),n=this.strokeWidth,c=this.strokeUniform,_=this.borderScaleFactor,d=i.x+n*(c?this.canvas.getZoom():a.scaleX)+_,f=i.y+n*(c?this.canvas.getZoom():a.scaleY)+_;return s.save(),this._setLineDash(s,u.borderDashArray||this.borderDashArray),s.strokeStyle=u.borderColor||this.borderColor,s.strokeRect(-d/2,-f/2,d,f),s.restore(),this},drawControls:function(s,a){a=a||{},s.save();var u,i,n=this.canvas.getRetinaScaling();return s.setTransform(n,0,0,n,0,0),s.strokeStyle=s.fillStyle=a.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=a.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,a.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(u=this.group.calcTransformMatrix()),this.forEachControl(function(c,_,d){i=d.oCoords[_],c.getVisibility(d,_)&&(u&&(i=y.util.transformPoint(i,u)),c.render(s,i.x,i.y,a,d))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,a){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=a,this},setControlsVisibility:function(s){for(var a in s||(s={}),s)this.setControlVisible(a,s[a]);return this},onDeselect:function(){},onSelect:function(){}})}(),y.util.object.extend(y.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(l,s){var a=function(){},u=(s=s||{}).onComplete||a,i=s.onChange||a,n=this;return y.util.animate({target:this,startValue:l.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(c){l.set("left",c),n.requestRenderAll(),i()},onComplete:function(){l.setCoords(),u()}})},fxCenterObjectV:function(l,s){var a=function(){},u=(s=s||{}).onComplete||a,i=s.onChange||a,n=this;return y.util.animate({target:this,startValue:l.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(c){l.set("top",c),n.requestRenderAll(),i()},onComplete:function(){l.setCoords(),u()}})},fxRemove:function(l,s){var a=function(){},u=(s=s||{}).onComplete||a,i=s.onChange||a,n=this;return y.util.animate({target:this,startValue:l.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(c){l.set("opacity",c),n.requestRenderAll(),i()},onComplete:function(){n.remove(l),u()}})}}),y.util.object.extend(y.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var l,s,a=[],u=[];for(l in arguments[0])a.push(l);for(var i=0,n=a.length;i<n;i++)l=a[i],s=i!==n-1,u.push(this._animate(l,arguments[0][l],arguments[1],s));return u}return this._animate.apply(this,arguments)},_animate:function(l,s,a,u){var i,n=this;s=s.toString(),a=a?y.util.object.clone(a):{},~l.indexOf(".")&&(i=l.split("."));var c=n.colorProperties.indexOf(l)>-1||i&&n.colorProperties.indexOf(i[1])>-1,_=i?this.get(i[0])[i[1]]:this.get(l);"from"in a||(a.from=_),c||(s=~s.indexOf("=")?_+parseFloat(s.replace("=","")):parseFloat(s));var d={target:this,startValue:a.from,endValue:s,byValue:a.by,easing:a.easing,duration:a.duration,abort:a.abort&&function(f,m,b){return a.abort.call(n,f,m,b)},onChange:function(f,m,b){i?n[i[0]][i[1]]=f:n.set(l,f),u||a.onChange&&a.onChange(f,m,b)},onComplete:function(f,m,b){u||(n.setCoords(),a.onComplete&&a.onComplete(f,m,b))}};return c?y.util.animateColor(d.startValue,d.endValue,d.duration,d):y.util.animate(d)}}),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.util.object.clone,i={x1:1,x2:1,y1:1,y2:1};function n(c,_){var d=c.origin,f=c.axis1,m=c.axis2,b=c.dimension,C=_.nearest,I=_.center,T=_.farthest;return function(){switch(this.get(d)){case C:return Math.min(this.get(f),this.get(m));case I:return Math.min(this.get(f),this.get(m))+.5*this.get(b);case T:return Math.max(this.get(f),this.get(m))}}}s.Line?s.warn("fabric.Line is already defined"):(s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,_){c||(c=[0,0,0,0]),this.callSuper("initialize",_),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(_)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,_){return this.callSuper("_set",c,_),i[c]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:n({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:n({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){c.beginPath();var _=this.calcLinePoints();c.moveTo(_.x1,_.y1),c.lineTo(_.x2,_.y2),c.lineWidth=this.strokeWidth;var d=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=d},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return a(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,_=this.y1<=this.y2?-1:1,d=c*this.width*.5,f=_*this.height*.5;return{x1:d,x2:c*this.width*-.5,y1:f,y2:_*this.height*-.5}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(c,_,d){d=d||{};var f=s.parseAttributes(c,s.Line.ATTRIBUTE_NAMES),m=[f.x1||0,f.y1||0,f.x2||0,f.y2||0];_(new s.Line(m,a(f,d)))},s.Line.fromObject=function(c,_){var d=u(c,!0);d.points=[c.x1,c.y1,c.x2,c.y2],s.Object._fromObject("Line",d,function(f){delete f.points,_&&_(f)},"points")})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.degreesToRadians;s.Circle?s.warn("fabric.Circle is already defined."):(s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(u,i){return this.callSuper("_set",u,i),u==="radius"&&this.setRadius(i),this},toObject:function(u){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(u))},_toSVG:function(){var u,i=(this.endAngle-this.startAngle)%360;if(i===0)u=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var n=a(this.startAngle),c=a(this.endAngle),_=this.radius;u=['<path d="M '+s.util.cos(n)*_+" "+s.util.sin(n)*_," A "+_+" "+_," 0 ",+(i>180?"1":"0")+" 1"," "+s.util.cos(c)*_+" "+s.util.sin(c)*_,'" ',"COMMON_PARTS",` />
`]}return u},_render:function(u){u.beginPath(),u.arc(0,0,this.radius,a(this.startAngle),a(this.endAngle),!1),this._renderPaintInOrder(u)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(u){return this.radius=u,this.set("width",2*u).set("height",2*u)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(u,i){var n,c=s.parseAttributes(u,s.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=c)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");c.left=(c.left||0)-c.radius,c.top=(c.top||0)-c.radius,i(new s.Circle(c))},s.Circle.fromObject=function(u,i){s.Object._fromObject("Circle",u,i)})}(e),function(l){var s=l.fabric||(l.fabric={});s.Triangle?s.warn("fabric.Triangle is already defined"):(s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(a){var u=this.width/2,i=this.height/2;a.beginPath(),a.moveTo(-u,i),a.lineTo(0,-i),a.lineTo(u,i),a.closePath(),this._renderPaintInOrder(a)},_toSVG:function(){var a=this.width/2,u=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-a+" "+u,"0 "+-u,a+" "+u].join(","),'" />']}}),s.Triangle.fromObject=function(a,u){return s.Object._fromObject("Triangle",a,u)})}(e),function(l){var s=l.fabric||(l.fabric={}),a=2*Math.PI;s.Ellipse?s.warn("fabric.Ellipse is already defined."):(s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this.set("rx",u&&u.rx||0),this.set("ry",u&&u.ry||0)},_set:function(u,i){switch(this.callSuper("_set",u,i),u){case"rx":this.rx=i,this.set("width",2*i);break;case"ry":this.ry=i,this.set("height",2*i)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(u){u.beginPath(),u.save(),u.transform(1,0,0,this.ry/this.rx,0,0),u.arc(0,0,this.rx,0,a,!1),u.restore(),this._renderPaintInOrder(u)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(u,i){var n=s.parseAttributes(u,s.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new s.Ellipse(n))},s.Ellipse.fromObject=function(u,i){s.Object._fromObject("Ellipse",u,i)})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend;s.Rect?s.warn("fabric.Rect is already defined"):(s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(u){var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,c=this.width,_=this.height,d=-this.width/2,f=-this.height/2,m=i!==0||n!==0,b=.4477152502;u.beginPath(),u.moveTo(d+i,f),u.lineTo(d+c-i,f),m&&u.bezierCurveTo(d+c-b*i,f,d+c,f+b*n,d+c,f+n),u.lineTo(d+c,f+_-n),m&&u.bezierCurveTo(d+c,f+_-b*n,d+c-b*i,f+_,d+c-i,f+_),u.lineTo(d+i,f+_),m&&u.bezierCurveTo(d+b*i,f+_,d,f+_-b*n,d,f+_-n),u.lineTo(d,f+n),m&&u.bezierCurveTo(d,f+b*n,d+b*i,f,d+i,f),u.closePath(),this._renderPaintInOrder(u)},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(u,i,n){if(!u)return i(null);n=n||{};var c=s.parseAttributes(u,s.Rect.ATTRIBUTE_NAMES);c.left=c.left||0,c.top=c.top||0,c.height=c.height||0,c.width=c.width||0;var _=new s.Rect(a(n?s.util.object.clone(n):{},c));_.visible=_.visible&&_.width>0&&_.height>0,i(_)},s.Rect.fromObject=function(u,i){return s.Object._fromObject("Rect",u,i)})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.util.array.min,i=s.util.array.max,n=s.util.toFixed,c=s.util.projectStrokeOnPoints;s.Polyline?s.warn("fabric.Polyline is already defined"):(s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(_,d){d=d||{},this.points=_||[],this.callSuper("initialize",d),this._setPositionDimensions(d)},_projectStrokeOnPoints:function(){return c(this.points,this,!0)},_setPositionDimensions:function(_){var d,f=this._calcDimensions(_),m=this.exactBoundingBox?this.strokeWidth:0;this.width=f.width-m,this.height=f.height-m,_.fromSVG||(d=this.translateToGivenOrigin({x:f.left-this.strokeWidth/2+m/2,y:f.top-this.strokeWidth/2+m/2},"left","top",this.originX,this.originY)),_.left===void 0&&(this.left=_.fromSVG?f.left:d.x),_.top===void 0&&(this.top=_.fromSVG?f.top:d.y),this.pathOffset={x:f.left+this.width/2+m/2,y:f.top+this.height/2+m/2}},_calcDimensions:function(){var _=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,d=u(_,"x")||0,f=u(_,"y")||0;return{left:d,top:f,width:(i(_,"x")||0)-d,height:(i(_,"y")||0)-f}},toObject:function(_){return a(this.callSuper("toObject",_),{points:this.points.concat()})},_toSVG:function(){for(var _=[],d=this.pathOffset.x,f=this.pathOffset.y,m=s.Object.NUM_FRACTION_DIGITS,b=0,C=this.points.length;b<C;b++)_.push(n(this.points[b].x-d,m),",",n(this.points[b].y-f,m)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',_.join(""),`" />
`]},commonRender:function(_){var d,f=this.points.length,m=this.pathOffset.x,b=this.pathOffset.y;if(!f||isNaN(this.points[f-1].y))return!1;_.beginPath(),_.moveTo(this.points[0].x-m,this.points[0].y-b);for(var C=0;C<f;C++)d=this.points[C],_.lineTo(d.x-m,d.y-b);return!0},_render:function(_){this.commonRender(_)&&this._renderPaintInOrder(_)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(_){return function(d,f,m){if(!d)return f(null);m||(m={});var b=s.parsePointsAttribute(d.getAttribute("points")),C=s.parseAttributes(d,s[_].ATTRIBUTE_NAMES);C.fromSVG=!0,f(new s[_](b,a(C,m)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(_,d){return s.Object._fromObject("Polyline",_,d,"points")})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.projectStrokeOnPoints;s.Polygon?s.warn("fabric.Polygon is already defined"):(s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return a(this.points,this)},_render:function(u){this.commonRender(u)&&(u.closePath(),this._renderPaintInOrder(u))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(u,i){s.Object._fromObject("Polygon",u,i,"points")})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.array.min,u=s.util.array.max,i=s.util.object.extend,n=s.util.object.clone,c=s.util.toFixed;s.Path?s.warn("fabric.Path is already defined"):(s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(_,d){delete(d=n(d||{})).path,this.callSuper("initialize",d),this._setPath(_||[],d)},_setPath:function(_,d){this.path=s.util.makePathSimpler(Array.isArray(_)?_:s.util.parsePath(_)),s.Polyline.prototype._setPositionDimensions.call(this,d||{})},_renderPathCommands:function(_){var d,f=0,m=0,b=0,C=0,I=0,T=0,R=-this.pathOffset.x,B=-this.pathOffset.y;_.beginPath();for(var U=0,X=this.path.length;U<X;++U)switch((d=this.path[U])[0]){case"L":b=d[1],C=d[2],_.lineTo(b+R,C+B);break;case"M":f=b=d[1],m=C=d[2],_.moveTo(b+R,C+B);break;case"C":b=d[5],C=d[6],I=d[3],T=d[4],_.bezierCurveTo(d[1]+R,d[2]+B,I+R,T+B,b+R,C+B);break;case"Q":_.quadraticCurveTo(d[1]+R,d[2]+B,d[3]+R,d[4]+B),b=d[3],C=d[4],I=d[1],T=d[2];break;case"z":case"Z":b=f,C=m,_.closePath()}},_render:function(_){this._renderPathCommands(_),this._renderPaintInOrder(_)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(_){return i(this.callSuper("toObject",_),{path:this.path.map(function(d){return d.slice()})})},toDatalessObject:function(_){var d=this.toObject(["sourcePath"].concat(_));return d.sourcePath&&delete d.path,d},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',s.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var _=s.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,_)+", "+c(-this.pathOffset.y,_)+")"},toClipPathSVG:function(_){var d=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:_,additionalTransform:d})},toSVG:function(_){var d=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:_,additionalTransform:d})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var _,d,f=[],m=[],b=0,C=0,I=0,T=0,R=0,B=this.path.length;R<B;++R){switch((_=this.path[R])[0]){case"L":I=_[1],T=_[2],d=[];break;case"M":b=I=_[1],C=T=_[2],d=[];break;case"C":d=s.util.getBoundsOfCurve(I,T,_[1],_[2],_[3],_[4],_[5],_[6]),I=_[5],T=_[6];break;case"Q":d=s.util.getBoundsOfCurve(I,T,_[1],_[2],_[1],_[2],_[3],_[4]),I=_[3],T=_[4];break;case"z":case"Z":I=b,T=C}d.forEach(function(Q){f.push(Q.x),m.push(Q.y)}),f.push(I),m.push(T)}var U=a(f)||0,X=a(m)||0;return{left:U,top:X,width:(u(f)||0)-U,height:(u(m)||0)-X}}}),s.Path.fromObject=function(_,d){if(typeof _.sourcePath=="string"){var f=_.sourcePath;s.loadSVGFromURL(f,function(m){var b=m[0];b.setOptions(_),d&&d(b)})}else s.Object._fromObject("Path",_,d,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(_,d,f){var m=s.parseAttributes(_,s.Path.ATTRIBUTE_NAMES);m.fromSVG=!0,d(new s.Path(m.d,i(m,f)))})}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.array.min,u=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(i,n,c){n=n||{},this._objects=[],c&&this.callSuper("initialize",n),this._objects=i||[];for(var _=this._objects.length;_--;)this._objects[_].group=this;if(c)this._updateObjectsACoords();else{var d=n&&n.centerPoint;n.originX!==void 0&&(this.originX=n.originX),n.originY!==void 0&&(this.originY=n.originY),d||this._calcBounds(),this._updateObjectsCoords(d),delete n.centerPoint,this.callSuper("initialize",n)}this.setCoords()},_updateObjectsACoords:function(){for(var i=this._objects.length;i--;)this._objects[i].setCoords(!0)},_updateObjectsCoords:function(i){i=i||this.getCenterPoint();for(var n=this._objects.length;n--;)this._updateObjectCoords(this._objects[n],i)},_updateObjectCoords:function(i,n){var c=i.left,_=i.top;i.set({left:c-n.x,top:_-n.y}),i.group=this,i.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(i){var n=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),i&&(n&&s.util.removeTransformFromObject(i,this.group.calcTransformMatrix()),this._objects.push(i),i.group=this,i._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,n?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(i){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(i),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(i){this.dirty=!0,i.group=this,i._set("canvas",this.canvas)},_onObjectRemoved:function(i){this.dirty=!0,delete i.group},_set:function(i,n){var c=this._objects.length;if(this.useSetOnGroup)for(;c--;)this._objects[c].setOnGroup(i,n);if(i==="canvas")for(;c--;)this._objects[c]._set(i,n);s.Object.prototype._set.call(this,i,n)},toObject:function(i){var n=this.includeDefaultValues,c=this._objects.filter(function(d){return!d.excludeFromExport}).map(function(d){var f=d.includeDefaultValues;d.includeDefaultValues=n;var m=d.toObject(i);return d.includeDefaultValues=f,m}),_=s.Object.prototype.toObject.call(this,i);return _.objects=c,_},toDatalessObject:function(i){var n,c=this.sourcePath;if(c)n=c;else{var _=this.includeDefaultValues;n=this._objects.map(function(f){var m=f.includeDefaultValues;f.includeDefaultValues=_;var b=f.toDatalessObject(i);return f.includeDefaultValues=m,b})}var d=s.Object.prototype.toDatalessObject.call(this,i);return d.objects=n,d},render:function(i){this._transformDone=!0,this.callSuper("render",i),this._transformDone=!1},shouldCache:function(){var i=s.Object.prototype.shouldCache.call(this);if(i){for(var n=0,c=this._objects.length;n<c;n++)if(this._objects[n].willDrawShadow())return this.ownCaching=!1,!1}return i},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var i=0,n=this._objects.length;i<n;i++)if(this._objects[i].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(i){for(var n=0,c=this._objects.length;n<c;n++)this._objects[n].render(i);this._drawClipPath(i,this.clipPath)},isCacheDirty:function(i){if(this.callSuper("isCacheDirty",i))return!0;if(!this.statefullCache)return!1;for(var n=0,c=this._objects.length;n<c;n++)if(this._objects[n].isCacheDirty(!0)){if(this._cacheCanvas){var _=this.cacheWidth/this.zoomX,d=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-_/2,-d/2,_,d)}return!0}return!1},_restoreObjectsState:function(){var i=this.calcOwnMatrix();return this._objects.forEach(function(n){s.util.addTransformToObject(n,i),delete n.group,n.setCoords()}),this},destroy:function(){return this._objects.forEach(function(i){i.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(i){i.dispose&&i.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var i=this._objects,n=this.canvas;this._objects=[];var c=this.toObject();delete c.objects;var _=new s.ActiveSelection([]);return _.set(c),_.type="activeSelection",n.remove(this),i.forEach(function(d){d.group=_,d.dirty=!0,n.add(d)}),_.canvas=n,_._objects=i,n._activeObject=_,_.setCoords(),_}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(i){i.setCoords(!0)}),this},_calcBounds:function(i){for(var n,c,_,d,f=[],m=[],b=["tr","br","bl","tl"],C=0,I=this._objects.length,T=b.length;C<I;++C){for(_=(n=this._objects[C]).calcACoords(),d=0;d<T;d++)c=b[d],f.push(_[c].x),m.push(_[c].y);n.aCoords=_}this._getBounds(f,m,i)},_getBounds:function(i,n,c){var _=new s.Point(a(i),a(n)),d=new s.Point(u(i),u(n)),f=_.y||0,m=_.x||0,b=d.x-_.x||0,C=d.y-_.y||0;this.width=b,this.height=C,c||this.setPositionByOrigin({x:m,y:f},"left","top")},_toSVG:function(i){for(var n=["<g ","COMMON_PARTS",` >
`],c=0,_=this._objects.length;c<_;c++)n.push("		",this._objects[c].toSVG(i));return n.push(`</g>
`),n},getSvgStyles:function(){var i=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",n=this.visible?"":" visibility: hidden;";return[i,this.getSvgFilter(),n].join("")},toClipPathSVG:function(i){for(var n=[],c=0,_=this._objects.length;c<_;c++)n.push("	",this._objects[c].toClipPathSVG(i));return this._createBaseClipPathSVGMarkup(n,{reviver:i})}}),s.Group.fromObject=function(i,n){var c=i.objects,_=s.util.object.clone(i,!0);delete _.objects,typeof c!="string"?s.util.enlivenObjects(c,function(d){var f=s.util.object.clone(i,!0);delete f.objects,s.util.enlivenObjectEnlivables(i,f,function(){n&&n(new s.Group(d,f,!0))})}):s.loadSVGFromURL(c,function(d){var f=s.util.groupSVGElements(d,i,c);f.set(_),n&&n(f)})})}(e),function(l){var s=l.fabric||(l.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(a,u){u=u||{},this._objects=a||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;u.originX&&(this.originX=u.originX),u.originY&&(this.originY=u.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,u),this.setCoords()},toGroup:function(){var a=this._objects.concat();this._objects=[];var u=s.Object.prototype.toObject.call(this),i=new s.Group([]);if(delete u.type,i.set(u),a.forEach(function(c){c.canvas.remove(c),c.group=i}),i._objects=a,!this.canvas)return i;var n=this.canvas;return n.add(i),n._activeObject=i,i.setCoords(),i},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(a,u,i){a.save(),a.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",a,u),(i=i||{}).hasControls===void 0&&(i.hasControls=!1),i.forActiveSelection=!0;for(var n=0,c=this._objects.length;n<c;n++)this._objects[n]._renderControls(a,i);a.restore()}}),s.ActiveSelection.fromObject=function(a,u){s.util.enlivenObjects(a.objects,function(i){delete a.objects,u&&u(new s.ActiveSelection(i,a,!0))})})}(e),function(l){var s=y.util.object.extend;l.fabric||(l.fabric={}),l.fabric.Image?y.warn("fabric.Image is already defined."):(y.Image=y.util.createClass(y.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:y.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:y.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(a,u){u||(u={}),this.filters=[],this.cacheKey="texture"+y.Object.__uid++,this.callSuper("initialize",u),this._initElement(a,u)},getElement:function(){return this._element||{}},setElement:function(a,u){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=a,this._originalElement=a,this._initConfig(u),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(a){var u=y.filterBackend;u&&u.evictCachesForKey&&u.evictCachesForKey(a)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(a){y.util.cleanUpJsdomNode(this[a]),this[a]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var a=this.getElement();return{width:a.naturalWidth||a.width,height:a.naturalHeight||a.height}},_stroke:function(a){if(this.stroke&&this.strokeWidth!==0){var u=this.width/2,i=this.height/2;a.beginPath(),a.moveTo(-u,-i),a.lineTo(u,-i),a.lineTo(u,i),a.lineTo(-u,i),a.lineTo(-u,-i),a.closePath()}},toObject:function(a){var u=[];this.filters.forEach(function(n){n&&u.push(n.toObject())});var i=s(this.callSuper("toObject",["cropX","cropY"].concat(a)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:u});return this.resizeFilter&&(i.resizeFilter=this.resizeFilter.toObject()),i},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var a,u=[],i=[],n=this._element,c=-this.width/2,_=-this.height/2,d="",f="";if(!n)return[];if(this.hasCrop()){var m=y.Object.__uid++;u.push('<clipPath id="imageCrop_'+m+`">
`,'	<rect x="'+c+'" y="'+_+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),d=' clip-path="url(#imageCrop_'+m+')" '}if(this.imageSmoothing||(f='" image-rendering="optimizeSpeed'),i.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',c-this.cropX,'" y="',_-this.cropY,'" width="',n.width||n.naturalWidth,'" height="',n.height||n.height,f,'"',d,`></image>
`),this.stroke||this.strokeDashArray){var b=this.fill;this.fill=null,a=["	<rect ",'x="',c,'" y="',_,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=b}return this.paintFirst!=="fill"?u.concat(a,i):u.concat(i,a)},getSrc:function(a){var u=a?this._element:this._originalElement;return u?u.toDataURL?u.toDataURL():this.srcFromAttribute?u.getAttribute("src"):u.src:this.src||""},setSrc:function(a,u,i){return y.util.loadImage(a,function(n,c){this.setElement(n,i),this._setWidthHeight(),u&&u(this,c)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var a=this.resizeFilter,u=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),n=i.scaleX,c=i.scaleY,_=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!a||n>u&&c>u)return this._element=_,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=c);y.filterBackend||(y.filterBackend=y.initFilterBackend());var d=y.util.createCanvasElement(),f=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,m=_.width,b=_.height;d.width=m,d.height=b,this._element=d,this._lastScaleX=a.scaleX=n,this._lastScaleY=a.scaleY=c,y.filterBackend.applyFilters([a],_,m,b,this._element,f),this._filterScalingX=d.width/this._originalElement.width,this._filterScalingY=d.height/this._originalElement.height},applyFilters:function(a){if(a=(a=a||this.filters||[]).filter(function(_){return _&&!_.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),a.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var u=this._originalElement,i=u.naturalWidth||u.width,n=u.naturalHeight||u.height;if(this._element===this._originalElement){var c=y.util.createCanvasElement();c.width=i,c.height=n,this._element=c,this._filteredEl=c}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,n),this._lastScaleX=1,this._lastScaleY=1;return y.filterBackend||(y.filterBackend=y.initFilterBackend()),y.filterBackend.applyFilters(a,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(a){y.util.setImageSmoothing(a,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(a),this._renderPaintInOrder(a)},drawCacheOnCanvas:function(a){y.util.setImageSmoothing(a,this.imageSmoothing),y.Object.prototype.drawCacheOnCanvas.call(this,a)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(a){var u=this._element;if(u){var i=this._filterScalingX,n=this._filterScalingY,c=this.width,_=this.height,d=Math.min,f=Math.max,m=f(this.cropX,0),b=f(this.cropY,0),C=u.naturalWidth||u.width,I=u.naturalHeight||u.height,T=m*i,R=b*n,B=d(c*i,C-T),U=d(_*n,I-R),X=-c/2,Q=-_/2,O=d(c,C/i-m),M=d(_,I/n-b);u&&a.drawImage(u,T,R,B,U,X,Q,O,M)}},_needsResize:function(){var a=this.getTotalObjectScaling();return a.scaleX!==this._lastScaleX||a.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(a,u){this.setElement(y.util.getById(a),u),y.util.addClass(this.getElement(),y.Image.CSS_CANVAS)},_initConfig:function(a){a||(a={}),this.setOptions(a),this._setWidthHeight(a)},_initFilters:function(a,u){a&&a.length?y.util.enlivenObjects(a,function(i){u&&u(i)},"fabric.Image.filters"):u&&u()},_setWidthHeight:function(a){a||(a={});var u=this.getElement();this.width=a.width||u.naturalWidth||u.width||0,this.height=a.height||u.naturalHeight||u.height||0},parsePreserveAspectRatioAttribute:function(){var a,u=y.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,c=1,_=1,d=0,f=0,m=0,b=0,C=this.width,I=this.height,T={width:C,height:I};return!u||u.alignX==="none"&&u.alignY==="none"?(c=C/i,_=I/n):(u.meetOrSlice==="meet"&&(a=(C-i*(c=_=y.util.findScaleToFit(this._element,T)))/2,u.alignX==="Min"&&(d=-a),u.alignX==="Max"&&(d=a),a=(I-n*_)/2,u.alignY==="Min"&&(f=-a),u.alignY==="Max"&&(f=a)),u.meetOrSlice==="slice"&&(a=i-C/(c=_=y.util.findScaleToCover(this._element,T)),u.alignX==="Mid"&&(m=a/2),u.alignX==="Max"&&(m=a),a=n-I/_,u.alignY==="Mid"&&(b=a/2),u.alignY==="Max"&&(b=a),i=C/c,n=I/_)),{width:i,height:n,scaleX:c,scaleY:_,offsetLeft:d,offsetTop:f,cropX:m,cropY:b}}}),y.Image.CSS_CANVAS="canvas-img",y.Image.prototype.getSvgSrc=y.Image.prototype.getSrc,y.Image.fromObject=function(a,u){var i=y.util.object.clone(a);y.util.loadImage(i.src,function(n,c){c?u&&u(null,!0):y.Image.prototype._initFilters.call(i,i.filters,function(_){i.filters=_||[],y.Image.prototype._initFilters.call(i,[i.resizeFilter],function(d){i.resizeFilter=d[0],y.util.enlivenObjectEnlivables(i,i,function(){var f=new y.Image(n,i);u(f,!1)})})})},null,i.crossOrigin)},y.Image.fromURL=function(a,u,i){y.util.loadImage(a,function(n,c){u&&u(new y.Image(n,i),c)},null,i&&i.crossOrigin)},y.Image.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),y.Image.fromElement=function(a,u,i){var n=y.parseAttributes(a,y.Image.ATTRIBUTE_NAMES);y.Image.fromURL(n["xlink:href"],u,s(i?y.util.object.clone(i):{},n))})}(e),y.util.object.extend(y.Object.prototype,{_getAngleValueForStraighten:function(){var l=this.angle%360;return l>0?90*Math.round((l-1)/90):90*Math.round(l/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(l){var s=function(){},a=(l=l||{}).onComplete||s,u=l.onChange||s,i=this;return y.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){i.rotate(n),u()},onComplete:function(){i.setCoords(),a()}})}}),y.util.object.extend(y.StaticCanvas.prototype,{straightenObject:function(l){return l.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(l){return l.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function l(a,u){var i="precision "+u+` float;
void main(){}`,n=a.createShader(a.FRAGMENT_SHADER);return a.shaderSource(n,i),a.compileShader(n),!!a.getShaderParameter(n,a.COMPILE_STATUS)}function s(a){a&&a.tileSize&&(this.tileSize=a.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}y.isWebglSupported=function(a){if(y.isLikelyNode)return!1;a=a||y.WebglFilterBackend.prototype.tileSize;var u=document.createElement("canvas"),i=u.getContext("webgl")||u.getContext("experimental-webgl"),n=!1;if(i){y.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),n=y.maxTextureSize>=a;for(var c=["highp","mediump","lowp"],_=0;_<3;_++)if(l(i,c[_])){y.webGlPrecision=c[_];break}}return this.isSupported=n,n},y.WebglFilterBackend=s,s.prototype={tileSize:2048,resources:{},setupGLContext:function(a,u){this.dispose(),this.createWebGLCanvas(a,u),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(a,u)},chooseFastestCopyGLTo2DMethod:function(a,u){var i,n=window.performance!==void 0;try{new ImageData(1,1),i=!0}catch{i=!1}var c=typeof ArrayBuffer<"u",_=typeof Uint8ClampedArray<"u";if(n&&i&&c&&_){var d=y.util.createCanvasElement(),f=new ArrayBuffer(a*u*4);if(y.forceGLPutImageData)return this.imageBuffer=f,void(this.copyGLTo2D=Te);var m,b,C={imageBuffer:f,destinationWidth:a,destinationHeight:u,targetCanvas:d};d.width=a,d.height=u,m=window.performance.now(),pe.call(C,this.gl,C),b=window.performance.now()-m,m=window.performance.now(),Te.call(C,this.gl,C),b>window.performance.now()-m?(this.imageBuffer=f,this.copyGLTo2D=Te):this.copyGLTo2D=pe}},createWebGLCanvas:function(a,u){var i=y.util.createCanvasElement();i.width=a,i.height=u;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},c=i.getContext("webgl",n);c||(c=i.getContext("experimental-webgl",n)),c&&(c.clearColor(0,0,0,0),this.canvas=i,this.gl=c)},applyFilters:function(a,u,i,n,c,_){var d,f=this.gl;_&&(d=this.getCachedTexture(_,u));var m={originalWidth:u.width||u.originalWidth,originalHeight:u.height||u.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:f,sourceTexture:this.createTexture(f,i,n,!d&&u),targetTexture:this.createTexture(f,i,n),originalTexture:d||this.createTexture(f,i,n,!d&&u),passes:a.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:c},b=f.createFramebuffer();return f.bindFramebuffer(f.FRAMEBUFFER,b),a.forEach(function(C){C&&C.applyTo(m)}),function(C){var I=C.targetCanvas,T=I.width,R=I.height,B=C.destinationWidth,U=C.destinationHeight;T===B&&R===U||(I.width=B,I.height=U)}(m),this.copyGLTo2D(f,m),f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(m.sourceTexture),f.deleteTexture(m.targetTexture),f.deleteFramebuffer(b),c.getContext("2d").setTransform(1,0,0,1,0,0),m},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(a,u,i,n){var c=a.createTexture();return a.bindTexture(a.TEXTURE_2D,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),n?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,n):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,u,i,0,a.RGBA,a.UNSIGNED_BYTE,null),c},getCachedTexture:function(a,u){if(this.textureCache[a])return this.textureCache[a];var i=this.createTexture(this.gl,u.width,u.height,u);return this.textureCache[a]=i,i},evictCachesForKey:function(a){this.textureCache[a]&&(this.gl.deleteTexture(this.textureCache[a]),delete this.textureCache[a])},copyGLTo2D:pe,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var a=this.gl,u={renderer:"",vendor:""};if(!a)return u;var i=a.getExtension("WEBGL_debug_renderer_info");if(i){var n=a.getParameter(i.UNMASKED_RENDERER_WEBGL),c=a.getParameter(i.UNMASKED_VENDOR_WEBGL);n&&(u.renderer=n.toLowerCase()),c&&(u.vendor=c.toLowerCase())}return this.gpuInfo=u,u}}}(),function(){var l=function(){};function s(){}y.Canvas2dFilterBackend=s,s.prototype={evictCachesForKey:l,dispose:l,clearWebGLCaches:l,resources:{},applyFilters:function(a,u,i,n,c){var _=c.getContext("2d");_.drawImage(u,0,0,i,n);var d={sourceWidth:i,sourceHeight:n,imageData:_.getImageData(0,0,i,n),originalEl:u,originalImageData:_.getImageData(0,0,i,n),canvasEl:c,ctx:_,filterBackend:this};return a.forEach(function(f){f.applyTo(d)}),d.imageData.width===i&&d.imageData.height===n||(c.width=d.imageData.width,c.height=d.imageData.height),_.putImageData(d.imageData,0,0),d}}}(),y.Image=y.Image||{},y.Image.filters=y.Image.filters||{},y.Image.filters.BaseFilter=y.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(l){l&&this.setOptions(l)},setOptions:function(l){for(var s in l)this[s]=l[s]},createProgram:function(l,s,a){s=s||this.fragmentSource,a=a||this.vertexSource,y.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+y.webGlPrecision+" float"));var u=l.createShader(l.VERTEX_SHADER);if(l.shaderSource(u,a),l.compileShader(u),!l.getShaderParameter(u,l.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+l.getShaderInfoLog(u));var i=l.createShader(l.FRAGMENT_SHADER);if(l.shaderSource(i,s),l.compileShader(i),!l.getShaderParameter(i,l.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+l.getShaderInfoLog(i));var n=l.createProgram();if(l.attachShader(n,u),l.attachShader(n,i),l.linkProgram(n),!l.getProgramParameter(n,l.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+l.getProgramInfoLog(n));var c=this.getAttributeLocations(l,n),_=this.getUniformLocations(l,n)||{};return _.uStepW=l.getUniformLocation(n,"uStepW"),_.uStepH=l.getUniformLocation(n,"uStepH"),{program:n,attributeLocations:c,uniformLocations:_}},getAttributeLocations:function(l,s){return{aPosition:l.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(l,s,a){var u=s.aPosition,i=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,i),l.enableVertexAttribArray(u),l.vertexAttribPointer(u,2,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,a,l.STATIC_DRAW)},_setupFrameBuffer:function(l){var s,a,u=l.context;l.passes>1?(s=l.destinationWidth,a=l.destinationHeight,l.sourceWidth===s&&l.sourceHeight===a||(u.deleteTexture(l.targetTexture),l.targetTexture=l.filterBackend.createTexture(u,s,a)),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,l.targetTexture,0)):(u.bindFramebuffer(u.FRAMEBUFFER,null),u.finish())},_swapTextures:function(l){l.passes--,l.pass++;var s=l.targetTexture;l.targetTexture=l.sourceTexture,l.sourceTexture=s},isNeutralState:function(){var l=this.mainParameter,s=y.Image.filters[this.type].prototype;if(l){if(Array.isArray(s[l])){for(var a=s[l].length;a--;)if(this[l][a]!==s[l][a])return!1;return!0}return s[l]===this[l]}return!1},applyTo:function(l){l.webgl?(this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l)):this.applyTo2d(l)},retrieveShader:function(l){return l.programCache.hasOwnProperty(this.type)||(l.programCache[this.type]=this.createProgram(l.context)),l.programCache[this.type]},applyToWebGL:function(l){var s=l.context,a=this.retrieveShader(l);l.pass===0&&l.originalTexture?s.bindTexture(s.TEXTURE_2D,l.originalTexture):s.bindTexture(s.TEXTURE_2D,l.sourceTexture),s.useProgram(a.program),this.sendAttributeData(s,a.attributeLocations,l.aPosition),s.uniform1f(a.uniformLocations.uStepW,1/l.sourceWidth),s.uniform1f(a.uniformLocations.uStepH,1/l.sourceHeight),this.sendUniformData(s,a.uniformLocations),s.viewport(0,0,l.destinationWidth,l.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(l,s,a){l.activeTexture(a),l.bindTexture(l.TEXTURE_2D,s),l.activeTexture(l.TEXTURE0)},unbindAdditionalTexture:function(l,s){l.activeTexture(s),l.bindTexture(l.TEXTURE_2D,null),l.activeTexture(l.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(l){this[this.mainParameter]=l},sendUniformData:function(){},createHelpLayer:function(l){if(!l.helpLayer){var s=document.createElement("canvas");s.width=l.sourceWidth,s.height=l.sourceHeight,l.helpLayer=s}},toObject:function(){var l={type:this.type},s=this.mainParameter;return s&&(l[s]=this[s]),l},toJSON:function(){return this.toObject()}}),y.Image.filters.BaseFilter.fromObject=function(l,s){var a=new y.Image.filters[l.type](l);return s&&s(a),a},function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.ColorMatrix=u(a.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(i){this.callSuper("initialize",i),this.matrix=this.matrix.slice(0)},applyTo2d:function(i){var n,c,_,d,f,m=i.imageData.data,b=m.length,C=this.matrix,I=this.colorsOnly;for(f=0;f<b;f+=4)n=m[f],c=m[f+1],_=m[f+2],I?(m[f]=n*C[0]+c*C[1]+_*C[2]+255*C[4],m[f+1]=n*C[5]+c*C[6]+_*C[7]+255*C[9],m[f+2]=n*C[10]+c*C[11]+_*C[12]+255*C[14]):(d=m[f+3],m[f]=n*C[0]+c*C[1]+_*C[2]+d*C[3]+255*C[4],m[f+1]=n*C[5]+c*C[6]+_*C[7]+d*C[8]+255*C[9],m[f+2]=n*C[10]+c*C[11]+_*C[12]+d*C[13]+255*C[14],m[f+3]=n*C[15]+c*C[16]+_*C[17]+d*C[18]+255*C[19])},getUniformLocations:function(i,n){return{uColorMatrix:i.getUniformLocation(n,"uColorMatrix"),uConstants:i.getUniformLocation(n,"uConstants")}},sendUniformData:function(i,n){var c=this.matrix,_=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],d=[c[4],c[9],c[14],c[19]];i.uniformMatrix4fv(n.uColorMatrix,!1,_),i.uniform4fv(n.uConstants,d)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Brightness=u(a.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(i){if(this.brightness!==0){var n,c=i.imageData.data,_=c.length,d=Math.round(255*this.brightness);for(n=0;n<_;n+=4)c[n]=c[n]+d,c[n+1]=c[n+1]+d,c[n+2]=c[n+2]+d}},getUniformLocations:function(i,n){return{uBrightness:i.getUniformLocation(n,"uBrightness")}},sendUniformData:function(i,n){i.uniform1f(n.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.Image.filters,i=s.util.createClass;u.Convolute=i(u.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(n){var c=Math.sqrt(this.matrix.length),_=this.type+"_"+c+"_"+(this.opaque?1:0),d=this.fragmentSource[_];return n.programCache.hasOwnProperty(_)||(n.programCache[_]=this.createProgram(n.context,d)),n.programCache[_]},applyTo2d:function(n){var c,_,d,f,m,b,C,I,T,R,B,U,X,Q=n.imageData,O=Q.data,M=this.matrix,D=Math.round(Math.sqrt(M.length)),L=Math.floor(D/2),k=Q.width,V=Q.height,G=n.ctx.createImageData(k,V),P=G.data,F=this.opaque?1:0;for(B=0;B<V;B++)for(R=0;R<k;R++){for(m=4*(B*k+R),c=0,_=0,d=0,f=0,X=0;X<D;X++)for(U=0;U<D;U++)b=R+U-L,(C=B+X-L)<0||C>=V||b<0||b>=k||(I=4*(C*k+b),T=M[X*D+U],c+=O[I]*T,_+=O[I+1]*T,d+=O[I+2]*T,F||(f+=O[I+3]*T));P[m]=c,P[m+1]=_,P[m+2]=d,P[m+3]=F?O[m+3]:f}n.imageData=G},getUniformLocations:function(n,c){return{uMatrix:n.getUniformLocation(c,"uMatrix"),uOpaque:n.getUniformLocation(c,"uOpaque"),uHalfSize:n.getUniformLocation(c,"uHalfSize"),uSize:n.getUniformLocation(c,"uSize")}},sendUniformData:function(n,c){n.uniform1fv(c.uMatrix,this.matrix)},toObject:function(){return a(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Grayscale=u(a.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(i){var n,c,_=i.imageData.data,d=_.length,f=this.mode;for(n=0;n<d;n+=4)f==="average"?c=(_[n]+_[n+1]+_[n+2])/3:f==="lightness"?c=(Math.min(_[n],_[n+1],_[n+2])+Math.max(_[n],_[n+1],_[n+2]))/2:f==="luminosity"&&(c=.21*_[n]+.72*_[n+1]+.07*_[n+2]),_[n]=c,_[n+1]=c,_[n+2]=c},retrieveShader:function(i){var n=this.type+"_"+this.mode;if(!i.programCache.hasOwnProperty(n)){var c=this.fragmentSource[this.mode];i.programCache[n]=this.createProgram(i.context,c)}return i.programCache[n]},getUniformLocations:function(i,n){return{uMode:i.getUniformLocation(n,"uMode")}},sendUniformData:function(i,n){i.uniform1i(n.uMode,1)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Invert=u(a.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(i){var n,c=i.imageData.data,_=c.length;for(n=0;n<_;n+=4)c[n]=255-c[n],c[n+1]=255-c[n+1],c[n+2]=255-c[n+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(i,n){return{uInvert:i.getUniformLocation(n,"uInvert")}},sendUniformData:function(i,n){i.uniform1i(n.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.Image.filters,i=s.util.createClass;u.Noise=i(u.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(n){if(this.noise!==0){var c,_,d=n.imageData.data,f=d.length,m=this.noise;for(c=0,f=d.length;c<f;c+=4)_=(.5-Math.random())*m,d[c]+=_,d[c+1]+=_,d[c+2]+=_}},getUniformLocations:function(n,c){return{uNoise:n.getUniformLocation(c,"uNoise"),uSeed:n.getUniformLocation(c,"uSeed")}},sendUniformData:function(n,c){n.uniform1f(c.uNoise,this.noise/255),n.uniform1f(c.uSeed,Math.random())},toObject:function(){return a(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Pixelate=u(a.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(i){var n,c,_,d,f,m,b,C,I,T,R,B=i.imageData,U=B.data,X=B.height,Q=B.width;for(c=0;c<X;c+=this.blocksize)for(_=0;_<Q;_+=this.blocksize)for(d=U[n=4*c*Q+4*_],f=U[n+1],m=U[n+2],b=U[n+3],T=Math.min(c+this.blocksize,X),R=Math.min(_+this.blocksize,Q),C=c;C<T;C++)for(I=_;I<R;I++)U[n=4*C*Q+4*I]=d,U[n+1]=f,U[n+2]=m,U[n+3]=b},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(i,n){return{uBlocksize:i.getUniformLocation(n,"uBlocksize"),uStepW:i.getUniformLocation(n,"uStepW"),uStepH:i.getUniformLocation(n,"uStepH")}},sendUniformData:function(i,n){i.uniform1f(n.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.extend,u=s.Image.filters,i=s.util.createClass;u.RemoveColor=i(u.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(n){var c,_,d,f,m=n.imageData.data,b=255*this.distance,C=new s.Color(this.color).getSource(),I=[C[0]-b,C[1]-b,C[2]-b],T=[C[0]+b,C[1]+b,C[2]+b];for(c=0;c<m.length;c+=4)_=m[c],d=m[c+1],f=m[c+2],_>I[0]&&d>I[1]&&f>I[2]&&_<T[0]&&d<T[1]&&f<T[2]&&(m[c+3]=0)},getUniformLocations:function(n,c){return{uLow:n.getUniformLocation(c,"uLow"),uHigh:n.getUniformLocation(c,"uHigh")}},sendUniformData:function(n,c){var _=new s.Color(this.color).getSource(),d=parseFloat(this.distance),f=[0+_[0]/255-d,0+_[1]/255-d,0+_[2]/255-d,1],m=[_[0]/255+d,_[1]/255+d,_[2]/255+d,1];n.uniform4fv(c.uLow,f),n.uniform4fv(c.uHigh,m)},toObject:function(){return a(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass,i={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var n in i)a[n]=u(a.ColorMatrix,{type:n,matrix:i[n],mainParameter:!1,colorsOnly:!0}),s.Image.filters[n].fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric,a=s.Image.filters,u=s.util.createClass;a.BlendColor=u(a.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(i){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[i]+`}
}`},retrieveShader:function(i){var n,c=this.type+"_"+this.mode;return i.programCache.hasOwnProperty(c)||(n=this.buildSource(this.mode),i.programCache[c]=this.createProgram(i.context,n)),i.programCache[c]},applyTo2d:function(i){var n,c,_,d,f,m,b,C=i.imageData.data,I=C.length,T=1-this.alpha;n=(b=new s.Color(this.color).getSource())[0]*this.alpha,c=b[1]*this.alpha,_=b[2]*this.alpha;for(var R=0;R<I;R+=4)switch(d=C[R],f=C[R+1],m=C[R+2],this.mode){case"multiply":C[R]=d*n/255,C[R+1]=f*c/255,C[R+2]=m*_/255;break;case"screen":C[R]=255-(255-d)*(255-n)/255,C[R+1]=255-(255-f)*(255-c)/255,C[R+2]=255-(255-m)*(255-_)/255;break;case"add":C[R]=d+n,C[R+1]=f+c,C[R+2]=m+_;break;case"diff":case"difference":C[R]=Math.abs(d-n),C[R+1]=Math.abs(f-c),C[R+2]=Math.abs(m-_);break;case"subtract":C[R]=d-n,C[R+1]=f-c,C[R+2]=m-_;break;case"darken":C[R]=Math.min(d,n),C[R+1]=Math.min(f,c),C[R+2]=Math.min(m,_);break;case"lighten":C[R]=Math.max(d,n),C[R+1]=Math.max(f,c),C[R+2]=Math.max(m,_);break;case"overlay":C[R]=n<128?2*d*n/255:255-2*(255-d)*(255-n)/255,C[R+1]=c<128?2*f*c/255:255-2*(255-f)*(255-c)/255,C[R+2]=_<128?2*m*_/255:255-2*(255-m)*(255-_)/255;break;case"exclusion":C[R]=n+d-2*n*d/255,C[R+1]=c+f-2*c*f/255,C[R+2]=_+m-2*_*m/255;break;case"tint":C[R]=n+d*T,C[R+1]=c+f*T,C[R+2]=_+m*T}},getUniformLocations:function(i,n){return{uColor:i.getUniformLocation(n,"uColor")}},sendUniformData:function(i,n){var c=new s.Color(this.color).getSource();c[0]=this.alpha*c[0]/255,c[1]=this.alpha*c[1]/255,c[2]=this.alpha*c[2]/255,c[3]=this.alpha,i.uniform4fv(n.uColor,c)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric,a=s.Image.filters,u=s.util.createClass;a.BlendImage=u(a.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(i){var n=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return i.programCache.hasOwnProperty(n)||(i.programCache[n]=this.createProgram(i.context,c)),i.programCache[n]},applyToWebGL:function(i){var n=i.context,c=this.createTexture(i.filterBackend,this.image);this.bindAdditionalTexture(n,c,n.TEXTURE1),this.callSuper("applyToWebGL",i),this.unbindAdditionalTexture(n,n.TEXTURE1)},createTexture:function(i,n){return i.getCachedTexture(n.cacheKey,n._element)},calculateMatrix:function(){var i=this.image,n=i._element.width,c=i._element.height;return[1/i.scaleX,0,0,0,1/i.scaleY,0,-i.left/n,-i.top/c,1]},applyTo2d:function(i){var n,c,_,d,f,m,b,C,I,T,R,B=i.imageData,U=i.filterBackend.resources,X=B.data,Q=X.length,O=B.width,M=B.height,D=this.image;U.blendImage||(U.blendImage=s.util.createCanvasElement()),T=(I=U.blendImage).getContext("2d"),I.width!==O||I.height!==M?(I.width=O,I.height=M):T.clearRect(0,0,O,M),T.setTransform(D.scaleX,0,0,D.scaleY,D.left,D.top),T.drawImage(D._element,0,0,O,M),R=T.getImageData(0,0,O,M).data;for(var L=0;L<Q;L+=4)switch(f=X[L],m=X[L+1],b=X[L+2],C=X[L+3],n=R[L],c=R[L+1],_=R[L+2],d=R[L+3],this.mode){case"multiply":X[L]=f*n/255,X[L+1]=m*c/255,X[L+2]=b*_/255,X[L+3]=C*d/255;break;case"mask":X[L+3]=d}},getUniformLocations:function(i,n){return{uTransformMatrix:i.getUniformLocation(n,"uTransformMatrix"),uImage:i.getUniformLocation(n,"uImage")}},sendUniformData:function(i,n){var c=this.calculateMatrix();i.uniform1i(n.uImage,1),i.uniformMatrix3fv(n.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(i,n){s.Image.fromObject(i.image,function(c){var _=s.util.object.clone(i);_.image=c,n(new s.Image.filters.BlendImage(_))})}}(e),function(l){var s=l.fabric||(l.fabric={}),a=Math.pow,u=Math.floor,i=Math.sqrt,n=Math.abs,c=Math.round,_=Math.sin,d=Math.ceil,f=s.Image.filters,m=s.util.createClass;f.Resize=m(f.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(b,C){return{uDelta:b.getUniformLocation(C,"uDelta"),uTaps:b.getUniformLocation(C,"uTaps")}},sendUniformData:function(b,C){b.uniform2fv(C.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),b.uniform1fv(C.uTaps,this.taps)},retrieveShader:function(b){var C=this.getFilterWindow(),I=this.type+"_"+C;if(!b.programCache.hasOwnProperty(I)){var T=this.generateShader(C);b.programCache[I]=this.createProgram(b.context,T)}return b.programCache[I]},getFilterWindow:function(){var b=this.tempScale;return Math.ceil(this.lanczosLobes/b)},getTaps:function(){for(var b=this.lanczosCreate(this.lanczosLobes),C=this.tempScale,I=this.getFilterWindow(),T=new Array(I),R=1;R<=I;R++)T[R-1]=b(R*C);return T},generateShader:function(b){for(var C=new Array(b),I=this.fragmentSourceTOP,T=1;T<=b;T++)C[T-1]=T+".0 * uDelta";return I+="uniform float uTaps["+b+`];
`,I+=`void main() {
`,I+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,I+=`  float sum = 1.0;
`,C.forEach(function(R,B){I+="  color += texture2D(uTexture, vTexCoord + "+R+") * uTaps["+B+`];
`,I+="  color += texture2D(uTexture, vTexCoord - "+R+") * uTaps["+B+`];
`,I+="  sum += 2.0 * uTaps["+B+`];
`}),I+=`  gl_FragColor = color / sum;
`,I+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(b){b.webgl?(b.passes++,this.width=b.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=b.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),b.destinationWidth=this.dW,this._setupFrameBuffer(b),this.applyToWebGL(b),this._swapTextures(b),b.sourceWidth=b.destinationWidth,this.height=b.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),b.destinationHeight=this.dH,this._setupFrameBuffer(b),this.applyToWebGL(b),this._swapTextures(b),b.sourceHeight=b.destinationHeight):this.applyTo2d(b)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(b){return function(C){if(C>=b||C<=-b)return 0;if(C<11920929e-14&&C>-11920929e-14)return 1;var I=(C*=Math.PI)/b;return _(C)/C*_(I)/I}},applyTo2d:function(b){var C=b.imageData,I=this.scaleX,T=this.scaleY;this.rcpScaleX=1/I,this.rcpScaleY=1/T;var R,B=C.width,U=C.height,X=c(B*I),Q=c(U*T);this.resizeType==="sliceHack"?R=this.sliceByTwo(b,B,U,X,Q):this.resizeType==="hermite"?R=this.hermiteFastResize(b,B,U,X,Q):this.resizeType==="bilinear"?R=this.bilinearFiltering(b,B,U,X,Q):this.resizeType==="lanczos"&&(R=this.lanczosResize(b,B,U,X,Q)),b.imageData=R},sliceByTwo:function(b,C,I,T,R){var B,U,X=b.imageData,Q=.5,O=!1,M=!1,D=C*Q,L=I*Q,k=s.filterBackend.resources,V=0,G=0,P=C,F=0;for(k.sliceByTwo||(k.sliceByTwo=document.createElement("canvas")),((B=k.sliceByTwo).width<1.5*C||B.height<I)&&(B.width=1.5*C,B.height=I),(U=B.getContext("2d")).clearRect(0,0,1.5*C,I),U.putImageData(X,0,0),T=u(T),R=u(R);!O||!M;)C=D,I=L,T<u(D*Q)?D=u(D*Q):(D=T,O=!0),R<u(L*Q)?L=u(L*Q):(L=R,M=!0),U.drawImage(B,V,G,C,I,P,F,D,L),V=P,G=F,F+=L;return U.getImageData(V,G,T,R)},lanczosResize:function(b,C,I,T,R){var B=b.imageData.data,U=b.ctx.createImageData(T,R),X=U.data,Q=this.lanczosCreate(this.lanczosLobes),O=this.rcpScaleX,M=this.rcpScaleY,D=2/this.rcpScaleX,L=2/this.rcpScaleY,k=d(O*this.lanczosLobes/2),V=d(M*this.lanczosLobes/2),G={},P={},F={};return function N(K){var H,$,ie,re,ne,oe,ae,ce,de,ue,me;for(P.x=(K+.5)*O,F.x=u(P.x),H=0;H<R;H++){for(P.y=(H+.5)*M,F.y=u(P.y),ne=0,oe=0,ae=0,ce=0,de=0,$=F.x-k;$<=F.x+k;$++)if(!($<0||$>=C)){ue=u(1e3*n($-P.x)),G[ue]||(G[ue]={});for(var we=F.y-V;we<=F.y+V;we++)we<0||we>=I||(me=u(1e3*n(we-P.y)),G[ue][me]||(G[ue][me]=Q(i(a(ue*D,2)+a(me*L,2))/1e3)),(ie=G[ue][me])>0&&(ne+=ie,oe+=ie*B[re=4*(we*C+$)],ae+=ie*B[re+1],ce+=ie*B[re+2],de+=ie*B[re+3]))}X[re=4*(H*T+K)]=oe/ne,X[re+1]=ae/ne,X[re+2]=ce/ne,X[re+3]=de/ne}return++K<T?N(K):U}(0)},bilinearFiltering:function(b,C,I,T,R){var B,U,X,Q,O,M,D,L,k,V=0,G=this.rcpScaleX,P=this.rcpScaleY,F=4*(C-1),N=b.imageData.data,K=b.ctx.createImageData(T,R),H=K.data;for(X=0;X<R;X++)for(Q=0;Q<T;Q++)for(O=G*Q-(B=u(G*Q)),M=P*X-(U=u(P*X)),k=4*(U*C+B),D=0;D<4;D++)L=N[k+D]*(1-O)*(1-M)+N[k+4+D]*O*(1-M)+N[k+F+D]*M*(1-O)+N[k+F+4+D]*O*M,H[V++]=L;return K},hermiteFastResize:function(b,C,I,T,R){for(var B=this.rcpScaleX,U=this.rcpScaleY,X=d(B/2),Q=d(U/2),O=b.imageData.data,M=b.ctx.createImageData(T,R),D=M.data,L=0;L<R;L++)for(var k=0;k<T;k++){for(var V=4*(k+L*T),G=0,P=0,F=0,N=0,K=0,H=0,$=0,ie=(L+.5)*U,re=u(L*U);re<(L+1)*U;re++)for(var ne=n(ie-(re+.5))/Q,oe=(k+.5)*B,ae=ne*ne,ce=u(k*B);ce<(k+1)*B;ce++){var de=n(oe-(ce+.5))/X,ue=i(ae+de*de);ue>1&&ue<-1||(G=2*ue*ue*ue-3*ue*ue+1)>0&&($+=G*O[3+(de=4*(ce+re*C))],F+=G,O[de+3]<255&&(G=G*O[de+3]/250),N+=G*O[de],K+=G*O[de+1],H+=G*O[de+2],P+=G)}D[V]=N/P,D[V+1]=K/P,D[V+2]=H/P,D[V+3]=$/F}return M},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Contrast=u(a.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(i){if(this.contrast!==0){var n,c=i.imageData.data,_=c.length,d=Math.floor(255*this.contrast),f=259*(d+255)/(255*(259-d));for(n=0;n<_;n+=4)c[n]=f*(c[n]-128)+128,c[n+1]=f*(c[n+1]-128)+128,c[n+2]=f*(c[n+2]-128)+128}},getUniformLocations:function(i,n){return{uContrast:i.getUniformLocation(n,"uContrast")}},sendUniformData:function(i,n){i.uniform1f(n.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Saturation=u(a.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(i){if(this.saturation!==0){var n,c,_=i.imageData.data,d=_.length,f=-this.saturation;for(n=0;n<d;n+=4)c=Math.max(_[n],_[n+1],_[n+2]),_[n]+=c!==_[n]?(c-_[n])*f:0,_[n+1]+=c!==_[n+1]?(c-_[n+1])*f:0,_[n+2]+=c!==_[n+2]?(c-_[n+2])*f:0}},getUniformLocations:function(i,n){return{uSaturation:i.getUniformLocation(n,"uSaturation")}},sendUniformData:function(i,n){i.uniform1f(n.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Vibrance=u(a.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(i){if(this.vibrance!==0){var n,c,_,d,f=i.imageData.data,m=f.length,b=-this.vibrance;for(n=0;n<m;n+=4)c=Math.max(f[n],f[n+1],f[n+2]),_=(f[n]+f[n+1]+f[n+2])/3,d=2*Math.abs(c-_)/255*b,f[n]+=c!==f[n]?(c-f[n])*d:0,f[n+1]+=c!==f[n+1]?(c-f[n+1])*d:0,f[n+2]+=c!==f[n+2]?(c-f[n+2])*d:0}},getUniformLocations:function(i,n){return{uVibrance:i.getUniformLocation(n,"uVibrance")}},sendUniformData:function(i,n){i.uniform1f(n.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Blur=u(a.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(i){i.webgl?(this.aspectRatio=i.sourceWidth/i.sourceHeight,i.passes++,this._setupFrameBuffer(i),this.horizontal=!0,this.applyToWebGL(i),this._swapTextures(i),this._setupFrameBuffer(i),this.horizontal=!1,this.applyToWebGL(i),this._swapTextures(i)):this.applyTo2d(i)},applyTo2d:function(i){i.imageData=this.simpleBlur(i)},simpleBlur:function(i){var n,c,_=i.filterBackend.resources,d=i.imageData.width,f=i.imageData.height;_.blurLayer1||(_.blurLayer1=s.util.createCanvasElement(),_.blurLayer2=s.util.createCanvasElement()),n=_.blurLayer1,c=_.blurLayer2,n.width===d&&n.height===f||(c.width=n.width=d,c.height=n.height=f);var m,b,C,I,T=n.getContext("2d"),R=c.getContext("2d"),B=.06*this.blur*.5;for(T.putImageData(i.imageData,0,0),R.clearRect(0,0,d,f),I=-15;I<=15;I++)C=B*(b=I/15)*d+(m=(Math.random()-.5)/4),R.globalAlpha=1-Math.abs(b),R.drawImage(n,C,m),T.drawImage(c,0,0),R.globalAlpha=1,R.clearRect(0,0,c.width,c.height);for(I=-15;I<=15;I++)C=B*(b=I/15)*f+(m=(Math.random()-.5)/4),R.globalAlpha=1-Math.abs(b),R.drawImage(n,m,C),T.drawImage(c,0,0),R.globalAlpha=1,R.clearRect(0,0,c.width,c.height);i.ctx.drawImage(n,0,0);var U=i.ctx.getImageData(0,0,n.width,n.height);return T.globalAlpha=1,T.clearRect(0,0,n.width,n.height),U},getUniformLocations:function(i,n){return{delta:i.getUniformLocation(n,"uDelta")}},sendUniformData:function(i,n){var c=this.chooseRightDelta();i.uniform2fv(n.delta,c)},chooseRightDelta:function(){var i,n=1,c=[0,0];return this.horizontal?this.aspectRatio>1&&(n=1/this.aspectRatio):this.aspectRatio<1&&(n=this.aspectRatio),i=n*this.blur*.12,this.horizontal?c[0]=i:c[1]=i,c}}),a.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Gamma=u(a.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(i){this.gamma=[1,1,1],a.BaseFilter.prototype.initialize.call(this,i)},applyTo2d:function(i){var n,c=i.imageData.data,_=this.gamma,d=c.length,f=1/_[0],m=1/_[1],b=1/_[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),n=0,d=256;n<d;n++)this.rVals[n]=255*Math.pow(n/255,f),this.gVals[n]=255*Math.pow(n/255,m),this.bVals[n]=255*Math.pow(n/255,b);for(n=0,d=c.length;n<d;n+=4)c[n]=this.rVals[c[n]],c[n+1]=this.gVals[c[n+1]],c[n+2]=this.bVals[c[n+2]]},getUniformLocations:function(i,n){return{uGamma:i.getUniformLocation(n,"uGamma")}},sendUniformData:function(i,n){i.uniform3fv(n.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.Composed=u(a.BaseFilter,{type:"Composed",subFilters:[],initialize:function(i){this.callSuper("initialize",i),this.subFilters=this.subFilters.slice(0)},applyTo:function(i){i.passes+=this.subFilters.length-1,this.subFilters.forEach(function(n){n.applyTo(i)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(i){return i.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(i){return!i.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(i,n){var c=(i.subFilters||[]).map(function(d){return new s.Image.filters[d.type](d)}),_=new s.Image.filters.Composed({subFilters:c});return n&&n(_),_}}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.Image.filters,u=s.util.createClass;a.HueRotation=u(a.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var i=this.rotation*Math.PI,n=s.util.cos(i),c=s.util.sin(i),_=1/3,d=Math.sqrt(_)*c,f=1-n;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=n+f/3,this.matrix[1]=_*f-d,this.matrix[2]=_*f+d,this.matrix[5]=_*f+d,this.matrix[6]=n+_*f,this.matrix[7]=_*f-d,this.matrix[10]=_*f-d,this.matrix[11]=_*f+d,this.matrix[12]=n+_*f},isNeutralState:function(i){return this.calculateMatrix(),a.BaseFilter.prototype.isNeutralState.call(this,i)},applyTo:function(i){this.calculateMatrix(),a.BaseFilter.prototype.applyTo.call(this,i)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),a=s.util.object.clone;if(s.Text)s.warn("fabric.Text is already defined");else{var u="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(u),cacheProperties:s.Object.prototype.cacheProperties.concat(u),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,n){this.styles=n&&n.styles||{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",n),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var i=this.path;i&&(i.segmentsInfo=s.util.getPathSegmentsInfo(i.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var i,n,c,_,d,f,m,b=0,C=this._textLines.length;b<C;b++)if((this.textAlign==="justify"||b!==C-1&&!this.isEndOfWrapping(b))&&(_=0,d=this._textLines[b],(n=this.getLineWidth(b))<this.width&&(m=this.textLines[b].match(this._reSpacesAndTabs)))){c=m.length,i=(this.width-n)/c;for(var I=0,T=d.length;I<=T;I++)f=this.__charBounds[b][I],this._reSpaceAndTab.test(d[I])?(f.width+=i,f.kernedWidth+=i,f.left+=_,_+=i):f.left+=_}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),n=this.fontSize;return i.width+=n*i.zoomX,i.height+=n*i.zoomY,i},_render:function(i){var n=this.path;n&&!n.isNotVisible()&&n._render(i),this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){this.paintFirst==="stroke"?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,n,c){if(i.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":i.textBaseline="middle";break;case"ascender":i.textBaseline="top";break;case"descender":i.textBaseline="bottom"}i.font=this._getFontDeclaration(n,c)},calcTextWidth:function(){for(var i=this.getLineWidth(0),n=1,c=this._textLines.length;n<c;n++){var _=this.getLineWidth(n);_>i&&(i=_)}return i},_renderTextLine:function(i,n,c,_,d,f){this._renderChars(i,n,c,_,d,f)},_renderTextLinesBackground:function(i){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var n,c,_,d,f,m,b,C=i.fillStyle,I=this._getLeftOffset(),T=this._getTopOffset(),R=0,B=0,U=this.path,X=0,Q=this._textLines.length;X<Q;X++)if(n=this.getHeightOfLine(X),this.textBackgroundColor||this.styleHas("textBackgroundColor",X)){_=this._textLines[X],c=this._getLineLeftOffset(X),B=0,R=0,d=this.getValueOfPropertyAt(X,0,"textBackgroundColor");for(var O=0,M=_.length;O<M;O++)f=this.__charBounds[X][O],m=this.getValueOfPropertyAt(X,O,"textBackgroundColor"),U?(i.save(),i.translate(f.renderLeft,f.renderTop),i.rotate(f.angle),i.fillStyle=m,m&&i.fillRect(-f.width/2,-n/this.lineHeight*(1-this._fontSizeFraction),f.width,n/this.lineHeight),i.restore()):m!==d?(b=I+c+R,this.direction==="rtl"&&(b=this.width-b-B),i.fillStyle=d,d&&i.fillRect(b,T,B,n/this.lineHeight),R=f.left,B=f.width,d=m):B+=f.kernedWidth;m&&!U&&(b=I+c+R,this.direction==="rtl"&&(b=this.width-b-B),i.fillStyle=m,i.fillRect(b,T,B,n/this.lineHeight)),T+=n}else T+=n;i.fillStyle=C,this._removeShadow(i)}},getFontCache:function(i){var n=i.fontFamily.toLowerCase();s.charWidthsCache[n]||(s.charWidthsCache[n]={});var c=s.charWidthsCache[n],_=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return c[_]||(c[_]={}),c[_]},_measureChar:function(i,n,c,_){var d,f,m,b,C=this.getFontCache(n),I=c+i,T=this._getFontDeclaration(n)===this._getFontDeclaration(_),R=n.fontSize/this.CACHE_FONT_SIZE;if(c&&C[c]!==void 0&&(m=C[c]),C[i]!==void 0&&(b=d=C[i]),T&&C[I]!==void 0&&(b=(f=C[I])-m),d===void 0||m===void 0||f===void 0){var B=this.getMeasuringContext();this._setTextStyles(B,n,!0)}return d===void 0&&(b=d=B.measureText(i).width,C[i]=d),m===void 0&&T&&c&&(m=B.measureText(c).width,C[c]=m),T&&f===void 0&&(f=B.measureText(I).width,C[I]=f,b=f-m),{width:d*R,kernedWidth:b*R}},getHeightOfChar:function(i,n){return this.getValueOfPropertyAt(i,n,"fontSize")},measureLine:function(i){var n=this._measureLine(i);return this.charSpacing!==0&&(n.width-=this._getWidthOfCharSpacing()),n.width<0&&(n.width=0),n},_measureLine:function(i){var n,c,_,d,f,m,b=0,C=this._textLines[i],I=new Array(C.length),T=0,R=this.path,B=this.pathSide==="right";for(this.__charBounds[i]=I,n=0;n<C.length;n++)c=C[n],d=this._getGraphemeBox(c,i,n,_),I[n]=d,b+=d.kernedWidth,_=c;if(I[n]={left:d?d.left+d.width:0,width:0,kernedWidth:0,height:this.fontSize},R){switch(m=R.segmentsInfo[R.segmentsInfo.length-1].length,(f=s.util.getPointOnPath(R.path,0,R.segmentsInfo)).x+=R.pathOffset.x,f.y+=R.pathOffset.y,this.textAlign){case"left":T=B?m-b:0;break;case"center":T=(m-b)/2;break;case"right":T=B?0:m-b}for(T+=this.pathStartOffset*(B?-1:1),n=B?C.length-1:0;B?n>=0:n<C.length;B?n--:n++)d=I[n],T>m?T%=m:T<0&&(T+=m),this._setGraphemeOnPath(T,d,f),T+=d.kernedWidth}return{width:b,numOfSpaces:0}},_setGraphemeOnPath:function(i,n,c){var _=i+n.kernedWidth/2,d=this.path,f=s.util.getPointOnPath(d.path,_,d.segmentsInfo);n.renderLeft=f.x-c.x,n.renderTop=f.y-c.y,n.angle=f.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(i,n,c,_,d){var f,m=this.getCompleteStyleDeclaration(n,c),b=_?this.getCompleteStyleDeclaration(n,c-1):{},C=this._measureChar(i,m,_,b),I=C.kernedWidth,T=C.width;this.charSpacing!==0&&(T+=f=this._getWidthOfCharSpacing(),I+=f);var R={width:T,left:0,height:m.fontSize,kernedWidth:I,deltaY:m.deltaY};if(c>0&&!d){var B=this.__charBounds[n][c-1];R.left=B.left+B.width+C.kernedWidth-C.width}return R},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var n=this._textLines[i],c=this.getHeightOfChar(i,0),_=1,d=n.length;_<d;_++)c=Math.max(this.getHeightOfChar(i,_),c);return this.__lineHeights[i]=c*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,n=0,c=0,_=this._textLines.length;c<_;c++)i=this.getHeightOfLine(c),n+=c===_-1?i/this.lineHeight:i;return n},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(i,n){i.save();for(var c=0,_=this._getLeftOffset(),d=this._getTopOffset(),f=0,m=this._textLines.length;f<m;f++){var b=this.getHeightOfLine(f),C=b/this.lineHeight,I=this._getLineLeftOffset(f);this._renderTextLine(n,i,this._textLines[f],_+I,d+c+C,f),c+=b}i.restore()},_renderTextFill:function(i){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore())},_renderChars:function(i,n,c,_,d,f){var m,b,C,I,T,R=this.getHeightOfLine(f),B=this.textAlign.indexOf("justify")!==-1,U="",X=0,Q=this.path,O=!B&&this.charSpacing===0&&this.isEmptyStyles(f)&&!Q,M=this.direction==="ltr",D=this.direction==="ltr"?1:-1,L=n.canvas.getAttribute("dir");if(n.save(),L!==this.direction&&(n.canvas.setAttribute("dir",M?"ltr":"rtl"),n.direction=M?"ltr":"rtl",n.textAlign=M?"left":"right"),d-=R*this._fontSizeFraction/this.lineHeight,O)return this._renderChar(i,n,f,0,c.join(""),_,d,R),void n.restore();for(var k=0,V=c.length-1;k<=V;k++)I=k===V||this.charSpacing||Q,U+=c[k],C=this.__charBounds[f][k],X===0?(_+=D*(C.kernedWidth-C.width),X+=C.width):X+=C.kernedWidth,B&&!I&&this._reSpaceAndTab.test(c[k])&&(I=!0),I||(m=m||this.getCompleteStyleDeclaration(f,k),b=this.getCompleteStyleDeclaration(f,k+1),I=this._hasStyleChanged(m,b)),I&&(Q?(n.save(),n.translate(C.renderLeft,C.renderTop),n.rotate(C.angle),this._renderChar(i,n,f,k,U,-X/2,0,R),n.restore()):(T=_,this._renderChar(i,n,f,k,U,T,d,R)),U="",m=b,_+=D*X,X=0);n.restore()},_applyPatternGradientTransformText:function(i){var n,c=s.util.createCanvasElement(),_=this.width+this.strokeWidth,d=this.height+this.strokeWidth;return c.width=_,c.height=d,(n=c.getContext("2d")).beginPath(),n.moveTo(0,0),n.lineTo(_,0),n.lineTo(_,d),n.lineTo(0,d),n.closePath(),n.translate(_/2,d/2),n.fillStyle=i.toLive(n),this._applyPatternGradientTransform(n,i),n.fill(),n.createPattern(c,"no-repeat")},handleFiller:function(i,n,c){var _,d;return c.toLive?c.gradientUnits==="percentage"||c.gradientTransform||c.patternTransform?(_=-this.width/2,d=-this.height/2,i.translate(_,d),i[n]=this._applyPatternGradientTransformText(c),{offsetX:_,offsetY:d}):(i[n]=c.toLive(i,this),this._applyPatternGradientTransform(i,c)):(i[n]=c,{offsetX:0,offsetY:0})},_setStrokeStyles:function(i,n){return i.lineWidth=n.strokeWidth,i.lineCap=this.strokeLineCap,i.lineDashOffset=this.strokeDashOffset,i.lineJoin=this.strokeLineJoin,i.miterLimit=this.strokeMiterLimit,this.handleFiller(i,"strokeStyle",n.stroke)},_setFillStyles:function(i,n){return this.handleFiller(i,"fillStyle",n.fill)},_renderChar:function(i,n,c,_,d,f,m){var b,C,I=this._getStyleDeclaration(c,_),T=this.getCompleteStyleDeclaration(c,_),R=i==="fillText"&&T.fill,B=i==="strokeText"&&T.stroke&&T.strokeWidth;(B||R)&&(n.save(),R&&(b=this._setFillStyles(n,T)),B&&(C=this._setStrokeStyles(n,T)),n.font=this._getFontDeclaration(T),I&&I.textBackgroundColor&&this._removeShadow(n),I&&I.deltaY&&(m+=I.deltaY),R&&n.fillText(d,f-b.offsetX,m-b.offsetY),B&&n.strokeText(d,f-C.offsetX,m-C.offsetY),n.restore())},setSuperscript:function(i,n){return this._setScript(i,n,this.superscript)},setSubscript:function(i,n){return this._setScript(i,n,this.subscript)},_setScript:function(i,n,c){var _=this.get2DCursorLocation(i,!0),d=this.getValueOfPropertyAt(_.lineIndex,_.charIndex,"fontSize"),f=this.getValueOfPropertyAt(_.lineIndex,_.charIndex,"deltaY"),m={fontSize:d*c.size,deltaY:f+d*c.baseline};return this.setSelectionStyles(m,i,n),this},_hasStyleChanged:function(i,n){return i.fill!==n.fill||i.stroke!==n.stroke||i.strokeWidth!==n.strokeWidth||i.fontSize!==n.fontSize||i.fontFamily!==n.fontFamily||i.fontWeight!==n.fontWeight||i.fontStyle!==n.fontStyle||i.deltaY!==n.deltaY},_hasStyleChangedForSvg:function(i,n){return this._hasStyleChanged(i,n)||i.overline!==n.overline||i.underline!==n.underline||i.linethrough!==n.linethrough},_getLineLeftOffset:function(i){var n=this.getLineWidth(i),c=this.width-n,_=this.textAlign,d=this.direction,f=0,m=this.isEndOfWrapping(i);return _==="justify"||_==="justify-center"&&!m||_==="justify-right"&&!m||_==="justify-left"&&!m?0:(_==="center"&&(f=c/2),_==="right"&&(f=c),_==="justify-center"&&(f=c/2),_==="justify-right"&&(f=c),d==="rtl"&&(f-=c),f)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(this.__lineWidths[i]!==void 0)return this.__lineWidths[i];var n=this.measureLine(i).width;return this.__lineWidths[i]=n,n},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,n,c){var _=this._getStyleDeclaration(i,n);return _&&_[c]!==void 0?_[c]:this[c]},_renderTextDecoration:function(i,n){if(this[n]||this.styleHas(n)){for(var c,_,d,f,m,b,C,I,T,R,B,U,X,Q,O,M,D=this._getLeftOffset(),L=this._getTopOffset(),k=this.path,V=this._getWidthOfCharSpacing(),G=this.offsets[n],P=0,F=this._textLines.length;P<F;P++)if(c=this.getHeightOfLine(P),this[n]||this.styleHas(n,P)){C=this._textLines[P],Q=c/this.lineHeight,f=this._getLineLeftOffset(P),R=0,B=0,I=this.getValueOfPropertyAt(P,0,n),M=this.getValueOfPropertyAt(P,0,"fill"),T=L+Q*(1-this._fontSizeFraction),_=this.getHeightOfChar(P,0),m=this.getValueOfPropertyAt(P,0,"deltaY");for(var N=0,K=C.length;N<K;N++)if(U=this.__charBounds[P][N],X=this.getValueOfPropertyAt(P,N,n),O=this.getValueOfPropertyAt(P,N,"fill"),d=this.getHeightOfChar(P,N),b=this.getValueOfPropertyAt(P,N,"deltaY"),k&&X&&O)i.save(),i.fillStyle=M,i.translate(U.renderLeft,U.renderTop),i.rotate(U.angle),i.fillRect(-U.kernedWidth/2,G*d+b,U.kernedWidth,this.fontSize/15),i.restore();else if((X!==I||O!==M||d!==_||b!==m)&&B>0){var H=D+f+R;this.direction==="rtl"&&(H=this.width-H-B),I&&M&&(i.fillStyle=M,i.fillRect(H,T+G*_+m,B,this.fontSize/15)),R=U.left,B=U.width,I=X,M=O,_=d,m=b}else B+=U.kernedWidth;H=D+f+R,this.direction==="rtl"&&(H=this.width-H-B),i.fillStyle=O,X&&O&&i.fillRect(H,T+G*_+m,B-V,this.fontSize/15),L+=c}else L+=c;this._removeShadow(i)}},_getFontDeclaration:function(i,n){var c=i||this,_=this.fontFamily,d=s.Text.genericFonts.indexOf(_.toLowerCase())>-1,f=_===void 0||_.indexOf("'")>-1||_.indexOf(",")>-1||_.indexOf('"')>-1||d?c.fontFamily:'"'+c.fontFamily+'"';return[s.isLikelyNode?c.fontWeight:c.fontStyle,s.isLikelyNode?c.fontStyle:c.fontWeight,n?this.CACHE_FONT_SIZE+"px":c.fontSize+"px",f].join(" ")},render:function(i){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i)))},_splitTextIntoLines:function(i){for(var n=i.split(this._reNewline),c=new Array(n.length),_=[`
`],d=[],f=0;f<n.length;f++)c[f]=s.util.string.graphemeSplit(n[f]),d=d.concat(c[f],_);return d.pop(),{_unwrappedLines:c,lines:n,graphemeText:d,graphemeLines:c}},toObject:function(i){var n=u.concat(i),c=this.callSuper("toObject",n);return c.styles=a(this.styles,!0),c.path&&(c.path=this.path.toObject()),c},set:function(i,n){this.callSuper("set",i,n);var c=!1,_=!1;if(typeof i=="object")for(var d in i)d==="path"&&this.setPathInfo(),c=c||this._dimensionAffectingProps.indexOf(d)!==-1,_=_||d==="path";else c=this._dimensionAffectingProps.indexOf(i)!==-1,_=i==="path";return _&&this.setPathInfo(),c&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(i,n,c){if(!i)return n(null);var _=s.parseAttributes(i,s.Text.ATTRIBUTE_NAMES),d=_.textAnchor||"left";if((c=s.util.object.extend(c?a(c):{},_)).top=c.top||0,c.left=c.left||0,_.textDecoration){var f=_.textDecoration;f.indexOf("underline")!==-1&&(c.underline=!0),f.indexOf("overline")!==-1&&(c.overline=!0),f.indexOf("line-through")!==-1&&(c.linethrough=!0),delete c.textDecoration}"dx"in _&&(c.left+=_.dx),"dy"in _&&(c.top+=_.dy),"fontSize"in c||(c.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var m="";"textContent"in i?m=i.textContent:"firstChild"in i&&i.firstChild!==null&&"data"in i.firstChild&&i.firstChild.data!==null&&(m=i.firstChild.data),m=m.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var b=c.strokeWidth;c.strokeWidth=0;var C=new s.Text(m,c),I=C.getScaledHeight()/C.height,T=((C.height+C.strokeWidth)*C.lineHeight-C.height)*I,R=C.getScaledHeight()+T,B=0;d==="center"&&(B=C.getScaledWidth()/2),d==="right"&&(B=C.getScaledWidth()),C.set({left:C.left-B,top:C.top-(R-C.fontSize*(.07+C._fontSizeFraction))/C.lineHeight,strokeWidth:b!==void 0?b:1}),n(C)},s.Text.fromObject=function(i,n){var c=a(i),_=i.path;return delete c.path,s.Object._fromObject("Text",c,function(d){_?s.Object._fromObject("Path",_,function(f){d.set("path",f),n(d)},"path"):n(d)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}}(e),y.util.object.extend(y.Text.prototype,{isEmptyStyles:function(l){if(!this.styles||l!==void 0&&!this.styles[l])return!0;var s=l===void 0?this.styles:{line:this.styles[l]};for(var a in s)for(var u in s[a])for(var i in s[a][u])return!1;return!0},styleHas:function(l,s){if(!this.styles||!l||l===""||s!==void 0&&!this.styles[s])return!1;var a=s===void 0?this.styles:{0:this.styles[s]};for(var u in a)for(var i in a[u])if(a[u][i][l]!==void 0)return!0;return!1},cleanStyle:function(l){if(!this.styles||!l||l==="")return!1;var s,a,u=this.styles,i=0,n=!0,c=0;for(var _ in u){for(var d in s=0,u[_]){var f;i++,(f=u[_][d]).hasOwnProperty(l)?(a?f[l]!==a&&(n=!1):a=f[l],f[l]===this[l]&&delete f[l]):n=!1,Object.keys(f).length!==0?s++:delete u[_][d]}s===0&&delete u[_]}for(var m=0;m<this._textLines.length;m++)c+=this._textLines[m].length;n&&i===c&&(this[l]=a,this.removeStyle(l))},removeStyle:function(l){if(this.styles&&l&&l!==""){var s,a,u,i=this.styles;for(a in i){for(u in s=i[a])delete s[u][l],Object.keys(s[u]).length===0&&delete s[u];Object.keys(s).length===0&&delete i[a]}}},_extendStyles:function(l,s){var a=this.get2DCursorLocation(l);this._getLineStyle(a.lineIndex)||this._setLineStyle(a.lineIndex),this._getStyleDeclaration(a.lineIndex,a.charIndex)||this._setStyleDeclaration(a.lineIndex,a.charIndex,{}),y.util.object.extend(this._getStyleDeclaration(a.lineIndex,a.charIndex),s)},get2DCursorLocation:function(l,s){l===void 0&&(l=this.selectionStart);for(var a=s?this._unwrappedTextLines:this._textLines,u=a.length,i=0;i<u;i++){if(l<=a[i].length)return{lineIndex:i,charIndex:l};l-=a[i].length+this.missingNewlineOffset(i)}return{lineIndex:i-1,charIndex:a[i-1].length<l?a[i-1].length:l}},getSelectionStyles:function(l,s,a){l===void 0&&(l=this.selectionStart||0),s===void 0&&(s=this.selectionEnd||l);for(var u=[],i=l;i<s;i++)u.push(this.getStyleAtPosition(i,a));return u},getStyleAtPosition:function(l,s){var a=this.get2DCursorLocation(l);return(s?this.getCompleteStyleDeclaration(a.lineIndex,a.charIndex):this._getStyleDeclaration(a.lineIndex,a.charIndex))||{}},setSelectionStyles:function(l,s,a){s===void 0&&(s=this.selectionStart||0),a===void 0&&(a=this.selectionEnd||s);for(var u=s;u<a;u++)this._extendStyles(u,l);return this._forceClearCache=!0,this},_getStyleDeclaration:function(l,s){var a=this.styles&&this.styles[l];return a?a[s]:null},getCompleteStyleDeclaration:function(l,s){for(var a,u=this._getStyleDeclaration(l,s)||{},i={},n=0;n<this._styleProperties.length;n++)i[a=this._styleProperties[n]]=u[a]===void 0?this[a]:u[a];return i},_setStyleDeclaration:function(l,s,a){this.styles[l][s]=a},_deleteStyleDeclaration:function(l,s){delete this.styles[l][s]},_getLineStyle:function(l){return!!this.styles[l]},_setLineStyle:function(l){this.styles[l]={}},_deleteLineStyle:function(l){delete this.styles[l]}}),function(){function l(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}y.IText=y.util.createClass(y.Text,y.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,a){this.callSuper("initialize",s,a),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,a){this[s]!==a&&(this._fireSelectionChanged(),this[s]=a),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var a=this.canvas.contextTop,u=this.canvas.viewportTransform;a.save(),a.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this.transform(a),this._clearTextArea(a),s||a.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var s=this._getCursorBoundaries(),a=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,a):this.renderSelection(s,a),a.restore()}},_clearTextArea:function(s){var a=this.width+4,u=this.height+4;s.clearRect(-a/2,-u/2,a,u)},_getCursorBoundaries:function(s){s===void 0&&(s=this.selectionStart);var a=this._getLeftOffset(),u=this._getTopOffset(),i=this._getCursorBoundariesOffsets(s);return{left:a,top:u,leftOffset:i.left,topOffset:i.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var a,u,i,n,c=0,_=0,d=this.get2DCursorLocation(s);i=d.charIndex,u=d.lineIndex;for(var f=0;f<u;f++)c+=this.getHeightOfLine(f);a=this._getLineLeftOffset(u);var m=this.__charBounds[u][i];return m&&(_=m.left),this.charSpacing!==0&&i===this._textLines[u].length&&(_-=this._getWidthOfCharSpacing()),n={top:c,left:a+(_>0?_:0)},this.direction==="rtl"&&(n.left*=-1),this.cursorOffsetCache=n,this.cursorOffsetCache},renderCursor:function(s,a){var u=this.get2DCursorLocation(),i=u.lineIndex,n=u.charIndex>0?u.charIndex-1:0,c=this.getValueOfPropertyAt(i,n,"fontSize"),_=this.scaleX*this.canvas.getZoom(),d=this.cursorWidth/_,f=s.topOffset,m=this.getValueOfPropertyAt(i,n,"deltaY");f+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-c*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,a),a.fillStyle=this.cursorColor||this.getValueOfPropertyAt(i,n,"fill"),a.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,a.fillRect(s.left+s.leftOffset-d/2,f+s.top+m,d,c)},renderSelection:function(s,a){for(var u=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,i=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,n=this.textAlign.indexOf("justify")!==-1,c=this.get2DCursorLocation(u),_=this.get2DCursorLocation(i),d=c.lineIndex,f=_.lineIndex,m=c.charIndex<0?0:c.charIndex,b=_.charIndex<0?0:_.charIndex,C=d;C<=f;C++){var I,T=this._getLineLeftOffset(C)||0,R=this.getHeightOfLine(C),B=0,U=0;if(C===d&&(B=this.__charBounds[d][m].left),C>=d&&C<f)U=n&&!this.isEndOfWrapping(C)?this.width:this.getLineWidth(C)||5;else if(C===f)if(b===0)U=this.__charBounds[f][b].left;else{var X=this._getWidthOfCharSpacing();U=this.__charBounds[f][b-1].left+this.__charBounds[f][b-1].width-X}I=R,(this.lineHeight<1||C===f&&this.lineHeight>1)&&(R/=this.lineHeight);var Q=s.left+T+B,O=U-B,M=R,D=0;this.inCompositionMode?(a.fillStyle=this.compositionColor||"black",M=1,D=R):a.fillStyle=this.selectionColor,this.direction==="rtl"&&(Q=this.width-Q-O),a.fillRect(Q,s.top+s.topOffset+D,O,M),s.topOffset+=I}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),a=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:a}}}),y.IText.fromObject=function(s,a){if(l(s),s.styles)for(var u in s.styles)for(var i in s.styles[u])l(s.styles[u][i]);y.Object._fromObject("IText",s,a,"text")}}(),_e=y.util.object.clone,y.util.object.extend(y.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var l=this;this.on("added",function(){var s=l.canvas;s&&(s._hasITextHandlers||(s._hasITextHandlers=!0,l._initCanvasHandlers(s)),s._iTextInstances=s._iTextInstances||[],s._iTextInstances.push(l))})},initRemovedHandler:function(){var l=this;this.on("removed",function(){var s=l.canvas;s&&(s._iTextInstances=s._iTextInstances||[],y.util.removeFromArray(s._iTextInstances,l),s._iTextInstances.length===0&&(s._hasITextHandlers=!1,l._removeCanvasHandlers(s)))})},_initCanvasHandlers:function(l){l._mouseUpITextHandler=function(){l._iTextInstances&&l._iTextInstances.forEach(function(s){s.__isMousedown=!1})},l.on("mouse:up",l._mouseUpITextHandler)},_removeCanvasHandlers:function(l){l.off("mouse:up",l._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(l,s,a,u){var i;return i={isAborted:!1,abort:function(){this.isAborted=!0}},l.animate("_currentCursorOpacity",s,{duration:a,onComplete:function(){i.isAborted||l[u]()},onChange:function(){l.canvas&&l.selectionStart===l.selectionEnd&&l.renderCursorOrSelection()},abort:function(){return i.isAborted}}),i},_onTickComplete:function(){var l=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){l._currentTickCompleteState=l._animateCursor(l,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(l){var s=this,a=l?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){s._tick()},a)},abortCursorAnimation:function(){var l=this._currentTickState||this._currentTickCompleteState,s=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,l&&s&&s.clearContext(s.contextTop||s.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(l){var s=0,a=l-1;if(this._reSpace.test(this._text[a]))for(;this._reSpace.test(this._text[a]);)s++,a--;for(;/\S/.test(this._text[a])&&a>-1;)s++,a--;return l-s},findWordBoundaryRight:function(l){var s=0,a=l;if(this._reSpace.test(this._text[a]))for(;this._reSpace.test(this._text[a]);)s++,a++;for(;/\S/.test(this._text[a])&&a<this._text.length;)s++,a++;return l+s},findLineBoundaryLeft:function(l){for(var s=0,a=l-1;!/\n/.test(this._text[a])&&a>-1;)s++,a--;return l-s},findLineBoundaryRight:function(l){for(var s=0,a=l;!/\n/.test(this._text[a])&&a<this._text.length;)s++,a++;return l+s},searchWordBoundary:function(l,s){for(var a=this._text,u=this._reSpace.test(a[l])?l-1:l,i=a[u],n=y.reNonWord;!n.test(i)&&u>0&&u<a.length;)i=a[u+=s];return n.test(i)&&(u+=s===1?0:1),u},selectWord:function(l){l=l||this.selectionStart;var s=this.searchWordBoundary(l,-1),a=this.searchWordBoundary(l,1);this.selectionStart=s,this.selectionEnd=a,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(l){l=l||this.selectionStart;var s=this.findLineBoundaryLeft(l),a=this.findLineBoundaryRight(l);return this.selectionStart=s,this.selectionEnd=a,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(l){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(l),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(l){l._iTextInstances&&l._iTextInstances.forEach(function(s){s.selected=!1,s.isEditing&&s.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(l){if(this.__isMousedown&&this.isEditing){var s=this.getSelectionStartFromPointer(l.e),a=this.selectionStart,u=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&a!==u||a!==s&&u!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===a&&this.selectionEnd===u||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(l,s,a){var u=a.slice(0,l),i=y.util.string.graphemeSplit(u).length;if(l===s)return{selectionStart:i,selectionEnd:i};var n=a.slice(l,s);return{selectionStart:i,selectionEnd:i+y.util.string.graphemeSplit(n).length}},fromGraphemeToStringSelection:function(l,s,a){var u=a.slice(0,l).join("").length;return l===s?{selectionStart:u,selectionEnd:u}:{selectionStart:u,selectionEnd:u+a.slice(l,s).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var l=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=l.selectionStart,this.hiddenTextarea.selectionEnd=l.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var l=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=l.selectionEnd,this.inCompositionMode||(this.selectionStart=l.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var l=this._calcTextareaPosition();this.hiddenTextarea.style.left=l.left,this.hiddenTextarea.style.top=l.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var l=this.inCompositionMode?this.compositionStart:this.selectionStart,s=this._getCursorBoundaries(l),a=this.get2DCursorLocation(l),u=a.lineIndex,i=a.charIndex,n=this.getValueOfPropertyAt(u,i,"fontSize")*this.lineHeight,c=s.leftOffset,_=this.calcTransformMatrix(),d={x:s.left+c,y:s.top+s.topOffset+n},f=this.canvas.getRetinaScaling(),m=this.canvas.upperCanvasEl,b=m.width/f,C=m.height/f,I=b-n,T=C-n,R=m.clientWidth/b,B=m.clientHeight/C;return d=y.util.transformPoint(d,_),(d=y.util.transformPoint(d,this.canvas.viewportTransform)).x*=R,d.y*=B,d.x<0&&(d.x=0),d.x>I&&(d.x=I),d.y<0&&(d.y=0),d.y>T&&(d.y=T),d.x+=this.canvas._offset.left,d.y+=this.canvas._offset.top,{left:d.x+"px",top:d.y+"px",fontSize:n+"px",charHeight:n}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var l=this._textBeforeEdit!==this.text,s=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,s&&(s.blur&&s.blur(),s.parentNode&&s.parentNode.removeChild(s)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),l&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),l&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var l in this.styles)this._textLines[l]||delete this.styles[l]},removeStyleFromTo:function(l,s){var a,u,i=this.get2DCursorLocation(l,!0),n=this.get2DCursorLocation(s,!0),c=i.lineIndex,_=i.charIndex,d=n.lineIndex,f=n.charIndex;if(c!==d){if(this.styles[c])for(a=_;a<this._unwrappedTextLines[c].length;a++)delete this.styles[c][a];if(this.styles[d])for(a=f;a<this._unwrappedTextLines[d].length;a++)(u=this.styles[d][a])&&(this.styles[c]||(this.styles[c]={}),this.styles[c][_+a-f]=u);for(a=c+1;a<=d;a++)delete this.styles[a];this.shiftLineStyles(d,c-d)}else if(this.styles[c]){u=this.styles[c];var m,b,C=f-_;for(a=_;a<f;a++)delete u[a];for(b in this.styles[c])(m=parseInt(b,10))>=f&&(u[m-C]=u[b],delete u[b])}},shiftLineStyles:function(l,s){var a=_e(this.styles);for(var u in this.styles){var i=parseInt(u,10);i>l&&(this.styles[i+s]=a[i],a[i-s]||delete this.styles[i])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(l,s,a,u){var i,n={},c=!1,_=this._unwrappedTextLines[l].length===s;for(var d in a||(a=1),this.shiftLineStyles(l,a),this.styles[l]&&(i=this.styles[l][s===0?s:s-1]),this.styles[l]){var f=parseInt(d,10);f>=s&&(c=!0,n[f-s]=this.styles[l][d],_&&s===0||delete this.styles[l][d])}var m=!1;for(c&&!_&&(this.styles[l+a]=n,m=!0),m&&a--;a>0;)u&&u[a-1]?this.styles[l+a]={0:_e(u[a-1])}:i?this.styles[l+a]={0:_e(i)}:delete this.styles[l+a],a--;this._forceClearCache=!0},insertCharStyleObject:function(l,s,a,u){this.styles||(this.styles={});var i=this.styles[l],n=i?_e(i):{};for(var c in a||(a=1),n){var _=parseInt(c,10);_>=s&&(i[_+a]=n[_],n[_-a]||delete i[_])}if(this._forceClearCache=!0,u)for(;a--;)Object.keys(u[a]).length&&(this.styles[l]||(this.styles[l]={}),this.styles[l][s+a]=_e(u[a]));else if(i)for(var d=i[s?s-1:1];d&&a--;)this.styles[l][s+a]=_e(d)},insertNewStyleBlock:function(l,s,a){for(var u=this.get2DCursorLocation(s,!0),i=[0],n=0,c=0;c<l.length;c++)l[c]===`
`?i[++n]=0:i[n]++;for(i[0]>0&&(this.insertCharStyleObject(u.lineIndex,u.charIndex,i[0],a),a=a&&a.slice(i[0]+1)),n&&this.insertNewlineStyleObject(u.lineIndex,u.charIndex+i[0],n),c=1;c<n;c++)i[c]>0?this.insertCharStyleObject(u.lineIndex+c,0,i[c],a):a&&this.styles[u.lineIndex+c]&&a[0]&&(this.styles[u.lineIndex+c][0]=a[0]),a=a&&a.slice(i[c]+1);i[c]>0&&this.insertCharStyleObject(u.lineIndex+c,0,i[c],a)},setSelectionStartEndWithShift:function(l,s,a){a<=l?(s===l?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=l),this.selectionStart=a):a>l&&a<s?this._selectionDirection==="right"?this.selectionEnd=a:this.selectionStart=a:(s===l?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=s),this.selectionEnd=a)},setSelectionInBoundaries:function(){var l=this.text.length;this.selectionStart>l?this.selectionStart=l:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>l?this.selectionEnd=l:this.selectionEnd<0&&(this.selectionEnd=0)}}),y.util.object.extend(y.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(l){if(this.canvas){this.__newClickTime=+new Date;var s=l.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",l),this._stopEvent(l.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(l){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===l.x&&this.__lastPointer.y===l.y},_stopEvent:function(l){l.preventDefault&&l.preventDefault(),l.stopPropagation&&l.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(l){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(l.e))},tripleClickHandler:function(l){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(l.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(l){!this.canvas||!this.editable||l.e.button&&l.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(l.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(l){!this.canvas||!this.editable||l.e.button&&l.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(l){if(this.__isMousedown=!1,!(!this.editable||this.group||l.transform&&l.transform.actionPerformed||l.e.button&&l.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(l.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(l){var s=this.getSelectionStartFromPointer(l),a=this.selectionStart,u=this.selectionEnd;l.shiftKey?this.setSelectionStartEndWithShift(a,u,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(l){for(var s,a=this.getLocalPointer(l),u=0,i=0,n=0,c=0,_=0,d=0,f=this._textLines.length;d<f&&n<=a.y;d++)n+=this.getHeightOfLine(d)*this.scaleY,_=d,d>0&&(c+=this._textLines[d-1].length+this.missingNewlineOffset(d-1));i=this._getLineLeftOffset(_)*this.scaleX,s=this._textLines[_],this.direction==="rtl"&&(a.x=this.width*this.scaleX-a.x+i);for(var m=0,b=s.length;m<b&&(u=i,(i+=this.__charBounds[_][m].kernedWidth*this.scaleX)<=a.x);m++)c++;return this._getNewSelectionStartFromOffset(a,u,i,c,b)},_getNewSelectionStartFromOffset:function(l,s,a,u,i){var n=l.x-s,c=a-l.x,_=u+(c>n||c<0?0:1);return this.flipX&&(_=i-_),_>this._text.length&&(_=this._text.length),_}}),y.util.object.extend(y.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=y.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var l=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+l.top+"; left: "+l.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingｰtop: "+l.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):y.document.body.appendChild(this.hiddenTextarea),y.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),y.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),y.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),y.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(y.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(l){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(l.keyCode in s)this[s[l.keyCode]](l);else{if(!(l.keyCode in this.ctrlKeysMapDown)||!l.ctrlKey&&!l.metaKey)return;this[this.ctrlKeysMapDown[l.keyCode]](l)}l.stopImmediatePropagation(),l.preventDefault(),l.keyCode>=33&&l.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(l){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:l.keyCode in this.ctrlKeysMapUp&&(l.ctrlKey||l.metaKey)&&(this[this.ctrlKeysMapUp[l.keyCode]](l),l.stopImmediatePropagation(),l.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(l){var s=this.fromPaste;if(this.fromPaste=!1,l&&l.stopPropagation(),this.isEditing){var a,u,i,n,c,_=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,d=this._text.length,f=_.length,m=f-d,b=this.selectionStart,C=this.selectionEnd,I=b!==C;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var T=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),R=b>T.selectionStart;I?(a=this._text.slice(b,C),m+=C-b):f<d&&(a=R?this._text.slice(C+m,C):this._text.slice(b,b-m)),u=_.slice(T.selectionEnd-m,T.selectionEnd),a&&a.length&&(u.length&&(i=this.getSelectionStyles(b,b+1,!1),i=u.map(function(){return i[0]})),I?(n=b,c=C):R?(n=C-a.length,c=C):(n=C,c=C+a.length),this.removeStyleFromTo(n,c)),u.length&&(s&&u.join("")===y.copiedText&&!y.disableStyleCopyPaste&&(i=y.copiedTextStyle),this.insertNewStyleBlock(u,b,i)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(l){this.compositionStart=l.target.selectionStart,this.compositionEnd=l.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(y.copiedText=this.getSelectedText(),y.disableStyleCopyPaste?y.copiedTextStyle=null:y.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(l){return l&&l.clipboardData||y.window.clipboardData},_getWidthBeforeCursor:function(l,s){var a,u=this._getLineLeftOffset(l);return s>0&&(u+=(a=this.__charBounds[l][s-1]).left+a.width),u},getDownCursorOffset:function(l,s){var a=this._getSelectionForOffset(l,s),u=this.get2DCursorLocation(a),i=u.lineIndex;if(i===this._textLines.length-1||l.metaKey||l.keyCode===34)return this._text.length-a;var n=u.charIndex,c=this._getWidthBeforeCursor(i,n),_=this._getIndexOnLine(i+1,c);return this._textLines[i].slice(n).length+_+1+this.missingNewlineOffset(i)},_getSelectionForOffset:function(l,s){return l.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(l,s){var a=this._getSelectionForOffset(l,s),u=this.get2DCursorLocation(a),i=u.lineIndex;if(i===0||l.metaKey||l.keyCode===33)return-a;var n=u.charIndex,c=this._getWidthBeforeCursor(i,n),_=this._getIndexOnLine(i-1,c),d=this._textLines[i].slice(0,n),f=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+_-d.length+(1-f)},_getIndexOnLine:function(l,s){for(var a,u,i=this._textLines[l],n=this._getLineLeftOffset(l),c=0,_=0,d=i.length;_<d;_++)if((n+=a=this.__charBounds[l][_].width)>s){u=!0;var f=n-a,m=n,b=Math.abs(f-s);c=Math.abs(m-s)<b?_:_-1;break}return u||(c=i.length-1),c},moveCursorDown:function(l){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",l)},moveCursorUp:function(l){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",l)},_moveCursorUpOrDown:function(l,s){var a=this["get"+l+"CursorOffset"](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(a):this.moveCursorWithoutShift(a),a!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(l){var s=this._selectionDirection==="left"?this.selectionStart+l:this.selectionEnd+l;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),l!==0},moveCursorWithoutShift:function(l){return l<0?(this.selectionStart+=l,this.selectionEnd=this.selectionStart):(this.selectionEnd+=l,this.selectionStart=this.selectionEnd),l!==0},moveCursorLeft:function(l){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",l)},_move:function(l,s,a){var u;if(l.altKey)u=this["findWordBoundary"+a](this[s]);else{if(!l.metaKey&&l.keyCode!==35&&l.keyCode!==36)return this[s]+=a==="Left"?-1:1,!0;u=this["findLineBoundary"+a](this[s])}if(typeof u!==void 0&&this[s]!==u)return this[s]=u,!0},_moveLeft:function(l,s){return this._move(l,s,"Left")},_moveRight:function(l,s){return this._move(l,s,"Right")},moveCursorLeftWithoutShift:function(l){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(l,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(l){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(l,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(l,"selectionStart")):void 0},moveCursorRight:function(l){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",l)},_moveCursorLeftOrRight:function(l,s){var a="moveCursor"+l+"With";this._currentCursorOpacity=1,s.shiftKey?a+="Shift":a+="outShift",this[a](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(l){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(l,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(l,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(l){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(l,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(l,s){s===void 0&&(s=l+1),this.removeStyleFromTo(l,s),this._text.splice(l,s-l),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(l,s,a,u){u===void 0&&(u=a),u>a&&this.removeStyleFromTo(a,u);var i=y.util.string.graphemeSplit(l);this.insertNewStyleBlock(i,a,s),this._text=[].concat(this._text.slice(0,a),i,this._text.slice(u)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var l=y.util.toFixed,s=/  +/g;y.util.object.extend(y.Text.prototype,{_toSVG:function(){var a=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(a.textTop,a.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(a){return this._createBaseSVGMarkup(this._toSVG(),{reviver:a,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(a){var u=this.getSvgTextDecoration(this);return[a.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",u?'text-decoration="'+u+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",a.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(a,u){var i,n=[],c=[],_=a;this._setSVGBg(c);for(var d=0,f=this._textLines.length;d<f;d++)i=this._getLineLeftOffset(d),(this.textBackgroundColor||this.styleHas("textBackgroundColor",d))&&this._setSVGTextLineBg(c,d,u+i,_),this._setSVGTextLineText(n,d,u+i,_),_+=this.getHeightOfLine(d);return{textSpans:n,textBgRects:c}},_createTextCharSpan:function(a,u,i,n){var c=a!==a.trim()||a.match(s),_=this.getSvgSpanStyles(u,c),d=_?'style="'+_+'"':"",f=u.deltaY,m="",b=y.Object.NUM_FRACTION_DIGITS;return f&&(m=' dy="'+l(f,b)+'" '),['<tspan x="',l(i,b),'" y="',l(n,b),'" ',m,d,">",y.util.string.escapeXml(a),"</tspan>"].join("")},_setSVGTextLineText:function(a,u,i,n){var c,_,d,f,m,b=this.getHeightOfLine(u),C=this.textAlign.indexOf("justify")!==-1,I="",T=0,R=this._textLines[u];n+=b*(1-this._fontSizeFraction)/this.lineHeight;for(var B=0,U=R.length-1;B<=U;B++)m=B===U||this.charSpacing,I+=R[B],d=this.__charBounds[u][B],T===0?(i+=d.kernedWidth-d.width,T+=d.width):T+=d.kernedWidth,C&&!m&&this._reSpaceAndTab.test(R[B])&&(m=!0),m||(c=c||this.getCompleteStyleDeclaration(u,B),_=this.getCompleteStyleDeclaration(u,B+1),m=this._hasStyleChangedForSvg(c,_)),m&&(f=this._getStyleDeclaration(u,B)||{},a.push(this._createTextCharSpan(I,f,i,n)),I="",c=_,i+=T,T=0)},_pushTextBgRect:function(a,u,i,n,c,_){var d=y.Object.NUM_FRACTION_DIGITS;a.push("		<rect ",this._getFillAttributes(u),' x="',l(i,d),'" y="',l(n,d),'" width="',l(c,d),'" height="',l(_,d),`"></rect>
`)},_setSVGTextLineBg:function(a,u,i,n){for(var c,_,d=this._textLines[u],f=this.getHeightOfLine(u)/this.lineHeight,m=0,b=0,C=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),I=0,T=d.length;I<T;I++)c=this.__charBounds[u][I],(_=this.getValueOfPropertyAt(u,I,"textBackgroundColor"))!==C?(C&&this._pushTextBgRect(a,C,i+b,n,m,f),b=c.left,m=c.width,C=_):m+=c.kernedWidth;_&&this._pushTextBgRect(a,_,i+b,n,m,f)},_getFillAttributes:function(a){var u=a&&typeof a=="string"?new y.Color(a):"";return u&&u.getSource()&&u.getAlpha()!==1?'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"':'fill="'+a+'"'},_getSVGLineTopOffset:function(a){for(var u,i=0,n=0;n<a;n++)i+=this.getHeightOfLine(n);return u=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*u/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(a){return y.Object.prototype.getSvgStyles.call(this,a)+" white-space: pre;"}})}(),function(l){var s=l.fabric||(l.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(a){for(var u=0,i=0,n=0,c={},_=0;_<a.graphemeLines.length;_++)a.graphemeText[n]===`
`&&_>0?(i=0,n++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(a.graphemeText[n])&&_>0&&(i++,n++),c[_]={line:u,offset:i},n+=a.graphemeLines[_].length,i+=a.graphemeLines[_].length;return c},styleHas:function(a,u){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[u];i&&(u=i.line)}return s.Text.prototype.styleHas.call(this,a,u)},isEmptyStyles:function(a){if(!this.styles)return!0;var u,i,n=0,c=!1,_=this._styleMap[a],d=this._styleMap[a+1];for(var f in _&&(a=_.line,n=_.offset),d&&(c=d.line===a,u=d.offset),i=a===void 0?this.styles:{line:this.styles[a]})for(var m in i[f])if(m>=n&&(!c||m<u))for(var b in i[f][m])return!1;return!0},_getStyleDeclaration:function(a,u){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[a];if(!i)return null;a=i.line,u=i.offset+u}return this.callSuper("_getStyleDeclaration",a,u)},_setStyleDeclaration:function(a,u,i){var n=this._styleMap[a];a=n.line,u=n.offset+u,this.styles[a][u]=i},_deleteStyleDeclaration:function(a,u){var i=this._styleMap[a];a=i.line,u=i.offset+u,delete this.styles[a][u]},_getLineStyle:function(a){var u=this._styleMap[a];return!!this.styles[u.line]},_setLineStyle:function(a){var u=this._styleMap[a];this.styles[u.line]={}},_wrapText:function(a,u){var i,n=[];for(this.isWrapping=!0,i=0;i<a.length;i++)n=n.concat(this._wrapLine(a[i],i,u));return this.isWrapping=!1,n},_measureWord:function(a,u,i){var n,c=0;i=i||0;for(var _=0,d=a.length;_<d;_++)c+=this._getGraphemeBox(a[_],u,_+i,n,!0).kernedWidth,n=a[_];return c},_wrapLine:function(a,u,i,n){var c=0,_=this.splitByGrapheme,d=[],f=[],m=_?s.util.string.graphemeSplit(a):a.split(this._wordJoiners),b="",C=0,I=_?"":" ",T=0,R=0,B=0,U=!0,X=this._getWidthOfCharSpacing();n=n||0,m.length===0&&m.push([]),i-=n;for(var Q=0;Q<m.length;Q++)b=_?m[Q]:s.util.string.graphemeSplit(m[Q]),T=this._measureWord(b,u,C),C+=b.length,(c+=R+T-X)>i&&!U?(d.push(f),f=[],c=T,U=!0):c+=X,U||_||f.push(I),f=f.concat(b),R=_?0:this._measureWord([I],u,C),C++,U=!1,T>B&&(B=T);return Q&&d.push(f),B+n>this.dynamicMinWidth&&(this.dynamicMinWidth=B-X+n),d},isEndOfWrapping:function(a){return!this._styleMap[a+1]||this._styleMap[a+1].line!==this._styleMap[a].line},missingNewlineOffset:function(a){return this.splitByGrapheme?this.isEndOfWrapping(a)?1:0:1},_splitTextIntoLines:function(a){for(var u=s.Text.prototype._splitTextIntoLines.call(this,a),i=this._wrapText(u.lines,this.width),n=new Array(i.length),c=0;c<i.length;c++)n[c]=i[c].join("");return u.lines=n,u.graphemeLines=i,u},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var a={};for(var u in this._styleMap)this._textLines[u]&&(a[this._styleMap[u].line]=1);for(var u in this.styles)a[u]||delete this.styles[u]},toObject:function(a){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(a))}}),s.Textbox.fromObject=function(a,u){return s.Object._fromObject("Textbox",a,u,"text")}}(e),function(){var l=y.controlsUtils,s=l.scaleSkewCursorStyleHandler,a=l.scaleCursorStyleHandler,u=l.scalingEqually,i=l.scalingYOrSkewingX,n=l.scalingXOrSkewingY,c=l.scaleOrSkewActionName,_=y.Object.prototype.controls;if(_.ml=new y.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:n,getActionName:c}),_.mr=new y.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:n,getActionName:c}),_.mb=new y.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:i,getActionName:c}),_.mt=new y.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:i,getActionName:c}),_.tl=new y.Control({x:-.5,y:-.5,cursorStyleHandler:a,actionHandler:u}),_.tr=new y.Control({x:.5,y:-.5,cursorStyleHandler:a,actionHandler:u}),_.bl=new y.Control({x:-.5,y:.5,cursorStyleHandler:a,actionHandler:u}),_.br=new y.Control({x:.5,y:.5,cursorStyleHandler:a,actionHandler:u}),_.mtr=new y.Control({x:0,y:-.5,actionHandler:l.rotationWithSnapping,cursorStyleHandler:l.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),y.Textbox){var d=y.Textbox.prototype.controls={};d.mtr=_.mtr,d.tr=_.tr,d.br=_.br,d.tl=_.tl,d.bl=_.bl,d.mt=_.mt,d.mb=_.mb,d.mr=new y.Control({x:.5,y:0,actionHandler:l.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),d.ml=new y.Control({x:-.5,y:0,actionHandler:l.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},Dn={};function Ct(t){var e=Dn[t];if(e!==void 0)return e.exports;var r=Dn[t]={exports:{}};return jl[t](r,r.exports,Ct),r.exports}Ct.d=(t,e)=>{for(var r in e)Ct.o(e,r)&&!Ct.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},Ct.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Js={};(()=>{let t;Ct.d(Js,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?Ct(653).fabric:{version:"5.2.1"}})();var ye=Js.R;/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Camera Enhancer JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2023, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.3.9 (js 20231205)
 * @fileoverview Dynamsoft JavaScript Library for Camera Enhancer
 * More info on DCE JS: https://www.dynamsoft.com/camera-enhancer/docs/programming/javascript/?ver=latest
 */const qi=typeof self>"u";let Jt,lt,vi,ki,Ae;if(typeof navigator<"u"&&(Jt=navigator,lt=Jt.userAgent,vi=Jt.platform,ki=Jt.mediaDevices),!qi){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Jt.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:vi,search:"Win"},Mac:{str:vi},Linux:{str:vi}};let r="unknownBrowser",o=0,h="unknownOS";for(let g in t){const p=t[g]||{};let v=p.str||lt,S=p.search||g,w=p.verStr||lt,x=p.verSearch||g;if(x instanceof Array||(x=[x]),v.indexOf(S)!=-1){r=g;for(let E of x){let A=w.indexOf(E);if(A!=-1){o=parseFloat(w.substring(A+E.length+1));break}}break}}for(let g in e){const p=e[g]||{};let v=p.str||lt,S=p.search||g;if(v.indexOf(S)!=-1){h=g;break}}h=="Linux"&&lt.indexOf("Windows NT")!=-1&&(h="HarmonyOS"),Ae={browser:r,version:o,OS:h}}qi&&(Ae={browser:"ssr",version:0,OS:"ssr"});const Vl=typeof WebAssembly<"u"&&lt&&!(/Safari/.test(lt)&&!/Chrome/.test(lt)&&/\(.+\s11_2_([2-6]).*\)/.test(lt)),Ul=!(typeof Worker>"u"),$s=!(!ki||!ki.getUserMedia),Wl=async()=>{let t=!1;if($s)try{(await ki.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};Ae.browser==="Chrome"&&Ae.version>66||Ae.browser==="Safari"&&Ae.version>13||Ae.browser==="OPR"&&Ae.version>43||Ae.browser==="Edge"&&Ae.version;const Gl=(()=>{if(!qi&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();class Xe{constructor(e,r){this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,this._setFabricObject(e),this._mediaType=e.type,this.styleSelector="default",this.styleId=r}get mediaType(){return this._mediaType}get drawingLayerId(){return this._drawingLayerId}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.styleSelector="selected"}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.styleSelector="selected":this.styleSelector="default",this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}_on(e,r){if(!r)return;const o=e.toLowerCase(),h=this.mapEvent_Callbacks.get(o);if(!h)throw new Error(`Event '${e}' does not exist.`);let g=h.get(r);g||(g=p=>{const v=p.e;if(!v)return void(r&&r.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const S={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let w,x,E,A;const W=v.target.getBoundingClientRect();w=W.left,x=W.top,E=w+window.scrollX,A=x+window.scrollY;const Y=this._drawingLayer.fabricCanvas.lowerCanvasEl.width,z=this._drawingLayer.fabricCanvas.lowerCanvasEl.height,q=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).width),te=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).height),J=q/te,Z=Y/z,ee=this._drawingLayer._getObjectFit();let he,fe,_e,y,ge=1;if(ee==="contain")J<Z?(ge=q/Y,he=w+this.get("x")*ge,fe=x+this.get("y")*ge+(te-z*ge)/2,_e=E+this.get("x")*ge,y=A+this.get("y")*ge+(te-z*ge)/2):(ge=te/z,he=w+this.get("x")*ge+(q-Y*ge)/2,fe=x+this.get("y")*ge,_e=E+this.get("x")*ge+(q-Y*ge)/2,y=A+this.get("y")*ge);else if(ee==="cover")if(J<Z){ge=te/z;let pe=this.get("x")*ge-(Y*ge-q)/2;pe=Math.max(pe,0),pe=Math.min(pe,q),he=w+pe,fe=x+this.get("y")*ge,_e=E+pe,y=A+this.get("y")*ge}else{ge=q/Y;let pe=this.get("y")*ge-(z*ge-te)/2;pe=Math.max(pe,0),pe=Math.min(pe,te),he=w+this.get("x")*ge,fe=x+pe,_e=E+this.get("x")*ge,y=A+pe}S.itemClientX=Math.round(he),S.itemClientY=Math.round(fe),S.itemPageX=Math.round(_e),S.itemPageY=Math.round(y)}for(let w of Object.getOwnPropertyNames(S))Object.defineProperty(v,w,{value:S[w],writable:!0});r&&r.apply(this,[v])},h.set(r,g),this._fabricObject.on(o==="dblclick"?"mousedblclick":o,g))}on(e,r){this._on(e,r)}_off(e,r){const o=e.toLowerCase(),h=this.mapEvent_Callbacks.get(o);if(!h)throw new Error(`Event '${e}' does not exist.`);let g=h.get(r);g&&(h.delete(r),this._fabricObject.off(o==="dblclick"?"mousedblclick":o,g))}off(e,r){this._off(e,r)}_setEditable(e){const r=this._fabricObject;e?(r.selectable=!0,r.hasControls=!0,r.hoverCursor=null):(r.selectable=!1,r.hasControls=!1,r.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,r){if(this.hasNote(e.name)&&!r)throw new Error("A note with the same name already exists, please use a different name.");const o=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[o])}getNote(e){const r=this.mapNoteName_Content.get(e);return r?r.length===1?{name:e,content:r[0]?JSON.parse(JSON.stringify(r[0])):r[0]}:{name:e,content:JSON.parse(JSON.stringify(r))}:null}getNotes(){const e=[];for(let r of this.mapNoteName_Content){let o=r[1].length===1?r[1][0]:r[1];o=o&&JSON.parse(JSON.stringify(o)),e.push({name:r[0],content:o})}return e}updateNote(e,r,o){const h=this.mapNoteName_Content.get(e);if(!h)throw new Error("The note name does not exist.");o||(h.length=0),r=r&&JSON.parse(JSON.stringify(r)),h.push(r)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}_extendSet(e,r){return!1}_extendGet(e){}set(e,r){if(!this._extendSet(e,r))if(e==="x"){const o=this._fabricObject.group;o?(this._fabricObject.set("left",r-o.left-o.width/2),o.addWithUpdate()):this._fabricObject.set("left",r)}else if(e==="y"){const o=this._fabricObject.group;o?(this._fabricObject.set("top",r-o.top-o.height/2),o.addWithUpdate()):this._fabricObject.set("top",r)}else e==="styleId"?this.styleId=r:this._fabricObject.set(e,r);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let r=this._extendGet(e);if(r===void 0)if(e==="x"){const o=this._fabricObject.group;r=o?this._fabricObject.get("left")+o.left+o.width/2:this._fabricObject.get("left")}else if(e==="y"){const o=this._fabricObject.group;r=o?this._fabricObject.get("top")+o.top+o.height/2:this._fabricObject.get("top")}else r=["type","mediaType"].includes(e)?this.mediaType:e==="styleSelector"?this.styleSelector:e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return r}setAttribute(e,r){this.set(e,r)}getAttribute(e){return this.get(e)}}function yr(t,e,r){let o=r.points[this.pointIndex].x-r.pathOffset.x,h=r.points[this.pointIndex].y-r.pathOffset.y;return ye.util.transformPoint({x:o,y:h},r.calcTransformMatrix())}function Qs(t){let e=new ye.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new ye.Point(t.width+e.x,t.height+e.y)}function br(t,e,r,o){let h=e.target,g=h.controls[h.__corner],p=h.toLocalPoint(new ye.Point(r,o),"center","center"),v=Qs(h),S=h._getTransformedDimensions(0,0),w={x:p.x*v.x/S.x+h.pathOffset.x,y:p.y*v.y/S.y+h.pathOffset.y};return h.points[g.pointIndex]=w,!0}function Sr(t,e){return function(r,o,h,g){let p=o.target,v=ye.util.transformPoint({x:p.points[t].x-p.pathOffset.x,y:p.points[t].y-p.pathOffset.y},p.calcTransformMatrix()),S=e(r,o,h,g);p._setPositionDimensions({});let w=Qs(p),x=(p.points[t].x-p.pathOffset.x)/w.x,E=(p.points[t].y-p.pathOffset.y)/w.y;return p.setPositionByOrigin(v,x+.5,E+.5),S}}Xe.arrMediaTypes=["rect","arc","polygon","image","text","line","path"],Xe.arrStyleSelectors=["default","selected"];class Mn extends Xe{constructor(e,r){super(new ye.Polygon(e,{objectCaching:!1}),r);const o=this._fabricObject;let h=o.points.length-1;o.controls=o.points.reduce(function(g,p,v){return g["p"+v]=new ye.Control({positionHandler:yr,actionHandler:Sr(v>0?v-1:h,br),actionName:"modifyPolygon",pointIndex:v}),g},{})}_extendSet(e,r){if(e==="vertices"){const o=this._fabricObject;if(o.group){const g=o.group;o.points=r.map(p=>({x:p.x-g.left-g.width/2,y:p.y-g.top-g.height/2})),g.addWithUpdate()}else o.points=r;const h=o.points.length-1;return o.controls=o.points.reduce(function(g,p,v){return g["p"+v]=new ye.Control({positionHandler:yr,actionHandler:Sr(v>0?v-1:h,br),actionName:"modifyPolygon",pointIndex:v}),g},{}),o._setPositionDimensions({}),!0}}_extendGet(e){if(e==="vertices"){const r=[],o=this._fabricObject;if(o.selectable&&!o.group)for(let h in o.oCoords)r.push({x:o.oCoords[h].x,y:o.oCoords[h].y});else for(let h of o.points){let g=h.x-o.pathOffset.x,p=h.y-o.pathOffset.y;const v=ye.util.transformPoint({x:g,y:p},o.calcTransformMatrix());r.push({x:v.x,y:v.y})}return r}}}const Ln=t=>{let e=(r=>r.split(`
`).map(o=>o.split("	")))(t);return(r=>{for(let o=0;;o++){let h=-1;for(let g=0;g<r.length;g++){let p=r[g][o];p!==void 0&&p.length>h&&(h=p.length)}if(h===-1)break;for(let g=0;g<r.length;g++){if(o>=r[g].length-1)continue;let p=" ".repeat(h+2-r[g][o].length);r[g][o]=r[g][o].concat(p)}}})(e),(r=>{let o="";for(let h=0;h<r.length;h++)o=o.concat(...r[h],h===r.length-1?"":`
`);return o})(e)};class eo extends Xe{constructor(e,r,o,h,g){if(typeof h!="number"||h<=0)throw new RangeError("Invalid width.");super(new ye.Textbox(Ln(e),{left:r,top:o,width:h}),g),this._mediaType="text",this._text=e}_extendSet(e,r){if(e==="text")return this._text=r,this._fabricObject.set("text",Ln(r)),!0}_extendGet(e){if(e==="text")return this._text}}typeof document<"u"&&typeof window<"u"&&(ye.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(ye.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),ye.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},ye.Object.prototype.transparentCorners=!1,ye.Object.prototype.cornerSize=20,ye.Object.prototype.touchCornerSize=100,ye.Object.prototype.cornerColor="rgb(254,142,20)",ye.Object.prototype.cornerStyle="circle",ye.Object.prototype.strokeUniform=!0,ye.Object.prototype.hasBorders=!1,ye.Canvas.prototype.containerClass="",ye.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var r,o=this.upperCanvasEl,h=ye.util.getPointer(t,o),g=o.getBoundingClientRect(),p=g.width||0,v=g.height||0;p&&v||("top"in g&&"bottom"in g&&(v=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(p=Math.abs(g.right-g.left))),this.calcOffset(),h.x=h.x-this._offset.left,h.y=h.y-this._offset.top,e||(h=this.restorePointerVpt(h));var S=this.getRetinaScaling();if(S!==1&&(h.x/=S,h.y/=S),p!==0&&v!==0){var w=window.getComputedStyle(o).objectFit,x=o.width,E=o.height,A=p,W=v;r={width:x/A,height:E/W};var Y,z,q=x/E,te=A/W;return w==="contain"?q>te?(Y=A,z=A/q,{x:h.x*r.width,y:(h.y-(W-z)/2)*r.width}):(Y=W*q,z=W,{x:(h.x-(A-Y)/2)*r.height,y:h.y*r.height}):w==="cover"?q>te?{x:(x-r.height*A)/2+h.x*r.height,y:h.y*r.height}:{x:h.x*r.width,y:(E-r.width*W)/2+h.y*r.width}:{x:h.x*r.width,y:h.y*r.height}}return r={width:1,height:1},{x:h.x*r.width,y:h.y*r.height}},ye.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var r=this.upperCanvasEl,o=this._getEventPrefix();ye.util.addListener(ye.document,"touchend",this._onTouchEnd,{passive:!1}),ye.util.addListener(ye.document,"touchmove",this._onMouseMove,{passive:!1}),ye.util.removeListener(r,o+"down",this._onMouseDown)},ye.Textbox.prototype._wrapLine=function(t,e,r,o){const h=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),g=!(!h||!h.length);var p=0,v=this.splitByGrapheme||g,S=[],w=[],x=v?ye.util.string.graphemeSplit(t):t.split(this._wordJoiners),E="",A=0,W=v?"":" ",Y=0,z=0,q=0,te=!0,J=this._getWidthOfCharSpacing();o=o||0,x.length===0&&x.push([]),r-=o;for(var Z=0;Z<x.length;Z++)E=v?x[Z]:ye.util.string.graphemeSplit(x[Z]),Y=this._measureWord(E,e,A),A+=E.length,(p+=z+Y-J)>r&&!te?(S.push(w),w=[],p=Y,te=!0):p+=J,te||v||w.push(W),w=w.concat(E),z=v?0:this._measureWord([W],e,A),A++,te=!1,Y>q&&(q=Y);return Z&&S.push(w),q+o>this.dynamicMinWidth&&(this.dynamicMinWidth=q-J+o),S});class Hl{constructor(e,r,o,h){let g,p;switch(this.mapMediaType_Style=new Map,this.mode="viewer",this.onSelectionChange=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=e.getFabricCanvas():(this.fabricCanvas=new ye.Canvas(e,Object.assign(h,{allowTouchScrolling:!0})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",function(v){const S=v.selected,w=[];for(let x of S){const E=x.getDrawingItem()._drawingLayer;E&&!w.includes(E)&&w.push(E)}for(let x of w){const E=[];for(let A of S){const W=A.getDrawingItem();W._drawingLayer===x&&E.push(W)}setTimeout(()=>{x.onSelectionChange&&x.onSelectionChange(E,[])},0)}}),this.fabricCanvas.on("before:selection:cleared",function(v){const S=this.getActiveObjects(),w=[];for(let x of S){const E=x.getDrawingItem()._drawingLayer;E&&!w.includes(E)&&w.push(E)}for(let x of w){const E=[];for(let A of S){const W=A.getDrawingItem();W._drawingLayer===x&&E.push(W)}setTimeout(()=>{const A=[];for(let W of E)x.hasDrawingItem(W)&&A.push(W);A.length>0&&x.onSelectionChange&&x.onSelectionChange([],A)},0)}}),this.fabricCanvas.on("selection:updated",function(v){const S=v.selected,w=v.deselected,x=[];for(let E of S){const A=E.getDrawingItem()._drawingLayer;A&&!x.includes(A)&&x.push(A)}for(let E of w){const A=E.getDrawingItem()._drawingLayer;A&&!x.includes(A)&&x.push(A)}for(let E of x){const A=[],W=[];for(let Y of S){const z=Y.getDrawingItem();z._drawingLayer===E&&A.push(z)}for(let Y of w){const z=Y.getDrawingItem();z._drawingLayer===E&&W.push(z)}setTimeout(()=>{E.onSelectionChange&&E.onSelectionChange(A,W)},0)}}),this.fabricCanvas.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas),this.id=r,this._mapDrawingStyles=o,r){case 1:g=o.get(1),p=o.get(5);break;case 2:g=o.get(2),p=o.get(6);break;case 3:g=o.get(3),p=o.get(7);break;default:g=o.get(4),p=o.get(8)}for(let v of Xe.arrMediaTypes)this.mapMediaType_Style.set(v,{default:g,selected:p})}getId(){return this.id}_getDrawingStyle(e,r){if(typeof e!="number")throw new Error("Invalid style id.");const o=this._mapDrawingStyles.get(e);return o?r?JSON.parse(JSON.stringify(o)):o:null}setVisible(e){if(e){for(let r of this._arrFabricObject)r.visible=!0;this._visible=!0}else{for(let r of this._arrFabricObject)r.visible=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(e){return e.styleId?e.styleId:this.mapMediaType_Style.get(e._mediaType)[e.styleSelector].styleId}_getItemCurrentStyle(e){return e.styleId?this._getDrawingStyle(e.styleId):e._mapStyle.get(e.styleSelector)||null}_changeMediaTypeCurStyleInStyleSelector(e,r,o,h){let g;switch(e){case"rect":g=this.fabricCanvas.getObjects("rect");break;case"arc":g=this.fabricCanvas.getObjects("circle");break;case"polygon":g=this.fabricCanvas.getObjects("polygon");break;case"image":g=this.fabricCanvas.getObjects("image");break;case"text":g=this.fabricCanvas.getObjects("textbox");break;case"line":g=this.fabricCanvas.getObjects("line");break;case"path":g=this.fabricCanvas.getObjects("path")}for(let p of g){if(!this._arrFabricObject.includes(p))continue;const v=p.getDrawingItem();v.styleSelector===r&&this._changeItemStyle(v,o,!0)}h||this.fabricCanvas.renderAll()}_changeItemStyle(e,r,o){if(!e||!r)return;const h=e._getFabricObject();typeof e.styleId=="number"&&(r=this._getDrawingStyle(e.styleId)),h.strokeWidth=r.lineWidth,r.paintMode==="fill"?(h.fill=r.fillStyle,h.stroke=r.fillStyle):r.paintMode==="stroke"?(h.fill="transparent",h.stroke=r.strokeStyle):r.paintMode==="strokeAndFill"&&(h.fill=r.fillStyle,h.stroke=r.strokeStyle),h.fontFamily&&(h.fontFamily=r.fontFamily),h.fontSize&&(h.fontSize=r.fontSize),h.group||(h.dirty=!0),o||this.fabricCanvas.renderAll()}_updateGroupItem(e,r,o){if(!e||!r)return;const h=e.getChildItems();if(o==="add"){if(h.includes(r))return;const g=r._getFabricObject();if(this.fabricCanvas.getObjects().includes(g)){if(!this._arrFabricObject.includes(g))throw new Error("Existed in other drawing layers.");r._zIndex=null}else{let p;if(r.styleId)p=this._getDrawingStyle(r.styleId);else{p=this.mapMediaType_Style.get(r._mediaType)[e.styleSelector];const v=()=>{this._changeItemStyle(r,this.mapMediaType_Style.get(r._mediaType).selected,!0)},S=()=>{this._changeItemStyle(r,this.mapMediaType_Style.get(r._mediaType).default,!0)};r._on("selected",v),r._on("deselected",S),r._funcChangeStyleToSelected=v,r._funcChangeStyleToDefault=S}r._drawingLayer=this,r._drawingLayerId=this.id,this._changeItemStyle(r,p,!0)}e._fabricObject.addWithUpdate(r._getFabricObject())}else{if(o!=="remove"||!h.includes(r))return;r._zIndex=null,r._drawingLayer=null,r._drawingLayerId=null,r._off("selected",r._funcChangeStyleToSelected),r._off("deselected",r._funcChangeStyleToDefault),r._funcChangeStyleToSelected=null,r._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(r._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,r){let o=e._getFabricObject();const h=this.fabricCanvas.getObjects();let g,p;if(h.includes(o)){if(this._arrFabricObject.includes(o))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){g=e.getChildItems();for(let w of g)if(w._drawingLayer&&w._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(r&&typeof r=="object"&&!Array.isArray(r))for(let w in r)o.set(w,r[w]);if(g){for(let w of g){const x=this.mapMediaType_Style.get(w._mediaType);for(let E of Xe.arrStyleSelectors)w._mapStyle.set(E,x[E]);if(w.styleId)p=this._getDrawingStyle(w.styleId);else{p=x.default;const E=()=>{this._changeItemStyle(w,this.mapMediaType_Style.get(w._mediaType).selected,!0)},A=()=>{this._changeItemStyle(w,this.mapMediaType_Style.get(w._mediaType).default,!0)};w._on("selected",E),w._on("deselected",A),w._funcChangeStyleToSelected=E,w._funcChangeStyleToDefault=A}w._drawingLayer=this,w._drawingLayerId=this.id,this._changeItemStyle(w,p,!0)}o.dirty=!0,this.fabricCanvas.renderAll()}else{const w=this.mapMediaType_Style.get(e._mediaType);for(let x of Xe.arrStyleSelectors)e._mapStyle.set(x,w[x]);if(e.styleId)p=this._getDrawingStyle(e.styleId);else{p=w.default;const x=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).selected)},E=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).default)};e._on("selected",x),e._on("deselected",E),e._funcChangeStyleToSelected=x,e._funcChangeStyleToDefault=E}this._changeItemStyle(e,p)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const v=this._arrFabricObject.length;let S=h.length;if(v)S=h.indexOf(this._arrFabricObject[v-1])+1;else for(let w=0;w<h.length;w++)if(e._zIndex<h[w].getDrawingItem()._zIndex){S=w;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(o),this._visible?o.visible=!0:o.visible=!1,this.fabricCanvas.insertAt(o,S,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e)}addDrawingItems(e){for(let r of e)this.addDrawingItem(r)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){const o=e.getChildItems();for(let h of o)h._zIndex=null,h._drawingLayer=null,h._drawingLayerId=null,h._off("selected",h._funcChangeStyleToSelected),h._off("deselected",h._funcChangeStyleToDefault),h._funcChangeStyleToSelected=null,h._funcChangeStyleToDefault=null,h._mapStyle.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapStyle.clear();const r=e._getFabricObject();e.styleSelector==="selected"&&(r.group?r.group.removeWithUpdate(r):this.fabricCanvas._activeObject=null,e.styleSelector="default"),this.fabricCanvas.remove(r),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(r),1)}removeDrawingItems(e){for(let r of e)this.removeDrawingItem(r)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),r=[];for(let o of e)this._arrFabricObject.includes(o)&&r.push(o.getDrawingItem());return r}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}setDrawingStyle(e,r,o){r=r?r.toLocaleLowerCase():"all",o=o?o.toLocaleLowerCase():"all";let h,g=this._getDrawingStyle(e);if(r==="all"){const p=this.mapMediaType_Style.keys();for(let v of p)if(h=this.mapMediaType_Style.get(v),o==="all")for(let S of Xe.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(v,S,g,!0),h[S]=g;for(let w of this._arrDrwaingItem)w._mapStyle.set(S,g)}else{this._changeMediaTypeCurStyleInStyleSelector(v,o,g,!0),h[o]=g;for(let S of this._arrDrwaingItem)S._mapStyle.set(o,g)}this.fabricCanvas.renderAll()}else if(h=this.mapMediaType_Style.get(r),o==="all")for(let p of Xe.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(r,p,g,!0),h[p]=g;for(let v of this._arrDrwaingItem)v._mediaType===r&&v._mapStyle.set(p,g)}else{this._changeMediaTypeCurStyleInStyleSelector(r,o,g,!0),h[o]=g;for(let p of this._arrDrwaingItem)p._mediaType===r&&p._mapStyle.set(o,g)}}setMode(e){if((e=e.toLocaleLowerCase())==="viewer"){for(let r of this._arrDrwaingItem)r._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let r of this._arrDrwaingItem)r._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,r){this.fabricCanvas.setDimensions(e,r)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const r=this._getItemCurrentStyle(e);this._changeItemStyle(e,r,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}class Yl{constructor(){this._arrDrawingLayer=[],this._mapDrawingStyles=new Map([[1,{id:1,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[2,{id:2,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[3,{id:3,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[4,{id:4,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[5,{id:5,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[6,{id:6,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[7,{id:7,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[8,{id:8,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]]),this._defaultStyleTemplate={lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}}createDrawingStyle(e){if(!e)throw new Error("Invalid style definition.");let r;if(e.hasOwnProperty("id")){if(this._mapDrawingStyles.has(e.id))throw new Error("Existing drawing style id.");r=e.id}else{let h=100;for(;this._mapDrawingStyles.has(h);)h++;r=h}const o=JSON.parse(JSON.stringify(e));o.id=r;for(let h in this._defaultStyleTemplate)o.hasOwnProperty(h)||(o[h]=this._defaultStyleTemplate[h]);return this._mapDrawingStyles.set(r,o),o.id}_getDrawingStyle(e,r){if(typeof e!="number")throw new Error("Invalid style id.");const o=this._mapDrawingStyles.get(e);return o?r?JSON.parse(JSON.stringify(o)):o:null}getDrawingStyle(e){return this._getDrawingStyle(e,!0)}getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(this._mapDrawingStyles.values())))}_updateDrawingStyle(e,r){const o=this._mapDrawingStyles.get(e);if(o)for(let h in r)o.hasOwnProperty(h)&&(o[h]=r[h])}updateDrawingStyle(e,r){this._updateDrawingStyle(e,r);for(let o of this._arrDrawingLayer)o.renderAll()}createDrawingLayer(e,r){const o=g=>{for(let p of this._arrDrawingLayer)if(p.getId()===g)return!0;return!1};if(r===void 0){for(let g=100;;g++)if(!o(g)){r=g;break}}else if(o(r))throw new Error("Existed drawing layer id.");const h=new Hl(e,r,this._mapDrawingStyles,{enableRetinaScaling:!1});return h._manager=this,this._arrDrawingLayer.push(h),this._switchPointerEvent(),h}deleteDrawingLayer(e){const r=this.getDrawingLayer(e);if(!r)return;const o=this._arrDrawingLayer;r.dispose(),o.splice(o.indexOf(r),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let r of this._arrDrawingLayer)if(r.getId()===e)return r;return null}getDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),r=[];for(let o of e)r.push(o.getDrawingItem());return r}setDimensions(e,r){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,r)}setObjectFit(e){for(let r of this._arrDrawingLayer)r&&r._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=e?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class Xl{constructor(e){this._controlTarget=null,this._arrUsers=[],this._mapAction_UserArgs=new Map,this._mapProperty_UserValue=new Map,this._mapAction_Callbacks=new Map,this._controlTarget=e}setControlTarget(e){this._controlTarget=e}getControlTarget(){return this._controlTarget}register(e){this._arrUsers.includes(e)||this._arrUsers.push(e)}logout(e){const r=this._arrUsers.indexOf(e);r!==-1&&(this.clearUserDisiredAction({user:e}),this.clearUserDisiredValue({user:e}),this._arrUsers.splice(r,1))}getRegisteredUsers(){return this._arrUsers}ifUserExisted(e){return this._arrUsers.includes(e)}setDisiredValue(e,r,o,h){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");h&&(this._controlTarget[r]=o),this._mapProperty_UserValue.get(r)?this._mapProperty_UserValue.get(r).set(e,o):this._mapProperty_UserValue.set(r,new Map([[e,o]]))}clearUserDisiredValue(e){if(e&&(e.user||e.property)){if(e.property&&e.user){const r=this._mapProperty_UserValue.get(e.property);if(!r)return;r.delete(e.user)}else if(e.property)this._mapProperty_UserValue.delete(e.property);else if(e.user)for(let r of this._mapProperty_UserValue.values())r.delete(e.user)}else this._mapProperty_UserValue=new Map}getValue(e){if(!this._controlTarget)throw new Error("Control target is not set.");return this._controlTarget[e]}getPropertyDisiredValue(e){if(this._mapProperty_UserValue.get(e)){const r=[],o=this._mapProperty_UserValue.get(e);for(let h of o.values())r.push(h);return r}return null}setDisiredAction(e,r,o,h){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");return o||(o=[]),h?this._controlTarget[r](...o):(this._mapAction_UserArgs.get(r)?this._mapAction_UserArgs.get(r).set(e,o):this._mapAction_UserArgs.set(r,new Map([[e,o]])),this._render(r))}clearUserDisiredAction(e){if(e&&(e.user||e.actionName)){if(e.actionName&&e.user){const r=this._mapAction_UserArgs.get(e.actionName);if(!r)return;r.delete(e.user)}else if(e.actionName)this._mapAction_UserArgs.delete(e.actionName);else if(e.user)for(let r of this._mapAction_UserArgs.values())r.delete(e.user);this.render()}else this._mapAction_UserArgs=new Map}addCallback(e,r){const o=this._mapAction_Callbacks.get(e);o?o.push(r):this._mapAction_Callbacks.set(e,[r])}removeCallback(e,r){const o=this._mapAction_Callbacks.get(e);if(!o)return;const h=o.indexOf(r);h!==-1&&o.splice(h,1)}clearCallback(e){e?this._mapAction_Callbacks.delete(e):this._mapAction_Callbacks.clear()}_fireCallback(e){const r=this._mapAction_Callbacks.get(e);if(r)for(let o of r){if(!o)return;setTimeout(o.bind(this._controlTarget),0)}}_render(e){const r=this._mapAction_UserArgs.get(e);if(!r)throw new Error("Unrecorded action.");if(r.size===this._arrUsers.length){let o=[];for(let h of r.values())h.length>0&&(o=h);if(this._controlTarget[e]){const h=this._controlTarget[e](...o);return this._mapAction_UserArgs.delete(e),this._fireCallback(e),h}}}render(e){if(e)return this._render(e);for(let r of this._mapAction_UserArgs.keys())this._render(r)}}class Ge{static multiply(e,r){const o=[];for(let h=0;h<3;h++){const g=r.slice(3*h,3*h+3);for(let p=0;p<3;p++){const v=[e[p],e[p+3],e[p+6]].reduce((S,w,x)=>S+w*g[x],0);o.push(v)}}return o}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,r,o){return Ge.multiply(e,[1,0,0,0,1,0,r,o,1])}static rotate(e,r){var o=Math.cos(r),h=Math.sin(r);return Ge.multiply(e,[o,-h,0,h,o,0,0,0,1])}static scale(e,r,o){return Ge.multiply(e,[r,0,0,0,o,0,0,0,1])}}var Se;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(Se||(Se={}));const We=(t,e,r,o)=>{if(!r)return t;let h=e+Math.round((t-e)/r)*r;return o&&(h=Math.min(h,o)),h};class se{constructor(){this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this._predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this._mapCameraResolutions=new Map,this._bWebGLSupported=!0,this.extraBindings=[],this._cvsSingleFrameMode=null,this._cvsOriginalImage=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameInputContainer=null,this._clickIptSingleFrameMode=()=>{if(!this._isSingleFrameModeEnabled()||this.getDrawingLayers().some(r=>r.getMode()=="editor"))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),this.singleFrameMode==="camera"?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):this.singleFrameMode!=1&&this.singleFrameMode!=="image"||(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",async()=>{const o=e.files[0];e.value="";const h=await(async x=>{let E=null,A=null;if(typeof createImageBitmap<"u")try{if(E=await createImageBitmap(x),E)return E}catch{}var W;return E||(A=await(W=x,new Promise((Y,z)=>{let q=URL.createObjectURL(W),te=new Image;te.dbrObjUrl=q,te.src=q,te.onload=()=>{Y(te)},te.onerror=J=>{z(new Error("Can't convert blob to image : "+(J instanceof Event?J.type:J)))}}))),A})(o),g=h instanceof HTMLImageElement?h.naturalWidth:h.width,p=h instanceof HTMLImageElement?h.naturalHeight:h.height;this._imgWidth=g,this._imgHeight=p;const v=x=>{const E=Date.now();if(g===0||p===0)return null;if(x instanceof HTMLImageElement&&!x.complete)throw new Error("The source is not loaded.");const A=this._scanRegion,W=this.getFrameSize(g,p,A,this.maxCvsSideLength);if(!W)return null;let Y=!0;g===W.sWidth&&p===W.sHeight&&(Y=!1);const z=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase()),q={data:null,region:A?JSON.parse(JSON.stringify(A)):null,sx:W.sx,sy:W.sy,width:W.dWidth,height:W.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:Y,toCanvas:this._toCanvas,_sWidth:W.sWidth,_sHeight:W.sHeight,_bUseWebGL:null},te=this._getImageData(x,g,p,W,null,{pixelFormat:z});if(!te)return null;const J=Date.now();return se._onLog&&se._onLog("DCE: _getVideoData(region?) END: "+J),q.data=te.data,q.pixelFormat=q.colorMode=te.pixelFormat,q._bUseWebGL=te._bUseWebGL,q.timeSpent=J-E,q.timeStamp=J,te.pixelFormat===Se.GREY?q.stride=q.width:q.stride=4*q.width,q};(x=>{let E=this._cvsSingleFrameMode;if(!E){if(E=document.createElement("canvas"),!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(E),E.style.position="absolute",E.style.width="100%",E.style.height="100%",E.style.left="0",E.style.top="0",E.style.objectFit="contain",E.style.pointerEvents="none",this._cvsSingleFrameMode=E}E.width==g&&E.height==p||(E.width=g,E.height=p);const A=E.getContext("2d");A.clearRect(0,0,E.width,E.height),A.drawImage(x,0,0)})(h),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let x of this._arrScanRegionOverlays)x&&this._updateScanRegionOverlay(x);let S;this._updateDrawingLayersSize();try{S=v(h)}catch(x){throw x}const w=this.mapCameraEvents.get("singleframeacquired");for(let x of w)if(x)try{const E={data:new Uint8Array(S.data),region:JSON.parse(JSON.stringify(S.region)),sx:S.sx,sy:S.sy,width:S.width,height:S.height,stride:S.stride,colorMode:S.colorMode,pixelFormat:S.pixelFormat,timeSpent:S.timeSpent,timeStamp:S.timeStamp,isCropped:S.isCropped,toCanvas:S.toCanvas,_sWidth:S._sWidth,_sHeight:S._sHeight,_bUseWebGL:S._bUseWebGL};await x.apply(this,[E])}catch(E){console.error(E)}}),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";const r=document.createElement("div");r.append(e),r.style.position="absolute",r.style.width="1px",r.style.height="1px",r.style.overflow="hidden",r.style.pointerEvents="none",this._elContainer.prepend(r),this._singleFrameInputContainer=r}e==null||e.click()},this.styleEls=[],this._framePixelFormat=void 0,this._defaultFramePixelFormat="rgba",this.mapPixelFormatString_Enum=new Map([["grey",Se.GREY],["grey32",Se.GREY32],["rgba",Se.RGBA],["rbga",Se.RBGA],["grba",Se.GRBA],["gbra",Se.GBRA],["brga",Se.BRGA],["bgra",Se.BGRA]]),this.shaderPixelFormat=Se.RGBA,this.maxVideoCvsLength=3,this._reusedCvs=null,this._reusedWebGLCvs=null,this._tempDataContainer=null,this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._softwareScale=1,this._scaleCenter={x:0,y:0},this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,_focusArea:null},this._tapFocusEnabled=!0,this._focusSupported=!0,this._tapDoFocus=async e=>{if(this._touchMoved)return void(this._touchMoved=!1);if(!this._tapFocusEnabled||!this._bOpen||this._isSingleFrameModeEnabled()||!this._video||this._video.paused||!this._videoTrack||!this._focusSupported||this.getDrawingLayers().some(he=>he.getMode()=="editor"))return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let r,o,h,g;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)r=e.clientX,o=e.clientY;else{if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;r=e.changedTouches[0].clientX,o=e.changedTouches[0].clientY}const p=this.getVideoFit(),v=this._video.videoWidth,S=this._video.videoHeight,w=this._elContainer.getBoundingClientRect(),x=w.left,E=w.top,A=window.getComputedStyle(this._elContainer),W=parseFloat(A.width),Y=parseFloat(A.height),z=W/Y,q=v/S;let te=1;if(p==="contain")q>z?(te=W/v,h=(r-x)/te,g=(o-E-(Y-W/q)/2)/te):(te=Y/S,g=(o-E)/te,h=(r-x-(W-Y*q)/2)/te);else{if(p!=="cover")throw new Error("Unsupported object-fit.");q>z?(te=Y/S,g=(o-E)/te,h=(r-x+(Y*q-W)/2)/te):(te=W/v,h=(r-x)/te,g=(o-E+(W/q-Y)/2)/te)}const J={x:h+"px",y:g+"px"},Z=2*Math.round(Math.min(v,S)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px",ee=Z;await this._setLocalFocus(J,Z,ee,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance),this._focusParameters.taskBackToContinous=setTimeout(()=>{this._videoTrack&&this._videoTrack.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime)},this._touchMoved=!1,this._touchMoveEvent=()=>{this._touchMoved=!0},this._recordedStates={},this.playCallbackInfo=null,this._toCanvas=function(){const e=document.createElement("canvas");let r;if(e.width=this.width,e.height=this.height,(this.pixelFormat||this.colorMode)==="grey"){r=new Uint8ClampedArray(this.width*this.height*4);for(let h=0;h<r.length;h+=4)r[h]=this.data[h/4],r[h+1]=this.data[h/4],r[h+2]=this.data[h/4],r[h+3]=255}else r=new Uint8ClampedArray(this.data.buffer);const o=new ImageData(r,this.width,this.height);return e.getContext("2d").putImageData(o,0,0),e},this._onCameraSelChange=async()=>{await this.selectCamera(this._selCam.value),this._bOpen||this.stop()},this._onResolutionSelChange=async()=>{let e,r;if(this._selRsl&&this._selRsl.selectedIndex!=-1){let o=this._selRsl.options[this._selRsl.selectedIndex];e=o.getAttribute("data-width"),r=o.getAttribute("data-height")}await this.setResolution(e,r),this._bOpen||this.stop()},this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.isCameraEnhancer=!0,this.isDisposed=!1,this.disposed=!1,this.videoSrc=null,this.cameraOpenTimeout=4e3,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{if(!this._isSingleFrameModeEnabled()){if(document.visibilityState==="visible"){if(se._onLog&&se._onLog("DCE: document visible."),this._bOpen&&this._vc_bPlayingVideoBeforeHide){if(this.videoSrc)this._video.play();else if(this._video.srcObject){const e=this._video.srcObject.getTracks()[0];if(this._video.srcObject.active&&e)if(e.muted&&["iPhone","iPad","Mac"].includes(Ae.OS)){if(Ae.version>=17)return;this.play()}else this._video.play();else this.play()}}}else if(document.visibilityState==="hidden")if(se._onLog&&se._onLog("DCE: document hidden."),["iPhone","iPad","Mac"].includes(Ae.OS)){if(this._vc_bPlayingVideoBeforeHide=!0,Ae.version>=17)return;this._video&&this._video.pause()}else this._video&&!this._video.paused?(this._vc_bPlayingVideoBeforeHide=!0,this._video.pause()):this._vc_bPlayingVideoBeforeHide=!1}},this.containerClassName="dce-video-container",this._elContainer=null,this._videoContainer=null,this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=void 0,this._defaultBShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._layerBaseCvs=null,this._drawingLayerOfTip=null,this._tipArgs={x:void 0,y:void 0,width:void 0,duration:void 0,autoShowSuggestedTip:void 0},this._hideTipTimeoutId=null,this.onTipSuggested=null,this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateLayersTimeout=500,this._updateLayers=()=>{this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none");for(let e of this._arrScanRegionOverlays)e&&(e.style.display="none");this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout(()=>{if(!this.isDisposed||!this.disposed){this.ifShowScanRegionMask&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this.showScanRegionLaser(),this._cvsViewDecorator&&this.showViewDecorator(),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&(e.style.display="",this._updateScanRegionOverlay(e));this._updateDrawingLayersSize(),this._updateVideoContainerStyle()}},this._updateLayersTimeout)},this._windowResizeListener=()=>{this._windowWidth!==document.documentElement.clientWidth&&(this._windowWidth=document.documentElement.clientWidth,this._updateLayers())},this.mapCameraEvents=new Map([["cameraopen",[]],["cameraclose",[]],["camerachange",[]],["resolutionchange",[]],["played",[]],["singleframeacquired",[]],["frameaddedtobuffer",[]]]),this._controler=null,navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this._singleFrameMode=!1:this._singleFrameMode=!0}static getVersion(){return this._version}static async detectEnvironment(){return await(async()=>({wasm:Vl,worker:Ul,getUserMedia:$s,camera:await Wl(),browser:Ae.browser,version:Ae.version,OS:Ae.OS}))()}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");se._engineResourcePath=(r=>{if(r==null&&(r="./"),!qi){let o=document.createElement("a");o.href=r,r=o.href}return r.endsWith("/")||(r+="/"),r})(e)}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let r;try{r=window[e];const o="__storage_test__";return r.setItem(o,o),r.removeItem(o),!0}catch(o){return o instanceof DOMException&&(o.code===22||o.code===1014||o.name==="QuotaExceededError"||o.name==="NS_ERROR_DOM_QUOTA_REACHED")&&r&&r.length!==0}}static isDCEFrame(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}static async testCameraAccess(){try{if(!navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return{ok:!1,message:"Insecure context."};(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()})}catch(e){if(e.name==="OverconstrainedError"||e.name==="NotFoundError")return{ok:!1,message:"No camera detected."};if(e.name==="NotAllowedError")return{ok:!1,message:"No permission to access camera."};if(e.name==="AbortError")return{ok:!1,message:"Some problem occurred which prevented the device from being used."};if(e.name==="NotReadableError")return{ok:!1,message:"A hardware error occurred."};if(e.name==="SecurityError")return{ok:!1,message:"User media support is disabled."};throw e}return{ok:!0,message:"Successfully accessed the camera."}}set maxCvsSideLength(e){if(e<=0)throw new Error("Invalid value.");this._maxCvsSideLength=e}get maxCvsSideLength(){if(this._maxCvsSideLength!==void 0)return this._maxCvsSideLength;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxCvsSideLength");if(e&&e.length===1)return e[0]}return this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){se._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=se._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",se.engineResourcePath)}getUIElement(){return this.UIElement}async setUIElement(e){if(this._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if(typeof e=="string"||e instanceof String){if(!e.trim().startsWith("<")){let o=await fetch(e);if(!o.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+o.statusText);e=await o.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let r=document.createElement("div");r.innerHTML=e;for(let o=0;o<r.childElementCount;++o){let h=r.children[o];h instanceof HTMLStyleElement&&(this.styleEls.push(h),document.head.append(h))}(e=r.childElementCount==1?r.children[0]:r).remove()}this.UIElement=e,this._uiOriginalState={display:e&&e.style.display,inDom:document.body.contains(e)}}appendAndShowUI(){this.UIElement&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),this.UIElement.style.display=="none"&&(this.UIElement.style.display=""))}hideUI(){this.UIElement&&(this.UIElement.style.display="none")}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){var r;if(typeof e!="boolean"&&!["image","camera"].includes(e))throw new Error("Invalid value.");if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e;const o=(r=this._singleFrameInputContainer)===null||r===void 0?void 0:r.firstElementChild;o&&(e==="camera"?(o.setAttribute("capture",""),o.setAttribute("accept","image/*")):e!=1&&e!=="image"||(o.removeAttribute("capture"),o.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")))}set frameColorMode(e){this._framePixelFormat=e}get frameColorMode(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set framePixelFormat(e){this._framePixelFormat=e}get framePixelFormat(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let r of this._arrScanRegionOverlays)r&&this._updateScanRegionOverlay(r);this._updateDrawingLayersSize(),this.ifShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this.ifShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this.showScanRegionOverlays(),this._drawingLayersManager.setVisible(!0)}else this._softwareScale=1}set ifSaveLastUsedCamera(e){e?se.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this._isSingleFrameModeEnabled())){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let r of this._arrScanRegionOverlays)r&&this._updateScanRegionOverlay(r);this._updateVideoContainerStyle(),this._drawingLayersManager.setObjectFit(e)}}getVideoFit(){return this.videoFit}_showElClassName(){this._videoContainer&&this._videoContainer.classList.add("div-video-container"),this._cvsScanRegion&&this._cvsScanRegion.classList.add("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.add("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.add("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.add("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.add("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.add("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.add("cvs-single-frame"),this._singleFrameInputContainer&&this._singleFrameInputContainer.classList.add("div-single-frame-input-container")}_hideElClassName(){this._videoContainer&&(this._videoContainer.className=""),this._cvsScanRegion&&(this._cvsScanRegion.className=""),this._cvsViewDecorator&&(this._cvsViewDecorator.className=""),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.className=""),this._layerBaseCvs&&(this._layerBaseCvs.className=""),this._layerBaseCvs&&(this._layerBaseCvs.className=""),this._cvsOriginalImage&&(this._cvsOriginalImage.className=""),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.className=""),this._singleFrameInputContainer&&(this._singleFrameInputContainer.className="")}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display=="none"&&(this._cvsScanRegion.style.display=""),this._recordedStates.maskShow=!0)}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none",this._recordedStates.maskShow=!1)}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){if(this._bShowScanRegionLaser!==void 0)return this._bShowScanRegionLaser;if(this._controler){const e=this._controler.getPropertyDisiredValue("ifShowScanRegionLaser");if(e&&e.length){let r=0;for(let o of e)o||r++;return r!==this._controler.getRegisteredUsers().length}}return this._defaultBShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block"),this._recordedStates.laserShow=!0)}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none",this._recordedStates.laserShow=!1)}_checkValidRegion(e){return!(e!==null&&(!e||!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))||e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0||e.regionMeasuredByPercentage&&(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100)))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("Invalid region.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let r of this._arrScanRegionOverlays)r&&this._updateScanRegionOverlay(r)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}_calculateCvsSize(){var e,r;let o,h,g;if(this._isSingleFrameModeEnabled()?(o=this._imgWidth,h=this._imgHeight,g="contain"):(o=(e=this._video)===null||e===void 0?void 0:e.videoWidth,h=(r=this._video)===null||r===void 0?void 0:r.videoHeight,g=this.getVideoFit()),!o||!h)throw new Error("Invalid content dimensions.");return{width:o,height:h,objectFit:g}}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(this._updateScanRegionOverlay(e),!this._scanRegionOverlayContainer){const r=document.createElement("div");if(this._scanRegionOverlayContainer=r,r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",r.style.overflow="hidden",r.style.pointerEvents="none",this._layerBaseCvs)this._layerBaseCvs.parentElement.after(r);else if(this._cvsScanRegion)this._cvsScanRegion.after(r);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(r);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(r);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(r)}this._recordedStates.overlayShow=!0}return this._scanRegionOverlayContainer.append(e),this._arrScanRegionOverlays.push(e),e}removeScanRegionOverlayCanvas(e){const r=this._arrScanRegionOverlays.indexOf(e);r!==-1&&(e.remove(),this._arrScanRegionOverlays.splice(r,1))}_updateScanRegionOverlay(e){if(!e)return;let r;try{r=this._calculateCvsSize()}catch(ee){if((ee.message||ee)==="Invalid content dimensions.")return;throw ee}const{width:o,height:h,objectFit:g}=r;if(o<=0||h<=0)return e.width=0,void(e.height=0);const p=this._getRegionInPixels(o,h,this._scanRegion),v=this.getFrameSize(o,h,this._scanRegion,this.maxCvsSideLength),S=v.dWidth,w=v.dHeight;e.width==S&&e.height==w||(e.width=S,e.height=w);const x=window.getComputedStyle(this._elContainer),E=parseFloat(x.width),A=parseFloat(x.height),W=E/A,Y=o/h;let z,q,te,J,Z=1;g==="contain"?(Y>W?(Z=E/o,z=0,q=(A-h*Z)/2):(Z=A/h,z=(E-o*Z)/2,q=0),z+=p.regionLeft*Z,q+=p.regionTop*Z,te=(p.regionRight-p.regionLeft)*Z,J=(p.regionBottom-p.regionTop)*Z):g==="cover"?(Y>W?(Z=A/h,z=p.regionLeft*Z-(o*Z-E)/2,q=p.regionTop*Z):(Z=E/o,z=p.regionLeft*Z,q=p.regionTop*Z-(h*Z-A)/2),te=(p.regionRight-p.regionLeft)*Z,J=(p.regionBottom-p.regionTop)*Z):(z=0,q=0,te=0,J=0),e.style.position="absolute",e.style.left=z+"px",e.style.top=q+"px",e.style.width=te+"px",e.style.height=J+"px"}showScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display=="none"&&(this._scanRegionOverlayContainer.style.display=""),this._recordedStates.overlayShow=!0)}hideScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none",this._recordedStates.overlayShow=!1)}setViewDecorator(e,r){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));if(!r)throw new Error("Invalid area.");this._assertOpen();let o=[];if(typeof e=="string"?o.push(e):Array.isArray(e)&&(o=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator){if(this._cvsViewDecorator=document.createElement("canvas"),this._scanRegionOverlayContainer)this._scanRegionOverlayContainer.after(this._cvsViewDecorator);else if(this._layerBaseCvs)this._layerBaseCvs.parentElement.after(this._cvsViewDecorator);else if(this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsViewDecorator);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsViewDecorator)}this._recordedStates.decoratorShow=!0}this._decoratorArea=JSON.parse(JSON.stringify(r)),this._decoratorType.length=0;const h=["rectangle","focus"],g=["crossline","crosshair"];let p=!1,v=!1;for(let S of o)S=S.toLowerCase(),h.includes(S)&&!p&&(p=!0,this._decoratorType.push(S)),g.includes(S)&&!v&&(v=!0,!this._decoratorType.includes(S)&&this._decoratorType.push(S));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display=="none"&&(this._cvsViewDecorator.style.display=""),this._recordedStates.decoratorShow=!0)}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none",this._recordedStates.decoratorShow=!1)}setViewDecoratorLineWidth(e,r){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=r,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,r){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=r,this._updateViewDecorator()}setViewDecoratorFillStyle(e,r){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=r,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,r){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=r,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen||!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this._isSingleFrameModeEnabled())e="contain";else{if(!this._video)return;e=this.getVideoFit()}const r=this._cvsViewDecorator;r.style.position="absolute",r.style.width="100%",r.style.height="100%",r.style.left="0",r.style.top="0",r.style.objectFit=e,r.style.pointerEvents="none";const o=this.getVisibleRegion(!0);if(!o)return;const h=o.regionRight-o.regionLeft,g=o.regionBottom-o.regionTop;if(r.width==h&&r.height==g||(r.width=h,r.height=g),h<=0||g<=0)return;const p=r.getContext("2d");p.clearRect(0,0,r.width,r.height);const v=this._decoratorArea.x/100*h,S=this._decoratorArea.y/100*g,w=this._decoratorArea.width/100*h,x=this._decoratorArea.height/100*g;for(let E of this._decoratorType){if(E==="rectangle"){p.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,p.fillRect(0,0,r.width,r.height),p.clearRect(Math.round(v),Math.round(S),Math.round(w),Math.round(x)),p.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,p.fillRect(Math.round(v),Math.round(S),Math.round(w),Math.round(x)),p.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,p.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const A=p.lineWidth/2;p.strokeRect(Math.round(v-A),Math.round(S-A),Math.round(w+p.lineWidth),Math.round(x+p.lineWidth))}if(E==="focus"){p.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,p.fillRect(0,0,r.width,r.height),p.clearRect(Math.round(v),Math.round(S),Math.round(w),Math.round(x)),p.fillStyle=this._viewDecoratorInfo.focus.fillStyle,p.fillRect(Math.round(v),Math.round(S),Math.round(w),Math.round(x)),p.lineWidth=this._viewDecoratorInfo.focus.lineWidth,p.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const A=p.lineWidth/2,W=[0,.25,.75,1],Y=[0,.25,.75,1];p.beginPath();for(let z=0;z<W.length;z++)if(z==0||z==3)for(let q=0;q<Y.length;q+=2)p.moveTo(Math.round(v+W[z]*w),Math.round(S+Y[q]*x)),p.lineTo(Math.round(v+W[z]*w),Math.round(S+Y[q+1]*x));for(let z=0;z<Y.length;z++)if(z==0||z==3)for(let q=0;q<W.length;q+=2)p.moveTo(Math.round(v+W[q]*w-A),Math.round(S+Y[z]*x)),p.lineTo(Math.round(v+W[q+1]*w+A),Math.round(S+Y[z]*x));p.stroke()}if(E==="crossline"&&(p.beginPath(),p.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,p.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,p.moveTo(Math.round(v),Math.round(S+x/2)),p.lineTo(Math.round(v+w),Math.round(S+x/2)),p.moveTo(Math.round(v+w/2),Math.round(S)),p.lineTo(Math.round(v+w/2),Math.round(S+x)),p.stroke()),E==="crosshair"){p.beginPath();const A=.05*Math.min(w,x);p.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,p.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,p.moveTo(Math.round(v+(w-A)/2),Math.round(S+x/2)),p.lineTo(Math.round(v+(w+A)/2),Math.round(S+x/2)),p.moveTo(Math.round(v+w/2),Math.round(S+(x-A)/2)),p.lineTo(Math.round(v+w/2),Math.round(S+(x+A)/2)),p.stroke()}}}getVisibleRegion(e){let r;this._assertOpen();try{r=this._calculateCvsSize()}catch(v){if((v.message||v)==="Invalid content dimensions.")return null;throw v}const{width:o,height:h,objectFit:g}=r;let p=(()=>{const v=parseFloat(window.getComputedStyle(this._elContainer).width),S=parseFloat(window.getComputedStyle(this._elContainer).height);let w,x={regionBottom:h,regionRight:o,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return g==="cover"?v/S<o/h?(w=S/h,x.regionLeft=Math.floor((o-v/w)/2),x.regionRight=Math.ceil(o-x.regionLeft),x.regionTop=0,x.regionBottom=h):(w=v/o,x.regionTop=Math.floor((h-S/w)/2),x.regionBottom=Math.ceil(h-x.regionTop),x.regionLeft=0,x.regionRight=o):g==="none"&&(v<o&&S<h?(x.regionLeft=Math.floor((o-v)/2),x.regionRight=Math.ceil(o-x.regionLeft),x.regionTop=Math.floor((h-S)/2),x.regionBottom=Math.ceil(h-x.regionTop)):v<o?(x.regionLeft=Math.floor((o-v)/2),x.regionRight=Math.ceil(o-x.regionLeft),x.regionTop=0,x.regionBottom=h):S<h&&(x.regionTop=Math.floor((h-S)/2),x.regionBottom=Math.ceil(h-x.regionTop),x.regionLeft=0,x.regionRight=o)),x})();return e?p.regionMeasuredByPercentage=!1:(p.regionBottom=Math.ceil(p.regionBottom/h*100),p.regionRight=Math.ceil(p.regionRight/o*100),p.regionLeft=Math.floor(p.regionLeft/o*100),p.regionTop=Math.floor(p.regionTop/h*100),p.regionMeasuredByPercentage=!0),p}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,r,o){if(!(e<=0||r<=0))return o?o.regionMeasuredByPercentage?{regionLeft:Math.round(o.regionLeft/100*e),regionTop:Math.round(o.regionTop/100*r),regionRight:Math.round(o.regionRight/100*e),regionBottom:Math.round(o.regionBottom/100*r),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(o)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:r,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;let e;try{e=this._calculateCvsSize()}catch(S){if((S.message||S)==="Invalid content dimensions.")return;throw S}const{width:r,height:o,objectFit:h}=e;if(r<=0||o<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const g=this._getRegionInPixels(r,o,this._scanRegion);if(!this._cvsScanRegion){if(this._cvsScanRegion=document.createElement("canvas"),this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsScanRegion);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsScanRegion);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsScanRegion)}this._recordedStates.maskShow=!0}const p=this._cvsScanRegion;p.style.position="absolute",p.style.width="100%",p.style.height="100%",p.style.left="0",p.style.top="0",p.style.objectFit=h,p.style.pointerEvents="none",p.width==r&&p.height==o||(p.width=r,p.height=o);const v=p.getContext("2d");if(v.clearRect(0,0,p.width,p.height),g.regionLeft!=0||g.regionRight!=r||g.regionTop!=0||g.regionBottom!=o){const S=g.regionLeft,w=g.regionTop,x=g.regionRight-g.regionLeft,E=g.regionBottom-g.regionTop;v.fillStyle=this.regionMaskFillStyle,v.fillRect(0,0,p.width,p.height),v.clearRect(Math.round(S),Math.round(w),Math.round(x),Math.round(E)),v.strokeStyle=this.regionMaskStrokeStyle,v.lineWidth=this.regionMaskLineWidth;const A=v.lineWidth/2;v.strokeRect(Math.round(S-A),Math.round(w-A),Math.round(x+v.lineWidth),Math.round(E+v.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;let e;try{e=this._calculateCvsSize()}catch(q){if((q.message||q)==="Invalid content dimensions.")return;throw q}const{width:r,height:o,objectFit:h}=e;if(!this._divScanArea)return;if(r<=0||o<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const g=this._getRegionInPixels(r,o,this._scanRegion),p=window.getComputedStyle(this._elContainer),v=parseFloat(p.width),S=parseFloat(p.height),w=v/S,x=r/o;let E,A,W,Y,z=1;if(h==="contain")w<x?(z=v/r,E=0,A=(S-o*z)/2):(z=S/o,E=(v-r*z)/2,A=0),E+=g.regionLeft*z,A+=g.regionTop*z,W=(g.regionRight-g.regionLeft)*z,Y=(g.regionBottom-g.regionTop)*z;else if(h==="cover")if(w<x){z=S/o,E=g.regionLeft*z-(r*z-v)/2,E=Math.max(E,0),E=Math.min(E,parseFloat(p.width)),A=g.regionTop*z;let q=g.regionRight*z-(r*z-v)/2;q=Math.max(q,0),q=Math.min(q,parseFloat(p.width)),W=q-E,Y=(g.regionBottom-g.regionTop)*z}else{z=v/r,E=g.regionLeft*z,A=g.regionTop*z-(o*z-S)/2,A=Math.max(A,0),A=Math.min(A,parseFloat(p.height));let q=g.regionBottom*z-(o*z-S)/2;q=Math.max(q,0),q=Math.min(q,parseFloat(p.height)),W=(g.regionRight-g.regionLeft)*z,Y=q-A}else E=0,A=0,W=0,Y=0;this._divScanArea.style.left=E+"px",this._divScanArea.style.top=A+"px",this._divScanArea.style.width=W+"px",this._divScanArea.style.height=Y+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){if(this._croppingRegions!==void 0)return this._croppingRegions;if(this._controler){const e=this._controler.getPropertyDisiredValue("croppingRegions");if(e&&e.length===1)return e[0]}return this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'Invalid value.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){if(this._loopInterval!==void 0)return this._loopInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("loopInterval");if(e&&e.length===1)return e[0]}return this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("Invalid value.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){if(this._maxNumberOfFramesInBuffer!==void 0)return this._maxNumberOfFramesInBuffer;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxNumberOfFramesInBuffer");if(e&&e.length===1)return e[0]}return this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){if(this._refreshInterval!==void 0)return this._refreshInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("refreshInterval");if(e&&e.length===1)return e[0]}return this._defaultRefreshInterval}static async createInstance(e){let r=new se;(typeof e=="string"||e instanceof String)&&(e=JSON.parse(e));for(let o in e)r[o]=e[o];return this._hasEngineResourceLoaded=!0,se.onWarning&&(location&&location.protocol==="file:"?setTimeout(()=>{se.onWarning&&se.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):window.isSecureContext!==!1&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{se.onWarning&&se.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),r._drawingLayersManager=new Yl,r}static async playVideo(e,r,o){if(!e)throw new Error("Invalid 'videoEl'.");if(!r)throw new Error("Invalid 'source'.");return typeof r=="string"||r instanceof String?e.src=r:e.srcObject=r,new Promise((h,g)=>{let p;const v=()=>{e.removeEventListener("loadstart",x),e.removeEventListener("abort",E),e.removeEventListener("play",A),e.removeEventListener("error",W)},S=()=>{p&&clearTimeout(p),v(),h(e)},w=Y=>{p&&clearTimeout(p),v(),g(Y)},x=()=>{e.addEventListener("abort",E,{once:!0})},E=()=>{const Y=new Error("Video playing was interrupted.");Y.name="AbortError",w(Y)},A=()=>{S()},W=()=>{w(new Error(`Video error ${e.error.code}: ${e.error.message}.`))};e.addEventListener("loadstart",x,{once:!0}),e.autoplay?(e.addEventListener("play",A,{once:!0}),e.addEventListener("error",W,{once:!0})):(e.load(),e.play().then(()=>{S()}).catch(Y=>{w(Y)})),o&&(p=setTimeout(()=>{v(),g(new Error("Failed to play video. Timeout."))},o))})}static findBestRearCameraInIOS(e){if(!e||!e.length)return null;const r=["back","baksidan","bakre","bak","後置","后置","背面","خلفية","задна","posteriore","posterior","zadní","bagside","rück","πίσω","trasera","taka","arrière","אחורית","बैक","stražnja","hátsó","belakang","aртқы","후면","achterzijde","tylny","traseira","spate","задняя","задней","zadná","านหลัง","arka","sau"],o=["triple","三镜头","三鏡頭","トリプル","ثلاثية","тройна","trojný","τριπλή","kolmois","משולשת","ट्रिपल","trostruka","tiga","tripla","үштік","트리플","trippelt","trippel","trójobiektywowy","triplă","тройная","trojitá","สาม","üçlü","потроєна","ba camera"],h=["dual wide","dual-weitwinkel","dual con gran angular","dual","doble","double","双广角","雙廣角","デュアル広角","مزدوجة عريضة","двойна широкоъгълна","duální širokoúhlý","διπλή ευρεία","laajakulmainen kaksois","כפולה רחבה","ड्युअल वाइड","dvostruka široka","kettős, széles látószögű","ganda","doppia con grandangolo","қос кең бұрышты","듀얼 와이드","dwikamera","dobbelt vidvinkelkamera","dwuobiektywowy","dupla grande-angular","grande angular dupla","dublă","двойная широкоугольная","duálna širokouhlá","dubbel vidvinkel","คู่ด้านหลังมุมกว้าง","çift geniş","здвоєна ширококутна","kép rộng mặt sau"],g=e.filter(S=>{const w=S.label.toLowerCase();return r.some(x=>w.includes(x))});if(!g.length)return null;const p=g.find(S=>{const w=S.label.toLowerCase();return o.some(x=>w.includes(x))});if(p)return p.deviceId;const v=g.find(S=>{const w=S.label.toLowerCase();return h.some(x=>w.includes(x))});return v?v.deviceId:g[0].deviceId}static findBestRearCamera(e){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(Ae.OS))return se.findBestRearCameraInIOS(e);const r=["rear","back","rück","arrière","trasera","trás","traseira","posteriore","posterior","后面","後面","背面","后置","後置","背置","задней","خلفية","후","arka","achterzijde","หลัง","baksidan","bagside","sau","bak","tylny","taka","אחורית","πίσω","spate","hátsó","zadní","darrere","zadná","задня","stražnja","belakang","बैक","задна","aртқы","задняя","bakre","านหลัง"];for(let o of e){const h=o.label.toLowerCase();if(h&&r.some(g=>h.includes(g))&&/\b0(\b)?/.test(h))return o.deviceId}return["Android","HarmonyOS"].includes(Ae.OS)?e[e.length-1].deviceId:null}_isSingleFrameModeEnabled(){return this.singleFrameMode!=0}async play(e,r,o,h){let g;if(this._video&&this.videoSrc){se._onLog&&(g=Date.now(),se._onLog("DCE: start loading static video: "+g));const S=await se.playVideo(this._video,this.videoSrc,this.cameraOpenTimeout);if(se._onLog&&se._onLog("DCE: finish loading static video. Costs: "+(Date.now()-g)),!this._video)return S.pause(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};const w={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.playCallbackInfo=JSON.parse(JSON.stringify(w));const x=this.mapCameraEvents.get("played");for(let E of x){if(!E)continue;const A=JSON.parse(JSON.stringify(w));setTimeout(()=>{this.isDisposed&&this.disposed||E.apply(this,[A])},0)}return this._recordedStates.videoPlaying=!0,w}if(this._isSingleFrameModeEnabled())return h&&h.notTriggerSingleFrameClick||this._clickIptSingleFrameMode(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};if(!this._video)throw new Error("'video' is null or undefined.");const p=++this.iPlayRound;if(this.promisePlay&&(await this.promisePlay,p<this.iPlayRound))return this.playCallbackInfo={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId},{width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.promisePlay=(async()=>{var S;try{this._video&&this._video.srcObject&&this.stop(),se._onLog&&se._onLog("DCE: ======before video========");const w=()=>{if(!this._video)throw A&&A.getTracks().forEach(ee=>{ee.stop()}),this._videoTrack=null,this._currentCamera=null,new Error("'video' is null or undefined.")},x=this.getVideoSettings();let E,A;if(typeof x.video=="boolean"&&(x.video={}),e)delete x.video.facingMode,x.video.deviceId={exact:e};else if(!x.video.deviceId){if(this._lastDeviceId)delete x.video.facingMode,x.video.deviceId={exact:this._lastDeviceId};else if(this.ifSaveLastUsedCamera&&se.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete x.video.facingMode,x.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const ee=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),he=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));ee&&he&&(x.video.width=ee,x.video.height=he)}else if(!this.ifSkipCameraInspection){if(x.video.facingMode){if(await this.getAllCameras(!1),!this._video)throw new Error("'video' is null or undefined.");let ee=x.video.facingMode;if(ee instanceof Array&&ee.length&&(ee=ee[0]),ee=ee.exact||ee.ideal||ee,ee==="environment"){E=!0;const he=se.findBestRearCamera(this._allCameras);he&&(delete x.video.facingMode,x.video.deviceId={exact:he})}}}}r&&(x.video.width={ideal:r}),o&&(x.video.height={ideal:o}),se._onLog&&se._onLog("DCE: ======try getUserMedia========");let W=[0,500],Y=null;const z=async ee=>{for(let he of W){he&&await new Promise(fe=>setTimeout(fe,he)),w();try{se._onLog&&se._onLog("DCE: ask "+JSON.stringify(ee)),A=await navigator.mediaDevices.getUserMedia(ee);break}catch(fe){if(w(),fe.name==="NotFoundError"||fe.name==="NotAllowedError")throw fe;Y=fe,se._onLog&&se._onLog("DCE: "+fe.message||fe)}}w()};let q;if(await z(x),A||(se._onLog&&se._onLog("DCE: ======try getUserMedia again========"),q=JSON.parse(JSON.stringify(x)),typeof q.video=="object"&&(["iPhone","iPad"].includes(Ae.OS)?(r>=1280||o>=1280?q.video.width=1280:r>=640||o>=640?q.video.width=640:(r<640||o<640)&&(q.video.width=320),delete q.video.height):E&&!x.video.deviceId?(delete q.video.facingMode,this._allCameras.length&&(q.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):q.video=!0),se._onLog&&se._onLog("DCE: "+q),await z(q)),A||(W=[1e3,2e3],await z(x)),A||await z(q),!A)throw Y;const te=()=>{const ee=A.getVideoTracks();let he,fe;if(ee.length&&(he=this._videoTrack=ee[0]),this._video&&he){const _e=he.getSettings();if(_e){for(let y of this._allCameras)if(_e.deviceId===y.deviceId){y._checked=!0,y.label=he.label,fe=y;break}}}this._currentCamera=fe};if(await this.getAllCameras(!1),w(),E&&!this.ifSkipCameraInspection){te();const ee=se.findBestRearCamera(this._allCameras),he=(S=this._currentCamera)===null||S===void 0?void 0:S.deviceId;ee&&ee!=he&&(A.getTracks().forEach(fe=>{fe.stop()}),W=[0,500,1e3,2e3],x.video.deviceId={exact:ee},await z(x))}se._onLog&&se._onLog("DCE: ======play video========"),w(),await se.playVideo(this._video,A,this.cameraOpenTimeout),w(),se._onLog&&se._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused");const J="got "+this._video.videoWidth+"x"+this._video.videoHeight;this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=J,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),se._onLog&&se._onLog("DCE: got "+J),te(),this._renderSelCameraInfo();const Z={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};if(Z.deviceId&&(this._lastDeviceId=Z.deviceId,this.ifSaveLastUsedCamera&&se.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",this._lastDeviceId),x.video.width&&x.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(x.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(x.video.height))))),!h||!h.notTriggerPlayedEvent){const ee=this.mapCameraEvents.get("played");for(let he of ee){if(!he)continue;const fe=JSON.parse(JSON.stringify(Z));setTimeout(()=>{this.isDisposed&&this.disposed||he.apply(this,[fe])},0)}}return this.promisePlay=null,Z}catch(w){throw this.promisePlay=null,this._bgLoading&&(this._bgLoading.style.display="none"),w.name==="NotFoundError"&&(DOMException?w=new DOMException("No camera available, please use a device with an accessible camera.",w.name):(w=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),w}})(),se._onLog&&(g=Date.now(),se._onLog("DCE: start opening camera: "+g));const v=await this.promisePlay;return se._onLog&&se._onLog("DCE: finish opening camera. Costs: "+(Date.now()-g)),this.playCallbackInfo=JSON.parse(JSON.stringify(v)),this._recordedStates.videoPlaying=!0,v}async resume(){this._assertOpen(),this._video&&(await this._video.play(),this._recordedStates.videoPlaying=!0),this.ifShowScanRegionLaser&&this.showScanRegionLaser()}pause(){this._assertOpen(),this._video&&(this._video.pause(),this._recordedStates.videoPlaying=!1),this.ifShowScanRegionLaser&&this.hideScanRegionLaser()}isPaused(){var e;return!this._isSingleFrameModeEnabled()&&((e=this._video)===null||e===void 0?void 0:e.paused)===!0}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");const e=[this.UIElement];for(let r=0;r<e.length;++r)for(let o of e[r].children)e.push(o);for(let r of e){if(!this._video&&r.classList.contains(this.containerClassName)){this._elContainer=r;const o=document.createElement("video");o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.objectFit=this.getVideoFit(),o.setAttribute("autoplay","true"),o.setAttribute("playsinline","true"),o.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Ae.OS)&&Ae.version>=17&&o.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),this._video=o;const h=document.createElement("div");h.append(o),h.style.position="absolute",h.style.left="0",h.style.top="0",h.style.width="100%",h.style.height="100%",h.style.overflow="hidden",this._videoContainer=h,r.prepend(h)}else!this._divScanArea&&r.classList.contains("dce-scanarea")?this._divScanArea=r:!this._divScanLight&&r.classList.contains("dce-scanlight")?this._divScanLight=r:!this._bgLoading&&r.classList.contains("dce-bg-loading")?this._bgLoading=r:!this._bgCamera&&r.classList.contains("dce-bg-camera")?this._bgCamera=r:!this._selCam&&r.classList.contains("dce-sel-camera")?this._selCam=r:!this._selRsl&&r.classList.contains("dce-sel-resolution")?(this._selRsl=r,this.videoSrc||this._isSingleFrameModeEnabled()||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&r.classList.contains("dce-opt-gotResolution")?this._optGotRsl=r:!this._btnClose&&r.classList.contains("dce-btn-close")?this._btnClose=r:!this._selMinLtr&&r.classList.contains("dlr-sel-minletter")?(this._selMinLtr=r,this._selMinLtr.options.length||(this._selMinLtr.innerHTML=[this._optGotMinLtr?"":'<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._optGotMinLtr||this._selMinLtr.options[0])):!this._optGotMinLtr&&r.classList.contains("dlr-opt-gotMinLtr")&&(this._optGotMinLtr=r);if(this.extraBindings&&this.extraBindings.length)for(let o of this.extraBindings)try{o(r)}catch{}}if(!this._video)throw this._unbindUI(),Error(`Can not find the video container element with class '${this.containerClassName}'`);this._isSingleFrameModeEnabled()||this.videoSrc?(this._isSingleFrameModeEnabled()&&(this._elContainer&&(this._elContainer.addEventListener("click",this._clickIptSingleFrameMode),this._elContainer.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._elContainer&&(["Android","HarmonyOS"].includes(Ae.OS)?(this._elContainer.addEventListener("touchend",this._tapDoFocus),this._elContainer.addEventListener("touchmove",this._touchMoveEvent)):this._elContainer.addEventListener("click",this._tapDoFocus)),this._selCam&&(this._selCam.style.display="block",this._selCam.addEventListener("change",this._onCameraSelChange)),this._selRsl&&(this._selRsl.style.display="block",this._selRsl.addEventListener("change",this._onResolutionSelChange)),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._bgLoading&&(this._bgLoading.style.display="block")),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&(this._resizeObserver||(this._resizeObserver=new ResizeObserver(r=>{for(let o of r)o.target===this._elContainer&&this._updateLayers()})),this._elContainer&&this._resizeObserver.observe(this._elContainer)),this._windowWidth=document.documentElement.clientWidth,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){this._isSingleFrameModeEnabled()?(this._elContainer&&(this._elContainer.removeEventListener("click",this._clickIptSingleFrameMode),this._elContainer.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._elContainer&&(this._elContainer.removeEventListener("click",this._tapDoFocus),this._elContainer.removeEventListener("touchend",this._tapDoFocus),this._elContainer.removeEventListener("touchmove",this._touchMoveEvent)),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._drawingLayersManager.setVisible(!1),this._hideOriginalImageCvs(),this._videoContainer&&this._videoContainer.remove(),this._video=null,this._videoContainer=null,this._elContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}async open(e){this.UIElement||await this.setUIElement(se.defaultUIElementURL),this._bindUI(),e&&this.appendAndShowUI();let r=await this.play();this.bOpen=!0,this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this._isSingleFrameModeEnabled()&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1));const o=this.mapCameraEvents.get("cameraopen");for(let h of o){if(!h)continue;const g=JSON.parse(JSON.stringify(r));setTimeout(()=>{this.isDisposed&&this.disposed||h.apply(this,[g])},0)}return r}close(e){if(!this._video)return;this.stop(),this._hideOriginalImage(!1),this.hideTip(),this._unbindUI(),e&&this.hideUI(),this.stopFetchingLoop(),this.bOpen=!1;const r=this.mapCameraEvents.get("cameraclose");for(let o of r){if(!o)continue;const h={width:0,height:0,deviceId:null};setTimeout(()=>{this.isDisposed&&this.disposed||o.apply(this,[h])},0)}}stop(){this._video&&this._video.srcObject&&(se._onLog&&se._onLog("DCE: ======stop video========"),this._video.srcObject.getTracks().forEach(e=>{e.stop()}),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(se._onLog&&se._onLog("DCE: ======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0,this._reusedCvs&&this._reusedCvs.ctx2d&&this._reusedCvs.ctx2d.clearRect(0,0,this._reusedCvs.width,this._reusedCvs.height),this.forceLoseContext()}async getAllCameras(e=!0){let r=(await navigator.mediaDevices.enumerateDevices()).filter(g=>g.kind==="videoinput");if(e&&r&&r.length&&!r[0].deviceId){let g=await navigator.mediaDevices.getUserMedia({video:!0});r=(await navigator.mediaDevices.enumerateDevices()).filter(p=>p.kind==="videoinput"),g.getTracks().forEach(p=>{p.stop()})}const o=[],h=[];if(this._allCameras)for(let g of this._allCameras)g._checked&&h.push(g);for(let g=0;g<r.length;g++){let p,v=r[g];for(let S of h)if(v.deviceId==S.deviceId){p=S;break}p||(p={deviceId:v.deviceId,label:v.label?v.label:"camera "+g,_checked:!1}),p.deviceId&&o.push(p)}return this._allCameras=o,se._onLog&&se._onLog("DCE: "+JSON.stringify(this._allCameras)),o}_renderSelCameraInfo(){if(!this._selCam)return;let e;this._selCam.textContent="";for(let r of this._allCameras){const o=document.createElement("option");o.value=r.deviceId,o.innerText=r.label,this._selCam.append(o),r.deviceId&&this._currentCamera&&this._currentCamera.deviceId==r.deviceId&&(e=o)}this._selCam.value=e?e.value:""}getSelectedCamera(){if(!this._bOpen){let e="";const r=this.videoSettings.video.deviceId;r&&(e=r.exact||r.ideal||r);for(let o of this._allCameras)if(o.deviceId===e)return JSON.parse(JSON.stringify(o));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}async selectCamera(e){let r="";if(e&&(r=e.deviceId||e),this.videoSettings.video.deviceId={exact:r},!this._bOpen||this._video.paused)return null;let o=null;this._currentCamera&&(o=this._currentCamera.deviceId);const h=this._video.videoWidth,g=this._video.videoHeight,p=await this.play(e.deviceId||e);if(this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this._isSingleFrameModeEnabled()&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1)),o!==p.deviceId){const v=this.mapCameraEvents.get("camerachange");for(let S of v){if(!S)continue;const w=JSON.parse(JSON.stringify(p));setTimeout(()=>{this.isDisposed&&this.disposed||S.apply(this,[w])},0)}}if(h!==p.width||g!==p.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let S of this._arrScanRegionOverlays)S&&this._updateScanRegionOverlay(S);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const v=this.mapCameraEvents.get("resolutionchange");for(let S of v){if(!S)continue;const w=JSON.parse(JSON.stringify(p));setTimeout(()=>{this.isDisposed&&this.disposed||S.apply(this,[w])},0)}}return p}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,r=0;const o=this.videoSettings.video.width,h=this.videoSettings.video.height;return o&&(e=o.exact||o.ideal||o),h&&(r=h.exact||h.ideal||h),[e,r]}}async setResolution(e,r){let o,h;if(e instanceof Array?(o=e[0],h=e[1]):(o=e,h=r),this.videoSettings.video.width={ideal:o},this.videoSettings.video.height={ideal:h},!this._bOpen||this._video.paused)return null;const g=this._video.videoWidth,p=this._video.videoHeight,v=await this.play(null,o,h);if(g!==v.width||p!==v.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let w of this._arrScanRegionOverlays)w&&this._updateScanRegionOverlay(w);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const S=this.mapCameraEvents.get("resolutionchange");for(let w of S){if(!w)continue;const x=JSON.parse(JSON.stringify(v));setTimeout(()=>{this.isDisposed&&this.disposed||w.apply(this,[x])},0)}}return v}async getResolutions(e){var r,o;let h="";const g=(v,S)=>{const w=this._mapCameraResolutions.get(v);if(!w||!w.length)return!1;for(let x of w)if(x[0]===S.width&&x[1]===S.height)return!0;return!1},p=async(v,S,w)=>{const x={video:{deviceId:{exact:v},width:{ideal:S},height:{ideal:w}}};let E=null;try{E=await navigator.mediaDevices.getUserMedia(x)}catch{return null}if(!E)return null;const A=E.getVideoTracks();let W=null;try{const Y=A[0].getSettings();W={width:Y.width,height:Y.height}}catch{const z=document.createElement("video");z.srcObject=E,W={width:z.videoWidth,height:z.videoHeight},z.srcObject=null}return A.forEach(Y=>{Y.stop()}),W};if(!this._bOpen){const v=(o=(r=this.videoSettings)===null||r===void 0?void 0:r.video)===null||o===void 0?void 0:o.deviceId;if(!v||(h=v.hasOwnProperty("exact")?this.videoSettings.video.deviceId.exact:v.hasOwnProperty("ideal")?this.videoSettings.video.deviceId.ideal:this.videoSettings.video.deviceId,!h))return null;let S=this._mapCameraResolutions.get(h);if(S&&!e)return this._mapCameraResolutions.get(h);this._mapCameraResolutions.set(h,[]),S=this._mapCameraResolutions.get(h);for(let w of this._predefinedResolutions){const x=await p(h,w.width,w.height);x&&!g(h,x)&&S.push([x.width,x.height])}return S}if(this._currentCamera){h=this._currentCamera.deviceId;let v=this._mapCameraResolutions.get(h);if(v&&!e)return this._mapCameraResolutions.get(h);this._mapCameraResolutions.set(h,[]),v=this._mapCameraResolutions.get(h);let S=this._videoTrack;for(let w of this._predefinedResolutions){await S.applyConstraints({width:{ideal:w.width},height:{ideal:w.height}});const x=S.getSettings(),E={width:x.width,height:x.height};g(h,E)||v.push([E.width,E.height])}return this._video.srcObject.getTracks().forEach(w=>{w.stop()}),await this.play(h,null,null,{notTriggerPlayedEvent:!0}),v}return null}on(e,r){if(!r)return;const o=this.mapCameraEvents.get(e.toLowerCase());if(!o)throw new Error(`Event '${e}' does not exist.`);o.includes(r)||o.push(r)}off(e,r){const o=this.mapCameraEvents.get(e.toLowerCase());if(!o)throw new Error(`Event '${e}' does not exist.`);const h=o.indexOf(r);h!==-1&&o.splice(h,1)}offAll(e){if(e){if(typeof e=="string"){const r=this.mapCameraEvents.get(e);r&&(r.length=0)}}else for(let r of this.mapCameraEvents.values())r&&(r.length=0)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){if(this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen)return this.play()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getCapabilities()' is unavailable in singleFrameMode.");return this._videoTrack&&this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings():null}getConstraints(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getConstraints()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getConstraints():null}async applyConstraints(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');if(!this._videoTrack.applyConstraints)throw Error("Not supported.");return await this._videoTrack.applyConstraints(e)}async turnOnTorch(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")}async turnOffTorch(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")}async setColorTemperature(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let r=this.getCapabilities().colorTemperature;if(!r)throw Error("Not supported.");return e<r.min?e=r.min:e>r.max&&(e=r.max),await this._videoTrack.applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]})}getColorTemperature(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getColorTemperature()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().colorTemperature||0:null}async setExposureCompensation(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let r=this.getCapabilities().exposureCompensation;if(!r)throw Error("Not supported.");return e<r.min?e=r.min:e>r.max&&(e=r.max),await this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})}getExposureCompensation(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getExposureCompensation()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().exposureCompensation||0:null}async _setHardwareScale(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setHardwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");if(!this._videoTrack)return;const r=this.getCapabilities().zoom;if(!r)throw new Error("Not supported.");return e<r.min?e=r.min:e>r.max&&(e=r.max),e=We(e,r.min,r.step,r.max),await this._videoTrack.applyConstraints({advanced:[{zoom:e}]}),e}_getHardwareScale(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().zoom||1:null}_setSoftwareScale(e,r){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setSoftwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");r&&this._setScaleCenter(r),this._softwareScale=e,this._scaleVideo(e,r)}_getSoftwareScale(){return this._softwareScale}_setScaleCenter(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setScaleCenter()' is unavailable in singleFrameMode.");if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid center.");const r=this._video.videoWidth,o=this._video.videoHeight;let h=0,g=0;if(e.x.endsWith("px"))h=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");h=parseFloat(e.x)/100*r}if(e.y.endsWith("px"))g=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");g=parseFloat(e.y)/100*o}if(h==NaN||g==NaN)throw new Error("Invalid scale center.");this._scaleCenter={x:h,y:g}}_resetScaleCenter(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_resetScaleCenter()' is unavailable in singleFrameMode.");const e=this._video.videoWidth,r=this._video.videoHeight;this._scaleCenter={x:e/2,y:r/2}}_isVideoCenter(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_isVideoCenter()' is unavailable in singleFrameMode.");return e&&e.x==this._video.videoWidth/2&&e.y==this._video.videoHeight/2}async _setZoom(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const r=await this._setHardwareScale(e);let o=this._getHardwareScale();o==1&&r!=1&&(o=r),e>o?this._setSoftwareScale(e/o):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e)}catch(r){if((r.message||r)!=="Not supported.")throw r;this._setSoftwareScale(e)}}async setZoom(e){if(typeof e!="number"&&typeof e!="object")throw new TypeError("Illegal type of argument.");if(typeof e=="number")return this._setZoom(e);if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e){if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid value.");e.centerPoint?this._setScaleCenter(e.centerPoint):this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const r=await this._setHardwareScale(e.factor);let o=this._getHardwareScale();o==1&&r!=1&&(o=r),e.factor>o?this._setSoftwareScale(e.factor/o):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e.factor)}catch(r){if((r.message||r)!=="Not supported.")throw r;this._setSoftwareScale(e.factor)}}}getZoom(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?this._getHardwareScale()*this._softwareScale:null}getZoomSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?{factor:this._getHardwareScale()*this._softwareScale}:null}async resetZoom(){await this.setZoom({factor:1})}async setFrameRate(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let r=this.getCapabilities().frameRate;if(!r)throw Error("Not supported.");return e<r.min?e=r.min:e>r.max&&(e=r.max),await this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e})}getFrameRate(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getFrameRate()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().frameRate:null}async _setFocus(e,r){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(typeof e!="string")throw Error("Invalid focus mode.");e=e.toLowerCase();const o=this.getCapabilities().focusMode,h=this.getCapabilities().focusDistance;if(!o)throw Error("Not supported.");if(!o.includes(e))throw Error("Unsupported mode.");if(r>=0){if(!h)throw Error("Manual focus unsupported.");return r<h.min?r=h.min:r>h.max&&(r=h.max),r=We(r,h.min,h.step,h.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:r}]})}return await this._videoTrack.applyConstraints({advanced:[{focusMode:e}]})}async setFocus(e,r){if(typeof e=="string")return this._setFocus(e,r);if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(!e)return;const o=this.getCapabilities(),h=o.focusMode,g=o.focusDistance;if(!h)throw Error("Not supported.");if(typeof e.mode!="string")throw Error("Invalid focus mode.");const p=e.mode.toLowerCase();if(!h.includes(p))throw Error("Unsupported focus mode.");if(p!=="manual")return this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:p}]});if(!g)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let v=e.distance;return v<g.min?v=g.min:v>g.max&&(v=g.max),v=We(v,g.min,g.step,g.max),this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:p,focusDistance:v}]})}if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const v=e.area.centerPoint;let S=e.area.width,w=e.area.height;if(!S||!w){const x=this._video.videoWidth,E=this._video.videoHeight;S||(S=2*Math.round(Math.min(x,E)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),w||(w=2*Math.round(Math.min(x,E)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters._focusArea={centerPoint:{x:v.x,y:v.y},width:S,height:w},await this._setLocalFocus(v,S,w)}}getFocus(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings().focusMode;return e?e==="continuous"?{mode:e}:{mode:e,distance:this._videoTrack.getSettings().focusDistance}:null}getFocusSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings(),r=e.focusMode;return r?r==="manual"?this._focusParameters._focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters._focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:r}:null}async _setFocusAndGetContract(e,r){const o=A=>{if(!this._bOpen||!this._videoTrack||this.video.paused||A.focusTaskId!=this._focusParameters.curFocusTaskId){this._bOpen&&this._videoTrack&&!this.video.paused||(this._focusParameters.isDoingFocus=0);const W=new Error(`Focus task ${A.focusTaskId} canceled.`);throw W.name="DeprecatedTaskError",W}this._focusParameters.isDoingFocus===1&&Date.now()-A.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let h;r=We(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}),o(e),h=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/r),Math.abs(1/this._focusParameters.fds.max-1/r))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/r)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=r,await new Promise(A=>{setTimeout(A,h)}),o(e);let g=e.focusL-e.focusW/2,p=e.focusT-e.focusH/2,v=e.focusW,S=e.focusH;if(g>=this.video.videoWidth||p>=this.video.videoHeight)throw new Error("Invalid area.");g+v>this.video.videoWidth&&(v=this.video.videoWidth-g),p+S>this.video.videoHeight&&(S=this.video.videoHeight-p);const w=this._getImageData(this.video,this.video.videoWidth,this.video.videoHeight,{sx:g,sy:p,sWidth:v,sHeight:S,dWidth:v,dHeight:S},null,{pixelFormat:Se.RGBA});if(!w)return this._setFocusAndGetContract(e,r);const x=w.data;let E=0;for(let A=0,W=x.length-8;A<W;++A){let Y=x[A]-x[A+8];++A;let z=x[A]-x[A+8];++A;let q=x[A]-x[A+8];++A,E+=Y*Y+z*z+q*q}return-E}async _doFocusDetail(e,r,o,h,g,p,v){let S;if(r=We(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),h=We(h,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),p?p=We(p,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(p=We(Math.sqrt((r||this._focusParameters.fds.step)*(h||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),v=await this._setFocusAndGetContract(e,p)),v<=o&&v<=g?S=3:o<g&&o<v?S=1:g<o&&g<v&&(S=2),(h-r)/2<=this._focusParameters.fds.step)return S===3||(S===1?await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}):S===2&&await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:h}]})),!0;if(S===1)return await this._doFocusDetail(e,r,o,p,v);if(S===2)return await this._doFocusDetail(e,p,v,h,g);if(S!==3)return o=await this._setFocusAndGetContract(e,r),g=await this._setFocusAndGetContract(e,h),await this._doFocusDetail(e,r,o,h,g);let w=We(Math.sqrt((r||this._focusParameters.fds.step)*(p||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),x=We(Math.sqrt((h||this._focusParameters.fds.step)*(p||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/w)<=Math.abs(1/this._focusParameters.oldDistance-1/x)){let E=await this._setFocusAndGetContract(e,w);if(E<v)return await this._doFocusDetail(e,r,o,p,v,w,E);if(E==v)return await this._doFocusDetail(e,w,E,p,v);let A=await this._setFocusAndGetContract(e,x);if(E>v&&v<A)return await this._doFocusDetail(e,w,E,x,A,p,v);if(v==A)return await this._doFocusDetail(e,p,v,x,A);if(v>A)return await this._doFocusDetail(e,p,v,h,g,x,A)}else{let E=await this._setFocusAndGetContract(e,x);if(v>E)return await this._doFocusDetail(e,p,v,h,g,x,E);if(v==E)return await this._doFocusDetail(e,p,v,x,E);let A=await this._setFocusAndGetContract(e,w);if(A>v&&v<E)return await this._doFocusDetail(e,w,A,x,E,p,v);if(A==v)return await this._doFocusDetail(e,w,A,p,v);if(A<v)return await this._doFocusDetail(e,r,o,p,v,w,A)}return!1}async _setLocalFocus(e,r,o,h,g){if(this._focusParameters.isDoingFocus==1)return!1;if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid centerPoint.");if(!r||typeof r!="string")throw new Error("Invalid width.");if(!o||typeof o!="string")throw new Error("Invalid height.");const p=this._video.videoWidth,v=this._video.videoHeight;let S=0,w=0;if(e.x.endsWith("px"))S=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid centerPoint.");S=parseFloat(e.x)/100*p}if(e.y.endsWith("px"))w=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid centerPoint.");w=parseFloat(e.y)/100*v}if(S==NaN||w==NaN)throw new Error("Invalid centerPoint.");let x=0;if(r.endsWith("px"))x=parseFloat(r);else{if(!r.endsWith("%"))throw new Error("Invalid width.");x=parseFloat(r)/100*p}if(x==NaN)throw new Error("Invalid width.");let E=0;if(o.endsWith("px"))E=parseFloat(o);else{if(!o.endsWith("%"))throw new Error("Invalid height.");E=parseFloat(o)/100*v}if(E==NaN)throw new Error("Invalid height.");if(this._softwareScale!==1){const Y=this._softwareScale,z=this._scaleCenter;x/=Y,E/=Y,S=(1-1/Y)*z.x+S/Y,w=(1-1/Y)*z.y+w/Y}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const A={focusL:S,focusT:w,focusW:x,focusH:E,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},W=async(Y,z,q)=>{try{(z==null||z<this._focusParameters.fds.min)&&(z=this._focusParameters.fds.min),(q==null||q>this._focusParameters.fds.max)&&(q=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let te=We(Math.sqrt(q*(z||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),J=We(Math.sqrt((z||this._focusParameters.fds.step)*te),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),Z=We(Math.sqrt(te*q),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),ee=await this._setFocusAndGetContract(Y,Z),he=await this._setFocusAndGetContract(Y,J),fe=await this._setFocusAndGetContract(Y,te);if(he>fe&&fe<ee){const _e=await this._doFocusDetail(Y,J,he,Z,ee,te,fe);return this._focusParameters.isDoingFocus=0,_e}if(he<fe&&he<ee){let _e=await this._setFocusAndGetContract(Y,z);const y=await this._doFocusDetail(Y,z,_e,te,fe,J,he);return this._focusParameters.isDoingFocus=0,y}if(fe>ee&&he>ee){let _e=await this._setFocusAndGetContract(Y,q);const y=await this._doFocusDetail(Y,te,fe,q,_e,Z,ee);return this._focusParameters.isDoingFocus=0,y}if(he==fe&&fe<ee){const _e=await this._doFocusDetail(Y,J,he,te,fe);return this._focusParameters.isDoingFocus=0,_e}if(fe==ee&&he>fe){const _e=await this._doFocusDetail(Y,te,fe,Z,ee);return this._focusParameters.isDoingFocus=0,_e}return W(Y,z,q)}catch(te){if(te.name!=="DeprecatedTaskError")throw te}};return W(A,h,g)}async enableTapToFocus(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'enableTapToFocus()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error("Video is not playing.");if(!this._focusSupported)throw new Error("Tapping to focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,this._tapFocusEnabled=!1,new Error("Tapping to focus unsupported.");this._tapFocusEnabled=!0}disableTapToFocus(){this._tapFocusEnabled=!1}isTapToFocusEnabled(){return this._tapFocusEnabled}_updateVideoContainerStyle(){if(!this._video||this._isSingleFrameModeEnabled())return;const e=this._getSoftwareScale(),r=this._videoContainer;if(this.videoFit==="contain"&&e>1){const o=this._video.videoWidth,h=this._video.videoHeight,g=window.getComputedStyle(this._elContainer),p=parseFloat(g.width),v=parseFloat(g.height),S=o/h;if(p/v<S){let w=p/S;r.style.left="0",r.style.top=(v-w)/2/v*100+"%",r.style.width="100%",r.style.height=w/v*100+"%"}else{let w=v*S;r.style.left=(p-w)/2/p*100+"%",r.style.top="0",r.style.width=w/p*100+"%",r.style.height="100%"}}else r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%"}_scaleVideo(e,r){if(this._video&&!this._isSingleFrameModeEnabled()){if(e<1)throw new RangeError("Invalid scale value.");if(r&&this._setScaleCenter(r),e===1)this._video.style.transform="";else{const o=this.getVideoFit(),h=this._video.videoWidth,g=this._video.videoHeight,p=window.getComputedStyle(this._elContainer),v=parseFloat(p.width),S=parseFloat(p.height),w=v/S,x=h/g;let E=1;o==="contain"?E=w<x?v/(h/e):S/(g/e):o==="cover"&&(E=x>w?S/(h/e):v/(g/e));const A=E*(1-1/e)*(h/2-this._scaleCenter.x),W=E*(1-1/e)*(g/2-this._scaleCenter.y);this._video.style.transform=`translate(${A}px, ${W}px) scale(${e})`}this._updateVideoContainerStyle()}}getFrameSize(e,r,o,h){if(!e||!r)return null;let g,p,v,S,w=e,x=r;const E={regionLeft:0,regionTop:0,regionRight:w,regionBottom:x,regionMeasuredByPercentage:!1};o?(o.regionMeasuredByPercentage?(E.regionLeft=o.regionLeft*w/100,E.regionTop=o.regionTop*x/100,E.regionRight=o.regionRight*w/100,E.regionBottom=o.regionBottom*x/100):(E.regionLeft=o.regionLeft,E.regionTop=o.regionTop,E.regionRight=o.regionRight,E.regionBottom=o.regionBottom),g=Math.round(E.regionLeft),p=Math.round(E.regionTop),w=Math.round(E.regionRight-E.regionLeft),x=Math.round(E.regionBottom-E.regionTop)):(g=0,p=0,w=Math.round(w),x=Math.round(x));const A=Math.max(w,x);if(h&&h>0&&A>h){const W=h/A;w>x?(v=h,S=Math.round(x*W)):(v=Math.round(w*W),S=h)}else v=w,S=x;return v<=0||S<=0?null:{sx:g,sy:p,sWidth:w,sHeight:x,dWidth:v,dHeight:S}}getFrame(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoData()}getImage(){return this.getFrame()}_drawImage(e,r,o,h,g,p,v){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!o||!h)return null;if(r instanceof HTMLVideoElement&&r.readyState!==4||r instanceof HTMLImageElement&&!r.complete)throw new Error("The source is not loaded.");let S;se._onLog&&(S=Date.now(),se._onLog("DCE: _drawImage(), START: "+S));let w=0,x=0,E=o,A=h,W=0,Y=0,z=o,q=h;g&&(g.sx&&(w=Math.round(g.sx)),g.sy&&(x=Math.round(g.sy)),g.sWidth&&(E=Math.round(g.sWidth)),g.sHeight&&(A=Math.round(g.sHeight)),g.dx&&(W=Math.round(g.dx)),g.dy&&(Y=Math.round(g.dy)),g.dWidth&&(z=Math.round(g.dWidth)),g.dHeight&&(q=Math.round(g.dHeight)));let te=Se.RGBA;v&&v.pixelFormat&&(te=v.pixelFormat);const J=e;if(!v||!v.bUseWebGL){se._onLog&&se._onLog("DCE: _drawImage() in context2d."),J.ctx2d||(J.ctx2d=J.getContext("2d",{willReadFrequently:!0}));const Z=J.ctx2d;if(!Z)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(J.width<W+z||J.height<Y+q)&&(J.width=W+z,J.height=Y+q),Z.drawImage(r,w,x,E,A,W,Y,z,q),se._onLog&&se._onLog("DCE: _drawImage() in context2d end. Costs: "+(Date.now()-S)),{context:Z,pixelFormat:Se.RGBA,_bUseWebGL:!1}}se._onLog&&se._onLog("DCE: _drawImage() in WebGL.");try{(J.width<W+z||J.height<Y+q)&&(J.width=W+z,J.height=Y+q,J.ctxWebGL&&J.ctxWebGL.viewport(0,0,W+z,Y+q));const Z=J.ctxWebGL||J.getContext("webgl",{antialias:!1})||J.getContext("experimental-webgl",{antialias:!1});if(!Z){se._onLog&&se._onLog("DCE: WebGL unavailable.");const y=new Error("WebGL error: unable to initialize WebGL. Your browser or machine may not support it.");throw y.name="WebGLError",y}if(!J.ctxWebGL||te!==this.shaderPixelFormat){J.ctxWebGL=Z;const y=i=>{const n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW);const c=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,c),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW),{positions:n,texCoords:c}},ge=i=>{const n=i.createTexture();return i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n},pe=(i,n)=>{const c=i.createProgram();if(n.forEach(_=>i.attachShader(c,_)),i.linkProgram(c),!i.getProgramParameter(c,i.LINK_STATUS)){const _=new Error(`An error occured linking the program: ${i.getProgramInfoLog(c)}.`);throw _.name="WebGLError",_}return i.useProgram(c),c},Te=(i,n,c)=>{const _=i.createShader(n);if(i.shaderSource(_,c),i.compileShader(_),!i.getShaderParameter(_,i.COMPILE_STATUS)){const d=new Error(`An error occured compiling the shader: ${i.getShaderInfoLog(_)}.`);throw d.name="WebGLError",d}return _},l=`
                        attribute vec2 a_position;
                        attribute vec2 a_texCoord;
    
                        uniform mat3 u_matrix;
                        uniform mat3 u_textureMatrix;
    
                        varying vec2 v_texCoord;
                        void main(void) {
                        gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                        v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                        }
                    `;let s="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(te)&&(s=te.slice(0,3));const a=`
                        precision mediump float;
                        varying vec2 v_texCoord;
                        uniform sampler2D u_image;
                        uniform float uColorFactor;
    
                        void main() {
                            vec4 sample = texture2D(u_image, v_texCoord);
                            float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                            gl_FragColor = vec4(sample.${s} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                        }
                    `,u=pe(Z,[Te(Z,Z.VERTEX_SHADER,l),Te(Z,Z.FRAGMENT_SHADER,a)]);this._webGLProgramInfo={program:u,attribLocations:{vertexPosition:Z.getAttribLocation(u,"a_position"),texPosition:Z.getAttribLocation(u,"a_texCoord")},uniformLocations:{uSampler:Z.getUniformLocation(u,"u_image"),uColorFactor:Z.getUniformLocation(u,"uColorFactor"),uMatrix:Z.getUniformLocation(u,"u_matrix"),uTextureMatrix:Z.getUniformLocation(u,"u_textureMatrix")}},this._webGLBuffers=y(Z),this._webGLTexture=ge(Z),this.shaderPixelFormat=te}const ee=(y,ge,pe)=>{y.bindBuffer(y.ARRAY_BUFFER,ge),y.enableVertexAttribArray(pe),y.vertexAttribPointer(pe,2,y.FLOAT,!1,0,0)},he=(y,ge,pe)=>{const Te=y.RGBA,l=y.RGBA,s=y.UNSIGNED_BYTE;y.bindTexture(y.TEXTURE_2D,ge),y.texImage2D(y.TEXTURE_2D,0,Te,l,s,pe)},fe=(y,ge,pe,Te)=>{y.clearColor(0,0,0,1),y.clearDepth(1),y.enable(y.DEPTH_TEST),y.depthFunc(y.LEQUAL),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),ee(y,pe.positions,ge.attribLocations.vertexPosition),ee(y,pe.texCoords,ge.attribLocations.texPosition),y.activeTexture(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,Te),y.uniform1i(ge.uniformLocations.uSampler,0),y.uniform1f(ge.uniformLocations.uColorFactor,[Se.GREY,Se.GREY32].includes(te)?1:0);let l,s,a=Ge.translate(Ge.identity(),-1,-1);a=Ge.scale(a,2,2),a=Ge.scale(a,1/y.canvas.width,1/y.canvas.height),l=Ge.translate(a,W,Y),l=Ge.scale(l,z,q),y.uniformMatrix3fv(ge.uniformLocations.uMatrix,!1,l),s=Ge.translate(Ge.identity(),w/o,x/h),s=Ge.scale(s,E/o,A/h),y.uniformMatrix3fv(ge.uniformLocations.uTextureMatrix,!1,s),y.drawArrays(y.TRIANGLES,0,6)};let _e;if(he(Z,this._webGLTexture,r),fe(Z,this._webGLProgramInfo,this._webGLBuffers,this._webGLTexture),p){if(p.length<z*q*4)throw new Error("Unexpected size of the 'bufferContainer'.");_e=p}else _e=new Uint8Array(z*q*4);if(Z.readPixels(W,Y,z,q,Z.RGBA,Z.UNSIGNED_BYTE,_e),_e[3]!==255){se._onLog&&se._onLog("DCE: WebGL drawing incorrect."),this._bWebGLSupported=!1;const y=new Error("WebGL error: incorrect WebGL drawing.");throw y.name="WebGLError",y}return se._onLog&&se._onLog("DCE: _drawImage() in WebGL end. Costs: "+(Date.now()-S)),{context:Z,pixelFormat:te===Se.GREY?Se.GREY32:te,_bUseWebGL:!0}}catch(Z){throw this._bWebGLSupported=!1,Z.name="WebGLError",Z}}_readCvsData(e,r,o){let h,g=0,p=0,v=e.canvas.width,S=e.canvas.height;if(r&&(r.x&&(g=r.x),r.y&&(p=r.y),r.width&&(v=r.width),r.height&&(S=r.height)),e instanceof WebGLRenderingContext){const w=e;if(o){if(o.length<v*S*4)throw new Error("Unexpected size of the 'bufferContainer'.");w.readPixels(g,p,v,S,w.RGBA,w.UNSIGNED_BYTE,o),h=new Uint8Array(o.buffer,0,v*S*4)}else h=new Uint8Array(v*S*4),w.readPixels(g,p,v,S,w.RGBA,w.UNSIGNED_BYTE,h)}else if(e instanceof CanvasRenderingContext2D){let w;if(w=e.getImageData(g,p,v,S),h=new Uint8Array(w.data.buffer),o){if(o.length<h.length)throw new Error("Unexpected size of the 'bufferContainer'.");o.set(h)}}return h}_transformPixelFormat(e,r,o,h){let g,p;if(se._onLog&&(g=Date.now(),se._onLog("DCE: _transformPixelFormat(), START: "+g)),r===o)return se._onLog&&se._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-g)),h?new Uint8Array(e):e;const v=[Se.RGBA,Se.RBGA,Se.GRBA,Se.GBRA,Se.BRGA,Se.BGRA];if(v.includes(r))if(o===Se.GREY){p=new Uint8Array(e.length/4);for(let S=0;S<e.length;S+=4){const w=.21*e[S]+.71*e[S+1]+.07*e[S+2];p[S/4]=w}}else if(o===Se.GREY32){p=h?new Uint8Array(e):e;for(let S=0;S<e.length;S+=4){const w=.21*e[S]+.71*e[S+1]+.07*e[S+2];p[S]=w,p[S+1]=w,p[S+2]=w}}else{if(!v.includes(o))throw new Error("Unable to transform.");if(h){p=new Uint8Array(e);const S=r.indexOf("r"),w=r.indexOf("g"),x=r.indexOf("b"),E=o.indexOf("r"),A=o.indexOf("g"),W=o.indexOf("b");for(let Y=0;Y<e.length;Y+=4)p[Y+E]=e[Y+S],p[Y+A]=e[Y+w],p[Y+W]=e[Y+x]}else{p=e;const S=r.indexOf("r"),w=r.indexOf("g"),x=r.indexOf("b"),E=o.indexOf("r"),A=o.indexOf("g"),W=o.indexOf("b");for(let Y=0;Y<e.length;Y+=4){let z=[e[Y],e[Y+1],e[Y+2]];p[Y+E]=z[S],p[Y+A]=z[w],p[Y+W]=z[x]}}}else if(r===Se.GREY){if(o!==Se.GREY32)throw new Error("Unable to transform.");p=new Uint8Array(4*e.length);for(let S=0;S<e.length;S++)p[4*S]=e[S],p[4*S+1]=e[S],p[4*S+2]=e[S],p[4*S+3]=255}else{if(r!==Se.GREY32)throw new Error("Unable to transform.");if(o!==Se.GREY)throw new Error("Unable to transform.");p=new Uint8Array(e.length/4);for(let S=0;S<e.length;S+=4)p[S/4]=e[S]}return se._onLog&&se._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-g)),p}_getImageData(e,r,o,h,g,p){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!r||!o)return null;if(h.sx>r||h.sy>o||h.sx+h.sWidth>r||h.sy+h.sHeight>o)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let v;se._onLog&&(v=Date.now(),se._onLog("DCE: _getImageData(), START: "+v));const S=Math.round(h.sx),w=Math.round(h.sy),x=Math.round(h.sWidth),E=Math.round(h.sHeight),A=Math.round(h.dWidth),W=Math.round(h.dHeight);let Y=Se.RGBA;p&&p.pixelFormat&&(Y=p.pixelFormat);let z,q,te,J=this._bWebGLSupported;p&&p.bUseWebGL==0&&(J=!1),J?(this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),z=this._reusedWebGLCvs):(this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),z=this._reusedCvs);try{if(J)if(se._onLog&&se._onLog("DCE: _getImageData() in WebGL."),g)if(Y===Se.GREY){if(te=new Uint8Array(A*W*4),q=this._drawImage(z,e,r,o,{sx:S,sy:w,sWidth:x,sHeight:E,dWidth:A,dHeight:W},te,{pixelFormat:Y,bUseWebGL:J}),te=this._transformPixelFormat(te,q.pixelFormat,Y),g){if(g.length<te.length)throw new Error("Unexpected size of the 'bufferContainer'.");g.set(te)}}else q=this._drawImage(z,e,r,o,{sx:S,sy:w,sWidth:x,sHeight:E,dWidth:A,dHeight:W},g,{pixelFormat:Y,bUseWebGL:J}),te=new Uint8Array(g.buffer,0,A*W*4),te=this._transformPixelFormat(te,q.pixelFormat,Y);else Y===Se.GREY?((!this._tempDataContainer||this._tempDataContainer.length<A*W*4)&&(this._tempDataContainer=new Uint8Array(A*W*4)),te=new Uint8Array(this._tempDataContainer.buffer,0,A*W*4)):te=new Uint8Array(A*W*4),q=this._drawImage(z,e,r,o,{sx:S,sy:w,sWidth:x,sHeight:E,dWidth:A,dHeight:W},te,{pixelFormat:Y,bUseWebGL:J}),te=this._transformPixelFormat(te,q.pixelFormat,Y);else if(se._onLog&&se._onLog("DCE: _getImageData() in context2d."),q=this._drawImage(z,e,r,o,{sx:S,sy:w,sWidth:x,sHeight:E,dWidth:A,dHeight:W},null,{pixelFormat:Se.RGBA,bUseWebGL:J}),te=this._readCvsData(q.context,{width:A,height:W},null),te=this._transformPixelFormat(te,q.pixelFormat,Y),g){if(g.length<te.length)throw new Error("Unexpected size of the 'bufferContainer'.");g.set(te)}}catch(Z){if(Z.name==="WebGLError")return se._onLog&&se._onLog("DCE: _getImageData() in WebGL failed, try again in context2d."),this.forceLoseContext(),this._bWebGLSupported=!1,this._getImageData(e,r,o,{sx:S,sy:w,sWidth:x,sHeight:E,dWidth:A,dHeight:W},g,p);throw Z}return se._onLog&&se._onLog("DCE: _getImageData() end. Costs: "+(Date.now()-v)),{data:te,pixelFormat:Y,_bUseWebGL:q._bUseWebGL}}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._reusedWebGLCvs=null}_getVideoData(e,r){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getVideoData()' is unavailable in singleFrameMode.");if(!this._video||this._video.readyState!==4)return null;const o=Date.now();se._onLog&&se._onLog("DCE: _getVideoData() START: "+o);let h=this._scanRegion;r&&r.hasOwnProperty("region")&&(h=r.region);let g=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase());r&&r.pixelFormat&&(g=this.mapPixelFormatString_Enum.get(r.pixelFormat.toLowerCase()));let p=this._softwareScale;r&&r.scale&&(p=r.scale);const v=this._video.videoWidth,S=this._video.videoHeight;let w=this._scaleCenter;if(r&&r.scaleCenter){if(typeof r.scaleCenter.x!="string"||typeof r.scaleCenter.y!="string")throw new Error("Invalid scale center.");let z=0,q=0;if(r.scaleCenter.x.endsWith("px"))z=parseFloat(r.scaleCenter.x);else{if(!r.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");z=parseFloat(r.scaleCenter.x)/100*v}if(r.scaleCenter.y.endsWith("px"))q=parseFloat(r.scaleCenter.y);else{if(!r.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");q=parseFloat(r.scaleCenter.y)/100*S}if(z==NaN||q==NaN)throw new Error("Invalid scale center.");w.x=Math.round(z),w.y=Math.round(q)}if(v===0||S===0)return null;const x=this.getFrameSize(v,S,h,this.maxCvsSideLength);if(!x)return null;let E=!0;v===x.sWidth&&S===x.sHeight&&(E=!1);const A={data:null,region:h?JSON.parse(JSON.stringify(h)):null,sx:x.sx,sy:x.sy,width:x.dWidth,height:x.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:E,toCanvas:this._toCanvas,_sWidth:x.sWidth,_sHeight:x.sHeight,_bUseWebGL:null};p!==1&&(x.sWidth=Math.round(x.sWidth/p),x.sHeight=Math.round(x.sHeight/p),x.sx=Math.round((1-1/p)*w.x+x.sx/p),x.sy=Math.round((1-1/p)*w.y+x.sy/p));const W=this._getImageData(this._video,v,S,x,e,{pixelFormat:g});if(!W)return null;const Y=Date.now();return se._onLog&&se._onLog("DCE: _getVideoData() END: "+Y),A.data=W.data,A.pixelFormat=A.colorMode=W.pixelFormat,A._bUseWebGL=W._bUseWebGL,A.timeSpent=Y-o,A.timeStamp=Y,W.pixelFormat===Se.GREY?A.stride=A.width:A.stride=4*A.width,A}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.isDisposed&&this.disposed)return;if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();const r=()=>{se._onLog&&se._onLog("DCE: start fetching a frame into buffer: "+Date.now());const h=this.getCurrentRegion();let g=this._getVideoData(null,{region:h});if(!g)return void(se._onLog&&se._onLog("DCE: get a invalid frame, abandon it: "+Date.now()));for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(g),se._onLog&&se._onLog("DCE: finish fetching a frame into buffer: "+Date.now());const p=this.mapCameraEvents.get("frameaddedtobuffer");for(let v of p)v&&setTimeout(()=>{this.isDisposed&&this.disposed||v.apply(this)},0)},o=()=>{this.isDisposed&&this.disposed||(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout(()=>{this.isDisposed&&this.disposed||(this._bOpen&&this.isFetchingLoopStarted()?(se._onLog&&se._onLog("DCE: second timeout executes: "+Date.now()),r(),o()):this.stopFetchingLoop())},this.refreshInterval)))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(r(),this.refreshInterval>0&&o()):this.refreshInterval===0&&r()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._fetchingLoop(!0)},this.loopInterval)}startFetchingLoop(){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this._isSingleFrameModeEnabled())throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,this._recordedStates.fetchingLoopStart=!0,se._onLog&&se._onLog("DCE: start fetching loop: "+Date.now()),this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(se._onLog&&se._onLog("DCE: stop fetching loop: "+Date.now()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1,this._recordedStates.fetchingLoopStart=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.pop()):null}clearFrameBuffer(){this._frameQueue&&(this._frameQueue.length=0)}_createDrawingLayerBaseCvs(){let e;this._assertOpen();try{e=this._calculateCvsSize()}catch(p){throw p}let{width:r,height:o,objectFit:h}=e;(r<=0||o<=0)&&(r=2,o=2);const g=document.createElement("canvas");if(g.width==r&&g.height==o||(g.width=r,g.height=o),g.style.objectFit=h,this._cvsScanRegion)this._cvsScanRegion.after(g);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(g);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(g);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(g)}return g}_updateDrawingLayersSize(e){let r;try{r=e&&e.width&&e.height&&e.objectFit?{width:e.width,height:e.height,objectFit:e.objectFit}:this._calculateCvsSize()}catch(p){if((p.message||p)==="Invalid content dimensions.")return;throw p}const{width:o,height:h,objectFit:g}=r;this._drawingLayersManager.setDimensions({width:o,height:h},{backstoreOnly:!0}),this._drawingLayersManager.setObjectFit(g)}_createDrawingLayer(e){this._layerBaseCvs||(this._layerBaseCvs=this._createDrawingLayerBaseCvs());const r=this._layerBaseCvs;return this._drawingLayersManager.createDrawingLayer(r,e)}deleteDrawingLayer(e){this._drawingLayersManager.deleteDrawingLayer(e),this._drawingLayersManager.getDrawingLayers().length||this._layerBaseCvs&&(this._layerBaseCvs.remove(),this._layerBaseCvs=null)}createDrawingLayer(){return this._createDrawingLayer()}getDrawingLayer(e){return this._drawingLayersManager.getDrawingLayer(e)||([1,2,3].includes(e)?this._createDrawingLayer(e):null)}getDrawingLayers(){return this._drawingLayersManager.getDrawingLayers().filter(e=>e.getId()>=0)}getSelectedDrawingItems(){return this._drawingLayersManager.getSelectedDrawingItems()}createDrawingStyle(e){return this._drawingLayersManager.createDrawingStyle(e)}getDrawingStyle(e){return this._drawingLayersManager.getDrawingStyle(e)}getDrawingStyles(){return this._drawingLayersManager.getDrawingStyles()}updateDrawingStyle(e,r){return this._drawingLayersManager.updateDrawingStyle(e,r)}clearDrawingLayers(){const e=this.getDrawingLayers();for(let r of e)this.deleteDrawingLayer(r.getId())}showTip(e,r,o,h,g=3e3,p=!0){this._assertOpen(),this._tipArgs.x=e,this._tipArgs.y=r,this._tipArgs.width=o,this._tipArgs.autoShowSuggestedTip=!!p,this._drawingLayerOfTip||(this._drawingLayerOfTip=this._createDrawingLayer(-1)),this._tipStyleId||(this._tipStyleId=this.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip.clearDrawingItems();const v=new eo(h||"",e,r,o,this._tipStyleId);v._fabricObject.paddingTop=15,v._fabricObject.calcTextHeight=function(){for(var S=0,w=0,x=this._textLines.length;w<x;w++)S+=this.getHeightOfLine(w);return S+2*this.paddingTop},v._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},v.setAttribute("backgroundColor","rgba(50, 50, 52, .8)"),v.setAttribute("lineHeight",1.3),v.setAttribute("textAlign","center"),this._drawingLayerOfTip.addDrawingItem(v),this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._tipArgs.duration=g===void 0?3e3:g,this._tipArgs.duration>0&&(this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}_hideTip(){this._drawingLayerOfTip&&(this.deleteDrawingLayer(this._drawingLayerOfTip.getId()),this._drawingLayerOfTip=null,this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId))}hideTip(){this._hideTip(),this._tipArgs.x=null,this._tipArgs.y=null,this._tipArgs.width=null,this._tipArgs.autoShowSuggestedTip=null}updateTipMessage(e){if(!this._drawingLayerOfTip)throw new Error("The Tip is not showing.");this._drawingLayerOfTip.getDrawingItems()[0].setAttribute("text",e),this._drawingLayerOfTip.renderAll(),this._tipArgs.duration>0&&(this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}suggestTip(e,r){this._tipArgs.autoShowSuggestedTip&&(this._drawingLayerOfTip?this.updateTipMessage(r):this._tipArgs.x!==void 0&&this.showTip(this._tipArgs.x,this._tipArgs.y,this._tipArgs.width,r,this._tipArgs.duration)),this.onTipSuggested&&setTimeout(()=>{this.isDisposed&&this.disposed||this.onTipSuggested.apply(this,[e,r])},0)}_createControler(){if(this._controler||(this._controler=new Xl(this)),this._controler)return this._controler}_destroyControler(){this._controler=null}setOriginalImage(e,r,o){if(!e||!r||!o)throw new Error("Invalid arguments");this._originalImageData={imageData:e,width:r,height:o};let h=this._cvsOriginalImage;h||(h=document.createElement("canvas"),h.style.position="absolute",h.style.width="100%",h.style.height="100%",h.style.left="0",h.style.top="0",h.style.backgroundColor="white",h.style.objectFit="contain",this._cvsOriginalImage=h),h.width===r&&h.height===o||(h.width=r,h.height=o);const g=h.getContext("2d");g.clearRect(0,0,h.width,h.height),e instanceof Uint8Array||e instanceof Uint8ClampedArray?(e instanceof Uint8Array&&(e=new Uint8ClampedArray(e.buffer)),g.putImageData(new ImageData(e,r,o),0,0)):e instanceof HTMLCanvasElement&&g.drawImage(e,0,0),document.body.contains(h)&&h.style.display===""&&this._updateDrawingLayersSize({width:r,height:o,objectFit:"contain"})}getOriginalImage(){return this._originalImageData?Object.assign({},this._originalImageData):null}async deleteOriginalImage(){await this.hideOriginalImage(),this._cvsOriginalImage&&(this._cvsOriginalImage.remove(),this._cvsOriginalImage=null),this._originalImageData=null}_showOriginalImageCvs(){this._cvsOriginalImage&&this._cvsOriginalImage.style.display=="none"&&(this._cvsOriginalImage.style.display="")}_hideOriginalImageCvs(){this._cvsOriginalImage&&(this._cvsOriginalImage.style.display="none")}showOriginalImage(){if(!this._originalImageData)throw new Error("No original image is set.");const e=this._cvsOriginalImage;if(e.style.display===""&&document.body.contains(e))return;const{width:r,height:o}=this._originalImageData;if(this._updateDrawingLayersSize({width:r,height:o,objectFit:"contain"}),this._bOpen&&(this._video&&!this._video.paused&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._recordedStates.fetchingLoopStart=!0),this.ifShowScanRegionMask&&this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this.ifShowScanRegionLaser&&this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none"),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none"),this._selCam&&(this._selCam.parentElement.style.display="none")),!document.body.contains(e))if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(e)}this._showOriginalImageCvs()}async _hideOriginalImage(e){this._originalImageData&&this._cvsOriginalImage&&this._cvsOriginalImage.style.display!=="none"&&(this._updateDrawingLayersSize(),this._bOpen&&e&&(this._video&&this._recordedStates.videoPlaying&&await this.play(null,null,null,{notTriggerSingleFrameClick:!0}),this._recordedStates.fetchingLoopStart&&!this._isSingleFrameModeEnabled()&&this.startFetchingLoop(),this.ifShowScanRegionMask&&this._cvsScanRegion&&this._recordedStates.maskShow&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this._divScanLight&&this._recordedStates.laserShow&&this.showScanRegionLaser(),this._cvsViewDecorator&&this._recordedStates.decoratorShow&&this.showViewDecorator(),this._scanRegionOverlayContainer&&this._recordedStates.overlayShow&&this.showScanRegionOverlays()),this._selCam&&(this._selCam.parentElement.style.display=""),this._hideOriginalImageCvs())}async hideOriginalImage(){return this._hideOriginalImage(!0)}transformCoord(e){if(!this.isOpen())throw new Error("Unavailable when the camera is not open.");if(this._isSingleFrameModeEnabled()&&!this._cvsSingleFrameMode)throw new Error("No image is selected. ");const r=this._elContainer.getBoundingClientRect();let o,h,g,p,v,S=r.left,w=r.top,x=S+window.scrollX,E=w+window.scrollY;this._isSingleFrameModeEnabled()?(o=this._cvsSingleFrameMode.width,h=this._cvsSingleFrameMode.height,g=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).width),p=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).height),v="contain"):(o=this.video.videoWidth,h=this.video.videoHeight,g=parseFloat(window.getComputedStyle(this._elContainer).width),p=parseFloat(window.getComputedStyle(this._elContainer).height),v=this.videoFit);const A=g/p,W=o/h;let Y,z,q,te,J=1;if(v==="contain")A<W?(J=g/o,Y=S+e.x*J,z=w+e.y*J+(p-h*J)/2,q=x+e.x*J,te=E+e.y*J+(p-h*J)/2):(J=p/h,Y=S+e.x*J+(g-o*J)/2,z=w+e.y*J,q=x+e.x*J+(g-o*J)/2,te=E+e.y*J);else if(v==="cover")if(A<W){J=p/h;let Z=e.x*J-(o*J-g)/2;Z=Math.max(Z,0),Z=Math.min(Z,g),Y=S+Z,z=w+e.y*J,q=x+Z,te=E+e.y*J}else{J=g/o;let Z=e.y*J-(h*J-p)/2;Z=Math.max(Z,0),Z=Math.min(Z,p),Y=S+e.x*J,z=w+Z,q=x+e.x*J,te=E+Z}return{clientX:Y,clientY:z,pageX:q,pageY:te}}convertToPageCoordinates(e){const r=this.transformCoord(e);return{x:r.pageX,y:r.pageY}}convertToClientCoordinates(e){const r=this.transformCoord(e);return{x:r.clientX,y:r.clientY}}dispose(e){this.UIElement&&(this._uiOriginalState&&this._uiOriginalState.inDom?this.UIElement.style.display=this._uiOriginalState.display:this.UIElement.style.display="none"),this.clearDrawingLayers(),this.close(),this.forceLoseContext(),this.setViewDecorator(null,null),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.remove(),this._arrScanRegionOverlays.length=0,e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null;for(let r in this)delete this[r];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"isDisposed",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}se._jsVersion="3.3.9",se._jsEditVersion="20231205",se._version="JS "+se._jsVersion+"."+se._jsEditVersion,se.browserInfo=Ae,se._hasEngineResourceLoaded=!1,se._engineResourcePath=Gl,se._defaultUIElementURL="@engineResourcePath/dce.ui.html";const zl={DT_Arc:class extends Xe{constructor(t,e,r,o,h,g){super(new ye.Circle({left:t,top:e,radius:r,startAngle:o,endAngle:h}),g),this._mediaType="arc"}},DT_Polygon:Mn,DT_Rect:class extends Xe{constructor(t,e,r,o,h){super(new ye.Rect({left:t,top:e,width:r,height:o}),h)}},DT_Image:class extends Xe{constructor(t,e,r,o){super(new ye.Image(t,{left:e,top:r}),o),this.image=t}_extendSet(t,e){if(t==="image"){if(e instanceof HTMLImageElement)return this._fabricObject.setElement(e),this.image=e,!0;if(e instanceof HTMLCanvasElement){const r=new Image;return r.src=e.toDataURL(),this._fabricObject.setElement(r),this.image=e,!0}throw new Error("Unsupported value.")}}_extendGet(t){if(t==="image")return this.image}},DT_Text:eo,DT_Line:class extends Mn{constructor(t,e,r){super([t,e],r),this._mediaType="line"}_extendSet(t,e){if(t==="startPoint"||t==="endPoint"){e=t==="startPoint"?[e,this.get("endPoint")]:[this.get("startPoint"),e];const r=this._fabricObject;if(r.group){const h=r.group;r.points=e.map(g=>({x:g.x-h.left-h.width/2,y:g.y-h.top-h.height/2})),h.addWithUpdate()}else r.points=e;const o=r.points.length-1;return r.controls=r.points.reduce(function(h,g,p){return h["p"+p]=new ye.Control({positionHandler:yr,actionHandler:Sr(p>0?p-1:o,br),actionName:"modifyPolygon",pointIndex:p}),h},{}),r._setPositionDimensions({}),!0}}_extendGet(t){if(t==="startPoint"||t==="endPoint"){const e=[],r=this._fabricObject;if(r.selectable&&!r.group)for(let o in r.oCoords)e.push({x:r.oCoords[o].x,y:r.oCoords[o].y});else for(let o of r.points){let h=o.x-r.pathOffset.x,g=o.y-r.pathOffset.y;const p=ye.util.transformPoint({x:h,y:g},r.calcTransformMatrix());e.push({x:p.x,y:p.y})}return t==="startPoint"?e[0]:e[1]}}},DT_Group:class extends Xe{constructor(t){super(new ye.Group(t.map(e=>e._getFabricObject()))),this._fabricObject.on("selected",()=>{this.styleSelector="selected";const e=this._fabricObject._objects;for(let r of e)setTimeout(()=>{r&&r.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.styleSelector="default";const e=this._fabricObject._objects;for(let r of e)setTimeout(()=>{r&&r.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)})}getChildItems(){return this._fabricObject._objects.map(t=>t.getDrawingItem())}addChildItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"add"):this._fabricObject.addWithUpdate(t._getFabricObject())}removeChildItem(t){t&&t.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"remove"):this._fabricObject.removeWithUpdate(t._getFabricObject()))}}};function Kl(t,e,r){return(r.x-t.x)*(e.y-t.y)==(e.x-t.x)*(r.y-t.y)&&Math.min(t.x,e.x)<=r.x&&r.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=r.y&&r.y<=Math.max(t.y,e.y)}function sr(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function yi(t,e,r,o){let h=t[0]*(r[1]-e[1])+e[0]*(t[1]-r[1])+r[0]*(e[1]-t[1]),g=t[0]*(o[1]-e[1])+e[0]*(t[1]-o[1])+o[0]*(e[1]-t[1]);return!((h^g)>=0&&h!==0&&g!==0)&&(h=r[0]*(t[1]-o[1])+o[0]*(r[1]-t[1])+t[0]*(o[1]-r[1]),g=r[0]*(e[1]-o[1])+o[0]*(r[1]-e[1])+e[0]*(o[1]-r[1]),!((h^g)>=0&&h!==0&&g!==0))}var wr,Cr,Fn,Pn,kn,Bn,Nn,jn,Vn,Un,Wn,Gn,Hn,Yn,Xn,zn,Kn,qn,Zn,Jn,$n,Qn,es,ts,is,rs,ns,ss;class He extends j{constructor(){super(),this._barcodeFillStyle="rgba(254,180,32,0.3)",this._barcodeStrokeStyle="rgba(254,180,32,0.9)",this._barcodeLineWidth=1,this._barcodeFillStyleBeforeVerification="rgba(248,252,0,0.2)",this._barcodeStrokeStyleBeforeVerification="transparent",this._barcodeLineWidthBeforeVerification=2,this.bFilterRegionInJs=!0,this._onPlayed=null}static set _onLog(e){(function(r,o,h,g,p){if(g==="m")throw new TypeError("Private method is not writable");if(g==="a"&&!p)throw new TypeError("Private accessor was defined without a setter");if(typeof o=="function"?r!==o||!p:!o.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");g==="a"?p.call(r,h):p?p.value=h:o.set(r,h)})(He,wr,e,"f",Cr),se._onLog=e}static get _onLog(){return function(e,r,o,h){if(o==="a"&&!h)throw new TypeError("Private accessor was defined without a getter");if(typeof r=="function"?e!==r||!h:!r.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return o==="m"?h:o==="a"?h.call(e):h?h.value:r.get(e)}(He,wr,"f",Cr)}static get version(){return this._version+`(DCE ${se.getVersion()})`}static _fireHTTPSWarnning(){He.onWarning&&location&&location.protocol!=="https:"&&setTimeout(()=>{He.onWarning&&He.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}static async testCameraAccess(){return se.testCameraAccess()}_fireResolutionWarning(){if(!this.singleFrameMode&&this.onWarning&&this.dce.isOpen()){const e=this.dce.getConstraints();e&&e.width<1280&&e.height<720&&setTimeout(()=>{this.onWarning&&this.onWarning({id:3,message:"Camera resolution too low, please use a higher resolution (720P or better)."})},0)}}getUIElement(){return this.dce.getUIElement()}async setUIElement(e){await this.dce.setUIElement(e)}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){if(typeof e!="boolean"&&!["image","camera"].includes(e))throw new Error("Invalid value.");this.dce.singleFrameMode=e,e&&(this.dce.ifShowScanRegionLaser=!1,(async()=>{let r=await this.getScanSettings();r.oneDTrustFrameCount=1,await this.updateScanSettings(r)})())}get onUnduplicatedRead(){return this.onUniqueRead}set onUnduplicatedRead(e){this.onUniqueRead=e}get video(){return this.dce&&this.dce.video}set videoSrc(e){this.dce&&(this.dce.videoSrc=e)}get videoSrc(){return this.dce&&this.dce.videoSrc}set onTipSuggested(e){this.dce&&(this.dce.onTipSuggested=e)}get onTipSuggested(){return this.dce&&this.dce.onTipSuggested}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}set barcodeFillStyle(e){this._barcodeFillStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{fillStyle:e})}get barcodeFillStyle(){return this._barcodeFillStyle}set barcodeStrokeStyle(e){this._barcodeStrokeStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{strokeStyle:e})}get barcodeStrokeStyle(){return this._barcodeStrokeStyle}set barcodeLineWidth(e){this._barcodeLineWidth=e,this.dce&&this.dce.updateDrawingStyle(3,{lineWidth:e})}get barcodeLineWidth(){return this._barcodeLineWidth}set barcodeFillStyleBeforeVerification(e){this._barcodeFillStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{fillStyle:e})}get barcodeFillStyleBeforeVerification(){return this._barcodeFillStyleBeforeVerification}set barcodeStrokeStyleBeforeVerification(e){this._barcodeStrokeStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{strokeStyle:e})}get barcodeStrokeStyleBeforeVerification(){return this._barcodeStrokeStyleBeforeVerification}set barcodeLineWidthBeforeVerification(e){this._barcodeLineWidthBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{lineWidth:e})}get barcodeLineWidthBeforeVerification(){return this._barcodeLineWidthBeforeVerification}set regionMaskFillStyle(e){this.dce.setScanRegionMaskStyle({fillStyle:e})}get regionMaskFillStyle(){return this.dce.regionMaskFillStyle}set regionMaskStrokeStyle(e){this.dce.setScanRegionMaskStyle({strokeStyle:e})}get regionMaskStrokeStyle(){return this.dce.regionMaskStrokeStyle}set regionMaskLineWidth(e){this.dce.setScanRegionMaskStyle({lineWidth:e})}get regionMaskLineWidth(){return this.dce.regionMaskLineWidth}set region(e){this._region=e,this.dce&&(e?e instanceof Array||this.dce.setScanRegion(e):this.dce.setScanRegion(null)),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e,this.dce.framePixelFormat=e?"rgba":"grey"}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}async createDCEInstance(){this.dce||(j._onLog&&j._onLog("createDCEInstance()"),se.defaultUIElementURL=null,this.dce=await se.createInstance(),this.dce.refreshInterval=200,this.dce.framePixelFormat="grey",this.dce.maxCvsSideLength=this.maxCvsSideLength,this._drawingItemNamespace=zl,["iPhone","iPad","Android","HarmonyOS"].includes(j.browserInfo.OS)||this.dce.setResolution(1920,1080),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"}),this.barcodeLineWidth=this._barcodeLineWidth,this.dce.on("cameraChange",()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}),this.dce.on("resolutionChange",()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}),this.dce.on("cameraClose",()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1}),this.dce.on("singleFrameAcquired",async e=>{if(!e||!e.data)return;let r;this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:o,sx:h,sy:g,width:p,height:v,stride:S,pixelFormat:w,timeStamp:x,_sWidth:E,_sHeight:A}=e,W={timeStamp:x};if(w==="grey")r=await this._decodeBuffer_Uint8Array(o,p,v,S,Ee.IPF_GrayScaled,0,W);else if(w==="rgba")r=await this._decodeBuffer_Uint8Array(o,p,v,S,Ee.IPF_ABGR_8888,0,W);else{if(w!=="bgra")throw new Error(`Pixel format '${w}' is not supported.`);r=await this._decodeBuffer_Uint8Array(o,p,v,S,Ee.IPF_ARGB_8888,0,W)}if(await this.clearMapDecodeRecord(),j.recalculateResultLocation(r,h,g,E,A,p,v),this._drawResults(r),this.onFrameRead&&this.isOpen()&&!this._bPauseScan){let Y=this._cloneDecodeResults(r);this.onFrameRead(Y)}if(this.onUniqueRead&&this.isOpen()&&!this._bPauseScan)for(let Y of r)this.onUniqueRead(Y.barcodeText,this._cloneDecodeResults(Y))}))}set maxCvsSideLength(e){this._maxCvsSideLength=e,this.dce.maxCvsSideLength=e}get maxCvsSideLength(){return this._maxCvsSideLength}static async createInstance(e){const r=new He;r._instanceID=await He.createInstanceInWorker(!0),await r.createDCEInstance(),typeof e=="string"&&(e=JSON.parse(e));for(let o in e)r[o]=e[o];return await r.dce.setUIElement(He.defaultUIElementURL),r.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),He._fireHTTPSWarnning(),r.singleFrameMode||await r.updateRuntimeSettings("single"),r}async decodeCurrentFrame(e){this._assertOpen();let r=null;e&&e.region&&(r=e.region);const o=this.dce._getVideoData(null,{region:r});return this._decode_DCEFrame(o)}async updateRuntimeSettings(e){let r;if(typeof e=="string")if(e=="speed"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,o.region&&(r.region=o.region),r.expectedBarcodesCount=0,r.localizationModes=[2,0,0,0,0,0,0,0],r.barcodeZoneMinDistanceToImageBorders=9}else if(e=="balance"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,o.region&&(r.region=o.region),r.expectedBarcodesCount=512,r.deblurLevel=3,r.localizationModes=[2,16,0,0,0,0,0,0],r.barcodeZoneMinDistanceToImageBorders=9,r.timeout=1e5}else if(e=="coverage"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,o.region&&(r.region=o.region),r.expectedBarcodesCount=512,r.deblurLevel=5,r.scaleDownThreshold=1e5,r.localizationModes=[2,16,4,8,0,0,0,0],r.barcodeZoneMinDistanceToImageBorders=9,r.timeout=1e5}else if(e=="single"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,o.region&&(r.region=o.region)}else if(e=="dense"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,o.region&&(r.region=o.region),r.expectedBarcodesCount=0,r.deblurLevel=7,r.scaleDownThreshold=1e5,r.localizationModes=[2,8,0,0,0,0,0,0],r.minResultConfidence=0,r.barcodeZoneMinDistanceToImageBorders=9,r.timeout=1e5}else if(e=="distance"){let o=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,r=await this.getRuntimeSettings(),r.barcodeFormatIds=o.barcodeFormatIds,r.barcodeFormatIds_2=o.barcodeFormatIds_2,o.region&&(r.region=o.region),r.expectedBarcodesCount=0,r.scaleDownThreshold=1e5,r.localizationModes=[2,8,0,0,0,0,0,0],r.barcodeZoneMinDistanceToImageBorders=9,r.timeout=1e5}else r=JSON.parse(e);else{if(typeof e!="object")throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(r=JSON.parse(JSON.stringify(e)),r.region instanceof Array){let o=e.region;[o.regionLeft,o.regionTop,o.regionLeft,o.regionBottom,o.regionMeasuredByPercentage].some(h=>h!==void 0)&&(r.region={regionLeft:o.regionLeft||0,regionTop:o.regionTop||0,regionRight:o.regionRight||0,regionBottom:o.regionBottom||0,regionMeasuredByPercentage:o.regionMeasuredByPercentage||0})}}if(!j._bUseFullFeature){if(r.barcodeFormatIds&~(Ye.BF_ONED|Ye.BF_QR_CODE|Ye.BF_PDF417|Ye.BF_DATAMATRIX)||r.barcodeFormatIds_2!=0)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(r.intermediateResultTypes!=0)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let o=r.region;if(this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(o)):this.userDefinedRegion=null,o instanceof Array)if(o.length){for(let h=0;h<o.length;++h){let g=o[h];g&&((g.regionLeft||g.regionTop||g.regionRight||g.regionBottom||g.regionMeasuredByPercentage)&&(g.regionLeft||g.regionTop||g.regionRight!=100||g.regionBottom!=100||!g.regionMeasuredByPercentage)||(o[h]=null))}this.region=o}else this.region=null;else o&&(o.regionLeft||o.regionTop||o.regionRight||o.regionBottom||o.regionMeasuredByPercentage)&&(o.regionLeft||o.regionTop||o.regionRight!=100||o.regionBottom!=100||!o.regionMeasuredByPercentage)?this.region=o:this.region=null;this.bFilterRegionInJs&&(r.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}(this.autoZoom||this.autoFocus)&&(r.intermediateResultTypes|=Ut.IRT_TYPED_BARCODE_ZONE),await new Promise((o,h)=>{let g=j._nextTaskID++;j._taskCallbackMap.set(g,p=>{if(p.success){try{this._handleRetJsonString(p.updateReturn)}catch(v){h(v)}return o()}{let v=new Error(p.message);return v.stack=p.stack+`
`+v.stack,h(v)}}),j._dbrWorker.postMessage({type:"updateRuntimeSettings",id:g,instanceID:this._instanceID,body:{settings:JSON.stringify(r)}})}),typeof e=="string"&&["speed","balance","coverage","dense","distance"].includes(e)&&(await this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","1"),await this.setModeArgument("BinarizationModes",0,"BlockSizeX","0"),await this.setModeArgument("BinarizationModes",0,"BlockSizeY","0"))}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}set onPlayed(e){this.dce.off("played",this._onPlayed),this._onPlayed=e,this.dce.on("played",this._onPlayed)}get onPlayed(){return this._onPlayed}async getAllCameras(){return this.dce.getAllCameras()}async getCurrentCamera(){return this.dce.getSelectedCamera()}async setCurrentCamera(e){const r=await this.dce.selectCamera(e);return this._fireResolutionWarning(),r}getResolution(){return this.dce.getResolution()}async setResolution(e,r){const o=await this.dce.setResolution(e,r);return this._fireResolutionWarning(),o}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}setVideoFit(e){return this.dce&&this.dce.setVideoFit(e)}getVideoFit(){return this.dce&&this.dce.getVideoFit()}set ifShowScanRegionMask(e){this.dce&&(this.dce.ifShowScanRegionMask=e)}get ifShowScanRegionMask(){return this.dce&&this.dce.ifShowScanRegionMask}set ifSaveLastUsedCamera(e){this.dce&&(this.dce.ifSaveLastUsedCamera=e)}get ifSaveLastUsedCamera(){return this.dce&&this.dce.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){this.dce&&(this.dce.ifSkipCameraInspection=e)}get ifSkipCameraInspection(){return this.dce&&this.dce.ifSkipCameraInspection}stop(){this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.dce.stop(),this.dce.ifShowScanRegionLaser=!1,this.dce.hideViewDecorator(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this.dce.pause()}async play(e,r,o){this.dce.ifShowScanRegionLaser=!0;const h=await this.dce.play(e,r,o);return this._fireResolutionWarning(),h}pauseScan(e){this._assertOpen(),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce.ifShowScanRegionLaser=!1,this.dce.stopFetchingLoop()}resumeScan(){this._assertOpen(),this._bPauseScan=!1,this.dce.ifShowScanRegionLaser=!0}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}async applyConstraints(e){return this.dce.applyConstraints(e)}async turnOnTorch(){return this.dce.turnOnTorch()}async turnOffTorch(){return this.dce.turnOffTorch()}async setColorTemperature(e){return this.dce.setColorTemperature(e)}getColorTemperature(){return this.dce.getColorTemperature()}async setExposureCompensation(e){return this.dce.setExposureCompensation(e)}getExposureCompensation(){return this.dce.getExposureCompensation()}async setZoom(e){return this.dce.setZoom(e)}getZoomSettings(){return this.dce.getZoomSettings()}resetZoom(){return this.dce.resetZoom()}async setFrameRate(e){return this.dce.setFrameRate(e)}getFrameRate(){return this.dce.getFrameRate()}async setFocus(e,r){return this.dce.setFocus(e,r)}getFocus(){return this.dce.getFocus()}getFocusSettings(){return this.dce.getFocusSettings()}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this.dce.stopFetchingLoop(),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),void this._drawResults(null);if(!this.isOpen())return this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce.video||this.dce.video.paused||this._bPauseScan)return j._onLog&&j._onLog("Video or scan is paused. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause));j._onLog&&j._onLog("======= once read ======="),j._onLog&&(this._timeStartDecode=Date.now());const e=this._getVideoFrame();if(!e)return j._onLog&&j._onLog("Get invalid frame."),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0));(async()=>{e._bUseWebGL||e.pixelFormat!=="grey"||(this.dce.framePixelFormat="rgba");let r=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:o,sx:h,sy:g,width:p,height:v,stride:S,pixelFormat:w,timeStamp:x,_sWidth:E,_sHeight:A}=e,W={timeStamp:x};if(w==="grey")r=await this._decodeBuffer_Uint8Array(o,p,v,S,Ee.IPF_GrayScaled,0,W);else if(w==="rgba")r=await this._decodeBuffer_Uint8Array(o,p,v,S,Ee.IPF_ABGR_8888,0,W);else{if(w!=="bgra")throw new Error(`Pixel format '${w}' is not supported.`);r=await this._decodeBuffer_Uint8Array(o,p,v,S,Ee.IPF_ARGB_8888,0,W)}if(j.recalculateResultLocation(r,h,g,E,A,p,v),this._resultHighlightingDuration==0?this._drawResults(null):this._drawResults(r),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._resultHighlightingDuration>0&&(this._clearResultsCanvasTimeoutId=setTimeout(()=>{this.bDestroyed||this._drawResults(null)},this._resultHighlightingDuration)),this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan&&(this.autoZoom||this.autoFocus||this.autoSuggestTip))if(r.length)this.autoZoomInFrameArray.length=0,this.autoZoomOutFrameCount=0,this.frameArrayInIdealZoom.length=0,this.suggestTipFrameArray.length=0,this.autoZoom&&this.autoFocus&&(this.nextActionInIdealZoom="focus"),this.autoFocusFrameArray.length=0,this.noIntermediateResultsCount=0;else{const Y=async()=>new Promise((Z,ee)=>{let he=j._nextTaskID++;j._taskCallbackMap.set(he,fe=>{if(fe.success)return Z(fe.results);{let _e=new Error(fe.message);return _e.stack=fe.stack+`
`+_e.stack,ee(_e)}}),j._dbrWorker.postMessage({type:"getIntermediateResults",id:he,instanceID:this._instanceID,body:{isCharge:!1}})}),z=await Y(),q=(Z,ee,he,fe,_e,y,ge)=>{let pe=y/fe,Te=ge/_e;Z.x1=Z.x1/pe+ee,Z.x2=Z.x2/pe+ee,Z.x3=Z.x3/pe+ee,Z.x4=Z.x4/pe+ee,Z.y1=Z.y1/Te+he,Z.y2=Z.y2/Te+he,Z.y3=Z.y3/Te+he,Z.y4=Z.y4/Te+he},te=Z=>{if(!Z)return null;const ee={};let he,fe,_e,y,ge;{const f=this.video.videoWidth*(1-this.autoZoomDetectionArea)/2,m=this.video.videoWidth*(1+this.autoZoomDetectionArea)/2,b=m,C=f,I=this.video.videoHeight*(1-this.autoZoomDetectionArea)/2,T=I,R=this.video.videoHeight*(1+this.autoZoomDetectionArea)/2;ge={x1:f,x2:m,x3:b,x4:C,y1:I,y2:T,y3:R,y4:R}}const pe=(f,m)=>{const b=(I,T)=>{if(!I&&!T)throw new Error("Invalid arguments.");return function(R,B,U){let X=!1;const Q=R.length;if(Q<=2)return!1;for(let O=0;O<Q;O++){const M=R[O],D=R[(O+1)%Q];if(Kl(M,D,{x:B,y:U}))return!0;sr(M.y-U)>0!=sr(D.y-U)>0&&sr(B-(U-M.y)*(M.x-D.x)/(M.y-D.y)-M.x)<0&&(X=!X)}return X}([{x:T.x1,y:T.y1},{x:T.x2,y:T.y2},{x:T.x3,y:T.y3},{x:T.x4,y:T.y4}],I.x,I.y)},C=(I,T)=>!!(yi([I[0],I[1]],[I[2],I[3]],[T.x1,T.y1],[T.x2,T.y2])||yi([I[0],I[1]],[I[2],I[3]],[T.x2,T.y2],[T.x3,T.y3])||yi([I[0],I[1]],[I[2],I[3]],[T.x3,T.y3],[T.x4,T.y4])||yi([I[0],I[1]],[I[2],I[3]],[T.x4,T.y4],[T.x1,T.y1]));return!!(b({x:f.x1,y:f.y1},m)||b({x:f.x2,y:f.y2},m)||b({x:f.x3,y:f.y3},m)||b({x:f.x4,y:f.y4},m))||!!(b({x:m.x1,y:m.y1},f)||b({x:m.x2,y:m.y2},f)||b({x:m.x3,y:m.y3},f)||b({x:m.x4,y:m.y4},f))||!!(C([m.x1,m.y1,m.x2,m.y2],f)||C([m.x2,m.y2,m.x3,m.y3],f)||C([m.x3,m.y3,m.x4,m.y4],f)||C([m.x4,m.y4,m.x1,m.y1],f))},Te=[];for(let f of Z){if(f.resultType!==Ut.IRT_TYPED_BARCODE_ZONE)continue;const m=f.scaleDownRatio;for(let b of f.results){if(!b)continue;const C={x1:b.x1=b.x1*m,x2:b.x2=b.x2*m,x3:b.x3=b.x3*m,x4:b.x4=b.x4*m,y1:b.y1=b.y1*m,y2:b.y2=b.y2*m,y3:b.y4=b.y3*m,y4:b.y4=b.y4*m};q(C,h,g,E,A,p,v),pe(ge,C)&&Te.push(b)}}const l=(f=>{if(!f||!f.length)return null;const m=T=>{const R=(T.x1+T.x2+T.x3+T.x4)/4,B=(T.y1+T.y2+T.y3+T.y4)/4;return(R-p/2)*(R-p/2)+(B-v/2)*(B-v/2)};let b,C=f.filter(T=>T.barcodeFormat==Ye.BF_QR_CODE||T.barcodeFormat==Ye.BF_DATAMATRIX);if(C.length||(C=f.filter(T=>T.barcodeFormat==Ye.BF_ONED),C.length||(C=f)),!C.length)return null;b=C[0];let I=m(b);if(C.length!=1)for(let T=1;T<C.length;T++){const R=m(C[T]);(C[T].confidence>1.1*b.confidence||C[T].confidence>.9*b.confidence&&R<I)&&(b=C[T],I=R)}return b})(Te);if(!l)return null;const s=l.x1,a=l.x2,u=l.x3,i=l.x4,n=l.y1,c=l.y2,_=l.y3,d=l.y4;return he=Math.min(s,a,u,i),fe=Math.max(s,a,u,i),_e=Math.min(n,c,_,d),y=Math.max(n,c,_,d),ee.x1=ee.x4=he,ee.x2=ee.x3=fe,ee.y1=ee.y2=_e,ee.y3=ee.y4=y,ee.result=l,ee},J=te(z);if(J&&J.x1){if(this.autoZoomOutFrameCount=0,this.noIntermediateResultsCount=0,this.suggestTipFrameArray.push(!0),this.suggestTipFrameArray.splice(0,this.suggestTipFrameArray.length-this.suggestTipFrameLimit[0]),this.autoSuggestTip&&this.suggestTipFrameArray.filter(Z=>Z===!0).length>=this.suggestTipFrameLimit[1]){this.suggestTipFrameArray.length=0;const Z=J.x3-J.x1,ee=J.y3-J.y1;J.result.moduleSize<this.tinyBarcodeTipModuleSizeLimit?this.dce&&this.dce.suggestTip("tiny-barcode","Please zoom in or move closer."):Z>ee?Z>p*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):Z>.6*p&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."):Z<=ee&&(ee>v*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):ee>.6*v&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."))}if(this.autoZoom){const Z=this.autoZoomIdealArea[1];let ee=(1-this.autoZoomTargetBorder)/2;const he=J.x1/E,fe=(E-J.x3)/E,_e=J.y1/A,y=(A-J.y3)/A;if(he>Z&&fe>Z&&_e>Z&&y>Z&&J.result.moduleSize<this.autoZoomInIdealModuleSize){if(this.autoZoomInFrameArray.push(!0),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.frameArrayInIdealZoom.length=0,this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(()=>{})),this.autoZoomInFrameArray.filter(ge=>ge===!0).length>=this.autoZoomInFrameLimit[1]){this.autoZoomInFrameArray.length=0;const ge=[(.5-ee)/(.5-he),(.5-ee)/(.5-fe),(.5-ee)/(.5-_e),(.5-ee)/(.5-y)].filter(a=>a>0),pe=Math.min(...ge,this.autoZoomInIdealModuleSize/J.result.moduleSize),Te=this.dce.getZoomSettings().factor;let l=Math.max(Math.pow(Te*pe,1/this.autoZoomInMaxTimes),this.autoZoomInMinStep);l=Math.min(l,pe);const s=Te*l;await this.setZoom({factor:s}),this.dce.clearFrameBuffer()}}else if(this.autoZoomInFrameArray.length=0,this.frameArrayInIdealZoom.push(!0),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.frameArrayInIdealZoom.filter(ge=>ge===!0).length>=this.frameLimitInIdealZoom[1])if(this.frameArrayInIdealZoom.length=0,this.nextActionInIdealZoom==="focus"&&this.autoFocus){q(J,h,g,E,A,p,v);try{await this.setFocus({mode:"manual",area:{centerPoint:{x:(J.x1+J.x3)/2+"px",y:(J.y1+J.y3)/2+"px"},width:J.x3-J.x1+"px",height:J.y3-J.y1+"px"}})}catch{}this.dce.clearFrameBuffer(),this.nextActionInIdealZoom="zoomOut"}else{if(this.nextActionInIdealZoom!=="zoomOut"&&this.autoFocus)throw new Error("Invalid action.");if(this.enableZoomOutInIdealZoom){ee=this.autoZoomIdealArea[1]+this.autoZoomOutStepRate_2;const ge=[(.5-ee)/(.5-he),(.5-ee)/(.5-fe),(.5-ee)/(.5-_e),(.5-ee)/(.5-y)].filter(Te=>Te>0);let pe=Math.min(...ge)*this.dce.getZoomSettings().factor;await this.setZoom({factor:pe}),this.dce.clearFrameBuffer(),this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(Te=>{}))}}}else if(this.autoFocus&&(this.autoFocusFrameArray.push(!0),this.autoFocusFrameArray.splice(0,this.autoFocusFrameArray.length-this.autoFocusFrameLimit[0]),this.autoFocusFrameArray.filter(Z=>Z===!0).length>=this.autoFocusFrameLimit[1])){this.autoFocusFrameArray.length=0;try{q(J,h,g,E,A,p,v),await this.setFocus({mode:"manual",area:{centerPoint:{x:(J.x1+J.x3)/2+"px",y:(J.y1+J.y3)/2+"px"},width:J.x3-J.x1+"px",height:J.y3-J.y1+"px"}})}catch{}this.dce.clearFrameBuffer()}}else if(this.noIntermediateResultsCount++,this.suggestTipFrameArray.push(!1),this.autoZoom){if(this.autoZoomInFrameArray.push(!1),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.autoZoomOutFrameCount++,this.frameArrayInIdealZoom.push(!1),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.autoZoomOutFrameCount>=this.autoZoomOutFrameLimit){this.autoZoomOutFrameCount=0;const Z=this.getZoomSettings().factor;if(Z>this.autoZoomOutMinValue){const ee=Math.max((Z-1)*this.autoZoomOutStepRate,this.autoZoomOutMinStep),he=Math.max(Z-ee,this.autoZoomOutMinValue);await this.setZoom({factor:he}),this.dce.clearFrameBuffer()}}this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(Z=>{}))}else this.autoFocus&&(this.autoFocusFrameArray.length=0,this.setFocus({mode:"continuous"}).catch(Z=>{}))}return r})().then(r=>{if(j._onLog&&j._onLog(r),this.captureAndDecodeInParallel){let o=this.array_decodeFrameTimeCost,h=this.array_getFrameTimeCost,g=this._indexCurrentDecodingFrame;const p=()=>{let v=0;if(this.region instanceof Array){let S=0,w=0;S=g+1>=this.region.length?0:g+1,w=S+1>=this.region.length?0:S+1,v=o[S]&&o[S].length&&h[w]&&h[w].length?Math.min(...o[S])-Math.max(...h[w]):0}else if(h&&h.length){let S=Math.min(...o),w=Math.max(...h);S&&w&&(v=S-w)}else v=0;return v>0?v:0};(()=>{if(this.region instanceof Array){for(o[g]&&o[g]instanceof Array||(o[g]=[]);o[g].length>=5;)o[g].shift();o[g].push(this._lastInnerDecodeDuration)}else{for(;o.length>=5;)o.shift();o.push(this._lastInnerDecodeDuration)}})(),this._intervalGetVideoFrame=p()+this.intervalTime,j._onLog&&j._onLog("Next fetching frame loop interval: "+this._intervalGetVideoFrame)}if(this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&r.length){let o=!1;this.bPlaySoundOnSuccessfulRead===!0||this.bPlaySoundOnSuccessfulRead==="frame"?o=r.some(h=>h.resultState>=0):this.bPlaySoundOnSuccessfulRead==="unique"&&(o=r.some(h=>h.resultState==0)),o&&this.beepSound&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&r.length){let o=!1;if(this.bVibrateOnSuccessfulRead===!0||this.bVibrateOnSuccessfulRead==="frame"?o=r.some(h=>h.resultState>=0):this.bVibrateOnSuccessfulRead==="unique"&&(o=r.some(h=>h.resultState==0)),o)try{navigator.vibrate(this.vibrateDuration)}catch(h){console.warn("Vibration not allowed. User interaction required: "+(h.message||h))}}if(this.onFrameRead){r=r.filter(h=>h.resultState>=0);const o=this._cloneDecodeResults(r);this.onFrameRead(o)}if(this.onUniqueRead){r=r.filter(h=>h.resultState==0);const o=this._cloneDecodeResults(r);for(let h of o)this.onUniqueRead(h.barcodeText,h)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this.intervalTime):this._loopReadVideo()})}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){j._onLog&&j._onLog("Get frame in parallel.");let r=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,r||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dce.loopInterval=0,null;e=this.dce.getFrameFromBuffer(),(h=>{if(!h)return;let g=h.timeSpent,p=this.array_getFrameTimeCost;for(;p.length>=5;)p.shift();p.push(g)})(e)}else j._onLog&&j._onLog("Get frame in serial."),this.dce.stopFetchingLoop(),e=this.dce.getFrame();return e}async open(){this._bindUI();const e=await this.dce.open();return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}async openVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}close(){this._drawResults(null),this.dce.close(),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}async show(){this._bindUI();const e=await this.dce.open(!0);return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}async showVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open(!0);return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}hide(){this.dce.close(!0),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}showTip(e,r,o,h,g=3e3,p=!0){this.dce&&this.dce.showTip(e,r,o,h,g,p)}hideTip(){this.dce&&this.dce.hideTip()}updateTipMessage(e){this.dce&&this.dce.updateTipMessage(e)}async enableTapToFocus(){this.dce&&this.dce.enableTapToFocus()}disableTapToFocus(){this.dce&&this.dce.disableTapToFocus()}isTapToFocusEnabled(){return this.dce.isTapToFocusEnabled()}convertToPageCoordinates(e){return this.dce.convertToPageCoordinates(e)}convertToClientCoordinates(e){return this.dce.convertToClientCoordinates(e)}destroyContext(){this.close(),this.dce&&this.dce.dispose(!1),this.bDestroyed||super.destroyContext()}}wr=He,Cr={value:void 0},function(t){t[t.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",t[t.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",t[t.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",t[t.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",t[t.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",t[t.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",t[t.BICM_SKIP=0]="BICM_SKIP",t[t.BICM_REV=2147483648]="BICM_REV"}(Fn||(Fn={})),function(t){t[t.BCM_AUTO=1]="BCM_AUTO",t[t.BCM_GENERAL=2]="BCM_GENERAL",t[t.BCM_SKIP=0]="BCM_SKIP",t[t.BCM_REV=2147483648]="BCM_REV"}(Pn||(Pn={})),function(t){t[t.BF2_NULL=0]="BF2_NULL",t[t.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",t[t.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",t[t.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",t[t.BF2_POSTNET=2097152]="BF2_POSTNET",t[t.BF2_PLANET=4194304]="BF2_PLANET",t[t.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",t[t.BF2_RM4SCC=16777216]="BF2_RM4SCC",t[t.BF2_DOTCODE=2]="BF2_DOTCODE",t[t.BF2_PHARMACODE_ONE_TRACK=4]="BF2_PHARMACODE_ONE_TRACK",t[t.BF2_PHARMACODE_TWO_TRACK=8]="BF2_PHARMACODE_TWO_TRACK",t[t.BF2_PHARMACODE=12]="BF2_PHARMACODE",t[t.BF2_ALL=-1]="BF2_ALL"}(kn||(kn={})),function(t){t[t.BM_AUTO=1]="BM_AUTO",t[t.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",t[t.BM_SKIP=0]="BM_SKIP",t[t.BM_THRESHOLD=4]="BM_THRESHOLD",t[t.BM_REV=2147483648]="BM_REV"}(Bn||(Bn={})),function(t){t[t.ECCM_CONTRAST=1]="ECCM_CONTRAST"}(Nn||(Nn={})),function(t){t[t.CFM_GENERAL=1]="CFM_GENERAL"}(jn||(jn={})),function(t){t[t.CCM_AUTO=1]="CCM_AUTO",t[t.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",t[t.CCM_SKIP=0]="CCM_SKIP",t[t.CCM_REV=2147483648]="CCM_REV"}(Vn||(Vn={})),function(t){t[t.CICM_GENERAL=1]="CICM_GENERAL",t[t.CICM_SKIP=0]="CICM_SKIP",t[t.CICM_REV=2147483648]="CICM_REV"}(Un||(Un={})),function(t){t[t.CM_IGNORE=1]="CM_IGNORE",t[t.CM_OVERWRITE=2]="CM_OVERWRITE"}(Wn||(Wn={})),function(t){t[t.DM_SKIP=0]="DM_SKIP",t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING"}(Gn||(Gn={})),function(t){t[t.DRM_AUTO=1]="DRM_AUTO",t[t.DRM_GENERAL=2]="DRM_GENERAL",t[t.DRM_BROAD_WARP=4]="DRM_BROAD_WARP",t[t.DRM_LOCAL_REFERENCE=8]="DRM_LOCAL_REFERENCE",t[t.DRM_DEWRINKLE=16]="DRM_DEWRINKLE",t[t.DRM_SKIP=0]="DRM_SKIP",t[t.DRM_REV=2147483648]="DRM_REV"}(Hn||(Hn={})),function(t){t[t.DPMCRM_AUTO=1]="DPMCRM_AUTO",t[t.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",t[t.DPMCRM_SKIP=0]="DPMCRM_SKIP",t[t.DPMCRM_REV=2147483648]="DPMCRM_REV"}(Yn||(Yn={})),function(t){t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_REV=2147483648]="GTM_REV"}(Xn||(Xn={})),function(t){t[t.IPM_AUTO=1]="IPM_AUTO",t[t.IPM_GENERAL=2]="IPM_GENERAL",t[t.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",t[t.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",t[t.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",t[t.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",t[t.IPM_SKIP=0]="IPM_SKIP",t[t.IPM_REV=2147483648]="IPM_REV"}(zn||(zn={})),function(t){t[t.IRSM_MEMORY=1]="IRSM_MEMORY",t[t.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",t[t.IRSM_BOTH=4]="IRSM_BOTH"}(Kn||(Kn={})),function(t){t[t.LM_SKIP=0]="LM_SKIP",t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=2147483648]="LM_REV"}(qn||(qn={})),function(t){t[t.PDFRM_RASTER=1]="PDFRM_RASTER",t[t.PDFRM_AUTO=2]="PDFRM_AUTO",t[t.PDFRM_VECTOR=4]="PDFRM_VECTOR",t[t.PDFRM_REV=2147483648]="PDFRM_REV"}(Zn||(Zn={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Jn||(Jn={})),function(t){t[t.RPM_AUTO=1]="RPM_AUTO",t[t.RPM_GENERAL=2]="RPM_GENERAL",t[t.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",t[t.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",t[t.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",t[t.RPM_SKIP=0]="RPM_SKIP",t[t.RPM_REV=2147483648]="RPM_REV"}($n||($n={})),function(t){t[t.RCT_PIXEL=1]="RCT_PIXEL",t[t.RCT_PERCENTAGE=2]="RCT_PERCENTAGE"}(Qn||(Qn={})),function(t){t[t.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",t[t.RT_RAW_TEXT=1]="RT_RAW_TEXT",t[t.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",t[t.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT"}(es||(es={})),function(t){t[t.SUM_AUTO=1]="SUM_AUTO",t[t.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",t[t.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",t[t.SUM_SKIP=0]="SUM_SKIP",t[t.SUM_REV=2147483648]="SUM_REV"}(ts||(ts={})),function(t){t[t.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",t[t.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",t[t.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",t[t.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",t[t.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",t[t.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED"}(is||(is={})),function(t){t[t.TFM_AUTO=1]="TFM_AUTO",t[t.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",t[t.TFM_SKIP=0]="TFM_SKIP",t[t.TFM_REV=2147483648]="TFM_REV"}(rs||(rs={})),function(t){t[t.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",t[t.TROM_POSITION=2]="TROM_POSITION",t[t.TROM_FORMAT=4]="TROM_FORMAT",t[t.TROM_SKIP=0]="TROM_SKIP",t[t.TROM_REV=2147483648]="TROM_REV"}(ns||(ns={})),function(t){t[t.TDM_AUTO=1]="TDM_AUTO",t[t.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",t[t.TDM_SKIP=0]="TDM_SKIP",t[t.TDM_REV=2147483648]="TDM_REV"}(ss||(ss={}));j.license="DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAwLWRicl9qc19zYW1wbGVzIiwib3JnYW5pemF0aW9uSUQiOiIyMDAwMDAifQ==";j.engineResourcePath="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.6.32/dist/";const ql=Ya('<svg class="dce-bg-loading" viewBox="0 0 1792 1792" data-v-ed0c211c><path d="M1760 896q0 176-68.5 336t-184 275.5-275.5 184-336 68.5-336-68.5-275.5-184-184-275.5-68.5-336q0-213 97-398.5t265-305.5 374-151v228q-221 45-366.5 221t-145.5 406q0 130 51 248.5t136.5 204 204 136.5 248.5 51 248.5-51 204-136.5 136.5-204 51-248.5q0-230-145.5-406t-366.5-221v-228q206 31 374 151t265 305.5 97 398.5z" data-v-ed0c211c></path></svg><svg class="dce-bg-camera" viewBox="0 0 2048 1792" data-v-ed0c211c><path d="M1024 672q119 0 203.5 84.5t84.5 203.5-84.5 203.5-203.5 84.5-203.5-84.5-84.5-203.5 84.5-203.5 203.5-84.5zm704-416q106 0 181 75t75 181v896q0 106-75 181t-181 75h-1408q-106 0-181-75t-75-181v-896q0-106 75-181t181-75h224l51-136q19-49 69.5-84.5t103.5-35.5h512q53 0 103.5 35.5t69.5 84.5l51 136h224zm-704 1152q185 0 316.5-131.5t131.5-316.5-131.5-316.5-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5z" data-v-ed0c211c></path></svg><div class="dce-video-container" data-v-ed0c211c></div><div class="dce-scanarea" data-v-ed0c211c><div class="dce-scanlight" data-v-ed0c211c></div></div><div class="div-select-container" data-v-ed0c211c><select class="dce-sel-camera" data-v-ed0c211c></select><select class="dce-sel-resolution" data-v-ed0c211c></select></div><div class="dbr-msg-poweredby" data-v-ed0c211c><svg viewBox="0 0 94 17" data-v-ed0c211c><g data-v-ed0c211c><path d="M0.9,14V4.3h2.3c0.6,0,1,0.1,1.4,0.3c0.3,0.2,0.6,0.5,0.7,0.9s0.2,0.8,0.2,1.4c0,0.5-0.1,0.9-0.2,1.3 C5.1,8.5,4.9,8.8,4.5,9.1C4.2,9.3,3.7,9.4,3.2,9.4H1.8V14H0.9z M1.8,8.7h1.2c0.4,0,0.7-0.1,1-0.2S4.3,8.2,4.4,8 c0.1-0.3,0.2-0.6,0.2-1.1c0-0.5,0-0.9-0.1-1.2C4.3,5.4,4.2,5.2,3.9,5.1S3.4,5,2.9,5H1.8V8.7z" data-v-ed0c211c></path><path d="M8.1,14.1c-0.5,0-0.8-0.1-1.1-0.3s-0.5-0.5-0.6-0.9s-0.2-0.9-0.2-1.4V9.6c0-0.6,0.1-1,0.2-1.4 C6.5,7.8,6.7,7.5,7,7.3S7.6,7,8.1,7C8.6,7,9,7.1,9.2,7.3s0.5,0.5,0.6,0.9C9.9,8.5,9.9,9,9.9,9.6v1.9c0,0.6-0.1,1-0.2,1.4 c-0.1,0.4-0.3,0.7-0.6,0.9S8.6,14.1,8.1,14.1z M8.1,13.4c0.3,0,0.5-0.1,0.7-0.2C8.9,13,9,12.8,9,12.5c0-0.3,0-0.6,0-1v-2 c0-0.4,0-0.7,0-1C9,8.2,8.9,8,8.8,7.9C8.6,7.7,8.4,7.6,8.1,7.6c-0.3,0-0.5,0.1-0.7,0.2C7.3,8,7.2,8.2,7.2,8.5c0,0.3-0.1,0.6-0.1,1 v2c0,0.4,0,0.7,0.1,1c0,0.3,0.1,0.5,0.3,0.7C7.6,13.4,7.8,13.4,8.1,13.4z" data-v-ed0c211c></path><path d="M12,14l-1.1-6.9h0.7l0.9,5.8l1.1-5.8h0.8l1.1,5.8l0.8-5.8H17L15.9,14H15l-1.1-5.6L12.8,14H12z" data-v-ed0c211c></path><path d="M19.8,14.1c-0.4,0-0.8-0.1-1.1-0.3s-0.5-0.5-0.6-0.9c-0.1-0.4-0.2-0.9-0.2-1.6V9.6c0-0.7,0.1-1.2,0.2-1.6 c0.1-0.4,0.3-0.7,0.6-0.8C19,7,19.3,7,19.8,7c0.5,0,0.9,0.1,1.1,0.3c0.3,0.2,0.4,0.5,0.5,0.9c0.1,0.4,0.1,1,0.1,1.6v0.6h-2.8v1.2 c0,0.4,0,0.8,0.1,1.1c0.1,0.3,0.2,0.4,0.3,0.6s0.3,0.2,0.6,0.2c0.2,0,0.3,0,0.5-0.1c0.1-0.1,0.3-0.2,0.3-0.4s0.1-0.5,0.1-0.8v-0.5 h0.9V12c0,0.6-0.1,1.1-0.4,1.5S20.4,14.1,19.8,14.1z M18.8,9.9h1.9V9.4c0-0.4,0-0.7-0.1-0.9c0-0.3-0.1-0.5-0.3-0.6S20,7.6,19.8,7.6 c-0.2,0-0.4,0.1-0.6,0.2c-0.1,0.1-0.3,0.3-0.3,0.6c-0.1,0.3-0.1,0.7-0.1,1.1V9.9z" data-v-ed0c211c></path><path d="M22.8,14V7.1h0.9V8c0.2-0.4,0.5-0.6,0.8-0.8C24.8,7.1,25,7,25.3,7c0,0,0,0,0.1,0s0.1,0,0.1,0v0.9 c-0.1,0-0.1,0-0.2-0.1c-0.1,0-0.2,0-0.2,0c-0.3,0-0.5,0.1-0.7,0.2c-0.2,0.1-0.4,0.3-0.6,0.6V14H22.8z" data-v-ed0c211c></path><path d="M28,14.1c-0.4,0-0.8-0.1-1.1-0.3s-0.5-0.5-0.6-0.9c-0.1-0.4-0.2-0.9-0.2-1.6V9.6c0-0.7,0.1-1.2,0.2-1.6 c0.1-0.4,0.3-0.7,0.6-0.8C27.3,7,27.6,7,28,7c0.5,0,0.9,0.1,1.1,0.3c0.3,0.2,0.4,0.5,0.5,0.9c0.1,0.4,0.1,1,0.1,1.6v0.6H27v1.2 c0,0.4,0,0.8,0.1,1.1c0.1,0.3,0.2,0.4,0.3,0.6s0.3,0.2,0.6,0.2c0.2,0,0.3,0,0.5-0.1c0.1-0.1,0.3-0.2,0.3-0.4s0.1-0.5,0.1-0.8v-0.5 h0.9V12c0,0.6-0.1,1.1-0.4,1.5S28.7,14.1,28,14.1z M27,9.9H29V9.4c0-0.4,0-0.7-0.1-0.9c0-0.3-0.1-0.5-0.3-0.6S28.3,7.6,28,7.6 c-0.2,0-0.4,0.1-0.6,0.2c-0.1,0.1-0.3,0.3-0.3,0.6C27.1,8.6,27,9,27,9.5V9.9z" data-v-ed0c211c></path><path d="M32.6,14.1c-0.6,0-1-0.2-1.3-0.7c-0.3-0.4-0.4-1.2-0.4-2.2V9.9c0-0.6,0-1.1,0.1-1.6c0.1-0.4,0.2-0.8,0.5-1 c0.2-0.2,0.6-0.4,1-0.4C32.8,7,33,7,33.2,7.1c0.2,0.1,0.4,0.3,0.5,0.4V4.3h0.9V14h-0.9v-0.5c-0.1,0.2-0.3,0.3-0.5,0.4 C33,14,32.8,14.1,32.6,14.1z M32.7,13.4c0.2,0,0.4,0,0.5-0.1c0.2-0.1,0.3-0.2,0.5-0.3V8.1c-0.1-0.1-0.3-0.2-0.4-0.3 c-0.2-0.1-0.4-0.2-0.6-0.2c-0.4,0-0.6,0.2-0.8,0.5S31.8,9,31.8,9.6v1.6c0,0.5,0,0.9,0.1,1.2c0.1,0.3,0.1,0.6,0.3,0.7 C32.3,13.3,32.5,13.4,32.7,13.4z" data-v-ed0c211c></path><path d="M40.5,14.1c-0.3,0-0.5-0.1-0.7-0.2c-0.2-0.1-0.4-0.3-0.5-0.4V14h-0.9V4.3h0.9v3.4c0.1-0.2,0.3-0.3,0.5-0.5 C40.1,7,40.3,7,40.6,7C41,7,41.2,7,41.4,7.2c0.2,0.2,0.4,0.4,0.5,0.6c0.1,0.3,0.2,0.6,0.2,0.9s0.1,0.7,0.1,1v1.5 c0,0.6,0,1.1-0.1,1.5c-0.1,0.4-0.3,0.8-0.5,1C41.3,14,41,14.1,40.5,14.1z M40.4,13.4c0.3,0,0.5-0.1,0.6-0.3 c0.1-0.2,0.2-0.4,0.3-0.8s0.1-0.7,0.1-1.2V9.7c0-0.5,0-0.8-0.1-1.1S41.1,8,41,7.9c-0.1-0.2-0.3-0.2-0.6-0.2c-0.2,0-0.4,0.1-0.6,0.2 c-0.2,0.1-0.3,0.2-0.5,0.4v4.7c0.1,0.1,0.3,0.3,0.5,0.4C40,13.4,40.2,13.4,40.4,13.4z" data-v-ed0c211c></path><path d="M43.2,15.7V15c0.4,0,0.7,0,0.9-0.1c0.2-0.1,0.3-0.1,0.4-0.3c0.1-0.1,0.1-0.2,0.1-0.4c0-0.1,0-0.3-0.1-0.5 c0-0.2-0.1-0.4-0.2-0.6L43,7.1h0.9l1.2,5.9l1.2-5.9h0.9l-1.7,7.4c-0.1,0.3-0.2,0.5-0.3,0.7c-0.2,0.2-0.4,0.3-0.6,0.4 c-0.3,0.1-0.6,0.1-1,0.1H43.2z" data-v-ed0c211c></path><path d="M50.6,14V4.3h2.1c0.7,0,1.2,0.1,1.6,0.4c0.4,0.2,0.6,0.6,0.8,1c0.2,0.4,0.2,0.9,0.2,1.5V11 c0,0.6-0.1,1.1-0.2,1.6s-0.4,0.8-0.8,1S53.5,14,52.8,14H50.6z M51.5,13.3h1.2c0.5,0,0.9-0.1,1.1-0.3s0.4-0.5,0.5-0.9 s0.1-0.8,0.1-1.3V7.2c0-0.5,0-0.9-0.1-1.2s-0.2-0.6-0.5-0.8S53.2,5,52.7,5h-1.2V13.3z" data-v-ed0c211c></path><path d="M56.5,15.7V15c0.4,0,0.7,0,0.9-0.1c0.2-0.1,0.3-0.1,0.4-0.3c0.1-0.1,0.1-0.2,0.1-0.4c0-0.1,0-0.3-0.1-0.5 c0-0.2-0.1-0.4-0.2-0.6l-1.4-6.1h0.9l1.2,5.9l1.2-5.9h0.9l-1.7,7.4c-0.1,0.3-0.2,0.5-0.3,0.7s-0.4,0.3-0.6,0.4s-0.6,0.1-1,0.1H56.5 z" data-v-ed0c211c></path><path d="M61.3,14V7.1h0.9v0.7c0.2-0.2,0.5-0.4,0.8-0.6C63.2,7,63.5,7,63.8,7C64,7,64.2,7,64.4,7.1s0.3,0.3,0.4,0.5 c0.1,0.2,0.1,0.5,0.1,0.8V14H64V8.6c0-0.4-0.1-0.6-0.2-0.8c-0.1-0.1-0.3-0.2-0.5-0.2c-0.2,0-0.4,0.1-0.6,0.2s-0.4,0.3-0.6,0.5V14 H61.3z" data-v-ed0c211c></path><path d="M67.4,14.1c-0.3,0-0.5-0.1-0.7-0.2c-0.2-0.1-0.4-0.3-0.5-0.6C66,13.1,66,12.8,66,12.6c0-0.4,0.1-0.7,0.2-0.9 s0.3-0.5,0.5-0.7c0.2-0.2,0.5-0.4,0.9-0.6c0.4-0.2,0.8-0.4,1.3-0.6V9.3c0-0.4,0-0.8-0.1-1c-0.1-0.2-0.1-0.4-0.3-0.5 c-0.1-0.1-0.3-0.2-0.5-0.2c-0.2,0-0.3,0-0.5,0.1c-0.1,0.1-0.3,0.2-0.3,0.4c-0.1,0.2-0.1,0.4-0.1,0.7V9l-0.9,0 c0-0.7,0.2-1.2,0.5-1.6C66.8,7.1,67.3,7,68,7c0.6,0,1.1,0.2,1.3,0.6c0.3,0.4,0.4,1,0.4,1.7v3.4c0,0.1,0,0.3,0,0.5 c0,0.2,0,0.4,0,0.5c0,0.2,0,0.3,0,0.4h-0.8c0-0.2-0.1-0.3-0.1-0.5c0-0.2,0-0.3-0.1-0.5c-0.1,0.3-0.3,0.5-0.5,0.7 S67.7,14.1,67.4,14.1z M67.6,13.4c0.2,0,0.3,0,0.5-0.1c0.1-0.1,0.3-0.2,0.4-0.3s0.2-0.3,0.3-0.4v-2.2c-0.3,0.2-0.6,0.3-0.9,0.5 c-0.2,0.1-0.4,0.3-0.6,0.4c-0.2,0.1-0.3,0.3-0.3,0.5s-0.1,0.4-0.1,0.6c0,0.4,0.1,0.6,0.2,0.8C67.2,13.3,67.4,13.4,67.6,13.4z" data-v-ed0c211c></path><path d="M70.9,14V7.1h0.8v0.7c0.2-0.3,0.5-0.5,0.8-0.6c0.3-0.1,0.6-0.2,0.9-0.2c0.2,0,0.5,0.1,0.7,0.2s0.3,0.4,0.4,0.7 c0.2-0.3,0.5-0.5,0.8-0.7c0.3-0.2,0.6-0.2,0.9-0.2c0.2,0,0.4,0,0.6,0.1s0.3,0.3,0.4,0.5c0.1,0.2,0.2,0.5,0.2,0.9V14h-0.8V8.6 c0-0.4-0.1-0.7-0.2-0.8s-0.3-0.2-0.5-0.2c-0.2,0-0.4,0.1-0.7,0.2S74.7,8,74.5,8.3c0,0,0,0.1,0,0.1s0,0.1,0,0.1V14h-0.8V8.6 c0-0.4-0.1-0.7-0.2-0.8c-0.1-0.1-0.3-0.2-0.5-0.2c-0.2,0-0.4,0.1-0.7,0.2c-0.2,0.1-0.4,0.3-0.6,0.5V14H70.9z" data-v-ed0c211c></path><path d="M80.2,14.1c-0.6,0-1-0.2-1.3-0.5c-0.3-0.4-0.5-0.8-0.6-1.4l0.7-0.2c0,0.5,0.2,0.9,0.4,1.2 c0.2,0.2,0.5,0.4,0.8,0.4c0.3,0,0.5-0.1,0.7-0.3c0.2-0.2,0.2-0.4,0.2-0.7c0-0.2-0.1-0.5-0.2-0.7c-0.1-0.2-0.4-0.5-0.6-0.7l-0.9-0.8 c-0.3-0.3-0.5-0.5-0.7-0.8c-0.2-0.3-0.2-0.6-0.2-0.9c0-0.3,0.1-0.6,0.2-0.8c0.1-0.2,0.3-0.4,0.6-0.5C79.5,7,79.8,7,80.2,7 c0.5,0,0.9,0.2,1.2,0.5c0.3,0.3,0.4,0.8,0.4,1.3L81.2,9c0-0.3-0.1-0.6-0.1-0.8s-0.2-0.4-0.3-0.5c-0.1-0.1-0.3-0.1-0.5-0.1 c-0.3,0-0.5,0.1-0.6,0.2c-0.2,0.1-0.2,0.4-0.2,0.6c0,0.2,0,0.4,0.1,0.6c0.1,0.2,0.2,0.3,0.4,0.5l1,0.9c0.2,0.2,0.4,0.3,0.6,0.5 c0.2,0.2,0.3,0.4,0.4,0.6c0.1,0.2,0.2,0.5,0.2,0.8c0,0.4-0.1,0.7-0.2,0.9c-0.1,0.2-0.4,0.4-0.6,0.6C80.9,14,80.6,14.1,80.2,14.1z" data-v-ed0c211c></path><path d="M84.7,14.1c-0.5,0-0.8-0.1-1.1-0.3c-0.3-0.2-0.5-0.5-0.6-0.9s-0.2-0.9-0.2-1.4V9.6c0-0.6,0.1-1,0.2-1.4 c0.1-0.4,0.3-0.7,0.6-0.9C83.9,7.1,84.3,7,84.7,7c0.5,0,0.9,0.1,1.1,0.3s0.5,0.5,0.6,0.9c0.1,0.4,0.2,0.9,0.2,1.4v1.9 c0,0.6-0.1,1-0.2,1.4s-0.3,0.7-0.6,0.9S85.2,14.1,84.7,14.1z M84.7,13.4c0.3,0,0.5-0.1,0.7-0.2c0.1-0.2,0.2-0.4,0.3-0.7 c0-0.3,0-0.6,0-1v-2c0-0.4,0-0.7,0-1c0-0.3-0.1-0.5-0.3-0.7c-0.1-0.2-0.4-0.2-0.7-0.2c-0.3,0-0.5,0.1-0.7,0.2 c-0.1,0.2-0.2,0.4-0.3,0.7c0,0.3-0.1,0.6-0.1,1v2c0,0.4,0,0.7,0.1,1c0,0.3,0.1,0.5,0.3,0.7C84.2,13.4,84.4,13.4,84.7,13.4z" data-v-ed0c211c></path><path d="M88.2,14V7.7h-0.9V7.1h0.9V6.3c0-0.3,0-0.6,0.1-0.9c0.1-0.3,0.2-0.5,0.4-0.6c0.2-0.2,0.5-0.2,0.8-0.2 c0.1,0,0.2,0,0.4,0c0.1,0,0.2,0,0.3,0.1v0.6c-0.1,0-0.2,0-0.2,0c-0.1,0-0.2,0-0.2,0c-0.3,0-0.4,0.1-0.5,0.2s-0.1,0.4-0.1,0.8v0.8 h1.1v0.6h-1.1V14H88.2z" data-v-ed0c211c></path><path d="M92.7,14.1c-0.3,0-0.6-0.1-0.8-0.2s-0.3-0.3-0.4-0.5c-0.1-0.2-0.1-0.5-0.1-0.8V7.6h-0.9V7.1h0.9V4.9h0.9v2.1 h1.2v0.6h-1.2v4.8c0,0.3,0,0.6,0.1,0.7c0.1,0.1,0.2,0.2,0.5,0.2c0.1,0,0.2,0,0.2,0s0.2,0,0.3,0V14c-0.1,0-0.2,0-0.4,0.1 C92.9,14.1,92.8,14.1,92.7,14.1z" data-v-ed0c211c></path></g></svg></div>',6),Zl=[ql],Jl=Yi({__name:"VideoDecode",setup(t){const e=si(null),r=si(null);return Nr(async()=>{try{const o=Za();r.value=o==null?void 0:o.refs.elRefs;const h=await(e.value=He.createInstance());await h.setUIElement(r.value),h.onFrameRead=g=>{for(let p of g)console.log(p.barcodeText)},h.onUniqueRead=g=>{alert(g)},await h.open()}catch(o){let h=o.message||o;h.includes("network connection error")&&(h="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license."),console.error(h),alert(h)}}),jr(async()=>{e.value&&((await e.value).destroyContext(),console.log("BarcodeScanner Component Unmount"))}),(o,h)=>(Tt(),Wr("div",{ref_key:"elRefs",ref:r,class:"component-barcode-scanner"},Zl,512))}});const zr=(t,e)=>{const r=t.__vccOpts||t;for(const[o,h]of e)r[o]=h;return r},$l=zr(Jl,[["__scopeId","data-v-ed0c211c"]]),Ql={class:"ImgDecode"},ec=Yi({__name:"ImgDecode",setup(t){const e=si(null),r=async o=>{try{let g=await(await(e.value=e.value||j.createInstance())).decode(o.target.files[0]);for(let p of g)alert(p.barcodeText);g.length||alert("No barcode found")}catch(h){let g=h.message||h;g.includes("network connection error")&&(g="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license."),console.error(g),alert(g)}o.target.value=""};return jr(async()=>{e.value&&((await e.value).destroyContext(),console.log("ImgDecode Component Unmount"))}),(o,h)=>(Tt(),Wr("div",Ql,[ct("input",{type:"file",onChange:r},null,32)]))}});const tc=zr(ec,[["__scopeId","data-v-b94b54db"]]),ic=t=>(ta("data-v-a1840305"),t=t(),ia(),t),rc={className:"helloWorld"},nc=ic(()=>ct("h1",null,[Ys("Hello World for Vue 3 "),ct("img",{class:"applogo",alt:"Vue logo",src:Al})],-1)),sc={class:"container"},oc=Yi({__name:"HelloWorld",setup(t){const e=si(!0),r=si(!1);Nr(async()=>{try{await He.loadWasm()}catch(g){let p=g.message||g;p.includes("network connection error")&&(p="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license."),console.error(p),alert(p)}});const o=()=>{e.value=!0,r.value=!1},h=()=>{e.value=!1,r.value=!0};return(g,p)=>(Tt(),Wr("div",rc,[nc,ct("div",null,[ct("button",{style:ri({marginRight:"10px",backgroundColor:e.value?"rgb(255,174,55)":"white"}),onClick:o},"Video Decode",4),ct("button",{style:ri({backgroundColor:r.value?"rgb(255,174,55)":"white"}),onClick:h},"Image Decode",4)]),ct("div",sc,[e.value?(Tt(),Di($l,{key:0})):_n("",!0),r.value?(Tt(),Di(tc,{key:1})):_n("",!0)])]))}});const ac=zr(oc,[["__scopeId","data-v-a1840305"]]),lc=Yi({__name:"App",setup(t){return(e,r)=>(Tt(),Di(ac))}});El(lc).mount("#app");
