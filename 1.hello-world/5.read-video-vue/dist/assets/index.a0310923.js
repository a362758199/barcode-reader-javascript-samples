function Nh(){import("data:text/javascript,")}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))n(h);new MutationObserver(h=>{for(const d of h)if(d.type==="childList")for(const p of d.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&n(p)}).observe(document,{childList:!0,subtree:!0});function i(h){const d={};return h.integrity&&(d.integrity=h.integrity),h.referrerpolicy&&(d.referrerPolicy=h.referrerpolicy),h.crossorigin==="use-credentials"?d.credentials="include":h.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(h){if(h.ep)return;h.ep=!0;const d=i(h);fetch(h.href,d)}})();/*!
 * Vue.js v2.7.15
 * (c) 2014-2023 Evan You
 * Released under the MIT License.
 */var Ve=Object.freeze({}),be=Array.isArray;function ve(t){return t==null}function J(t){return t!=null}function De(t){return t===!0}function Lo(t){return t===!1}function oi(t){return typeof t=="string"||typeof t=="number"||typeof t=="symbol"||typeof t=="boolean"}function Ae(t){return typeof t=="function"}function Fe(t){return t!==null&&typeof t=="object"}var Rr=Object.prototype.toString;function We(t){return Rr.call(t)==="[object Object]"}function Fo(t){return Rr.call(t)==="[object RegExp]"}function As(t){var e=parseFloat(String(t));return e>=0&&Math.floor(e)===e&&isFinite(t)}function nr(t){return J(t)&&typeof t.then=="function"&&typeof t.catch=="function"}function Po(t){return t==null?"":Array.isArray(t)||We(t)&&t.toString===Rr?JSON.stringify(t,null,2):String(t)}function ei(t){var e=parseFloat(t);return isNaN(e)?t:e}function Ke(t,e){for(var i=Object.create(null),n=t.split(","),h=0;h<n.length;h++)i[n[h]]=!0;return e?function(d){return i[d.toLowerCase()]}:function(d){return i[d]}}Ke("slot,component",!0);var ko=Ke("key,ref,slot,slot-scope,is");function gt(t,e){var i=t.length;if(i){if(e===t[i-1]){t.length=i-1;return}var n=t.indexOf(e);if(n>-1)return t.splice(n,1)}}var Bo=Object.prototype.hasOwnProperty;function ke(t,e){return Bo.call(t,e)}function Ot(t){var e=Object.create(null);return function(n){var h=e[n];return h||(e[n]=t(n))}}var No=/-(\w)/g,wt=Ot(function(t){return t.replace(No,function(e,i){return i?i.toUpperCase():""})}),jo=Ot(function(t){return t.charAt(0).toUpperCase()+t.slice(1)}),Uo=/\B([A-Z])/g,ai=Ot(function(t){return t.replace(Uo,"-$1").toLowerCase()});function Vo(t,e){function i(n){var h=arguments.length;return h?h>1?t.apply(e,arguments):t.call(e,n):t.call(e)}return i._length=t.length,i}function Go(t,e){return t.bind(e)}var Ds=Function.prototype.bind?Go:Vo;function sr(t,e){e=e||0;for(var i=t.length-e,n=new Array(i);i--;)n[i]=t[i+e];return n}function Te(t,e){for(var i in e)t[i]=e[i];return t}function Rs(t){for(var e={},i=0;i<t.length;i++)t[i]&&Te(e,t[i]);return e}function Me(t,e,i){}var ui=function(t,e,i){return!1},Ms=function(t){return t};function xt(t,e){if(t===e)return!0;var i=Fe(t),n=Fe(e);if(i&&n)try{var h=Array.isArray(t),d=Array.isArray(e);if(h&&d)return t.length===e.length&&t.every(function(b,C){return xt(b,e[C])});if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(!h&&!d){var p=Object.keys(t),v=Object.keys(e);return p.length===v.length&&p.every(function(b){return xt(t[b],e[b])})}else return!1}catch(b){return!1}else return!i&&!n?String(t)===String(e):!1}function Ls(t,e){for(var i=0;i<t.length;i++)if(xt(t[i],e))return i;return-1}function Ei(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}}function Wo(t,e){return t===e?t===0&&1/t!==1/e:t===t||e===e}var rn="data-server-rendered",Hi=["component","directive","filter"],Fs=["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed","activated","deactivated","errorCaptured","serverPrefetch","renderTracked","renderTriggered"],Ze={optionMergeStrategies:Object.create(null),silent:!1,productionTip:!1,devtools:!1,performance:!1,errorHandler:null,warnHandler:null,ignoredElements:[],keyCodes:Object.create(null),isReservedTag:ui,isReservedAttr:ui,isUnknownElement:ui,getTagNamespace:Me,parsePlatformTagName:Ms,mustUseProp:ui,async:!0,_lifecycleHooks:Fs},Ho=/a-zA-Z\u00B7\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u037D\u037F-\u1FFF\u200C-\u200D\u203F-\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD/;function Ps(t){var e=(t+"").charCodeAt(0);return e===36||e===95}function ct(t,e,i,n){Object.defineProperty(t,e,{value:i,enumerable:!!n,writable:!0,configurable:!0})}var zo=new RegExp("[^".concat(Ho.source,".$_\\d]"));function Yo(t){if(!zo.test(t)){var e=t.split(".");return function(i){for(var n=0;n<e.length;n++){if(!i)return;i=i[e[n]]}return i}}}var Xo="__proto__"in{},ze=typeof window<"u",Pe=ze&&window.navigator.userAgent.toLowerCase(),Nt=Pe&&/msie|trident/.test(Pe),jt=Pe&&Pe.indexOf("msie 9.0")>0,Mr=Pe&&Pe.indexOf("edge/")>0;Pe&&Pe.indexOf("android")>0;var $o=Pe&&/iphone|ipad|ipod|ios/.test(Pe);Pe&&/chrome\/\d+/.test(Pe);Pe&&/phantomjs/.test(Pe);var nn=Pe&&Pe.match(/firefox\/(\d+)/),or={}.watch,ks=!1;if(ze)try{var sn={};Object.defineProperty(sn,"passive",{get:function(){ks=!0}}),window.addEventListener("test-passive",null,sn)}catch(t){}var di,li=function(){return di===void 0&&(!ze&&typeof global<"u"?di=global.process&&global.process.env.VUE_ENV==="server":di=!1),di},Oi=ze&&window.__VUE_DEVTOOLS_GLOBAL_HOOK__;function kt(t){return typeof t=="function"&&/native code/.test(t.toString())}var ci=typeof Symbol<"u"&&kt(Symbol)&&typeof Reflect<"u"&&kt(Reflect.ownKeys),ti;typeof Set<"u"&&kt(Set)?ti=Set:ti=function(){function t(){this.set=Object.create(null)}return t.prototype.has=function(e){return this.set[e]===!0},t.prototype.add=function(e){this.set[e]=!0},t.prototype.clear=function(){this.set=Object.create(null)},t}();var Jt=null;function ht(t){t===void 0&&(t=null),t||Jt&&Jt._scope.off(),Jt=t,t&&t._scope.on()}var He=function(){function t(e,i,n,h,d,p,v,b){this.tag=e,this.data=i,this.children=n,this.text=h,this.elm=d,this.ns=void 0,this.context=p,this.fnContext=void 0,this.fnOptions=void 0,this.fnScopeId=void 0,this.key=i&&i.key,this.componentOptions=v,this.componentInstance=void 0,this.parent=void 0,this.raw=!1,this.isStatic=!1,this.isRootInsert=!0,this.isComment=!1,this.isCloned=!1,this.isOnce=!1,this.asyncFactory=b,this.asyncMeta=void 0,this.isAsyncPlaceholder=!1}return Object.defineProperty(t.prototype,"child",{get:function(){return this.componentInstance},enumerable:!1,configurable:!0}),t}(),yt=function(t){t===void 0&&(t="");var e=new He;return e.text=t,e.isComment=!0,e};function Lt(t){return new He(void 0,void 0,void 0,String(t))}function ar(t){var e=new He(t.tag,t.data,t.children&&t.children.slice(),t.text,t.elm,t.context,t.componentOptions,t.asyncFactory);return e.ns=t.ns,e.isStatic=t.isStatic,e.key=t.key,e.isComment=t.isComment,e.fnContext=t.fnContext,e.fnOptions=t.fnOptions,e.fnScopeId=t.fnScopeId,e.asyncMeta=t.asyncMeta,e.isCloned=!0,e}var Zo=0,Ci=[],qo=function(){for(var t=0;t<Ci.length;t++){var e=Ci[t];e.subs=e.subs.filter(function(i){return i}),e._pending=!1}Ci.length=0},ut=function(){function t(){this._pending=!1,this.id=Zo++,this.subs=[]}return t.prototype.addSub=function(e){this.subs.push(e)},t.prototype.removeSub=function(e){this.subs[this.subs.indexOf(e)]=null,this._pending||(this._pending=!0,Ci.push(this))},t.prototype.depend=function(e){t.target&&t.target.addDep(this)},t.prototype.notify=function(e){for(var i=this.subs.filter(function(p){return p}),n=0,h=i.length;n<h;n++){var d=i[n];d.update()}},t}();ut.target=null;var wi=[];function Ut(t){wi.push(t),ut.target=t}function Vt(){wi.pop(),ut.target=wi[wi.length-1]}var Bs=Array.prototype,Ai=Object.create(Bs),Ko=["push","pop","shift","unshift","splice","sort","reverse"];Ko.forEach(function(t){var e=Bs[t];ct(Ai,t,function(){for(var n=[],h=0;h<arguments.length;h++)n[h]=arguments[h];var d=e.apply(this,n),p=this.__ob__,v;switch(t){case"push":case"unshift":v=n;break;case"splice":v=n.slice(2);break}return v&&p.observeArray(v),p.dep.notify(),d})});var on=Object.getOwnPropertyNames(Ai),Ns={},Lr=!0;function dt(t){Lr=t}var Jo={notify:Me,depend:Me,addSub:Me,removeSub:Me},an=function(){function t(e,i,n){if(i===void 0&&(i=!1),n===void 0&&(n=!1),this.value=e,this.shallow=i,this.mock=n,this.dep=n?Jo:new ut,this.vmCount=0,ct(e,"__ob__",this),be(e)){if(!n)if(Xo)e.__proto__=Ai;else for(var h=0,d=on.length;h<d;h++){var p=on[h];ct(e,p,Ai[p])}i||this.observeArray(e)}else for(var v=Object.keys(e),h=0;h<v.length;h++){var p=v[h];Tt(e,p,Ns,void 0,i,n)}}return t.prototype.observeArray=function(e){for(var i=0,n=e.length;i<n;i++)st(e[i],!1,this.mock)},t}();function st(t,e,i){if(t&&ke(t,"__ob__")&&t.__ob__ instanceof an)return t.__ob__;if(Lr&&(i||!li())&&(be(t)||We(t))&&Object.isExtensible(t)&&!t.__v_skip&&!Qe(t)&&!(t instanceof He))return new an(t,e,i)}function Tt(t,e,i,n,h,d){var p=new ut,v=Object.getOwnPropertyDescriptor(t,e);if(!(v&&v.configurable===!1)){var b=v&&v.get,C=v&&v.set;(!b||C)&&(i===Ns||arguments.length===2)&&(i=t[e]);var x=!h&&st(i,!1,d);return Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){var O=b?b.call(t):i;return ut.target&&(p.depend(),x&&(x.dep.depend(),be(O)&&Us(O))),Qe(O)&&!h?O.value:O},set:function(O){var N=b?b.call(t):i;if(!!Wo(N,O)){if(C)C.call(t,O);else{if(b)return;if(!h&&Qe(N)&&!Qe(O)){N.value=O;return}else i=O}x=!h&&st(O,!1,d),p.notify()}}}),p}}function Fr(t,e,i){if(!Pr(t)){var n=t.__ob__;return be(t)&&As(e)?(t.length=Math.max(t.length,e),t.splice(e,1,i),n&&!n.shallow&&n.mock&&st(i,!1,!0),i):e in t&&!(e in Object.prototype)?(t[e]=i,i):t._isVue||n&&n.vmCount?i:n?(Tt(n.value,e,i,void 0,n.shallow,n.mock),n.dep.notify(),i):(t[e]=i,i)}}function js(t,e){if(be(t)&&As(e)){t.splice(e,1);return}var i=t.__ob__;t._isVue||i&&i.vmCount||Pr(t)||!ke(t,e)||(delete t[e],i&&i.dep.notify())}function Us(t){for(var e=void 0,i=0,n=t.length;i<n;i++)e=t[i],e&&e.__ob__&&e.__ob__.dep.depend(),be(e)&&Us(e)}function Vs(t){return Qo(t,!0),ct(t,"__v_isShallow",!0),t}function Qo(t,e){Pr(t)||st(t,e,li())}function Pr(t){return!!(t&&t.__v_isReadonly)}function Qe(t){return!!(t&&t.__v_isRef===!0)}function lr(t,e,i){Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:function(){var n=e[i];if(Qe(n))return n.value;var h=n&&n.__ob__;return h&&h.dep.depend(),n},set:function(n){var h=e[i];Qe(h)&&!Qe(n)?h.value=n:e[i]=n}})}var Be,ea=function(){function t(e){e===void 0&&(e=!1),this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Be,!e&&Be&&(this.index=(Be.scopes||(Be.scopes=[])).push(this)-1)}return t.prototype.run=function(e){if(this.active){var i=Be;try{return Be=this,e()}finally{Be=i}}},t.prototype.on=function(){Be=this},t.prototype.off=function(){Be=this.parent},t.prototype.stop=function(e){if(this.active){var i=void 0,n=void 0;for(i=0,n=this.effects.length;i<n;i++)this.effects[i].teardown();for(i=0,n=this.cleanups.length;i<n;i++)this.cleanups[i]();if(this.scopes)for(i=0,n=this.scopes.length;i<n;i++)this.scopes[i].stop(!0);if(!this.detached&&this.parent&&!e){var h=this.parent.scopes.pop();h&&h!==this&&(this.parent.scopes[this.index]=h,h.index=this.index)}this.parent=void 0,this.active=!1}},t}();function ta(t,e){e===void 0&&(e=Be),e&&e.active&&e.effects.push(t)}function ia(){return Be}function ra(t){var e=t._provided,i=t.$parent&&t.$parent._provided;return i===e?t._provided=Object.create(i):e}var ln=Ot(function(t){var e=t.charAt(0)==="&";t=e?t.slice(1):t;var i=t.charAt(0)==="~";t=i?t.slice(1):t;var n=t.charAt(0)==="!";return t=n?t.slice(1):t,{name:t,once:i,capture:n,passive:e}});function cr(t,e){function i(){var n=i.fns;if(be(n))for(var h=n.slice(),d=0;d<h.length;d++)ft(h[d],null,arguments,e,"v-on handler");else return ft(n,null,arguments,e,"v-on handler")}return i.fns=t,i}function Gs(t,e,i,n,h,d){var p,v,b,C;for(p in t)v=t[p],b=e[p],C=ln(p),ve(v)||(ve(b)?(ve(v.fns)&&(v=t[p]=cr(v,d)),De(C.once)&&(v=t[p]=h(C.name,v,C.capture)),i(C.name,v,C.capture,C.passive,C.params)):v!==b&&(b.fns=v,t[p]=b));for(p in e)ve(t[p])&&(C=ln(p),n(C.name,e[p],C.capture))}function at(t,e,i){t instanceof He&&(t=t.data.hook||(t.data.hook={}));var n,h=t[e];function d(){i.apply(this,arguments),gt(n.fns,d)}ve(h)?n=cr([d]):J(h.fns)&&De(h.merged)?(n=h,n.fns.push(d)):n=cr([h,d]),n.merged=!0,t[e]=n}function na(t,e,i){var n=e.options.props;if(!ve(n)){var h={},d=t.attrs,p=t.props;if(J(d)||J(p))for(var v in n){var b=ai(v);cn(h,p,v,b,!0)||cn(h,d,v,b,!1)}return h}}function cn(t,e,i,n,h){if(J(e)){if(ke(e,i))return t[i]=e[i],h||delete e[i],!0;if(ke(e,n))return t[i]=e[n],h||delete e[n],!0}return!1}function sa(t){for(var e=0;e<t.length;e++)if(be(t[e]))return Array.prototype.concat.apply([],t);return t}function kr(t){return oi(t)?[Lt(t)]:be(t)?Ws(t):void 0}function zt(t){return J(t)&&J(t.text)&&Lo(t.isComment)}function Ws(t,e){var i=[],n,h,d,p;for(n=0;n<t.length;n++)h=t[n],!(ve(h)||typeof h=="boolean")&&(d=i.length-1,p=i[d],be(h)?h.length>0&&(h=Ws(h,"".concat(e||"","_").concat(n)),zt(h[0])&&zt(p)&&(i[d]=Lt(p.text+h[0].text),h.shift()),i.push.apply(i,h)):oi(h)?zt(p)?i[d]=Lt(p.text+h):h!==""&&i.push(Lt(h)):zt(h)&&zt(p)?i[d]=Lt(p.text+h.text):(De(t._isVList)&&J(h.tag)&&ve(h.key)&&J(e)&&(h.key="__vlist".concat(e,"_").concat(n,"__")),i.push(h)));return i}function oa(t,e){var i=null,n,h,d,p;if(be(t)||typeof t=="string")for(i=new Array(t.length),n=0,h=t.length;n<h;n++)i[n]=e(t[n],n);else if(typeof t=="number")for(i=new Array(t),n=0;n<t;n++)i[n]=e(n+1,n);else if(Fe(t))if(ci&&t[Symbol.iterator]){i=[];for(var v=t[Symbol.iterator](),b=v.next();!b.done;)i.push(e(b.value,i.length)),b=v.next()}else for(d=Object.keys(t),i=new Array(d.length),n=0,h=d.length;n<h;n++)p=d[n],i[n]=e(t[p],p,n);return J(i)||(i=[]),i._isVList=!0,i}function aa(t,e,i,n){var h=this.$scopedSlots[t],d;h?(i=i||{},n&&(i=Te(Te({},n),i)),d=h(i)||(Ae(e)?e():e)):d=this.$slots[t]||(Ae(e)?e():e);var p=i&&i.slot;return p?this.$createElement("template",{slot:p},d):d}function la(t){return Pi(this.$options,"filters",t)||Ms}function hn(t,e){return be(t)?t.indexOf(e)===-1:t!==e}function ca(t,e,i,n,h){var d=Ze.keyCodes[e]||i;return h&&n&&!Ze.keyCodes[e]?hn(h,n):d?hn(d,t):n?ai(n)!==e:t===void 0}function ha(t,e,i,n,h){if(i&&Fe(i)){be(i)&&(i=Rs(i));var d=void 0,p=function(b){if(b==="class"||b==="style"||ko(b))d=t;else{var C=t.attrs&&t.attrs.type;d=n||Ze.mustUseProp(e,C,b)?t.domProps||(t.domProps={}):t.attrs||(t.attrs={})}var x=wt(b),E=ai(b);if(!(x in d)&&!(E in d)&&(d[b]=i[b],h)){var O=t.on||(t.on={});O["update:".concat(b)]=function(N){i[b]=N}}};for(var v in i)p(v)}return t}function ua(t,e){var i=this._staticTrees||(this._staticTrees=[]),n=i[t];return n&&!e||(n=i[t]=this.$options.staticRenderFns[t].call(this._renderProxy,this._c,this),Hs(n,"__static__".concat(t),!1)),n}function da(t,e,i){return Hs(t,"__once__".concat(e).concat(i?"_".concat(i):""),!0),t}function Hs(t,e,i){if(be(t))for(var n=0;n<t.length;n++)t[n]&&typeof t[n]!="string"&&un(t[n],"".concat(e,"_").concat(n),i);else un(t,e,i)}function un(t,e,i){t.isStatic=!0,t.key=e,t.isOnce=i}function fa(t,e){if(e&&We(e)){var i=t.on=t.on?Te({},t.on):{};for(var n in e){var h=i[n],d=e[n];i[n]=h?[].concat(h,d):d}}return t}function zs(t,e,i,n){e=e||{$stable:!i};for(var h=0;h<t.length;h++){var d=t[h];be(d)?zs(d,e,i):d&&(d.proxy&&(d.fn.proxy=!0),e[d.key]=d.fn)}return n&&(e.$key=n),e}function ga(t,e){for(var i=0;i<e.length;i+=2){var n=e[i];typeof n=="string"&&n&&(t[e[i]]=e[i+1])}return t}function pa(t,e){return typeof t=="string"?e+t:t}function Ys(t){t._o=da,t._n=ei,t._s=Po,t._l=oa,t._t=aa,t._q=xt,t._i=Ls,t._m=ua,t._f=la,t._k=ca,t._b=ha,t._v=Lt,t._e=yt,t._u=zs,t._g=fa,t._d=ga,t._p=pa}function Br(t,e){if(!t||!t.length)return{};for(var i={},n=0,h=t.length;n<h;n++){var d=t[n],p=d.data;if(p&&p.attrs&&p.attrs.slot&&delete p.attrs.slot,(d.context===e||d.fnContext===e)&&p&&p.slot!=null){var v=p.slot,b=i[v]||(i[v]=[]);d.tag==="template"?b.push.apply(b,d.children||[]):b.push(d)}else(i.default||(i.default=[])).push(d)}for(var C in i)i[C].every(_a)&&delete i[C];return i}function _a(t){return t.isComment&&!t.asyncFactory||t.text===" "}function ii(t){return t.isComment&&t.asyncFactory}function Qt(t,e,i,n){var h,d=Object.keys(i).length>0,p=e?!!e.$stable:!d,v=e&&e.$key;if(!e)h={};else{if(e._normalized)return e._normalized;if(p&&n&&n!==Ve&&v===n.$key&&!d&&!n.$hasNormal)return n;h={};for(var b in e)e[b]&&b[0]!=="$"&&(h[b]=ma(t,i,b,e[b]))}for(var C in i)C in h||(h[C]=va(i,C));return e&&Object.isExtensible(e)&&(e._normalized=h),ct(h,"$stable",p),ct(h,"$key",v),ct(h,"$hasNormal",d),h}function ma(t,e,i,n){var h=function(){var d=Jt;ht(t);var p=arguments.length?n.apply(null,arguments):n({});p=p&&typeof p=="object"&&!be(p)?[p]:kr(p);var v=p&&p[0];return ht(d),p&&(!v||p.length===1&&v.isComment&&!ii(v))?void 0:p};return n.proxy&&Object.defineProperty(e,i,{get:h,enumerable:!0,configurable:!0}),h}function va(t,e){return function(){return t[e]}}function ya(t){var e=t.$options,i=e.setup;if(i){var n=t._setupContext=Sa(t);ht(t),Ut();var h=ft(i,null,[t._props||Vs({}),n],t,"setup");if(Vt(),ht(),Ae(h))e.render=h;else if(Fe(h))if(t._setupState=h,h.__sfc){var p=t._setupProxy={};for(var d in h)d!=="__sfc"&&lr(p,h,d)}else for(var d in h)Ps(d)||lr(t,h,d)}}function Sa(t){return{get attrs(){if(!t._attrsProxy){var e=t._attrsProxy={};ct(e,"_v_attr_proxy",!0),Di(e,t.$attrs,Ve,t,"$attrs")}return t._attrsProxy},get listeners(){if(!t._listenersProxy){var e=t._listenersProxy={};Di(e,t.$listeners,Ve,t,"$listeners")}return t._listenersProxy},get slots(){return Ca(t)},emit:Ds(t.$emit,t),expose:function(e){e&&Object.keys(e).forEach(function(i){return lr(t,e,i)})}}}function Di(t,e,i,n,h){var d=!1;for(var p in e)p in t?e[p]!==i[p]&&(d=!0):(d=!0,ba(t,p,n,h));for(var p in t)p in e||(d=!0,delete t[p]);return d}function ba(t,e,i,n){Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:function(){return i[n][e]}})}function Ca(t){return t._slotsProxy||Xs(t._slotsProxy={},t.$scopedSlots),t._slotsProxy}function Xs(t,e){for(var i in e)t[i]=e[i];for(var i in t)i in e||delete t[i]}function wa(t){t._vnode=null,t._staticTrees=null;var e=t.$options,i=t.$vnode=e._parentVnode,n=i&&i.context;t.$slots=Br(e._renderChildren,n),t.$scopedSlots=i?Qt(t.$parent,i.data.scopedSlots,t.$slots):Ve,t._c=function(d,p,v,b){return Ri(t,d,p,v,b,!1)},t.$createElement=function(d,p,v,b){return Ri(t,d,p,v,b,!0)};var h=i&&i.data;Tt(t,"$attrs",h&&h.attrs||Ve,null,!0),Tt(t,"$listeners",e._parentListeners||Ve,null,!0)}var hr=null;function xa(t){Ys(t.prototype),t.prototype.$nextTick=function(e){return Nr(e,this)},t.prototype._render=function(){var e=this,i=e.$options,n=i.render,h=i._parentVnode;h&&e._isMounted&&(e.$scopedSlots=Qt(e.$parent,h.data.scopedSlots,e.$slots,e.$scopedSlots),e._slotsProxy&&Xs(e._slotsProxy,e.$scopedSlots)),e.$vnode=h;var d;try{ht(e),hr=e,d=n.call(e._renderProxy,e.$createElement)}catch(p){It(p,e,"render"),d=e._vnode}finally{hr=null,ht()}return be(d)&&d.length===1&&(d=d[0]),d instanceof He||(d=yt()),d.parent=h,d}}function $i(t,e){return(t.__esModule||ci&&t[Symbol.toStringTag]==="Module")&&(t=t.default),Fe(t)?e.extend(t):t}function Ta(t,e,i,n,h){var d=yt();return d.asyncFactory=t,d.asyncMeta={data:e,context:i,children:n,tag:h},d}function Ia(t,e){if(De(t.error)&&J(t.errorComp))return t.errorComp;if(J(t.resolved))return t.resolved;var i=hr;if(i&&J(t.owners)&&t.owners.indexOf(i)===-1&&t.owners.push(i),De(t.loading)&&J(t.loadingComp))return t.loadingComp;if(i&&!J(t.owners)){var n=t.owners=[i],h=!0,d=null,p=null;i.$on("hook:destroyed",function(){return gt(n,i)});var v=function(E){for(var O=0,N=n.length;O<N;O++)n[O].$forceUpdate();E&&(n.length=0,d!==null&&(clearTimeout(d),d=null),p!==null&&(clearTimeout(p),p=null))},b=Ei(function(E){t.resolved=$i(E,e),h?n.length=0:v(!0)}),C=Ei(function(E){J(t.errorComp)&&(t.error=!0,v(!0))}),x=t(b,C);return Fe(x)&&(nr(x)?ve(t.resolved)&&x.then(b,C):nr(x.component)&&(x.component.then(b,C),J(x.error)&&(t.errorComp=$i(x.error,e)),J(x.loading)&&(t.loadingComp=$i(x.loading,e),x.delay===0?t.loading=!0:d=setTimeout(function(){d=null,ve(t.resolved)&&ve(t.error)&&(t.loading=!0,v(!1))},x.delay||200)),J(x.timeout)&&(p=setTimeout(function(){p=null,ve(t.resolved)&&C(null)},x.timeout)))),h=!1,t.loading?t.loadingComp:t.resolved}}function $s(t){if(be(t))for(var e=0;e<t.length;e++){var i=t[e];if(J(i)&&(J(i.componentOptions)||ii(i)))return i}}var Ea=1,Zs=2;function Ri(t,e,i,n,h,d){return(be(i)||oi(i))&&(h=n,n=i,i=void 0),De(d)&&(h=Zs),Oa(t,e,i,n,h)}function Oa(t,e,i,n,h){if(J(i)&&J(i.__ob__)||(J(i)&&J(i.is)&&(e=i.is),!e))return yt();be(n)&&Ae(n[0])&&(i=i||{},i.scopedSlots={default:n[0]},n.length=0),h===Zs?n=kr(n):h===Ea&&(n=sa(n));var d,p;if(typeof e=="string"){var v=void 0;p=t.$vnode&&t.$vnode.ns||Ze.getTagNamespace(e),Ze.isReservedTag(e)?d=new He(Ze.parsePlatformTagName(e),i,n,void 0,void 0,t):(!i||!i.pre)&&J(v=Pi(t.$options,"components",e))?d=yn(v,i,t,n,e):d=new He(e,i,n,void 0,void 0,t)}else d=yn(e,i,t,n);return be(d)?d:J(d)?(J(p)&&qs(d,p),J(i)&&Aa(i),d):yt()}function qs(t,e,i){if(t.ns=e,t.tag==="foreignObject"&&(e=void 0,i=!0),J(t.children))for(var n=0,h=t.children.length;n<h;n++){var d=t.children[n];J(d.tag)&&(ve(d.ns)||De(i)&&d.tag!=="svg")&&qs(d,e,i)}}function Aa(t){Fe(t.style)&&Mi(t.style),Fe(t.class)&&Mi(t.class)}function It(t,e,i){Ut();try{if(e)for(var n=e;n=n.$parent;){var h=n.$options.errorCaptured;if(h)for(var d=0;d<h.length;d++)try{var p=h[d].call(n,t,e,i)===!1;if(p)return}catch(v){dn(v,n,"errorCaptured hook")}}dn(t,e,i)}finally{Vt()}}function ft(t,e,i,n,h){var d;try{d=i?t.apply(e,i):t.call(e),d&&!d._isVue&&nr(d)&&!d._handled&&(d.catch(function(p){return It(p,n,h+" (Promise/async)")}),d._handled=!0)}catch(p){It(p,n,h)}return d}function dn(t,e,i){if(Ze.errorHandler)try{return Ze.errorHandler.call(null,t,e,i)}catch(n){n!==t&&fn(n)}fn(t)}function fn(t,e,i){if(ze&&typeof console<"u")console.error(t);else throw t}var ur=!1,dr=[],fr=!1;function fi(){fr=!1;var t=dr.slice(0);dr.length=0;for(var e=0;e<t.length;e++)t[e]()}var Kt;if(typeof Promise<"u"&&kt(Promise)){var Da=Promise.resolve();Kt=function(){Da.then(fi),$o&&setTimeout(Me)},ur=!0}else if(!Nt&&typeof MutationObserver<"u"&&(kt(MutationObserver)||MutationObserver.toString()==="[object MutationObserverConstructor]")){var gi=1,Ra=new MutationObserver(fi),gn=document.createTextNode(String(gi));Ra.observe(gn,{characterData:!0}),Kt=function(){gi=(gi+1)%2,gn.data=String(gi)},ur=!0}else typeof setImmediate<"u"&&kt(setImmediate)?Kt=function(){setImmediate(fi)}:Kt=function(){setTimeout(fi,0)};function Nr(t,e){var i;if(dr.push(function(){if(t)try{t.call(e)}catch(n){It(n,e,"nextTick")}else i&&i(e)}),fr||(fr=!0,Kt()),!t&&typeof Promise<"u")return new Promise(function(n){i=n})}var Ma="2.7.15",pn=new ti;function Mi(t){return xi(t,pn),pn.clear(),t}function xi(t,e){var i,n,h=be(t);if(!(!h&&!Fe(t)||t.__v_skip||Object.isFrozen(t)||t instanceof He)){if(t.__ob__){var d=t.__ob__.dep.id;if(e.has(d))return;e.add(d)}if(h)for(i=t.length;i--;)xi(t[i],e);else if(Qe(t))xi(t.value,e);else for(n=Object.keys(t),i=n.length;i--;)xi(t[n[i]],e)}}var La=0,jr=function(){function t(e,i,n,h,d){ta(this,Be&&!Be._vm?Be:e?e._scope:void 0),(this.vm=e)&&d&&(e._watcher=this),h?(this.deep=!!h.deep,this.user=!!h.user,this.lazy=!!h.lazy,this.sync=!!h.sync,this.before=h.before):this.deep=this.user=this.lazy=this.sync=!1,this.cb=n,this.id=++La,this.active=!0,this.post=!1,this.dirty=this.lazy,this.deps=[],this.newDeps=[],this.depIds=new ti,this.newDepIds=new ti,this.expression="",Ae(i)?this.getter=i:(this.getter=Yo(i),this.getter||(this.getter=Me)),this.value=this.lazy?void 0:this.get()}return t.prototype.get=function(){Ut(this);var e,i=this.vm;try{e=this.getter.call(i,i)}catch(n){if(this.user)It(n,i,'getter for watcher "'.concat(this.expression,'"'));else throw n}finally{this.deep&&Mi(e),Vt(),this.cleanupDeps()}return e},t.prototype.addDep=function(e){var i=e.id;this.newDepIds.has(i)||(this.newDepIds.add(i),this.newDeps.push(e),this.depIds.has(i)||e.addSub(this))},t.prototype.cleanupDeps=function(){for(var e=this.deps.length;e--;){var i=this.deps[e];this.newDepIds.has(i.id)||i.removeSub(this)}var n=this.depIds;this.depIds=this.newDepIds,this.newDepIds=n,this.newDepIds.clear(),n=this.deps,this.deps=this.newDeps,this.newDeps=n,this.newDeps.length=0},t.prototype.update=function(){this.lazy?this.dirty=!0:this.sync?this.run():Za(this)},t.prototype.run=function(){if(this.active){var e=this.get();if(e!==this.value||Fe(e)||this.deep){var i=this.value;if(this.value=e,this.user){var n='callback for watcher "'.concat(this.expression,'"');ft(this.cb,this.vm,[e,i],this.vm,n)}else this.cb.call(this.vm,e,i)}}},t.prototype.evaluate=function(){this.value=this.get(),this.dirty=!1},t.prototype.depend=function(){for(var e=this.deps.length;e--;)this.deps[e].depend()},t.prototype.teardown=function(){if(this.vm&&!this.vm._isBeingDestroyed&&gt(this.vm._scope.effects,this),this.active){for(var e=this.deps.length;e--;)this.deps[e].removeSub(this);this.active=!1,this.onStop&&this.onStop()}},t}();function Fa(t){t._events=Object.create(null),t._hasHookEvent=!1;var e=t.$options._parentListeners;e&&Ks(t,e)}var ri;function Pa(t,e){ri.$on(t,e)}function ka(t,e){ri.$off(t,e)}function Ba(t,e){var i=ri;return function n(){var h=e.apply(null,arguments);h!==null&&i.$off(t,n)}}function Ks(t,e,i){ri=t,Gs(e,i||{},Pa,ka,Ba,t),ri=void 0}function Na(t){var e=/^hook:/;t.prototype.$on=function(i,n){var h=this;if(be(i))for(var d=0,p=i.length;d<p;d++)h.$on(i[d],n);else(h._events[i]||(h._events[i]=[])).push(n),e.test(i)&&(h._hasHookEvent=!0);return h},t.prototype.$once=function(i,n){var h=this;function d(){h.$off(i,d),n.apply(h,arguments)}return d.fn=n,h.$on(i,d),h},t.prototype.$off=function(i,n){var h=this;if(!arguments.length)return h._events=Object.create(null),h;if(be(i)){for(var d=0,p=i.length;d<p;d++)h.$off(i[d],n);return h}var v=h._events[i];if(!v)return h;if(!n)return h._events[i]=null,h;for(var b,C=v.length;C--;)if(b=v[C],b===n||b.fn===n){v.splice(C,1);break}return h},t.prototype.$emit=function(i){var n=this,h=n._events[i];if(h){h=h.length>1?sr(h):h;for(var d=sr(arguments,1),p='event handler for "'.concat(i,'"'),v=0,b=h.length;v<b;v++)ft(h[v],n,d,n,p)}return n}}var St=null;function Js(t){var e=St;return St=t,function(){St=e}}function ja(t){var e=t.$options,i=e.parent;if(i&&!e.abstract){for(;i.$options.abstract&&i.$parent;)i=i.$parent;i.$children.push(t)}t.$parent=i,t.$root=i?i.$root:t,t.$children=[],t.$refs={},t._provided=i?i._provided:Object.create(null),t._watcher=null,t._inactive=null,t._directInactive=!1,t._isMounted=!1,t._isDestroyed=!1,t._isBeingDestroyed=!1}function Ua(t){t.prototype._update=function(e,i){var n=this,h=n.$el,d=n._vnode,p=Js(n);n._vnode=e,d?n.$el=n.__patch__(d,e):n.$el=n.__patch__(n.$el,e,i,!1),p(),h&&(h.__vue__=null),n.$el&&(n.$el.__vue__=n);for(var v=n;v&&v.$vnode&&v.$parent&&v.$vnode===v.$parent._vnode;)v.$parent.$el=v.$el,v=v.$parent},t.prototype.$forceUpdate=function(){var e=this;e._watcher&&e._watcher.update()},t.prototype.$destroy=function(){var e=this;if(!e._isBeingDestroyed){qe(e,"beforeDestroy"),e._isBeingDestroyed=!0;var i=e.$parent;i&&!i._isBeingDestroyed&&!e.$options.abstract&&gt(i.$children,e),e._scope.stop(),e._data.__ob__&&e._data.__ob__.vmCount--,e._isDestroyed=!0,e.__patch__(e._vnode,null),qe(e,"destroyed"),e.$off(),e.$el&&(e.$el.__vue__=null),e.$vnode&&(e.$vnode.parent=null)}}}function Va(t,e,i){t.$el=e,t.$options.render||(t.$options.render=yt),qe(t,"beforeMount");var n;n=function(){t._update(t._render(),i)};var h={before:function(){t._isMounted&&!t._isDestroyed&&qe(t,"beforeUpdate")}};new jr(t,n,Me,h,!0),i=!1;var d=t._preWatchers;if(d)for(var p=0;p<d.length;p++)d[p].run();return t.$vnode==null&&(t._isMounted=!0,qe(t,"mounted")),t}function Ga(t,e,i,n,h){var d=n.data.scopedSlots,p=t.$scopedSlots,v=!!(d&&!d.$stable||p!==Ve&&!p.$stable||d&&t.$scopedSlots.$key!==d.$key||!d&&t.$scopedSlots.$key),b=!!(h||t.$options._renderChildren||v),C=t.$vnode;t.$options._parentVnode=n,t.$vnode=n,t._vnode&&(t._vnode.parent=n),t.$options._renderChildren=h;var x=n.data.attrs||Ve;t._attrsProxy&&Di(t._attrsProxy,x,C.data&&C.data.attrs||Ve,t,"$attrs")&&(b=!0),t.$attrs=x,i=i||Ve;var E=t.$options._parentListeners;if(t._listenersProxy&&Di(t._listenersProxy,i,E||Ve,t,"$listeners"),t.$listeners=t.$options._parentListeners=i,Ks(t,i,E),e&&t.$options.props){dt(!1);for(var O=t._props,N=t.$options._propKeys||[],k=0;k<N.length;k++){var H=N[k],U=t.$options.props;O[H]=zr(H,U,e,t)}dt(!0),t.$options.propsData=e}b&&(t.$slots=Br(h,n.context),t.$forceUpdate())}function Qs(t){for(;t&&(t=t.$parent);)if(t._inactive)return!0;return!1}function Ur(t,e){if(e){if(t._directInactive=!1,Qs(t))return}else if(t._directInactive)return;if(t._inactive||t._inactive===null){t._inactive=!1;for(var i=0;i<t.$children.length;i++)Ur(t.$children[i]);qe(t,"activated")}}function eo(t,e){if(!(e&&(t._directInactive=!0,Qs(t)))&&!t._inactive){t._inactive=!0;for(var i=0;i<t.$children.length;i++)eo(t.$children[i]);qe(t,"deactivated")}}function qe(t,e,i,n){n===void 0&&(n=!0),Ut();var h=Jt,d=ia();n&&ht(t);var p=t.$options[e],v="".concat(e," hook");if(p)for(var b=0,C=p.length;b<C;b++)ft(p[b],t,i||null,t,v);t._hasHookEvent&&t.$emit("hook:"+e),n&&(ht(h),d&&d.on()),Vt()}var rt=[],Vr=[],Li={},gr=!1,Gr=!1,Ft=0;function Wa(){Ft=rt.length=Vr.length=0,Li={},gr=Gr=!1}var to=0,pr=Date.now;if(ze&&!Nt){var Zi=window.performance;Zi&&typeof Zi.now=="function"&&pr()>document.createEvent("Event").timeStamp&&(pr=function(){return Zi.now()})}var Ha=function(t,e){if(t.post){if(!e.post)return 1}else if(e.post)return-1;return t.id-e.id};function za(){to=pr(),Gr=!0;var t,e;for(rt.sort(Ha),Ft=0;Ft<rt.length;Ft++)t=rt[Ft],t.before&&t.before(),e=t.id,Li[e]=null,t.run();var i=Vr.slice(),n=rt.slice();Wa(),$a(i),Ya(n),qo(),Oi&&Ze.devtools&&Oi.emit("flush")}function Ya(t){for(var e=t.length;e--;){var i=t[e],n=i.vm;n&&n._watcher===i&&n._isMounted&&!n._isDestroyed&&qe(n,"updated")}}function Xa(t){t._inactive=!1,Vr.push(t)}function $a(t){for(var e=0;e<t.length;e++)t[e]._inactive=!0,Ur(t[e],!0)}function Za(t){var e=t.id;if(Li[e]==null&&!(t===ut.target&&t.noRecurse)){if(Li[e]=!0,!Gr)rt.push(t);else{for(var i=rt.length-1;i>Ft&&rt[i].id>t.id;)i--;rt.splice(i+1,0,t)}gr||(gr=!0,Nr(za))}}function qa(t){var e=t.$options.provide;if(e){var i=Ae(e)?e.call(t):e;if(!Fe(i))return;for(var n=ra(t),h=ci?Reflect.ownKeys(i):Object.keys(i),d=0;d<h.length;d++){var p=h[d];Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(i,p))}}}function Ka(t){var e=io(t.$options.inject,t);e&&(dt(!1),Object.keys(e).forEach(function(i){Tt(t,i,e[i])}),dt(!0))}function io(t,e){if(t){for(var i=Object.create(null),n=ci?Reflect.ownKeys(t):Object.keys(t),h=0;h<n.length;h++){var d=n[h];if(d!=="__ob__"){var p=t[d].from;if(p in e._provided)i[d]=e._provided[p];else if("default"in t[d]){var v=t[d].default;i[d]=Ae(v)?v.call(e):v}}}return i}}function Wr(t,e,i,n,h){var d=this,p=h.options,v;ke(n,"_uid")?(v=Object.create(n),v._original=n):(v=n,n=n._original);var b=De(p._compiled),C=!b;this.data=t,this.props=e,this.children=i,this.parent=n,this.listeners=t.on||Ve,this.injections=io(p.inject,n),this.slots=function(){return d.$slots||Qt(n,t.scopedSlots,d.$slots=Br(i,n)),d.$slots},Object.defineProperty(this,"scopedSlots",{enumerable:!0,get:function(){return Qt(n,t.scopedSlots,this.slots())}}),b&&(this.$options=p,this.$slots=this.slots(),this.$scopedSlots=Qt(n,t.scopedSlots,this.$slots)),p._scopeId?this._c=function(x,E,O,N){var k=Ri(v,x,E,O,N,C);return k&&!be(k)&&(k.fnScopeId=p._scopeId,k.fnContext=n),k}:this._c=function(x,E,O,N){return Ri(v,x,E,O,N,C)}}Ys(Wr.prototype);function Ja(t,e,i,n,h){var d=t.options,p={},v=d.props;if(J(v))for(var b in v)p[b]=zr(b,v,e||Ve);else J(i.attrs)&&mn(p,i.attrs),J(i.props)&&mn(p,i.props);var C=new Wr(i,p,h,n,t),x=d.render.call(null,C._c,C);if(x instanceof He)return _n(x,i,C.parent,d);if(be(x)){for(var E=kr(x)||[],O=new Array(E.length),N=0;N<E.length;N++)O[N]=_n(E[N],i,C.parent,d);return O}}function _n(t,e,i,n,h){var d=ar(t);return d.fnContext=i,d.fnOptions=n,e.slot&&((d.data||(d.data={})).slot=e.slot),d}function mn(t,e){for(var i in e)t[wt(i)]=e[i]}function Fi(t){return t.name||t.__name||t._componentTag}var Hr={init:function(t,e){if(t.componentInstance&&!t.componentInstance._isDestroyed&&t.data.keepAlive){var i=t;Hr.prepatch(i,i)}else{var n=t.componentInstance=Qa(t,St);n.$mount(e?t.elm:void 0,e)}},prepatch:function(t,e){var i=e.componentOptions,n=e.componentInstance=t.componentInstance;Ga(n,i.propsData,i.listeners,e,i.children)},insert:function(t){var e=t.context,i=t.componentInstance;i._isMounted||(i._isMounted=!0,qe(i,"mounted")),t.data.keepAlive&&(e._isMounted?Xa(i):Ur(i,!0))},destroy:function(t){var e=t.componentInstance;e._isDestroyed||(t.data.keepAlive?eo(e,!0):e.$destroy())}},vn=Object.keys(Hr);function yn(t,e,i,n,h){if(!ve(t)){var d=i.$options._base;if(Fe(t)&&(t=d.extend(t)),typeof t=="function"){var p;if(ve(t.cid)&&(p=t,t=Ia(p,d),t===void 0))return Ta(p,e,i,n,h);e=e||{},Xr(t),J(e.model)&&il(t.options,e);var v=na(e,t);if(De(t.options.functional))return Ja(t,v,e,i,n);var b=e.on;if(e.on=e.nativeOn,De(t.options.abstract)){var C=e.slot;e={},C&&(e.slot=C)}el(e);var x=Fi(t.options)||h,E=new He("vue-component-".concat(t.cid).concat(x?"-".concat(x):""),e,void 0,void 0,void 0,i,{Ctor:t,propsData:v,listeners:b,tag:h,children:n},p);return E}}}function Qa(t,e){var i={_isComponent:!0,_parentVnode:t,parent:e},n=t.data.inlineTemplate;return J(n)&&(i.render=n.render,i.staticRenderFns=n.staticRenderFns),new t.componentOptions.Ctor(i)}function el(t){for(var e=t.hook||(t.hook={}),i=0;i<vn.length;i++){var n=vn[i],h=e[n],d=Hr[n];h!==d&&!(h&&h._merged)&&(e[n]=h?tl(d,h):d)}}function tl(t,e){var i=function(n,h){t(n,h),e(n,h)};return i._merged=!0,i}function il(t,e){var i=t.model&&t.model.prop||"value",n=t.model&&t.model.event||"input";(e.attrs||(e.attrs={}))[i]=e.model.value;var h=e.on||(e.on={}),d=h[n],p=e.model.callback;J(d)?(be(d)?d.indexOf(p)===-1:d!==p)&&(h[n]=[p].concat(d)):h[n]=p}var rl=Me,Je=Ze.optionMergeStrategies;function ni(t,e,i){if(i===void 0&&(i=!0),!e)return t;for(var n,h,d,p=ci?Reflect.ownKeys(e):Object.keys(e),v=0;v<p.length;v++)n=p[v],n!=="__ob__"&&(h=t[n],d=e[n],!i||!ke(t,n)?Fr(t,n,d):h!==d&&We(h)&&We(d)&&ni(h,d));return t}function Sn(t,e,i){return i?function(){var h=Ae(e)?e.call(i,i):e,d=Ae(t)?t.call(i,i):t;return h?ni(h,d):d}:e?t?function(){return ni(Ae(e)?e.call(this,this):e,Ae(t)?t.call(this,this):t)}:e:t}Je.data=function(t,e,i){return i?Sn(t,e,i):e&&typeof e!="function"?t:Sn(t,e)};function nl(t,e){var i=e?t?t.concat(e):be(e)?e:[e]:t;return i&&sl(i)}function sl(t){for(var e=[],i=0;i<t.length;i++)e.indexOf(t[i])===-1&&e.push(t[i]);return e}Fs.forEach(function(t){Je[t]=nl});function ol(t,e,i,n){var h=Object.create(t||null);return e?Te(h,e):h}Hi.forEach(function(t){Je[t+"s"]=ol});Je.watch=function(t,e,i,n){if(t===or&&(t=void 0),e===or&&(e=void 0),!e)return Object.create(t||null);if(!t)return e;var h={};Te(h,t);for(var d in e){var p=h[d],v=e[d];p&&!be(p)&&(p=[p]),h[d]=p?p.concat(v):be(v)?v:[v]}return h};Je.props=Je.methods=Je.inject=Je.computed=function(t,e,i,n){if(!t)return e;var h=Object.create(null);return Te(h,t),e&&Te(h,e),h};Je.provide=function(t,e){return t?function(){var i=Object.create(null);return ni(i,Ae(t)?t.call(this):t),e&&ni(i,Ae(e)?e.call(this):e,!1),i}:e};var al=function(t,e){return e===void 0?t:e};function ll(t,e){var i=t.props;if(!!i){var n={},h,d,p;if(be(i))for(h=i.length;h--;)d=i[h],typeof d=="string"&&(p=wt(d),n[p]={type:null});else if(We(i))for(var v in i)d=i[v],p=wt(v),n[p]=We(d)?d:{type:d};t.props=n}}function cl(t,e){var i=t.inject;if(!!i){var n=t.inject={};if(be(i))for(var h=0;h<i.length;h++)n[i[h]]={from:i[h]};else if(We(i))for(var d in i){var p=i[d];n[d]=We(p)?Te({from:d},p):{from:p}}}}function hl(t){var e=t.directives;if(e)for(var i in e){var n=e[i];Ae(n)&&(e[i]={bind:n,update:n})}}function Et(t,e,i){if(Ae(e)&&(e=e.options),ll(e),cl(e),hl(e),!e._base&&(e.extends&&(t=Et(t,e.extends,i)),e.mixins))for(var n=0,h=e.mixins.length;n<h;n++)t=Et(t,e.mixins[n],i);var d={},p;for(p in t)v(p);for(p in e)ke(t,p)||v(p);function v(b){var C=Je[b]||al;d[b]=C(t[b],e[b],i,b)}return d}function Pi(t,e,i,n){if(typeof i=="string"){var h=t[e];if(ke(h,i))return h[i];var d=wt(i);if(ke(h,d))return h[d];var p=jo(d);if(ke(h,p))return h[p];var v=h[i]||h[d]||h[p];return v}}function zr(t,e,i,n){var h=e[t],d=!ke(i,t),p=i[t],v=Cn(Boolean,h.type);if(v>-1){if(d&&!ke(h,"default"))p=!1;else if(p===""||p===ai(t)){var b=Cn(String,h.type);(b<0||v<b)&&(p=!0)}}if(p===void 0){p=ul(n,h,t);var C=Lr;dt(!0),st(p),dt(C)}return p}function ul(t,e,i){if(!!ke(e,"default")){var n=e.default;return t&&t.$options.propsData&&t.$options.propsData[i]===void 0&&t._props[i]!==void 0?t._props[i]:Ae(n)&&_r(e.type)!=="Function"?n.call(t):n}}var dl=/^\s*function (\w+)/;function _r(t){var e=t&&t.toString().match(dl);return e?e[1]:""}function bn(t,e){return _r(t)===_r(e)}function Cn(t,e){if(!be(e))return bn(e,t)?0:-1;for(var i=0,n=e.length;i<n;i++)if(bn(e[i],t))return i;return-1}var ot={enumerable:!0,configurable:!0,get:Me,set:Me};function Yr(t,e,i){ot.get=function(){return this[e][i]},ot.set=function(h){this[e][i]=h},Object.defineProperty(t,i,ot)}function fl(t){var e=t.$options;if(e.props&&gl(t,e.props),ya(t),e.methods&&yl(t,e.methods),e.data)pl(t);else{var i=st(t._data={});i&&i.vmCount++}e.computed&&vl(t,e.computed),e.watch&&e.watch!==or&&Sl(t,e.watch)}function gl(t,e){var i=t.$options.propsData||{},n=t._props=Vs({}),h=t.$options._propKeys=[],d=!t.$parent;d||dt(!1);var p=function(b){h.push(b);var C=zr(b,e,i,t);Tt(n,b,C),b in t||Yr(t,"_props",b)};for(var v in e)p(v);dt(!0)}function pl(t){var e=t.$options.data;e=t._data=Ae(e)?_l(e,t):e||{},We(e)||(e={});var i=Object.keys(e),n=t.$options.props;t.$options.methods;for(var h=i.length;h--;){var d=i[h];n&&ke(n,d)||Ps(d)||Yr(t,"_data",d)}var p=st(e);p&&p.vmCount++}function _l(t,e){Ut();try{return t.call(e,e)}catch(i){return It(i,e,"data()"),{}}finally{Vt()}}var ml={lazy:!0};function vl(t,e){var i=t._computedWatchers=Object.create(null),n=li();for(var h in e){var d=e[h],p=Ae(d)?d:d.get;n||(i[h]=new jr(t,p||Me,Me,ml)),h in t||ro(t,h,d)}}function ro(t,e,i){var n=!li();Ae(i)?(ot.get=n?wn(e):xn(i),ot.set=Me):(ot.get=i.get?n&&i.cache!==!1?wn(e):xn(i.get):Me,ot.set=i.set||Me),Object.defineProperty(t,e,ot)}function wn(t){return function(){var i=this._computedWatchers&&this._computedWatchers[t];if(i)return i.dirty&&i.evaluate(),ut.target&&i.depend(),i.value}}function xn(t){return function(){return t.call(this,this)}}function yl(t,e){t.$options.props;for(var i in e)t[i]=typeof e[i]!="function"?Me:Ds(e[i],t)}function Sl(t,e){for(var i in e){var n=e[i];if(be(n))for(var h=0;h<n.length;h++)mr(t,i,n[h]);else mr(t,i,n)}}function mr(t,e,i,n){return We(i)&&(n=i,i=i.handler),typeof i=="string"&&(i=t[i]),t.$watch(e,i,n)}function bl(t){var e={};e.get=function(){return this._data};var i={};i.get=function(){return this._props},Object.defineProperty(t.prototype,"$data",e),Object.defineProperty(t.prototype,"$props",i),t.prototype.$set=Fr,t.prototype.$delete=js,t.prototype.$watch=function(n,h,d){var p=this;if(We(h))return mr(p,n,h,d);d=d||{},d.user=!0;var v=new jr(p,n,h,d);if(d.immediate){var b='callback for immediate watcher "'.concat(v.expression,'"');Ut(),ft(h,p,[v.value],p,b),Vt()}return function(){v.teardown()}}}var Cl=0;function wl(t){t.prototype._init=function(e){var i=this;i._uid=Cl++,i._isVue=!0,i.__v_skip=!0,i._scope=new ea(!0),i._scope._vm=!0,e&&e._isComponent?xl(i,e):i.$options=Et(Xr(i.constructor),e||{},i),i._renderProxy=i,i._self=i,ja(i),Fa(i),wa(i),qe(i,"beforeCreate",void 0,!1),Ka(i),fl(i),qa(i),qe(i,"created"),i.$options.el&&i.$mount(i.$options.el)}}function xl(t,e){var i=t.$options=Object.create(t.constructor.options),n=e._parentVnode;i.parent=e.parent,i._parentVnode=n;var h=n.componentOptions;i.propsData=h.propsData,i._parentListeners=h.listeners,i._renderChildren=h.children,i._componentTag=h.tag,e.render&&(i.render=e.render,i.staticRenderFns=e.staticRenderFns)}function Xr(t){var e=t.options;if(t.super){var i=Xr(t.super),n=t.superOptions;if(i!==n){t.superOptions=i;var h=Tl(t);h&&Te(t.extendOptions,h),e=t.options=Et(i,t.extendOptions),e.name&&(e.components[e.name]=t)}}return e}function Tl(t){var e,i=t.options,n=t.sealedOptions;for(var h in i)i[h]!==n[h]&&(e||(e={}),e[h]=i[h]);return e}function Re(t){this._init(t)}wl(Re);bl(Re);Na(Re);Ua(Re);xa(Re);function Il(t){t.use=function(e){var i=this._installedPlugins||(this._installedPlugins=[]);if(i.indexOf(e)>-1)return this;var n=sr(arguments,1);return n.unshift(this),Ae(e.install)?e.install.apply(e,n):Ae(e)&&e.apply(null,n),i.push(e),this}}function El(t){t.mixin=function(e){return this.options=Et(this.options,e),this}}function Ol(t){t.cid=0;var e=1;t.extend=function(i){i=i||{};var n=this,h=n.cid,d=i._Ctor||(i._Ctor={});if(d[h])return d[h];var p=Fi(i)||Fi(n.options),v=function(C){this._init(C)};return v.prototype=Object.create(n.prototype),v.prototype.constructor=v,v.cid=e++,v.options=Et(n.options,i),v.super=n,v.options.props&&Al(v),v.options.computed&&Dl(v),v.extend=n.extend,v.mixin=n.mixin,v.use=n.use,Hi.forEach(function(b){v[b]=n[b]}),p&&(v.options.components[p]=v),v.superOptions=n.options,v.extendOptions=i,v.sealedOptions=Te({},v.options),d[h]=v,v}}function Al(t){var e=t.options.props;for(var i in e)Yr(t.prototype,"_props",i)}function Dl(t){var e=t.options.computed;for(var i in e)ro(t.prototype,i,e[i])}function Rl(t){Hi.forEach(function(e){t[e]=function(i,n){return n?(e==="component"&&We(n)&&(n.name=n.name||i,n=this.options._base.extend(n)),e==="directive"&&Ae(n)&&(n={bind:n,update:n}),this.options[e+"s"][i]=n,n):this.options[e+"s"][i]}})}function Tn(t){return t&&(Fi(t.Ctor.options)||t.tag)}function pi(t,e){return be(t)?t.indexOf(e)>-1:typeof t=="string"?t.split(",").indexOf(e)>-1:Fo(t)?t.test(e):!1}function In(t,e){var i=t.cache,n=t.keys,h=t._vnode;for(var d in i){var p=i[d];if(p){var v=p.name;v&&!e(v)&&vr(i,d,n,h)}}}function vr(t,e,i,n){var h=t[e];h&&(!n||h.tag!==n.tag)&&h.componentInstance.$destroy(),t[e]=null,gt(i,e)}var En=[String,RegExp,Array],Ml={name:"keep-alive",abstract:!0,props:{include:En,exclude:En,max:[String,Number]},methods:{cacheVNode:function(){var t=this,e=t.cache,i=t.keys,n=t.vnodeToCache,h=t.keyToCache;if(n){var d=n.tag,p=n.componentInstance,v=n.componentOptions;e[h]={name:Tn(v),tag:d,componentInstance:p},i.push(h),this.max&&i.length>parseInt(this.max)&&vr(e,i[0],i,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var t in this.cache)vr(this.cache,t,this.keys)},mounted:function(){var t=this;this.cacheVNode(),this.$watch("include",function(e){In(t,function(i){return pi(e,i)})}),this.$watch("exclude",function(e){In(t,function(i){return!pi(e,i)})})},updated:function(){this.cacheVNode()},render:function(){var t=this.$slots.default,e=$s(t),i=e&&e.componentOptions;if(i){var n=Tn(i),h=this,d=h.include,p=h.exclude;if(d&&(!n||!pi(d,n))||p&&n&&pi(p,n))return e;var v=this,b=v.cache,C=v.keys,x=e.key==null?i.Ctor.cid+(i.tag?"::".concat(i.tag):""):e.key;b[x]?(e.componentInstance=b[x].componentInstance,gt(C,x),C.push(x)):(this.vnodeToCache=e,this.keyToCache=x),e.data.keepAlive=!0}return e||t&&t[0]}},Ll={KeepAlive:Ml};function Fl(t){var e={};e.get=function(){return Ze},Object.defineProperty(t,"config",e),t.util={warn:rl,extend:Te,mergeOptions:Et,defineReactive:Tt},t.set=Fr,t.delete=js,t.nextTick=Nr,t.observable=function(i){return st(i),i},t.options=Object.create(null),Hi.forEach(function(i){t.options[i+"s"]=Object.create(null)}),t.options._base=t,Te(t.options.components,Ll),Il(t),El(t),Ol(t),Rl(t)}Fl(Re);Object.defineProperty(Re.prototype,"$isServer",{get:li});Object.defineProperty(Re.prototype,"$ssrContext",{get:function(){return this.$vnode&&this.$vnode.ssrContext}});Object.defineProperty(Re,"FunctionalRenderContext",{value:Wr});Re.version=Ma;var Pl=Ke("style,class"),kl=Ke("input,textarea,option,select,progress"),Bl=function(t,e,i){return i==="value"&&kl(t)&&e!=="button"||i==="selected"&&t==="option"||i==="checked"&&t==="input"||i==="muted"&&t==="video"},no=Ke("contenteditable,draggable,spellcheck"),Nl=Ke("events,caret,typing,plaintext-only"),jl=function(t,e){return ki(e)||e==="false"?"false":t==="contenteditable"&&Nl(e)?e:"true"},Ul=Ke("allowfullscreen,async,autofocus,autoplay,checked,compact,controls,declare,default,defaultchecked,defaultmuted,defaultselected,defer,disabled,enabled,formnovalidate,hidden,indeterminate,inert,ismap,itemscope,loop,multiple,muted,nohref,noresize,noshade,novalidate,nowrap,open,pauseonexit,readonly,required,reversed,scoped,seamless,selected,sortable,truespeed,typemustmatch,visible"),yr="http://www.w3.org/1999/xlink",$r=function(t){return t.charAt(5)===":"&&t.slice(0,5)==="xlink"},so=function(t){return $r(t)?t.slice(6,t.length):""},ki=function(t){return t==null||t===!1};function Vl(t){for(var e=t.data,i=t,n=t;J(n.componentInstance);)n=n.componentInstance._vnode,n&&n.data&&(e=On(n.data,e));for(;J(i=i.parent);)i&&i.data&&(e=On(e,i.data));return Gl(e.staticClass,e.class)}function On(t,e){return{staticClass:Zr(t.staticClass,e.staticClass),class:J(t.class)?[t.class,e.class]:e.class}}function Gl(t,e){return J(t)||J(e)?Zr(t,qr(e)):""}function Zr(t,e){return t?e?t+" "+e:t:e||""}function qr(t){return Array.isArray(t)?Wl(t):Fe(t)?Hl(t):typeof t=="string"?t:""}function Wl(t){for(var e="",i,n=0,h=t.length;n<h;n++)J(i=qr(t[n]))&&i!==""&&(e&&(e+=" "),e+=i);return e}function Hl(t){var e="";for(var i in t)t[i]&&(e&&(e+=" "),e+=i);return e}var zl={svg:"http://www.w3.org/2000/svg",math:"http://www.w3.org/1998/Math/MathML"},Yl=Ke("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,menuitem,summary,content,element,shadow,template,blockquote,iframe,tfoot"),Kr=Ke("svg,animate,circle,clippath,cursor,defs,desc,ellipse,filter,font-face,foreignobject,g,glyph,image,line,marker,mask,missing-glyph,path,pattern,polygon,polyline,rect,switch,symbol,text,textpath,tspan,use,view",!0),oo=function(t){return Yl(t)||Kr(t)};function Xl(t){if(Kr(t))return"svg";if(t==="math")return"math"}var _i=Object.create(null);function $l(t){if(!ze)return!0;if(oo(t))return!1;if(t=t.toLowerCase(),_i[t]!=null)return _i[t];var e=document.createElement(t);return t.indexOf("-")>-1?_i[t]=e.constructor===window.HTMLUnknownElement||e.constructor===window.HTMLElement:_i[t]=/HTMLUnknownElement/.test(e.toString())}var Sr=Ke("text,number,password,search,email,tel,url");function Zl(t){if(typeof t=="string"){var e=document.querySelector(t);return e||document.createElement("div")}else return t}function ql(t,e){var i=document.createElement(t);return t!=="select"||e.data&&e.data.attrs&&e.data.attrs.multiple!==void 0&&i.setAttribute("multiple","multiple"),i}function Kl(t,e){return document.createElementNS(zl[t],e)}function Jl(t){return document.createTextNode(t)}function Ql(t){return document.createComment(t)}function ec(t,e,i){t.insertBefore(e,i)}function tc(t,e){t.removeChild(e)}function ic(t,e){t.appendChild(e)}function rc(t){return t.parentNode}function nc(t){return t.nextSibling}function sc(t){return t.tagName}function oc(t,e){t.textContent=e}function ac(t,e){t.setAttribute(e,"")}var lc=Object.freeze({__proto__:null,createElement:ql,createElementNS:Kl,createTextNode:Jl,createComment:Ql,insertBefore:ec,removeChild:tc,appendChild:ic,parentNode:rc,nextSibling:nc,tagName:sc,setTextContent:oc,setStyleScope:ac}),cc={create:function(t,e){Pt(e)},update:function(t,e){t.data.ref!==e.data.ref&&(Pt(t,!0),Pt(e))},destroy:function(t){Pt(t,!0)}};function Pt(t,e){var i=t.data.ref;if(!!J(i)){var n=t.context,h=t.componentInstance||t.elm,d=e?null:h,p=e?void 0:h;if(Ae(i)){ft(i,n,[d],n,"template ref function");return}var v=t.data.refInFor,b=typeof i=="string"||typeof i=="number",C=Qe(i),x=n.$refs;if(b||C){if(v){var E=b?x[i]:i.value;e?be(E)&&gt(E,h):be(E)?E.includes(h)||E.push(h):b?(x[i]=[h],An(n,i,x[i])):i.value=[h]}else if(b){if(e&&x[i]!==h)return;x[i]=p,An(n,i,d)}else if(C){if(e&&i.value!==h)return;i.value=d}}}}function An(t,e,i){var n=t._setupState;n&&ke(n,e)&&(Qe(n[e])?n[e].value=i:n[e]=i)}var lt=new He("",{},[]),Yt=["create","activate","update","remove","destroy"];function mt(t,e){return t.key===e.key&&t.asyncFactory===e.asyncFactory&&(t.tag===e.tag&&t.isComment===e.isComment&&J(t.data)===J(e.data)&&hc(t,e)||De(t.isAsyncPlaceholder)&&ve(e.asyncFactory.error))}function hc(t,e){if(t.tag!=="input")return!0;var i,n=J(i=t.data)&&J(i=i.attrs)&&i.type,h=J(i=e.data)&&J(i=i.attrs)&&i.type;return n===h||Sr(n)&&Sr(h)}function uc(t,e,i){var n,h,d={};for(n=e;n<=i;++n)h=t[n].key,J(h)&&(d[h]=n);return d}function dc(t){var e,i,n={},h=t.modules,d=t.nodeOps;for(e=0;e<Yt.length;++e)for(n[Yt[e]]=[],i=0;i<h.length;++i)J(h[i][Yt[e]])&&n[Yt[e]].push(h[i][Yt[e]]);function p(a){return new He(d.tagName(a).toLowerCase(),{},[],void 0,a)}function v(a,s){function l(){--l.listeners===0&&b(a)}return l.listeners=s,l}function b(a){var s=d.parentNode(a);J(s)&&d.removeChild(s,a)}function C(a,s,l,u,r,o,c){if(J(a.elm)&&J(o)&&(a=o[c]=ar(a)),a.isRootInsert=!r,!x(a,s,l,u)){var _=a.data,f=a.children,g=a.tag;J(g)?(a.elm=a.ns?d.createElementNS(a.ns,g):d.createElement(g,a),ee(a),k(a,f,s),J(_)&&U(a,s),N(l,a.elm,u)):De(a.isComment)?(a.elm=d.createComment(a.text),N(l,a.elm,u)):(a.elm=d.createTextNode(a.text),N(l,a.elm,u))}}function x(a,s,l,u){var r=a.data;if(J(r)){var o=J(a.componentInstance)&&r.keepAlive;if(J(r=r.hook)&&J(r=r.init)&&r(a,!1),J(a.componentInstance))return E(a,s),N(l,a.elm,u),De(o)&&O(a,s,l,u),!0}}function E(a,s){J(a.data.pendingInsert)&&(s.push.apply(s,a.data.pendingInsert),a.data.pendingInsert=null),a.elm=a.componentInstance.$el,H(a)?(U(a,s),ee(a)):(Pt(a),s.push(a))}function O(a,s,l,u){for(var r,o=a;o.componentInstance;)if(o=o.componentInstance._vnode,J(r=o.data)&&J(r=r.transition)){for(r=0;r<n.activate.length;++r)n.activate[r](lt,o);s.push(o);break}N(l,a.elm,u)}function N(a,s,l){J(a)&&(J(l)?d.parentNode(l)===a&&d.insertBefore(a,s,l):d.appendChild(a,s))}function k(a,s,l){if(be(s))for(var u=0;u<s.length;++u)C(s[u],l,a.elm,null,!0,s,u);else oi(a.text)&&d.appendChild(a.elm,d.createTextNode(String(a.text)))}function H(a){for(;a.componentInstance;)a=a.componentInstance._vnode;return J(a.tag)}function U(a,s){for(var l=0;l<n.create.length;++l)n.create[l](lt,a);e=a.data.hook,J(e)&&(J(e.create)&&e.create(lt,a),J(e.insert)&&s.push(a))}function ee(a){var s;if(J(s=a.fnScopeId))d.setStyleScope(a.elm,s);else for(var l=a;l;)J(s=l.context)&&J(s=s.$options._scopeId)&&d.setStyleScope(a.elm,s),l=l.parent;J(s=St)&&s!==a.context&&s!==a.fnContext&&J(s=s.$options._scopeId)&&d.setStyleScope(a.elm,s)}function Y(a,s,l,u,r,o){for(;u<=r;++u)C(l[u],o,a,s,!1,l,u)}function G(a){var s,l,u=a.data;if(J(u))for(J(s=u.hook)&&J(s=s.destroy)&&s(a),s=0;s<n.destroy.length;++s)n.destroy[s](a);if(J(s=a.children))for(l=0;l<a.children.length;++l)G(a.children[l])}function re(a,s,l){for(;s<=l;++s){var u=a[s];J(u)&&(J(u.tag)?(de(u),G(u)):b(u.elm))}}function de(a,s){if(J(s)||J(a.data)){var l,u=n.remove.length+1;for(J(s)?s.listeners+=u:s=v(a.elm,u),J(l=a.componentInstance)&&J(l=l._vnode)&&J(l.data)&&de(l,s),l=0;l<n.remove.length;++l)n.remove[l](a,s);J(l=a.data.hook)&&J(l=l.remove)?l(a,s):s()}else b(a.elm)}function fe(a,s,l,u,r){for(var o=0,c=0,_=s.length-1,f=s[0],g=s[_],m=l.length-1,S=l[0],w=l[m],I,T,A,D,P=!r;o<=_&&c<=m;)ve(f)?f=s[++o]:ve(g)?g=s[--_]:mt(f,S)?(y(f,S,u,l,c),f=s[++o],S=l[++c]):mt(g,w)?(y(g,w,u,l,m),g=s[--_],w=l[--m]):mt(f,w)?(y(f,w,u,l,m),P&&d.insertBefore(a,f.elm,d.nextSibling(g.elm)),f=s[++o],w=l[--m]):mt(g,S)?(y(g,S,u,l,c),P&&d.insertBefore(a,g.elm,f.elm),g=s[--_],S=l[++c]):(ve(I)&&(I=uc(s,o,_)),T=J(S.key)?I[S.key]:_e(S,s,o,_),ve(T)?C(S,u,a,f.elm,!1,l,c):(A=s[T],mt(A,S)?(y(A,S,u,l,c),s[T]=void 0,P&&d.insertBefore(a,A.elm,f.elm)):C(S,u,a,f.elm,!1,l,c)),S=l[++c]);o>_?(D=ve(l[m+1])?null:l[m+1].elm,Y(a,D,l,c,m,u)):c>m&&re(s,o,_)}function _e(a,s,l,u){for(var r=l;r<u;r++){var o=s[r];if(J(o)&&mt(a,o))return r}}function y(a,s,l,u,r,o){if(a!==s){J(s.elm)&&J(u)&&(s=u[r]=ar(s));var c=s.elm=a.elm;if(De(a.isAsyncPlaceholder)){J(s.asyncFactory.resolved)?we(a.elm,s,l):s.isAsyncPlaceholder=!0;return}if(De(s.isStatic)&&De(a.isStatic)&&s.key===a.key&&(De(s.isCloned)||De(s.isOnce))){s.componentInstance=a.componentInstance;return}var _,f=s.data;J(f)&&J(_=f.hook)&&J(_=_.prepatch)&&_(a,s);var g=a.children,m=s.children;if(J(f)&&H(s)){for(_=0;_<n.update.length;++_)n.update[_](a,s);J(_=f.hook)&&J(_=_.update)&&_(a,s)}ve(s.text)?J(g)&&J(m)?g!==m&&fe(c,g,m,l,o):J(m)?(J(a.text)&&d.setTextContent(c,""),Y(c,null,m,0,m.length-1,l)):J(g)?re(g,0,g.length-1):J(a.text)&&d.setTextContent(c,""):a.text!==s.text&&d.setTextContent(c,s.text),J(f)&&J(_=f.hook)&&J(_=_.postpatch)&&_(a,s)}}function ge(a,s,l){if(De(l)&&J(a.parent))a.parent.data.pendingInsert=s;else for(var u=0;u<s.length;++u)s[u].data.hook.insert(s[u])}var me=Ke("attrs,class,staticClass,staticStyle,key");function we(a,s,l,u){var r,o=s.tag,c=s.data,_=s.children;if(u=u||c&&c.pre,s.elm=a,De(s.isComment)&&J(s.asyncFactory))return s.isAsyncPlaceholder=!0,!0;if(J(c)&&(J(r=c.hook)&&J(r=r.init)&&r(s,!0),J(r=s.componentInstance)))return E(s,l),!0;if(J(o)){if(J(_))if(!a.hasChildNodes())k(s,_,l);else if(J(r=c)&&J(r=r.domProps)&&J(r=r.innerHTML)){if(r!==a.innerHTML)return!1}else{for(var f=!0,g=a.firstChild,m=0;m<_.length;m++){if(!g||!we(g,_[m],l,u)){f=!1;break}g=g.nextSibling}if(!f||g)return!1}if(J(c)){var S=!1;for(var w in c)if(!me(w)){S=!0,U(s,l);break}!S&&c.class&&Mi(c.class)}}else a.data!==s.text&&(a.data=s.text);return!0}return function(s,l,u,r){if(ve(l)){J(s)&&G(s);return}var o=!1,c=[];if(ve(s))o=!0,C(l,c);else{var _=J(s.nodeType);if(!_&&mt(s,l))y(s,l,c,null,null,r);else{if(_){if(s.nodeType===1&&s.hasAttribute(rn)&&(s.removeAttribute(rn),u=!0),De(u)&&we(s,l,c))return ge(l,c,!0),s;s=p(s)}var f=s.elm,g=d.parentNode(f);if(C(l,c,f._leaveCb?null:g,d.nextSibling(f)),J(l.parent))for(var m=l.parent,S=H(l);m;){for(var w=0;w<n.destroy.length;++w)n.destroy[w](m);if(m.elm=l.elm,S){for(var I=0;I<n.create.length;++I)n.create[I](lt,m);var T=m.data.hook.insert;if(T.merged)for(var A=T.fns.slice(1),D=0;D<A.length;D++)A[D]()}else Pt(m);m=m.parent}J(g)?re([s],0,0):J(s.tag)&&G(s)}}return ge(l,c,o),l.elm}}var fc={create:qi,update:qi,destroy:function(e){qi(e,lt)}};function qi(t,e){(t.data.directives||e.data.directives)&&gc(t,e)}function gc(t,e){var i=t===lt,n=e===lt,h=Dn(t.data.directives,t.context),d=Dn(e.data.directives,e.context),p=[],v=[],b,C,x;for(b in d)C=h[b],x=d[b],C?(x.oldValue=C.value,x.oldArg=C.arg,Xt(x,"update",e,t),x.def&&x.def.componentUpdated&&v.push(x)):(Xt(x,"bind",e,t),x.def&&x.def.inserted&&p.push(x));if(p.length){var E=function(){for(var O=0;O<p.length;O++)Xt(p[O],"inserted",e,t)};i?at(e,"insert",E):E()}if(v.length&&at(e,"postpatch",function(){for(var O=0;O<v.length;O++)Xt(v[O],"componentUpdated",e,t)}),!i)for(b in h)d[b]||Xt(h[b],"unbind",t,t,n)}var pc=Object.create(null);function Dn(t,e){var i=Object.create(null);if(!t)return i;var n,h;for(n=0;n<t.length;n++){if(h=t[n],h.modifiers||(h.modifiers=pc),i[_c(h)]=h,e._setupState&&e._setupState.__sfc){var d=h.def||Pi(e,"_setupState","v-"+h.name);typeof d=="function"?h.def={bind:d,update:d}:h.def=d}h.def=h.def||Pi(e.$options,"directives",h.name)}return i}function _c(t){return t.rawName||"".concat(t.name,".").concat(Object.keys(t.modifiers||{}).join("."))}function Xt(t,e,i,n,h){var d=t.def&&t.def[e];if(d)try{d(i.elm,t,i,n,h)}catch(p){It(p,i.context,"directive ".concat(t.name," ").concat(e," hook"))}}var mc=[cc,fc];function Rn(t,e){var i=e.componentOptions;if(!(J(i)&&i.Ctor.options.inheritAttrs===!1)&&!(ve(t.data.attrs)&&ve(e.data.attrs))){var n,h,d,p=e.elm,v=t.data.attrs||{},b=e.data.attrs||{};(J(b.__ob__)||De(b._v_attr_proxy))&&(b=e.data.attrs=Te({},b));for(n in b)h=b[n],d=v[n],d!==h&&Mn(p,n,h,e.data.pre);(Nt||Mr)&&b.value!==v.value&&Mn(p,"value",b.value);for(n in v)ve(b[n])&&($r(n)?p.removeAttributeNS(yr,so(n)):no(n)||p.removeAttribute(n))}}function Mn(t,e,i,n){n||t.tagName.indexOf("-")>-1?Ln(t,e,i):Ul(e)?ki(i)?t.removeAttribute(e):(i=e==="allowfullscreen"&&t.tagName==="EMBED"?"true":e,t.setAttribute(e,i)):no(e)?t.setAttribute(e,jl(e,i)):$r(e)?ki(i)?t.removeAttributeNS(yr,so(e)):t.setAttributeNS(yr,e,i):Ln(t,e,i)}function Ln(t,e,i){if(ki(i))t.removeAttribute(e);else{if(Nt&&!jt&&t.tagName==="TEXTAREA"&&e==="placeholder"&&i!==""&&!t.__ieph){var n=function(h){h.stopImmediatePropagation(),t.removeEventListener("input",n)};t.addEventListener("input",n),t.__ieph=!0}t.setAttribute(e,i)}}var vc={create:Rn,update:Rn};function Fn(t,e){var i=e.elm,n=e.data,h=t.data;if(!(ve(n.staticClass)&&ve(n.class)&&(ve(h)||ve(h.staticClass)&&ve(h.class)))){var d=Vl(e),p=i._transitionClasses;J(p)&&(d=Zr(d,qr(p))),d!==i._prevClass&&(i.setAttribute("class",d),i._prevClass=d)}}var yc={create:Fn,update:Fn},Ki="__r",Ji="__c";function Sc(t){if(J(t[Ki])){var e=Nt?"change":"input";t[e]=[].concat(t[Ki],t[e]||[]),delete t[Ki]}J(t[Ji])&&(t.change=[].concat(t[Ji],t.change||[]),delete t[Ji])}var si;function bc(t,e,i){var n=si;return function h(){var d=e.apply(null,arguments);d!==null&&ao(t,h,i,n)}}var Cc=ur&&!(nn&&Number(nn[1])<=53);function wc(t,e,i,n){if(Cc){var h=to,d=e;e=d._wrapper=function(p){if(p.target===p.currentTarget||p.timeStamp>=h||p.timeStamp<=0||p.target.ownerDocument!==document)return d.apply(this,arguments)}}si.addEventListener(t,e,ks?{capture:i,passive:n}:i)}function ao(t,e,i,n){(n||si).removeEventListener(t,e._wrapper||e,i)}function Qi(t,e){if(!(ve(t.data.on)&&ve(e.data.on))){var i=e.data.on||{},n=t.data.on||{};si=e.elm||t.elm,Sc(i),Gs(i,n,wc,ao,bc,e.context),si=void 0}}var xc={create:Qi,update:Qi,destroy:function(t){return Qi(t,lt)}},mi;function Pn(t,e){if(!(ve(t.data.domProps)&&ve(e.data.domProps))){var i,n,h=e.elm,d=t.data.domProps||{},p=e.data.domProps||{};(J(p.__ob__)||De(p._v_attr_proxy))&&(p=e.data.domProps=Te({},p));for(i in d)i in p||(h[i]="");for(i in p){if(n=p[i],i==="textContent"||i==="innerHTML"){if(e.children&&(e.children.length=0),n===d[i])continue;h.childNodes.length===1&&h.removeChild(h.childNodes[0])}if(i==="value"&&h.tagName!=="PROGRESS"){h._value=n;var v=ve(n)?"":String(n);Tc(h,v)&&(h.value=v)}else if(i==="innerHTML"&&Kr(h.tagName)&&ve(h.innerHTML)){mi=mi||document.createElement("div"),mi.innerHTML="<svg>".concat(n,"</svg>");for(var b=mi.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;b.firstChild;)h.appendChild(b.firstChild)}else if(n!==d[i])try{h[i]=n}catch(C){}}}}function Tc(t,e){return!t.composing&&(t.tagName==="OPTION"||Ic(t,e)||Ec(t,e))}function Ic(t,e){var i=!0;try{i=document.activeElement!==t}catch(n){}return i&&t.value!==e}function Ec(t,e){var i=t.value,n=t._vModifiers;if(J(n)){if(n.number)return ei(i)!==ei(e);if(n.trim)return i.trim()!==e.trim()}return i!==e}var Oc={create:Pn,update:Pn},Ac=Ot(function(t){var e={},i=/;(?![^(]*\))/g,n=/:(.+)/;return t.split(i).forEach(function(h){if(h){var d=h.split(n);d.length>1&&(e[d[0].trim()]=d[1].trim())}}),e});function er(t){var e=lo(t.style);return t.staticStyle?Te(t.staticStyle,e):e}function lo(t){return Array.isArray(t)?Rs(t):typeof t=="string"?Ac(t):t}function Dc(t,e){var i={},n;if(e)for(var h=t;h.componentInstance;)h=h.componentInstance._vnode,h&&h.data&&(n=er(h.data))&&Te(i,n);(n=er(t.data))&&Te(i,n);for(var d=t;d=d.parent;)d.data&&(n=er(d.data))&&Te(i,n);return i}var Rc=/^--/,kn=/\s*!important$/,Bn=function(t,e,i){if(Rc.test(e))t.style.setProperty(e,i);else if(kn.test(i))t.style.setProperty(ai(e),i.replace(kn,""),"important");else{var n=Mc(e);if(Array.isArray(i))for(var h=0,d=i.length;h<d;h++)t.style[n]=i[h];else t.style[n]=i}},Nn=["Webkit","Moz","ms"],vi,Mc=Ot(function(t){if(vi=vi||document.createElement("div").style,t=wt(t),t!=="filter"&&t in vi)return t;for(var e=t.charAt(0).toUpperCase()+t.slice(1),i=0;i<Nn.length;i++){var n=Nn[i]+e;if(n in vi)return n}});function jn(t,e){var i=e.data,n=t.data;if(!(ve(i.staticStyle)&&ve(i.style)&&ve(n.staticStyle)&&ve(n.style))){var h,d,p=e.elm,v=n.staticStyle,b=n.normalizedStyle||n.style||{},C=v||b,x=lo(e.data.style)||{};e.data.normalizedStyle=J(x.__ob__)?Te({},x):x;var E=Dc(e,!0);for(d in C)ve(E[d])&&Bn(p,d,"");for(d in E)h=E[d],h!==C[d]&&Bn(p,d,h==null?"":h)}}var Lc={create:jn,update:jn},co=/\s+/;function ho(t,e){if(!(!e||!(e=e.trim())))if(t.classList)e.indexOf(" ")>-1?e.split(co).forEach(function(n){return t.classList.add(n)}):t.classList.add(e);else{var i=" ".concat(t.getAttribute("class")||""," ");i.indexOf(" "+e+" ")<0&&t.setAttribute("class",(i+e).trim())}}function uo(t,e){if(!(!e||!(e=e.trim())))if(t.classList)e.indexOf(" ")>-1?e.split(co).forEach(function(h){return t.classList.remove(h)}):t.classList.remove(e),t.classList.length||t.removeAttribute("class");else{for(var i=" ".concat(t.getAttribute("class")||""," "),n=" "+e+" ";i.indexOf(n)>=0;)i=i.replace(n," ");i=i.trim(),i?t.setAttribute("class",i):t.removeAttribute("class")}}function fo(t){if(!!t){if(typeof t=="object"){var e={};return t.css!==!1&&Te(e,Un(t.name||"v")),Te(e,t),e}else if(typeof t=="string")return Un(t)}}var Un=Ot(function(t){return{enterClass:"".concat(t,"-enter"),enterToClass:"".concat(t,"-enter-to"),enterActiveClass:"".concat(t,"-enter-active"),leaveClass:"".concat(t,"-leave"),leaveToClass:"".concat(t,"-leave-to"),leaveActiveClass:"".concat(t,"-leave-active")}}),go=ze&&!jt,Mt="transition",tr="animation",Ti="transition",Bi="transitionend",br="animation",po="animationend";go&&(window.ontransitionend===void 0&&window.onwebkittransitionend!==void 0&&(Ti="WebkitTransition",Bi="webkitTransitionEnd"),window.onanimationend===void 0&&window.onwebkitanimationend!==void 0&&(br="WebkitAnimation",po="webkitAnimationEnd"));var Vn=ze?window.requestAnimationFrame?window.requestAnimationFrame.bind(window):setTimeout:function(t){return t()};function _o(t){Vn(function(){Vn(t)})}function bt(t,e){var i=t._transitionClasses||(t._transitionClasses=[]);i.indexOf(e)<0&&(i.push(e),ho(t,e))}function nt(t,e){t._transitionClasses&&gt(t._transitionClasses,e),uo(t,e)}function mo(t,e,i){var n=vo(t,e),h=n.type,d=n.timeout,p=n.propCount;if(!h)return i();var v=h===Mt?Bi:po,b=0,C=function(){t.removeEventListener(v,x),i()},x=function(E){E.target===t&&++b>=p&&C()};setTimeout(function(){b<p&&C()},d+1),t.addEventListener(v,x)}var Fc=/\b(transform|all)(,|$)/;function vo(t,e){var i=window.getComputedStyle(t),n=(i[Ti+"Delay"]||"").split(", "),h=(i[Ti+"Duration"]||"").split(", "),d=Gn(n,h),p=(i[br+"Delay"]||"").split(", "),v=(i[br+"Duration"]||"").split(", "),b=Gn(p,v),C,x=0,E=0;e===Mt?d>0&&(C=Mt,x=d,E=h.length):e===tr?b>0&&(C=tr,x=b,E=v.length):(x=Math.max(d,b),C=x>0?d>b?Mt:tr:null,E=C?C===Mt?h.length:v.length:0);var O=C===Mt&&Fc.test(i[Ti+"Property"]);return{type:C,timeout:x,propCount:E,hasTransform:O}}function Gn(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max.apply(null,e.map(function(i,n){return Wn(i)+Wn(t[n])}))}function Wn(t){return Number(t.slice(0,-1).replace(",","."))*1e3}function Cr(t,e){var i=t.elm;J(i._leaveCb)&&(i._leaveCb.cancelled=!0,i._leaveCb());var n=fo(t.data.transition);if(!ve(n)&&!(J(i._enterCb)||i.nodeType!==1)){for(var h=n.css,d=n.type,p=n.enterClass,v=n.enterToClass,b=n.enterActiveClass,C=n.appearClass,x=n.appearToClass,E=n.appearActiveClass,O=n.beforeEnter,N=n.enter,k=n.afterEnter,H=n.enterCancelled,U=n.beforeAppear,ee=n.appear,Y=n.afterAppear,G=n.appearCancelled,re=n.duration,de=St,fe=St.$vnode;fe&&fe.parent;)de=fe.context,fe=fe.parent;var _e=!de._isMounted||!t.isRootInsert;if(!(_e&&!ee&&ee!=="")){var y=_e&&C?C:p,ge=_e&&E?E:b,me=_e&&x?x:v,we=_e&&U||O,a=_e&&Ae(ee)?ee:N,s=_e&&Y||k,l=_e&&G||H,u=ei(Fe(re)?re.enter:re),r=h!==!1&&!jt,o=Jr(a),c=i._enterCb=Ei(function(){r&&(nt(i,me),nt(i,ge)),c.cancelled?(r&&nt(i,y),l&&l(i)):s&&s(i),i._enterCb=null});t.data.show||at(t,"insert",function(){var _=i.parentNode,f=_&&_._pending&&_._pending[t.key];f&&f.tag===t.tag&&f.elm._leaveCb&&f.elm._leaveCb(),a&&a(i,c)}),we&&we(i),r&&(bt(i,y),bt(i,ge),_o(function(){nt(i,y),c.cancelled||(bt(i,me),o||(So(u)?setTimeout(c,u):mo(i,d,c)))})),t.data.show&&(e&&e(),a&&a(i,c)),!r&&!o&&c()}}}function yo(t,e){var i=t.elm;J(i._enterCb)&&(i._enterCb.cancelled=!0,i._enterCb());var n=fo(t.data.transition);if(ve(n)||i.nodeType!==1)return e();if(J(i._leaveCb))return;var h=n.css,d=n.type,p=n.leaveClass,v=n.leaveToClass,b=n.leaveActiveClass,C=n.beforeLeave,x=n.leave,E=n.afterLeave,O=n.leaveCancelled,N=n.delayLeave,k=n.duration,H=h!==!1&&!jt,U=Jr(x),ee=ei(Fe(k)?k.leave:k),Y=i._leaveCb=Ei(function(){i.parentNode&&i.parentNode._pending&&(i.parentNode._pending[t.key]=null),H&&(nt(i,v),nt(i,b)),Y.cancelled?(H&&nt(i,p),O&&O(i)):(e(),E&&E(i)),i._leaveCb=null});N?N(G):G();function G(){Y.cancelled||(!t.data.show&&i.parentNode&&((i.parentNode._pending||(i.parentNode._pending={}))[t.key]=t),C&&C(i),H&&(bt(i,p),bt(i,b),_o(function(){nt(i,p),Y.cancelled||(bt(i,v),U||(So(ee)?setTimeout(Y,ee):mo(i,d,Y)))})),x&&x(i,Y),!H&&!U&&Y())}}function So(t){return typeof t=="number"&&!isNaN(t)}function Jr(t){if(ve(t))return!1;var e=t.fns;return J(e)?Jr(Array.isArray(e)?e[0]:e):(t._length||t.length)>1}function Hn(t,e){e.data.show!==!0&&Cr(e)}var Pc=ze?{create:Hn,activate:Hn,remove:function(t,e){t.data.show!==!0?yo(t,e):e()}}:{},kc=[vc,yc,xc,Oc,Lc,Pc],Bc=kc.concat(mc),Nc=dc({nodeOps:lc,modules:Bc});jt&&document.addEventListener("selectionchange",function(){var t=document.activeElement;t&&t.vmodel&&Qr(t,"input")});var bo={inserted:function(t,e,i,n){i.tag==="select"?(n.elm&&!n.elm._vOptions?at(i,"postpatch",function(){bo.componentUpdated(t,e,i)}):zn(t,e,i.context),t._vOptions=[].map.call(t.options,Ni)):(i.tag==="textarea"||Sr(t.type))&&(t._vModifiers=e.modifiers,e.modifiers.lazy||(t.addEventListener("compositionstart",jc),t.addEventListener("compositionend",$n),t.addEventListener("change",$n),jt&&(t.vmodel=!0)))},componentUpdated:function(t,e,i){if(i.tag==="select"){zn(t,e,i.context);var n=t._vOptions,h=t._vOptions=[].map.call(t.options,Ni);if(h.some(function(p,v){return!xt(p,n[v])})){var d=t.multiple?e.value.some(function(p){return Xn(p,h)}):e.value!==e.oldValue&&Xn(e.value,h);d&&Qr(t,"change")}}}};function zn(t,e,i){Yn(t,e),(Nt||Mr)&&setTimeout(function(){Yn(t,e)},0)}function Yn(t,e,i){var n=e.value,h=t.multiple;if(!(h&&!Array.isArray(n))){for(var d,p,v=0,b=t.options.length;v<b;v++)if(p=t.options[v],h)d=Ls(n,Ni(p))>-1,p.selected!==d&&(p.selected=d);else if(xt(Ni(p),n)){t.selectedIndex!==v&&(t.selectedIndex=v);return}h||(t.selectedIndex=-1)}}function Xn(t,e){return e.every(function(i){return!xt(i,t)})}function Ni(t){return"_value"in t?t._value:t.value}function jc(t){t.target.composing=!0}function $n(t){!t.target.composing||(t.target.composing=!1,Qr(t.target,"input"))}function Qr(t,e){var i=document.createEvent("HTMLEvents");i.initEvent(e,!0,!0),t.dispatchEvent(i)}function wr(t){return t.componentInstance&&(!t.data||!t.data.transition)?wr(t.componentInstance._vnode):t}var Uc={bind:function(t,e,i){var n=e.value;i=wr(i);var h=i.data&&i.data.transition,d=t.__vOriginalDisplay=t.style.display==="none"?"":t.style.display;n&&h?(i.data.show=!0,Cr(i,function(){t.style.display=d})):t.style.display=n?d:"none"},update:function(t,e,i){var n=e.value,h=e.oldValue;if(!n!=!h){i=wr(i);var d=i.data&&i.data.transition;d?(i.data.show=!0,n?Cr(i,function(){t.style.display=t.__vOriginalDisplay}):yo(i,function(){t.style.display="none"})):t.style.display=n?t.__vOriginalDisplay:"none"}},unbind:function(t,e,i,n,h){h||(t.style.display=t.__vOriginalDisplay)}},Vc={model:bo,show:Uc},Co={name:String,appear:Boolean,css:Boolean,mode:String,type:String,enterClass:String,leaveClass:String,enterToClass:String,leaveToClass:String,enterActiveClass:String,leaveActiveClass:String,appearClass:String,appearActiveClass:String,appearToClass:String,duration:[Number,String,Object]};function xr(t){var e=t&&t.componentOptions;return e&&e.Ctor.options.abstract?xr($s(e.children)):t}function wo(t){var e={},i=t.$options;for(var n in i.propsData)e[n]=t[n];var h=i._parentListeners;for(var n in h)e[wt(n)]=h[n];return e}function Zn(t,e){if(/\d-keep-alive$/.test(e.tag))return t("keep-alive",{props:e.componentOptions.propsData})}function Gc(t){for(;t=t.parent;)if(t.data.transition)return!0}function Wc(t,e){return e.key===t.key&&e.tag===t.tag}var Hc=function(t){return t.tag||ii(t)},zc=function(t){return t.name==="show"},Yc={name:"transition",props:Co,abstract:!0,render:function(t){var e=this,i=this.$slots.default;if(!!i&&(i=i.filter(Hc),!!i.length)){var n=this.mode,h=i[0];if(Gc(this.$vnode))return h;var d=xr(h);if(!d)return h;if(this._leaving)return Zn(t,h);var p="__transition-".concat(this._uid,"-");d.key=d.key==null?d.isComment?p+"comment":p+d.tag:oi(d.key)?String(d.key).indexOf(p)===0?d.key:p+d.key:d.key;var v=(d.data||(d.data={})).transition=wo(this),b=this._vnode,C=xr(b);if(d.data.directives&&d.data.directives.some(zc)&&(d.data.show=!0),C&&C.data&&!Wc(d,C)&&!ii(C)&&!(C.componentInstance&&C.componentInstance._vnode.isComment)){var x=C.data.transition=Te({},v);if(n==="out-in")return this._leaving=!0,at(x,"afterLeave",function(){e._leaving=!1,e.$forceUpdate()}),Zn(t,h);if(n==="in-out"){if(ii(d))return b;var E,O=function(){E()};at(v,"afterEnter",O),at(v,"enterCancelled",O),at(x,"delayLeave",function(N){E=N})}}return h}}},xo=Te({tag:String,moveClass:String},Co);delete xo.mode;var Xc={props:xo,beforeMount:function(){var t=this,e=this._update;this._update=function(i,n){var h=Js(t);t.__patch__(t._vnode,t.kept,!1,!0),t._vnode=t.kept,h(),e.call(t,i,n)}},render:function(t){for(var e=this.tag||this.$vnode.data.tag||"span",i=Object.create(null),n=this.prevChildren=this.children,h=this.$slots.default||[],d=this.children=[],p=wo(this),v=0;v<h.length;v++){var b=h[v];b.tag&&b.key!=null&&String(b.key).indexOf("__vlist")!==0&&(d.push(b),i[b.key]=b,(b.data||(b.data={})).transition=p)}if(n){for(var C=[],x=[],v=0;v<n.length;v++){var b=n[v];b.data.transition=p,b.data.pos=b.elm.getBoundingClientRect(),i[b.key]?C.push(b):x.push(b)}this.kept=t(e,null,C),this.removed=x}return t(e,null,d)},updated:function(){var t=this.prevChildren,e=this.moveClass||(this.name||"v")+"-move";!t.length||!this.hasMove(t[0].elm,e)||(t.forEach($c),t.forEach(Zc),t.forEach(qc),this._reflow=document.body.offsetHeight,t.forEach(function(i){if(i.data.moved){var n=i.elm,h=n.style;bt(n,e),h.transform=h.WebkitTransform=h.transitionDuration="",n.addEventListener(Bi,n._moveCb=function d(p){p&&p.target!==n||(!p||/transform$/.test(p.propertyName))&&(n.removeEventListener(Bi,d),n._moveCb=null,nt(n,e))})}}))},methods:{hasMove:function(t,e){if(!go)return!1;if(this._hasMove)return this._hasMove;var i=t.cloneNode();t._transitionClasses&&t._transitionClasses.forEach(function(h){uo(i,h)}),ho(i,e),i.style.display="none",this.$el.appendChild(i);var n=vo(i);return this.$el.removeChild(i),this._hasMove=n.hasTransform}}};function $c(t){t.elm._moveCb&&t.elm._moveCb(),t.elm._enterCb&&t.elm._enterCb()}function Zc(t){t.data.newPos=t.elm.getBoundingClientRect()}function qc(t){var e=t.data.pos,i=t.data.newPos,n=e.left-i.left,h=e.top-i.top;if(n||h){t.data.moved=!0;var d=t.elm.style;d.transform=d.WebkitTransform="translate(".concat(n,"px,").concat(h,"px)"),d.transitionDuration="0s"}}var Kc={Transition:Yc,TransitionGroup:Xc};Re.config.mustUseProp=Bl;Re.config.isReservedTag=oo;Re.config.isReservedAttr=Pl;Re.config.getTagNamespace=Xl;Re.config.isUnknownElement=$l;Te(Re.options.directives,Vc);Te(Re.options.components,Kc);Re.prototype.__patch__=ze?Nc:Me;Re.prototype.$mount=function(t,e){return t=t&&ze?Zl(t):void 0,Va(this,t,e)};ze&&setTimeout(function(){Ze.devtools&&Oi&&Oi.emit("init",Re)},0);/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */function Jc(t,e,i,n){t.prototype._pos=[0,0,0],t.prototype._orientation=[0,0,-1,0,1,0],t.prototype.stereo=function(d){var p=this;if(!p.ctx||!p.ctx.listener)return p;for(var v=p._howls.length-1;v>=0;v--)p._howls[v].stereo(d);return p},t.prototype.pos=function(d,p,v){var b=this;if(!b.ctx||!b.ctx.listener)return b;if(p=typeof p!="number"?b._pos[1]:p,v=typeof v!="number"?b._pos[2]:v,typeof d=="number")b._pos=[d,p,v],typeof b.ctx.listener.positionX<"u"?(b.ctx.listener.positionX.setTargetAtTime(b._pos[0],e.ctx.currentTime,.1),b.ctx.listener.positionY.setTargetAtTime(b._pos[1],e.ctx.currentTime,.1),b.ctx.listener.positionZ.setTargetAtTime(b._pos[2],e.ctx.currentTime,.1)):b.ctx.listener.setPosition(b._pos[0],b._pos[1],b._pos[2]);else return b._pos;return b},t.prototype.orientation=function(d,p,v,b,C,x){var E=this;if(!E.ctx||!E.ctx.listener)return E;var O=E._orientation;if(p=typeof p!="number"?O[1]:p,v=typeof v!="number"?O[2]:v,b=typeof b!="number"?O[3]:b,C=typeof C!="number"?O[4]:C,x=typeof x!="number"?O[5]:x,typeof d=="number")E._orientation=[d,p,v,b,C,x],typeof E.ctx.listener.forwardX<"u"?(E.ctx.listener.forwardX.setTargetAtTime(d,e.ctx.currentTime,.1),E.ctx.listener.forwardY.setTargetAtTime(p,e.ctx.currentTime,.1),E.ctx.listener.forwardZ.setTargetAtTime(v,e.ctx.currentTime,.1),E.ctx.listener.upX.setTargetAtTime(b,e.ctx.currentTime,.1),E.ctx.listener.upY.setTargetAtTime(C,e.ctx.currentTime,.1),E.ctx.listener.upZ.setTargetAtTime(x,e.ctx.currentTime,.1)):E.ctx.listener.setOrientation(d,p,v,b,C,x);else return O;return E},i.prototype.init=function(d){return function(p){var v=this;return v._orientation=p.orientation||[1,0,0],v._stereo=p.stereo||null,v._pos=p.pos||null,v._pannerAttr={coneInnerAngle:typeof p.coneInnerAngle<"u"?p.coneInnerAngle:360,coneOuterAngle:typeof p.coneOuterAngle<"u"?p.coneOuterAngle:360,coneOuterGain:typeof p.coneOuterGain<"u"?p.coneOuterGain:0,distanceModel:typeof p.distanceModel<"u"?p.distanceModel:"inverse",maxDistance:typeof p.maxDistance<"u"?p.maxDistance:1e4,panningModel:typeof p.panningModel<"u"?p.panningModel:"HRTF",refDistance:typeof p.refDistance<"u"?p.refDistance:1,rolloffFactor:typeof p.rolloffFactor<"u"?p.rolloffFactor:1},v._onstereo=p.onstereo?[{fn:p.onstereo}]:[],v._onpos=p.onpos?[{fn:p.onpos}]:[],v._onorientation=p.onorientation?[{fn:p.onorientation}]:[],d.call(this,p)}}(i.prototype.init),i.prototype.stereo=function(d,p){var v=this;if(!v._webAudio)return v;if(v._state!=="loaded")return v._queue.push({event:"stereo",action:function(){v.stereo(d,p)}}),v;var b=typeof e.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof p>"u")if(typeof d=="number")v._stereo=d,v._pos=[d,0,0];else return v._stereo;for(var C=v._getSoundIds(p),x=0;x<C.length;x++){var E=v._soundById(C[x]);if(E)if(typeof d=="number")E._stereo=d,E._pos=[d,0,0],E._node&&(E._pannerAttr.panningModel="equalpower",(!E._panner||!E._panner.pan)&&h(E,b),b==="spatial"?typeof E._panner.positionX<"u"?(E._panner.positionX.setValueAtTime(d,e.ctx.currentTime),E._panner.positionY.setValueAtTime(0,e.ctx.currentTime),E._panner.positionZ.setValueAtTime(0,e.ctx.currentTime)):E._panner.setPosition(d,0,0):E._panner.pan.setValueAtTime(d,e.ctx.currentTime)),v._emit("stereo",E._id);else return E._stereo}return v},i.prototype.pos=function(d,p,v,b){var C=this;if(!C._webAudio)return C;if(C._state!=="loaded")return C._queue.push({event:"pos",action:function(){C.pos(d,p,v,b)}}),C;if(p=typeof p!="number"?0:p,v=typeof v!="number"?-.5:v,typeof b>"u")if(typeof d=="number")C._pos=[d,p,v];else return C._pos;for(var x=C._getSoundIds(b),E=0;E<x.length;E++){var O=C._soundById(x[E]);if(O)if(typeof d=="number")O._pos=[d,p,v],O._node&&((!O._panner||O._panner.pan)&&h(O,"spatial"),typeof O._panner.positionX<"u"?(O._panner.positionX.setValueAtTime(d,e.ctx.currentTime),O._panner.positionY.setValueAtTime(p,e.ctx.currentTime),O._panner.positionZ.setValueAtTime(v,e.ctx.currentTime)):O._panner.setPosition(d,p,v)),C._emit("pos",O._id);else return O._pos}return C},i.prototype.orientation=function(d,p,v,b){var C=this;if(!C._webAudio)return C;if(C._state!=="loaded")return C._queue.push({event:"orientation",action:function(){C.orientation(d,p,v,b)}}),C;if(p=typeof p!="number"?C._orientation[1]:p,v=typeof v!="number"?C._orientation[2]:v,typeof b>"u")if(typeof d=="number")C._orientation=[d,p,v];else return C._orientation;for(var x=C._getSoundIds(b),E=0;E<x.length;E++){var O=C._soundById(x[E]);if(O)if(typeof d=="number")O._orientation=[d,p,v],O._node&&(O._panner||(O._pos||(O._pos=C._pos||[0,0,-.5]),h(O,"spatial")),typeof O._panner.orientationX<"u"?(O._panner.orientationX.setValueAtTime(d,e.ctx.currentTime),O._panner.orientationY.setValueAtTime(p,e.ctx.currentTime),O._panner.orientationZ.setValueAtTime(v,e.ctx.currentTime)):O._panner.setOrientation(d,p,v)),C._emit("orientation",O._id);else return O._orientation}return C},i.prototype.pannerAttr=function(){var d=this,p=arguments,v,b,C;if(!d._webAudio)return d;if(p.length===0)return d._pannerAttr;if(p.length===1)if(typeof p[0]=="object")v=p[0],typeof b>"u"&&(v.pannerAttr||(v.pannerAttr={coneInnerAngle:v.coneInnerAngle,coneOuterAngle:v.coneOuterAngle,coneOuterGain:v.coneOuterGain,distanceModel:v.distanceModel,maxDistance:v.maxDistance,refDistance:v.refDistance,rolloffFactor:v.rolloffFactor,panningModel:v.panningModel}),d._pannerAttr={coneInnerAngle:typeof v.pannerAttr.coneInnerAngle<"u"?v.pannerAttr.coneInnerAngle:d._coneInnerAngle,coneOuterAngle:typeof v.pannerAttr.coneOuterAngle<"u"?v.pannerAttr.coneOuterAngle:d._coneOuterAngle,coneOuterGain:typeof v.pannerAttr.coneOuterGain<"u"?v.pannerAttr.coneOuterGain:d._coneOuterGain,distanceModel:typeof v.pannerAttr.distanceModel<"u"?v.pannerAttr.distanceModel:d._distanceModel,maxDistance:typeof v.pannerAttr.maxDistance<"u"?v.pannerAttr.maxDistance:d._maxDistance,refDistance:typeof v.pannerAttr.refDistance<"u"?v.pannerAttr.refDistance:d._refDistance,rolloffFactor:typeof v.pannerAttr.rolloffFactor<"u"?v.pannerAttr.rolloffFactor:d._rolloffFactor,panningModel:typeof v.pannerAttr.panningModel<"u"?v.pannerAttr.panningModel:d._panningModel});else return C=d._soundById(parseInt(p[0],10)),C?C._pannerAttr:d._pannerAttr;else p.length===2&&(v=p[0],b=parseInt(p[1],10));for(var x=d._getSoundIds(b),E=0;E<x.length;E++)if(C=d._soundById(x[E]),C){var O=C._pannerAttr;O={coneInnerAngle:typeof v.coneInnerAngle<"u"?v.coneInnerAngle:O.coneInnerAngle,coneOuterAngle:typeof v.coneOuterAngle<"u"?v.coneOuterAngle:O.coneOuterAngle,coneOuterGain:typeof v.coneOuterGain<"u"?v.coneOuterGain:O.coneOuterGain,distanceModel:typeof v.distanceModel<"u"?v.distanceModel:O.distanceModel,maxDistance:typeof v.maxDistance<"u"?v.maxDistance:O.maxDistance,refDistance:typeof v.refDistance<"u"?v.refDistance:O.refDistance,rolloffFactor:typeof v.rolloffFactor<"u"?v.rolloffFactor:O.rolloffFactor,panningModel:typeof v.panningModel<"u"?v.panningModel:O.panningModel};var N=C._panner;N||(C._pos||(C._pos=d._pos||[0,0,-.5]),h(C,"spatial"),N=C._panner),N.coneInnerAngle=O.coneInnerAngle,N.coneOuterAngle=O.coneOuterAngle,N.coneOuterGain=O.coneOuterGain,N.distanceModel=O.distanceModel,N.maxDistance=O.maxDistance,N.refDistance=O.refDistance,N.rolloffFactor=O.rolloffFactor,N.panningModel=O.panningModel}return d},n.prototype.init=function(d){return function(){var p=this,v=p._parent;p._orientation=v._orientation,p._stereo=v._stereo,p._pos=v._pos,p._pannerAttr=v._pannerAttr,d.call(this),p._stereo?v.stereo(p._stereo):p._pos&&v.pos(p._pos[0],p._pos[1],p._pos[2],p._id)}}(n.prototype.init),n.prototype.reset=function(d){return function(){var p=this,v=p._parent;return p._orientation=v._orientation,p._stereo=v._stereo,p._pos=v._pos,p._pannerAttr=v._pannerAttr,p._stereo?v.stereo(p._stereo):p._pos?v.pos(p._pos[0],p._pos[1],p._pos[2],p._id):p._panner&&(p._panner.disconnect(0),p._panner=void 0,v._refreshBuffer(p)),d.call(this)}}(n.prototype.reset);var h=function(d,p){p=p||"spatial",p==="spatial"?(d._panner=e.ctx.createPanner(),d._panner.coneInnerAngle=d._pannerAttr.coneInnerAngle,d._panner.coneOuterAngle=d._pannerAttr.coneOuterAngle,d._panner.coneOuterGain=d._pannerAttr.coneOuterGain,d._panner.distanceModel=d._pannerAttr.distanceModel,d._panner.maxDistance=d._pannerAttr.maxDistance,d._panner.refDistance=d._pannerAttr.refDistance,d._panner.rolloffFactor=d._pannerAttr.rolloffFactor,d._panner.panningModel=d._pannerAttr.panningModel,typeof d._panner.positionX<"u"?(d._panner.positionX.setValueAtTime(d._pos[0],e.ctx.currentTime),d._panner.positionY.setValueAtTime(d._pos[1],e.ctx.currentTime),d._panner.positionZ.setValueAtTime(d._pos[2],e.ctx.currentTime)):d._panner.setPosition(d._pos[0],d._pos[1],d._pos[2]),typeof d._panner.orientationX<"u"?(d._panner.orientationX.setValueAtTime(d._orientation[0],e.ctx.currentTime),d._panner.orientationY.setValueAtTime(d._orientation[1],e.ctx.currentTime),d._panner.orientationZ.setValueAtTime(d._orientation[2],e.ctx.currentTime)):d._panner.setOrientation(d._orientation[0],d._orientation[1],d._orientation[2])):(d._panner=e.ctx.createStereoPanner(),d._panner.pan.setValueAtTime(d._stereo,e.ctx.currentTime)),d._panner.connect(d._node),d._paused||d._parent.pause(d._id,!0).play(d._id,!0)}}/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */var en=function(){this.init()};en.prototype={init:function(){var t=this||ne;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator=typeof window<"u"&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var e=this||ne;if(t=parseFloat(t),e.ctx||Ii(),typeof t<"u"&&t>=0&&t<=1){if(e._volume=t,e._muted)return e;e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t,ne.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),h=0;h<n.length;h++){var d=e._howls[i]._soundById(n[h]);d&&d._node&&(d._node.volume=d._volume*t)}return e}return e._volume},mute:function(t){var e=this||ne;e.ctx||Ii(),e._muted=t,e.usingWebAudio&&e.masterGain.gain.setValueAtTime(t?0:e._volume,ne.ctx.currentTime);for(var i=0;i<e._howls.length;i++)if(!e._howls[i]._webAudio)for(var n=e._howls[i]._getSoundIds(),h=0;h<n.length;h++){var d=e._howls[i]._soundById(n[h]);d&&d._node&&(d._node.muted=t?!0:d._muted)}return e},stop:function(){for(var t=this||ne,e=0;e<t._howls.length;e++)t._howls[e].stop();return t},unload:function(){for(var t=this||ne,e=t._howls.length-1;e>=0;e--)t._howls[e].unload();return t.usingWebAudio&&t.ctx&&typeof t.ctx.close<"u"&&(t.ctx.close(),t.ctx=null,Ii()),t},codecs:function(t){return(this||ne)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||ne;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if(typeof Audio<"u")try{var e=new Audio;typeof e.oncanplaythrough>"u"&&(t._canPlayEvent="canplay")}catch(i){t.noAudio=!0}else t.noAudio=!0;try{var e=new Audio;e.muted&&(t.noAudio=!0)}catch(i){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||ne,e=null;try{e=typeof Audio<"u"?new Audio:null}catch(C){return t}if(!e||typeof e.canPlayType!="function")return t;var i=e.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator?t._navigator.userAgent:"",h=n.match(/OPR\/([0-6].)/g),d=h&&parseInt(h[0].split("/")[1],10)<33,p=n.indexOf("Safari")!==-1&&n.indexOf("Chrome")===-1,v=n.match(/Version\/(.*?) /),b=p&&v&&parseInt(v[1],10)<15;return t._codecs={mp3:!!(!d&&(i||e.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!i,opus:!!e.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(e.canPlayType('audio/wav; codecs="1"')||e.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!e.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!e.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(e.canPlayType("audio/x-m4a;")||e.canPlayType("audio/m4a;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(e.canPlayType("audio/x-m4b;")||e.canPlayType("audio/m4b;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(e.canPlayType("audio/x-mp4;")||e.canPlayType("audio/mp4;")||e.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!b&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!b&&e.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!e.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(e.canPlayType("audio/x-flac;")||e.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||ne;if(!(t._audioUnlocked||!t.ctx)){t._audioUnlocked=!1,t.autoUnlock=!1,!t._mobileUnloaded&&t.ctx.sampleRate!==44100&&(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var e=function(i){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var n=new Audio;n._unlocked=!0,t._releaseHtml5Audio(n)}catch(C){t.noAudio=!0;break}for(var h=0;h<t._howls.length;h++)if(!t._howls[h]._webAudio)for(var d=t._howls[h]._getSoundIds(),p=0;p<d.length;p++){var v=t._howls[h]._soundById(d[p]);v&&v._node&&!v._node._unlocked&&(v._node._unlocked=!0,v._node.load())}t._autoResume();var b=t.ctx.createBufferSource();b.buffer=t._scratchBuffer,b.connect(t.ctx.destination),typeof b.start>"u"?b.noteOn(0):b.start(0),typeof t.ctx.resume=="function"&&t.ctx.resume(),b.onended=function(){b.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",e,!0),document.removeEventListener("touchend",e,!0),document.removeEventListener("click",e,!0),document.removeEventListener("keydown",e,!0);for(var C=0;C<t._howls.length;C++)t._howls[C]._emit("unlock")}};return document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",e,!0),document.addEventListener("click",e,!0),document.addEventListener("keydown",e,!0),t}},_obtainHtml5Audio:function(){var t=this||ne;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var e=new Audio().play();return e&&typeof Promise<"u"&&(e instanceof Promise||typeof e.then=="function")&&e.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(t){var e=this||ne;return t._unlocked&&e._html5AudioPool.push(t),e},_autoSuspend:function(){var t=this;if(!(!t.autoSuspend||!t.ctx||typeof t.ctx.suspend>"u"||!ne.usingWebAudio)){for(var e=0;e<t._howls.length;e++)if(t._howls[e]._webAudio){for(var i=0;i<t._howls[e]._sounds.length;i++)if(!t._howls[e]._sounds[i]._paused)return t}return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout(function(){if(!!t.autoSuspend){t._suspendTimer=null,t.state="suspending";var n=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(n,n)}},3e4),t}},_autoResume:function(){var t=this;if(!(!t.ctx||typeof t.ctx.resume>"u"||!ne.usingWebAudio))return t.state==="running"&&t.ctx.state!=="interrupted"&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):t.state==="suspended"||t.state==="running"&&t.ctx.state==="interrupted"?(t.ctx.resume().then(function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")}),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):t.state==="suspending"&&(t._resumeAfterSuspend=!0),t}};var ne=new en,ji=function(t){var e=this;if(!t.src||t.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}e.init(t)};ji.prototype={init:function(t){var e=this;return ne.ctx||Ii(),e._autoplay=t.autoplay||!1,e._format=typeof t.format!="string"?t.format:[t.format],e._html5=t.html5||!1,e._muted=t.mute||!1,e._loop=t.loop||!1,e._pool=t.pool||5,e._preload=typeof t.preload=="boolean"||t.preload==="metadata"?t.preload:!0,e._rate=t.rate||1,e._sprite=t.sprite||{},e._src=typeof t.src!="string"?t.src:[t.src],e._volume=t.volume!==void 0?t.volume:1,e._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:t.xhr&&t.xhr.withCredentials?t.xhr.withCredentials:!1},e._duration=0,e._state="unloaded",e._sounds=[],e._endTimers={},e._queue=[],e._playLock=!1,e._onend=t.onend?[{fn:t.onend}]:[],e._onfade=t.onfade?[{fn:t.onfade}]:[],e._onload=t.onload?[{fn:t.onload}]:[],e._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],e._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],e._onpause=t.onpause?[{fn:t.onpause}]:[],e._onplay=t.onplay?[{fn:t.onplay}]:[],e._onstop=t.onstop?[{fn:t.onstop}]:[],e._onmute=t.onmute?[{fn:t.onmute}]:[],e._onvolume=t.onvolume?[{fn:t.onvolume}]:[],e._onrate=t.onrate?[{fn:t.onrate}]:[],e._onseek=t.onseek?[{fn:t.onseek}]:[],e._onunlock=t.onunlock?[{fn:t.onunlock}]:[],e._onresume=[],e._webAudio=ne.usingWebAudio&&!e._html5,typeof ne.ctx<"u"&&ne.ctx&&ne.autoUnlock&&ne._unlockAudio(),ne._howls.push(e),e._autoplay&&e._queue.push({event:"play",action:function(){e.play()}}),e._preload&&e._preload!=="none"&&e.load(),e},load:function(){var t=this,e=null;if(ne.noAudio){t._emit("loaderror",null,"No audio support.");return}typeof t._src=="string"&&(t._src=[t._src]);for(var i=0;i<t._src.length;i++){var n,h;if(t._format&&t._format[i])n=t._format[i];else{if(h=t._src[i],typeof h!="string"){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}n=/^data:audio\/([^;,]+);/i.exec(h),n||(n=/\.([^.]+)$/.exec(h.split("?",1)[0])),n&&(n=n[1].toLowerCase())}if(n||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),n&&ne.codecs(n)){e=t._src[i];break}}if(!e){t._emit("loaderror",null,"No codec support for selected audio sources.");return}return t._src=e,t._state="loading",window.location.protocol==="https:"&&e.slice(0,5)==="http:"&&(t._html5=!0,t._webAudio=!1),new Ui(t),t._webAudio&&Qc(t),t},play:function(t,e){var i=this,n=null;if(typeof t=="number")n=t,t=null;else{if(typeof t=="string"&&i._state==="loaded"&&!i._sprite[t])return null;if(typeof t>"u"&&(t="__default",!i._playLock)){for(var h=0,d=0;d<i._sounds.length;d++)i._sounds[d]._paused&&!i._sounds[d]._ended&&(h++,n=i._sounds[d]._id);h===1?t=null:n=null}}var p=n?i._soundById(n):i._inactiveSound();if(!p)return null;if(n&&!t&&(t=p._sprite||"__default"),i._state!=="loaded"){p._sprite=t,p._ended=!1;var v=p._id;return i._queue.push({event:"play",action:function(){i.play(v)}}),v}if(n&&!p._paused)return e||i._loadQueue("play"),p._id;i._webAudio&&ne._autoResume();var b=Math.max(0,p._seek>0?p._seek:i._sprite[t][0]/1e3),C=Math.max(0,(i._sprite[t][0]+i._sprite[t][1])/1e3-b),x=C*1e3/Math.abs(p._rate),E=i._sprite[t][0]/1e3,O=(i._sprite[t][0]+i._sprite[t][1])/1e3;p._sprite=t,p._ended=!1;var N=function(){p._paused=!1,p._seek=b,p._start=E,p._stop=O,p._loop=!!(p._loop||i._sprite[t][2])};if(b>=O){i._ended(p);return}var k=p._node;if(i._webAudio){var H=function(){i._playLock=!1,N(),i._refreshBuffer(p);var G=p._muted||i._muted?0:p._volume;k.gain.setValueAtTime(G,ne.ctx.currentTime),p._playStart=ne.ctx.currentTime,typeof k.bufferSource.start>"u"?p._loop?k.bufferSource.noteGrainOn(0,b,86400):k.bufferSource.noteGrainOn(0,b,C):p._loop?k.bufferSource.start(0,b,86400):k.bufferSource.start(0,b,C),x!==1/0&&(i._endTimers[p._id]=setTimeout(i._ended.bind(i,p),x)),e||setTimeout(function(){i._emit("play",p._id),i._loadQueue()},0)};ne.state==="running"&&ne.ctx.state!=="interrupted"?H():(i._playLock=!0,i.once("resume",H),i._clearTimer(p._id))}else{var U=function(){k.currentTime=b,k.muted=p._muted||i._muted||ne._muted||k.muted,k.volume=p._volume*ne.volume(),k.playbackRate=p._rate;try{var G=k.play();if(G&&typeof Promise<"u"&&(G instanceof Promise||typeof G.then=="function")?(i._playLock=!0,N(),G.then(function(){i._playLock=!1,k._unlocked=!0,e?i._loadQueue():i._emit("play",p._id)}).catch(function(){i._playLock=!1,i._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),p._ended=!0,p._paused=!0})):e||(i._playLock=!1,N(),i._emit("play",p._id)),k.playbackRate=p._rate,k.paused){i._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}t!=="__default"||p._loop?i._endTimers[p._id]=setTimeout(i._ended.bind(i,p),x):(i._endTimers[p._id]=function(){i._ended(p),k.removeEventListener("ended",i._endTimers[p._id],!1)},k.addEventListener("ended",i._endTimers[p._id],!1))}catch(re){i._emit("playerror",p._id,re)}};k.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(k.src=i._src,k.load());var ee=window&&window.ejecta||!k.readyState&&ne._navigator.isCocoonJS;if(k.readyState>=3||ee)U();else{i._playLock=!0,i._state="loading";var Y=function(){i._state="loaded",U(),k.removeEventListener(ne._canPlayEvent,Y,!1)};k.addEventListener(ne._canPlayEvent,Y,!1),i._clearTimer(p._id)}}return p._id},pause:function(t){var e=this;if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),n=0;n<i.length;n++){e._clearTimer(i[n]);var h=e._soundById(i[n]);if(h&&!h._paused&&(h._seek=e.seek(i[n]),h._rateSeek=0,h._paused=!0,e._stopFade(i[n]),h._node))if(e._webAudio){if(!h._node.bufferSource)continue;typeof h._node.bufferSource.stop>"u"?h._node.bufferSource.noteOff(0):h._node.bufferSource.stop(0),e._cleanBuffer(h._node)}else(!isNaN(h._node.duration)||h._node.duration===1/0)&&h._node.pause();arguments[1]||e._emit("pause",h?h._id:null)}return e},stop:function(t,e){var i=this;if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var n=i._getSoundIds(t),h=0;h<n.length;h++){i._clearTimer(n[h]);var d=i._soundById(n[h]);d&&(d._seek=d._start||0,d._rateSeek=0,d._paused=!0,d._ended=!0,i._stopFade(n[h]),d._node&&(i._webAudio?d._node.bufferSource&&(typeof d._node.bufferSource.stop>"u"?d._node.bufferSource.noteOff(0):d._node.bufferSource.stop(0),i._cleanBuffer(d._node)):(!isNaN(d._node.duration)||d._node.duration===1/0)&&(d._node.currentTime=d._start||0,d._node.pause(),d._node.duration===1/0&&i._clearSound(d._node))),e||i._emit("stop",d._id))}return i},mute:function(t,e){var i=this;if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"mute",action:function(){i.mute(t,e)}}),i;if(typeof e>"u")if(typeof t=="boolean")i._muted=t;else return i._muted;for(var n=i._getSoundIds(e),h=0;h<n.length;h++){var d=i._soundById(n[h]);d&&(d._muted=t,d._interval&&i._stopFade(d._id),i._webAudio&&d._node?d._node.gain.setValueAtTime(t?0:d._volume,ne.ctx.currentTime):d._node&&(d._node.muted=ne._muted?!0:t),i._emit("mute",d._id))}return i},volume:function(){var t=this,e=arguments,i,n;if(e.length===0)return t._volume;if(e.length===1||e.length===2&&typeof e[1]>"u"){var h=t._getSoundIds(),d=h.indexOf(e[0]);d>=0?n=parseInt(e[0],10):i=parseFloat(e[0])}else e.length>=2&&(i=parseFloat(e[0]),n=parseInt(e[1],10));var p;if(typeof i<"u"&&i>=0&&i<=1){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"volume",action:function(){t.volume.apply(t,e)}}),t;typeof n>"u"&&(t._volume=i),n=t._getSoundIds(n);for(var v=0;v<n.length;v++)p=t._soundById(n[v]),p&&(p._volume=i,e[2]||t._stopFade(n[v]),t._webAudio&&p._node&&!p._muted?p._node.gain.setValueAtTime(i,ne.ctx.currentTime):p._node&&!p._muted&&(p._node.volume=i*ne.volume()),t._emit("volume",p._id))}else return p=n?t._soundById(n):t._sounds[0],p?p._volume:0;return t},fade:function(t,e,i,n){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"fade",action:function(){h.fade(t,e,i,n)}}),h;t=Math.min(Math.max(0,parseFloat(t)),1),e=Math.min(Math.max(0,parseFloat(e)),1),i=parseFloat(i),h.volume(t,n);for(var d=h._getSoundIds(n),p=0;p<d.length;p++){var v=h._soundById(d[p]);if(v){if(n||h._stopFade(d[p]),h._webAudio&&!v._muted){var b=ne.ctx.currentTime,C=b+i/1e3;v._volume=t,v._node.gain.setValueAtTime(t,b),v._node.gain.linearRampToValueAtTime(e,C)}h._startFadeInterval(v,t,e,i,d[p],typeof n>"u")}}return h},_startFadeInterval:function(t,e,i,n,h,d){var p=this,v=e,b=i-e,C=Math.abs(b/.01),x=Math.max(4,C>0?n/C:n),E=Date.now();t._fadeTo=i,t._interval=setInterval(function(){var O=(Date.now()-E)/n;E=Date.now(),v+=b*O,v=Math.round(v*100)/100,b<0?v=Math.max(i,v):v=Math.min(i,v),p._webAudio?t._volume=v:p.volume(v,t._id,!0),d&&(p._volume=v),(i<e&&v<=i||i>e&&v>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,p.volume(i,t._id),p._emit("fade",t._id))},x)},_stopFade:function(t){var e=this,i=e._soundById(t);return i&&i._interval&&(e._webAudio&&i._node.gain.cancelScheduledValues(ne.ctx.currentTime),clearInterval(i._interval),i._interval=null,e.volume(i._fadeTo,t),i._fadeTo=null,e._emit("fade",t)),e},loop:function(){var t=this,e=arguments,i,n,h;if(e.length===0)return t._loop;if(e.length===1)if(typeof e[0]=="boolean")i=e[0],t._loop=i;else return h=t._soundById(parseInt(e[0],10)),h?h._loop:!1;else e.length===2&&(i=e[0],n=parseInt(e[1],10));for(var d=t._getSoundIds(n),p=0;p<d.length;p++)h=t._soundById(d[p]),h&&(h._loop=i,t._webAudio&&h._node&&h._node.bufferSource&&(h._node.bufferSource.loop=i,i&&(h._node.bufferSource.loopStart=h._start||0,h._node.bufferSource.loopEnd=h._stop,t.playing(d[p])&&(t.pause(d[p],!0),t.play(d[p],!0)))));return t},rate:function(){var t=this,e=arguments,i,n;if(e.length===0)n=t._sounds[0]._id;else if(e.length===1){var h=t._getSoundIds(),d=h.indexOf(e[0]);d>=0?n=parseInt(e[0],10):i=parseFloat(e[0])}else e.length===2&&(i=parseFloat(e[0]),n=parseInt(e[1],10));var p;if(typeof i=="number"){if(t._state!=="loaded"||t._playLock)return t._queue.push({event:"rate",action:function(){t.rate.apply(t,e)}}),t;typeof n>"u"&&(t._rate=i),n=t._getSoundIds(n);for(var v=0;v<n.length;v++)if(p=t._soundById(n[v]),p){t.playing(n[v])&&(p._rateSeek=t.seek(n[v]),p._playStart=t._webAudio?ne.ctx.currentTime:p._playStart),p._rate=i,t._webAudio&&p._node&&p._node.bufferSource?p._node.bufferSource.playbackRate.setValueAtTime(i,ne.ctx.currentTime):p._node&&(p._node.playbackRate=i);var b=t.seek(n[v]),C=(t._sprite[p._sprite][0]+t._sprite[p._sprite][1])/1e3-b,x=C*1e3/Math.abs(p._rate);(t._endTimers[n[v]]||!p._paused)&&(t._clearTimer(n[v]),t._endTimers[n[v]]=setTimeout(t._ended.bind(t,p),x)),t._emit("rate",p._id)}}else return p=t._soundById(n),p?p._rate:t._rate;return t},seek:function(){var t=this,e=arguments,i,n;if(e.length===0)t._sounds.length&&(n=t._sounds[0]._id);else if(e.length===1){var h=t._getSoundIds(),d=h.indexOf(e[0]);d>=0?n=parseInt(e[0],10):t._sounds.length&&(n=t._sounds[0]._id,i=parseFloat(e[0]))}else e.length===2&&(i=parseFloat(e[0]),n=parseInt(e[1],10));if(typeof n>"u")return 0;if(typeof i=="number"&&(t._state!=="loaded"||t._playLock))return t._queue.push({event:"seek",action:function(){t.seek.apply(t,e)}}),t;var p=t._soundById(n);if(p)if(typeof i=="number"&&i>=0){var v=t.playing(n);v&&t.pause(n,!0),p._seek=i,p._ended=!1,t._clearTimer(n),!t._webAudio&&p._node&&!isNaN(p._node.duration)&&(p._node.currentTime=i);var b=function(){v&&t.play(n,!0),t._emit("seek",n)};if(v&&!t._webAudio){var C=function(){t._playLock?setTimeout(C,0):b()};setTimeout(C,0)}else b()}else if(t._webAudio){var x=t.playing(n)?ne.ctx.currentTime-p._playStart:0,E=p._rateSeek?p._rateSeek-p._seek:0;return p._seek+(E+x*Math.abs(p._rate))}else return p._node.currentTime;return t},playing:function(t){var e=this;if(typeof t=="number"){var i=e._soundById(t);return i?!i._paused:!1}for(var n=0;n<e._sounds.length;n++)if(!e._sounds[n]._paused)return!0;return!1},duration:function(t){var e=this,i=e._duration,n=e._soundById(t);return n&&(i=e._sprite[n._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,e=t._sounds,i=0;i<e.length;i++)e[i]._paused||t.stop(e[i]._id),t._webAudio||(t._clearSound(e[i]._node),e[i]._node.removeEventListener("error",e[i]._errorFn,!1),e[i]._node.removeEventListener(ne._canPlayEvent,e[i]._loadFn,!1),e[i]._node.removeEventListener("ended",e[i]._endFn,!1),ne._releaseHtml5Audio(e[i]._node)),delete e[i]._node,t._clearTimer(e[i]._id);var n=ne._howls.indexOf(t);n>=0&&ne._howls.splice(n,1);var h=!0;for(i=0;i<ne._howls.length;i++)if(ne._howls[i]._src===t._src||t._src.indexOf(ne._howls[i]._src)>=0){h=!1;break}return Ct&&h&&delete Ct[t._src],ne.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,n){var h=this,d=h["_on"+t];return typeof e=="function"&&d.push(n?{id:i,fn:e,once:n}:{id:i,fn:e}),h},off:function(t,e,i){var n=this,h=n["_on"+t],d=0;if(typeof e=="number"&&(i=e,e=null),e||i)for(d=0;d<h.length;d++){var p=i===h[d].id;if(e===h[d].fn&&p||!e&&p){h.splice(d,1);break}}else if(t)n["_on"+t]=[];else{var v=Object.keys(n);for(d=0;d<v.length;d++)v[d].indexOf("_on")===0&&Array.isArray(n[v[d]])&&(n[v[d]]=[])}return n},once:function(t,e,i){var n=this;return n.on(t,e,i,1),n},_emit:function(t,e,i){for(var n=this,h=n["_on"+t],d=h.length-1;d>=0;d--)(!h[d].id||h[d].id===e||t==="load")&&(setTimeout(function(p){p.call(this,e,i)}.bind(n,h[d].fn),0),h[d].once&&n.off(t,h[d].fn,h[d].id));return n._loadQueue(t),n},_loadQueue:function(t){var e=this;if(e._queue.length>0){var i=e._queue[0];i.event===t&&(e._queue.shift(),e._loadQueue()),t||i.action()}return e},_ended:function(t){var e=this,i=t._sprite;if(!e._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(e._ended.bind(e,t),100),e;var n=!!(t._loop||e._sprite[i][2]);if(e._emit("end",t._id),!e._webAudio&&n&&e.stop(t._id,!0).play(t._id),e._webAudio&&n){e._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=ne.ctx.currentTime;var h=(t._stop-t._start)*1e3/Math.abs(t._rate);e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),h)}return e._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,e._clearTimer(t._id),e._cleanBuffer(t._node),ne._autoSuspend()),!e._webAudio&&!n&&e.stop(t._id,!0),e},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if(typeof e._endTimers[t]!="function")clearTimeout(e._endTimers[t]);else{var i=e._soundById(t);i&&i._node&&i._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,i=0;i<e._sounds.length;i++)if(t===e._sounds[i]._id)return e._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new Ui(t)},_drain:function(){var t=this,e=t._pool,i=0,n=0;if(!(t._sounds.length<e)){for(n=0;n<t._sounds.length;n++)t._sounds[n]._ended&&i++;for(n=t._sounds.length-1;n>=0;n--){if(i<=e)return;t._sounds[n]._ended&&(t._webAudio&&t._sounds[n]._node&&t._sounds[n]._node.disconnect(0),t._sounds.splice(n,1),i--)}}},_getSoundIds:function(t){var e=this;if(typeof t>"u"){for(var i=[],n=0;n<e._sounds.length;n++)i.push(e._sounds[n]._id);return i}else return[t]},_refreshBuffer:function(t){var e=this;return t._node.bufferSource=ne.ctx.createBufferSource(),t._node.bufferSource.buffer=Ct[e._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,ne.ctx.currentTime),e},_cleanBuffer:function(t){var e=this,i=ne._navigator&&ne._navigator.vendor.indexOf("Apple")>=0;if(!t.bufferSource)return e;if(ne._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),i))try{t.bufferSource.buffer=ne._scratchBuffer}catch(n){}return t.bufferSource=null,e},_clearSound:function(t){var e=/MSIE |Trident\//.test(ne._navigator&&ne._navigator.userAgent);e||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var Ui=function(t){this._parent=t,this.init()};Ui.prototype={init:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++ne._counter,e._sounds.push(t),t.create(),t},create:function(){var t=this,e=t._parent,i=ne._muted||t._muted||t._parent._muted?0:t._volume;return e._webAudio?(t._node=typeof ne.ctx.createGain>"u"?ne.ctx.createGainNode():ne.ctx.createGain(),t._node.gain.setValueAtTime(i,ne.ctx.currentTime),t._node.paused=!0,t._node.connect(ne.masterGain)):ne.noAudio||(t._node=ne._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(ne._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=e._src,t._node.preload=e._preload===!0?"auto":e._preload,t._node.volume=i*ne.volume(),t._node.load()),t},reset:function(){var t=this,e=t._parent;return t._muted=e._muted,t._loop=e._loop,t._volume=e._volume,t._rate=e._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++ne._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,e=t._parent;e._duration=Math.ceil(t._node.duration*10)/10,Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue()),t._node.removeEventListener(ne._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(t._node.duration*10)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=e._duration*1e3),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var Ct={},Qc=function(t){var e=t._src;if(Ct[e]){t._duration=Ct[e].duration,To(t);return}if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),n=new Uint8Array(i.length),h=0;h<i.length;++h)n[h]=i.charCodeAt(h);qn(n.buffer,t)}else{var d=new XMLHttpRequest;d.open(t._xhr.method,e,!0),d.withCredentials=t._xhr.withCredentials,d.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach(function(p){d.setRequestHeader(p,t._xhr.headers[p])}),d.onload=function(){var p=(d.status+"")[0];if(p!=="0"&&p!=="2"&&p!=="3"){t._emit("loaderror",null,"Failed loading audio file with status: "+d.status+".");return}qn(d.response,t)},d.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete Ct[e],t.load())},eh(d)}},eh=function(t){try{t.send()}catch(e){t.onerror()}},qn=function(t,e){var i=function(){e._emit("loaderror",null,"Decoding audio data failed.")},n=function(h){h&&e._sounds.length>0?(Ct[e._src]=h,To(e,h)):i()};typeof Promise<"u"&&ne.ctx.decodeAudioData.length===1?ne.ctx.decodeAudioData(t).then(n).catch(i):ne.ctx.decodeAudioData(t,n,i)},To=function(t,e){e&&!t._duration&&(t._duration=e.duration),Object.keys(t._sprite).length===0&&(t._sprite={__default:[0,t._duration*1e3]}),t._state!=="loaded"&&(t._state="loaded",t._emit("load"),t._loadQueue())},Ii=function(){if(!!ne.usingWebAudio){try{typeof AudioContext<"u"?ne.ctx=new AudioContext:typeof webkitAudioContext<"u"?ne.ctx=new webkitAudioContext:ne.usingWebAudio=!1}catch(h){ne.usingWebAudio=!1}ne.ctx||(ne.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(ne._navigator&&ne._navigator.platform),e=ne._navigator&&ne._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),i=e?parseInt(e[1],10):null;if(t&&i&&i<9){var n=/safari/.test(ne._navigator&&ne._navigator.userAgent.toLowerCase());ne._navigator&&!n&&(ne.usingWebAudio=!1)}ne.usingWebAudio&&(ne.masterGain=typeof ne.ctx.createGain>"u"?ne.ctx.createGainNode():ne.ctx.createGain(),ne.masterGain.gain.setValueAtTime(ne._muted?0:ne._volume,ne.ctx.currentTime),ne.masterGain.connect(ne.ctx.destination)),ne._setup()}};Jc(en,ne,ji,Ui);/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2023, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 9.6.32 (js 20231027)
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/barcode-reader/sdk-javascript/
 */const pt=typeof self>"u",Kn=pt?{}:self;let $t,tt,yi,Vi,Le;if(typeof navigator<"u"&&($t=navigator,tt=$t.userAgent,yi=$t.platform,Vi=$t.mediaDevices),!pt){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:$t.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:yi,search:"Win"},Mac:{str:yi},Linux:{str:yi}};let i="unknownBrowser",n=0,h="unknownOS";for(let d in t){const p=t[d]||{};let v=p.str||tt,b=p.search||d,C=p.verStr||tt,x=p.verSearch||d;if(x instanceof Array||(x=[x]),v.indexOf(b)!=-1){i=d;for(let E of x){let O=C.indexOf(E);if(O!=-1){n=parseFloat(C.substring(O+E.length+1));break}}break}}for(let d in e){const p=e[d]||{};let v=p.str||tt,b=p.search||d;if(v.indexOf(b)!=-1){h=d;break}}h=="Linux"&&tt.indexOf("Windows NT")!=-1&&(h="HarmonyOS"),Le={browser:i,version:n,OS:h}}pt&&(Le={browser:"ssr",version:0,OS:"ssr"});const th=typeof WebAssembly<"u"&&tt&&!(/Safari/.test(tt)&&!/Chrome/.test(tt)&&/\(.+\s11_2_([2-6]).*\)/.test(tt)),ih=!(typeof Worker>"u"),Io=!(!Vi||!Vi.getUserMedia),rh=async()=>{let t=!1;if(Io)try{(await Vi.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch(e){}return t};Le.browser==="Chrome"&&Le.version>66||Le.browser==="Safari"&&Le.version>13||Le.browser==="OPR"&&Le.version>43||Le.browser==="Edge"&&Le.version;const nh=(()=>{if(!pt&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let i=t.indexOf("#");i!=-1&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Zt=" is not allowed to change after `createInstance` or `loadWasm` is called.",sh=!pt&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",oh=!pt&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword")||"",Jn=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!pt){let i=document.createElement("a");i.href=t[e],t[e]=i.href}t[e].endsWith("/")||(t[e]+="/")}}return t};var Ie,Gi,Tr,Ue,Bt;(function(t){t[t.IPF_Binary=0]="IPF_Binary",t[t.IPF_BinaryInverted=1]="IPF_BinaryInverted",t[t.IPF_GrayScaled=2]="IPF_GrayScaled",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888"})(Ie||(Ie={})),function(t){t[t.DBR_SYSTEM_EXCEPTION=1]="DBR_SYSTEM_EXCEPTION",t[t.DBR_SUCCESS=0]="DBR_SUCCESS",t[t.DBR_UNKNOWN=-1e4]="DBR_UNKNOWN",t[t.DBR_NO_MEMORY=-10001]="DBR_NO_MEMORY",t[t.DBR_NULL_REFERENCE=-10002]="DBR_NULL_REFERENCE",t[t.DBR_LICENSE_INVALID=-10003]="DBR_LICENSE_INVALID",t[t.DBR_LICENSE_EXPIRED=-10004]="DBR_LICENSE_EXPIRED",t[t.DBR_FILE_NOT_FOUND=-10005]="DBR_FILE_NOT_FOUND",t[t.DBR_FILETYPE_NOT_SUPPORTED=-10006]="DBR_FILETYPE_NOT_SUPPORTED",t[t.DBR_BPP_NOT_SUPPORTED=-10007]="DBR_BPP_NOT_SUPPORTED",t[t.DBR_INDEX_INVALID=-10008]="DBR_INDEX_INVALID",t[t.DBR_BARCODE_FORMAT_INVALID=-10009]="DBR_BARCODE_FORMAT_INVALID",t[t.DBR_CUSTOM_REGION_INVALID=-10010]="DBR_CUSTOM_REGION_INVALID",t[t.DBR_MAX_BARCODE_NUMBER_INVALID=-10011]="DBR_MAX_BARCODE_NUMBER_INVALID",t[t.DBR_IMAGE_READ_FAILED=-10012]="DBR_IMAGE_READ_FAILED",t[t.DBR_TIFF_READ_FAILED=-10013]="DBR_TIFF_READ_FAILED",t[t.DBR_QR_LICENSE_INVALID=-10016]="DBR_QR_LICENSE_INVALID",t[t.DBR_1D_LICENSE_INVALID=-10017]="DBR_1D_LICENSE_INVALID",t[t.DBR_DIB_BUFFER_INVALID=-10018]="DBR_DIB_BUFFER_INVALID",t[t.DBR_PDF417_LICENSE_INVALID=-10019]="DBR_PDF417_LICENSE_INVALID",t[t.DBR_DATAMATRIX_LICENSE_INVALID=-10020]="DBR_DATAMATRIX_LICENSE_INVALID",t[t.DBR_PDF_READ_FAILED=-10021]="DBR_PDF_READ_FAILED",t[t.DBR_PDF_DLL_MISSING=-10022]="DBR_PDF_DLL_MISSING",t[t.DBR_PAGE_NUMBER_INVALID=-10023]="DBR_PAGE_NUMBER_INVALID",t[t.DBR_CUSTOM_SIZE_INVALID=-10024]="DBR_CUSTOM_SIZE_INVALID",t[t.DBR_CUSTOM_MODULESIZE_INVALID=-10025]="DBR_CUSTOM_MODULESIZE_INVALID",t[t.DBR_RECOGNITION_TIMEOUT=-10026]="DBR_RECOGNITION_TIMEOUT",t[t.DBR_JSON_PARSE_FAILED=-10030]="DBR_JSON_PARSE_FAILED",t[t.DBR_JSON_TYPE_INVALID=-10031]="DBR_JSON_TYPE_INVALID",t[t.DBR_JSON_KEY_INVALID=-10032]="DBR_JSON_KEY_INVALID",t[t.DBR_JSON_VALUE_INVALID=-10033]="DBR_JSON_VALUE_INVALID",t[t.DBR_JSON_NAME_KEY_MISSING=-10034]="DBR_JSON_NAME_KEY_MISSING",t[t.DBR_JSON_NAME_VALUE_DUPLICATED=-10035]="DBR_JSON_NAME_VALUE_DUPLICATED",t[t.DBR_TEMPLATE_NAME_INVALID=-10036]="DBR_TEMPLATE_NAME_INVALID",t[t.DBR_JSON_NAME_REFERENCE_INVALID=-10037]="DBR_JSON_NAME_REFERENCE_INVALID",t[t.DBR_PARAMETER_VALUE_INVALID=-10038]="DBR_PARAMETER_VALUE_INVALID",t[t.DBR_DOMAIN_NOT_MATCHED=-10039]="DBR_DOMAIN_NOT_MATCHED",t[t.DBR_RESERVEDINFO_NOT_MATCHED=-10040]="DBR_RESERVEDINFO_NOT_MATCHED",t[t.DBR_AZTEC_LICENSE_INVALID=-10041]="DBR_AZTEC_LICENSE_INVALID",t[t.DBR_LICENSE_DLL_MISSING=-10042]="DBR_LICENSE_DLL_MISSING",t[t.DBR_LICENSEKEY_NOT_MATCHED=-10043]="DBR_LICENSEKEY_NOT_MATCHED",t[t.DBR_REQUESTED_FAILED=-10044]="DBR_REQUESTED_FAILED",t[t.DBR_LICENSE_INIT_FAILED=-10045]="DBR_LICENSE_INIT_FAILED",t[t.DBR_PATCHCODE_LICENSE_INVALID=-10046]="DBR_PATCHCODE_LICENSE_INVALID",t[t.DBR_POSTALCODE_LICENSE_INVALID=-10047]="DBR_POSTALCODE_LICENSE_INVALID",t[t.DBR_DPM_LICENSE_INVALID=-10048]="DBR_DPM_LICENSE_INVALID",t[t.DBR_FRAME_DECODING_THREAD_EXISTS=-10049]="DBR_FRAME_DECODING_THREAD_EXISTS",t[t.DBR_STOP_DECODING_THREAD_FAILED=-10050]="DBR_STOP_DECODING_THREAD_FAILED",t[t.DBR_SET_MODE_ARGUMENT_ERROR=-10051]="DBR_SET_MODE_ARGUMENT_ERROR",t[t.DBR_LICENSE_CONTENT_INVALID=-10052]="DBR_LICENSE_CONTENT_INVALID",t[t.DBR_LICENSE_KEY_INVALID=-10053]="DBR_LICENSE_KEY_INVALID",t[t.DBR_LICENSE_DEVICE_RUNS_OUT=-10054]="DBR_LICENSE_DEVICE_RUNS_OUT",t[t.DBR_GET_MODE_ARGUMENT_ERROR=-10055]="DBR_GET_MODE_ARGUMENT_ERROR",t[t.DBR_IRT_LICENSE_INVALID=-10056]="DBR_IRT_LICENSE_INVALID",t[t.DBR_MAXICODE_LICENSE_INVALID=-10057]="DBR_MAXICODE_LICENSE_INVALID",t[t.DBR_GS1_DATABAR_LICENSE_INVALID=-10058]="DBR_GS1_DATABAR_LICENSE_INVALID",t[t.DBR_GS1_COMPOSITE_LICENSE_INVALID=-10059]="DBR_GS1_COMPOSITE_LICENSE_INVALID",t[t.DBR_PANORAMA_LICENSE_INVALID=-10060]="DBR_PANORAMA_LICENSE_INVALID",t[t.DBR_DOTCODE_LICENSE_INVALID=-10061]="DBR_DOTCODE_LICENSE_INVALID",t[t.DBR_PHARMACODE_LICENSE_INVALID=-10062]="DBR_PHARMACODE_LICENSE_INVALID",t[t.DBR_IMAGE_ORIENTATION_INVALID=-10063]="DBR_IMAGE_ORIENTATION_INVALID",t[t.DMERR_NO_LICENSE=-2e4]="DMERR_NO_LICENSE",t[t.DMERR_LICENSE_SYNC_FAILED=-20003]="DMERR_LICENSE_SYNC_FAILED",t[t.DMERR_TRIAL_LICENSE=-20010]="DMERR_TRIAL_LICENSE",t[t.DMERR_FAILED_TO_REACH_LTS=-20200]="DMERR_FAILED_TO_REACH_LTS"}(Gi||(Gi={})),function(t){t[t.IMRDT_IMAGE=1]="IMRDT_IMAGE",t[t.IMRDT_CONTOUR=2]="IMRDT_CONTOUR",t[t.IMRDT_LINESEGMENT=4]="IMRDT_LINESEGMENT",t[t.IMRDT_LOCALIZATIONRESULT=8]="IMRDT_LOCALIZATIONRESULT",t[t.IMRDT_REGIONOFINTEREST=16]="IMRDT_REGIONOFINTEREST",t[t.IMRDT_QUADRILATERAL=32]="IMRDT_QUADRILATERAL"}(Tr||(Tr={})),function(t){t[t.BF_ALL=-29360129]="BF_ALL",t[t.BF_ONED=3147775]="BF_ONED",t[t.BF_GS1_DATABAR=260096]="BF_GS1_DATABAR",t[t.BF_CODE_39=1]="BF_CODE_39",t[t.BF_CODE_128=2]="BF_CODE_128",t[t.BF_CODE_93=4]="BF_CODE_93",t[t.BF_CODABAR=8]="BF_CODABAR",t[t.BF_ITF=16]="BF_ITF",t[t.BF_EAN_13=32]="BF_EAN_13",t[t.BF_EAN_8=64]="BF_EAN_8",t[t.BF_UPC_A=128]="BF_UPC_A",t[t.BF_UPC_E=256]="BF_UPC_E",t[t.BF_INDUSTRIAL_25=512]="BF_INDUSTRIAL_25",t[t.BF_CODE_39_EXTENDED=1024]="BF_CODE_39_EXTENDED",t[t.BF_GS1_DATABAR_OMNIDIRECTIONAL=2048]="BF_GS1_DATABAR_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_TRUNCATED=4096]="BF_GS1_DATABAR_TRUNCATED",t[t.BF_GS1_DATABAR_STACKED=8192]="BF_GS1_DATABAR_STACKED",t[t.BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL=16384]="BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL",t[t.BF_GS1_DATABAR_EXPANDED=32768]="BF_GS1_DATABAR_EXPANDED",t[t.BF_GS1_DATABAR_EXPANDED_STACKED=65536]="BF_GS1_DATABAR_EXPANDED_STACKED",t[t.BF_GS1_DATABAR_LIMITED=131072]="BF_GS1_DATABAR_LIMITED",t[t.BF_PATCHCODE=262144]="BF_PATCHCODE",t[t.BF_PDF417=33554432]="BF_PDF417",t[t.BF_QR_CODE=67108864]="BF_QR_CODE",t[t.BF_DATAMATRIX=134217728]="BF_DATAMATRIX",t[t.BF_AZTEC=268435456]="BF_AZTEC",t[t.BF_MAXICODE=536870912]="BF_MAXICODE",t[t.BF_MICRO_QR=1073741824]="BF_MICRO_QR",t[t.BF_MICRO_PDF417=524288]="BF_MICRO_PDF417",t[t.BF_GS1_COMPOSITE=-2147483648]="BF_GS1_COMPOSITE",t[t.BF_MSI_CODE=1048576]="BF_MSI_CODE",t[t.BF_CODE_11=2097152]="BF_CODE_11",t[t.BF_NULL=0]="BF_NULL"}(Ue||(Ue={})),function(t){t[t.IRT_NO_RESULT=0]="IRT_NO_RESULT",t[t.IRT_ORIGINAL_IMAGE=1]="IRT_ORIGINAL_IMAGE",t[t.IRT_COLOUR_CLUSTERED_IMAGE=2]="IRT_COLOUR_CLUSTERED_IMAGE",t[t.IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE=4]="IRT_COLOUR_CONVERTED_GRAYSCALE_IMAGE",t[t.IRT_TRANSFORMED_GRAYSCALE_IMAGE=8]="IRT_TRANSFORMED_GRAYSCALE_IMAGE",t[t.IRT_PREDETECTED_REGION=16]="IRT_PREDETECTED_REGION",t[t.IRT_PREPROCESSED_IMAGE=32]="IRT_PREPROCESSED_IMAGE",t[t.IRT_BINARIZED_IMAGE=64]="IRT_BINARIZED_IMAGE",t[t.IRT_TEXT_ZONE=128]="IRT_TEXT_ZONE",t[t.IRT_CONTOUR=256]="IRT_CONTOUR",t[t.IRT_LINE_SEGMENT=512]="IRT_LINE_SEGMENT",t[t.IRT_FORM=1024]="IRT_FORM",t[t.IRT_SEGMENTATION_BLOCK=2048]="IRT_SEGMENTATION_BLOCK",t[t.IRT_TYPED_BARCODE_ZONE=4096]="IRT_TYPED_BARCODE_ZONE",t[t.IRT_PREDETECTED_QUADRILATERAL=8192]="IRT_PREDETECTED_QUADRILATERAL"}(Bt||(Bt={}));const Qn=t=>t&&typeof t=="object"&&typeof t.then=="function";class Eo extends Promise{constructor(e){let i,n;super((h,d)=>{i=h,n=d}),this._s="pending",this.resolve=h=>{this.isPending&&(Qn(h)?this.task=h:(this._s="fulfilled",i(h)))},this.reject=h=>{this.isPending&&(this._s="rejected",n(h))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let i;this._task=e,Qn(e)?i=e:typeof e=="function"&&(i=new Promise(e)),i&&(async()=>{try{const n=await i;e===this._task&&this.resolve(n)}catch(n){e===this._task&&this.reject(n)}})()}get isEmpty(){return this._task==null}}const ir=["iPhone","iPad","Android","HarmonyOS"].includes(Le.OS)?2048:4096;class L{constructor(){this._instanceID=void 0,this._ifSaveOriginalImageInACanvas=!1,this.oriCanvas=null,this.oriCanvasData=null,this.canvas=null,this.bFilterRegionInJs=!1,this._region=null,this._timeStartDecode=null,this._timeEnterInnerDBR=null,this._timeGetMessage=null,this.decodeRecords={},this.bDestroyed=!1,this._lastErrorCode=0,this._lastErrorString="",this._lastInnerDecodeDuration=0,this.intervalTime=0,this._intervalGetVideoFrame=0,this.array_getFrameTimeCost=[],this.array_decodeFrameTimeCost=[],this._indexCurrentDecodingFrame=0,this._arrPolygons=[],this._bPauseScan=!1,this._intervalDetectVideoPause=1e3,this._soundSource="data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV",this.bPlaySoundOnSuccessfulRead=!1,this.bVibrateOnSuccessfulRead=!1,this.vibrateDuration=300,this.captureAndDecodeInParallel=!0,this.autoSuggestTip=!1,this.suggestTipFrameArray=[],this.suggestTipFrameLimit=[5,3],this.noIntermediateResultsCount=0,this.noIntermediateResultsTipLimit=100,this.tinyBarcodeTipModuleSizeLimit=3,this.hugeBarcodeTipLimit=.9,this.autoZoomInFrameArray=[],this.autoZoomInFrameLimit=[5,3],this.autoZoomInStepRate=1/3,this.autoZoomInMaxStep=1.5,this.autoZoomInMaxTimes=5,this.autoZoomInMinStep=Math.pow(10,1/this.autoZoomInMaxTimes),this.autoZoomInIdealModuleSize=6,this.autoZoomOutFrameCount=0,this.autoZoomOutFrameLimit=3,this.autoZoomOutStepRate=1/3,this.autoZoomOutMinValue=1,this.autoZoomOutMinStep=2,this.autoZoomOutStepRate_2=.05,this.autoZoomOutMinValue_2=2,this.frameArrayInIdealZoom=[],this.frameLimitInIdealZoom=[5,3],this.enableZoomOutInIdealZoom=!1,this.nextActionInIdealZoom="focus",this.autoFocusFrameArray=[],this.autoFocusFrameLimit=[5,3],this.autoZoomIdealArea=[0,.05],this.autoZoomTargetBorder=.9,this.autoZoomDetectionArea=.5,this.autoZoom=!1,this.autoFocus=!1,this._resultHighlightingDuration=-1,this._dce=null,this._imgSource=null,this._maxCvsSideLength=ir,this._promiseStartScan=null,this.beepSound=new ji({src:[this._soundSource],onplayerror:(e,i)=>{console.warn(`Sound '${e}' playback failure: ${i}`)}})}static get version(){return this._version}static get license(){return this._license}static set license(e){((i,n)=>{const h=i;if(!h._pLoad.isEmpty)throw new Error("`license`"+Zt);h._license=n})(L,e)}static get productKeys(){return this._license}static set productKeys(e){L.license=e}static get handshakeCode(){return this._license}static set handshakeCode(e){L.license=e}static get organizationID(){return this._license}static set organizationID(e){L.license=e}static set sessionPassword(e){((i,n)=>{const h=i;if(!h._pLoad.isEmpty)throw new Error("`sessionPassword`"+Zt);h._sessionPassword=n})(L,e)}static get sessionPassword(){return this._sessionPassword}static async detectEnvironment(){return await(async()=>({wasm:th,worker:ih,getUserMedia:Io,camera:await rh(),browser:Le.browser,version:Le.version,OS:Le.OS}))()}static get engineResourcePath(){return this._engineResourcePath}static set engineResourcePath(e){if(!this._pLoad.isEmpty)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` or `loadWasm` is called.");L._engineResourcePath=(i=>{if(i==null&&(i="./"),!pt){let n=document.createElement("a");n.href=i,i=n.href}return i.endsWith("/")||(i+="/"),i})(e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){((i,n)=>{const h=i;if(!h._pLoad.isEmpty)throw new Error("`licenseServer`"+Zt);h._licenseServer=Jn(n)})(L,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){((i,n)=>{const h=i;if(!h._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Zt);h._deviceFriendlyName=n||""})(L,e)}static get _bUseFullFeature(){return this.__bUseFullFeature}static set _bUseFullFeature(e){if(!this._pLoad.isEmpty)throw new Error("`_bUseFullFeature` is not allowed to change after `createInstance` or `loadWasm` is called.");L.__bUseFullFeature=e}static isImageSource(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"getImage"in e}static isDSImage(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"width"in e&&"height"in e&&"pixelFormat"in e}static isDCEFrame(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e}getOriginalImageInACanvas(){return!this.oriCanvas&&this.oriCanvasData?this.oriCanvasData.toCanvas():this.oriCanvas}set region(e){this._region=e,this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}static isWasmLoaded(){return this._pLoad.isFulfilled}isContextDestroyed(){return this.bDestroyed}static get lastErrorCode(){return this._lastErrorCode}static get lastErrorString(){return this._lastErrorString}get lastErrorCode(){return this._lastErrorCode}get lastErrorString(){return this._lastErrorString}static get defaultUIElementURL(){var e;return(e=L._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",L.engineResourcePath)}static set defaultUIElementURL(e){L._defaultUIElementURL=e}static _fireHTTPSWarnning(){L.onWarning&&location&&location.protocol!=="https:"&&setTimeout(()=>{L.onWarning&&L.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}get soundSource(){return this._soundSource}set soundSource(e){this._soundSource=e,this.beepSound=new ji({src:[this._soundSource],onplayerror:(i,n)=>{console.warn(`Sound '${i}' playback failure: ${n}`)}})}get whenToPlaySoundforSuccessfulRead(){return this.bPlaySoundOnSuccessfulRead===!0?"frame":this.bPlaySoundOnSuccessfulRead?this.bPlaySoundOnSuccessfulRead:"never"}set whenToPlaySoundforSuccessfulRead(e){this.bPlaySoundOnSuccessfulRead=e!=="never"&&e}get whenToVibrateforSuccessfulRead(){return this.bVibrateOnSuccessfulRead===!0?"frame":this.bVibrateOnSuccessfulRead?this.bVibrateOnSuccessfulRead:"never"}set whenToVibrateforSuccessfulRead(e){this.bVibrateOnSuccessfulRead=e!=="never"&&e}set dce(e){this._dce=e}get dce(){return!this._dce||this._dce.isDisposed||this._dce.disposed?null:this._dce}set maxCvsSideLength(e){this._maxCvsSideLength=e,this._dceControler&&this._dceControler.setDisiredValue(this,"maxCvsSideLength",e)}get maxCvsSideLength(){return this._maxCvsSideLength}async _registerDCEControler(){if(!this.dce)return;L._onLog&&L._onLog("_registerDCEControler()");const e=this.dce;this._dceControler=e._createControler();const i=this._dceControler;i.register(this),i.setDisiredValue(this,"refreshInterval",200),i.setDisiredValue(this,"maxCvsSideLength",this._maxCvsSideLength),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"});try{}catch(d){d.name==="ReferenceError"&&window&&(window.ResizeObserver=void 0)}const n=e.getUIElement(),h=this.dce.constructor;if(h._defaultUIElementURL==="@engineResourcePath/dce.ui.html")try{n?n===i._innerSetUI&&(await e.setUIElement(`${h.engineResourcePath}dce.ui.html`),i._innerSetUI=e.getUIElement()):(await e.setUIElement(`${h.engineResourcePath}dbr.ui.html`),i._innerSetUI=e.getUIElement())}catch(d){await e.setUIElement(h.defaultUIElementURL)}else n||await e.setUIElement(h.defaultUIElementURL);this.callbackCameraChange=()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackResolutionChange=()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0},this.callbackCameraClose=()=>{this.stopScanning(!0),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1},this.callbackSingleFrameAcquired=async d=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null);let p=await this._decode_DCEFrame(d,{bCopyData:!1}),v=null;if(p&&p.length){const{sx:b,sy:C,width:x,height:E,_sWidth:O,_sHeight:N}=d;v=p.map(k=>({localizationResult:JSON.parse(JSON.stringify(k.localizationResult))})),L.recalculateResultLocation(v,b,C,O,N,x,E)}if(this._drawResults(v,p),await this.clearMapDecodeRecord(),this.onImageRead&&this.dce.isOpen()&&!this._bPauseScan){let b=this._cloneDecodeResults(p);this.onImageRead(b)}if(this.onUniqueRead&&this.dce.isOpen()&&!this._bPauseScan)for(let b of p)this.onUniqueRead(b.barcodeText,this._cloneDecodeResults(b))},e.on("cameraChange",this.callbackCameraChange),e.on("resolutionChange",this.callbackResolutionChange),e.on("cameraClose",this.callbackCameraClose),e.on("singleFrameAcquired",this.callbackSingleFrameAcquired)}_logoutDCEControler(){this.dce&&this._dceControler&&(L._onLog&&L._onLog("_logoutDCEControler()"),this._dceControler.logout(this),this.dce.off("cameraChange",this.callbackCameraChange),this.dce.off("resolutionChange",this.callbackResolutionChange),this.dce.off("cameraClose",this.callbackCameraClose),this.dce.off("singleFrameAcquired",this.callbackSingleFrameAcquired),this._dceControler=null,this.dce=null)}async setImageSource(e,i){if(e==null)return this._imgSource=null,this._logoutDCEControler(),void(this._drawingItemNamespace=null);if(e&&e.isCameraEnhancer)this.dce=e,await this._registerDCEControler(),this._imgSource=null;else{if(!L.isImageSource(e))throw new Error("Invalid value.");this._logoutDCEControler(),this._imgSource=e}i&&i.resultsHighlightBaseShapes&&(this._drawingItemNamespace=i.resultsHighlightBaseShapes)}static async loadWasm(){if(this._pLoad.isEmpty){let{lt:e,l:i,ls:n,sp:h,rmk:d}=(p=>{const v=p;if(v._pLoad.isEmpty){let b,C,x=v._license||"",E=JSON.parse(JSON.stringify(v._licenseServer)),O=v._sessionPassword,N=0;if(x.startsWith("t")||x.startsWith("f"))N=0;else if(x.length===0||x.startsWith("P")||x.startsWith("L")||x.startsWith("Y")||x.startsWith("A"))N=1;else{N=2;const k=x.indexOf(":");if(k!=-1&&(x=x.substring(k+1)),x.startsWith("DLS2")){let H;try{let U=x.substring(4);U=atob(U),H=JSON.parse(U)}catch(U){throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(x=H.handshakeCode?H.handshakeCode:H.organizationID?H.organizationID:"",typeof x=="number"&&(x=JSON.stringify(x)),E.length===0){let U=[];H.mainServerURL&&(U[0]=H.mainServerURL),H.standbyServerURL&&(U[1]=H.standbyServerURL),E=Jn(U)}!O&&H.sessionPassword&&(O=H.sessionPassword),b=H.remark}(x==="200001"||x.startsWith("200001-"))&&(E&&E.length||(x="")),x||(N=1)}if(N&&(Kn.crypto||(C="Please upgrade your browser to support online key."),Kn.crypto.subtle||(C="Require https to use online key in this browser.")),C){if(N!==1)throw new Error(C);N=0,console.warn(C),v._lastErrorCode=-1,v._lastErrorString=C}return N===1&&(x="",console.warn("Applying for a public trial license ...")),{lt:N,l:x,ls:E,sp:O,rmk:b}}throw new Error("Can't preprocess license again"+Zt)})(L);this._pLoad.task=async(p,v)=>{let b=L.engineResourcePath+L._workerName;L.engineResourcePath.startsWith(location.origin)||(b=await fetch(b).then(C=>C.blob()).then(C=>URL.createObjectURL(C))),L._dbrWorker=new Worker(b),L._dbrWorker.onerror=C=>{let x=new Error(C.message);v(x)},L._dbrWorker.onmessage=async C=>{let x=C.data?C.data:C;switch(x.type){case"log":L._onLog&&L._onLog(x.message);break;case"load":{x.message&&(x.message=x.message.replace("(https://www.dynamsoft.com/purchase-center/)","(https://www.dynamsoft.com/store/dynamsoft-barcode-reader/#javascript)"));let E,O=!1;e===1&&(O=!0,x.message||(x.message="Using a temporary license. [Register for a 30-day trial license >>>](https://www.dynamsoft.com/customer/license/trialLicense?product=dbr&deploymenttype=browser)")),x.success?(L._dbrWorker.onerror=null,L._version=x.version+"(JS "+L._jsVersion+"."+L._jsEditVersion+")",L._onLog&&L._onLog("load dbr worker success"),x.message&&console.warn(x.message)):(E=new Error(x.message),E.stack=x.stack+`
`+E.stack,E.ltsErrorCode=x.ltsErrorCode,O||x.ltsErrorCode==111&&x.message.toLowerCase().indexOf("trial license")!=-1&&(O=!0)),O&&L.showDialog(x.success?"warn":"error",x.message),x.success?p():v(E);break}case"task":{let E=x.id,O=x.body;try{L._taskCallbackMap.get(E)(O),L._taskCallbackMap.delete(E)}catch(N){throw L._taskCallbackMap.delete(E),N}break}default:L._onLog&&L._onLog(C)}},L._dbrWorker.postMessage({type:"loadWasm",engineResourcePath:L.engineResourcePath,bUseFullFeature:L._bUseFullFeature,bd:L._bWasmDebug,v:L._jsVersion,brtk:!!e,bptk:e===1,l:i,dm:location.origin.startsWith("http")?location.origin:"https://localhost",os:Le,cv:L.authCacheVersion,fn:L.deviceFriendlyName,ls:n,sp:h,rmk:d})}}await this._pLoad}static async showDialog(e,i){await(async(n,h,d)=>{if(!n._bNeverShowDialog)try{let p=await fetch(n.engineResourcePath+"dls.license.dialog.html");if(!p.ok)throw Error("Get license dialog fail. Network Error: "+p.statusText);let v=await p.text();if(!v.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let b=document.createElement("div");b.innerHTML=v;let C=[];for(let Y=0;Y<b.childElementCount;++Y){let G=b.children[Y];G instanceof HTMLStyleElement&&(C.push(G),document.head.append(G))}let x=b.childElementCount==1?b.children[0]:b;x.remove();let E,O,N,k,H,U=[x],ee=x.children;for(let Y of ee)U.push(Y);for(let Y=0;Y<U.length;++Y)for(let G of U[Y].children)U.push(G);for(let Y of U)if(!E&&Y.classList.contains("dls-license-mask"))E=Y,Y.addEventListener("click",G=>{if(Y==G.target){x.remove();for(let re of C)re.remove()}});else if(!O&&Y.classList.contains("dls-license-icon-close"))O=Y,Y.addEventListener("click",()=>{x.remove();for(let G of C)G.remove()});else if(!N&&Y.classList.contains("dls-license-icon-error"))N=Y,h!="error"&&Y.remove();else if(!k&&Y.classList.contains("dls-license-icon-warn"))k=Y,h!="warn"&&Y.remove();else if(!H&&Y.classList.contains("dls-license-msg-content")){H=Y;let G=d;for(;G;){let re=G.indexOf("["),de=G.indexOf("]",re),fe=G.indexOf("(",de),_e=G.indexOf(")",fe);if(re==-1||de==-1||fe==-1||_e==-1){Y.appendChild(new Text(G));break}re>0&&Y.appendChild(new Text(G.substring(0,re)));let y=document.createElement("a"),ge=G.substring(re+1,de);y.innerText=ge;let me=G.substring(fe+1,_e);y.setAttribute("href",me),y.setAttribute("target","_blank"),Y.appendChild(y),G=G.substring(_e+1)}}document.body.appendChild(x)}catch(p){n._onLog&&n._onLog(p.message||p)}})(this,e,i)}static async createInstanceInWorker(e=!1){return await L.loadWasm(),await new Promise((i,n)=>{let h=L._nextTaskID++;L._taskCallbackMap.set(h,d=>{if(d.success)return i(d.instanceID);{let p=new Error(d.message);return p.stack=d.stack+`
`+p.stack,n(p)}}),L._dbrWorker.postMessage({type:"createInstance",id:h,bScanner:e})})}static async createInstance(){const e=new L;return e._instanceID=await L.createInstanceInWorker(),L._fireHTTPSWarnning(),e}async clearMapDecodeRecord(){return await new Promise((e,i)=>{let n=L._nextTaskID++;L._taskCallbackMap.set(n,h=>{if(h.success)return e();{let d=new Error(h.message);return d.stack=h.stack+`
`+d.stack,i(d)}}),L._dbrWorker.postMessage({type:"clearMapDecodeRecord",id:n,instanceID:this._instanceID})})}async decode(e){L._onLog&&L._onLog("decode(source: any)"),L._onLog&&(this._timeStartDecode=Date.now());{let i={};return!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),e instanceof Blob?await this._decode_Blob(e,i):e instanceof ArrayBuffer?await this._decode_ArrayBuffer(e,i):e instanceof Uint8Array||e instanceof Uint8ClampedArray?await this._decode_Uint8Array(e,i):e instanceof HTMLImageElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap?await this._decode_Image(e,i):e instanceof HTMLCanvasElement?await this._decode_Canvas(e,i):e instanceof HTMLVideoElement?await this._decode_Video(e,i):typeof e=="string"?e.substring(0,11)=="data:image/"?await this._decode_Base64(e,i):await this._decode_Url(e,i):L.isDCEFrame(e)?(i.bCopyData=!0,await this._decode_DCEFrame(e,i)):L.isDSImage(e)?(i.bCopyData=!0,await this._decode_DSImage(e,i)):await Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))}}async decodeBase64String(e){let i={};return!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),this._decode_Base64(e,i)}async decodeUrl(e){let i={};return!this.region||this.region instanceof Array||(i.region=JSON.parse(JSON.stringify(this.region))),this._decode_Url(e,i)}async _decodeBuffer_Uint8Array(e,i,n,h,d,p,v){return await new Promise((b,C)=>{let x=L._nextTaskID++;L._taskCallbackMap.set(x,E=>{if(E.success){let O,N=L._onLog?Date.now():0;L._onLog&&L._onLog("worker return result: "+N),this._lastInnerDecodeDuration=E.duration;try{O=this._handleRetJsonString(E.decodeReturn)}catch(k){return C(k)}if(L._onLog){let k=Date.now();L._onLog("DBR getting message from worker timestamp: "+N),L._onLog("From DBR staring decoding to entering worker costs: "+(this._timeEnterInnerDBR-this._timeStartDecode)),L._onLog("From DBR entering worker to returning message from worker costs: "+(N-this._timeEnterInnerDBR)),L._onLog("Handling results from DBR worker costs: "+(k-N)),L._onLog("Total decoding image costs: "+(k-this._timeStartDecode))}return b(O)}{let O=new Error(E.message);return O.stack=E.stack+`
`+O.stack,C(O)}}),this._timeEnterInnerDBR=Date.now(),L._onLog&&L._onLog("Sending buffer to worker timestamp:"+this._timeEnterInnerDBR),L._dbrWorker.postMessage({type:"decodeBuffer",id:x,instanceID:this._instanceID,body:{buffer:e,width:i,height:n,stride:h,format:d,orientation:p,config:v}},[e.buffer]),L._onLog&&v&&v.timeStamp&&L._onLog("Delay of decoding image: "+(this._timeEnterInnerDBR-v.timeStamp))})}async _decodeBuffer_Blob(e,i,n,h,d,p,v){L._onLog&&L._onLog("_decodeBuffer_Blob(buffer,width,height,stride,format)");const b=e.arrayBuffer?await e.arrayBuffer():await new Promise((C,x)=>{let E=new FileReader;E.readAsArrayBuffer(e),E.onload=()=>{C(E.result)},E.onerror=()=>{x(E.error)}});return await this._decodeBuffer_Uint8Array(new Uint8Array(b),i,n,h,d,p,v)}async decodeBuffer(e,i,n,h,d,p,v){let b;return L._onLog&&L._onLog("decodeBuffer(buffer,width,height,stride,format)"),L._onLog&&(this._timeStartDecode=Date.now()),e instanceof Uint8Array||e instanceof Uint8ClampedArray?b=await this._decodeBuffer_Uint8Array(e,i,n,h,d,p,v):e instanceof ArrayBuffer?b=await this._decodeBuffer_Uint8Array(new Uint8Array(e),i,n,h,d,p,v):e instanceof Blob&&(b=await this._decodeBuffer_Blob(e,i,n,h,d,p,v)),b}async _decodeFileInMemory_Uint8Array(e){return await new Promise((i,n)=>{let h=L._nextTaskID++;L._taskCallbackMap.set(h,d=>{if(d.success){let p;this._lastInnerDecodeDuration=d.duration;try{p=this._handleRetJsonString(d.decodeReturn)}catch(v){return n(v)}return i(p)}{let p=new Error(d.message);return p.stack=d.stack+`
`+p.stack,n(p)}}),L._dbrWorker.postMessage({type:"decodeFileInMemory",id:h,instanceID:this._instanceID,body:{bytes:e}})})}async getRuntimeSettings(){return await new Promise((e,i)=>{let n=L._nextTaskID++;L._taskCallbackMap.set(n,h=>{if(h.success){let d=JSON.parse(h.results);return this.userDefinedRegion!=null&&(d.region=JSON.parse(JSON.stringify(this.userDefinedRegion))),e(d)}{let d=new Error(h.message);return d.stack=h.stack+`
`+d.stack,i(d)}}),L._dbrWorker.postMessage({type:"getRuntimeSettings",id:n,instanceID:this._instanceID})})}async updateRuntimeSettings(e){let i;if(typeof e=="string")if(e=="speed"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0]}else if(e=="balance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=5,i.expectedBarcodesCount=512,i.localizationModes=[2,16,0,0,0,0,0,0]}else if(e=="coverage"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region}else if(e=="dense"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=9,i.expectedBarcodesCount=0,i.localizationModes=[2,8,0,0,0,0,0,0]}else if(e=="distance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,i.region=n.region,i.deblurLevel=3,i.expectedBarcodesCount=0,i.localizationModes=[2,8,0,0,0,0,0,0]}else i=JSON.parse(e);else{if(typeof e!="object")throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(e)),i.region instanceof Array){let n=i.region;[n.regionLeft,n.regionTop,n.regionLeft,n.regionBottom,n.regionMeasuredByPercentage].some(h=>h!==void 0)&&(i.region={regionLeft:n.regionLeft||0,regionTop:n.regionTop||0,regionRight:n.regionRight||0,regionBottom:n.regionBottom||0,regionMeasuredByPercentage:n.regionMeasuredByPercentage||0})}}if(!L._bUseFullFeature){if((i.barcodeFormatIds&~(Ue.BF_ONED|Ue.BF_QR_CODE|Ue.BF_PDF417|Ue.BF_DATAMATRIX))!=0||i.barcodeFormatIds_2!=0)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(i.intermediateResultTypes!=0)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}if(this.bFilterRegionInJs){let n=i.region;if(n instanceof Array)throw Error("The `region` of type `Array` is only allowed in `BarcodeScanner`.");this.userDefinedRegion=JSON.parse(JSON.stringify(n)),(n.regionLeft||n.regionTop||n.regionRight||n.regionBottom||n.regionMeasuredByPercentage)&&(n.regionLeft||n.regionTop||n.regionRight!=100||n.regionBottom!=100||!n.regionMeasuredByPercentage)?this.region=n:this.region=null,i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0}}else this.userDefinedRegion=null,this.region=null;return(this.autoZoom||this.autoFocus)&&(i.intermediateResultTypes|=Bt.IRT_TYPED_BARCODE_ZONE),await new Promise((n,h)=>{let d=L._nextTaskID++;L._taskCallbackMap.set(d,p=>{if(p.success){try{this._handleRetJsonString(p.updateReturn)}catch(v){h(v)}return n()}{let v=new Error(p.message);return v.stack=p.stack+`
`+v.stack,h(v)}}),L._dbrWorker.postMessage({type:"updateRuntimeSettings",id:d,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})})}async resetRuntimeSettings(){return this.userDefinedRegion=null,this.region=null,this.maxCvsSideLength=ir,await new Promise((e,i)=>{let n=L._nextTaskID++;L._taskCallbackMap.set(n,h=>{if(h.success)return e();{let d=new Error(h.message);return d.stack=h.stack+`
`+d.stack,i(d)}}),L._dbrWorker.postMessage({type:"resetRuntimeSettings",id:n,instanceID:this._instanceID})})}async _resetRuntimeSettingsToCppDefault(){return this.userDefinedRegion=null,this.region=null,this.maxCvsSideLength=ir,await new Promise((e,i)=>{let n=L._nextTaskID++;L._taskCallbackMap.set(n,h=>{if(h.success)return e();{let d=new Error(h.message);return d.stack=h.stack+`
`+d.stack,i(d)}}),L._dbrWorker.postMessage({type:"resetRuntimeSettingsToCppDefault",id:n,instanceID:this._instanceID})})}async outputRuntimeSettingsToString(){if(!L._bUseFullFeature)throw Error("outputRuntimeSettingsToString() is not supported in the compact version. Please try the full-featured version.");return await new Promise((e,i)=>{let n=L._nextTaskID++;L._taskCallbackMap.set(n,h=>{if(h.success)return e(h.results);{let d=new Error(h.message);return d.stack=h.stack+`
`+d.stack,i(d)}}),L._dbrWorker.postMessage({type:"outputRuntimeSettingsToString",id:n,instanceID:this._instanceID})})}async initRuntimeSettingsWithString(e){if(!L._bUseFullFeature)throw Error("initRuntimeSettingsWithString() is not supported in the compact version. Please try the full-featured version.");if(typeof e=="string")e=e;else{if(typeof e!="object")throw TypeError("'initRuntimeSettingstWithString(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");e=JSON.stringify(e)}return await new Promise((i,n)=>{let h=L._nextTaskID++;L._taskCallbackMap.set(h,d=>{if(d.success){try{this._handleRetJsonString(d.initReturn)}catch(p){n(p)}return i()}{let p=new Error(d.message);return p.stack=d.stack+`
`+p.stack,n(p)}}),L._dbrWorker.postMessage({type:"initRuntimeSettingsWithString",id:h,instanceID:this._instanceID,body:{settings:e}})})}async _decode_Blob(e,i){L._onLog&&L._onLog("_decode_Blob(blob: Blob)");let n=null,h=null;if(typeof createImageBitmap<"u")try{n=await createImageBitmap(e)}catch(p){}n||(h=await function(p){return new Promise((v,b)=>{let C=URL.createObjectURL(p),x=new Image;x.dbrObjUrl=C,x.src=C,x.onload=()=>{v(x)},x.onerror=E=>{b(new Error("Can't convert blob to image : "+(E instanceof Event?E.type:E)))}})}(e));let d=await this._decode_Image(n||h,i);return n&&n.close(),d}async _decode_ArrayBuffer(e,i){return await this._decode_Blob(new Blob([e]),i)}async _decode_Uint8Array(e,i){return await this._decode_Blob(new Blob([e]),i)}async _decode_Image(e,i){L._onLog&&L._onLog("_decode_Image(image: HTMLImageElement|ImageBitmap)"),i=i||{};let n,h,d=e instanceof HTMLImageElement?e.naturalWidth:e.width,p=e instanceof HTMLImageElement?e.naturalHeight:e.height,v=Math.max(d,p);if(v>this._maxCvsSideLength){let x=this._maxCvsSideLength/v;n=Math.round(d*x),h=Math.round(p*x)}else n=d,h=p;this.canvas||(this.canvas=document.createElement("canvas"));const b=this.canvas;b.width===n&&b.height===h||(b.width=n,b.height=h),b.ctx2d||(b.ctx2d=b.getContext("2d",{willReadFrequently:!0})),b.ctx2d.drawImage(e,0,0,d,p,0,0,n,h),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl);let C=await this._decode_Canvas(b,i);if(this.ifSaveOriginalImageInACanvas){const x=document.createElement("canvas");x.width=e.width,x.height=e.height,x.getContext("2d").drawImage(e,0,0),this.oriCanvas=x,this.oriCanvasData=null}return L.recalculateResultLocation(C,0,0,d,p,n,h),C}async _decode_Canvas(e,i){if(L._onLog&&L._onLog("_decode_Canvas(canvas:HTMLCanvasElement)"),e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if(e.width===0||e.height===0)throw Error("The width or height of the 'canvas' is 0.");this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=e,this.oriCanvasData=null);let n=(e.ctx2d||e.getContext("2d",{willReadFrequently:!0})).getImageData(0,0,e.width,e.height).data;return await this._decodeBuffer_Uint8Array(n,e.width,e.height,4*e.width,Ie.IPF_ABGR_8888,0,i)}async _decode_Video(e,i){if(L._onLog&&L._onLog("_decode_Video(video)"),!(e instanceof HTMLVideoElement))throw TypeError("'_decode_Video(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";i=i||{};let n,h,d=e.videoWidth,p=e.videoHeight,v=Math.max(d,p);if(v>this._maxCvsSideLength){let x=this._maxCvsSideLength/v;n=Math.round(d*x),h=Math.round(p*x)}else n=d,h=p;this.canvas||(this.canvas=document.createElement("canvas"));const b=this.canvas;b.width===n&&b.height===h||(b.width=n,b.height=h),b.ctx2d||(b.ctx2d=b.getContext("2d",{willReadFrequently:!0})),b.ctx2d.drawImage(e,0,0,d,p,0,0,n,h);let C=await this._decode_Canvas(b,i);if(this.ifSaveOriginalImageInACanvas){const x=document.createElement("canvas");x.width=e.videoWidth,x.height=e.videoHeight,x.getContext("2d").drawImage(e,0,0),this.oriCanvas=x,this.oriCanvasData=null}return L.recalculateResultLocation(C,0,0,d,p,n,h),C}async _decode_DCEFrame(e,i){if(L._onLog&&L._onLog("_decode_DCEFrame(dceFrame)"),!L.isDCEFrame(e))return[];let n=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,colorMode:e.colorMode,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{width:h,height:d,colorMode:p,pixelFormat:v,stride:b,timeStamp:C}=e;let x;x=i&&i.bCopyData?new Uint8Array(e.data):e.data;let E=null;if(i?(E=JSON.parse(JSON.stringify(i)),E.timeStamp=C):E={timeStamp:C},v&&b)if(v==="grey")n=await this._decodeBuffer_Uint8Array(x,h,d,b,Ie.IPF_GrayScaled,0,E);else if(v==="rgba")n=await this._decodeBuffer_Uint8Array(x,h,d,b,Ie.IPF_ABGR_8888,0,E);else{if(v!=="bgra")throw new Error(`Pixel format '${v}' is not supported to decode.`);n=await this._decodeBuffer_Uint8Array(x,h,d,b,Ie.IPF_ARGB_8888,0,E)}else if(p==="grey")n=await this._decodeBuffer_Uint8Array(x,h,d,h,Ie.IPF_GrayScaled,0,E);else if(p==="rgba")n=await this._decodeBuffer_Uint8Array(x,h,d,4*h,Ie.IPF_ABGR_8888,0,E);else{if(p!=="bgra")throw new Error(`Color mode '${p}' is not supported to decode.`);n=await this._decodeBuffer_Uint8Array(x,h,d,4*h,Ie.IPF_ARGB_8888,0,E)}return n}async _decode_DSImage(e,i){if(L._onLog&&L._onLog("_decode_DSImage(dsImage)"),!L.isDSImage(e))return null;this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat.toLowerCase(),data:new Uint8Array(e.data),toCanvas:function(){const C=document.createElement("canvas");let x;switch(C.width=this.width,C.height=this.height,this.pixelFormat){case"grey":x=new Uint8ClampedArray(this.width*this.height*4);for(let O=0;O<x.length;O+=4)x[O]=this.data[O/4],x[O+1]=this.data[O/4],x[O+2]=this.data[O/4],x[O+3]=255;break;case"rgb":x=new Uint8ClampedArray(this.width*this.height*4);for(let O=0;O<x.length;O+=4)x[O]=this.data[O],x[O+1]=this.data[O+1],x[O+2]=this.data[O+2],x[O+3]=255;break;case"bgr":x=new Uint8ClampedArray(this.width*this.height*4);for(let O=0;O<x.length;O+=4)x[O]=this.data[O],x[O+1]=this.data[O+1],x[O+2]=this.data[O+2],x[O+3]=255;break;case"rgba":case"bgra":x=new Uint8ClampedArray(this.data);break;default:throw new Error("The content of 2D Canvas is currently limited to the sRGB color space.")}const E=new ImageData(x,this.width,this.height);return C.getContext("2d").putImageData(E,0,0),C}});const{width:n,height:h}=e;let d,p,v,b=e.pixelFormat.toLowerCase();switch(d=i&&i.bCopyData?new Uint8Array(e.data):e.data,b){case"grey":v=Ie.IPF_GrayScaled,p=n;break;case"rgb":v=Ie.IPF_BGR_888,p=3*n;break;case"bgr":v=Ie.IPF_RGB_888,p=3*n;break;case"rgba":v=Ie.IPF_ABGR_8888,p=4*n;break;case"bgra":v=Ie.IPF_ARGB_8888,p=4*n;break;default:throw new Error("The pixel format is not supported to decode.")}return await this._decodeBuffer_Uint8Array(d,n,h,p,v,0,i)}async _decode_Base64(e,i){if(L._onLog&&L._onLog("_decode_Base64(base64Str)"),typeof e!="string")return Promise.reject("'_decode_Base64(base64Str, config)': Type of 'base64Str' should be 'string'.");e.substring(0,11)=="data:image/"&&(e=e.substring(e.indexOf(",")+1));{let n=atob(e),h=n.length,d=new Uint8Array(h);for(;h--;)d[h]=n.charCodeAt(h);return await this._decode_Blob(new Blob([d]),i)}}async _decode_Url(e,i){if(L._onLog&&L._onLog("_decode_Url(url)"),typeof e!="string")throw TypeError("'_decode_Url(url, config)': Type of 'url' should be 'string'.");e=e;{let n=await new Promise((h,d)=>{let p=new XMLHttpRequest;p.open("GET",e,!0),p.responseType="blob",p.send(),p.onloadend=async()=>{h(p.response)},p.onerror=()=>{d(new Error("Network Error: "+p.statusText))}});return await this._decode_Blob(n,i)}}async _decode_FilePath(e,i){throw L._onLog&&L._onLog("_decode_FilePath(path)"),Error("'_decode_FilePath(path, config)': The method is only supported in node environment.")}static recalculateResultLocation(e,i,n,h,d,p,v){if(e.length>0)for(let b of e){let C=b.localizationResult;C.resultCoordinateType==2&&(C.x1*=.01*p,C.x2*=.01*p,C.x3*=.01*p,C.x4*=.01*p,C.y1*=.01*v,C.y2*=.01*v,C.y3*=.01*v,C.y4*=.01*v);let x=p/h,E=v/d;C.x1=C.x1/x+i,C.x2=C.x2/x+i,C.x3=C.x3/x+i,C.x4=C.x4/x+i,C.y1=C.y1/E+n,C.y2=C.y2/E+n,C.y3=C.y3/E+n,C.y4=C.y4/E+n,C.resultCoordinateType==2&&(C.x1*=100/h,C.x2*=100/h,C.x3*=100/h,C.x4*=100/h,C.y1*=100/d,C.y2*=100/d,C.y3*=100/d,C.y4*=100/d),C.x1=Math.round(C.x1),C.x2=Math.round(C.x2),C.x3=Math.round(C.x3),C.x4=Math.round(C.x4),C.y1=Math.round(C.y1),C.y2=Math.round(C.y2),C.y3=Math.round(C.y3),C.y4=Math.round(C.y4)}}static BarcodeReaderException(e,i){let n,h=Gi.DBR_UNKNOWN;return typeof e=="number"?(h=e,n=new Error(i)):n=new Error(e),n.code=h,n}_handleRetJsonString(e){let i=Gi;if(e.textResults){for(let n=0;n<e.textResults.length;n++){let h=e.textResults[n];try{let d=h.barcodeText,p="";for(let v=0;v<d.length;v++)p+=String.fromCharCode(d[v]);try{h.barcodeText=decodeURIComponent(escape(p))}catch(v){h.barcodeText=p}}catch(d){h.barcodeText=""}if(h.exception!=null){L._setWarnnedEx.has(h.exception)||(L._setWarnnedEx.add(h.exception),console.warn(h.exception));let d={};h.exception.split(";").forEach(p=>{let v=p.indexOf(":");d[p.substring(0,v)]=p.substring(v+1)}),h.exception=d}}return e.decodeRecords?this.decodeRecords=e.decodeRecords:this.decodeRecords={},this._lastErrorCode=e.exception,this._lastErrorString=e.description,e.exception&&!L._setWarnnedEx.has(e.description)&&(L._setWarnnedEx.add(e.description),console.warn(e.description)),e.textResults}if(e.exception==i.DBR_SUCCESS)return e.data;throw L.BarcodeReaderException(e.exception,e.description)}async setModeArgument(e,i,n,h){return await new Promise((d,p)=>{let v=L._nextTaskID++;L._taskCallbackMap.set(v,b=>{if(b.success){try{this._handleRetJsonString(b.setReturn)}catch(C){return p(C)}return d()}{let C=new Error(b.message);return C.stack=b.stack+`
`+C.stack,p(C)}}),L._dbrWorker.postMessage({type:"setModeArgument",id:v,instanceID:this._instanceID,body:{modeName:e,index:i,argumentName:n,argumentValue:h}})})}async getModeArgument(e,i,n){return await new Promise((h,d)=>{let p=L._nextTaskID++;L._taskCallbackMap.set(p,v=>{if(v.success){let b;try{b=this._handleRetJsonString(v.getReturn)}catch(C){return d(C)}return h(b)}{let b=new Error(v.message);return b.stack=v.stack+`
`+b.stack,d(b)}}),L._dbrWorker.postMessage({type:"getModeArgument",id:p,instanceID:this._instanceID,body:{modeName:e,index:i,argumentName:n}})})}async getIntermediateResults(){return await new Promise((e,i)=>{let n=L._nextTaskID++;L._taskCallbackMap.set(n,h=>{if(h.success)return e(h.results);{let d=new Error(h.message);return d.stack=h.stack+`
`+d.stack,i(d)}}),L._dbrWorker.postMessage({type:"getIntermediateResults",id:n,instanceID:this._instanceID,body:{isCharge:!0}})})}async getIntermediateCanvas(){let e=await this.getIntermediateResults(),i=[];for(let n of e)if(n.dataType==Tr.IMRDT_IMAGE)for(let h of n.results){const d=h.bytes;let p;switch(L._onLog&&L._onLog(" "+d.length+" "+d.byteLength+" "+h.width+" "+h.height+" "+h.stride+" "+h.format),h.format){case Ie.IPF_ABGR_8888:p=new Uint8ClampedArray(d);break;case Ie.IPF_RGB_888:{const C=d.length/3;p=new Uint8ClampedArray(4*C);for(let x=0;x<C;++x)p[4*x]=d[3*x+2],p[4*x+1]=d[3*x+1],p[4*x+2]=d[3*x],p[4*x+3]=255;break}case Ie.IPF_GrayScaled:{const C=d.length;p=new Uint8ClampedArray(4*C);for(let x=0;x<C;x++)p[4*x]=p[4*x+1]=p[4*x+2]=d[x],p[4*x+3]=255;break}case Ie.IPF_Binary:case Ie.IPF_BinaryInverted:{const C=d.length,x=h.width,E=h.height,O=h.stride;p=new Uint8ClampedArray(x*E*4);for(let N=0;N<C;N++){let k=d[N],H=N%O*8,U=Math.floor(N/O);for(let ee=0;ee<8;ee++){let Y=H+ee,G=4*(U*x+Y);if(Y>=x)break;p[G]=p[G+1]=p[G+2]=(128&k)/128*255,p[G+3]=255,k<<=1}}break}default:console.warn("unknow intermediate image",h)}if(!p)continue;let v=new ImageData(p,h.width,h.height),b=document.createElement("canvas");b.width=h.width,b.height=h.height,b.getContext("2d").putImageData(v,0,0),i.push(b)}return i}async getScanSettings(){return await new Promise((e,i)=>{let n=L._nextTaskID++;L._taskCallbackMap.set(n,h=>{if(h.success){let d=h.results;return d.intervalTime=this.intervalTime,d.whenToPlaySoundforSuccessfulRead=this.whenToPlaySoundforSuccessfulRead,d.soundOnSuccessfullRead=this.soundSource,d.whenToVibrateforSuccessfulRead=this.whenToVibrateforSuccessfulRead,d.vibrateDuration=this.vibrateDuration,d.captureAndDecodeInParallel=this.captureAndDecodeInParallel,d.autoZoom=this.autoZoom,d.autoFocus=this.autoFocus,d.autoSuggestTip=this.autoSuggestTip,e(d)}{let d=new Error(h.message);return d.stack+=`
`+h.stack,i(d)}}),L._dbrWorker.postMessage({type:"getScanSettings",id:n,instanceID:this._instanceID})})}async updateScanSettings(e){if(!e)return;const i=JSON.parse(JSON.stringify(e));if(i.autoZoom||i.autoFocus||i.autoSuggestTip){if(!L._bUseFullFeature)throw new Error("'autoZoom', 'autoFocus' and 'autoSuggestTip' are not supported in the compact version. Please try the full-featured version.");const n=await this.getRuntimeSettings();n.intermediateResultTypes|=Bt.IRT_TYPED_BARCODE_ZONE,await this.updateRuntimeSettings(n)}return i.hasOwnProperty("intervalTime")&&(this.intervalTime=Math.max(i.intervalTime,0),delete i.intervalTime),i.hasOwnProperty("whenToPlaySoundforSuccessfulRead")&&(this.whenToPlaySoundforSuccessfulRead=i.whenToPlaySoundforSuccessfulRead,delete i.whenToPlaySoundforSuccessfulRead),i.hasOwnProperty("soundOnSuccessfullRead")&&(this.soundSource=i.soundOnSuccessfullRead,delete i.soundOnSuccessfullRead),i.hasOwnProperty("whenToVibrateforSuccessfulRead")&&(this.whenToVibrateforSuccessfulRead=i.whenToVibrateforSuccessfulRead,delete i.whenToVibrateforSuccessfulRead),i.hasOwnProperty("vibrateDuration")&&(this.vibrateDuration=i.vibrateDuration,delete i.vibrateDuration),i.hasOwnProperty("captureAndDecodeInParallel")&&(this.captureAndDecodeInParallel=i.captureAndDecodeInParallel,delete i.captureAndDecodeInParallel),i.hasOwnProperty("autoZoom")&&(this.autoZoom&&this.autoZoom!=i.autoZoom&&this.dce&&this.dce.setZoom({factor:1}).catch(()=>{}),this.autoZoom=i.autoZoom,delete i.autoZoom),i.hasOwnProperty("autoFocus")&&(this.autoFocus=i.autoFocus,this.dce&&this.dce.setFocus({mode:"continuous"}).catch(()=>{}),delete i.autoFocus),i.hasOwnProperty("autoSuggestTip")&&(this.autoSuggestTip=i.autoSuggestTip,delete i.autoFocus),await new Promise((n,h)=>{let d=L._nextTaskID++;L._taskCallbackMap.set(d,p=>{if(p.success)return n();{let v=new Error(p.message);return v.stack+=`
`+p.stack,h(v)}}),L._dbrWorker.postMessage({type:"updateScanSettings",id:d,instanceID:this._instanceID,body:{settings:i}})})}_cloneDecodeResults(e){if(e instanceof Array){let i=[];for(let n of e)i.push(this._cloneDecodeResults(n));return i}{let i=e;return JSON.parse(JSON.stringify(i,(h,d)=>h=="oriVideoCanvas"||h=="searchRegionCanvas"?void 0:d))}}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),void this._drawResults(null);if(this.dce&&!this.dce.isOpen())return this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce&&!this._imgSource||this._bPauseScan)return L._onLog&&L._onLog("Scan is paused, or imageSource is not set. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause));L._onLog&&L._onLog("======= once read ======="),L._onLog&&(this._timeStartDecode=Date.now());let e=null,i=null;if(this.dce)e=this._getVideoFrame();else if(this._imgSource&&(i=await this._imgSource.getImage(),!L.isDSImage(i)))throw new Error("Invalid DSImage.");if(!e&&!i)return L._onLog&&L._onLog("Get invalid frame."),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0));(async()=>{let n=[];if(e){n=await this._decode_DCEFrame(e,{bScanner:!0,bCopyData:!1});let h=null;if(n&&n.length){const{sx:d,sy:p,width:v,height:b,_sWidth:C,_sHeight:x}=e;h=n.map(E=>({resultState:E.resultState,localizationResult:JSON.parse(JSON.stringify(E.localizationResult))})),L.recalculateResultLocation(h,d,p,C,x,v,b)}this._resultHighlightingDuration==0?this._drawResults(null):this._drawResults(h,n),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._resultHighlightingDuration>0&&(this._clearResultsCanvasTimeoutId=setTimeout(()=>{this.bDestroyed||this._drawResults(null)},this._resultHighlightingDuration))}else i&&(n=await this._decode_DSImage(i,{bScanner:!0,bCopyData:!1}));return n})().then(n=>{if(L._onLog&&L._onLog(n),this.dce&&this.captureAndDecodeInParallel){let h=this.array_decodeFrameTimeCost,d=this.array_getFrameTimeCost;const p=()=>{let v=0;if(d&&d.length){let b=Math.min(...h),C=Math.max(...d);b&&C&&(v=b-C)}else v=0;return v>0?v:0};(()=>{for(;h.length>=5;)h.shift();h.push(this._lastInnerDecodeDuration)})(),this._intervalGetVideoFrame=p()+this.intervalTime}if((this.dce&&this.dce.isOpen()||this._imgSource)&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&n.length){let h=!1;this.bPlaySoundOnSuccessfulRead===!0||this.bPlaySoundOnSuccessfulRead==="frame"?h=n.some(d=>d.resultState>=0):this.bPlaySoundOnSuccessfulRead==="unique"&&(h=n.some(d=>d.resultState==0)),h&&this.beepSound&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&n.length){let h=!1;if(this.bVibrateOnSuccessfulRead===!0||this.bVibrateOnSuccessfulRead==="frame"?h=n.some(d=>d.resultState>=0):this.bVibrateOnSuccessfulRead==="unique"&&(h=n.some(d=>d.resultState==0)),h)try{navigator.vibrate(this.vibrateDuration)}catch(d){console.warn("Vibration not allowed. User interaction required: "+(d.message||d))}}if(this.onImageRead){n=n.filter(d=>d.resultState>=0);const h=this._cloneDecodeResults(n);this.onImageRead(h)}if(this.onUniqueRead){n=n.filter(d=>d.resultState==0);const h=this._cloneDecodeResults(n);for(let d of h)this.onUniqueRead(d.barcodeText,d)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this.intervalTime):this._loopReadVideo()}).catch(n=>{this.dce&&this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),L._onLog&&L._onLog(n.message||n),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},Math.max(this.intervalTime,1e3)),n.message=="platform error"||console.warn(n.message)})}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){if(L._onLog&&L._onLog("Get frame in parallel."),this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",this._intervalGetVideoFrame),!this.dce.numberOfFramesInBuffer)return this._dceControler&&this._dceControler.setDisiredValue(this,"loopInterval",0),null;e=this.dce.getFrameFromBuffer(),(n=>{if(!n)return;let h=n.timeSpent,d=this.array_getFrameTimeCost;for(;d.length>=5;)d.shift();d.push(h)})(e)}else L._onLog&&L._onLog("Get frame in serial."),this._dceControler&&this._dceControler.setDisiredAction(this,"stopFetchingLoop"),e=this.dce.getFrame();return e}_drawResults(e,i){if(!this.dce||this.dce.disposed||this._bPauseScan||!this._drawingItemNamespace||!this._drawingItemNamespace.DT_Polygon)return;if(!this._dbrDrawingLayer){if(!this.dce.isOpen()||!(this.dce.singleFrameMode||this.dce.video&&this.dce._videoTrack))return;this._dbrDrawingLayer=this.dce.getDrawingLayer(3)}const n=this._dbrDrawingLayer;e||(e=[]);let h=this._arrPolygons;for(let d=0;d<e.length;d++){let p,v=e[d].localizationResult;h[d]?(p=h[d],n.hasDrawingItem(p)||n.addDrawingItem(p),p.set("vertices",[{x:v.x1,y:v.y1},{x:v.x2,y:v.y2},{x:v.x3,y:v.y3},{x:v.x4,y:v.y4}]),(p.set||p.setAttribute).call(p,"vertices",[{x:v.x1,y:v.y1},{x:v.x2,y:v.y2},{x:v.x3,y:v.y3},{x:v.x4,y:v.y4}])):(p=new this._drawingItemNamespace.DT_Polygon([{x:v.x1,y:v.y1},{x:v.x2,y:v.y2},{x:v.x3,y:v.y3},{x:v.x4,y:v.y4}]),n.addDrawingItem(p),h[d]=p),e[d].resultState===-1?(p.styleId=this._styleIdBeforeVerification,p._mapStyle.set("default",this.dce.getDrawingStyle(this._styleIdBeforeVerification)),p._mapStyle.set("selected",this.dce.getDrawingStyle(this._styleIdBeforeVerification))):(p.styleId=null,p._mapStyle.set("default",this.dce.getDrawingStyle(3)),p._mapStyle.set("selected",this.dce.getDrawingStyle(7))),i&&i[d]?p.addNote({name:"Barcode_Result",content:i[d]},!0):p.addNote({name:"Barcode_Result",content:e[d]},!0)}for(let d=e.length;d<h.length;d++)h[d].deleteNote("Barcode_Result"),n.removeDrawingItem(h[d]);n.renderAll()}async startScanning(e){if(!this.dce&&!this._imgSource)throw new Error("'imageSource' is not set. call 'setImageSource()' before 'startScanning()'.");if(this._promiseStartScan&&this._promiseStartScan.isPending)return this._promiseStartScan;this._promiseStartScan=new Eo;let i=null;if(this.dce){if(this.dce.isOpen())if(e&&this.dce.appendAndShowUI(),this.dce.playCallbackInfo)i=JSON.parse(JSON.stringify(this.dce.playCallbackInfo));else{const n=this.dce.getSelectedCamera();i={width:this.dce.video.videoWidth,height:this.dce.video.videoHeight,deviceId:n&&n.deviceId}}else if(i=await this.dce.open(e),!this._promiseStartScan)return null;this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"close"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}return this._bPauseScan=!1,this.dce&&this.dce.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this.dce&&(this.dce.startFetchingLoop(),this._dceControler&&this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"})),this._loopReadVideo()},0)),this._promiseStartScan.resolve(i),i}stopScanning(e){this.dce&&(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"close",[e]))),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._promiseStartScan=null}pauseScanning(e){if(this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce){if(this.dce.singleFrameMode)throw new Error("'pauseScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this._dceControler&&(this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!1),this.dce.ifShowScanRegionLaser||this.dce.hideScanRegionLaser(),this._dceControler.setDisiredAction(this,"stopFetchingLoop"))}}resumeScanning(){if(this._bPauseScan=!1,this.dce){if(this.dce.singleFrameMode)throw new Error("'resumeScanning()' is unavailable when property 'singleFrameMode' of the 'CameraEnhancer' instance is true.");this.dce.startFetchingLoop(),this._dceControler&&(this._dceControler.clearUserDisiredAction({user:this,actionName:"stopFetchingLoop"}),this._dceControler.setDisiredValue(this,"ifShowScanRegionLaser",!0),this.dce.ifShowScanRegionLaser&&this.dce.showScanRegionLaser())}}destroyContext(){if(L._onLog&&L._onLog("destroyContext()"),this.bDestroyed)return;this.bDestroyed=!0,(this.dce||this._promiseStartScan)&&this.stopScanning(),this.setImageSource(null);let e=L._nextTaskID++;L._taskCallbackMap.set(e,i=>{if(!i.success){let n=new Error(i.message);throw n.stack=i.stack+`
`+n.stack,n}}),L._dbrWorker.postMessage({type:"destroyContext",id:e,instanceID:this._instanceID})}}L._jsVersion="9.6.32",L._jsEditVersion="20231027",L._version=`loading...(JS ${L._jsVersion}.${L._jsEditVersion})`,L._license=sh,L._sessionPassword=oh,L.browserInfo=Le,L._workerName=`dbr-${L._jsVersion}.browser.worker.js`,L._engineResourcePath=nh,L._licenseServer=[],L._deviceFriendlyName="",L._isShowRelDecodeTimeInResults=!1,L._bWasmDebug=!1,L._bNeverShowDialog=!1,L.__bUseFullFeature=!0,L._nextTaskID=0,L._taskCallbackMap=new Map,L._pLoad=new Eo,L._lastErrorCode=0,L._lastErrorString="",L._setWarnnedEx=new Set,L._defaultUIElementURL="@engineResourcePath/dbr.ui.html";var ah={653:(t,e,i)=>{var n,h,d,p,v,b,C,x,E,O,N,k,H,U,ee,Y,G,re,de,fe,_e,y=y||{version:"5.2.1"};if(e.fabric=y,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?y.document=document:y.document=document.implementation.createHTMLDocument(""),y.window=window;else{var ge=new(i(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;y.document=ge.document,y.jsdomImplForWrapper=i(898).implForWrapper,y.nodeCanvas=i(245).Canvas,y.window=ge,DOMParser=y.window.DOMParser}function me(a,s){var l=a.canvas,u=s.targetCanvas,r=u.getContext("2d");r.translate(0,u.height),r.scale(1,-1);var o=l.height-u.height;r.drawImage(l,0,o,u.width,u.height,0,0,u.width,u.height)}function we(a,s){var l=s.targetCanvas.getContext("2d"),u=s.destinationWidth,r=s.destinationHeight,o=u*r*4,c=new Uint8Array(this.imageBuffer,0,o),_=new Uint8ClampedArray(this.imageBuffer,0,o);a.readPixels(0,0,u,r,a.RGBA,a.UNSIGNED_BYTE,c);var f=new ImageData(_,u,r);l.putImageData(f,0,0)}y.isTouchSupported="ontouchstart"in y.window||"ontouchstart"in y.document||y.window&&y.window.navigator&&y.window.navigator.maxTouchPoints>0,y.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",y.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],y.DPI=96,y.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",y.commaWsp="(?:\\s+,?\\s*|,\\s*)",y.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,y.reNonWord=/[ \n\.,;!\?\-]/,y.fontPaths={},y.iMatrix=[1,0,0,1,0,0],y.svgNS="http://www.w3.org/2000/svg",y.perfLimitSizeTotal=2097152,y.maxCacheSideLimit=4096,y.minCacheSideLimit=256,y.charWidthsCache={},y.textureSize=2048,y.disableStyleCopyPaste=!1,y.enableGLFiltering=!0,y.devicePixelRatio=y.window.devicePixelRatio||y.window.webkitDevicePixelRatio||y.window.mozDevicePixelRatio||1,y.browserShadowBlurConstant=1,y.arcToSegmentsCache={},y.boundsOfCurveCache={},y.cachesBoundsOfCurve=!0,y.forceGLPutImageData=!1,y.initFilterBackend=function(){return y.enableGLFiltering&&y.isWebglSupported&&y.isWebglSupported(y.textureSize)?(console.log("max texture size: "+y.maxTextureSize),new y.WebglFilterBackend({tileSize:y.textureSize})):y.Canvas2dFilterBackend?new y.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=y),function(){function a(l,u){if(this.__eventListeners[l]){var r=this.__eventListeners[l];u?r[r.indexOf(u)]=!1:y.util.array.fill(r,!1)}}function s(l,u){var r=function(){u.apply(this,arguments),this.off(l,r)}.bind(this);this.on(l,r)}y.Observable={fire:function(l,u){if(!this.__eventListeners)return this;var r=this.__eventListeners[l];if(!r)return this;for(var o=0,c=r.length;o<c;o++)r[o]&&r[o].call(this,u||{});return this.__eventListeners[l]=r.filter(function(_){return _!==!1}),this},on:function(l,u){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var r in l)this.on(r,l[r]);else this.__eventListeners[l]||(this.__eventListeners[l]=[]),this.__eventListeners[l].push(u);return this},once:function(l,u){if(arguments.length===1)for(var r in l)s.call(this,r,l[r]);else s.call(this,l,u);return this},off:function(l,u){if(!this.__eventListeners)return this;if(arguments.length===0)for(l in this.__eventListeners)a.call(this,l);else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in l)a.call(this,r,l[r]);else a.call(this,l,u);return this}}}(),y.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var a=0,s=arguments.length;a<s;a++)this._onObjectAdded(arguments[a]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(a,s,l){var u=this._objects;return l?u[s]=a:u.splice(s,0,a),this._onObjectAdded&&this._onObjectAdded(a),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var a,s=this._objects,l=!1,u=0,r=arguments.length;u<r;u++)(a=s.indexOf(arguments[u]))!==-1&&(l=!0,s.splice(a,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[u]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(a,s){for(var l=this.getObjects(),u=0,r=l.length;u<r;u++)a.call(s,l[u],u,l);return this},getObjects:function(a){return a===void 0?this._objects.concat():this._objects.filter(function(s){return s.type===a})},item:function(a){return this._objects[a]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(a,s){return this._objects.indexOf(a)>-1||!!s&&this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(a,!0)})},complexity:function(){return this._objects.reduce(function(a,s){return a+(s.complexity?s.complexity():0)},0)}},y.CommonMethods={_setOptions:function(a){for(var s in a)this.set(s,a[s])},_initGradient:function(a,s){!a||!a.colorStops||a instanceof y.Gradient||this.set(s,new y.Gradient(a))},_initPattern:function(a,s,l){!a||!a.source||a instanceof y.Pattern?l&&l():this.set(s,new y.Pattern(a,l))},_setObject:function(a){for(var s in a)this._set(s,a[s])},set:function(a,s){return typeof a=="object"?this._setObject(a):this._set(a,s),this},_set:function(a,s){this[a]=s},toggle:function(a){var s=this.get(a);return typeof s=="boolean"&&this.set(a,!s),this},get:function(a){return this[a]}},n=e,h=Math.sqrt,d=Math.atan2,p=Math.pow,v=Math.PI/180,b=Math.PI/2,y.util={cos:function(a){if(a===0)return 1;switch(a<0&&(a=-a),a/b){case 1:case 3:return 0;case 2:return-1}return Math.cos(a)},sin:function(a){if(a===0)return 0;var s=1;switch(a<0&&(s=-1),a/b){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(a)},removeFromArray:function(a,s){var l=a.indexOf(s);return l!==-1&&a.splice(l,1),a},getRandomInt:function(a,s){return Math.floor(Math.random()*(s-a+1))+a},degreesToRadians:function(a){return a*v},radiansToDegrees:function(a){return a/v},rotatePoint:function(a,s,l){var u=new y.Point(a.x-s.x,a.y-s.y),r=y.util.rotateVector(u,l);return new y.Point(r.x,r.y).addEquals(s)},rotateVector:function(a,s){var l=y.util.sin(s),u=y.util.cos(s);return{x:a.x*u-a.y*l,y:a.x*l+a.y*u}},createVector:function(a,s){return new y.Point(s.x-a.x,s.y-a.y)},calcAngleBetweenVectors:function(a,s){return Math.acos((a.x*s.x+a.y*s.y)/(Math.hypot(a.x,a.y)*Math.hypot(s.x,s.y)))},getHatVector:function(a){return new y.Point(a.x,a.y).multiply(1/Math.hypot(a.x,a.y))},getBisector:function(a,s,l){var u=y.util.createVector(a,s),r=y.util.createVector(a,l),o=y.util.calcAngleBetweenVectors(u,r),c=o*(y.util.calcAngleBetweenVectors(y.util.rotateVector(u,o),r)===0?1:-1)/2;return{vector:y.util.getHatVector(y.util.rotateVector(u,c)),angle:o}},projectStrokeOnPoints:function(a,s,l){var u=[],r=s.strokeWidth/2,o=s.strokeUniform?new y.Point(1/s.scaleX,1/s.scaleY):new y.Point(1,1),c=function(_){var f=r/Math.hypot(_.x,_.y);return new y.Point(_.x*f*o.x,_.y*f*o.y)};return a.length<=1||a.forEach(function(_,f){var g,m,S=new y.Point(_.x,_.y);f===0?(m=a[f+1],g=l?c(y.util.createVector(m,S)).addEquals(S):a[a.length-1]):f===a.length-1?(g=a[f-1],m=l?c(y.util.createVector(g,S)).addEquals(S):a[0]):(g=a[f-1],m=a[f+1]);var w,I,T=y.util.getBisector(S,g,m),A=T.vector,D=T.angle;if(s.strokeLineJoin==="miter"&&(w=-r/Math.sin(D/2),I=new y.Point(A.x*w*o.x,A.y*w*o.y),Math.hypot(I.x,I.y)/r<=s.strokeMiterLimit))return u.push(S.add(I)),void u.push(S.subtract(I));w=-r*Math.SQRT2,I=new y.Point(A.x*w*o.x,A.y*w*o.y),u.push(S.add(I)),u.push(S.subtract(I))}),u},transformPoint:function(a,s,l){return l?new y.Point(s[0]*a.x+s[2]*a.y,s[1]*a.x+s[3]*a.y):new y.Point(s[0]*a.x+s[2]*a.y+s[4],s[1]*a.x+s[3]*a.y+s[5])},makeBoundingBoxFromPoints:function(a,s){if(s)for(var l=0;l<a.length;l++)a[l]=y.util.transformPoint(a[l],s);var u=[a[0].x,a[1].x,a[2].x,a[3].x],r=y.util.array.min(u),o=y.util.array.max(u)-r,c=[a[0].y,a[1].y,a[2].y,a[3].y],_=y.util.array.min(c);return{left:r,top:_,width:o,height:y.util.array.max(c)-_}},invertTransform:function(a){var s=1/(a[0]*a[3]-a[1]*a[2]),l=[s*a[3],-s*a[1],-s*a[2],s*a[0]],u=y.util.transformPoint({x:a[4],y:a[5]},l,!0);return l[4]=-u.x,l[5]=-u.y,l},toFixed:function(a,s){return parseFloat(Number(a).toFixed(s))},parseUnit:function(a,s){var l=/\D{0,2}$/.exec(a),u=parseFloat(a);switch(s||(s=y.Text.DEFAULT_SVG_FONT_SIZE),l[0]){case"mm":return u*y.DPI/25.4;case"cm":return u*y.DPI/2.54;case"in":return u*y.DPI;case"pt":return u*y.DPI/72;case"pc":return u*y.DPI/72*12;case"em":return u*s;default:return u}},falseFunction:function(){return!1},getKlass:function(a,s){return a=y.util.string.camelize(a.charAt(0).toUpperCase()+a.slice(1)),y.util.resolveNamespace(s)[a]},getSvgAttributes:function(a){var s=["instantiated_by_use","style","id","class"];switch(a){case"linearGradient":s=s.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":s=s.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":s=s.concat(["offset","stop-color","stop-opacity"])}return s},resolveNamespace:function(a){if(!a)return y;var s,l=a.split("."),u=l.length,r=n||y.window;for(s=0;s<u;++s)r=r[l[s]];return r},loadImage:function(a,s,l,u){if(a){var r=y.util.createImage(),o=function(){s&&s.call(l,r,!1),r=r.onload=r.onerror=null};r.onload=o,r.onerror=function(){y.log("Error loading "+r.src),s&&s.call(l,null,!0),r=r.onload=r.onerror=null},a.indexOf("data")!==0&&u!=null&&(r.crossOrigin=u),a.substring(0,14)==="data:image/svg"&&(r.onload=null,y.util.loadImageInDom(r,o)),r.src=a}else s&&s.call(l,a)},loadImageInDom:function(a,s){var l=y.document.createElement("div");l.style.width=l.style.height="1px",l.style.left=l.style.top="-100%",l.style.position="absolute",l.appendChild(a),y.document.querySelector("body").appendChild(l),a.onload=function(){s(),l.parentNode.removeChild(l),l=null}},enlivenObjects:function(a,s,l,u){var r=[],o=0,c=(a=a||[]).length;function _(){++o===c&&s&&s(r.filter(function(f){return f}))}c?a.forEach(function(f,g){f&&f.type?y.util.getKlass(f.type,l).fromObject(f,function(m,S){S||(r[g]=m),u&&u(f,m,S),_()}):_()}):s&&s(r)},enlivenObjectEnlivables:function(a,s,l){var u=y.Object.ENLIVEN_PROPS.filter(function(r){return!!a[r]});y.util.enlivenObjects(u.map(function(r){return a[r]}),function(r){var o={};u.forEach(function(c,_){o[c]=r[_],s&&(s[c]=r[_])}),l&&l(o)})},enlivenPatterns:function(a,s){function l(){++r===o&&s&&s(u)}var u=[],r=0,o=(a=a||[]).length;o?a.forEach(function(c,_){c&&c.source?new y.Pattern(c,function(f){u[_]=f,l()}):(u[_]=c,l())}):s&&s(u)},groupSVGElements:function(a,s,l){var u;return a&&a.length===1?a[0]:(s&&(s.width&&s.height?s.centerPoint={x:s.width/2,y:s.height/2}:(delete s.width,delete s.height)),u=new y.Group(a,s),l!==void 0&&(u.sourcePath=l),u)},populateWithProperties:function(a,s,l){if(l&&Array.isArray(l))for(var u=0,r=l.length;u<r;u++)l[u]in a&&(s[l[u]]=a[l[u]])},createCanvasElement:function(){return y.document.createElement("canvas")},copyCanvasElement:function(a){var s=y.util.createCanvasElement();return s.width=a.width,s.height=a.height,s.getContext("2d").drawImage(a,0,0),s},toDataURL:function(a,s,l){return a.toDataURL("image/"+s,l)},createImage:function(){return y.document.createElement("img")},multiplyTransformMatrices:function(a,s,l){return[a[0]*s[0]+a[2]*s[1],a[1]*s[0]+a[3]*s[1],a[0]*s[2]+a[2]*s[3],a[1]*s[2]+a[3]*s[3],l?0:a[0]*s[4]+a[2]*s[5]+a[4],l?0:a[1]*s[4]+a[3]*s[5]+a[5]]},qrDecompose:function(a){var s=d(a[1],a[0]),l=p(a[0],2)+p(a[1],2),u=h(l),r=(a[0]*a[3]-a[2]*a[1])/u,o=d(a[0]*a[2]+a[1]*a[3],l);return{angle:s/v,scaleX:u,scaleY:r,skewX:o/v,skewY:0,translateX:a[4],translateY:a[5]}},calcRotateMatrix:function(a){if(!a.angle)return y.iMatrix.concat();var s=y.util.degreesToRadians(a.angle),l=y.util.cos(s),u=y.util.sin(s);return[l,u,-u,l,0,0]},calcDimensionsMatrix:function(a){var s=a.scaleX===void 0?1:a.scaleX,l=a.scaleY===void 0?1:a.scaleY,u=[a.flipX?-s:s,0,0,a.flipY?-l:l,0,0],r=y.util.multiplyTransformMatrices,o=y.util.degreesToRadians;return a.skewX&&(u=r(u,[1,0,Math.tan(o(a.skewX)),1],!0)),a.skewY&&(u=r(u,[1,Math.tan(o(a.skewY)),0,1],!0)),u},composeMatrix:function(a){var s=[1,0,0,1,a.translateX||0,a.translateY||0],l=y.util.multiplyTransformMatrices;return a.angle&&(s=l(s,y.util.calcRotateMatrix(a))),(a.scaleX!==1||a.scaleY!==1||a.skewX||a.skewY||a.flipX||a.flipY)&&(s=l(s,y.util.calcDimensionsMatrix(a))),s},resetObjectTransform:function(a){a.scaleX=1,a.scaleY=1,a.skewX=0,a.skewY=0,a.flipX=!1,a.flipY=!1,a.rotate(0)},saveObjectTransform:function(a){return{scaleX:a.scaleX,scaleY:a.scaleY,skewX:a.skewX,skewY:a.skewY,angle:a.angle,left:a.left,flipX:a.flipX,flipY:a.flipY,top:a.top}},isTransparent:function(a,s,l,u){u>0&&(s>u?s-=u:s=0,l>u?l-=u:l=0);var r,o=!0,c=a.getImageData(s,l,2*u||1,2*u||1),_=c.data.length;for(r=3;r<_&&(o=c.data[r]<=0)!=0;r+=4);return c=null,o},parsePreserveAspectRatioAttribute:function(a){var s,l="meet",u=a.split(" ");return u&&u.length&&((l=u.pop())!=="meet"&&l!=="slice"?(s=l,l="meet"):u.length&&(s=u.pop())),{meetOrSlice:l,alignX:s!=="none"?s.slice(1,4):"none",alignY:s!=="none"?s.slice(5,8):"none"}},clearFabricFontCache:function(a){(a=(a||"").toLowerCase())?y.charWidthsCache[a]&&delete y.charWidthsCache[a]:y.charWidthsCache={}},limitDimsByArea:function(a,s){var l=Math.sqrt(s*a),u=Math.floor(s/l);return{x:Math.floor(l),y:u}},capValue:function(a,s,l){return Math.max(a,Math.min(s,l))},findScaleToFit:function(a,s){return Math.min(s.width/a.width,s.height/a.height)},findScaleToCover:function(a,s){return Math.max(s.width/a.width,s.height/a.height)},matrixToSVG:function(a){return"matrix("+a.map(function(s){return y.util.toFixed(s,y.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(a,s){var l=y.util.invertTransform(s),u=y.util.multiplyTransformMatrices(l,a.calcOwnMatrix());y.util.applyTransformToObject(a,u)},addTransformToObject:function(a,s){y.util.applyTransformToObject(a,y.util.multiplyTransformMatrices(s,a.calcOwnMatrix()))},applyTransformToObject:function(a,s){var l=y.util.qrDecompose(s),u=new y.Point(l.translateX,l.translateY);a.flipX=!1,a.flipY=!1,a.set("scaleX",l.scaleX),a.set("scaleY",l.scaleY),a.skewX=l.skewX,a.skewY=l.skewY,a.angle=l.angle,a.setPositionByOrigin(u,"center","center")},sizeAfterTransform:function(a,s,l){var u=a/2,r=s/2,o=[{x:-u,y:-r},{x:u,y:-r},{x:-u,y:r},{x:u,y:r}],c=y.util.calcDimensionsMatrix(l),_=y.util.makeBoundingBoxFromPoints(o,c);return{x:_.width,y:_.height}},mergeClipPaths:function(a,s){var l=a,u=s;l.inverted&&!u.inverted&&(l=s,u=a),y.util.applyTransformToObject(u,y.util.multiplyTransformMatrices(y.util.invertTransform(l.calcTransformMatrix()),u.calcTransformMatrix()));var r=l.inverted&&u.inverted;return r&&(l.inverted=u.inverted=!1),new y.Group([l],{clipPath:u,inverted:r})}},function(){var a=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function u(I,T,A,D,P,j,Z,X,W,M,R){var V=y.util.cos(I),q=y.util.sin(I),K=y.util.cos(T),B=y.util.sin(T),F=A*P*K-D*j*B+Z,z=D*P*K+A*j*B+X;return["C",M+W*(-A*P*q-D*j*V),R+W*(-D*P*q+A*j*V),F+W*(A*P*B+D*j*K),z+W*(D*P*B-A*j*K),F,z]}function r(I,T,A,D){var P=Math.atan2(T,I),j=Math.atan2(D,A);return j>=P?j-P:2*Math.PI-(P-j)}function o(I,T,A){for(var D=A[1],P=A[2],j=A[3],Z=A[4],X=A[5],W=function(V,q,K,B,F,z,Q){var $=Math.PI,ie=Q*$/180,ce=y.util.sin(ie),oe=y.util.cos(ie),se=0,le=0,ae=-oe*V*.5-ce*q*.5,he=-oe*q*.5+ce*V*.5,pe=(K=Math.abs(K))*K,ue=(B=Math.abs(B))*B,ye=he*he,xe=ae*ae,Ye=pe*ue-pe*ye-ue*xe,et=0;if(Ye<0){var At=Math.sqrt(1-Ye/(pe*ue));K*=At,B*=At}else et=(F===z?-1:1)*Math.sqrt(Ye/(pe*ye+ue*xe));var Ee=et*K*he/B,Xe=-et*B*ae/K,Gt=oe*Ee-ce*Xe+.5*V,Dt=ce*Ee+oe*Xe+.5*q,_t=r(1,0,(ae-Ee)/K,(he-Xe)/B),Rt=r((ae-Ee)/K,(he-Xe)/B,(-ae-Ee)/K,(-he-Xe)/B);z===0&&Rt>0?Rt-=2*$:z===1&&Rt<0&&(Rt+=2*$);for(var tn=Math.ceil(Math.abs(Rt/$*2)),hi=[],Wt=Rt/tn,Mo=8/3*Math.sin(Wt/4)*Math.sin(Wt/4)/Math.sin(Wt/2),Xi=_t+Wt,Ht=0;Ht<tn;Ht++)hi[Ht]=u(_t,Xi,oe,ce,K,B,Gt,Dt,Mo,se,le),se=hi[Ht][5],le=hi[Ht][6],_t=Xi,Xi+=Wt;return hi}(A[6]-I,A[7]-T,D,P,Z,X,j),M=0,R=W.length;M<R;M++)W[M][1]+=I,W[M][2]+=T,W[M][3]+=I,W[M][4]+=T,W[M][5]+=I,W[M][6]+=T;return W}function c(I,T,A,D){return Math.sqrt((A-I)*(A-I)+(D-T)*(D-T))}function _(I,T,A,D,P,j,Z,X){return function(W){var M,R=(M=W)*M*M,V=function(B){return 3*B*B*(1-B)}(W),q=function(B){return 3*B*(1-B)*(1-B)}(W),K=function(B){return(1-B)*(1-B)*(1-B)}(W);return{x:Z*R+P*V+A*q+I*K,y:X*R+j*V+D*q+T*K}}}function f(I,T,A,D,P,j,Z,X){return function(W){var M=1-W,R=3*M*M*(A-I)+6*M*W*(P-A)+3*W*W*(Z-P),V=3*M*M*(D-T)+6*M*W*(j-D)+3*W*W*(X-j);return Math.atan2(V,R)}}function g(I,T,A,D,P,j){return function(Z){var X,W=(X=Z)*X,M=function(V){return 2*V*(1-V)}(Z),R=function(V){return(1-V)*(1-V)}(Z);return{x:P*W+A*M+I*R,y:j*W+D*M+T*R}}}function m(I,T,A,D,P,j){return function(Z){var X=1-Z,W=2*X*(A-I)+2*Z*(P-A),M=2*X*(D-T)+2*Z*(j-D);return Math.atan2(M,W)}}function S(I,T,A){var D,P,j={x:T,y:A},Z=0;for(P=1;P<=100;P+=1)D=I(P/100),Z+=c(j.x,j.y,D.x,D.y),j=D;return Z}function w(I){for(var T,A,D,P,j=0,Z=I.length,X=0,W=0,M=0,R=0,V=[],q=0;q<Z;q++){switch(D={x:X,y:W,command:(T=I[q])[0]},T[0]){case"M":D.length=0,M=X=T[1],R=W=T[2];break;case"L":D.length=c(X,W,T[1],T[2]),X=T[1],W=T[2];break;case"C":A=_(X,W,T[1],T[2],T[3],T[4],T[5],T[6]),P=f(X,W,T[1],T[2],T[3],T[4],T[5],T[6]),D.iterator=A,D.angleFinder=P,D.length=S(A,X,W),X=T[5],W=T[6];break;case"Q":A=g(X,W,T[1],T[2],T[3],T[4]),P=m(X,W,T[1],T[2],T[3],T[4]),D.iterator=A,D.angleFinder=P,D.length=S(A,X,W),X=T[3],W=T[4];break;case"Z":case"z":D.destX=M,D.destY=R,D.length=c(X,W,M,R),X=M,W=R}j+=D.length,V.push(D)}return V.push({length:j,x:X,y:W}),V}y.util.joinPath=function(I){return I.map(function(T){return T.join(" ")}).join(" ")},y.util.parsePath=function(I){var T,A,D,P,j,Z=[],X=[],W=y.rePathCommand,M="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",R="("+M+")"+y.commaWsp,V="([01])"+y.commaWsp+"?",q=new RegExp(R+"?"+R+"?"+R+V+V+R+"?("+M+")","g");if(!I||!I.match)return Z;for(var K,B=0,F=(j=I.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;B<F;B++){P=(T=j[B]).slice(1).trim(),X.length=0;var z=T.charAt(0);if(K=[z],z.toLowerCase()==="a")for(var Q;Q=q.exec(P);)for(var $=1;$<Q.length;$++)X.push(Q[$]);else for(;D=W.exec(P);)X.push(D[0]);$=0;for(var ie=X.length;$<ie;$++)A=parseFloat(X[$]),isNaN(A)||K.push(A);var ce=s[z.toLowerCase()],oe=l[z]||z;if(K.length-1>ce)for(var se=1,le=K.length;se<le;se+=ce)Z.push([z].concat(K.slice(se,se+ce))),z=oe;else Z.push(K)}return Z},y.util.makePathSimpler=function(I){var T,A,D,P,j,Z,X=0,W=0,M=I.length,R=0,V=0,q=[];for(A=0;A<M;++A){switch(D=!1,(T=I[A].slice(0))[0]){case"l":T[0]="L",T[1]+=X,T[2]+=W;case"L":X=T[1],W=T[2];break;case"h":T[1]+=X;case"H":T[0]="L",T[2]=W,X=T[1];break;case"v":T[1]+=W;case"V":T[0]="L",W=T[1],T[1]=X,T[2]=W;break;case"m":T[0]="M",T[1]+=X,T[2]+=W;case"M":X=T[1],W=T[2],R=T[1],V=T[2];break;case"c":T[0]="C",T[1]+=X,T[2]+=W,T[3]+=X,T[4]+=W,T[5]+=X,T[6]+=W;case"C":j=T[3],Z=T[4],X=T[5],W=T[6];break;case"s":T[0]="S",T[1]+=X,T[2]+=W,T[3]+=X,T[4]+=W;case"S":P==="C"?(j=2*X-j,Z=2*W-Z):(j=X,Z=W),X=T[3],W=T[4],T[0]="C",T[5]=T[3],T[6]=T[4],T[3]=T[1],T[4]=T[2],T[1]=j,T[2]=Z,j=T[3],Z=T[4];break;case"q":T[0]="Q",T[1]+=X,T[2]+=W,T[3]+=X,T[4]+=W;case"Q":j=T[1],Z=T[2],X=T[3],W=T[4];break;case"t":T[0]="T",T[1]+=X,T[2]+=W;case"T":P==="Q"?(j=2*X-j,Z=2*W-Z):(j=X,Z=W),T[0]="Q",X=T[1],W=T[2],T[1]=j,T[2]=Z,T[3]=X,T[4]=W;break;case"a":T[0]="A",T[6]+=X,T[7]+=W;case"A":D=!0,q=q.concat(o(X,W,T)),X=T[6],W=T[7];break;case"z":case"Z":X=R,W=V}D||q.push(T),P=T[0]}return q},y.util.getSmoothPathFromPoints=function(I,T){var A,D=[],P=new y.Point(I[0].x,I[0].y),j=new y.Point(I[1].x,I[1].y),Z=I.length,X=1,W=0,M=Z>2;for(T=T||0,M&&(X=I[2].x<j.x?-1:I[2].x===j.x?0:1,W=I[2].y<j.y?-1:I[2].y===j.y?0:1),D.push(["M",P.x-X*T,P.y-W*T]),A=1;A<Z;A++){if(!P.eq(j)){var R=P.midPointFrom(j);D.push(["Q",P.x,P.y,R.x,R.y])}P=I[A],A+1<I.length&&(j=I[A+1])}return M&&(X=P.x>I[A-2].x?1:P.x===I[A-2].x?0:-1,W=P.y>I[A-2].y?1:P.y===I[A-2].y?0:-1),D.push(["L",P.x+X*T,P.y+W*T]),D},y.util.getPathSegmentsInfo=w,y.util.getBoundsOfCurve=function(I,T,A,D,P,j,Z,X){var W;if(y.cachesBoundsOfCurve&&(W=a.call(arguments),y.boundsOfCurveCache[W]))return y.boundsOfCurveCache[W];var M,R,V,q,K,B,F,z,Q=Math.sqrt,$=Math.min,ie=Math.max,ce=Math.abs,oe=[],se=[[],[]];R=6*I-12*A+6*P,M=-3*I+9*A-9*P+3*Z,V=3*A-3*I;for(var le=0;le<2;++le)if(le>0&&(R=6*T-12*D+6*j,M=-3*T+9*D-9*j+3*X,V=3*D-3*T),ce(M)<1e-12){if(ce(R)<1e-12)continue;0<(q=-V/R)&&q<1&&oe.push(q)}else(F=R*R-4*V*M)<0||(0<(K=(-R+(z=Q(F)))/(2*M))&&K<1&&oe.push(K),0<(B=(-R-z)/(2*M))&&B<1&&oe.push(B));for(var ae,he,pe,ue=oe.length,ye=ue;ue--;)ae=(pe=1-(q=oe[ue]))*pe*pe*I+3*pe*pe*q*A+3*pe*q*q*P+q*q*q*Z,se[0][ue]=ae,he=pe*pe*pe*T+3*pe*pe*q*D+3*pe*q*q*j+q*q*q*X,se[1][ue]=he;se[0][ye]=I,se[1][ye]=T,se[0][ye+1]=Z,se[1][ye+1]=X;var xe=[{x:$.apply(null,se[0]),y:$.apply(null,se[1])},{x:ie.apply(null,se[0]),y:ie.apply(null,se[1])}];return y.cachesBoundsOfCurve&&(y.boundsOfCurveCache[W]=xe),xe},y.util.getPointOnPath=function(I,T,A){A||(A=w(I));for(var D=0;T-A[D].length>0&&D<A.length-2;)T-=A[D].length,D++;var P,j=A[D],Z=T/j.length,X=j.command,W=I[D];switch(X){case"M":return{x:j.x,y:j.y,angle:0};case"Z":case"z":return(P=new y.Point(j.x,j.y).lerp(new y.Point(j.destX,j.destY),Z)).angle=Math.atan2(j.destY-j.y,j.destX-j.x),P;case"L":return(P=new y.Point(j.x,j.y).lerp(new y.Point(W[1],W[2]),Z)).angle=Math.atan2(W[2]-j.y,W[1]-j.x),P;case"C":case"Q":return function(M,R){for(var V,q,K,B=0,F=0,z=M.iterator,Q={x:M.x,y:M.y},$=.01,ie=M.angleFinder;F<R&&$>1e-4;)V=z(B),K=B,(q=c(Q.x,Q.y,V.x,V.y))+F>R?(B-=$,$/=2):(Q=V,B+=$,F+=q);return V.angle=ie(K),V}(j,T)}},y.util.transformPath=function(I,T,A){return A&&(T=y.util.multiplyTransformMatrices(T,[1,0,0,1,-A.x,-A.y])),I.map(function(D){for(var P=D.slice(0),j={},Z=1;Z<D.length-1;Z+=2)j.x=D[Z],j.y=D[Z+1],j=y.util.transformPoint(j,T),P[Z]=j.x,P[Z+1]=j.y;return P})}}(),function(){var a=Array.prototype.slice;function s(l,u,r){if(l&&l.length!==0){var o=l.length-1,c=u?l[o][u]:l[o];if(u)for(;o--;)r(l[o][u],c)&&(c=l[o][u]);else for(;o--;)r(l[o],c)&&(c=l[o]);return c}}y.util.array={fill:function(l,u){for(var r=l.length;r--;)l[r]=u;return l},invoke:function(l,u){for(var r=a.call(arguments,2),o=[],c=0,_=l.length;c<_;c++)o[c]=r.length?l[c][u].apply(l[c],r):l[c][u].call(l[c]);return o},min:function(l,u){return s(l,u,function(r,o){return r<o})},max:function(l,u){return s(l,u,function(r,o){return r>=o})}}}(),function(){function a(s,l,u){if(u)if(!y.isLikelyNode&&l instanceof Element)s=l;else if(l instanceof Array){s=[];for(var r=0,o=l.length;r<o;r++)s[r]=a({},l[r],u)}else if(l&&typeof l=="object")for(var c in l)c==="canvas"||c==="group"?s[c]=null:l.hasOwnProperty(c)&&(s[c]=a({},l[c],u));else s=l;else for(var c in l)s[c]=l[c];return s}y.util.object={extend:a,clone:function(s,l){return a({},s,l)}},y.util.object.extend(y.util,y.Observable)}(),function(){function a(s,l){var u=s.charCodeAt(l);if(isNaN(u))return"";if(u<55296||u>57343)return s.charAt(l);if(55296<=u&&u<=56319){if(s.length<=l+1)throw"High surrogate without following low surrogate";var r=s.charCodeAt(l+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return s.charAt(l)+s.charAt(l+1)}if(l===0)throw"Low surrogate without preceding high surrogate";var o=s.charCodeAt(l-1);if(55296>o||o>56319)throw"Low surrogate without preceding high surrogate";return!1}y.util.string={camelize:function(s){return s.replace(/-+(.)?/g,function(l,u){return u?u.toUpperCase():""})},capitalize:function(s,l){return s.charAt(0).toUpperCase()+(l?s.slice(1):s.slice(1).toLowerCase())},escapeXml:function(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(s){var l,u=0,r=[];for(u=0;u<s.length;u++)(l=a(s,u))!==!1&&r.push(l);return r}}}(),function(){var a=Array.prototype.slice,s=function(){},l=function(){for(var c in{toString:1})if(c==="toString")return!1;return!0}(),u=function(c,_,f){for(var g in _)g in c.prototype&&typeof c.prototype[g]=="function"&&(_[g]+"").indexOf("callSuper")>-1?c.prototype[g]=function(m){return function(){var S=this.constructor.superclass;this.constructor.superclass=f;var w=_[m].apply(this,arguments);if(this.constructor.superclass=S,m!=="initialize")return w}}(g):c.prototype[g]=_[g],l&&(_.toString!==Object.prototype.toString&&(c.prototype.toString=_.toString),_.valueOf!==Object.prototype.valueOf&&(c.prototype.valueOf=_.valueOf))};function r(){}function o(c){for(var _=null,f=this;f.constructor.superclass;){var g=f.constructor.superclass.prototype[c];if(f[c]!==g){_=g;break}f=f.constructor.superclass.prototype}return _?arguments.length>1?_.apply(this,a.call(arguments,1)):_.call(this):console.log("tried to callSuper "+c+", method not found in prototype chain",this)}y.util.createClass=function(){var c=null,_=a.call(arguments,0);function f(){this.initialize.apply(this,arguments)}typeof _[0]=="function"&&(c=_.shift()),f.superclass=c,f.subclasses=[],c&&(r.prototype=c.prototype,f.prototype=new r,c.subclasses.push(f));for(var g=0,m=_.length;g<m;g++)u(f,_[g],c);return f.prototype.initialize||(f.prototype.initialize=s),f.prototype.constructor=f,f.prototype.callSuper=o,f}}(),C=!!y.document.createElement("div").attachEvent,x=["touchstart","touchmove","touchend"],y.util.addListener=function(a,s,l,u){a&&a.addEventListener(s,l,!C&&u)},y.util.removeListener=function(a,s,l,u){a&&a.removeEventListener(s,l,!C&&u)},y.util.getPointer=function(a){var s=a.target,l=y.util.getScrollLeftTop(s),u=function(r){var o=r.changedTouches;return o&&o[0]?o[0]:r}(a);return{x:u.clientX+l.left,y:u.clientY+l.top}},y.util.isTouchEvent=function(a){return x.indexOf(a.type)>-1||a.pointerType==="touch"},O=typeof(E=y.document.createElement("div")).style.opacity=="string",N=typeof E.style.filter=="string",k=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,H=function(a){return a},O?H=function(a,s){return a.style.opacity=s,a}:N&&(H=function(a,s){var l=a.style;return a.currentStyle&&!a.currentStyle.hasLayout&&(l.zoom=1),k.test(l.filter)?(s=s>=.9999?"":"alpha(opacity="+100*s+")",l.filter=l.filter.replace(k,s)):l.filter+=" alpha(opacity="+100*s+")",a}),y.util.setStyle=function(a,s){var l=a.style;if(!l)return a;if(typeof s=="string")return a.style.cssText+=";"+s,s.indexOf("opacity")>-1?H(a,s.match(/opacity:\s*(\d?\.?\d*)/)[1]):a;for(var u in s)u==="opacity"?H(a,s[u]):l[u==="float"||u==="cssFloat"?l.styleFloat===void 0?"cssFloat":"styleFloat":u]=s[u];return a},function(){var a,s,l,u,r=Array.prototype.slice,o=function(f){return r.call(f,0)};try{a=o(y.document.childNodes)instanceof Array}catch(f){}function c(f,g){var m=y.document.createElement(f);for(var S in g)S==="class"?m.className=g[S]:S==="for"?m.htmlFor=g[S]:m.setAttribute(S,g[S]);return m}function _(f){for(var g=0,m=0,S=y.document.documentElement,w=y.document.body||{scrollLeft:0,scrollTop:0};f&&(f.parentNode||f.host)&&((f=f.parentNode||f.host)===y.document?(g=w.scrollLeft||S.scrollLeft||0,m=w.scrollTop||S.scrollTop||0):(g+=f.scrollLeft||0,m+=f.scrollTop||0),f.nodeType!==1||f.style.position!=="fixed"););return{left:g,top:m}}a||(o=function(f){for(var g=new Array(f.length),m=f.length;m--;)g[m]=f[m];return g}),s=y.document.defaultView&&y.document.defaultView.getComputedStyle?function(f,g){var m=y.document.defaultView.getComputedStyle(f,null);return m?m[g]:void 0}:function(f,g){var m=f.style[g];return!m&&f.currentStyle&&(m=f.currentStyle[g]),m},l=y.document.documentElement.style,u="userSelect"in l?"userSelect":"MozUserSelect"in l?"MozUserSelect":"WebkitUserSelect"in l?"WebkitUserSelect":"KhtmlUserSelect"in l?"KhtmlUserSelect":"",y.util.makeElementUnselectable=function(f){return f.onselectstart!==void 0&&(f.onselectstart=y.util.falseFunction),u?f.style[u]="none":typeof f.unselectable=="string"&&(f.unselectable="on"),f},y.util.makeElementSelectable=function(f){return f.onselectstart!==void 0&&(f.onselectstart=null),u?f.style[u]="":typeof f.unselectable=="string"&&(f.unselectable=""),f},y.util.setImageSmoothing=function(f,g){f.imageSmoothingEnabled=f.imageSmoothingEnabled||f.webkitImageSmoothingEnabled||f.mozImageSmoothingEnabled||f.msImageSmoothingEnabled||f.oImageSmoothingEnabled,f.imageSmoothingEnabled=g},y.util.getById=function(f){return typeof f=="string"?y.document.getElementById(f):f},y.util.toArray=o,y.util.addClass=function(f,g){f&&(" "+f.className+" ").indexOf(" "+g+" ")===-1&&(f.className+=(f.className?" ":"")+g)},y.util.makeElement=c,y.util.wrapElement=function(f,g,m){return typeof g=="string"&&(g=c(g,m)),f.parentNode&&f.parentNode.replaceChild(g,f),g.appendChild(f),g},y.util.getScrollLeftTop=_,y.util.getElementOffset=function(f){var g,m,S=f&&f.ownerDocument,w={left:0,top:0},I={left:0,top:0},T={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!S)return I;for(var A in T)I[T[A]]+=parseInt(s(f,A),10)||0;return g=S.documentElement,f.getBoundingClientRect!==void 0&&(w=f.getBoundingClientRect()),m=_(f),{left:w.left+m.left-(g.clientLeft||0)+I.left,top:w.top+m.top-(g.clientTop||0)+I.top}},y.util.getNodeCanvas=function(f){var g=y.jsdomImplForWrapper(f);return g._canvas||g._image},y.util.cleanUpJsdomNode=function(f){if(y.isLikelyNode){var g=y.jsdomImplForWrapper(f);g&&(g._image=null,g._canvas=null,g._currentSrc=null,g._attributes=null,g._classList=null)}}}(),function(){function a(){}y.util.request=function(s,l){l||(l={});var u=l.method?l.method.toUpperCase():"GET",r=l.onComplete||function(){},o=new y.window.XMLHttpRequest,c=l.body||l.parameters;return o.onreadystatechange=function(){o.readyState===4&&(r(o),o.onreadystatechange=a)},u==="GET"&&(c=null,typeof l.parameters=="string"&&(s=function(_,f){return _+(/\?/.test(_)?"&":"?")+f}(s,l.parameters))),o.open(u,s,!0),u!=="POST"&&u!=="PUT"||o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(c),o}}(),y.log=console.log,y.warn=console.warn,function(){var a=y.util.object.extend,s=y.util.object.clone,l=[];function u(){return!1}function r(f,g,m,S){return-m*Math.cos(f/S*(Math.PI/2))+m+g}y.util.object.extend(l,{cancelAll:function(){var f=this.splice(0);return f.forEach(function(g){g.cancel()}),f},cancelByCanvas:function(f){if(!f)return[];var g=this.filter(function(m){return typeof m.target=="object"&&m.target.canvas===f});return g.forEach(function(m){m.cancel()}),g},cancelByTarget:function(f){var g=this.findAnimationsByTarget(f);return g.forEach(function(m){m.cancel()}),g},findAnimationIndex:function(f){return this.indexOf(this.findAnimation(f))},findAnimation:function(f){return this.find(function(g){return g.cancel===f})},findAnimationsByTarget:function(f){return f?this.filter(function(g){return g.target===f}):[]}});var o=y.window.requestAnimationFrame||y.window.webkitRequestAnimationFrame||y.window.mozRequestAnimationFrame||y.window.oRequestAnimationFrame||y.window.msRequestAnimationFrame||function(f){return y.window.setTimeout(f,1e3/60)},c=y.window.cancelAnimationFrame||y.window.clearTimeout;function _(){return o.apply(y.window,arguments)}y.util.animate=function(f){f||(f={});var g,m=!1,S=function(){var w=y.runningAnimations.indexOf(g);return w>-1&&y.runningAnimations.splice(w,1)[0]};return g=a(s(f),{cancel:function(){return m=!0,S()},currentValue:"startValue"in f?f.startValue:0,completionRate:0,durationRate:0}),y.runningAnimations.push(g),_(function(w){var I,T=w||+new Date,A=f.duration||500,D=T+A,P=f.onChange||u,j=f.abort||u,Z=f.onComplete||u,X=f.easing||r,W="startValue"in f&&f.startValue.length>0,M="startValue"in f?f.startValue:0,R="endValue"in f?f.endValue:100,V=f.byValue||(W?M.map(function(q,K){return R[K]-M[K]}):R-M);f.onStart&&f.onStart(),function q(K){var B=(I=K||+new Date)>D?A:I-T,F=B/A,z=W?M.map(function($,ie){return X(B,M[ie],V[ie],A)}):X(B,M,V,A),Q=Math.abs(W?(z[0]-M[0])/V[0]:(z-M)/V);if(g.currentValue=W?z.slice():z,g.completionRate=Q,g.durationRate=F,!m){if(!j(z,Q,F))return I>D?(g.currentValue=W?R.slice():R,g.completionRate=1,g.durationRate=1,P(W?R.slice():R,1,1),Z(R,1,1),void S()):(P(z,Q,F),void _(q));S()}}(T)}),g.cancel},y.util.requestAnimFrame=_,y.util.cancelAnimFrame=function(){return c.apply(y.window,arguments)},y.runningAnimations=l}(),function(){function a(s,l,u){var r="rgba("+parseInt(s[0]+u*(l[0]-s[0]),10)+","+parseInt(s[1]+u*(l[1]-s[1]),10)+","+parseInt(s[2]+u*(l[2]-s[2]),10);return(r+=","+(s&&l?parseFloat(s[3]+u*(l[3]-s[3])):1))+")"}y.util.animateColor=function(s,l,u,r){var o=new y.Color(s).getSource(),c=new y.Color(l).getSource(),_=r.onComplete,f=r.onChange;return r=r||{},y.util.animate(y.util.object.extend(r,{duration:u||500,startValue:o,endValue:c,byValue:c,easing:function(g,m,S,w){return a(m,S,r.colorEasing?r.colorEasing(g,w):1-Math.cos(g/w*(Math.PI/2)))},onComplete:function(g,m,S){if(_)return _(a(c,c,0),m,S)},onChange:function(g,m,S){if(f){if(Array.isArray(g))return f(a(g,g,0),m,S);f(g,m,S)}}}))}}(),function(){function a(r,o,c,_){return r<Math.abs(o)?(r=o,_=c/4):_=o===0&&r===0?c/(2*Math.PI)*Math.asin(1):c/(2*Math.PI)*Math.asin(o/r),{a:r,c:o,p:c,s:_}}function s(r,o,c){return r.a*Math.pow(2,10*(o-=1))*Math.sin((o*c-r.s)*(2*Math.PI)/r.p)}function l(r,o,c,_){return c-u(_-r,0,c,_)+o}function u(r,o,c,_){return(r/=_)<1/2.75?c*(7.5625*r*r)+o:r<2/2.75?c*(7.5625*(r-=1.5/2.75)*r+.75)+o:r<2.5/2.75?c*(7.5625*(r-=2.25/2.75)*r+.9375)+o:c*(7.5625*(r-=2.625/2.75)*r+.984375)+o}y.util.ease={easeInQuad:function(r,o,c,_){return c*(r/=_)*r+o},easeOutQuad:function(r,o,c,_){return-c*(r/=_)*(r-2)+o},easeInOutQuad:function(r,o,c,_){return(r/=_/2)<1?c/2*r*r+o:-c/2*(--r*(r-2)-1)+o},easeInCubic:function(r,o,c,_){return c*(r/=_)*r*r+o},easeOutCubic:function(r,o,c,_){return c*((r=r/_-1)*r*r+1)+o},easeInOutCubic:function(r,o,c,_){return(r/=_/2)<1?c/2*r*r*r+o:c/2*((r-=2)*r*r+2)+o},easeInQuart:function(r,o,c,_){return c*(r/=_)*r*r*r+o},easeOutQuart:function(r,o,c,_){return-c*((r=r/_-1)*r*r*r-1)+o},easeInOutQuart:function(r,o,c,_){return(r/=_/2)<1?c/2*r*r*r*r+o:-c/2*((r-=2)*r*r*r-2)+o},easeInQuint:function(r,o,c,_){return c*(r/=_)*r*r*r*r+o},easeOutQuint:function(r,o,c,_){return c*((r=r/_-1)*r*r*r*r+1)+o},easeInOutQuint:function(r,o,c,_){return(r/=_/2)<1?c/2*r*r*r*r*r+o:c/2*((r-=2)*r*r*r*r+2)+o},easeInSine:function(r,o,c,_){return-c*Math.cos(r/_*(Math.PI/2))+c+o},easeOutSine:function(r,o,c,_){return c*Math.sin(r/_*(Math.PI/2))+o},easeInOutSine:function(r,o,c,_){return-c/2*(Math.cos(Math.PI*r/_)-1)+o},easeInExpo:function(r,o,c,_){return r===0?o:c*Math.pow(2,10*(r/_-1))+o},easeOutExpo:function(r,o,c,_){return r===_?o+c:c*(1-Math.pow(2,-10*r/_))+o},easeInOutExpo:function(r,o,c,_){return r===0?o:r===_?o+c:(r/=_/2)<1?c/2*Math.pow(2,10*(r-1))+o:c/2*(2-Math.pow(2,-10*--r))+o},easeInCirc:function(r,o,c,_){return-c*(Math.sqrt(1-(r/=_)*r)-1)+o},easeOutCirc:function(r,o,c,_){return c*Math.sqrt(1-(r=r/_-1)*r)+o},easeInOutCirc:function(r,o,c,_){return(r/=_/2)<1?-c/2*(Math.sqrt(1-r*r)-1)+o:c/2*(Math.sqrt(1-(r-=2)*r)+1)+o},easeInElastic:function(r,o,c,_){var f=0;return r===0?o:(r/=_)==1?o+c:(f||(f=.3*_),-s(a(c,c,f,1.70158),r,_)+o)},easeOutElastic:function(r,o,c,_){var f=0;if(r===0)return o;if((r/=_)==1)return o+c;f||(f=.3*_);var g=a(c,c,f,1.70158);return g.a*Math.pow(2,-10*r)*Math.sin((r*_-g.s)*(2*Math.PI)/g.p)+g.c+o},easeInOutElastic:function(r,o,c,_){var f=0;if(r===0)return o;if((r/=_/2)==2)return o+c;f||(f=_*(.3*1.5));var g=a(c,c,f,1.70158);return r<1?-.5*s(g,r,_)+o:g.a*Math.pow(2,-10*(r-=1))*Math.sin((r*_-g.s)*(2*Math.PI)/g.p)*.5+g.c+o},easeInBack:function(r,o,c,_,f){return f===void 0&&(f=1.70158),c*(r/=_)*r*((f+1)*r-f)+o},easeOutBack:function(r,o,c,_,f){return f===void 0&&(f=1.70158),c*((r=r/_-1)*r*((f+1)*r+f)+1)+o},easeInOutBack:function(r,o,c,_,f){return f===void 0&&(f=1.70158),(r/=_/2)<1?c/2*(r*r*((1+(f*=1.525))*r-f))+o:c/2*((r-=2)*r*((1+(f*=1.525))*r+f)+2)+o},easeInBounce:l,easeOutBounce:u,easeInOutBounce:function(r,o,c,_){return r<_/2?.5*l(2*r,0,c,_)+o:.5*u(2*r-_,0,c,_)+.5*c+o}}}(),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.util.object.clone,r=s.util.toFixed,o=s.util.parseUnit,c=s.util.multiplyTransformMatrices,_={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},f={stroke:"strokeOpacity",fill:"fillOpacity"},g="font-size",m="clip-path";function S(M){return M in _?_[M]:M}function w(M,R,V,q){var K,B=Array.isArray(R);if(M!=="fill"&&M!=="stroke"||R!=="none"){if(M==="strokeUniform")return R==="non-scaling-stroke";if(M==="strokeDashArray")R=R==="none"?null:R.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(M==="transformMatrix")R=V&&V.transformMatrix?c(V.transformMatrix,s.parseTransformAttribute(R)):s.parseTransformAttribute(R);else if(M==="visible")R=R!=="none"&&R!=="hidden",V&&V.visible===!1&&(R=!1);else if(M==="opacity")R=parseFloat(R),V&&V.opacity!==void 0&&(R*=V.opacity);else if(M==="textAnchor")R=R==="start"?"left":R==="end"?"right":"center";else if(M==="charSpacing")K=o(R,q)/q*1e3;else if(M==="paintFirst"){var F=R.indexOf("fill"),z=R.indexOf("stroke");R="fill",(F>-1&&z>-1&&z<F||F===-1&&z>-1)&&(R="stroke")}else{if(M==="href"||M==="xlink:href"||M==="font")return R;if(M==="imageSmoothing")return R==="optimizeQuality";K=B?R.map(o):o(R,q)}}else R="";return!B&&isNaN(K)?R:K}function I(M){return new RegExp("^("+M.join("|")+")\\b","i")}function T(M,R){var V,q,K,B,F=[];for(K=0,B=R.length;K<B;K++)V=R[K],q=M.getElementsByTagName(V),F=F.concat(Array.prototype.slice.call(q));return F}function A(M,R){var V,q=!0;return(V=D(M,R.pop()))&&R.length&&(q=function(K,B){for(var F,z=!0;K.parentNode&&K.parentNode.nodeType===1&&B.length;)z&&(F=B.pop()),z=D(K=K.parentNode,F);return B.length===0}(M,R)),V&&q&&R.length===0}function D(M,R){var V,q,K=M.nodeName,B=M.getAttribute("class"),F=M.getAttribute("id");if(V=new RegExp("^"+K,"i"),R=R.replace(V,""),F&&R.length&&(V=new RegExp("#"+F+"(?![a-zA-Z\\-]+)","i"),R=R.replace(V,"")),B&&R.length)for(q=(B=B.split(" ")).length;q--;)V=new RegExp("\\."+B[q]+"(?![a-zA-Z\\-]+)","i"),R=R.replace(V,"");return R.length===0}function P(M,R){var V;if(M.getElementById&&(V=M.getElementById(R)),V)return V;var q,K,B,F=M.getElementsByTagName("*");for(K=0,B=F.length;K<B;K++)if(R===(q=F[K]).getAttribute("id"))return q}s.svgValidTagNamesRegEx=I(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),s.svgViewBoxElementsRegEx=I(["symbol","image","marker","pattern","view","svg"]),s.svgInvalidAncestorsRegEx=I(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),s.svgValidParentsRegEx=I(["symbol","g","a","svg","clipPath","defs"]),s.cssRules={},s.gradientDefs={},s.clipPaths={},s.parseTransformAttribute=function(){function M(z,Q,$){z[$]=Math.tan(s.util.degreesToRadians(Q[0]))}var R=s.iMatrix,V=s.reNum,q=s.commaWsp,K="(?:(?:(matrix)\\s*\\(\\s*("+V+")"+q+"("+V+")"+q+"("+V+")"+q+"("+V+")"+q+"("+V+")"+q+"("+V+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+V+")(?:"+q+"("+V+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+V+")(?:"+q+"("+V+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+V+")(?:"+q+"("+V+")"+q+"("+V+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+V+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+V+")\\s*\\)))",B=new RegExp("^\\s*(?:(?:"+K+"(?:"+q+"*"+K+")*)?)\\s*$"),F=new RegExp(K,"g");return function(z){var Q=R.concat(),$=[];if(!z||z&&!B.test(z))return Q;z.replace(F,function(ce){var oe=new RegExp(K).exec(ce).filter(function(ae){return!!ae}),se=oe[1],le=oe.slice(2).map(parseFloat);switch(se){case"translate":(function(ae,he){ae[4]=he[0],he.length===2&&(ae[5]=he[1])})(Q,le);break;case"rotate":le[0]=s.util.degreesToRadians(le[0]),function(ae,he){var pe=s.util.cos(he[0]),ue=s.util.sin(he[0]),ye=0,xe=0;he.length===3&&(ye=he[1],xe=he[2]),ae[0]=pe,ae[1]=ue,ae[2]=-ue,ae[3]=pe,ae[4]=ye-(pe*ye-ue*xe),ae[5]=xe-(ue*ye+pe*xe)}(Q,le);break;case"scale":(function(ae,he){var pe=he[0],ue=he.length===2?he[1]:he[0];ae[0]=pe,ae[3]=ue})(Q,le);break;case"skewX":M(Q,le,2);break;case"skewY":M(Q,le,1);break;case"matrix":Q=le}$.push(Q.concat()),Q=R.concat()});for(var ie=$[0];$.length>1;)$.shift(),ie=s.util.multiplyTransformMatrices(ie,$[0]);return ie}}();var j=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function Z(M){if(!s.svgViewBoxElementsRegEx.test(M.nodeName))return{};var R,V,q,K,B,F,z=M.getAttribute("viewBox"),Q=1,$=1,ie=M.getAttribute("width"),ce=M.getAttribute("height"),oe=M.getAttribute("x")||0,se=M.getAttribute("y")||0,le=M.getAttribute("preserveAspectRatio")||"",ae=!z||!(z=z.match(j)),he=!ie||!ce||ie==="100%"||ce==="100%",pe=ae&&he,ue={},ye="",xe=0,Ye=0;if(ue.width=0,ue.height=0,ue.toBeParsed=pe,ae&&(oe||se)&&M.parentNode&&M.parentNode.nodeName!=="#document"&&(ye=" translate("+o(oe)+" "+o(se)+") ",B=(M.getAttribute("transform")||"")+ye,M.setAttribute("transform",B),M.removeAttribute("x"),M.removeAttribute("y")),pe)return ue;if(ae)return ue.width=o(ie),ue.height=o(ce),ue;if(R=-parseFloat(z[1]),V=-parseFloat(z[2]),q=parseFloat(z[3]),K=parseFloat(z[4]),ue.minX=R,ue.minY=V,ue.viewBoxWidth=q,ue.viewBoxHeight=K,he?(ue.width=q,ue.height=K):(ue.width=o(ie),ue.height=o(ce),Q=ue.width/q,$=ue.height/K),(le=s.util.parsePreserveAspectRatioAttribute(le)).alignX!=="none"&&(le.meetOrSlice==="meet"&&($=Q=Q>$?$:Q),le.meetOrSlice==="slice"&&($=Q=Q>$?Q:$),xe=ue.width-q*Q,Ye=ue.height-K*Q,le.alignX==="Mid"&&(xe/=2),le.alignY==="Mid"&&(Ye/=2),le.alignX==="Min"&&(xe=0),le.alignY==="Min"&&(Ye=0)),Q===1&&$===1&&R===0&&V===0&&oe===0&&se===0)return ue;if((oe||se)&&M.parentNode.nodeName!=="#document"&&(ye=" translate("+o(oe)+" "+o(se)+") "),B=ye+" matrix("+Q+" 0 0 "+$+" "+(R*Q+xe)+" "+(V*$+Ye)+") ",M.nodeName==="svg"){for(F=M.ownerDocument.createElementNS(s.svgNS,"g");M.firstChild;)F.appendChild(M.firstChild);M.appendChild(F)}else(F=M).removeAttribute("x"),F.removeAttribute("y"),B=F.getAttribute("transform")+B;return F.setAttribute("transform",B),ue}function X(M,R){var V="xlink:href",q=P(M,R.getAttribute(V).slice(1));if(q&&q.getAttribute(V)&&X(M,q),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(B){q&&!R.hasAttribute(B)&&q.hasAttribute(B)&&R.setAttribute(B,q.getAttribute(B))}),!R.children.length)for(var K=q.cloneNode(!0);K.firstChild;)R.appendChild(K.firstChild);R.removeAttribute(V)}s.parseSVGDocument=function(M,R,V,q){if(M){(function(oe){for(var se=T(oe,["use","svg:use"]),le=0;se.length&&le<se.length;){var ae=se[le],he=ae.getAttribute("xlink:href")||ae.getAttribute("href");if(he===null)return;var pe,ue,ye,xe,Ye=he.slice(1),et=ae.getAttribute("x")||0,At=ae.getAttribute("y")||0,Ee=P(oe,Ye).cloneNode(!0),Xe=(Ee.getAttribute("transform")||"")+" translate("+et+", "+At+")",Gt=se.length,Dt=s.svgNS;if(Z(Ee),/^svg$/i.test(Ee.nodeName)){var _t=Ee.ownerDocument.createElementNS(Dt,"g");for(ue=0,xe=(ye=Ee.attributes).length;ue<xe;ue++)pe=ye.item(ue),_t.setAttributeNS(Dt,pe.nodeName,pe.nodeValue);for(;Ee.firstChild;)_t.appendChild(Ee.firstChild);Ee=_t}for(ue=0,xe=(ye=ae.attributes).length;ue<xe;ue++)(pe=ye.item(ue)).nodeName!=="x"&&pe.nodeName!=="y"&&pe.nodeName!=="xlink:href"&&pe.nodeName!=="href"&&(pe.nodeName==="transform"?Xe=pe.nodeValue+" "+Xe:Ee.setAttribute(pe.nodeName,pe.nodeValue));Ee.setAttribute("transform",Xe),Ee.setAttribute("instantiated_by_use","1"),Ee.removeAttribute("id"),ae.parentNode.replaceChild(Ee,ae),se.length===Gt&&le++}})(M);var K,B,F=s.Object.__uid++,z=Z(M),Q=s.util.toArray(M.getElementsByTagName("*"));if(z.crossOrigin=q&&q.crossOrigin,z.svgUid=F,Q.length===0&&s.isLikelyNode){var $=[];for(K=0,B=(Q=M.selectNodes('//*[name(.)!="svg"]')).length;K<B;K++)$[K]=Q[K];Q=$}var ie=Q.filter(function(oe){return Z(oe),s.svgValidTagNamesRegEx.test(oe.nodeName.replace("svg:",""))&&!function(se,le){for(;se&&(se=se.parentNode);)if(se.nodeName&&le.test(se.nodeName.replace("svg:",""))&&!se.getAttribute("instantiated_by_use"))return!0;return!1}(oe,s.svgInvalidAncestorsRegEx)});if(!ie||ie&&!ie.length)R&&R([],{});else{var ce={};Q.filter(function(oe){return oe.nodeName.replace("svg:","")==="clipPath"}).forEach(function(oe){var se=oe.getAttribute("id");ce[se]=s.util.toArray(oe.getElementsByTagName("*")).filter(function(le){return s.svgValidTagNamesRegEx.test(le.nodeName.replace("svg:",""))})}),s.gradientDefs[F]=s.getGradientDefs(M),s.cssRules[F]=s.getCSSRules(M),s.clipPaths[F]=ce,s.parseElements(ie,function(oe,se){R&&(R(oe,z,se,Q),delete s.gradientDefs[F],delete s.cssRules[F],delete s.clipPaths[F])},u(z),V,q)}}};var W=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");l(s,{parseFontDeclaration:function(M,R){var V=M.match(W);if(V){var q=V[1],K=V[3],B=V[4],F=V[5],z=V[6];q&&(R.fontStyle=q),K&&(R.fontWeight=isNaN(parseFloat(K))?K:parseFloat(K)),B&&(R.fontSize=o(B)),z&&(R.fontFamily=z),F&&(R.lineHeight=F==="normal"?1:F)}},getGradientDefs:function(M){var R,V=T(M,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),q=0,K={};for(q=V.length;q--;)(R=V[q]).getAttribute("xlink:href")&&X(M,R),K[R.getAttribute("id")]=R;return K},parseAttributes:function(M,R,V){if(M){var q,K,B,F={};V===void 0&&(V=M.getAttribute("svgUid")),M.parentNode&&s.svgValidParentsRegEx.test(M.parentNode.nodeName)&&(F=s.parseAttributes(M.parentNode,R,V));var z=R.reduce(function(le,ae){return(q=M.getAttribute(ae))&&(le[ae]=q),le},{}),Q=l(function(le,ae){var he={};for(var pe in s.cssRules[ae])if(A(le,pe.split(" ")))for(var ue in s.cssRules[ae][pe])he[ue]=s.cssRules[ae][pe][ue];return he}(M,V),s.parseStyleAttribute(M));z=l(z,Q),Q[m]&&M.setAttribute(m,Q[m]),K=B=F.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,z[g]&&(z[g]=K=o(z[g],B));var $,ie,ce={};for(var oe in z)ie=w($=S(oe),z[oe],F,K),ce[$]=ie;ce&&ce.font&&s.parseFontDeclaration(ce.font,ce);var se=l(F,ce);return s.svgValidParentsRegEx.test(M.nodeName)?se:function(le){for(var ae in f)if(le[f[ae]]!==void 0&&le[ae]!==""){if(le[ae]===void 0){if(!s.Object.prototype[ae])continue;le[ae]=s.Object.prototype[ae]}if(le[ae].indexOf("url(")!==0){var he=new s.Color(le[ae]);le[ae]=he.setAlpha(r(he.getAlpha()*le[f[ae]],2)).toRgba()}}return le}(se)}},parseElements:function(M,R,V,q,K){new s.ElementsParser(M,R,V,q,K).parse()},parseStyleAttribute:function(M){var R={},V=M.getAttribute("style");return V&&(typeof V=="string"?function(q,K){var B,F;q.replace(/;\s*$/,"").split(";").forEach(function(z){var Q=z.split(":");B=Q[0].trim().toLowerCase(),F=Q[1].trim(),K[B]=F})}(V,R):function(q,K){var B,F;for(var z in q)q[z]!==void 0&&(B=z.toLowerCase(),F=q[z],K[B]=F)}(V,R)),R},parsePointsAttribute:function(M){if(!M)return null;var R,V,q=[];for(R=0,V=(M=(M=M.replace(/,/g," ").trim()).split(/\s+/)).length;R<V;R+=2)q.push({x:parseFloat(M[R]),y:parseFloat(M[R+1])});return q},getCSSRules:function(M){var R,V,q=M.getElementsByTagName("style"),K={};for(R=0,V=q.length;R<V;R++){var B=q[R].textContent;(B=B.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&B.split("}").filter(function(F){return F.trim()}).forEach(function(F){var z=F.split("{"),Q={},$=z[1].trim().split(";").filter(function(se){return se.trim()});for(R=0,V=$.length;R<V;R++){var ie=$[R].split(":"),ce=ie[0].trim(),oe=ie[1].trim();Q[ce]=oe}(F=z[0].trim()).split(",").forEach(function(se){(se=se.replace(/^svg/i,"").trim())!==""&&(K[se]?s.util.object.extend(K[se],Q):K[se]=s.util.object.clone(Q))})})}return K},loadSVGFromURL:function(M,R,V,q){M=M.replace(/^\n\s*/,"").trim(),new s.util.request(M,{method:"get",onComplete:function(K){var B=K.responseXML;if(!B||!B.documentElement)return R&&R(null),!1;s.parseSVGDocument(B.documentElement,function(F,z,Q,$){R&&R(F,z,Q,$)},V,q)}})},loadSVGFromString:function(M,R,V,q){var K=new s.window.DOMParser().parseFromString(M.trim(),"text/xml");s.parseSVGDocument(K.documentElement,function(B,F,z,Q){R(B,F,z,Q)},V,q)}})}(e),y.ElementsParser=function(a,s,l,u,r,o){this.elements=a,this.callback=s,this.options=l,this.reviver=u,this.svgUid=l&&l.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=o},(U=y.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},U.createObjects=function(){var a=this;this.elements.forEach(function(s,l){s.setAttribute("svgUid",a.svgUid),a.createObject(s,l)})},U.findTag=function(a){return y[y.util.string.capitalize(a.tagName.replace("svg:",""))]},U.createObject=function(a,s){var l=this.findTag(a);if(l&&l.fromElement)try{l.fromElement(a,this.createCallback(s,a),this.options)}catch(u){y.log(u)}else this.checkIfDone()},U.createCallback=function(a,s){var l=this;return function(u){var r;l.resolveGradient(u,s,"fill"),l.resolveGradient(u,s,"stroke"),u instanceof y.Image&&u._originalElement&&(r=u.parsePreserveAspectRatioAttribute(s)),u._removeTransformMatrix(r),l.resolveClipPath(u,s),l.reviver&&l.reviver(s,u),l.instances[a]=u,l.checkIfDone()}},U.extractPropertyDefinition=function(a,s,l){var u=a[s],r=this.regexUrl;if(r.test(u)){r.lastIndex=0;var o=r.exec(u)[1];return r.lastIndex=0,y[l][this.svgUid][o]}},U.resolveGradient=function(a,s,l){var u=this.extractPropertyDefinition(a,l,"gradientDefs");if(u){var r=s.getAttribute(l+"-opacity"),o=y.Gradient.fromElement(u,a,r,this.options);a.set(l,o)}},U.createClipPathCallback=function(a,s){return function(l){l._removeTransformMatrix(),l.fillRule=l.clipRule,s.push(l)}},U.resolveClipPath=function(a,s){var l,u,r,o,c=this.extractPropertyDefinition(a,"clipPath","clipPaths");if(c){r=[],u=y.util.invertTransform(a.calcTransformMatrix());for(var _=c[0].parentNode,f=s;f.parentNode&&f.getAttribute("clip-path")!==a.clipPath;)f=f.parentNode;f.parentNode.appendChild(_);for(var g=0;g<c.length;g++)l=c[g],this.findTag(l).fromElement(l,this.createClipPathCallback(a,r),this.options);c=r.length===1?r[0]:new y.Group(r),o=y.util.multiplyTransformMatrices(u,c.calcTransformMatrix()),c.clipPath&&this.resolveClipPath(c,f);var m=y.util.qrDecompose(o);c.flipX=!1,c.flipY=!1,c.set("scaleX",m.scaleX),c.set("scaleY",m.scaleY),c.angle=m.angle,c.skewX=m.skewX,c.skewY=0,c.setPositionByOrigin({x:m.translateX,y:m.translateY},"center","center"),a.clipPath=c}else delete a.clipPath},U.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(a){return a!=null}),this.callback(this.instances,this.elements))},function(a){var s=a.fabric||(a.fabric={});function l(u,r){this.x=u,this.y=r}s.Point?s.warn("fabric.Point is already defined"):(s.Point=l,l.prototype={type:"point",constructor:l,add:function(u){return new l(this.x+u.x,this.y+u.y)},addEquals:function(u){return this.x+=u.x,this.y+=u.y,this},scalarAdd:function(u){return new l(this.x+u,this.y+u)},scalarAddEquals:function(u){return this.x+=u,this.y+=u,this},subtract:function(u){return new l(this.x-u.x,this.y-u.y)},subtractEquals:function(u){return this.x-=u.x,this.y-=u.y,this},scalarSubtract:function(u){return new l(this.x-u,this.y-u)},scalarSubtractEquals:function(u){return this.x-=u,this.y-=u,this},multiply:function(u){return new l(this.x*u,this.y*u)},multiplyEquals:function(u){return this.x*=u,this.y*=u,this},divide:function(u){return new l(this.x/u,this.y/u)},divideEquals:function(u){return this.x/=u,this.y/=u,this},eq:function(u){return this.x===u.x&&this.y===u.y},lt:function(u){return this.x<u.x&&this.y<u.y},lte:function(u){return this.x<=u.x&&this.y<=u.y},gt:function(u){return this.x>u.x&&this.y>u.y},gte:function(u){return this.x>=u.x&&this.y>=u.y},lerp:function(u,r){return r===void 0&&(r=.5),r=Math.max(Math.min(1,r),0),new l(this.x+(u.x-this.x)*r,this.y+(u.y-this.y)*r)},distanceFrom:function(u){var r=this.x-u.x,o=this.y-u.y;return Math.sqrt(r*r+o*o)},midPointFrom:function(u){return this.lerp(u)},min:function(u){return new l(Math.min(this.x,u.x),Math.min(this.y,u.y))},max:function(u){return new l(Math.max(this.x,u.x),Math.max(this.y,u.y))},toString:function(){return this.x+","+this.y},setXY:function(u,r){return this.x=u,this.y=r,this},setX:function(u){return this.x=u,this},setY:function(u){return this.y=u,this},setFromPoint:function(u){return this.x=u.x,this.y=u.y,this},swap:function(u){var r=this.x,o=this.y;this.x=u.x,this.y=u.y,u.x=r,u.y=o},clone:function(){return new l(this.x,this.y)}})}(e),function(a){var s=a.fabric||(a.fabric={});function l(u){this.status=u,this.points=[]}s.Intersection?s.warn("fabric.Intersection is already defined"):(s.Intersection=l,s.Intersection.prototype={constructor:l,appendPoint:function(u){return this.points.push(u),this},appendPoints:function(u){return this.points=this.points.concat(u),this}},s.Intersection.intersectLineLine=function(u,r,o,c){var _,f=(c.x-o.x)*(u.y-o.y)-(c.y-o.y)*(u.x-o.x),g=(r.x-u.x)*(u.y-o.y)-(r.y-u.y)*(u.x-o.x),m=(c.y-o.y)*(r.x-u.x)-(c.x-o.x)*(r.y-u.y);if(m!==0){var S=f/m,w=g/m;0<=S&&S<=1&&0<=w&&w<=1?(_=new l("Intersection")).appendPoint(new s.Point(u.x+S*(r.x-u.x),u.y+S*(r.y-u.y))):_=new l}else _=new l(f===0||g===0?"Coincident":"Parallel");return _},s.Intersection.intersectLinePolygon=function(u,r,o){var c,_,f,g,m=new l,S=o.length;for(g=0;g<S;g++)c=o[g],_=o[(g+1)%S],f=l.intersectLineLine(u,r,c,_),m.appendPoints(f.points);return m.points.length>0&&(m.status="Intersection"),m},s.Intersection.intersectPolygonPolygon=function(u,r){var o,c=new l,_=u.length;for(o=0;o<_;o++){var f=u[o],g=u[(o+1)%_],m=l.intersectLinePolygon(f,g,r);c.appendPoints(m.points)}return c.points.length>0&&(c.status="Intersection"),c},s.Intersection.intersectPolygonRectangle=function(u,r,o){var c=r.min(o),_=r.max(o),f=new s.Point(_.x,c.y),g=new s.Point(c.x,_.y),m=l.intersectLinePolygon(c,f,u),S=l.intersectLinePolygon(f,_,u),w=l.intersectLinePolygon(_,g,u),I=l.intersectLinePolygon(g,c,u),T=new l;return T.appendPoints(m.points),T.appendPoints(S.points),T.appendPoints(w.points),T.appendPoints(I.points),T.points.length>0&&(T.status="Intersection"),T})}(e),function(a){var s=a.fabric||(a.fabric={});function l(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}function u(r,o,c){return c<0&&(c+=1),c>1&&(c-=1),c<1/6?r+6*(o-r)*c:c<.5?o:c<2/3?r+(o-r)*(2/3-c)*6:r}s.Color?s.warn("fabric.Color is already defined."):(s.Color=l,s.Color.prototype={_tryParsingColor:function(r){var o;r in l.colorNameMap&&(r=l.colorNameMap[r]),r==="transparent"&&(o=[255,255,255,0]),o||(o=l.sourceFromHex(r)),o||(o=l.sourceFromRgb(r)),o||(o=l.sourceFromHsl(r)),o||(o=[0,0,0,1]),o&&this.setSource(o)},_rgbToHsl:function(r,o,c){r/=255,o/=255,c/=255;var _,f,g,m=s.util.array.max([r,o,c]),S=s.util.array.min([r,o,c]);if(g=(m+S)/2,m===S)_=f=0;else{var w=m-S;switch(f=g>.5?w/(2-m-S):w/(m+S),m){case r:_=(o-c)/w+(o<c?6:0);break;case o:_=(c-r)/w+2;break;case c:_=(r-o)/w+4}_/=6}return[Math.round(360*_),Math.round(100*f),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),o=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+o[0]+","+o[1]+"%,"+o[2]+"%)"},toHsla:function(){var r=this.getSource(),o=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+o[0]+","+o[1]+"%,"+o[2]+"%,"+r[3]+")"},toHex:function(){var r,o,c,_=this.getSource();return r=(r=_[0].toString(16)).length===1?"0"+r:r,o=(o=_[1].toString(16)).length===1?"0"+o:o,c=(c=_[2].toString(16)).length===1?"0"+c:c,r.toUpperCase()+o.toUpperCase()+c.toUpperCase()},toHexa:function(){var r,o=this.getSource();return r=(r=(r=Math.round(255*o[3])).toString(16)).length===1?"0"+r:r,this.toHex()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var o=this.getSource();return o[3]=r,this.setSource(o),this},toGrayscale:function(){var r=this.getSource(),o=parseInt((.3*r[0]+.59*r[1]+.11*r[2]).toFixed(0),10),c=r[3];return this.setSource([o,o,o,c]),this},toBlackWhite:function(r){var o=this.getSource(),c=(.3*o[0]+.59*o[1]+.11*o[2]).toFixed(0),_=o[3];return r=r||127,c=Number(c)<Number(r)?0:255,this.setSource([c,c,c,_]),this},overlayWith:function(r){r instanceof l||(r=new l(r));var o,c=[],_=this.getAlpha(),f=this.getSource(),g=r.getSource();for(o=0;o<3;o++)c.push(Math.round(.5*f[o]+.5*g[o]));return c[3]=_,this.setSource(c),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},s.Color.fromRgb=function(r){return l.fromSource(l.sourceFromRgb(r))},s.Color.sourceFromRgb=function(r){var o=r.match(l.reRGBa);if(o){var c=parseInt(o[1],10)/(/%$/.test(o[1])?100:1)*(/%$/.test(o[1])?255:1),_=parseInt(o[2],10)/(/%$/.test(o[2])?100:1)*(/%$/.test(o[2])?255:1),f=parseInt(o[3],10)/(/%$/.test(o[3])?100:1)*(/%$/.test(o[3])?255:1);return[parseInt(c,10),parseInt(_,10),parseInt(f,10),o[4]?parseFloat(o[4]):1]}},s.Color.fromRgba=l.fromRgb,s.Color.fromHsl=function(r){return l.fromSource(l.sourceFromHsl(r))},s.Color.sourceFromHsl=function(r){var o=r.match(l.reHSLa);if(o){var c,_,f,g=(parseFloat(o[1])%360+360)%360/360,m=parseFloat(o[2])/(/%$/.test(o[2])?100:1),S=parseFloat(o[3])/(/%$/.test(o[3])?100:1);if(m===0)c=_=f=S;else{var w=S<=.5?S*(m+1):S+m-S*m,I=2*S-w;c=u(I,w,g+1/3),_=u(I,w,g),f=u(I,w,g-1/3)}return[Math.round(255*c),Math.round(255*_),Math.round(255*f),o[4]?parseFloat(o[4]):1]}},s.Color.fromHsla=l.fromHsl,s.Color.fromHex=function(r){return l.fromSource(l.sourceFromHex(r))},s.Color.sourceFromHex=function(r){if(r.match(l.reHex)){var o=r.slice(r.indexOf("#")+1),c=o.length===3||o.length===4,_=o.length===8||o.length===4,f=c?o.charAt(0)+o.charAt(0):o.substring(0,2),g=c?o.charAt(1)+o.charAt(1):o.substring(2,4),m=c?o.charAt(2)+o.charAt(2):o.substring(4,6),S=_?c?o.charAt(3)+o.charAt(3):o.substring(6,8):"FF";return[parseInt(f,16),parseInt(g,16),parseInt(m,16),parseFloat((parseInt(S,16)/255).toFixed(2))]}},s.Color.fromSource=function(r){var o=new l;return o.setSource(r),o})}(e),function(a){var s=a.fabric||(a.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],u=["ns","nesw","ew","nwse"],r={},o="left",c="top",_="right",f="bottom",g="center",m={top:f,bottom:c,left:_,right:o,center:g},S=s.util.radiansToDegrees,w=Math.sign||function(B){return(B>0)-(B<0)||+B};function I(B,F){var z=B.angle+S(Math.atan2(F.y,F.x))+360;return Math.round(z%360/45)}function T(B,F){var z=F.transform.target,Q=z.canvas,$=s.util.object.clone(F);$.target=z,Q&&Q.fire("object:"+B,$),z.fire(B,F)}function A(B,F){var z=F.canvas,Q=B[z.uniScaleKey];return z.uniformScaling&&!Q||!z.uniformScaling&&Q}function D(B){return B.originX===g&&B.originY===g}function P(B,F,z){var Q=B.lockScalingX,$=B.lockScalingY;return!((!Q||!$)&&(F||!Q&&!$||!z)&&(!Q||F!=="x")&&(!$||F!=="y"))}function j(B,F,z,Q){return{e:B,transform:F,pointer:{x:z,y:Q}}}function Z(B){return function(F,z,Q,$){var ie=z.target,ce=ie.getCenterPoint(),oe=ie.translateToOriginPoint(ce,z.originX,z.originY),se=B(F,z,Q,$);return ie.setPositionByOrigin(oe,z.originX,z.originY),se}}function X(B,F){return function(z,Q,$,ie){var ce=F(z,Q,$,ie);return ce&&T(B,j(z,Q,$,ie)),ce}}function W(B,F,z,Q,$){var ie=B.target,ce=ie.controls[B.corner],oe=ie.canvas.getZoom(),se=ie.padding/oe,le=ie.toLocalPoint(new s.Point(Q,$),F,z);return le.x>=se&&(le.x-=se),le.x<=-se&&(le.x+=se),le.y>=se&&(le.y-=se),le.y<=se&&(le.y+=se),le.x-=ce.offsetX,le.y-=ce.offsetY,le}function M(B){return B.flipX!==B.flipY}function R(B,F,z,Q,$){if(B[F]!==0){var ie=$/B._getTransformedDimensions()[Q]*B[z];B.set(z,ie)}}function V(B,F,z,Q){var $,ie=F.target,ce=ie._getTransformedDimensions(0,ie.skewY),oe=W(F,F.originX,F.originY,z,Q),se=Math.abs(2*oe.x)-ce.x,le=ie.skewX;se<2?$=0:($=S(Math.atan2(se/ie.scaleX,ce.y/ie.scaleY)),F.originX===o&&F.originY===f&&($=-$),F.originX===_&&F.originY===c&&($=-$),M(ie)&&($=-$));var ae=le!==$;if(ae){var he=ie._getTransformedDimensions().y;ie.set("skewX",$),R(ie,"skewY","scaleY","y",he)}return ae}function q(B,F,z,Q){var $,ie=F.target,ce=ie._getTransformedDimensions(ie.skewX,0),oe=W(F,F.originX,F.originY,z,Q),se=Math.abs(2*oe.y)-ce.y,le=ie.skewY;se<2?$=0:($=S(Math.atan2(se/ie.scaleY,ce.x/ie.scaleX)),F.originX===o&&F.originY===f&&($=-$),F.originX===_&&F.originY===c&&($=-$),M(ie)&&($=-$));var ae=le!==$;if(ae){var he=ie._getTransformedDimensions().x;ie.set("skewY",$),R(ie,"skewX","scaleX","x",he)}return ae}function K(B,F,z,Q,$){$=$||{};var ie,ce,oe,se,le,ae,he=F.target,pe=he.lockScalingX,ue=he.lockScalingY,ye=$.by,xe=A(B,he),Ye=P(he,ye,xe),et=F.gestureScale;if(Ye)return!1;if(et)ce=F.scaleX*et,oe=F.scaleY*et;else{if(ie=W(F,F.originX,F.originY,z,Q),le=ye!=="y"?w(ie.x):1,ae=ye!=="x"?w(ie.y):1,F.signX||(F.signX=le),F.signY||(F.signY=ae),he.lockScalingFlip&&(F.signX!==le||F.signY!==ae))return!1;if(se=he._getTransformedDimensions(),xe&&!ye){var At=Math.abs(ie.x)+Math.abs(ie.y),Ee=F.original,Xe=At/(Math.abs(se.x*Ee.scaleX/he.scaleX)+Math.abs(se.y*Ee.scaleY/he.scaleY));ce=Ee.scaleX*Xe,oe=Ee.scaleY*Xe}else ce=Math.abs(ie.x*he.scaleX/se.x),oe=Math.abs(ie.y*he.scaleY/se.y);D(F)&&(ce*=2,oe*=2),F.signX!==le&&ye!=="y"&&(F.originX=m[F.originX],ce*=-1,F.signX=le),F.signY!==ae&&ye!=="x"&&(F.originY=m[F.originY],oe*=-1,F.signY=ae)}var Gt=he.scaleX,Dt=he.scaleY;return ye?(ye==="x"&&he.set("scaleX",ce),ye==="y"&&he.set("scaleY",oe)):(!pe&&he.set("scaleX",ce),!ue&&he.set("scaleY",oe)),Gt!==he.scaleX||Dt!==he.scaleY}r.scaleCursorStyleHandler=function(B,F,z){var Q=A(B,z),$="";if(F.x!==0&&F.y===0?$="x":F.x===0&&F.y!==0&&($="y"),P(z,$,Q))return"not-allowed";var ie=I(z,F);return l[ie]+"-resize"},r.skewCursorStyleHandler=function(B,F,z){var Q="not-allowed";if(F.x!==0&&z.lockSkewingY||F.y!==0&&z.lockSkewingX)return Q;var $=I(z,F)%4;return u[$]+"-resize"},r.scaleSkewCursorStyleHandler=function(B,F,z){return B[z.canvas.altActionKey]?r.skewCursorStyleHandler(B,F,z):r.scaleCursorStyleHandler(B,F,z)},r.rotationWithSnapping=X("rotating",Z(function(B,F,z,Q){var $=F,ie=$.target,ce=ie.translateToOriginPoint(ie.getCenterPoint(),$.originX,$.originY);if(ie.lockRotation)return!1;var oe,se=Math.atan2($.ey-ce.y,$.ex-ce.x),le=Math.atan2(Q-ce.y,z-ce.x),ae=S(le-se+$.theta);if(ie.snapAngle>0){var he=ie.snapAngle,pe=ie.snapThreshold||he,ue=Math.ceil(ae/he)*he,ye=Math.floor(ae/he)*he;Math.abs(ae-ye)<pe?ae=ye:Math.abs(ae-ue)<pe&&(ae=ue)}return ae<0&&(ae=360+ae),ae%=360,oe=ie.angle!==ae,ie.angle=ae,oe})),r.scalingEqually=X("scaling",Z(function(B,F,z,Q){return K(B,F,z,Q)})),r.scalingX=X("scaling",Z(function(B,F,z,Q){return K(B,F,z,Q,{by:"x"})})),r.scalingY=X("scaling",Z(function(B,F,z,Q){return K(B,F,z,Q,{by:"y"})})),r.scalingYOrSkewingX=function(B,F,z,Q){return B[F.target.canvas.altActionKey]?r.skewHandlerX(B,F,z,Q):r.scalingY(B,F,z,Q)},r.scalingXOrSkewingY=function(B,F,z,Q){return B[F.target.canvas.altActionKey]?r.skewHandlerY(B,F,z,Q):r.scalingX(B,F,z,Q)},r.changeWidth=X("resizing",Z(function(B,F,z,Q){var $=F.target,ie=W(F,F.originX,F.originY,z,Q),ce=$.strokeWidth/($.strokeUniform?$.scaleX:1),oe=D(F)?2:1,se=$.width,le=Math.abs(ie.x*oe/$.scaleX)-ce;return $.set("width",Math.max(le,0)),se!==le})),r.skewHandlerX=function(B,F,z,Q){var $,ie=F.target,ce=ie.skewX,oe=F.originY;return!ie.lockSkewingX&&(ce===0?$=W(F,g,g,z,Q).x>0?o:_:(ce>0&&($=oe===c?o:_),ce<0&&($=oe===c?_:o),M(ie)&&($=$===o?_:o)),F.originX=$,X("skewing",Z(V))(B,F,z,Q))},r.skewHandlerY=function(B,F,z,Q){var $,ie=F.target,ce=ie.skewY,oe=F.originX;return!ie.lockSkewingY&&(ce===0?$=W(F,g,g,z,Q).y>0?c:f:(ce>0&&($=oe===o?c:f),ce<0&&($=oe===o?f:c),M(ie)&&($=$===c?f:c)),F.originY=$,X("skewing",Z(q))(B,F,z,Q))},r.dragHandler=function(B,F,z,Q){var $=F.target,ie=z-F.offsetX,ce=Q-F.offsetY,oe=!$.get("lockMovementX")&&$.left!==ie,se=!$.get("lockMovementY")&&$.top!==ce;return oe&&$.set("left",ie),se&&$.set("top",ce),(oe||se)&&T("moving",j(B,F,z,Q)),oe||se},r.scaleOrSkewActionName=function(B,F,z){var Q=B[z.canvas.altActionKey];return F.x===0?Q?"skewX":"scaleY":F.y===0?Q?"skewY":"scaleX":void 0},r.rotationStyleHandler=function(B,F,z){return z.lockRotation?"not-allowed":F.cursorStyle},r.fireEvent=T,r.wrapWithFixedAnchor=Z,r.wrapWithFireEvent=X,r.getLocalPoint=W,s.controlsUtils=r}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.degreesToRadians,u=s.controlsUtils;u.renderCircleControl=function(r,o,c,_,f){_=_||{};var g,m=this.sizeX||_.cornerSize||f.cornerSize,S=this.sizeY||_.cornerSize||f.cornerSize,w=_.transparentCorners!==void 0?_.transparentCorners:f.transparentCorners,I=w?"stroke":"fill",T=!w&&(_.cornerStrokeColor||f.cornerStrokeColor),A=o,D=c;r.save(),r.fillStyle=_.cornerColor||f.cornerColor,r.strokeStyle=_.cornerStrokeColor||f.cornerStrokeColor,m>S?(g=m,r.scale(1,S/m),D=c*m/S):S>m?(g=S,r.scale(m/S,1),A=o*S/m):g=m,r.lineWidth=1,r.beginPath(),r.arc(A,D,g/2,0,2*Math.PI,!1),r[I](),T&&r.stroke(),r.restore()},u.renderSquareControl=function(r,o,c,_,f){_=_||{};var g=this.sizeX||_.cornerSize||f.cornerSize,m=this.sizeY||_.cornerSize||f.cornerSize,S=_.transparentCorners!==void 0?_.transparentCorners:f.transparentCorners,w=S?"stroke":"fill",I=!S&&(_.cornerStrokeColor||f.cornerStrokeColor),T=g/2,A=m/2;r.save(),r.fillStyle=_.cornerColor||f.cornerColor,r.strokeStyle=_.cornerStrokeColor||f.cornerStrokeColor,r.lineWidth=1,r.translate(o,c),r.rotate(l(f.angle)),r[w+"Rect"](-T,-A,g,m),I&&r.strokeRect(-T,-A,g,m),r.restore()}}(e),function(a){var s=a.fabric||(a.fabric={});s.Control=function(l){for(var u in l)this[u]=l[u]},s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(l,u){return u.cursorStyle},getActionName:function(l,u){return u.actionName},getVisibility:function(l,u){var r=l._controlsVisibility;return r&&r[u]!==void 0?r[u]:this.visible},setVisibility:function(l){this.visible=l},positionHandler:function(l,u){return s.util.transformPoint({x:this.x*l.x+this.offsetX,y:this.y*l.y+this.offsetY},u)},calcCornerCoords:function(l,u,r,o,c){var _,f,g,m,S=c?this.touchSizeX:this.sizeX,w=c?this.touchSizeY:this.sizeY;if(S&&w&&S!==w){var I=Math.atan2(w,S),T=Math.sqrt(S*S+w*w)/2,A=I-s.util.degreesToRadians(l),D=Math.PI/2-I-s.util.degreesToRadians(l);_=T*s.util.cos(A),f=T*s.util.sin(A),g=T*s.util.cos(D),m=T*s.util.sin(D)}else T=.7071067812*(S&&w?S:u),A=s.util.degreesToRadians(45-l),_=g=T*s.util.cos(A),f=m=T*s.util.sin(A);return{tl:{x:r-m,y:o-g},tr:{x:r+_,y:o-f},bl:{x:r-_,y:o+f},br:{x:r+m,y:o+g}}},render:function(l,u,r,o,c){((o=o||{}).cornerStyle||c.cornerStyle)==="circle"?s.controlsUtils.renderCircleControl.call(this,l,u,r,o,c):s.controlsUtils.renderSquareControl.call(this,l,u,r,o,c)}}}(e),function(){function a(l,u){var r,o,c,_,f=l.getAttribute("style"),g=l.getAttribute("offset")||0;if(g=(g=parseFloat(g)/(/%$/.test(g)?100:1))<0?0:g>1?1:g,f){var m=f.split(/\s*;\s*/);for(m[m.length-1]===""&&m.pop(),_=m.length;_--;){var S=m[_].split(/\s*:\s*/),w=S[0].trim(),I=S[1].trim();w==="stop-color"?r=I:w==="stop-opacity"&&(c=I)}}return r||(r=l.getAttribute("stop-color")||"rgb(0,0,0)"),c||(c=l.getAttribute("stop-opacity")),o=(r=new y.Color(r)).getAlpha(),c=isNaN(parseFloat(c))?1:parseFloat(c),c*=o*u,{offset:g,color:r.toRgb(),opacity:c}}var s=y.util.object.clone;y.Gradient=y.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(l){l||(l={}),l.coords||(l.coords={});var u,r=this;Object.keys(l).forEach(function(o){r[o]=l[o]}),this.id?this.id+="_"+y.Object.__uid++:this.id=y.Object.__uid++,u={x1:l.coords.x1||0,y1:l.coords.y1||0,x2:l.coords.x2||0,y2:l.coords.y2||0},this.type==="radial"&&(u.r1=l.coords.r1||0,u.r2=l.coords.r2||0),this.coords=u,this.colorStops=l.colorStops.slice()},addColorStop:function(l){for(var u in l){var r=new y.Color(l[u]);this.colorStops.push({offset:parseFloat(u),color:r.toRgb(),opacity:r.getAlpha()})}return this},toObject:function(l){var u={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return y.util.populateWithProperties(this,u,l),u},toSVG:function(l,u){var r,o,c,_,f=s(this.coords,!0),g=(u=u||{},s(this.colorStops,!0)),m=f.r1>f.r2,S=this.gradientTransform?this.gradientTransform.concat():y.iMatrix.concat(),w=-this.offsetX,I=-this.offsetY,T=!!u.additionalTransform,A=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(g.sort(function(Z,X){return Z.offset-X.offset}),A==="objectBoundingBox"?(w/=l.width,I/=l.height):(w+=l.width/2,I+=l.height/2),l.type==="path"&&this.gradientUnits!=="percentage"&&(w-=l.pathOffset.x,I-=l.pathOffset.y),S[4]-=w,S[5]-=I,_='id="SVGID_'+this.id+'" gradientUnits="'+A+'"',_+=' gradientTransform="'+(T?u.additionalTransform+" ":"")+y.util.matrixToSVG(S)+'" ',this.type==="linear"?c=["<linearGradient ",_,' x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,`">
`]:this.type==="radial"&&(c=["<radialGradient ",_,' cx="',m?f.x1:f.x2,'" cy="',m?f.y1:f.y2,'" r="',m?f.r1:f.r2,'" fx="',m?f.x2:f.x1,'" fy="',m?f.y2:f.y1,`">
`]),this.type==="radial"){if(m)for((g=g.concat()).reverse(),r=0,o=g.length;r<o;r++)g[r].offset=1-g[r].offset;var D=Math.min(f.r1,f.r2);if(D>0){var P=D/Math.max(f.r1,f.r2);for(r=0,o=g.length;r<o;r++)g[r].offset+=P*(1-g[r].offset)}}for(r=0,o=g.length;r<o;r++){var j=g[r];c.push("<stop ",'offset="',100*j.offset+"%",'" style="stop-color:',j.color,j.opacity!==void 0?";stop-opacity: "+j.opacity:";",`"/>
`)}return c.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),c.join("")},toLive:function(l){var u,r,o,c=y.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?u=l.createLinearGradient(c.x1,c.y1,c.x2,c.y2):this.type==="radial"&&(u=l.createRadialGradient(c.x1,c.y1,c.r1,c.x2,c.y2,c.r2)),r=0,o=this.colorStops.length;r<o;r++){var _=this.colorStops[r].color,f=this.colorStops[r].opacity,g=this.colorStops[r].offset;f!==void 0&&(_=new y.Color(_).setAlpha(f).toRgba()),u.addColorStop(g,_)}return u}}}),y.util.object.extend(y.Gradient,{fromElement:function(l,u,r,o){var c=parseFloat(r)/(/%$/.test(r)?100:1);c=c<0?0:c>1?1:c,isNaN(c)&&(c=1);var _,f,g,m,S=l.getElementsByTagName("stop"),w=l.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",I=l.getAttribute("gradientTransform")||"",T=[],A=0,D=0;for(l.nodeName==="linearGradient"||l.nodeName==="LINEARGRADIENT"?(_="linear",f=function(P){return{x1:P.getAttribute("x1")||0,y1:P.getAttribute("y1")||0,x2:P.getAttribute("x2")||"100%",y2:P.getAttribute("y2")||0}}(l)):(_="radial",f=function(P){return{x1:P.getAttribute("fx")||P.getAttribute("cx")||"50%",y1:P.getAttribute("fy")||P.getAttribute("cy")||"50%",r1:0,x2:P.getAttribute("cx")||"50%",y2:P.getAttribute("cy")||"50%",r2:P.getAttribute("r")||"50%"}}(l)),g=S.length;g--;)T.push(a(S[g],c));return m=y.parseTransformAttribute(I),function(P,j,Z,X){var W,M;Object.keys(j).forEach(function(R){(W=j[R])==="Infinity"?M=1:W==="-Infinity"?M=0:(M=parseFloat(j[R],10),typeof W=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(W)&&(M*=.01,X==="pixels"&&(R!=="x1"&&R!=="x2"&&R!=="r2"||(M*=Z.viewBoxWidth||Z.width),R!=="y1"&&R!=="y2"||(M*=Z.viewBoxHeight||Z.height)))),j[R]=M})}(0,f,o,w),w==="pixels"&&(A=-u.left,D=-u.top),new y.Gradient({id:l.getAttribute("id"),type:_,coords:f,colorStops:T,gradientUnits:w,gradientTransform:m,offsetX:A,offsetY:D})}})}(),ee=y.util.toFixed,y.Pattern=y.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(a,s){if(a||(a={}),this.id=y.Object.__uid++,this.setOptions(a),!a.source||a.source&&typeof a.source!="string")s&&s(this);else{var l=this;this.source=y.util.createImage(),y.util.loadImage(a.source,function(u,r){l.source=u,s&&s(l,r)},null,this.crossOrigin)}},toObject:function(a){var s,l,u=y.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?s=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(s=this.source.toDataURL()),l={type:"pattern",source:s,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:ee(this.offsetX,u),offsetY:ee(this.offsetY,u),patternTransform:this.patternTransform?this.patternTransform.concat():null},y.util.populateWithProperties(this,l,a),l},toSVG:function(a){var s=typeof this.source=="function"?this.source():this.source,l=s.width/a.width,u=s.height/a.height,r=this.offsetX/a.width,o=this.offsetY/a.height,c="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(u=1,o&&(u+=Math.abs(o))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(l=1,r&&(l+=Math.abs(r))),s.src?c=s.src:s.toDataURL&&(c=s.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+o+'" width="'+l+'" height="'+u+`">
<image x="0" y="0" width="`+s.width+'" height="'+s.height+'" xlink:href="'+c+`"></image>
</pattern>
`},setOptions:function(a){for(var s in a)this[s]=a[s]},toLive:function(a){var s=this.source;return!s||s.src!==void 0&&(!s.complete||s.naturalWidth===0||s.naturalHeight===0)?"":a.createPattern(s,this.repeat)}}),function(a){var s=a.fabric||(a.fabric={}),l=s.util.toFixed;s.Shadow?s.warn("fabric.Shadow is already defined."):(s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(u){for(var r in typeof u=="string"&&(u=this._parseShadow(u)),u)this[r]=u[r];this.id=s.Object.__uid++},_parseShadow:function(u){var r=u.trim(),o=s.Shadow.reOffsetsAndBlur.exec(r)||[];return{color:(r.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(o[1],10)||0,offsetY:parseFloat(o[2],10)||0,blur:parseFloat(o[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(u){var r=40,o=40,c=s.Object.NUM_FRACTION_DIGITS,_=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-u.angle)),f=new s.Color(this.color);return u.width&&u.height&&(r=100*l((Math.abs(_.x)+this.blur)/u.width,c)+20,o=100*l((Math.abs(_.y)+this.blur)/u.height,c)+20),u.flipX&&(_.x*=-1),u.flipY&&(_.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+o+'%" height="'+(100+2*o)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,c)+`"></feGaussianBlur>
	<feOffset dx="`+l(_.x,c)+'" dy="'+l(_.y,c)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+f.toRgb()+'" flood-opacity="'+f.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var u={},r=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(o){this[o]!==r[o]&&(u[o]=this[o])},this),u}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(y.StaticCanvas)y.warn("fabric.StaticCanvas is already defined.");else{var a=y.util.object.extend,s=y.util.getElementOffset,l=y.util.removeFromArray,u=y.util.toFixed,r=y.util.transformPoint,o=y.util.invertTransform,c=y.util.getNodeCanvas,_=y.util.createCanvasElement,f=new Error("Could not initialize `canvas` element");y.StaticCanvas=y.util.createClass(y.CommonMethods,{initialize:function(g,m){m||(m={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(g,m)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:y.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(g,m){var S=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(g),this._initOptions(m),this.interactive||this._initRetinaScaling(),m.overlayImage&&this.setOverlayImage(m.overlayImage,S),m.backgroundImage&&this.setBackgroundImage(m.backgroundImage,S),m.backgroundColor&&this.setBackgroundColor(m.backgroundColor,S),m.overlayColor&&this.setOverlayColor(m.overlayColor,S),this.calcOffset()},_isRetinaScaling:function(){return y.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,y.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var g=y.devicePixelRatio;this.__initRetinaScaling(g,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(g,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(g,m,S){m.setAttribute("width",this.width*g),m.setAttribute("height",this.height*g),S.scale(g,g)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(g,m,S){return this.__setBgOverlayImage("overlayImage",g,m,S)},setBackgroundImage:function(g,m,S){return this.__setBgOverlayImage("backgroundImage",g,m,S)},setOverlayColor:function(g,m){return this.__setBgOverlayColor("overlayColor",g,m)},setBackgroundColor:function(g,m){return this.__setBgOverlayColor("backgroundColor",g,m)},__setBgOverlayImage:function(g,m,S,w){return typeof m=="string"?y.util.loadImage(m,function(I,T){if(I){var A=new y.Image(I,w);this[g]=A,A.canvas=this}S&&S(I,T)},this,w&&w.crossOrigin):(w&&m.setOptions(w),this[g]=m,m&&(m.canvas=this),S&&S(m,!1)),this},__setBgOverlayColor:function(g,m,S){return this[g]=m,this._initGradient(m,g),this._initPattern(m,g,S),this},_createCanvasElement:function(){var g=_();if(!g||(g.style||(g.style={}),g.getContext===void 0))throw f;return g},_initOptions:function(g){var m=this.lowerCanvasEl;this._setOptions(g),this.width=this.width||parseInt(m.width,10)||0,this.height=this.height||parseInt(m.height,10)||0,this.lowerCanvasEl.style&&(m.width=this.width,m.height=this.height,m.style.width=this.width+"px",m.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(g){g&&g.getContext?this.lowerCanvasEl=g:this.lowerCanvasEl=y.util.getById(g)||this._createCanvasElement(),y.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(g,m){return this.setDimensions({width:g},m)},setHeight:function(g,m){return this.setDimensions({height:g},m)},setDimensions:function(g,m){var S;for(var w in m=m||{},g)S=g[w],m.cssOnly||(this._setBackstoreDimension(w,g[w]),S+="px",this.hasLostContext=!0),m.backstoreOnly||this._setCssDimension(w,S);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),m.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(g,m){return this.lowerCanvasEl[g]=m,this.upperCanvasEl&&(this.upperCanvasEl[g]=m),this.cacheCanvasEl&&(this.cacheCanvasEl[g]=m),this[g]=m,this},_setCssDimension:function(g,m){return this.lowerCanvasEl.style[g]=m,this.upperCanvasEl&&(this.upperCanvasEl.style[g]=m),this.wrapperEl&&(this.wrapperEl.style[g]=m),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(g){var m,S,w,I=this._activeObject,T=this.backgroundImage,A=this.overlayImage;for(this.viewportTransform=g,S=0,w=this._objects.length;S<w;S++)(m=this._objects[S]).group||m.setCoords(!0);return I&&I.setCoords(),T&&T.setCoords(!0),A&&A.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(g,m){var S=g,w=this.viewportTransform.slice(0);g=r(g,o(this.viewportTransform)),w[0]=m,w[3]=m;var I=r(g,w);return w[4]+=S.x-I.x,w[5]+=S.y-I.y,this.setViewportTransform(w)},setZoom:function(g){return this.zoomToPoint(new y.Point(0,0),g),this},absolutePan:function(g){var m=this.viewportTransform.slice(0);return m[4]=-g.x,m[5]=-g.y,this.setViewportTransform(m)},relativePan:function(g){return this.absolutePan(new y.Point(-g.x-this.viewportTransform[4],-g.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(g){this.stateful&&g.setupState(),g._set("canvas",this),g.setCoords(),this.fire("object:added",{target:g}),g.fire("added")},_onObjectRemoved:function(g){this.fire("object:removed",{target:g}),g.fire("removed"),delete g.canvas},clearContext:function(g){return g.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var g=this.contextContainer;return this.renderCanvas(g,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=y.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var g={},m=this.width,S=this.height,w=o(this.viewportTransform);return g.tl=r({x:0,y:0},w),g.br=r({x:m,y:S},w),g.tr=new y.Point(g.br.x,g.tl.y),g.bl=new y.Point(g.tl.x,g.br.y),this.vptCoords=g,g},cancelRequestedRender:function(){this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(g,m){var S=this.viewportTransform,w=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(g),y.util.setImageSmoothing(g,this.imageSmoothingEnabled),this.fire("before:render",{ctx:g}),this._renderBackground(g),g.save(),g.transform(S[0],S[1],S[2],S[3],S[4],S[5]),this._renderObjects(g,m),g.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),w&&(w.canvas=this,w.shouldCache(),w._transformDone=!0,w.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(g)),this._renderOverlay(g),this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),this.fire("after:render",{ctx:g})},drawClipPathOnCanvas:function(g){var m=this.viewportTransform,S=this.clipPath;g.save(),g.transform(m[0],m[1],m[2],m[3],m[4],m[5]),g.globalCompositeOperation="destination-in",S.transform(g),g.scale(1/S.zoomX,1/S.zoomY),g.drawImage(S._cacheCanvas,-S.cacheTranslationX,-S.cacheTranslationY),g.restore()},_renderObjects:function(g,m){var S,w;for(S=0,w=m.length;S<w;++S)m[S]&&m[S].render(g)},_renderBackgroundOrOverlay:function(g,m){var S=this[m+"Color"],w=this[m+"Image"],I=this.viewportTransform,T=this[m+"Vpt"];if(S||w){if(S){g.save(),g.beginPath(),g.moveTo(0,0),g.lineTo(this.width,0),g.lineTo(this.width,this.height),g.lineTo(0,this.height),g.closePath(),g.fillStyle=S.toLive?S.toLive(g,this):S,T&&g.transform(I[0],I[1],I[2],I[3],I[4],I[5]),g.transform(1,0,0,1,S.offsetX||0,S.offsetY||0);var A=S.gradientTransform||S.patternTransform;A&&g.transform(A[0],A[1],A[2],A[3],A[4],A[5]),g.fill(),g.restore()}w&&(g.save(),T&&g.transform(I[0],I[1],I[2],I[3],I[4],I[5]),w.render(g),g.restore())}},_renderBackground:function(g){this._renderBackgroundOrOverlay(g,"background")},_renderOverlay:function(g){this._renderBackgroundOrOverlay(g,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new y.Point(this.width/2,this.height/2)},centerObjectH:function(g){return this._centerObject(g,new y.Point(this.getCenterPoint().x,g.getCenterPoint().y))},centerObjectV:function(g){return this._centerObject(g,new y.Point(g.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(g){var m=this.getCenterPoint();return this._centerObject(g,m)},viewportCenterObject:function(g){var m=this.getVpCenter();return this._centerObject(g,m)},viewportCenterObjectH:function(g){var m=this.getVpCenter();return this._centerObject(g,new y.Point(m.x,g.getCenterPoint().y)),this},viewportCenterObjectV:function(g){var m=this.getVpCenter();return this._centerObject(g,new y.Point(g.getCenterPoint().x,m.y))},getVpCenter:function(){var g=this.getCenterPoint(),m=o(this.viewportTransform);return r(g,m)},_centerObject:function(g,m){return g.setPositionByOrigin(m,"center","center"),g.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(g){return this.toDatalessObject(g)},toObject:function(g){return this._toObjectMethod("toObject",g)},toDatalessObject:function(g){return this._toObjectMethod("toDatalessObject",g)},_toObjectMethod:function(g,m){var S=this.clipPath,w={version:y.version,objects:this._toObjects(g,m)};return S&&!S.excludeFromExport&&(w.clipPath=this._toObject(this.clipPath,g,m)),a(w,this.__serializeBgOverlay(g,m)),y.util.populateWithProperties(this,w,m),w},_toObjects:function(g,m){return this._objects.filter(function(S){return!S.excludeFromExport}).map(function(S){return this._toObject(S,g,m)},this)},_toObject:function(g,m,S){var w;this.includeDefaultValues||(w=g.includeDefaultValues,g.includeDefaultValues=!1);var I=g[m](S);return this.includeDefaultValues||(g.includeDefaultValues=w),I},__serializeBgOverlay:function(g,m){var S={},w=this.backgroundImage,I=this.overlayImage,T=this.backgroundColor,A=this.overlayColor;return T&&T.toObject?T.excludeFromExport||(S.background=T.toObject(m)):T&&(S.background=T),A&&A.toObject?A.excludeFromExport||(S.overlay=A.toObject(m)):A&&(S.overlay=A),w&&!w.excludeFromExport&&(S.backgroundImage=this._toObject(w,g,m)),I&&!I.excludeFromExport&&(S.overlayImage=this._toObject(I,g,m)),S},svgViewportTransformation:!0,toSVG:function(g,m){g||(g={}),g.reviver=m;var S=[];return this._setSVGPreamble(S,g),this._setSVGHeader(S,g),this.clipPath&&S.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(S,"background"),this._setSVGBgOverlayImage(S,"backgroundImage",m),this._setSVGObjects(S,m),this.clipPath&&S.push(`</g>
`),this._setSVGBgOverlayColor(S,"overlay"),this._setSVGBgOverlayImage(S,"overlayImage",m),S.push("</svg>"),S.join("")},_setSVGPreamble:function(g,m){m.suppressPreamble||g.push('<?xml version="1.0" encoding="',m.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(g,m){var S,w=m.width||this.width,I=m.height||this.height,T='viewBox="0 0 '+this.width+" "+this.height+'" ',A=y.Object.NUM_FRACTION_DIGITS;m.viewBox?T='viewBox="'+m.viewBox.x+" "+m.viewBox.y+" "+m.viewBox.width+" "+m.viewBox.height+'" ':this.svgViewportTransformation&&(S=this.viewportTransform,T='viewBox="'+u(-S[4]/S[0],A)+" "+u(-S[5]/S[3],A)+" "+u(this.width/S[0],A)+" "+u(this.height/S[3],A)+'" '),g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',w,'" ','height="',I,'" ',T,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",y.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(m),`</defs>
`)},createSVGClipPathMarkup:function(g){var m=this.clipPath;return m?(m.clipPathId="CLIPPATH_"+y.Object.__uid++,'<clipPath id="'+m.clipPathId+`" >
`+this.clipPath.toClipPathSVG(g.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var g=this;return["background","overlay"].map(function(m){var S=g[m+"Color"];if(S&&S.toLive){var w=g[m+"Vpt"],I=g.viewportTransform,T={width:g.width/(w?I[0]:1),height:g.height/(w?I[3]:1)};return S.toSVG(T,{additionalTransform:w?y.util.matrixToSVG(I):""})}}).join("")},createSVGFontFacesMarkup:function(){var g,m,S,w,I,T,A,D,P="",j={},Z=y.fontPaths,X=[];for(this._objects.forEach(function M(R){X.push(R),R._objects&&R._objects.forEach(M)}),A=0,D=X.length;A<D;A++)if(m=(g=X[A]).fontFamily,g.type.indexOf("text")!==-1&&!j[m]&&Z[m]&&(j[m]=!0,g.styles))for(I in S=g.styles)for(T in w=S[I])!j[m=w[T].fontFamily]&&Z[m]&&(j[m]=!0);for(var W in j)P+=[`		@font-face {
`,"			font-family: '",W,`';
`,"			src: url('",Z[W],`');
`,`		}
`].join("");return P&&(P=['	<style type="text/css">',`<![CDATA[
`,P,"]]>",`</style>
`].join("")),P},_setSVGObjects:function(g,m){var S,w,I,T=this._objects;for(w=0,I=T.length;w<I;w++)(S=T[w]).excludeFromExport||this._setSVGObject(g,S,m)},_setSVGObject:function(g,m,S){g.push(m.toSVG(S))},_setSVGBgOverlayImage:function(g,m,S){this[m]&&!this[m].excludeFromExport&&this[m].toSVG&&g.push(this[m].toSVG(S))},_setSVGBgOverlayColor:function(g,m){var S=this[m+"Color"],w=this.viewportTransform,I=this.width,T=this.height;if(S)if(S.toLive){var A=S.repeat,D=y.util.invertTransform(w),P=this[m+"Vpt"]?y.util.matrixToSVG(D):"";g.push('<rect transform="'+P+" translate(",I/2,",",T/2,')"',' x="',S.offsetX-I/2,'" y="',S.offsetY-T/2,'" ','width="',A==="repeat-y"||A==="no-repeat"?S.source.width:I,'" height="',A==="repeat-x"||A==="no-repeat"?S.source.height:T,'" fill="url(#SVGID_'+S.id+')"',`></rect>
`)}else g.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',S,'"',`></rect>
`)},sendToBack:function(g){if(!g)return this;var m,S,w,I=this._activeObject;if(g===I&&g.type==="activeSelection")for(m=(w=I._objects).length;m--;)S=w[m],l(this._objects,S),this._objects.unshift(S);else l(this._objects,g),this._objects.unshift(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(g){if(!g)return this;var m,S,w,I=this._activeObject;if(g===I&&g.type==="activeSelection")for(w=I._objects,m=0;m<w.length;m++)S=w[m],l(this._objects,S),this._objects.push(S);else l(this._objects,g),this._objects.push(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(g,m){if(!g)return this;var S,w,I,T,A,D=this._activeObject,P=0;if(g===D&&g.type==="activeSelection")for(A=D._objects,S=0;S<A.length;S++)w=A[S],(I=this._objects.indexOf(w))>0+P&&(T=I-1,l(this._objects,w),this._objects.splice(T,0,w)),P++;else(I=this._objects.indexOf(g))!==0&&(T=this._findNewLowerIndex(g,I,m),l(this._objects,g),this._objects.splice(T,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(g,m,S){var w,I;if(S){for(w=m,I=m-1;I>=0;--I)if(g.intersectsWithObject(this._objects[I])||g.isContainedWithinObject(this._objects[I])||this._objects[I].isContainedWithinObject(g)){w=I;break}}else w=m-1;return w},bringForward:function(g,m){if(!g)return this;var S,w,I,T,A,D=this._activeObject,P=0;if(g===D&&g.type==="activeSelection")for(S=(A=D._objects).length;S--;)w=A[S],(I=this._objects.indexOf(w))<this._objects.length-1-P&&(T=I+1,l(this._objects,w),this._objects.splice(T,0,w)),P++;else(I=this._objects.indexOf(g))!==this._objects.length-1&&(T=this._findNewUpperIndex(g,I,m),l(this._objects,g),this._objects.splice(T,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(g,m,S){var w,I,T;if(S){for(w=m,I=m+1,T=this._objects.length;I<T;++I)if(g.intersectsWithObject(this._objects[I])||g.isContainedWithinObject(this._objects[I])||this._objects[I].isContainedWithinObject(g)){w=I;break}}else w=m+1;return w},moveTo:function(g,m){return l(this._objects,g),this._objects.splice(m,0,g),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(y.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(g){g.dispose&&g.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),y.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),y.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),a(y.StaticCanvas.prototype,y.Observable),a(y.StaticCanvas.prototype,y.Collection),a(y.StaticCanvas.prototype,y.DataURLExporter),a(y.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(g){var m=_();if(!m||!m.getContext)return null;var S=m.getContext("2d");return S&&g==="setLineDash"?S.setLineDash!==void 0:null}}),y.StaticCanvas.prototype.toJSON=y.StaticCanvas.prototype.toObject,y.isLikelyNode&&(y.StaticCanvas.prototype.createPNGStream=function(){var g=c(this.lowerCanvasEl);return g&&g.createPNGStream()},y.StaticCanvas.prototype.createJPEGStream=function(g){var m=c(this.lowerCanvasEl);return m&&m.createJPEGStream(g)})}}(),y.BaseBrush=y.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(a){a.strokeStyle=this.color,a.lineWidth=this.width,a.lineCap=this.strokeLineCap,a.miterLimit=this.strokeMiterLimit,a.lineJoin=this.strokeLineJoin,a.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(a){var s=this.canvas.viewportTransform;a.save(),a.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var a=this.canvas,s=this.shadow,l=a.contextTop,u=a.getZoom();a&&a._isRetinaScaling()&&(u*=y.devicePixelRatio),l.shadowColor=s.color,l.shadowBlur=s.blur*u,l.shadowOffsetX=s.offsetX*u,l.shadowOffsetY=s.offsetY*u}},needsFullRender:function(){return new y.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var a=this.canvas.contextTop;a.shadowColor="",a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0},_isOutSideCanvas:function(a){return a.x<0||a.x>this.canvas.getWidth()||a.y<0||a.y>this.canvas.getHeight()}}),y.PencilBrush=y.util.createClass(y.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(a){this.canvas=a,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(a,s,l){var u=s.midPointFrom(l);return a.quadraticCurveTo(s.x,s.y,u.x,u.y),u},onMouseDown:function(a,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(a),this._captureDrawingPath(a),this._render())},onMouseMove:function(a,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(a))&&this._captureDrawingPath(a)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,u=l.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,l[u-2],l[u-1],!0),r.stroke(),r.restore()}},onMouseUp:function(a){return!this.canvas._isMainEvent(a.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(a){var s=new y.Point(a.x,a.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(a){return!(this._points.length>1&&a.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(a),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(a){var s=new y.Point(a.x,a.y);return this._addPoint(s)},_render:function(a){var s,l,u=this._points[0],r=this._points[1];if(a=a||this.canvas.contextTop,this._saveAndTransform(a),a.beginPath(),this._points.length===2&&u.x===r.x&&u.y===r.y){var o=this.width/1e3;u=new y.Point(u.x,u.y),r=new y.Point(r.x,r.y),u.x-=o,r.x+=o}for(a.moveTo(u.x,u.y),s=1,l=this._points.length;s<l;s++)this._drawSegment(a,u,r),u=this._points[s],r=this._points[s+1];a.lineTo(u.x,u.y),a.stroke(),a.restore()},convertPointsToSVGPath:function(a){var s=this.width/1e3;return y.util.getSmoothPathFromPoints(a,s)},_isEmptySVGPath:function(a){return y.util.joinPath(a)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(a){var s=new y.Path(a,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new y.Shadow(this.shadow)),s},decimatePoints:function(a,s){if(a.length<=2)return a;var l,u=this.canvas.getZoom(),r=Math.pow(s/u,2),o=a.length-1,c=a[0],_=[c];for(l=1;l<o-1;l++)Math.pow(c.x-a[l].x,2)+Math.pow(c.y-a[l].y,2)>=r&&(c=a[l],_.push(c));return _.push(a[o]),_},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var a=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(a))this.canvas.requestRenderAll();else{var s=this.createPath(a);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:s}),this.canvas.add(s),this.canvas.requestRenderAll(),s.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:s})}}}),y.CircleBrush=y.util.createClass(y.BaseBrush,{width:10,initialize:function(a){this.canvas=a,this.points=[]},drawDot:function(a){var s=this.addPoint(a),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,s),l.restore()},dot:function(a,s){a.fillStyle=s.fill,a.beginPath(),a.arc(s.x,s.y,s.radius,0,2*Math.PI,!1),a.closePath(),a.fill()},onMouseDown:function(a){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(a)},_render:function(){var a,s,l=this.canvas.contextTop,u=this.points;for(this._saveAndTransform(l),a=0,s=u.length;a<s;a++)this.dot(l,u[a]);l.restore()},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(a),this._render()):this.drawDot(a))},onMouseUp:function(){var a,s,l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var u=[];for(a=0,s=this.points.length;a<s;a++){var r=this.points[a],o=new y.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(o.shadow=new y.Shadow(this.shadow)),u.push(o)}var c=new y.Group(u);c.canvas=this.canvas,this.canvas.fire("before:path:created",{path:c}),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=l,this.canvas.requestRenderAll()},addPoint:function(a){var s=new y.Point(a.x,a.y),l=y.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,u=new y.Color(this.color).setAlpha(y.util.getRandomInt(0,100)/100).toRgba();return s.radius=l,s.fill=u,this.points.push(s),s}}),y.SprayBrush=y.util.createClass(y.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(a){this.canvas=a,this.sprayChunks=[]},onMouseDown:function(a){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(a),this.render(this.sprayChunkPoints)},onMouseMove:function(a){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(a)||(this.addSprayChunk(a),this.render(this.sprayChunkPoints))},onMouseUp:function(){var a=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],l=0,u=this.sprayChunks.length;l<u;l++)for(var r=this.sprayChunks[l],o=0,c=r.length;o<c;o++){var _=new y.Rect({width:r[o].width,height:r[o].width,left:r[o].x+1,top:r[o].y+1,originX:"center",originY:"center",fill:this.color});s.push(_)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var f=new y.Group(s);this.shadow&&f.set("shadow",new y.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:f}),this.canvas.add(f),this.canvas.fire("path:created",{path:f}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=a,this.canvas.requestRenderAll()},_getOptimizedRects:function(a){var s,l,u,r={};for(l=0,u=a.length;l<u;l++)r[s=a[l].left+""+a[l].top]||(r[s]=a[l]);var o=[];for(s in r)o.push(r[s]);return o},render:function(a){var s,l,u=this.canvas.contextTop;for(u.fillStyle=this.color,this._saveAndTransform(u),s=0,l=a.length;s<l;s++){var r=a[s];r.opacity!==void 0&&(u.globalAlpha=r.opacity),u.fillRect(r.x,r.y,r.width,r.width)}u.restore()},_render:function(){var a,s,l=this.canvas.contextTop;for(l.fillStyle=this.color,this._saveAndTransform(l),a=0,s=this.sprayChunks.length;a<s;a++)this.render(this.sprayChunks[a]);l.restore()},addSprayChunk:function(a){this.sprayChunkPoints=[];var s,l,u,r,o=this.width/2;for(r=0;r<this.density;r++){s=y.util.getRandomInt(a.x-o,a.x+o),l=y.util.getRandomInt(a.y-o,a.y+o),u=this.dotWidthVariance?y.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var c=new y.Point(s,l);c.width=u,this.randomOpacity&&(c.opacity=y.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(c)}this.sprayChunks.push(this.sprayChunkPoints)}}),y.PatternBrush=y.util.createClass(y.PencilBrush,{getPatternSrc:function(){var a=y.util.createCanvasElement(),s=a.getContext("2d");return a.width=a.height=25,s.fillStyle=this.color,s.beginPath(),s.arc(10,10,10,0,2*Math.PI,!1),s.closePath(),s.fill(),a},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(a){return a.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(a){this.callSuper("_setBrushStyles",a),a.strokeStyle=this.getPattern(a)},createPath:function(a){var s=this.callSuper("createPath",a),l=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new y.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),s}}),function(){var a=y.util.getPointer,s=y.util.degreesToRadians,l=y.util.isTouchEvent;for(var u in y.Canvas=y.util.createClass(y.StaticCanvas,{initialize:function(r,o){o||(o={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,o),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=y.PencilBrush&&new y.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r,o,c,_=this.getActiveObjects();if(_.length>0&&!this.preserveObjectStacking){o=[],c=[];for(var f=0,g=this._objects.length;f<g;f++)r=this._objects[f],_.indexOf(r)===-1?o.push(r):c.push(r);_.length>1&&(this._activeObject._objects=c),o.push.apply(o,c)}else o=this._objects;return o},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,o){var c=r.calcTransformMatrix(),_=y.util.invertTransform(c),f=this.restorePointerVpt(o);return y.util.transformPoint(f,_)},isTargetTransparent:function(r,o,c){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var _=this._normalizePointer(r,{x:o,y:c}),f=Math.max(r.cacheTranslationX+_.x*r.zoomX,0),g=Math.max(r.cacheTranslationY+_.y*r.zoomY,0);return y.util.isTransparent(r._cacheContext,Math.round(f),Math.round(g),this.targetFindTolerance)}var m=this.contextCache,S=r.selectionBackgroundColor,w=this.viewportTransform;return r.selectionBackgroundColor="",this.clearContext(m),m.save(),m.transform(w[0],w[1],w[2],w[3],w[4],w[5]),r.render(m),m.restore(),r.selectionBackgroundColor=S,y.util.isTransparent(m,o,c,this.targetFindTolerance)},_isSelectionKeyPressed:function(r){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(o){return r[o]===!0}):r[this.selectionKey]},_shouldClearSelection:function(r,o){var c=this.getActiveObjects(),_=this._activeObject;return!o||o&&_&&c.length>1&&c.indexOf(o)===-1&&_!==o&&!this._isSelectionKeyPressed(r)||o&&!o.evented||o&&!o.selectable&&_&&_!==o},_shouldCenterTransform:function(r,o,c){var _;if(r)return o==="scale"||o==="scaleX"||o==="scaleY"||o==="resizing"?_=this.centeredScaling||r.centeredScaling:o==="rotate"&&(_=this.centeredRotation||r.centeredRotation),_?!c:c},_getOriginFromCorner:function(r,o){var c={x:r.originX,y:r.originY};return o==="ml"||o==="tl"||o==="bl"?c.x="right":o!=="mr"&&o!=="tr"&&o!=="br"||(c.x="left"),o==="tl"||o==="mt"||o==="tr"?c.y="bottom":o!=="bl"&&o!=="mb"&&o!=="br"||(c.y="top"),c},_getActionFromCorner:function(r,o,c,_){if(!o||!r)return"drag";var f=_.controls[o];return f.getActionName(c,f,_)},_setupCurrentTransform:function(r,o,c){if(o){var _=this.getPointer(r),f=o.__corner,g=o.controls[f],m=c&&f?g.getActionHandler(r,o,g):y.controlsUtils.dragHandler,S=this._getActionFromCorner(c,f,r,o),w=this._getOriginFromCorner(o,f),I=r[this.centeredKey],T={target:o,action:S,actionHandler:m,corner:f,scaleX:o.scaleX,scaleY:o.scaleY,skewX:o.skewX,skewY:o.skewY,offsetX:_.x-o.left,offsetY:_.y-o.top,originX:w.x,originY:w.y,ex:_.x,ey:_.y,lastX:_.x,lastY:_.y,theta:s(o.angle),width:o.width*o.scaleX,shiftKey:r.shiftKey,altKey:I,original:y.util.saveObjectTransform(o)};this._shouldCenterTransform(o,S,I)&&(T.originX="center",T.originY="center"),T.original.originX=w.x,T.original.originY=w.y,this._currentTransform=T,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var o=this._groupSelector,c=new y.Point(o.ex,o.ey),_=y.util.transformPoint(c,this.viewportTransform),f=new y.Point(o.ex+o.left,o.ey+o.top),g=y.util.transformPoint(f,this.viewportTransform),m=Math.min(_.x,g.x),S=Math.min(_.y,g.y),w=Math.max(_.x,g.x),I=Math.max(_.y,g.y),T=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(m,S,w-m,I-S)),this.selectionLineWidth&&this.selectionBorderColor&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,m+=T,S+=T,w-=T,I-=T,y.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(m,S,w-m,I-S))},findTarget:function(r,o){if(!this.skipTargetFind){var c,_,f=this.getPointer(r,!0),g=this._activeObject,m=this.getActiveObjects(),S=l(r),w=m.length>1&&!o||m.length===1;if(this.targets=[],w&&g._findTargetCorner(f,S)||m.length>1&&!o&&g===this._searchPossibleTargets([g],f))return g;if(m.length===1&&g===this._searchPossibleTargets([g],f)){if(!this.preserveObjectStacking)return g;c=g,_=this.targets,this.targets=[]}var I=this._searchPossibleTargets(this._objects,f);return r[this.altSelectionKey]&&I&&c&&I!==c&&(I=c,this.targets=_),I}},_checkTarget:function(r,o,c){if(o&&o.visible&&o.evented&&o.containsPoint(r)&&(!this.perPixelTargetFind&&!o.perPixelTargetFind||o.isEditing||!this.isTargetTransparent(o,c.x,c.y)))return!0},_searchPossibleTargets:function(r,o){for(var c,_,f=r.length;f--;){var g=r[f],m=g.group?this._normalizePointer(g.group,o):o;if(this._checkTarget(m,g,o)){(c=r[f]).subTargetCheck&&c instanceof y.Group&&(_=this._searchPossibleTargets(c._objects,o))&&this.targets.push(_);break}}return c},restorePointerVpt:function(r){return y.util.transformPoint(r,y.util.invertTransform(this.viewportTransform))},getPointer:function(r,o){if(this._absolutePointer&&!o)return this._absolutePointer;if(this._pointer&&o)return this._pointer;var c,_=a(r),f=this.upperCanvasEl,g=f.getBoundingClientRect(),m=g.width||0,S=g.height||0;m&&S||("top"in g&&"bottom"in g&&(S=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(m=Math.abs(g.right-g.left))),this.calcOffset(),_.x=_.x-this._offset.left,_.y=_.y-this._offset.top,o||(_=this.restorePointerVpt(_));var w=this.getRetinaScaling();return w!==1&&(_.x/=w,_.y/=w),c=m===0||S===0?{width:1,height:1}:{width:f.width/m,height:f.height/S},{x:_.x*c.width,y:_.y*c.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),o=this.lowerCanvasEl,c=this.upperCanvasEl;c?c.className="":(c=this._createCanvasElement(),this.upperCanvasEl=c),y.util.addClass(c,"upper-canvas "+r),this.wrapperEl.appendChild(c),this._copyCanvasStyle(o,c),this._applyCanvasStyle(c),this.contextTop=c.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=y.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),y.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),y.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var o=this.width||r.width,c=this.height||r.height;y.util.setStyle(r,{position:"absolute",width:o+"px",height:c+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=o,r.height=c,y.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,o){o.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,o){var c=!1,_=this.getActiveObjects(),f=[],g=[];r.forEach(function(m){_.indexOf(m)===-1&&(c=!0,m.fire("deselected",{e:o,target:m}),g.push(m))}),_.forEach(function(m){r.indexOf(m)===-1&&(c=!0,m.fire("selected",{e:o,target:m}),f.push(m))}),r.length>0&&_.length>0?c&&this.fire("selection:updated",{e:o,selected:f,deselected:g}):_.length>0?this.fire("selection:created",{e:o,selected:f}):r.length>0&&this.fire("selection:cleared",{e:o,deselected:g})},setActiveObject:function(r,o){var c=this.getActiveObjects();return this._setActiveObject(r,o),this._fireSelectionEvents(c,o),this},_setActiveObject:function(r,o){return this._activeObject!==r&&!!this._discardActiveObject(o,r)&&!r.onSelect({e:o})&&(this._activeObject=r,!0)},_discardActiveObject:function(r,o){var c=this._activeObject;if(c){if(c.onDeselect({e:r,object:o}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var o=this.getActiveObjects(),c=this.getActiveObject();return o.length&&this.fire("before:selection:cleared",{target:c,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(o,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach(function(o){y.util.cleanUpJsdomNode(this[o]),this[o]=void 0}.bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,y.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var o=this._activeObject;o&&o._renderControls(r)},_toObject:function(r,o,c){var _=this._realizeGroupTransformOnObject(r),f=this.callSuper("_toObject",r,o,c);return this._unwindGroupTransformOnObject(r,_),f},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var o={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(c){o[c]=r[c]}),y.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),o}return null},_unwindGroupTransformOnObject:function(r,o){o&&r.set(o)},_setSVGObject:function(r,o,c){var _=this._realizeGroupTransformOnObject(o);this.callSuper("_setSVGObject",r,o,c),this._unwindGroupTransformOnObject(o,_)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),y.StaticCanvas.prototype.setViewportTransform.call(this,r)}}),y.StaticCanvas)u!=="prototype"&&(y.Canvas[u]=y.StaticCanvas[u])}(),function(){var a=y.util.addListener,s=y.util.removeListener,l={passive:!1};function u(r,o){return r.button&&r.button===o-1}y.util.object.extend(y.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(a,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(r,o){var c=this.upperCanvasEl,_=this._getEventPrefix();r(y.window,"resize",this._onResize),r(c,_+"down",this._onMouseDown),r(c,_+"move",this._onMouseMove,l),r(c,_+"out",this._onMouseOut),r(c,_+"enter",this._onMouseEnter),r(c,"wheel",this._onMouseWheel),r(c,"contextmenu",this._onContextMenu),r(c,"dblclick",this._onDoubleClick),r(c,"dragover",this._onDragOver),r(c,"dragenter",this._onDragEnter),r(c,"dragleave",this._onDragLeave),r(c,"drop",this._onDrop),this.enablePointerEvents||r(c,"touchstart",this._onTouchStart,l),typeof eventjs<"u"&&o in eventjs&&(eventjs[o](c,"gesture",this._onGesture),eventjs[o](c,"drag",this._onDrag),eventjs[o](c,"orientation",this._onOrientationChange),eventjs[o](c,"shake",this._onShake),eventjs[o](c,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var r=this._getEventPrefix();s(y.document,r+"up",this._onMouseUp),s(y.document,"touchend",this._onTouchEnd,l),s(y.document,r+"move",this._onMouseMove,l),s(y.document,"touchmove",this._onMouseMove,l)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(r,o){this.__onTransformGesture&&this.__onTransformGesture(r,o)},_onDrag:function(r,o){this.__onDrag&&this.__onDrag(r,o)},_onMouseWheel:function(r){this.__onMouseWheel(r)},_onMouseOut:function(r){var o=this._hoveredTarget;this.fire("mouse:out",{target:o,e:r}),this._hoveredTarget=null,o&&o.fire("mouseout",{e:r});var c=this;this._hoveredTargets.forEach(function(_){c.fire("mouse:out",{target:o,e:r}),_&&o.fire("mouseout",{e:r})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(_){_.isEditing&&_.hiddenTextarea.focus()})},_onMouseEnter:function(r){this._currentTransform||this.findTarget(r)||(this.fire("mouse:over",{target:null,e:r}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(r,o){this.__onOrientationChange&&this.__onOrientationChange(r,o)},_onShake:function(r,o){this.__onShake&&this.__onShake(r,o)},_onLongPress:function(r,o){this.__onLongPress&&this.__onLongPress(r,o)},_onDragOver:function(r){r.preventDefault();var o=this._simpleEventHandler("dragover",r);this._fireEnterLeaveEvents(o,r)},_onDrop:function(r){return this._simpleEventHandler("drop:before",r),this._simpleEventHandler("drop",r)},_onContextMenu:function(r){return this.stopContextMenu&&(r.stopPropagation(),r.preventDefault()),!1},_onDoubleClick:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"dblclick"),this._resetTransformEventData(r)},getPointerId:function(r){var o=r.changedTouches;return o?o[0]&&o[0].identifier:this.enablePointerEvents?r.pointerId:-1},_isMainEvent:function(r){return r.isPrimary===!0||r.isPrimary!==!1&&(r.type==="touchend"&&r.touches.length===0||!r.changedTouches||r.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(r){r.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(r)),this.__onMouseDown(r),this._resetTransformEventData();var o=this.upperCanvasEl,c=this._getEventPrefix();a(y.document,"touchend",this._onTouchEnd,l),a(y.document,"touchmove",this._onMouseMove,l),s(o,c+"down",this._onMouseDown)},_onMouseDown:function(r){this.__onMouseDown(r),this._resetTransformEventData();var o=this.upperCanvasEl,c=this._getEventPrefix();s(o,c+"move",this._onMouseMove,l),a(y.document,c+"up",this._onMouseUp),a(y.document,c+"move",this._onMouseMove,l)},_onTouchEnd:function(r){if(!(r.touches.length>0)){this.__onMouseUp(r),this._resetTransformEventData(),this.mainTouchId=null;var o=this._getEventPrefix();s(y.document,"touchend",this._onTouchEnd,l),s(y.document,"touchmove",this._onMouseMove,l);var c=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){a(c.upperCanvasEl,o+"down",c._onMouseDown),c._willAddMouseDown=0},400)}},_onMouseUp:function(r){this.__onMouseUp(r),this._resetTransformEventData();var o=this.upperCanvasEl,c=this._getEventPrefix();this._isMainEvent(r)&&(s(y.document,c+"up",this._onMouseUp),s(y.document,c+"move",this._onMouseMove,l),a(o,c+"move",this._onMouseMove,l))},_onMouseMove:function(r){!this.allowTouchScrolling&&r.preventDefault&&r.preventDefault(),this.__onMouseMove(r)},_onResize:function(){this.calcOffset()},_shouldRender:function(r){var o=this._activeObject;return!!(!!o!=!!r||o&&r&&o!==r)||(o&&o.isEditing,!1)},__onMouseUp:function(r){var o,c=this._currentTransform,_=this._groupSelector,f=!1,g=!_||_.left===0&&_.top===0;if(this._cacheTransformEventData(r),o=this._target,this._handleEvent(r,"up:before"),u(r,3))this.fireRightClick&&this._handleEvent(r,"up",3,g);else{if(u(r,2))return this.fireMiddleClick&&this._handleEvent(r,"up",2,g),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(r);else if(this._isMainEvent(r)){if(c&&(this._finalizeCurrentTransform(r),f=c.actionPerformed),!g){var m=o===this._activeObject;this._maybeGroupObjects(r),f||(f=this._shouldRender(o)||!m&&o===this._activeObject)}var S,w;if(o){if(S=o._findTargetCorner(this.getPointer(r,!0),y.util.isTouchEvent(r)),o.selectable&&o!==this._activeObject&&o.activeOn==="up")this.setActiveObject(o,r),f=!0;else{var I=o.controls[S],T=I&&I.getMouseUpHandler(r,o,I);T&&T(r,c,(w=this.getPointer(r)).x,w.y)}o.isMoving=!1}if(c&&(c.target!==o||c.corner!==S)){var A=c.target&&c.target.controls[c.corner],D=A&&A.getMouseUpHandler(r,o,I);w=w||this.getPointer(r),D&&D(r,c,w.x,w.y)}this._setCursorFromEvent(r,o),this._handleEvent(r,"up",1,g),this._groupSelector=null,this._currentTransform=null,o&&(o.__corner=0),f?this.requestRenderAll():g||this.renderTop()}}},_simpleEventHandler:function(r,o){var c=this.findTarget(o),_=this.targets,f={e:o,target:c,subTargets:_};if(this.fire(r,f),c&&c.fire(r,f),!_)return c;for(var g=0;g<_.length;g++)_[g].fire(r,f);return c},_handleEvent:function(r,o,c,_){var f=this._target,g=this.targets||[],m={e:r,target:f,subTargets:g,button:c||1,isClick:_||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};o==="up"&&(m.currentTarget=this.findTarget(r),m.currentSubTargets=this.targets),this.fire("mouse:"+o,m),f&&f.fire("mouse"+o,m);for(var S=0;S<g.length;S++)g[S].fire("mouse"+o,m)},_finalizeCurrentTransform:function(r){var o=this._currentTransform,c=o.target,_={e:r,target:c,transform:o,action:o.action};c._scaling&&(c._scaling=!1),c.setCoords(),(o.actionPerformed||this.stateful&&c.hasStateChanged())&&this._fire("modified",_)},_onMouseDownInDrawingMode:function(r){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(r).requestRenderAll();var o=this.getPointer(r);this.freeDrawingBrush.onMouseDown(o,{e:r,pointer:o}),this._handleEvent(r,"down")},_onMouseMoveInDrawingMode:function(r){if(this._isCurrentlyDrawing){var o=this.getPointer(r);this.freeDrawingBrush.onMouseMove(o,{e:r,pointer:o})}this.setCursor(this.freeDrawingCursor),this._handleEvent(r,"move")},_onMouseUpInDrawingMode:function(r){var o=this.getPointer(r);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:r,pointer:o}),this._handleEvent(r,"up")},__onMouseDown:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"down:before");var o=this._target;if(u(r,3))this.fireRightClick&&this._handleEvent(r,"down",3);else if(u(r,2))this.fireMiddleClick&&this._handleEvent(r,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(r);else if(this._isMainEvent(r)&&!this._currentTransform){var c=this._pointer;this._previousPointer=c;var _=this._shouldRender(o),f=this._shouldGroup(r,o);if(this._shouldClearSelection(r,o)?this.discardActiveObject(r):f&&(this._handleGrouping(r,o),o=this._activeObject),!this.selection||o&&(o.selectable||o.isEditing||o===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),o){var g=o===this._activeObject;o.selectable&&o.activeOn==="down"&&this.setActiveObject(o,r);var m=o._findTargetCorner(this.getPointer(r,!0),y.util.isTouchEvent(r));if(o.__corner=m,o===this._activeObject&&(m||!f)){this._setupCurrentTransform(r,o,g);var S=o.controls[m],w=(c=this.getPointer(r),S&&S.getMouseDownHandler(r,o,S));w&&w(r,this._currentTransform,c.x,c.y)}}this._handleEvent(r,"down"),(_||f)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(r){this._resetTransformEventData(),this._pointer=this.getPointer(r,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(r)||null},_beforeTransform:function(r){var o=this._currentTransform;this.stateful&&o.target.saveState(),this.fire("before:transform",{e:r,transform:o})},__onMouseMove:function(r){var o,c;if(this._handleEvent(r,"move:before"),this._cacheTransformEventData(r),this.isDrawingMode)this._onMouseMoveInDrawingMode(r);else if(this._isMainEvent(r)){var _=this._groupSelector;_?(c=this._absolutePointer,_.left=c.x-_.ex,_.top=c.y-_.ey,this.renderTop()):this._currentTransform?this._transformObject(r):(o=this.findTarget(r)||null,this._setCursorFromEvent(r,o),this._fireOverOutEvents(o,r)),this._handleEvent(r,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(r,o){var c=this._hoveredTarget,_=this._hoveredTargets,f=this.targets,g=Math.max(_.length,f.length);this.fireSyntheticInOutEvents(r,o,{oldTarget:c,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var m=0;m<g;m++)this.fireSyntheticInOutEvents(f[m],o,{oldTarget:_[m],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(r,o){var c=this._draggedoverTarget,_=this._hoveredTargets,f=this.targets,g=Math.max(_.length,f.length);this.fireSyntheticInOutEvents(r,o,{oldTarget:c,evtOut:"dragleave",evtIn:"dragenter"});for(var m=0;m<g;m++)this.fireSyntheticInOutEvents(f[m],o,{oldTarget:_[m],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=r},fireSyntheticInOutEvents:function(r,o,c){var _,f,g,m=c.oldTarget,S=m!==r,w=c.canvasEvtIn,I=c.canvasEvtOut;S&&(_={e:o,target:r,previousTarget:m},f={e:o,target:m,nextTarget:r}),g=r&&S,m&&S&&(I&&this.fire(I,f),m.fire(c.evtOut,f)),g&&(w&&this.fire(w,_),r.fire(c.evtIn,_))},__onMouseWheel:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"wheel"),this._resetTransformEventData()},_transformObject:function(r){var o=this.getPointer(r),c=this._currentTransform;c.reset=!1,c.shiftKey=r.shiftKey,c.altKey=r[this.centeredKey],this._performTransformAction(r,c,o),c.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(r,o,c){var _=c.x,f=c.y,g=o.action,m=!1,S=o.actionHandler;S&&(m=S(r,o,_,f)),g==="drag"&&m&&(o.target.isMoving=!0,this.setCursor(o.target.moveCursor||this.moveCursor)),o.actionPerformed=o.actionPerformed||m},_fire:y.controlsUtils.fireEvent,_setCursorFromEvent:function(r,o){if(!o)return this.setCursor(this.defaultCursor),!1;var c=o.hoverCursor||this.hoverCursor,_=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,f=(!_||!_.contains(o))&&o._findTargetCorner(this.getPointer(r,!0));f?this.setCursor(this.getCornerCursor(f,o,r)):(o.subTargetCheck&&this.targets.concat().reverse().map(function(g){c=g.hoverCursor||c}),this.setCursor(c))},getCornerCursor:function(r,o,c){var _=o.controls[r];return _.cursorStyleHandler(c,_,o)}})}(),Y=Math.min,G=Math.max,y.util.object.extend(y.Canvas.prototype,{_shouldGroup:function(a,s){var l=this._activeObject;return l&&this._isSelectionKeyPressed(a)&&s&&s.selectable&&this.selection&&(l!==s||l.type==="activeSelection")&&!s.onSelect({e:a})},_handleGrouping:function(a,s){var l=this._activeObject;l.__corner||(s!==l||(s=this.findTarget(a,!0))&&s.selectable)&&(l&&l.type==="activeSelection"?this._updateActiveSelection(s,a):this._createActiveSelection(s,a))},_updateActiveSelection:function(a,s){var l=this._activeObject,u=l._objects.slice(0);l.contains(a)?(l.removeWithUpdate(a),this._hoveredTarget=a,this._hoveredTargets=this.targets.concat(),l.size()===1&&this._setActiveObject(l.item(0),s)):(l.addWithUpdate(a),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(u,s)},_createActiveSelection:function(a,s){var l=this.getActiveObjects(),u=this._createGroup(a);this._hoveredTarget=u,this._setActiveObject(u,s),this._fireSelectionEvents(l,s)},_createGroup:function(a){var s=this._objects,l=s.indexOf(this._activeObject)<s.indexOf(a)?[this._activeObject,a]:[a,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new y.ActiveSelection(l,{canvas:this})},_groupSelectedObjects:function(a){var s,l=this._collectObjects(a);l.length===1?this.setActiveObject(l[0],a):l.length>1&&(s=new y.ActiveSelection(l.reverse(),{canvas:this}),this.setActiveObject(s,a))},_collectObjects:function(a){for(var s,l=[],u=this._groupSelector.ex,r=this._groupSelector.ey,o=u+this._groupSelector.left,c=r+this._groupSelector.top,_=new y.Point(Y(u,o),Y(r,c)),f=new y.Point(G(u,o),G(r,c)),g=!this.selectionFullyContained,m=u===o&&r===c,S=this._objects.length;S--&&!((s=this._objects[S])&&s.selectable&&s.visible&&(g&&s.intersectsWithRect(_,f,!0)||s.isContainedWithinRect(_,f,!0)||g&&s.containsPoint(_,null,!0)||g&&s.containsPoint(f,null,!0))&&(l.push(s),m)););return l.length>1&&(l=l.filter(function(w){return!w.onSelect({e:a})})),l},_maybeGroupObjects:function(a){this.selection&&this._groupSelector&&this._groupSelectedObjects(a),this.setCursor(this.defaultCursor),this._groupSelector=null}}),y.util.object.extend(y.StaticCanvas.prototype,{toDataURL:function(a){a||(a={});var s=a.format||"png",l=a.quality||1,u=(a.multiplier||1)*(a.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(u,a);return y.util.toDataURL(r,s,l)},toCanvasElement:function(a,s){a=a||1;var l=((s=s||{}).width||this.width)*a,u=(s.height||this.height)*a,r=this.getZoom(),o=this.width,c=this.height,_=r*a,f=this.viewportTransform,g=(f[4]-(s.left||0))*a,m=(f[5]-(s.top||0))*a,S=this.interactive,w=[_,0,0,_,g,m],I=this.enableRetinaScaling,T=y.util.createCanvasElement(),A=this.contextTop;return T.width=l,T.height=u,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=w,this.width=l,this.height=u,this.calcViewportBoundaries(),this.renderCanvas(T.getContext("2d"),this._objects),this.viewportTransform=f,this.width=o,this.height=c,this.calcViewportBoundaries(),this.interactive=S,this.enableRetinaScaling=I,this.contextTop=A,T}}),y.util.object.extend(y.StaticCanvas.prototype,{loadFromJSON:function(a,s,l){if(a){var u=typeof a=="string"?JSON.parse(a):y.util.object.clone(a),r=this,o=u.clipPath,c=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete u.clipPath,this._enlivenObjects(u.objects,function(_){r.clear(),r._setBgOverlay(u,function(){o?r._enlivenObjects([o],function(f){r.clipPath=f[0],r.__setupCanvas.call(r,u,_,c,s)}):r.__setupCanvas.call(r,u,_,c,s)})},l),this}},__setupCanvas:function(a,s,l,u){var r=this;s.forEach(function(o,c){r.insertAt(o,c)}),this.renderOnAddRemove=l,delete a.objects,delete a.backgroundImage,delete a.overlayImage,delete a.background,delete a.overlay,this._setOptions(a),this.renderAll(),u&&u()},_setBgOverlay:function(a,s){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(a.backgroundImage||a.overlayImage||a.background||a.overlay){var u=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",a.backgroundImage,l,u),this.__setBgOverlay("overlayImage",a.overlayImage,l,u),this.__setBgOverlay("backgroundColor",a.background,l,u),this.__setBgOverlay("overlayColor",a.overlay,l,u)}else s&&s()},__setBgOverlay:function(a,s,l,u){var r=this;if(!s)return l[a]=!0,void(u&&u());a==="backgroundImage"||a==="overlayImage"?y.util.enlivenObjects([s],function(o){r[a]=o[0],l[a]=!0,u&&u()}):this["set"+y.util.string.capitalize(a,!0)](s,function(){l[a]=!0,u&&u()})},_enlivenObjects:function(a,s,l){a&&a.length!==0?y.util.enlivenObjects(a,function(u){s&&s(u)},null,l):s&&s([])},_toDataURL:function(a,s){this.clone(function(l){s(l.toDataURL(a))})},_toDataURLWithMultiplier:function(a,s,l){this.clone(function(u){l(u.toDataURLWithMultiplier(a,s))})},clone:function(a,s){var l=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(u){u.loadFromJSON(l,function(){a&&a(u)})})},cloneWithoutData:function(a){var s=y.util.createCanvasElement();s.width=this.width,s.height=this.height;var l=new y.Canvas(s);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),a&&a(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):a&&a(l)}}),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.util.object.clone,r=s.util.toFixed,o=s.util.string.capitalize,c=s.util.degreesToRadians,_=!s.isLikelyNode;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:_,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(f){f&&this.setOptions(f)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(f){var g=s.perfLimitSizeTotal,m=f.width,S=f.height,w=s.maxCacheSideLimit,I=s.minCacheSideLimit;if(m<=w&&S<=w&&m*S<=g)return m<I&&(f.width=I),S<I&&(f.height=I),f;var T=m/S,A=s.util.limitDimsByArea(T,g),D=s.util.capValue,P=D(I,A.x,w),j=D(I,A.y,w);return m>P&&(f.zoomX/=m/P,f.width=P,f.capped=!0),S>j&&(f.zoomY/=S/j,f.height=j,f.capped=!0),f},_getCacheCanvasDimensions:function(){var f=this.getTotalObjectScaling(),g=this._getTransformedDimensions(0,0),m=g.x*f.scaleX/this.scaleX,S=g.y*f.scaleY/this.scaleY;return{width:m+2,height:S+2,zoomX:f.scaleX,zoomY:f.scaleY,x:m,y:S}},_updateCacheCanvas:function(){var f=this.canvas;if(this.noScaleCache&&f&&f._currentTransform){var g=f._currentTransform.target,m=f._currentTransform.action;if(this===g&&m.slice&&m.slice(0,5)==="scale")return!1}var S,w,I=this._cacheCanvas,T=this._limitCacheSize(this._getCacheCanvasDimensions()),A=s.minCacheSideLimit,D=T.width,P=T.height,j=T.zoomX,Z=T.zoomY,X=D!==this.cacheWidth||P!==this.cacheHeight,W=this.zoomX!==j||this.zoomY!==Z,M=X||W,R=0,V=0,q=!1;if(X){var K=this._cacheCanvas.width,B=this._cacheCanvas.height,F=D>K||P>B;q=F||(D<.9*K||P<.9*B)&&K>A&&B>A,F&&!T.capped&&(D>A||P>A)&&(R=.1*D,V=.1*P)}return this instanceof s.Text&&this.path&&(M=!0,q=!0,R+=this.getHeightOfLine(0)*this.zoomX,V+=this.getHeightOfLine(0)*this.zoomY),!!M&&(q?(I.width=Math.ceil(D+R),I.height=Math.ceil(P+V)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,I.width,I.height)),S=T.x/2,w=T.y/2,this.cacheTranslationX=Math.round(I.width/2-S)+S,this.cacheTranslationY=Math.round(I.height/2-w)+w,this.cacheWidth=D,this.cacheHeight=P,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(j,Z),this.zoomX=j,this.zoomY=Z,!0)},setOptions:function(f){this._setOptions(f),this._initGradient(f.fill,"fill"),this._initGradient(f.stroke,"stroke"),this._initPattern(f.fill,"fill"),this._initPattern(f.stroke,"stroke")},transform:function(f){var g=this.group&&!this.group._transformDone||this.group&&this.canvas&&f===this.canvas.contextTop,m=this.calcTransformMatrix(!g);f.transform(m[0],m[1],m[2],m[3],m[4],m[5])},toObject:function(f){var g=s.Object.NUM_FRACTION_DIGITS,m={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:r(this.left,g),top:r(this.top,g),width:r(this.width,g),height:r(this.height,g),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,g),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,g),scaleX:r(this.scaleX,g),scaleY:r(this.scaleY,g),angle:r(this.angle,g),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,g),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,g),skewY:r(this.skewY,g)};return this.clipPath&&!this.clipPath.excludeFromExport&&(m.clipPath=this.clipPath.toObject(f),m.clipPath.inverted=this.clipPath.inverted,m.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,m,f),this.includeDefaultValues||(m=this._removeDefaultValues(m)),m},toDatalessObject:function(f){return this.toObject(f)},_removeDefaultValues:function(f){var g=s.util.getKlass(f.type).prototype;return g.stateProperties.forEach(function(m){m!=="left"&&m!=="top"&&(f[m]===g[m]&&delete f[m],Array.isArray(f[m])&&Array.isArray(g[m])&&f[m].length===0&&g[m].length===0&&delete f[m])}),f},toString:function(){return"#<fabric."+o(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var f=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(f.scaleX),scaleY:Math.abs(f.scaleY)}},getTotalObjectScaling:function(){var f=this.getObjectScaling(),g=f.scaleX,m=f.scaleY;if(this.canvas){var S=this.canvas.getZoom(),w=this.canvas.getRetinaScaling();g*=S*w,m*=S*w}return{scaleX:g,scaleY:m}},getObjectOpacity:function(){var f=this.opacity;return this.group&&(f*=this.group.getObjectOpacity()),f},_set:function(f,g){var m=f==="scaleX"||f==="scaleY",S=this[f]!==g,w=!1;return m&&(g=this._constrainScale(g)),f==="scaleX"&&g<0?(this.flipX=!this.flipX,g*=-1):f==="scaleY"&&g<0?(this.flipY=!this.flipY,g*=-1):f!=="shadow"||!g||g instanceof s.Shadow?f==="dirty"&&this.group&&this.group.set("dirty",g):g=new s.Shadow(g),this[f]=g,S&&(w=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(f)>-1?(this.dirty=!0,w&&this.group.set("dirty",!0)):w&&this.stateProperties.indexOf(f)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(f){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(f.save(),this._setupCompositeOperation(f),this.drawSelectionBackground(f),this.transform(f),this._setOpacity(f),this._setShadow(f,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(f)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(f),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),f.restore())},renderCache:function(f){f=f||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,f.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(f,g){if(f.save(),g.inverted?f.globalCompositeOperation="destination-out":f.globalCompositeOperation="destination-in",g.absolutePositioned){var m=s.util.invertTransform(this.calcTransformMatrix());f.transform(m[0],m[1],m[2],m[3],m[4],m[5])}g.transform(f),f.scale(1/g.zoomX,1/g.zoomY),f.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),f.restore()},drawObject:function(f,g){var m=this.fill,S=this.stroke;g?(this.fill="black",this.stroke="",this._setClippingProperties(f)):this._renderBackground(f),this._render(f),this._drawClipPath(f,this.clipPath),this.fill=m,this.stroke=S},_drawClipPath:function(f,g){g&&(g.canvas=this.canvas,g.shouldCache(),g._transformDone=!0,g.renderCache({forClipping:!0}),this.drawClipPathOnCache(f,g))},drawCacheOnCanvas:function(f){f.scale(1/this.zoomX,1/this.zoomY),f.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(f){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!f&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!f){var g=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-m/2,g,m)}return!0}return!1},_renderBackground:function(f){if(this.backgroundColor){var g=this._getNonTransformedDimensions();f.fillStyle=this.backgroundColor,f.fillRect(-g.x/2,-g.y/2,g.x,g.y),this._removeShadow(f)}},_setOpacity:function(f){this.group&&!this.group._transformDone?f.globalAlpha=this.getObjectOpacity():f.globalAlpha*=this.opacity},_setStrokeStyles:function(f,g){var m=g.stroke;m&&(f.lineWidth=g.strokeWidth,f.lineCap=g.strokeLineCap,f.lineDashOffset=g.strokeDashOffset,f.lineJoin=g.strokeLineJoin,f.miterLimit=g.strokeMiterLimit,m.toLive?m.gradientUnits==="percentage"||m.gradientTransform||m.patternTransform?this._applyPatternForTransformedGradient(f,m):(f.strokeStyle=m.toLive(f,this),this._applyPatternGradientTransform(f,m)):f.strokeStyle=g.stroke)},_setFillStyles:function(f,g){var m=g.fill;m&&(m.toLive?(f.fillStyle=m.toLive(f,this),this._applyPatternGradientTransform(f,g.fill)):f.fillStyle=m)},_setClippingProperties:function(f){f.globalAlpha=1,f.strokeStyle="transparent",f.fillStyle="#000000"},_setLineDash:function(f,g){g&&g.length!==0&&(1&g.length&&g.push.apply(g,g),f.setLineDash(g))},_renderControls:function(f,g){var m,S,w,I=this.getViewportTransform(),T=this.calcTransformMatrix();S=(g=g||{}).hasBorders!==void 0?g.hasBorders:this.hasBorders,w=g.hasControls!==void 0?g.hasControls:this.hasControls,T=s.util.multiplyTransformMatrices(I,T),m=s.util.qrDecompose(T),f.save(),f.translate(m.translateX,m.translateY),f.lineWidth=1*this.borderScaleFactor,this.group||(f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(m.angle-=180),f.rotate(c(this.group?m.angle:this.angle)),g.forActiveSelection||this.group?S&&this.drawBordersInGroup(f,m,g):S&&this.drawBorders(f,g),w&&this.drawControls(f,g),f.restore()},_setShadow:function(f){if(this.shadow){var g,m=this.shadow,S=this.canvas,w=S&&S.viewportTransform[0]||1,I=S&&S.viewportTransform[3]||1;g=m.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),S&&S._isRetinaScaling()&&(w*=s.devicePixelRatio,I*=s.devicePixelRatio),f.shadowColor=m.color,f.shadowBlur=m.blur*s.browserShadowBlurConstant*(w+I)*(g.scaleX+g.scaleY)/4,f.shadowOffsetX=m.offsetX*w*g.scaleX,f.shadowOffsetY=m.offsetY*I*g.scaleY}},_removeShadow:function(f){this.shadow&&(f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0)},_applyPatternGradientTransform:function(f,g){if(!g||!g.toLive)return{offsetX:0,offsetY:0};var m=g.gradientTransform||g.patternTransform,S=-this.width/2+g.offsetX||0,w=-this.height/2+g.offsetY||0;return g.gradientUnits==="percentage"?f.transform(this.width,0,0,this.height,S,w):f.transform(1,0,0,1,S,w),m&&f.transform(m[0],m[1],m[2],m[3],m[4],m[5]),{offsetX:S,offsetY:w}},_renderPaintInOrder:function(f){this.paintFirst==="stroke"?(this._renderStroke(f),this._renderFill(f)):(this._renderFill(f),this._renderStroke(f))},_render:function(){},_renderFill:function(f){this.fill&&(f.save(),this._setFillStyles(f,this),this.fillRule==="evenodd"?f.fill("evenodd"):f.fill(),f.restore())},_renderStroke:function(f){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this.strokeUniform&&this.group){var g=this.getObjectScaling();f.scale(1/g.scaleX,1/g.scaleY)}else this.strokeUniform&&f.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(f,this.strokeDashArray),this._setStrokeStyles(f,this),f.stroke(),f.restore()}},_applyPatternForTransformedGradient:function(f,g){var m,S=this._limitCacheSize(this._getCacheCanvasDimensions()),w=s.util.createCanvasElement(),I=this.canvas.getRetinaScaling(),T=S.x/this.scaleX/I,A=S.y/this.scaleY/I;w.width=T,w.height=A,(m=w.getContext("2d")).beginPath(),m.moveTo(0,0),m.lineTo(T,0),m.lineTo(T,A),m.lineTo(0,A),m.closePath(),m.translate(T/2,A/2),m.scale(S.zoomX/this.scaleX/I,S.zoomY/this.scaleY/I),this._applyPatternGradientTransform(m,g),m.fillStyle=g.toLive(f),m.fill(),f.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),f.scale(I*this.scaleX/S.zoomX,I*this.scaleY/S.zoomY),f.strokeStyle=m.createPattern(w,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var f=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",f.scaleX),this.set("scaleY",f.scaleY),this.angle=f.angle,this.skewX=f.skewX,this.skewY=0}},_removeTransformMatrix:function(f){var g=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),g=s.util.transformPoint(g,this.transformMatrix)),this.transformMatrix=null,f&&(this.scaleX*=f.scaleX,this.scaleY*=f.scaleY,this.cropX=f.cropX,this.cropY=f.cropY,g.x+=f.offsetLeft,g.y+=f.offsetTop,this.width=f.width,this.height=f.height),this.setPositionByOrigin(g,"center","center")},clone:function(f,g){var m=this.toObject(g);this.constructor.fromObject?this.constructor.fromObject(m,f):s.Object._fromObject("Object",m,f)},cloneAsImage:function(f,g){var m=this.toCanvasElement(g);return f&&f(new s.Image(m)),this},toCanvasElement:function(f){f||(f={});var g=s.util,m=g.saveObjectTransform(this),S=this.group,w=this.shadow,I=Math.abs,T=(f.multiplier||1)*(f.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,f.withoutTransform&&g.resetObjectTransform(this),f.withoutShadow&&(this.shadow=null);var A,D,P,j,Z=s.util.createCanvasElement(),X=this.getBoundingRect(!0,!0),W=this.shadow,M={x:0,y:0};W&&(D=W.blur,A=W.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),M.x=2*Math.round(I(W.offsetX)+D)*I(A.scaleX),M.y=2*Math.round(I(W.offsetY)+D)*I(A.scaleY)),P=X.width+M.x,j=X.height+M.y,Z.width=Math.ceil(P),Z.height=Math.ceil(j);var R=new s.StaticCanvas(Z,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});f.format==="jpeg"&&(R.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(R.width/2,R.height/2),"center","center");var V=this.canvas;R.add(this);var q=R.toCanvasElement(T||1,f);return this.shadow=w,this.set("canvas",V),S&&(this.group=S),this.set(m).setCoords(),R._objects=[],R.dispose(),R=null,q},toDataURL:function(f){return f||(f={}),s.util.toDataURL(this.toCanvasElement(f),f.format||"png",f.quality||1)},isType:function(f){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===f},complexity:function(){return 1},toJSON:function(f){return this.toObject(f)},rotate:function(f){var g=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return g&&this._setOriginToCenter(),this.set("angle",f),g&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(f,g){g=g||this.canvas.getPointer(f);var m=new s.Point(g.x,g.y),S=this._getLeftTopCoords();return this.angle&&(m=s.util.rotatePoint(m,S,c(-this.angle))),{x:m.x-S.x,y:m.y-S.y}},_setupCompositeOperation:function(f){this.globalCompositeOperation&&(f.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),l(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(f,g,m,S){var w=s[f];g=u(g,!0),s.util.enlivenPatterns([g.fill,g.stroke],function(I){I[0]!==void 0&&(g.fill=I[0]),I[1]!==void 0&&(g.stroke=I[1]),s.util.enlivenObjectEnlivables(g,g,function(){var T=S?new w(g[S],g):new w(g);m&&m(T)})})},s.Object.__uid=0)}(e),re=y.util.degreesToRadians,de={left:-.5,center:0,right:.5},fe={top:-.5,center:0,bottom:.5},y.util.object.extend(y.Object.prototype,{translateToGivenOrigin:function(a,s,l,u,r){var o,c,_,f=a.x,g=a.y;return typeof s=="string"?s=de[s]:s-=.5,typeof u=="string"?u=de[u]:u-=.5,typeof l=="string"?l=fe[l]:l-=.5,typeof r=="string"?r=fe[r]:r-=.5,c=r-l,((o=u-s)||c)&&(_=this._getTransformedDimensions(),f=a.x+o*_.x,g=a.y+c*_.y),new y.Point(f,g)},translateToCenterPoint:function(a,s,l){var u=this.translateToGivenOrigin(a,s,l,"center","center");return this.angle?y.util.rotatePoint(u,a,re(this.angle)):u},translateToOriginPoint:function(a,s,l){var u=this.translateToGivenOrigin(a,"center","center",s,l);return this.angle?y.util.rotatePoint(u,a,re(this.angle)):u},getCenterPoint:function(){var a=new y.Point(this.left,this.top);return this.translateToCenterPoint(a,this.originX,this.originY)},getPointByOrigin:function(a,s){var l=this.getCenterPoint();return this.translateToOriginPoint(l,a,s)},toLocalPoint:function(a,s,l){var u,r,o=this.getCenterPoint();return u=s!==void 0&&l!==void 0?this.translateToGivenOrigin(o,"center","center",s,l):new y.Point(this.left,this.top),r=new y.Point(a.x,a.y),this.angle&&(r=y.util.rotatePoint(r,o,-re(this.angle))),r.subtractEquals(u)},setPositionByOrigin:function(a,s,l){var u=this.translateToCenterPoint(a,s,l),r=this.translateToOriginPoint(u,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(a){var s,l,u=re(this.angle),r=this.getScaledWidth(),o=y.util.cos(u)*r,c=y.util.sin(u)*r;s=typeof this.originX=="string"?de[this.originX]:this.originX-.5,l=typeof a=="string"?de[a]:a-.5,this.left+=o*(l-s),this.top+=c*(l-s),this.setCoords(),this.originX=a},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var a=this.getCenterPoint();this.originX="center",this.originY="center",this.left=a.x,this.top=a.y},_resetOrigin:function(){var a=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=a.x,this.top=a.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var a=y.util,s=a.degreesToRadians,l=a.multiplyTransformMatrices,u=a.transformPoint;a.object.extend(y.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(r,o){return o?r?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),r?this.aCoords:this.lineCoords)},getCoords:function(r,o){return c=this._getCoords(r,o),[new y.Point(c.tl.x,c.tl.y),new y.Point(c.tr.x,c.tr.y),new y.Point(c.br.x,c.br.y),new y.Point(c.bl.x,c.bl.y)];var c},intersectsWithRect:function(r,o,c,_){var f=this.getCoords(c,_);return y.Intersection.intersectPolygonRectangle(f,r,o).status==="Intersection"},intersectsWithObject:function(r,o,c){return y.Intersection.intersectPolygonPolygon(this.getCoords(o,c),r.getCoords(o,c)).status==="Intersection"||r.isContainedWithinObject(this,o,c)||this.isContainedWithinObject(r,o,c)},isContainedWithinObject:function(r,o,c){for(var _=this.getCoords(o,c),f=o?r.aCoords:r.lineCoords,g=0,m=r._getImageLines(f);g<4;g++)if(!r.containsPoint(_[g],m))return!1;return!0},isContainedWithinRect:function(r,o,c,_){var f=this.getBoundingRect(c,_);return f.left>=r.x&&f.left+f.width<=o.x&&f.top>=r.y&&f.top+f.height<=o.y},containsPoint:function(r,o,c,_){var f=this._getCoords(c,_),g=(o=o||this._getImageLines(f),this._findCrossPoints(r,o));return g!==0&&g%2==1},isOnScreen:function(r){if(!this.canvas)return!1;var o=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br;return!!this.getCoords(!0,r).some(function(_){return _.x<=c.x&&_.x>=o.x&&_.y<=c.y&&_.y>=o.y})||!!this.intersectsWithRect(o,c,!0,r)||this._containsCenterOfCanvas(o,c,r)},_containsCenterOfCanvas:function(r,o,c){var _={x:(r.x+o.x)/2,y:(r.y+o.y)/2};return!!this.containsPoint(_,null,!0,c)},isPartiallyOnScreen:function(r){if(!this.canvas)return!1;var o=this.canvas.vptCoords.tl,c=this.canvas.vptCoords.br;return!!this.intersectsWithRect(o,c,!0,r)||this.getCoords(!0,r).every(function(_){return(_.x>=c.x||_.x<=o.x)&&(_.y>=c.y||_.y<=o.y)})&&this._containsCenterOfCanvas(o,c,r)},_getImageLines:function(r){return{topline:{o:r.tl,d:r.tr},rightline:{o:r.tr,d:r.br},bottomline:{o:r.br,d:r.bl},leftline:{o:r.bl,d:r.tl}}},_findCrossPoints:function(r,o){var c,_,f,g=0;for(var m in o)if(!((f=o[m]).o.y<r.y&&f.d.y<r.y||f.o.y>=r.y&&f.d.y>=r.y||(f.o.x===f.d.x&&f.o.x>=r.x?_=f.o.x:(c=(f.d.y-f.o.y)/(f.d.x-f.o.x),_=-(r.y-0*r.x-(f.o.y-c*f.o.x))/(0-c)),_>=r.x&&(g+=1),g!==2)))break;return g},getBoundingRect:function(r,o){var c=this.getCoords(r,o);return a.makeBoundingBoxFromPoints(c)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(r){return Math.abs(r)<this.minScaleLimit?r<0?-this.minScaleLimit:this.minScaleLimit:r===0?1e-4:r},scale:function(r){return this._set("scaleX",r),this._set("scaleY",r),this.setCoords()},scaleToWidth:function(r,o){var c=this.getBoundingRect(o).width/this.getScaledWidth();return this.scale(r/this.width/c)},scaleToHeight:function(r,o){var c=this.getBoundingRect(o).height/this.getScaledHeight();return this.scale(r/this.height/c)},calcLineCoords:function(){var r=this.getViewportTransform(),o=this.padding,c=s(this.angle),_=a.cos(c)*o,f=a.sin(c)*o,g=_+f,m=_-f,S=this.calcACoords(),w={tl:u(S.tl,r),tr:u(S.tr,r),bl:u(S.bl,r),br:u(S.br,r)};return o&&(w.tl.x-=m,w.tl.y-=g,w.tr.x+=g,w.tr.y-=m,w.bl.x-=g,w.bl.y+=m,w.br.x+=m,w.br.y+=g),w},calcOCoords:function(){var r=this._calcRotateMatrix(),o=this._calcTranslateMatrix(),c=this.getViewportTransform(),_=l(c,o),f=l(_,r),g=(f=l(f,[1/c[0],0,0,1/c[3],0,0]),this._calculateCurrentDimensions()),m={};return this.forEachControl(function(S,w,I){m[w]=S.positionHandler(g,f,I)}),m},calcACoords:function(){var r=this._calcRotateMatrix(),o=this._calcTranslateMatrix(),c=l(o,r),_=this._getTransformedDimensions(),f=_.x/2,g=_.y/2;return{tl:u({x:-f,y:-g},c),tr:u({x:f,y:-g},c),bl:u({x:-f,y:g},c),br:u({x:f,y:g},c)}},setCoords:function(r){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),r||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return a.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var r=this.getCenterPoint();return[1,0,0,1,r.x,r.y]},transformMatrixKey:function(r){var o="_",c="";return!r&&this.group&&(c=this.group.transformMatrixKey(r)+o),c+this.top+o+this.left+o+this.scaleX+o+this.scaleY+o+this.skewX+o+this.skewY+o+this.angle+o+this.originX+o+this.originY+o+this.width+o+this.height+o+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(r){var o=this.calcOwnMatrix();if(r||!this.group)return o;var c=this.transformMatrixKey(r),_=this.matrixCache||(this.matrixCache={});return _.key===c?_.value:(this.group&&(o=l(this.group.calcTransformMatrix(!1),o)),_.key=c,_.value=o,o)},calcOwnMatrix:function(){var r=this.transformMatrixKey(!0),o=this.ownMatrixCache||(this.ownMatrixCache={});if(o.key===r)return o.value;var c=this._calcTranslateMatrix(),_={angle:this.angle,translateX:c[4],translateY:c[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return o.key=r,o.value=a.composeMatrix(_),o.value},_getNonTransformedDimensions:function(){var r=this.strokeWidth;return{x:this.width+r,y:this.height+r}},_getTransformedDimensions:function(r,o){r===void 0&&(r=this.skewX),o===void 0&&(o=this.skewY);var c,_,f,g=r===0&&o===0;if(this.strokeUniform?(_=this.width,f=this.height):(_=(c=this._getNonTransformedDimensions()).x,f=c.y),g)return this._finalizeDimensions(_*this.scaleX,f*this.scaleY);var m=a.sizeAfterTransform(_,f,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:r,skewY:o});return this._finalizeDimensions(m.x,m.y)},_finalizeDimensions:function(r,o){return this.strokeUniform?{x:r+this.strokeWidth,y:o+this.strokeWidth}:{x:r,y:o}},_calculateCurrentDimensions:function(){var r=this.getViewportTransform(),o=this._getTransformedDimensions();return u(o,r,!0).scalarAdd(2*this.padding)}})}(),y.util.object.extend(y.Object.prototype,{sendToBack:function(){return this.group?y.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?y.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(a){return this.group?y.StaticCanvas.prototype.sendBackwards.call(this.group,this,a):this.canvas&&this.canvas.sendBackwards(this,a),this},bringForward:function(a){return this.group?y.StaticCanvas.prototype.bringForward.call(this.group,this,a):this.canvas&&this.canvas.bringForward(this,a),this},moveTo:function(a){return this.group&&this.group.type!=="activeSelection"?y.StaticCanvas.prototype.moveTo.call(this.group,this,a):this.canvas&&this.canvas.moveTo(this,a),this}}),function(){function a(l,u){if(u){if(u.toLive)return l+": url(#SVGID_"+u.id+"); ";var r=new y.Color(u),o=l+": "+r.toRgb()+"; ",c=r.getAlpha();return c!==1&&(o+=l+"-opacity: "+c.toString()+"; "),o}return l+": none; "}var s=y.util.toFixed;y.util.object.extend(y.Object.prototype,{getSvgStyles:function(l){var u=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",o=this.strokeDashArray?this.strokeDashArray.join(" "):"none",c=this.strokeDashOffset?this.strokeDashOffset:"0",_=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",g=this.strokeMiterLimit?this.strokeMiterLimit:"4",m=this.opacity!==void 0?this.opacity:"1",S=this.visible?"":" visibility: hidden;",w=l?"":this.getSvgFilter(),I=a("fill",this.fill);return[a("stroke",this.stroke),"stroke-width: ",r,"; ","stroke-dasharray: ",o,"; ","stroke-linecap: ",_,"; ","stroke-dashoffset: ",c,"; ","stroke-linejoin: ",f,"; ","stroke-miterlimit: ",g,"; ",I,"fill-rule: ",u,"; ","opacity: ",m,";",w,S].join("")},getSvgSpanStyles:function(l,u){var r="; ",o=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+r:"",c=l.strokeWidth?"stroke-width: "+l.strokeWidth+r:"",_=l.fontSize?"font-size: "+l.fontSize+"px"+r:"",f=l.fontStyle?"font-style: "+l.fontStyle+r:"",g=l.fontWeight?"font-weight: "+l.fontWeight+r:"",m=l.fill?a("fill",l.fill):"",S=l.stroke?a("stroke",l.stroke):"",w=this.getSvgTextDecoration(l);return w&&(w="text-decoration: "+w+r),[S,c,o,_,f,g,w,m,l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"",u?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(u){return l[u.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,u){var r=l?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+y.util.matrixToSVG(r)+(u||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var u=y.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,u),'" y="',s(-this.height/2,u),'" width="',s(this.width,u),'" height="',s(this.height,u),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,u){var r=(u=u||{}).reviver,o=u.additionalTransform||"",c=[this.getSvgTransform(!0,o),this.getSvgCommons()].join(""),_=l.indexOf("COMMON_PARTS");return l[_]=c,r?r(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,u){var r,o,c=(u=u||{}).noStyle,_=u.reviver,f=c?"":'style="'+this.getSvgStyles()+'" ',g=u.withShadow?'style="'+this.getSvgFilter()+'" ':"",m=this.clipPath,S=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",w=m&&m.absolutePositioned,I=this.stroke,T=this.fill,A=this.shadow,D=[],P=l.indexOf("COMMON_PARTS"),j=u.additionalTransform;return m&&(m.clipPathId="CLIPPATH_"+y.Object.__uid++,o='<clipPath id="'+m.clipPathId+`" >
`+m.toClipPathSVG(_)+`</clipPath>
`),w&&D.push("<g ",g,this.getSvgCommons(),` >
`),D.push("<g ",this.getSvgTransform(!1),w?"":g+this.getSvgCommons(),` >
`),r=[f,S,c?"":this.addPaintOrder()," ",j?'transform="'+j+'" ':""].join(""),l[P]=r,T&&T.toLive&&D.push(T.toSVG(this)),I&&I.toLive&&D.push(I.toSVG(this)),A&&D.push(A.toSVG(this)),m&&D.push(o),D.push(l.join("")),D.push(`</g>
`),w&&D.push(`</g>
`),_?_(D.join("")):D.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var a=y.util.object.extend,s="stateProperties";function l(r,o,c){var _={};c.forEach(function(f){_[f]=r[f]}),a(r[o],_,!0)}function u(r,o,c){if(r===o)return!0;if(Array.isArray(r)){if(!Array.isArray(o)||r.length!==o.length)return!1;for(var _=0,f=r.length;_<f;_++)if(!u(r[_],o[_]))return!1;return!0}if(r&&typeof r=="object"){var g,m=Object.keys(r);if(!o||typeof o!="object"||!c&&m.length!==Object.keys(o).length)return!1;for(_=0,f=m.length;_<f;_++)if((g=m[_])!=="canvas"&&g!=="group"&&!u(r[g],o[g]))return!1;return!0}}y.util.object.extend(y.Object.prototype,{hasStateChanged:function(r){var o="_"+(r=r||s);return Object.keys(this[o]).length<this[r].length||!u(this[o],this,!0)},saveState:function(r){var o=r&&r.propertySet||s,c="_"+o;return this[c]?(l(this,c,this[o]),r&&r.stateProperties&&l(this,c,r.stateProperties),this):this.setupState(r)},setupState:function(r){var o=(r=r||{}).propertySet||s;return r.propertySet=o,this["_"+o]={},this.saveState(r),this}})}(),function(){var a=y.util.degreesToRadians;y.util.object.extend(y.Object.prototype,{_findTargetCorner:function(s,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var u,r,o,c=s.x,_=s.y,f=Object.keys(this.oCoords),g=f.length-1;for(this.__corner=0;g>=0;g--)if(o=f[g],this.isControlVisible(o)&&(r=this._getImageLines(l?this.oCoords[o].touchCorner:this.oCoords[o].corner),(u=this._findCrossPoints({x:c,y:_},r))!==0&&u%2==1))return this.__corner=o,o;return!1},forEachControl:function(s){for(var l in this.controls)s(this.controls[l],l,this)},_setCornerCoords:function(){var s=this.oCoords;for(var l in s){var u=this.controls[l];s[l].corner=u.calcCornerCoords(this.angle,this.cornerSize,s[l].x,s[l].y,!1),s[l].touchCorner=u.calcCornerCoords(this.angle,this.touchCornerSize,s[l].x,s[l].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var l=this.getCenterPoint(),u=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return s.translate(l.x,l.y),s.scale(1/r[0],1/r[3]),s.rotate(a(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-u.x/2,-u.y/2,u.x,u.y),s.restore(),this},drawBorders:function(s,l){l=l||{};var u=this._calculateCurrentDimensions(),r=this.borderScaleFactor,o=u.x+r,c=u.y+r,_=l.hasControls!==void 0?l.hasControls:this.hasControls,f=!1;return s.save(),s.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(s,l.borderDashArray||this.borderDashArray),s.strokeRect(-o/2,-c/2,o,c),_&&(s.beginPath(),this.forEachControl(function(g,m,S){g.withConnection&&g.getVisibility(S,m)&&(f=!0,s.moveTo(g.x*o,g.y*c),s.lineTo(g.x*o+g.offsetX,g.y*c+g.offsetY))}),f&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,l,u){u=u||{};var r=y.util.sizeAfterTransform(this.width,this.height,l),o=this.strokeWidth,c=this.strokeUniform,_=this.borderScaleFactor,f=r.x+o*(c?this.canvas.getZoom():l.scaleX)+_,g=r.y+o*(c?this.canvas.getZoom():l.scaleY)+_;return s.save(),this._setLineDash(s,u.borderDashArray||this.borderDashArray),s.strokeStyle=u.borderColor||this.borderColor,s.strokeRect(-f/2,-g/2,f,g),s.restore(),this},drawControls:function(s,l){l=l||{},s.save();var u,r,o=this.canvas.getRetinaScaling();return s.setTransform(o,0,0,o,0,0),s.strokeStyle=s.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(u=this.group.calcTransformMatrix()),this.forEachControl(function(c,_,f){r=f.oCoords[_],c.getVisibility(f,_)&&(u&&(r=y.util.transformPoint(r,u)),c.render(s,r.x,r.y,l,f))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=l,this},setControlsVisibility:function(s){for(var l in s||(s={}),s)this.setControlVisible(l,s[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),y.util.object.extend(y.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(a,s){var l=function(){},u=(s=s||{}).onComplete||l,r=s.onChange||l,o=this;return y.util.animate({target:this,startValue:a.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(c){a.set("left",c),o.requestRenderAll(),r()},onComplete:function(){a.setCoords(),u()}})},fxCenterObjectV:function(a,s){var l=function(){},u=(s=s||{}).onComplete||l,r=s.onChange||l,o=this;return y.util.animate({target:this,startValue:a.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(c){a.set("top",c),o.requestRenderAll(),r()},onComplete:function(){a.setCoords(),u()}})},fxRemove:function(a,s){var l=function(){},u=(s=s||{}).onComplete||l,r=s.onChange||l,o=this;return y.util.animate({target:this,startValue:a.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(c){a.set("opacity",c),o.requestRenderAll(),r()},onComplete:function(){o.remove(a),u()}})}}),y.util.object.extend(y.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var a,s,l=[],u=[];for(a in arguments[0])l.push(a);for(var r=0,o=l.length;r<o;r++)a=l[r],s=r!==o-1,u.push(this._animate(a,arguments[0][a],arguments[1],s));return u}return this._animate.apply(this,arguments)},_animate:function(a,s,l,u){var r,o=this;s=s.toString(),l=l?y.util.object.clone(l):{},~a.indexOf(".")&&(r=a.split("."));var c=o.colorProperties.indexOf(a)>-1||r&&o.colorProperties.indexOf(r[1])>-1,_=r?this.get(r[0])[r[1]]:this.get(a);"from"in l||(l.from=_),c||(s=~s.indexOf("=")?_+parseFloat(s.replace("=","")):parseFloat(s));var f={target:this,startValue:l.from,endValue:s,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(g,m,S){return l.abort.call(o,g,m,S)},onChange:function(g,m,S){r?o[r[0]][r[1]]=g:o.set(a,g),u||l.onChange&&l.onChange(g,m,S)},onComplete:function(g,m,S){u||(o.setCoords(),l.onComplete&&l.onComplete(g,m,S))}};return c?y.util.animateColor(f.startValue,f.endValue,f.duration,f):y.util.animate(f)}}),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};function o(c,_){var f=c.origin,g=c.axis1,m=c.axis2,S=c.dimension,w=_.nearest,I=_.center,T=_.farthest;return function(){switch(this.get(f)){case w:return Math.min(this.get(g),this.get(m));case I:return Math.min(this.get(g),this.get(m))+.5*this.get(S);case T:return Math.max(this.get(g),this.get(m))}}}s.Line?s.warn("fabric.Line is already defined"):(s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(c,_){c||(c=[0,0,0,0]),this.callSuper("initialize",_),this.set("x1",c[0]),this.set("y1",c[1]),this.set("x2",c[2]),this.set("y2",c[3]),this._setWidthHeight(_)},_setWidthHeight:function(c){c||(c={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in c?c.left:this._getLeftToOriginX(),this.top="top"in c?c.top:this._getTopToOriginY()},_set:function(c,_){return this.callSuper("_set",c,_),r[c]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:o({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:o({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(c){c.beginPath();var _=this.calcLinePoints();c.moveTo(_.x1,_.y1),c.lineTo(_.x2,_.y2),c.lineWidth=this.strokeWidth;var f=c.strokeStyle;c.strokeStyle=this.stroke||c.fillStyle,this.stroke&&this._renderStroke(c),c.strokeStyle=f},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(c){return l(this.callSuper("toObject",c),this.calcLinePoints())},_getNonTransformedDimensions:function(){var c=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(c.y-=this.strokeWidth),this.height===0&&(c.x-=this.strokeWidth)),c},calcLinePoints:function(){var c=this.x1<=this.x2?-1:1,_=this.y1<=this.y2?-1:1,f=c*this.width*.5,g=_*this.height*.5;return{x1:f,x2:c*this.width*-.5,y1:g,y2:_*this.height*-.5}},_toSVG:function(){var c=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',c.x1,'" y1="',c.y1,'" x2="',c.x2,'" y2="',c.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(c,_,f){f=f||{};var g=s.parseAttributes(c,s.Line.ATTRIBUTE_NAMES),m=[g.x1||0,g.y1||0,g.x2||0,g.y2||0];_(new s.Line(m,l(g,f)))},s.Line.fromObject=function(c,_){var f=u(c,!0);f.points=[c.x1,c.y1,c.x2,c.y2],s.Object._fromObject("Line",f,function(g){delete g.points,_&&_(g)},"points")})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.degreesToRadians;s.Circle?s.warn("fabric.Circle is already defined."):(s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(u,r){return this.callSuper("_set",u,r),u==="radius"&&this.setRadius(r),this},toObject:function(u){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(u))},_toSVG:function(){var u,r=(this.endAngle-this.startAngle)%360;if(r===0)u=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var o=l(this.startAngle),c=l(this.endAngle),_=this.radius;u=['<path d="M '+s.util.cos(o)*_+" "+s.util.sin(o)*_," A "+_+" "+_," 0 ",+(r>180?"1":"0")+" 1"," "+s.util.cos(c)*_+" "+s.util.sin(c)*_,'" ',"COMMON_PARTS",` />
`]}return u},_render:function(u){u.beginPath(),u.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(u)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(u){return this.radius=u,this.set("width",2*u).set("height",2*u)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(u,r){var o,c=s.parseAttributes(u,s.Circle.ATTRIBUTE_NAMES);if(!("radius"in(o=c)&&o.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");c.left=(c.left||0)-c.radius,c.top=(c.top||0)-c.radius,r(new s.Circle(c))},s.Circle.fromObject=function(u,r){s.Object._fromObject("Circle",u,r)})}(e),function(a){var s=a.fabric||(a.fabric={});s.Triangle?s.warn("fabric.Triangle is already defined"):(s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(l){var u=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-u,r),l.lineTo(0,-r),l.lineTo(u,r),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,u=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-l+" "+u,"0 "+-u,l+" "+u].join(","),'" />']}}),s.Triangle.fromObject=function(l,u){return s.Object._fromObject("Triangle",l,u)})}(e),function(a){var s=a.fabric||(a.fabric={}),l=2*Math.PI;s.Ellipse?s.warn("fabric.Ellipse is already defined."):(s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this.set("rx",u&&u.rx||0),this.set("ry",u&&u.ry||0)},_set:function(u,r){switch(this.callSuper("_set",u,r),u){case"rx":this.rx=r,this.set("width",2*r);break;case"ry":this.ry=r,this.set("height",2*r)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(u){u.beginPath(),u.save(),u.transform(1,0,0,this.ry/this.rx,0,0),u.arc(0,0,this.rx,0,l,!1),u.restore(),this._renderPaintInOrder(u)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(u,r){var o=s.parseAttributes(u,s.Ellipse.ATTRIBUTE_NAMES);o.left=(o.left||0)-o.rx,o.top=(o.top||0)-o.ry,r(new s.Ellipse(o))},s.Ellipse.fromObject=function(u,r){s.Object._fromObject("Ellipse",u,r)})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend;s.Rect?s.warn("fabric.Rect is already defined"):(s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(u){this.callSuper("initialize",u),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(u){var r=this.rx?Math.min(this.rx,this.width/2):0,o=this.ry?Math.min(this.ry,this.height/2):0,c=this.width,_=this.height,f=-this.width/2,g=-this.height/2,m=r!==0||o!==0,S=.4477152502;u.beginPath(),u.moveTo(f+r,g),u.lineTo(f+c-r,g),m&&u.bezierCurveTo(f+c-S*r,g,f+c,g+S*o,f+c,g+o),u.lineTo(f+c,g+_-o),m&&u.bezierCurveTo(f+c,g+_-S*o,f+c-S*r,g+_,f+c-r,g+_),u.lineTo(f+r,g+_),m&&u.bezierCurveTo(f+S*r,g+_,f,g+_-S*o,f,g+_-o),u.lineTo(f,g+o),m&&u.bezierCurveTo(f,g+S*o,f+S*r,g,f+r,g),u.closePath(),this._renderPaintInOrder(u)},toObject:function(u){return this.callSuper("toObject",["rx","ry"].concat(u))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(u,r,o){if(!u)return r(null);o=o||{};var c=s.parseAttributes(u,s.Rect.ATTRIBUTE_NAMES);c.left=c.left||0,c.top=c.top||0,c.height=c.height||0,c.width=c.width||0;var _=new s.Rect(l(o?s.util.object.clone(o):{},c));_.visible=_.visible&&_.width>0&&_.height>0,r(_)},s.Rect.fromObject=function(u,r){return s.Object._fromObject("Rect",u,r)})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.util.array.min,r=s.util.array.max,o=s.util.toFixed,c=s.util.projectStrokeOnPoints;s.Polyline?s.warn("fabric.Polyline is already defined"):(s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(_,f){f=f||{},this.points=_||[],this.callSuper("initialize",f),this._setPositionDimensions(f)},_projectStrokeOnPoints:function(){return c(this.points,this,!0)},_setPositionDimensions:function(_){var f,g=this._calcDimensions(_),m=this.exactBoundingBox?this.strokeWidth:0;this.width=g.width-m,this.height=g.height-m,_.fromSVG||(f=this.translateToGivenOrigin({x:g.left-this.strokeWidth/2+m/2,y:g.top-this.strokeWidth/2+m/2},"left","top",this.originX,this.originY)),_.left===void 0&&(this.left=_.fromSVG?g.left:f.x),_.top===void 0&&(this.top=_.fromSVG?g.top:f.y),this.pathOffset={x:g.left+this.width/2+m/2,y:g.top+this.height/2+m/2}},_calcDimensions:function(){var _=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,f=u(_,"x")||0,g=u(_,"y")||0;return{left:f,top:g,width:(r(_,"x")||0)-f,height:(r(_,"y")||0)-g}},toObject:function(_){return l(this.callSuper("toObject",_),{points:this.points.concat()})},_toSVG:function(){for(var _=[],f=this.pathOffset.x,g=this.pathOffset.y,m=s.Object.NUM_FRACTION_DIGITS,S=0,w=this.points.length;S<w;S++)_.push(o(this.points[S].x-f,m),",",o(this.points[S].y-g,m)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',_.join(""),`" />
`]},commonRender:function(_){var f,g=this.points.length,m=this.pathOffset.x,S=this.pathOffset.y;if(!g||isNaN(this.points[g-1].y))return!1;_.beginPath(),_.moveTo(this.points[0].x-m,this.points[0].y-S);for(var w=0;w<g;w++)f=this.points[w],_.lineTo(f.x-m,f.y-S);return!0},_render:function(_){this.commonRender(_)&&this._renderPaintInOrder(_)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(_){return function(f,g,m){if(!f)return g(null);m||(m={});var S=s.parsePointsAttribute(f.getAttribute("points")),w=s.parseAttributes(f,s[_].ATTRIBUTE_NAMES);w.fromSVG=!0,g(new s[_](S,l(w,m)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(_,f){return s.Object._fromObject("Polyline",_,f,"points")})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.projectStrokeOnPoints;s.Polygon?s.warn("fabric.Polygon is already defined"):(s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(u){this.commonRender(u)&&(u.closePath(),this._renderPaintInOrder(u))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(u,r){s.Object._fromObject("Polygon",u,r,"points")})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.array.min,u=s.util.array.max,r=s.util.object.extend,o=s.util.object.clone,c=s.util.toFixed;s.Path?s.warn("fabric.Path is already defined"):(s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(_,f){delete(f=o(f||{})).path,this.callSuper("initialize",f),this._setPath(_||[],f)},_setPath:function(_,f){this.path=s.util.makePathSimpler(Array.isArray(_)?_:s.util.parsePath(_)),s.Polyline.prototype._setPositionDimensions.call(this,f||{})},_renderPathCommands:function(_){var f,g=0,m=0,S=0,w=0,I=0,T=0,A=-this.pathOffset.x,D=-this.pathOffset.y;_.beginPath();for(var P=0,j=this.path.length;P<j;++P)switch((f=this.path[P])[0]){case"L":S=f[1],w=f[2],_.lineTo(S+A,w+D);break;case"M":g=S=f[1],m=w=f[2],_.moveTo(S+A,w+D);break;case"C":S=f[5],w=f[6],I=f[3],T=f[4],_.bezierCurveTo(f[1]+A,f[2]+D,I+A,T+D,S+A,w+D);break;case"Q":_.quadraticCurveTo(f[1]+A,f[2]+D,f[3]+A,f[4]+D),S=f[3],w=f[4],I=f[1],T=f[2];break;case"z":case"Z":S=g,w=m,_.closePath()}},_render:function(_){this._renderPathCommands(_),this._renderPaintInOrder(_)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(_){return r(this.callSuper("toObject",_),{path:this.path.map(function(f){return f.slice()})})},toDatalessObject:function(_){var f=this.toObject(["sourcePath"].concat(_));return f.sourcePath&&delete f.path,f},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',s.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var _=s.Object.NUM_FRACTION_DIGITS;return" translate("+c(-this.pathOffset.x,_)+", "+c(-this.pathOffset.y,_)+")"},toClipPathSVG:function(_){var f=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:_,additionalTransform:f})},toSVG:function(_){var f=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:_,additionalTransform:f})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var _,f,g=[],m=[],S=0,w=0,I=0,T=0,A=0,D=this.path.length;A<D;++A){switch((_=this.path[A])[0]){case"L":I=_[1],T=_[2],f=[];break;case"M":S=I=_[1],w=T=_[2],f=[];break;case"C":f=s.util.getBoundsOfCurve(I,T,_[1],_[2],_[3],_[4],_[5],_[6]),I=_[5],T=_[6];break;case"Q":f=s.util.getBoundsOfCurve(I,T,_[1],_[2],_[1],_[2],_[3],_[4]),I=_[3],T=_[4];break;case"z":case"Z":I=S,T=w}f.forEach(function(Z){g.push(Z.x),m.push(Z.y)}),g.push(I),m.push(T)}var P=l(g)||0,j=l(m)||0;return{left:P,top:j,width:(u(g)||0)-P,height:(u(m)||0)-j}}}),s.Path.fromObject=function(_,f){if(typeof _.sourcePath=="string"){var g=_.sourcePath;s.loadSVGFromURL(g,function(m){var S=m[0];S.setOptions(_),f&&f(S)})}else s.Object._fromObject("Path",_,f,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(_,f,g){var m=s.parseAttributes(_,s.Path.ATTRIBUTE_NAMES);m.fromSVG=!0,f(new s.Path(m.d,r(m,g)))})}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.array.min,u=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,o,c){o=o||{},this._objects=[],c&&this.callSuper("initialize",o),this._objects=r||[];for(var _=this._objects.length;_--;)this._objects[_].group=this;if(c)this._updateObjectsACoords();else{var f=o&&o.centerPoint;o.originX!==void 0&&(this.originX=o.originX),o.originY!==void 0&&(this.originY=o.originY),f||this._calcBounds(),this._updateObjectsCoords(f),delete o.centerPoint,this.callSuper("initialize",o)}this.setCoords()},_updateObjectsACoords:function(){for(var r=this._objects.length;r--;)this._objects[r].setCoords(!0)},_updateObjectsCoords:function(r){r=r||this.getCenterPoint();for(var o=this._objects.length;o--;)this._updateObjectCoords(this._objects[o],r)},_updateObjectCoords:function(r,o){var c=r.left,_=r.top;r.set({left:c-o.x,top:_-o.y}),r.group=this,r.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var o=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),r&&(o&&s.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,o?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,o){var c=this._objects.length;if(this.useSetOnGroup)for(;c--;)this._objects[c].setOnGroup(r,o);if(r==="canvas")for(;c--;)this._objects[c]._set(r,o);s.Object.prototype._set.call(this,r,o)},toObject:function(r){var o=this.includeDefaultValues,c=this._objects.filter(function(f){return!f.excludeFromExport}).map(function(f){var g=f.includeDefaultValues;f.includeDefaultValues=o;var m=f.toObject(r);return f.includeDefaultValues=g,m}),_=s.Object.prototype.toObject.call(this,r);return _.objects=c,_},toDatalessObject:function(r){var o,c=this.sourcePath;if(c)o=c;else{var _=this.includeDefaultValues;o=this._objects.map(function(g){var m=g.includeDefaultValues;g.includeDefaultValues=_;var S=g.toDatalessObject(r);return g.includeDefaultValues=m,S})}var f=s.Object.prototype.toDatalessObject.call(this,r);return f.objects=o,f},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=s.Object.prototype.shouldCache.call(this);if(r){for(var o=0,c=this._objects.length;o<c;o++)if(this._objects[o].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,o=this._objects.length;r<o;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var o=0,c=this._objects.length;o<c;o++)this._objects[o].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var o=0,c=this._objects.length;o<c;o++)if(this._objects[o].isCacheDirty(!0)){if(this._cacheCanvas){var _=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-_/2,-f/2,_,f)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(o){s.util.addTransformToObject(o,r),delete o.group,o.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,o=this.canvas;this._objects=[];var c=this.toObject();delete c.objects;var _=new s.ActiveSelection([]);return _.set(c),_.type="activeSelection",o.remove(this),r.forEach(function(f){f.group=_,f.dirty=!0,o.add(f)}),_.canvas=o,_._objects=r,o._activeObject=_,_.setCoords(),_}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(r){r.setCoords(!0)}),this},_calcBounds:function(r){for(var o,c,_,f,g=[],m=[],S=["tr","br","bl","tl"],w=0,I=this._objects.length,T=S.length;w<I;++w){for(_=(o=this._objects[w]).calcACoords(),f=0;f<T;f++)c=S[f],g.push(_[c].x),m.push(_[c].y);o.aCoords=_}this._getBounds(g,m,r)},_getBounds:function(r,o,c){var _=new s.Point(l(r),l(o)),f=new s.Point(u(r),u(o)),g=_.y||0,m=_.x||0,S=f.x-_.x||0,w=f.y-_.y||0;this.width=S,this.height=w,c||this.setPositionByOrigin({x:m,y:g},"left","top")},_toSVG:function(r){for(var o=["<g ","COMMON_PARTS",` >
`],c=0,_=this._objects.length;c<_;c++)o.push("		",this._objects[c].toSVG(r));return o.push(`</g>
`),o},getSvgStyles:function(){var r=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",o=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),o].join("")},toClipPathSVG:function(r){for(var o=[],c=0,_=this._objects.length;c<_;c++)o.push("	",this._objects[c].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(o,{reviver:r})}}),s.Group.fromObject=function(r,o){var c=r.objects,_=s.util.object.clone(r,!0);delete _.objects,typeof c!="string"?s.util.enlivenObjects(c,function(f){var g=s.util.object.clone(r,!0);delete g.objects,s.util.enlivenObjectEnlivables(r,g,function(){o&&o(new s.Group(f,g,!0))})}):s.loadSVGFromURL(c,function(f){var g=s.util.groupSVGElements(f,r,c);g.set(_),o&&o(g)})})}(e),function(a){var s=a.fabric||(a.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(l,u){u=u||{},this._objects=l||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;u.originX&&(this.originX=u.originX),u.originY&&(this.originY=u.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,u),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var u=s.Object.prototype.toObject.call(this),r=new s.Group([]);if(delete u.type,r.set(u),l.forEach(function(c){c.canvas.remove(c),c.group=r}),r._objects=l,!this.canvas)return r;var o=this.canvas;return o.add(r),o._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,u,r){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,u),(r=r||{}).hasControls===void 0&&(r.hasControls=!1),r.forActiveSelection=!0;for(var o=0,c=this._objects.length;o<c;o++)this._objects[o]._renderControls(l,r);l.restore()}}),s.ActiveSelection.fromObject=function(l,u){s.util.enlivenObjects(l.objects,function(r){delete l.objects,u&&u(new s.ActiveSelection(r,l,!0))})})}(e),function(a){var s=y.util.object.extend;a.fabric||(a.fabric={}),a.fabric.Image?y.warn("fabric.Image is already defined."):(y.Image=y.util.createClass(y.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:y.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:y.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,u){u||(u={}),this.filters=[],this.cacheKey="texture"+y.Object.__uid++,this.callSuper("initialize",u),this._initElement(l,u)},getElement:function(){return this._element||{}},setElement:function(l,u){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(u),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var u=y.filterBackend;u&&u.evictCachesForKey&&u.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach(function(l){y.util.cleanUpJsdomNode(this[l]),this[l]=void 0}.bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(this.stroke&&this.strokeWidth!==0){var u=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-u,-r),l.lineTo(u,-r),l.lineTo(u,r),l.lineTo(-u,r),l.lineTo(-u,-r),l.closePath()}},toObject:function(l){var u=[];this.filters.forEach(function(o){o&&u.push(o.toObject())});var r=s(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:u});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l,u=[],r=[],o=this._element,c=-this.width/2,_=-this.height/2,f="",g="";if(!o)return[];if(this.hasCrop()){var m=y.Object.__uid++;u.push('<clipPath id="imageCrop_'+m+`">
`,'	<rect x="'+c+'" y="'+_+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),f=' clip-path="url(#imageCrop_'+m+')" '}if(this.imageSmoothing||(g='" image-rendering="optimizeSpeed'),r.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',c-this.cropX,'" y="',_-this.cropY,'" width="',o.width||o.naturalWidth,'" height="',o.height||o.height,g,'"',f,`></image>
`),this.stroke||this.strokeDashArray){var S=this.fill;this.fill=null,l=["	<rect ",'x="',c,'" y="',_,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=S}return this.paintFirst!=="fill"?u.concat(l,r):u.concat(r,l)},getSrc:function(l){var u=l?this._element:this._originalElement;return u?u.toDataURL?u.toDataURL():this.srcFromAttribute?u.getAttribute("src"):u.src:this.src||""},setSrc:function(l,u,r){return y.util.loadImage(l,function(o,c){this.setElement(o,r),this._setWidthHeight(),u&&u(this,c)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,u=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),o=r.scaleX,c=r.scaleY,_=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||o>u&&c>u)return this._element=_,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=o,void(this._lastScaleY=c);y.filterBackend||(y.filterBackend=y.initFilterBackend());var f=y.util.createCanvasElement(),g=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,m=_.width,S=_.height;f.width=m,f.height=S,this._element=f,this._lastScaleX=l.scaleX=o,this._lastScaleY=l.scaleY=c,y.filterBackend.applyFilters([l],_,m,S,this._element,g),this._filterScalingX=f.width/this._originalElement.width,this._filterScalingY=f.height/this._originalElement.height},applyFilters:function(l){if(l=(l=l||this.filters||[]).filter(function(_){return _&&!_.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var u=this._originalElement,r=u.naturalWidth||u.width,o=u.naturalHeight||u.height;if(this._element===this._originalElement){var c=y.util.createCanvasElement();c.width=r,c.height=o,this._element=c,this._filteredEl=c}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,o),this._lastScaleX=1,this._lastScaleY=1;return y.filterBackend||(y.filterBackend=y.initFilterBackend()),y.filterBackend.applyFilters(l,this._originalElement,r,o,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){y.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){y.util.setImageSmoothing(l,this.imageSmoothing),y.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var u=this._element;if(u){var r=this._filterScalingX,o=this._filterScalingY,c=this.width,_=this.height,f=Math.min,g=Math.max,m=g(this.cropX,0),S=g(this.cropY,0),w=u.naturalWidth||u.width,I=u.naturalHeight||u.height,T=m*r,A=S*o,D=f(c*r,w-T),P=f(_*o,I-A),j=-c/2,Z=-_/2,X=f(c,w/r-m),W=f(_,I/o-S);u&&l.drawImage(u,T,A,D,P,j,Z,X,W)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,u){this.setElement(y.util.getById(l),u),y.util.addClass(this.getElement(),y.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,u){l&&l.length?y.util.enlivenObjects(l,function(r){u&&u(r)},"fabric.Image.filters"):u&&u()},_setWidthHeight:function(l){l||(l={});var u=this.getElement();this.width=l.width||u.naturalWidth||u.width||0,this.height=l.height||u.naturalHeight||u.height||0},parsePreserveAspectRatioAttribute:function(){var l,u=y.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),r=this._element.width,o=this._element.height,c=1,_=1,f=0,g=0,m=0,S=0,w=this.width,I=this.height,T={width:w,height:I};return!u||u.alignX==="none"&&u.alignY==="none"?(c=w/r,_=I/o):(u.meetOrSlice==="meet"&&(l=(w-r*(c=_=y.util.findScaleToFit(this._element,T)))/2,u.alignX==="Min"&&(f=-l),u.alignX==="Max"&&(f=l),l=(I-o*_)/2,u.alignY==="Min"&&(g=-l),u.alignY==="Max"&&(g=l)),u.meetOrSlice==="slice"&&(l=r-w/(c=_=y.util.findScaleToCover(this._element,T)),u.alignX==="Mid"&&(m=l/2),u.alignX==="Max"&&(m=l),l=o-I/_,u.alignY==="Mid"&&(S=l/2),u.alignY==="Max"&&(S=l),r=w/c,o=I/_)),{width:r,height:o,scaleX:c,scaleY:_,offsetLeft:f,offsetTop:g,cropX:m,cropY:S}}}),y.Image.CSS_CANVAS="canvas-img",y.Image.prototype.getSvgSrc=y.Image.prototype.getSrc,y.Image.fromObject=function(l,u){var r=y.util.object.clone(l);y.util.loadImage(r.src,function(o,c){c?u&&u(null,!0):y.Image.prototype._initFilters.call(r,r.filters,function(_){r.filters=_||[],y.Image.prototype._initFilters.call(r,[r.resizeFilter],function(f){r.resizeFilter=f[0],y.util.enlivenObjectEnlivables(r,r,function(){var g=new y.Image(o,r);u(g,!1)})})})},null,r.crossOrigin)},y.Image.fromURL=function(l,u,r){y.util.loadImage(l,function(o,c){u&&u(new y.Image(o,r),c)},null,r&&r.crossOrigin)},y.Image.ATTRIBUTE_NAMES=y.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),y.Image.fromElement=function(l,u,r){var o=y.parseAttributes(l,y.Image.ATTRIBUTE_NAMES);y.Image.fromURL(o["xlink:href"],u,s(r?y.util.object.clone(r):{},o))})}(e),y.util.object.extend(y.Object.prototype,{_getAngleValueForStraighten:function(){var a=this.angle%360;return a>0?90*Math.round((a-1)/90):90*Math.round(a/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(a){var s=function(){},l=(a=a||{}).onComplete||s,u=a.onChange||s,r=this;return y.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(o){r.rotate(o),u()},onComplete:function(){r.setCoords(),l()}})}}),y.util.object.extend(y.StaticCanvas.prototype,{straightenObject:function(a){return a.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(a){return a.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function a(l,u){var r="precision "+u+` float;
void main(){}`,o=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(o,r),l.compileShader(o),!!l.getShaderParameter(o,l.COMPILE_STATUS)}function s(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}y.isWebglSupported=function(l){if(y.isLikelyNode)return!1;l=l||y.WebglFilterBackend.prototype.tileSize;var u=document.createElement("canvas"),r=u.getContext("webgl")||u.getContext("experimental-webgl"),o=!1;if(r){y.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),o=y.maxTextureSize>=l;for(var c=["highp","mediump","lowp"],_=0;_<3;_++)if(a(r,c[_])){y.webGlPrecision=c[_];break}}return this.isSupported=o,o},y.WebglFilterBackend=s,s.prototype={tileSize:2048,resources:{},setupGLContext:function(l,u){this.dispose(),this.createWebGLCanvas(l,u),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,u)},chooseFastestCopyGLTo2DMethod:function(l,u){var r,o=window.performance!==void 0;try{new ImageData(1,1),r=!0}catch(I){r=!1}var c=typeof ArrayBuffer<"u",_=typeof Uint8ClampedArray<"u";if(o&&r&&c&&_){var f=y.util.createCanvasElement(),g=new ArrayBuffer(l*u*4);if(y.forceGLPutImageData)return this.imageBuffer=g,void(this.copyGLTo2D=we);var m,S,w={imageBuffer:g,destinationWidth:l,destinationHeight:u,targetCanvas:f};f.width=l,f.height=u,m=window.performance.now(),me.call(w,this.gl,w),S=window.performance.now()-m,m=window.performance.now(),we.call(w,this.gl,w),S>window.performance.now()-m?(this.imageBuffer=g,this.copyGLTo2D=we):this.copyGLTo2D=me}},createWebGLCanvas:function(l,u){var r=y.util.createCanvasElement();r.width=l,r.height=u;var o={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},c=r.getContext("webgl",o);c||(c=r.getContext("experimental-webgl",o)),c&&(c.clearColor(0,0,0,0),this.canvas=r,this.gl=c)},applyFilters:function(l,u,r,o,c,_){var f,g=this.gl;_&&(f=this.getCachedTexture(_,u));var m={originalWidth:u.width||u.originalWidth,originalHeight:u.height||u.originalHeight,sourceWidth:r,sourceHeight:o,destinationWidth:r,destinationHeight:o,context:g,sourceTexture:this.createTexture(g,r,o,!f&&u),targetTexture:this.createTexture(g,r,o),originalTexture:f||this.createTexture(g,r,o,!f&&u),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:c},S=g.createFramebuffer();return g.bindFramebuffer(g.FRAMEBUFFER,S),l.forEach(function(w){w&&w.applyTo(m)}),function(w){var I=w.targetCanvas,T=I.width,A=I.height,D=w.destinationWidth,P=w.destinationHeight;T===D&&A===P||(I.width=D,I.height=P)}(m),this.copyGLTo2D(g,m),g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(m.sourceTexture),g.deleteTexture(m.targetTexture),g.deleteFramebuffer(S),c.getContext("2d").setTransform(1,0,0,1,0,0),m},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,u,r,o){var c=l.createTexture();return l.bindTexture(l.TEXTURE_2D,c),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),o?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,o):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,u,r,0,l.RGBA,l.UNSIGNED_BYTE,null),c},getCachedTexture:function(l,u){if(this.textureCache[l])return this.textureCache[l];var r=this.createTexture(this.gl,u.width,u.height,u);return this.textureCache[l]=r,r},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:me,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,u={renderer:"",vendor:""};if(!l)return u;var r=l.getExtension("WEBGL_debug_renderer_info");if(r){var o=l.getParameter(r.UNMASKED_RENDERER_WEBGL),c=l.getParameter(r.UNMASKED_VENDOR_WEBGL);o&&(u.renderer=o.toLowerCase()),c&&(u.vendor=c.toLowerCase())}return this.gpuInfo=u,u}}}(),function(){var a=function(){};function s(){}y.Canvas2dFilterBackend=s,s.prototype={evictCachesForKey:a,dispose:a,clearWebGLCaches:a,resources:{},applyFilters:function(l,u,r,o,c){var _=c.getContext("2d");_.drawImage(u,0,0,r,o);var f={sourceWidth:r,sourceHeight:o,imageData:_.getImageData(0,0,r,o),originalEl:u,originalImageData:_.getImageData(0,0,r,o),canvasEl:c,ctx:_,filterBackend:this};return l.forEach(function(g){g.applyTo(f)}),f.imageData.width===r&&f.imageData.height===o||(c.width=f.imageData.width,c.height=f.imageData.height),_.putImageData(f.imageData,0,0),f}}}(),y.Image=y.Image||{},y.Image.filters=y.Image.filters||{},y.Image.filters.BaseFilter=y.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(a){a&&this.setOptions(a)},setOptions:function(a){for(var s in a)this[s]=a[s]},createProgram:function(a,s,l){s=s||this.fragmentSource,l=l||this.vertexSource,y.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+y.webGlPrecision+" float"));var u=a.createShader(a.VERTEX_SHADER);if(a.shaderSource(u,l),a.compileShader(u),!a.getShaderParameter(u,a.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+a.getShaderInfoLog(u));var r=a.createShader(a.FRAGMENT_SHADER);if(a.shaderSource(r,s),a.compileShader(r),!a.getShaderParameter(r,a.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+a.getShaderInfoLog(r));var o=a.createProgram();if(a.attachShader(o,u),a.attachShader(o,r),a.linkProgram(o),!a.getProgramParameter(o,a.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+a.getProgramInfoLog(o));var c=this.getAttributeLocations(a,o),_=this.getUniformLocations(a,o)||{};return _.uStepW=a.getUniformLocation(o,"uStepW"),_.uStepH=a.getUniformLocation(o,"uStepH"),{program:o,attributeLocations:c,uniformLocations:_}},getAttributeLocations:function(a,s){return{aPosition:a.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(a,s,l){var u=s.aPosition,r=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,r),a.enableVertexAttribArray(u),a.vertexAttribPointer(u,2,a.FLOAT,!1,0,0),a.bufferData(a.ARRAY_BUFFER,l,a.STATIC_DRAW)},_setupFrameBuffer:function(a){var s,l,u=a.context;a.passes>1?(s=a.destinationWidth,l=a.destinationHeight,a.sourceWidth===s&&a.sourceHeight===l||(u.deleteTexture(a.targetTexture),a.targetTexture=a.filterBackend.createTexture(u,s,l)),u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,a.targetTexture,0)):(u.bindFramebuffer(u.FRAMEBUFFER,null),u.finish())},_swapTextures:function(a){a.passes--,a.pass++;var s=a.targetTexture;a.targetTexture=a.sourceTexture,a.sourceTexture=s},isNeutralState:function(){var a=this.mainParameter,s=y.Image.filters[this.type].prototype;if(a){if(Array.isArray(s[a])){for(var l=s[a].length;l--;)if(this[a][l]!==s[a][l])return!1;return!0}return s[a]===this[a]}return!1},applyTo:function(a){a.webgl?(this._setupFrameBuffer(a),this.applyToWebGL(a),this._swapTextures(a)):this.applyTo2d(a)},retrieveShader:function(a){return a.programCache.hasOwnProperty(this.type)||(a.programCache[this.type]=this.createProgram(a.context)),a.programCache[this.type]},applyToWebGL:function(a){var s=a.context,l=this.retrieveShader(a);a.pass===0&&a.originalTexture?s.bindTexture(s.TEXTURE_2D,a.originalTexture):s.bindTexture(s.TEXTURE_2D,a.sourceTexture),s.useProgram(l.program),this.sendAttributeData(s,l.attributeLocations,a.aPosition),s.uniform1f(l.uniformLocations.uStepW,1/a.sourceWidth),s.uniform1f(l.uniformLocations.uStepH,1/a.sourceHeight),this.sendUniformData(s,l.uniformLocations),s.viewport(0,0,a.destinationWidth,a.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(a,s,l){a.activeTexture(l),a.bindTexture(a.TEXTURE_2D,s),a.activeTexture(a.TEXTURE0)},unbindAdditionalTexture:function(a,s){a.activeTexture(s),a.bindTexture(a.TEXTURE_2D,null),a.activeTexture(a.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(a){this[this.mainParameter]=a},sendUniformData:function(){},createHelpLayer:function(a){if(!a.helpLayer){var s=document.createElement("canvas");s.width=a.sourceWidth,s.height=a.sourceHeight,a.helpLayer=s}},toObject:function(){var a={type:this.type},s=this.mainParameter;return s&&(a[s]=this[s]),a},toJSON:function(){return this.toObject()}}),y.Image.filters.BaseFilter.fromObject=function(a,s){var l=new y.Image.filters[a.type](a);return s&&s(l),l},function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.ColorMatrix=u(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var o,c,_,f,g,m=r.imageData.data,S=m.length,w=this.matrix,I=this.colorsOnly;for(g=0;g<S;g+=4)o=m[g],c=m[g+1],_=m[g+2],I?(m[g]=o*w[0]+c*w[1]+_*w[2]+255*w[4],m[g+1]=o*w[5]+c*w[6]+_*w[7]+255*w[9],m[g+2]=o*w[10]+c*w[11]+_*w[12]+255*w[14]):(f=m[g+3],m[g]=o*w[0]+c*w[1]+_*w[2]+f*w[3]+255*w[4],m[g+1]=o*w[5]+c*w[6]+_*w[7]+f*w[8]+255*w[9],m[g+2]=o*w[10]+c*w[11]+_*w[12]+f*w[13]+255*w[14],m[g+3]=o*w[15]+c*w[16]+_*w[17]+f*w[18]+255*w[19])},getUniformLocations:function(r,o){return{uColorMatrix:r.getUniformLocation(o,"uColorMatrix"),uConstants:r.getUniformLocation(o,"uConstants")}},sendUniformData:function(r,o){var c=this.matrix,_=[c[0],c[1],c[2],c[3],c[5],c[6],c[7],c[8],c[10],c[11],c[12],c[13],c[15],c[16],c[17],c[18]],f=[c[4],c[9],c[14],c[19]];r.uniformMatrix4fv(o.uColorMatrix,!1,_),r.uniform4fv(o.uConstants,f)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Brightness=u(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var o,c=r.imageData.data,_=c.length,f=Math.round(255*this.brightness);for(o=0;o<_;o+=4)c[o]=c[o]+f,c[o+1]=c[o+1]+f,c[o+2]=c[o+2]+f}},getUniformLocations:function(r,o){return{uBrightness:r.getUniformLocation(o,"uBrightness")}},sendUniformData:function(r,o){r.uniform1f(o.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.Image.filters,r=s.util.createClass;u.Convolute=r(u.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(o){var c=Math.sqrt(this.matrix.length),_=this.type+"_"+c+"_"+(this.opaque?1:0),f=this.fragmentSource[_];return o.programCache.hasOwnProperty(_)||(o.programCache[_]=this.createProgram(o.context,f)),o.programCache[_]},applyTo2d:function(o){var c,_,f,g,m,S,w,I,T,A,D,P,j,Z=o.imageData,X=Z.data,W=this.matrix,M=Math.round(Math.sqrt(W.length)),R=Math.floor(M/2),V=Z.width,q=Z.height,K=o.ctx.createImageData(V,q),B=K.data,F=this.opaque?1:0;for(D=0;D<q;D++)for(A=0;A<V;A++){for(m=4*(D*V+A),c=0,_=0,f=0,g=0,j=0;j<M;j++)for(P=0;P<M;P++)S=A+P-R,(w=D+j-R)<0||w>=q||S<0||S>=V||(I=4*(w*V+S),T=W[j*M+P],c+=X[I]*T,_+=X[I+1]*T,f+=X[I+2]*T,F||(g+=X[I+3]*T));B[m]=c,B[m+1]=_,B[m+2]=f,B[m+3]=F?X[m+3]:g}o.imageData=K},getUniformLocations:function(o,c){return{uMatrix:o.getUniformLocation(c,"uMatrix"),uOpaque:o.getUniformLocation(c,"uOpaque"),uHalfSize:o.getUniformLocation(c,"uHalfSize"),uSize:o.getUniformLocation(c,"uSize")}},sendUniformData:function(o,c){o.uniform1fv(c.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Grayscale=u(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var o,c,_=r.imageData.data,f=_.length,g=this.mode;for(o=0;o<f;o+=4)g==="average"?c=(_[o]+_[o+1]+_[o+2])/3:g==="lightness"?c=(Math.min(_[o],_[o+1],_[o+2])+Math.max(_[o],_[o+1],_[o+2]))/2:g==="luminosity"&&(c=.21*_[o]+.72*_[o+1]+.07*_[o+2]),_[o]=c,_[o+1]=c,_[o+2]=c},retrieveShader:function(r){var o=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(o)){var c=this.fragmentSource[this.mode];r.programCache[o]=this.createProgram(r.context,c)}return r.programCache[o]},getUniformLocations:function(r,o){return{uMode:r.getUniformLocation(o,"uMode")}},sendUniformData:function(r,o){r.uniform1i(o.uMode,1)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Invert=u(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var o,c=r.imageData.data,_=c.length;for(o=0;o<_;o+=4)c[o]=255-c[o],c[o+1]=255-c[o+1],c[o+2]=255-c[o+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,o){return{uInvert:r.getUniformLocation(o,"uInvert")}},sendUniformData:function(r,o){r.uniform1i(o.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.Image.filters,r=s.util.createClass;u.Noise=r(u.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(o){if(this.noise!==0){var c,_,f=o.imageData.data,g=f.length,m=this.noise;for(c=0,g=f.length;c<g;c+=4)_=(.5-Math.random())*m,f[c]+=_,f[c+1]+=_,f[c+2]+=_}},getUniformLocations:function(o,c){return{uNoise:o.getUniformLocation(c,"uNoise"),uSeed:o.getUniformLocation(c,"uSeed")}},sendUniformData:function(o,c){o.uniform1f(c.uNoise,this.noise/255),o.uniform1f(c.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Pixelate=u(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var o,c,_,f,g,m,S,w,I,T,A,D=r.imageData,P=D.data,j=D.height,Z=D.width;for(c=0;c<j;c+=this.blocksize)for(_=0;_<Z;_+=this.blocksize)for(f=P[o=4*c*Z+4*_],g=P[o+1],m=P[o+2],S=P[o+3],T=Math.min(c+this.blocksize,j),A=Math.min(_+this.blocksize,Z),w=c;w<T;w++)for(I=_;I<A;I++)P[o=4*w*Z+4*I]=f,P[o+1]=g,P[o+2]=m,P[o+3]=S},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,o){return{uBlocksize:r.getUniformLocation(o,"uBlocksize"),uStepW:r.getUniformLocation(o,"uStepW"),uStepH:r.getUniformLocation(o,"uStepH")}},sendUniformData:function(r,o){r.uniform1f(o.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.extend,u=s.Image.filters,r=s.util.createClass;u.RemoveColor=r(u.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(o){var c,_,f,g,m=o.imageData.data,S=255*this.distance,w=new s.Color(this.color).getSource(),I=[w[0]-S,w[1]-S,w[2]-S],T=[w[0]+S,w[1]+S,w[2]+S];for(c=0;c<m.length;c+=4)_=m[c],f=m[c+1],g=m[c+2],_>I[0]&&f>I[1]&&g>I[2]&&_<T[0]&&f<T[1]&&g<T[2]&&(m[c+3]=0)},getUniformLocations:function(o,c){return{uLow:o.getUniformLocation(c,"uLow"),uHigh:o.getUniformLocation(c,"uHigh")}},sendUniformData:function(o,c){var _=new s.Color(this.color).getSource(),f=parseFloat(this.distance),g=[0+_[0]/255-f,0+_[1]/255-f,0+_[2]/255-f,1],m=[_[0]/255+f,_[1]/255+f,_[2]/255+f,1];o.uniform4fv(c.uLow,g),o.uniform4fv(c.uHigh,m)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var o in r)l[o]=u(l.ColorMatrix,{type:o,matrix:r[o],mainParameter:!1,colorsOnly:!0}),s.Image.filters[o].fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric,l=s.Image.filters,u=s.util.createClass;l.BlendColor=u(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var o,c=this.type+"_"+this.mode;return r.programCache.hasOwnProperty(c)||(o=this.buildSource(this.mode),r.programCache[c]=this.createProgram(r.context,o)),r.programCache[c]},applyTo2d:function(r){var o,c,_,f,g,m,S,w=r.imageData.data,I=w.length,T=1-this.alpha;o=(S=new s.Color(this.color).getSource())[0]*this.alpha,c=S[1]*this.alpha,_=S[2]*this.alpha;for(var A=0;A<I;A+=4)switch(f=w[A],g=w[A+1],m=w[A+2],this.mode){case"multiply":w[A]=f*o/255,w[A+1]=g*c/255,w[A+2]=m*_/255;break;case"screen":w[A]=255-(255-f)*(255-o)/255,w[A+1]=255-(255-g)*(255-c)/255,w[A+2]=255-(255-m)*(255-_)/255;break;case"add":w[A]=f+o,w[A+1]=g+c,w[A+2]=m+_;break;case"diff":case"difference":w[A]=Math.abs(f-o),w[A+1]=Math.abs(g-c),w[A+2]=Math.abs(m-_);break;case"subtract":w[A]=f-o,w[A+1]=g-c,w[A+2]=m-_;break;case"darken":w[A]=Math.min(f,o),w[A+1]=Math.min(g,c),w[A+2]=Math.min(m,_);break;case"lighten":w[A]=Math.max(f,o),w[A+1]=Math.max(g,c),w[A+2]=Math.max(m,_);break;case"overlay":w[A]=o<128?2*f*o/255:255-2*(255-f)*(255-o)/255,w[A+1]=c<128?2*g*c/255:255-2*(255-g)*(255-c)/255,w[A+2]=_<128?2*m*_/255:255-2*(255-m)*(255-_)/255;break;case"exclusion":w[A]=o+f-2*o*f/255,w[A+1]=c+g-2*c*g/255,w[A+2]=_+m-2*_*m/255;break;case"tint":w[A]=o+f*T,w[A+1]=c+g*T,w[A+2]=_+m*T}},getUniformLocations:function(r,o){return{uColor:r.getUniformLocation(o,"uColor")}},sendUniformData:function(r,o){var c=new s.Color(this.color).getSource();c[0]=this.alpha*c[0]/255,c[1]=this.alpha*c[1]/255,c[2]=this.alpha*c[2]/255,c[3]=this.alpha,r.uniform4fv(o.uColor,c)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric,l=s.Image.filters,u=s.util.createClass;l.BlendImage=u(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var o=this.type+"_"+this.mode,c=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(o)||(r.programCache[o]=this.createProgram(r.context,c)),r.programCache[o]},applyToWebGL:function(r){var o=r.context,c=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(o,c,o.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(o,o.TEXTURE1)},createTexture:function(r,o){return r.getCachedTexture(o.cacheKey,o._element)},calculateMatrix:function(){var r=this.image,o=r._element.width,c=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/o,-r.top/c,1]},applyTo2d:function(r){var o,c,_,f,g,m,S,w,I,T,A,D=r.imageData,P=r.filterBackend.resources,j=D.data,Z=j.length,X=D.width,W=D.height,M=this.image;P.blendImage||(P.blendImage=s.util.createCanvasElement()),T=(I=P.blendImage).getContext("2d"),I.width!==X||I.height!==W?(I.width=X,I.height=W):T.clearRect(0,0,X,W),T.setTransform(M.scaleX,0,0,M.scaleY,M.left,M.top),T.drawImage(M._element,0,0,X,W),A=T.getImageData(0,0,X,W).data;for(var R=0;R<Z;R+=4)switch(g=j[R],m=j[R+1],S=j[R+2],w=j[R+3],o=A[R],c=A[R+1],_=A[R+2],f=A[R+3],this.mode){case"multiply":j[R]=g*o/255,j[R+1]=m*c/255,j[R+2]=S*_/255,j[R+3]=w*f/255;break;case"mask":j[R+3]=f}},getUniformLocations:function(r,o){return{uTransformMatrix:r.getUniformLocation(o,"uTransformMatrix"),uImage:r.getUniformLocation(o,"uImage")}},sendUniformData:function(r,o){var c=this.calculateMatrix();r.uniform1i(o.uImage,1),r.uniformMatrix3fv(o.uTransformMatrix,!1,c)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(r,o){s.Image.fromObject(r.image,function(c){var _=s.util.object.clone(r);_.image=c,o(new s.Image.filters.BlendImage(_))})}}(e),function(a){var s=a.fabric||(a.fabric={}),l=Math.pow,u=Math.floor,r=Math.sqrt,o=Math.abs,c=Math.round,_=Math.sin,f=Math.ceil,g=s.Image.filters,m=s.util.createClass;g.Resize=m(g.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(S,w){return{uDelta:S.getUniformLocation(w,"uDelta"),uTaps:S.getUniformLocation(w,"uTaps")}},sendUniformData:function(S,w){S.uniform2fv(w.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),S.uniform1fv(w.uTaps,this.taps)},retrieveShader:function(S){var w=this.getFilterWindow(),I=this.type+"_"+w;if(!S.programCache.hasOwnProperty(I)){var T=this.generateShader(w);S.programCache[I]=this.createProgram(S.context,T)}return S.programCache[I]},getFilterWindow:function(){var S=this.tempScale;return Math.ceil(this.lanczosLobes/S)},getTaps:function(){for(var S=this.lanczosCreate(this.lanczosLobes),w=this.tempScale,I=this.getFilterWindow(),T=new Array(I),A=1;A<=I;A++)T[A-1]=S(A*w);return T},generateShader:function(S){for(var w=new Array(S),I=this.fragmentSourceTOP,T=1;T<=S;T++)w[T-1]=T+".0 * uDelta";return I+="uniform float uTaps["+S+`];
`,I+=`void main() {
`,I+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,I+=`  float sum = 1.0;
`,w.forEach(function(A,D){I+="  color += texture2D(uTexture, vTexCoord + "+A+") * uTaps["+D+`];
`,I+="  color += texture2D(uTexture, vTexCoord - "+A+") * uTaps["+D+`];
`,I+="  sum += 2.0 * uTaps["+D+`];
`}),I+=`  gl_FragColor = color / sum;
`,I+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(S){S.webgl?(S.passes++,this.width=S.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=S.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),S.destinationWidth=this.dW,this._setupFrameBuffer(S),this.applyToWebGL(S),this._swapTextures(S),S.sourceWidth=S.destinationWidth,this.height=S.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),S.destinationHeight=this.dH,this._setupFrameBuffer(S),this.applyToWebGL(S),this._swapTextures(S),S.sourceHeight=S.destinationHeight):this.applyTo2d(S)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(S){return function(w){if(w>=S||w<=-S)return 0;if(w<11920929e-14&&w>-11920929e-14)return 1;var I=(w*=Math.PI)/S;return _(w)/w*_(I)/I}},applyTo2d:function(S){var w=S.imageData,I=this.scaleX,T=this.scaleY;this.rcpScaleX=1/I,this.rcpScaleY=1/T;var A,D=w.width,P=w.height,j=c(D*I),Z=c(P*T);this.resizeType==="sliceHack"?A=this.sliceByTwo(S,D,P,j,Z):this.resizeType==="hermite"?A=this.hermiteFastResize(S,D,P,j,Z):this.resizeType==="bilinear"?A=this.bilinearFiltering(S,D,P,j,Z):this.resizeType==="lanczos"&&(A=this.lanczosResize(S,D,P,j,Z)),S.imageData=A},sliceByTwo:function(S,w,I,T,A){var D,P,j=S.imageData,Z=.5,X=!1,W=!1,M=w*Z,R=I*Z,V=s.filterBackend.resources,q=0,K=0,B=w,F=0;for(V.sliceByTwo||(V.sliceByTwo=document.createElement("canvas")),((D=V.sliceByTwo).width<1.5*w||D.height<I)&&(D.width=1.5*w,D.height=I),(P=D.getContext("2d")).clearRect(0,0,1.5*w,I),P.putImageData(j,0,0),T=u(T),A=u(A);!X||!W;)w=M,I=R,T<u(M*Z)?M=u(M*Z):(M=T,X=!0),A<u(R*Z)?R=u(R*Z):(R=A,W=!0),P.drawImage(D,q,K,w,I,B,F,M,R),q=B,K=F,F+=R;return P.getImageData(q,K,T,A)},lanczosResize:function(S,w,I,T,A){var D=S.imageData.data,P=S.ctx.createImageData(T,A),j=P.data,Z=this.lanczosCreate(this.lanczosLobes),X=this.rcpScaleX,W=this.rcpScaleY,M=2/this.rcpScaleX,R=2/this.rcpScaleY,V=f(X*this.lanczosLobes/2),q=f(W*this.lanczosLobes/2),K={},B={},F={};return function z(Q){var $,ie,ce,oe,se,le,ae,he,pe,ue,ye;for(B.x=(Q+.5)*X,F.x=u(B.x),$=0;$<A;$++){for(B.y=($+.5)*W,F.y=u(B.y),se=0,le=0,ae=0,he=0,pe=0,ie=F.x-V;ie<=F.x+V;ie++)if(!(ie<0||ie>=w)){ue=u(1e3*o(ie-B.x)),K[ue]||(K[ue]={});for(var xe=F.y-q;xe<=F.y+q;xe++)xe<0||xe>=I||(ye=u(1e3*o(xe-B.y)),K[ue][ye]||(K[ue][ye]=Z(r(l(ue*M,2)+l(ye*R,2))/1e3)),(ce=K[ue][ye])>0&&(se+=ce,le+=ce*D[oe=4*(xe*w+ie)],ae+=ce*D[oe+1],he+=ce*D[oe+2],pe+=ce*D[oe+3]))}j[oe=4*($*T+Q)]=le/se,j[oe+1]=ae/se,j[oe+2]=he/se,j[oe+3]=pe/se}return++Q<T?z(Q):P}(0)},bilinearFiltering:function(S,w,I,T,A){var D,P,j,Z,X,W,M,R,V,q=0,K=this.rcpScaleX,B=this.rcpScaleY,F=4*(w-1),z=S.imageData.data,Q=S.ctx.createImageData(T,A),$=Q.data;for(j=0;j<A;j++)for(Z=0;Z<T;Z++)for(X=K*Z-(D=u(K*Z)),W=B*j-(P=u(B*j)),V=4*(P*w+D),M=0;M<4;M++)R=z[V+M]*(1-X)*(1-W)+z[V+4+M]*X*(1-W)+z[V+F+M]*W*(1-X)+z[V+F+4+M]*X*W,$[q++]=R;return Q},hermiteFastResize:function(S,w,I,T,A){for(var D=this.rcpScaleX,P=this.rcpScaleY,j=f(D/2),Z=f(P/2),X=S.imageData.data,W=S.ctx.createImageData(T,A),M=W.data,R=0;R<A;R++)for(var V=0;V<T;V++){for(var q=4*(V+R*T),K=0,B=0,F=0,z=0,Q=0,$=0,ie=0,ce=(R+.5)*P,oe=u(R*P);oe<(R+1)*P;oe++)for(var se=o(ce-(oe+.5))/Z,le=(V+.5)*D,ae=se*se,he=u(V*D);he<(V+1)*D;he++){var pe=o(le-(he+.5))/j,ue=r(ae+pe*pe);ue>1&&ue<-1||(K=2*ue*ue*ue-3*ue*ue+1)>0&&(ie+=K*X[3+(pe=4*(he+oe*w))],F+=K,X[pe+3]<255&&(K=K*X[pe+3]/250),z+=K*X[pe],Q+=K*X[pe+1],$+=K*X[pe+2],B+=K)}M[q]=z/B,M[q+1]=Q/B,M[q+2]=$/B,M[q+3]=ie/F}return W},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Contrast=u(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var o,c=r.imageData.data,_=c.length,f=Math.floor(255*this.contrast),g=259*(f+255)/(255*(259-f));for(o=0;o<_;o+=4)c[o]=g*(c[o]-128)+128,c[o+1]=g*(c[o+1]-128)+128,c[o+2]=g*(c[o+2]-128)+128}},getUniformLocations:function(r,o){return{uContrast:r.getUniformLocation(o,"uContrast")}},sendUniformData:function(r,o){r.uniform1f(o.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Saturation=u(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var o,c,_=r.imageData.data,f=_.length,g=-this.saturation;for(o=0;o<f;o+=4)c=Math.max(_[o],_[o+1],_[o+2]),_[o]+=c!==_[o]?(c-_[o])*g:0,_[o+1]+=c!==_[o+1]?(c-_[o+1])*g:0,_[o+2]+=c!==_[o+2]?(c-_[o+2])*g:0}},getUniformLocations:function(r,o){return{uSaturation:r.getUniformLocation(o,"uSaturation")}},sendUniformData:function(r,o){r.uniform1f(o.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Vibrance=u(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var o,c,_,f,g=r.imageData.data,m=g.length,S=-this.vibrance;for(o=0;o<m;o+=4)c=Math.max(g[o],g[o+1],g[o+2]),_=(g[o]+g[o+1]+g[o+2])/3,f=2*Math.abs(c-_)/255*S,g[o]+=c!==g[o]?(c-g[o])*f:0,g[o+1]+=c!==g[o+1]?(c-g[o+1])*f:0,g[o+2]+=c!==g[o+2]?(c-g[o+2])*f:0}},getUniformLocations:function(r,o){return{uVibrance:r.getUniformLocation(o,"uVibrance")}},sendUniformData:function(r,o){r.uniform1f(o.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Blur=u(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var o,c,_=r.filterBackend.resources,f=r.imageData.width,g=r.imageData.height;_.blurLayer1||(_.blurLayer1=s.util.createCanvasElement(),_.blurLayer2=s.util.createCanvasElement()),o=_.blurLayer1,c=_.blurLayer2,o.width===f&&o.height===g||(c.width=o.width=f,c.height=o.height=g);var m,S,w,I,T=o.getContext("2d"),A=c.getContext("2d"),D=.06*this.blur*.5;for(T.putImageData(r.imageData,0,0),A.clearRect(0,0,f,g),I=-15;I<=15;I++)w=D*(S=I/15)*f+(m=(Math.random()-.5)/4),A.globalAlpha=1-Math.abs(S),A.drawImage(o,w,m),T.drawImage(c,0,0),A.globalAlpha=1,A.clearRect(0,0,c.width,c.height);for(I=-15;I<=15;I++)w=D*(S=I/15)*g+(m=(Math.random()-.5)/4),A.globalAlpha=1-Math.abs(S),A.drawImage(o,m,w),T.drawImage(c,0,0),A.globalAlpha=1,A.clearRect(0,0,c.width,c.height);r.ctx.drawImage(o,0,0);var P=r.ctx.getImageData(0,0,o.width,o.height);return T.globalAlpha=1,T.clearRect(0,0,o.width,o.height),P},getUniformLocations:function(r,o){return{delta:r.getUniformLocation(o,"uDelta")}},sendUniformData:function(r,o){var c=this.chooseRightDelta();r.uniform2fv(o.delta,c)},chooseRightDelta:function(){var r,o=1,c=[0,0];return this.horizontal?this.aspectRatio>1&&(o=1/this.aspectRatio):this.aspectRatio<1&&(o=this.aspectRatio),r=o*this.blur*.12,this.horizontal?c[0]=r:c[1]=r,c}}),l.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Gamma=u(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var o,c=r.imageData.data,_=this.gamma,f=c.length,g=1/_[0],m=1/_[1],S=1/_[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),o=0,f=256;o<f;o++)this.rVals[o]=255*Math.pow(o/255,g),this.gVals[o]=255*Math.pow(o/255,m),this.bVals[o]=255*Math.pow(o/255,S);for(o=0,f=c.length;o<f;o+=4)c[o]=this.rVals[c[o]],c[o+1]=this.gVals[c[o+1]],c[o+2]=this.bVals[c[o+2]]},getUniformLocations:function(r,o){return{uGamma:r.getUniformLocation(o,"uGamma")}},sendUniformData:function(r,o){r.uniform3fv(o.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.Composed=u(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(o){o.applyTo(r)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(r,o){var c=(r.subFilters||[]).map(function(f){return new s.Image.filters[f.type](f)}),_=new s.Image.filters.Composed({subFilters:c});return o&&o(_),_}}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.Image.filters,u=s.util.createClass;l.HueRotation=u(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,o=s.util.cos(r),c=s.util.sin(r),_=1/3,f=Math.sqrt(_)*c,g=1-o;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=o+g/3,this.matrix[1]=_*g-f,this.matrix[2]=_*g+f,this.matrix[5]=_*g+f,this.matrix[6]=o+_*g,this.matrix[7]=_*g-f,this.matrix[10]=_*g-f,this.matrix[11]=_*g+f,this.matrix[12]=o+_*g},isNeutralState:function(r){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,r)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(a){var s=a.fabric||(a.fabric={}),l=s.util.object.clone;if(s.Text)s.warn("fabric.Text is already defined");else{var u="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(u),cacheProperties:s.Object.prototype.cacheProperties.concat(u),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,o){this.styles=o&&o.styles||{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",o),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=s.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,o,c,_,f,g,m,S=0,w=this._textLines.length;S<w;S++)if((this.textAlign==="justify"||S!==w-1&&!this.isEndOfWrapping(S))&&(_=0,f=this._textLines[S],(o=this.getLineWidth(S))<this.width&&(m=this.textLines[S].match(this._reSpacesAndTabs)))){c=m.length,r=(this.width-o)/c;for(var I=0,T=f.length;I<=T;I++)g=this.__charBounds[S][I],this._reSpaceAndTab.test(f[I])?(g.width+=r,g.kernedWidth+=r,g.left+=_,_+=r):g.left+=_}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),o=this.fontSize;return r.width+=o*r.zoomX,r.height+=o*r.zoomY,r},_render:function(r){var o=this.path;o&&!o.isNotVisible()&&o._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,o,c){if(r.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom"}r.font=this._getFontDeclaration(o,c)},calcTextWidth:function(){for(var r=this.getLineWidth(0),o=1,c=this._textLines.length;o<c;o++){var _=this.getLineWidth(o);_>r&&(r=_)}return r},_renderTextLine:function(r,o,c,_,f,g){this._renderChars(r,o,c,_,f,g)},_renderTextLinesBackground:function(r){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var o,c,_,f,g,m,S,w=r.fillStyle,I=this._getLeftOffset(),T=this._getTopOffset(),A=0,D=0,P=this.path,j=0,Z=this._textLines.length;j<Z;j++)if(o=this.getHeightOfLine(j),this.textBackgroundColor||this.styleHas("textBackgroundColor",j)){_=this._textLines[j],c=this._getLineLeftOffset(j),D=0,A=0,f=this.getValueOfPropertyAt(j,0,"textBackgroundColor");for(var X=0,W=_.length;X<W;X++)g=this.__charBounds[j][X],m=this.getValueOfPropertyAt(j,X,"textBackgroundColor"),P?(r.save(),r.translate(g.renderLeft,g.renderTop),r.rotate(g.angle),r.fillStyle=m,m&&r.fillRect(-g.width/2,-o/this.lineHeight*(1-this._fontSizeFraction),g.width,o/this.lineHeight),r.restore()):m!==f?(S=I+c+A,this.direction==="rtl"&&(S=this.width-S-D),r.fillStyle=f,f&&r.fillRect(S,T,D,o/this.lineHeight),A=g.left,D=g.width,f=m):D+=g.kernedWidth;m&&!P&&(S=I+c+A,this.direction==="rtl"&&(S=this.width-S-D),r.fillStyle=m,r.fillRect(S,T,D,o/this.lineHeight)),T+=o}else T+=o;r.fillStyle=w,this._removeShadow(r)}},getFontCache:function(r){var o=r.fontFamily.toLowerCase();s.charWidthsCache[o]||(s.charWidthsCache[o]={});var c=s.charWidthsCache[o],_=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return c[_]||(c[_]={}),c[_]},_measureChar:function(r,o,c,_){var f,g,m,S,w=this.getFontCache(o),I=c+r,T=this._getFontDeclaration(o)===this._getFontDeclaration(_),A=o.fontSize/this.CACHE_FONT_SIZE;if(c&&w[c]!==void 0&&(m=w[c]),w[r]!==void 0&&(S=f=w[r]),T&&w[I]!==void 0&&(S=(g=w[I])-m),f===void 0||m===void 0||g===void 0){var D=this.getMeasuringContext();this._setTextStyles(D,o,!0)}return f===void 0&&(S=f=D.measureText(r).width,w[r]=f),m===void 0&&T&&c&&(m=D.measureText(c).width,w[c]=m),T&&g===void 0&&(g=D.measureText(I).width,w[I]=g,S=g-m),{width:f*A,kernedWidth:S*A}},getHeightOfChar:function(r,o){return this.getValueOfPropertyAt(r,o,"fontSize")},measureLine:function(r){var o=this._measureLine(r);return this.charSpacing!==0&&(o.width-=this._getWidthOfCharSpacing()),o.width<0&&(o.width=0),o},_measureLine:function(r){var o,c,_,f,g,m,S=0,w=this._textLines[r],I=new Array(w.length),T=0,A=this.path,D=this.pathSide==="right";for(this.__charBounds[r]=I,o=0;o<w.length;o++)c=w[o],f=this._getGraphemeBox(c,r,o,_),I[o]=f,S+=f.kernedWidth,_=c;if(I[o]={left:f?f.left+f.width:0,width:0,kernedWidth:0,height:this.fontSize},A){switch(m=A.segmentsInfo[A.segmentsInfo.length-1].length,(g=s.util.getPointOnPath(A.path,0,A.segmentsInfo)).x+=A.pathOffset.x,g.y+=A.pathOffset.y,this.textAlign){case"left":T=D?m-S:0;break;case"center":T=(m-S)/2;break;case"right":T=D?0:m-S}for(T+=this.pathStartOffset*(D?-1:1),o=D?w.length-1:0;D?o>=0:o<w.length;D?o--:o++)f=I[o],T>m?T%=m:T<0&&(T+=m),this._setGraphemeOnPath(T,f,g),T+=f.kernedWidth}return{width:S,numOfSpaces:0}},_setGraphemeOnPath:function(r,o,c){var _=r+o.kernedWidth/2,f=this.path,g=s.util.getPointOnPath(f.path,_,f.segmentsInfo);o.renderLeft=g.x-c.x,o.renderTop=g.y-c.y,o.angle=g.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,o,c,_,f){var g,m=this.getCompleteStyleDeclaration(o,c),S=_?this.getCompleteStyleDeclaration(o,c-1):{},w=this._measureChar(r,m,_,S),I=w.kernedWidth,T=w.width;this.charSpacing!==0&&(T+=g=this._getWidthOfCharSpacing(),I+=g);var A={width:T,left:0,height:m.fontSize,kernedWidth:I,deltaY:m.deltaY};if(c>0&&!f){var D=this.__charBounds[o][c-1];A.left=D.left+D.width+w.kernedWidth-w.width}return A},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var o=this._textLines[r],c=this.getHeightOfChar(r,0),_=1,f=o.length;_<f;_++)c=Math.max(this.getHeightOfChar(r,_),c);return this.__lineHeights[r]=c*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,o=0,c=0,_=this._textLines.length;c<_;c++)r=this.getHeightOfLine(c),o+=c===_-1?r/this.lineHeight:r;return o},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,o){r.save();for(var c=0,_=this._getLeftOffset(),f=this._getTopOffset(),g=0,m=this._textLines.length;g<m;g++){var S=this.getHeightOfLine(g),w=S/this.lineHeight,I=this._getLineLeftOffset(g);this._renderTextLine(o,r,this._textLines[g],_+I,f+c+w,g),c+=S}r.restore()},_renderTextFill:function(r){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,o,c,_,f,g){var m,S,w,I,T,A=this.getHeightOfLine(g),D=this.textAlign.indexOf("justify")!==-1,P="",j=0,Z=this.path,X=!D&&this.charSpacing===0&&this.isEmptyStyles(g)&&!Z,W=this.direction==="ltr",M=this.direction==="ltr"?1:-1,R=o.canvas.getAttribute("dir");if(o.save(),R!==this.direction&&(o.canvas.setAttribute("dir",W?"ltr":"rtl"),o.direction=W?"ltr":"rtl",o.textAlign=W?"left":"right"),f-=A*this._fontSizeFraction/this.lineHeight,X)return this._renderChar(r,o,g,0,c.join(""),_,f,A),void o.restore();for(var V=0,q=c.length-1;V<=q;V++)I=V===q||this.charSpacing||Z,P+=c[V],w=this.__charBounds[g][V],j===0?(_+=M*(w.kernedWidth-w.width),j+=w.width):j+=w.kernedWidth,D&&!I&&this._reSpaceAndTab.test(c[V])&&(I=!0),I||(m=m||this.getCompleteStyleDeclaration(g,V),S=this.getCompleteStyleDeclaration(g,V+1),I=this._hasStyleChanged(m,S)),I&&(Z?(o.save(),o.translate(w.renderLeft,w.renderTop),o.rotate(w.angle),this._renderChar(r,o,g,V,P,-j/2,0,A),o.restore()):(T=_,this._renderChar(r,o,g,V,P,T,f,A)),P="",m=S,_+=M*j,j=0);o.restore()},_applyPatternGradientTransformText:function(r){var o,c=s.util.createCanvasElement(),_=this.width+this.strokeWidth,f=this.height+this.strokeWidth;return c.width=_,c.height=f,(o=c.getContext("2d")).beginPath(),o.moveTo(0,0),o.lineTo(_,0),o.lineTo(_,f),o.lineTo(0,f),o.closePath(),o.translate(_/2,f/2),o.fillStyle=r.toLive(o),this._applyPatternGradientTransform(o,r),o.fill(),o.createPattern(c,"no-repeat")},handleFiller:function(r,o,c){var _,f;return c.toLive?c.gradientUnits==="percentage"||c.gradientTransform||c.patternTransform?(_=-this.width/2,f=-this.height/2,r.translate(_,f),r[o]=this._applyPatternGradientTransformText(c),{offsetX:_,offsetY:f}):(r[o]=c.toLive(r,this),this._applyPatternGradientTransform(r,c)):(r[o]=c,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,o){return r.lineWidth=o.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",o.stroke)},_setFillStyles:function(r,o){return this.handleFiller(r,"fillStyle",o.fill)},_renderChar:function(r,o,c,_,f,g,m){var S,w,I=this._getStyleDeclaration(c,_),T=this.getCompleteStyleDeclaration(c,_),A=r==="fillText"&&T.fill,D=r==="strokeText"&&T.stroke&&T.strokeWidth;(D||A)&&(o.save(),A&&(S=this._setFillStyles(o,T)),D&&(w=this._setStrokeStyles(o,T)),o.font=this._getFontDeclaration(T),I&&I.textBackgroundColor&&this._removeShadow(o),I&&I.deltaY&&(m+=I.deltaY),A&&o.fillText(f,g-S.offsetX,m-S.offsetY),D&&o.strokeText(f,g-w.offsetX,m-w.offsetY),o.restore())},setSuperscript:function(r,o){return this._setScript(r,o,this.superscript)},setSubscript:function(r,o){return this._setScript(r,o,this.subscript)},_setScript:function(r,o,c){var _=this.get2DCursorLocation(r,!0),f=this.getValueOfPropertyAt(_.lineIndex,_.charIndex,"fontSize"),g=this.getValueOfPropertyAt(_.lineIndex,_.charIndex,"deltaY"),m={fontSize:f*c.size,deltaY:g+f*c.baseline};return this.setSelectionStyles(m,r,o),this},_hasStyleChanged:function(r,o){return r.fill!==o.fill||r.stroke!==o.stroke||r.strokeWidth!==o.strokeWidth||r.fontSize!==o.fontSize||r.fontFamily!==o.fontFamily||r.fontWeight!==o.fontWeight||r.fontStyle!==o.fontStyle||r.deltaY!==o.deltaY},_hasStyleChangedForSvg:function(r,o){return this._hasStyleChanged(r,o)||r.overline!==o.overline||r.underline!==o.underline||r.linethrough!==o.linethrough},_getLineLeftOffset:function(r){var o=this.getLineWidth(r),c=this.width-o,_=this.textAlign,f=this.direction,g=0,m=this.isEndOfWrapping(r);return _==="justify"||_==="justify-center"&&!m||_==="justify-right"&&!m||_==="justify-left"&&!m?0:(_==="center"&&(g=c/2),_==="right"&&(g=c),_==="justify-center"&&(g=c/2),_==="justify-right"&&(g=c),f==="rtl"&&(g-=c),g)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var o=this.measureLine(r).width;return this.__lineWidths[r]=o,o},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,o,c){var _=this._getStyleDeclaration(r,o);return _&&_[c]!==void 0?_[c]:this[c]},_renderTextDecoration:function(r,o){if(this[o]||this.styleHas(o)){for(var c,_,f,g,m,S,w,I,T,A,D,P,j,Z,X,W,M=this._getLeftOffset(),R=this._getTopOffset(),V=this.path,q=this._getWidthOfCharSpacing(),K=this.offsets[o],B=0,F=this._textLines.length;B<F;B++)if(c=this.getHeightOfLine(B),this[o]||this.styleHas(o,B)){w=this._textLines[B],Z=c/this.lineHeight,g=this._getLineLeftOffset(B),A=0,D=0,I=this.getValueOfPropertyAt(B,0,o),W=this.getValueOfPropertyAt(B,0,"fill"),T=R+Z*(1-this._fontSizeFraction),_=this.getHeightOfChar(B,0),m=this.getValueOfPropertyAt(B,0,"deltaY");for(var z=0,Q=w.length;z<Q;z++)if(P=this.__charBounds[B][z],j=this.getValueOfPropertyAt(B,z,o),X=this.getValueOfPropertyAt(B,z,"fill"),f=this.getHeightOfChar(B,z),S=this.getValueOfPropertyAt(B,z,"deltaY"),V&&j&&X)r.save(),r.fillStyle=W,r.translate(P.renderLeft,P.renderTop),r.rotate(P.angle),r.fillRect(-P.kernedWidth/2,K*f+S,P.kernedWidth,this.fontSize/15),r.restore();else if((j!==I||X!==W||f!==_||S!==m)&&D>0){var $=M+g+A;this.direction==="rtl"&&($=this.width-$-D),I&&W&&(r.fillStyle=W,r.fillRect($,T+K*_+m,D,this.fontSize/15)),A=P.left,D=P.width,I=j,W=X,_=f,m=S}else D+=P.kernedWidth;$=M+g+A,this.direction==="rtl"&&($=this.width-$-D),r.fillStyle=X,j&&X&&r.fillRect($,T+K*_+m,D-q,this.fontSize/15),R+=c}else R+=c;this._removeShadow(r)}},_getFontDeclaration:function(r,o){var c=r||this,_=this.fontFamily,f=s.Text.genericFonts.indexOf(_.toLowerCase())>-1,g=_===void 0||_.indexOf("'")>-1||_.indexOf(",")>-1||_.indexOf('"')>-1||f?c.fontFamily:'"'+c.fontFamily+'"';return[s.isLikelyNode?c.fontWeight:c.fontStyle,s.isLikelyNode?c.fontStyle:c.fontWeight,o?this.CACHE_FONT_SIZE+"px":c.fontSize+"px",g].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var o=r.split(this._reNewline),c=new Array(o.length),_=[`
`],f=[],g=0;g<o.length;g++)c[g]=s.util.string.graphemeSplit(o[g]),f=f.concat(c[g],_);return f.pop(),{_unwrappedLines:c,lines:o,graphemeText:f,graphemeLines:c}},toObject:function(r){var o=u.concat(r),c=this.callSuper("toObject",o);return c.styles=l(this.styles,!0),c.path&&(c.path=this.path.toObject()),c},set:function(r,o){this.callSuper("set",r,o);var c=!1,_=!1;if(typeof r=="object")for(var f in r)f==="path"&&this.setPathInfo(),c=c||this._dimensionAffectingProps.indexOf(f)!==-1,_=_||f==="path";else c=this._dimensionAffectingProps.indexOf(r)!==-1,_=r==="path";return _&&this.setPathInfo(),c&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(r,o,c){if(!r)return o(null);var _=s.parseAttributes(r,s.Text.ATTRIBUTE_NAMES),f=_.textAnchor||"left";if((c=s.util.object.extend(c?l(c):{},_)).top=c.top||0,c.left=c.left||0,_.textDecoration){var g=_.textDecoration;g.indexOf("underline")!==-1&&(c.underline=!0),g.indexOf("overline")!==-1&&(c.overline=!0),g.indexOf("line-through")!==-1&&(c.linethrough=!0),delete c.textDecoration}"dx"in _&&(c.left+=_.dx),"dy"in _&&(c.top+=_.dy),"fontSize"in c||(c.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var m="";"textContent"in r?m=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(m=r.firstChild.data),m=m.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var S=c.strokeWidth;c.strokeWidth=0;var w=new s.Text(m,c),I=w.getScaledHeight()/w.height,T=((w.height+w.strokeWidth)*w.lineHeight-w.height)*I,A=w.getScaledHeight()+T,D=0;f==="center"&&(D=w.getScaledWidth()/2),f==="right"&&(D=w.getScaledWidth()),w.set({left:w.left-D,top:w.top-(A-w.fontSize*(.07+w._fontSizeFraction))/w.lineHeight,strokeWidth:S!==void 0?S:1}),o(w)},s.Text.fromObject=function(r,o){var c=l(r),_=r.path;return delete c.path,s.Object._fromObject("Text",c,function(f){_?s.Object._fromObject("Path",_,function(g){f.set("path",g),o(f)},"path"):o(f)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}}(e),y.util.object.extend(y.Text.prototype,{isEmptyStyles:function(a){if(!this.styles||a!==void 0&&!this.styles[a])return!0;var s=a===void 0?this.styles:{line:this.styles[a]};for(var l in s)for(var u in s[l])for(var r in s[l][u])return!1;return!0},styleHas:function(a,s){if(!this.styles||!a||a===""||s!==void 0&&!this.styles[s])return!1;var l=s===void 0?this.styles:{0:this.styles[s]};for(var u in l)for(var r in l[u])if(l[u][r][a]!==void 0)return!0;return!1},cleanStyle:function(a){if(!this.styles||!a||a==="")return!1;var s,l,u=this.styles,r=0,o=!0,c=0;for(var _ in u){for(var f in s=0,u[_]){var g;r++,(g=u[_][f]).hasOwnProperty(a)?(l?g[a]!==l&&(o=!1):l=g[a],g[a]===this[a]&&delete g[a]):o=!1,Object.keys(g).length!==0?s++:delete u[_][f]}s===0&&delete u[_]}for(var m=0;m<this._textLines.length;m++)c+=this._textLines[m].length;o&&r===c&&(this[a]=l,this.removeStyle(a))},removeStyle:function(a){if(this.styles&&a&&a!==""){var s,l,u,r=this.styles;for(l in r){for(u in s=r[l])delete s[u][a],Object.keys(s[u]).length===0&&delete s[u];Object.keys(s).length===0&&delete r[l]}}},_extendStyles:function(a,s){var l=this.get2DCursorLocation(a);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),y.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),s)},get2DCursorLocation:function(a,s){a===void 0&&(a=this.selectionStart);for(var l=s?this._unwrappedTextLines:this._textLines,u=l.length,r=0;r<u;r++){if(a<=l[r].length)return{lineIndex:r,charIndex:a};a-=l[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:l[r-1].length<a?l[r-1].length:a}},getSelectionStyles:function(a,s,l){a===void 0&&(a=this.selectionStart||0),s===void 0&&(s=this.selectionEnd||a);for(var u=[],r=a;r<s;r++)u.push(this.getStyleAtPosition(r,l));return u},getStyleAtPosition:function(a,s){var l=this.get2DCursorLocation(a);return(s?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex))||{}},setSelectionStyles:function(a,s,l){s===void 0&&(s=this.selectionStart||0),l===void 0&&(l=this.selectionEnd||s);for(var u=s;u<l;u++)this._extendStyles(u,a);return this._forceClearCache=!0,this},_getStyleDeclaration:function(a,s){var l=this.styles&&this.styles[a];return l?l[s]:null},getCompleteStyleDeclaration:function(a,s){for(var l,u=this._getStyleDeclaration(a,s)||{},r={},o=0;o<this._styleProperties.length;o++)r[l=this._styleProperties[o]]=u[l]===void 0?this[l]:u[l];return r},_setStyleDeclaration:function(a,s,l){this.styles[a][s]=l},_deleteStyleDeclaration:function(a,s){delete this.styles[a][s]},_getLineStyle:function(a){return!!this.styles[a]},_setLineStyle:function(a){this.styles[a]={}},_deleteLineStyle:function(a){delete this.styles[a]}}),function(){function a(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}y.IText=y.util.createClass(y.Text,y.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,l){this.callSuper("initialize",s,l),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,l){this[s]!==l&&(this._fireSelectionChanged(),this[s]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var l=this.canvas.contextTop,u=this.canvas.viewportTransform;l.save(),l.transform(u[0],u[1],u[2],u[3],u[4],u[5]),this.transform(l),this._clearTextArea(l),s||l.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var s=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,l):this.renderSelection(s,l),l.restore()}},_clearTextArea:function(s){var l=this.width+4,u=this.height+4;s.clearRect(-l/2,-u/2,l,u)},_getCursorBoundaries:function(s){s===void 0&&(s=this.selectionStart);var l=this._getLeftOffset(),u=this._getTopOffset(),r=this._getCursorBoundariesOffsets(s);return{left:l,top:u,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,u,r,o,c=0,_=0,f=this.get2DCursorLocation(s);r=f.charIndex,u=f.lineIndex;for(var g=0;g<u;g++)c+=this.getHeightOfLine(g);l=this._getLineLeftOffset(u);var m=this.__charBounds[u][r];return m&&(_=m.left),this.charSpacing!==0&&r===this._textLines[u].length&&(_-=this._getWidthOfCharSpacing()),o={top:c,left:l+(_>0?_:0)},this.direction==="rtl"&&(o.left*=-1),this.cursorOffsetCache=o,this.cursorOffsetCache},renderCursor:function(s,l){var u=this.get2DCursorLocation(),r=u.lineIndex,o=u.charIndex>0?u.charIndex-1:0,c=this.getValueOfPropertyAt(r,o,"fontSize"),_=this.scaleX*this.canvas.getZoom(),f=this.cursorWidth/_,g=s.topOffset,m=this.getValueOfPropertyAt(r,o,"deltaY");g+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-c*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,o,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(s.left+s.leftOffset-f/2,g+s.top+m,f,c)},renderSelection:function(s,l){for(var u=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,o=this.textAlign.indexOf("justify")!==-1,c=this.get2DCursorLocation(u),_=this.get2DCursorLocation(r),f=c.lineIndex,g=_.lineIndex,m=c.charIndex<0?0:c.charIndex,S=_.charIndex<0?0:_.charIndex,w=f;w<=g;w++){var I,T=this._getLineLeftOffset(w)||0,A=this.getHeightOfLine(w),D=0,P=0;if(w===f&&(D=this.__charBounds[f][m].left),w>=f&&w<g)P=o&&!this.isEndOfWrapping(w)?this.width:this.getLineWidth(w)||5;else if(w===g)if(S===0)P=this.__charBounds[g][S].left;else{var j=this._getWidthOfCharSpacing();P=this.__charBounds[g][S-1].left+this.__charBounds[g][S-1].width-j}I=A,(this.lineHeight<1||w===g&&this.lineHeight>1)&&(A/=this.lineHeight);var Z=s.left+T+D,X=P-D,W=A,M=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",W=1,M=A):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(Z=this.width-Z-X),l.fillRect(Z,s.top+s.topOffset+M,X,W),s.topOffset+=I}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),l=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:l}}}),y.IText.fromObject=function(s,l){if(a(s),s.styles)for(var u in s.styles)for(var r in s.styles[u])a(s.styles[u][r]);y.Object._fromObject("IText",s,l,"text")}}(),_e=y.util.object.clone,y.util.object.extend(y.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var a=this;this.on("added",function(){var s=a.canvas;s&&(s._hasITextHandlers||(s._hasITextHandlers=!0,a._initCanvasHandlers(s)),s._iTextInstances=s._iTextInstances||[],s._iTextInstances.push(a))})},initRemovedHandler:function(){var a=this;this.on("removed",function(){var s=a.canvas;s&&(s._iTextInstances=s._iTextInstances||[],y.util.removeFromArray(s._iTextInstances,a),s._iTextInstances.length===0&&(s._hasITextHandlers=!1,a._removeCanvasHandlers(s)))})},_initCanvasHandlers:function(a){a._mouseUpITextHandler=function(){a._iTextInstances&&a._iTextInstances.forEach(function(s){s.__isMousedown=!1})},a.on("mouse:up",a._mouseUpITextHandler)},_removeCanvasHandlers:function(a){a.off("mouse:up",a._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(a,s,l,u){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},a.animate("_currentCursorOpacity",s,{duration:l,onComplete:function(){r.isAborted||a[u]()},onChange:function(){a.canvas&&a.selectionStart===a.selectionEnd&&a.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var a=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){a._currentTickCompleteState=a._animateCursor(a,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(a){var s=this,l=a?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){s._tick()},l)},abortCursorAnimation:function(){var a=this._currentTickState||this._currentTickCompleteState,s=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,a&&s&&s.clearContext(s.contextTop||s.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(a){var s=0,l=a-1;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)s++,l--;for(;/\S/.test(this._text[l])&&l>-1;)s++,l--;return a-s},findWordBoundaryRight:function(a){var s=0,l=a;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)s++,l++;for(;/\S/.test(this._text[l])&&l<this._text.length;)s++,l++;return a+s},findLineBoundaryLeft:function(a){for(var s=0,l=a-1;!/\n/.test(this._text[l])&&l>-1;)s++,l--;return a-s},findLineBoundaryRight:function(a){for(var s=0,l=a;!/\n/.test(this._text[l])&&l<this._text.length;)s++,l++;return a+s},searchWordBoundary:function(a,s){for(var l=this._text,u=this._reSpace.test(l[a])?a-1:a,r=l[u],o=y.reNonWord;!o.test(r)&&u>0&&u<l.length;)r=l[u+=s];return o.test(r)&&(u+=s===1?0:1),u},selectWord:function(a){a=a||this.selectionStart;var s=this.searchWordBoundary(a,-1),l=this.searchWordBoundary(a,1);this.selectionStart=s,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(a){a=a||this.selectionStart;var s=this.findLineBoundaryLeft(a),l=this.findLineBoundaryRight(a);return this.selectionStart=s,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(a){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(a),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(a){a._iTextInstances&&a._iTextInstances.forEach(function(s){s.selected=!1,s.isEditing&&s.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(a){if(this.__isMousedown&&this.isEditing){var s=this.getSelectionStartFromPointer(a.e),l=this.selectionStart,u=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&l!==u||l!==s&&u!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===l&&this.selectionEnd===u||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(a,s,l){var u=l.slice(0,a),r=y.util.string.graphemeSplit(u).length;if(a===s)return{selectionStart:r,selectionEnd:r};var o=l.slice(a,s);return{selectionStart:r,selectionEnd:r+y.util.string.graphemeSplit(o).length}},fromGraphemeToStringSelection:function(a,s,l){var u=l.slice(0,a).join("").length;return a===s?{selectionStart:u,selectionEnd:u}:{selectionStart:u,selectionEnd:u+l.slice(a,s).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var a=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=a.selectionStart,this.hiddenTextarea.selectionEnd=a.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var a=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=a.selectionEnd,this.inCompositionMode||(this.selectionStart=a.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var a=this._calcTextareaPosition();this.hiddenTextarea.style.left=a.left,this.hiddenTextarea.style.top=a.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var a=this.inCompositionMode?this.compositionStart:this.selectionStart,s=this._getCursorBoundaries(a),l=this.get2DCursorLocation(a),u=l.lineIndex,r=l.charIndex,o=this.getValueOfPropertyAt(u,r,"fontSize")*this.lineHeight,c=s.leftOffset,_=this.calcTransformMatrix(),f={x:s.left+c,y:s.top+s.topOffset+o},g=this.canvas.getRetinaScaling(),m=this.canvas.upperCanvasEl,S=m.width/g,w=m.height/g,I=S-o,T=w-o,A=m.clientWidth/S,D=m.clientHeight/w;return f=y.util.transformPoint(f,_),(f=y.util.transformPoint(f,this.canvas.viewportTransform)).x*=A,f.y*=D,f.x<0&&(f.x=0),f.x>I&&(f.x=I),f.y<0&&(f.y=0),f.y>T&&(f.y=T),f.x+=this.canvas._offset.left,f.y+=this.canvas._offset.top,{left:f.x+"px",top:f.y+"px",fontSize:o+"px",charHeight:o}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var a=this._textBeforeEdit!==this.text,s=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,s&&(s.blur&&s.blur(),s.parentNode&&s.parentNode.removeChild(s)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),a&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),a&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var a in this.styles)this._textLines[a]||delete this.styles[a]},removeStyleFromTo:function(a,s){var l,u,r=this.get2DCursorLocation(a,!0),o=this.get2DCursorLocation(s,!0),c=r.lineIndex,_=r.charIndex,f=o.lineIndex,g=o.charIndex;if(c!==f){if(this.styles[c])for(l=_;l<this._unwrappedTextLines[c].length;l++)delete this.styles[c][l];if(this.styles[f])for(l=g;l<this._unwrappedTextLines[f].length;l++)(u=this.styles[f][l])&&(this.styles[c]||(this.styles[c]={}),this.styles[c][_+l-g]=u);for(l=c+1;l<=f;l++)delete this.styles[l];this.shiftLineStyles(f,c-f)}else if(this.styles[c]){u=this.styles[c];var m,S,w=g-_;for(l=_;l<g;l++)delete u[l];for(S in this.styles[c])(m=parseInt(S,10))>=g&&(u[m-w]=u[S],delete u[S])}},shiftLineStyles:function(a,s){var l=_e(this.styles);for(var u in this.styles){var r=parseInt(u,10);r>a&&(this.styles[r+s]=l[r],l[r-s]||delete this.styles[r])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(a,s,l,u){var r,o={},c=!1,_=this._unwrappedTextLines[a].length===s;for(var f in l||(l=1),this.shiftLineStyles(a,l),this.styles[a]&&(r=this.styles[a][s===0?s:s-1]),this.styles[a]){var g=parseInt(f,10);g>=s&&(c=!0,o[g-s]=this.styles[a][f],_&&s===0||delete this.styles[a][f])}var m=!1;for(c&&!_&&(this.styles[a+l]=o,m=!0),m&&l--;l>0;)u&&u[l-1]?this.styles[a+l]={0:_e(u[l-1])}:r?this.styles[a+l]={0:_e(r)}:delete this.styles[a+l],l--;this._forceClearCache=!0},insertCharStyleObject:function(a,s,l,u){this.styles||(this.styles={});var r=this.styles[a],o=r?_e(r):{};for(var c in l||(l=1),o){var _=parseInt(c,10);_>=s&&(r[_+l]=o[_],o[_-l]||delete r[_])}if(this._forceClearCache=!0,u)for(;l--;)Object.keys(u[l]).length&&(this.styles[a]||(this.styles[a]={}),this.styles[a][s+l]=_e(u[l]));else if(r)for(var f=r[s?s-1:1];f&&l--;)this.styles[a][s+l]=_e(f)},insertNewStyleBlock:function(a,s,l){for(var u=this.get2DCursorLocation(s,!0),r=[0],o=0,c=0;c<a.length;c++)a[c]===`
`?r[++o]=0:r[o]++;for(r[0]>0&&(this.insertCharStyleObject(u.lineIndex,u.charIndex,r[0],l),l=l&&l.slice(r[0]+1)),o&&this.insertNewlineStyleObject(u.lineIndex,u.charIndex+r[0],o),c=1;c<o;c++)r[c]>0?this.insertCharStyleObject(u.lineIndex+c,0,r[c],l):l&&this.styles[u.lineIndex+c]&&l[0]&&(this.styles[u.lineIndex+c][0]=l[0]),l=l&&l.slice(r[c]+1);r[c]>0&&this.insertCharStyleObject(u.lineIndex+c,0,r[c],l)},setSelectionStartEndWithShift:function(a,s,l){l<=a?(s===a?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=a),this.selectionStart=l):l>a&&l<s?this._selectionDirection==="right"?this.selectionEnd=l:this.selectionStart=l:(s===a?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=s),this.selectionEnd=l)},setSelectionInBoundaries:function(){var a=this.text.length;this.selectionStart>a?this.selectionStart=a:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>a?this.selectionEnd=a:this.selectionEnd<0&&(this.selectionEnd=0)}}),y.util.object.extend(y.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(a){if(this.canvas){this.__newClickTime=+new Date;var s=a.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",a),this._stopEvent(a.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(a){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===a.x&&this.__lastPointer.y===a.y},_stopEvent:function(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(a){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(a.e))},tripleClickHandler:function(a){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(a.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(a.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(a){!this.canvas||!this.editable||a.e.button&&a.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(a){if(this.__isMousedown=!1,!(!this.editable||this.group||a.transform&&a.transform.actionPerformed||a.e.button&&a.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(a.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(a){var s=this.getSelectionStartFromPointer(a),l=this.selectionStart,u=this.selectionEnd;a.shiftKey?this.setSelectionStartEndWithShift(l,u,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(a){for(var s,l=this.getLocalPointer(a),u=0,r=0,o=0,c=0,_=0,f=0,g=this._textLines.length;f<g&&o<=l.y;f++)o+=this.getHeightOfLine(f)*this.scaleY,_=f,f>0&&(c+=this._textLines[f-1].length+this.missingNewlineOffset(f-1));r=this._getLineLeftOffset(_)*this.scaleX,s=this._textLines[_],this.direction==="rtl"&&(l.x=this.width*this.scaleX-l.x+r);for(var m=0,S=s.length;m<S&&(u=r,(r+=this.__charBounds[_][m].kernedWidth*this.scaleX)<=l.x);m++)c++;return this._getNewSelectionStartFromOffset(l,u,r,c,S)},_getNewSelectionStartFromOffset:function(a,s,l,u,r){var o=a.x-s,c=l-a.x,_=u+(c>o||c<0?0:1);return this.flipX&&(_=r-_),_>this._text.length&&(_=this._text.length),_}}),y.util.object.extend(y.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=y.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var a=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+a.top+"; left: "+a.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+a.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):y.document.body.appendChild(this.hiddenTextarea),y.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),y.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),y.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),y.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),y.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),y.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(y.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(a){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(a.keyCode in s)this[s[a.keyCode]](a);else{if(!(a.keyCode in this.ctrlKeysMapDown)||!a.ctrlKey&&!a.metaKey)return;this[this.ctrlKeysMapDown[a.keyCode]](a)}a.stopImmediatePropagation(),a.preventDefault(),a.keyCode>=33&&a.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(a){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:a.keyCode in this.ctrlKeysMapUp&&(a.ctrlKey||a.metaKey)&&(this[this.ctrlKeysMapUp[a.keyCode]](a),a.stopImmediatePropagation(),a.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(a){var s=this.fromPaste;if(this.fromPaste=!1,a&&a.stopPropagation(),this.isEditing){var l,u,r,o,c,_=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,f=this._text.length,g=_.length,m=g-f,S=this.selectionStart,w=this.selectionEnd,I=S!==w;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var T=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),A=S>T.selectionStart;I?(l=this._text.slice(S,w),m+=w-S):g<f&&(l=A?this._text.slice(w+m,w):this._text.slice(S,S-m)),u=_.slice(T.selectionEnd-m,T.selectionEnd),l&&l.length&&(u.length&&(r=this.getSelectionStyles(S,S+1,!1),r=u.map(function(){return r[0]})),I?(o=S,c=w):A?(o=w-l.length,c=w):(o=w,c=w+l.length),this.removeStyleFromTo(o,c)),u.length&&(s&&u.join("")===y.copiedText&&!y.disableStyleCopyPaste&&(r=y.copiedTextStyle),this.insertNewStyleBlock(u,S,r)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(a){this.compositionStart=a.target.selectionStart,this.compositionEnd=a.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(y.copiedText=this.getSelectedText(),y.disableStyleCopyPaste?y.copiedTextStyle=null:y.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(a){return a&&a.clipboardData||y.window.clipboardData},_getWidthBeforeCursor:function(a,s){var l,u=this._getLineLeftOffset(a);return s>0&&(u+=(l=this.__charBounds[a][s-1]).left+l.width),u},getDownCursorOffset:function(a,s){var l=this._getSelectionForOffset(a,s),u=this.get2DCursorLocation(l),r=u.lineIndex;if(r===this._textLines.length-1||a.metaKey||a.keyCode===34)return this._text.length-l;var o=u.charIndex,c=this._getWidthBeforeCursor(r,o),_=this._getIndexOnLine(r+1,c);return this._textLines[r].slice(o).length+_+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(a,s){return a.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(a,s){var l=this._getSelectionForOffset(a,s),u=this.get2DCursorLocation(l),r=u.lineIndex;if(r===0||a.metaKey||a.keyCode===33)return-l;var o=u.charIndex,c=this._getWidthBeforeCursor(r,o),_=this._getIndexOnLine(r-1,c),f=this._textLines[r].slice(0,o),g=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+_-f.length+(1-g)},_getIndexOnLine:function(a,s){for(var l,u,r=this._textLines[a],o=this._getLineLeftOffset(a),c=0,_=0,f=r.length;_<f;_++)if((o+=l=this.__charBounds[a][_].width)>s){u=!0;var g=o-l,m=o,S=Math.abs(g-s);c=Math.abs(m-s)<S?_:_-1;break}return u||(c=r.length-1),c},moveCursorDown:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",a)},moveCursorUp:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",a)},_moveCursorUpOrDown:function(a,s){var l=this["get"+a+"CursorOffset"](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(l):this.moveCursorWithoutShift(l),l!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(a){var s=this._selectionDirection==="left"?this.selectionStart+a:this.selectionEnd+a;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),a!==0},moveCursorWithoutShift:function(a){return a<0?(this.selectionStart+=a,this.selectionEnd=this.selectionStart):(this.selectionEnd+=a,this.selectionStart=this.selectionEnd),a!==0},moveCursorLeft:function(a){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",a)},_move:function(a,s,l){var u;if(a.altKey)u=this["findWordBoundary"+l](this[s]);else{if(!a.metaKey&&a.keyCode!==35&&a.keyCode!==36)return this[s]+=l==="Left"?-1:1,!0;u=this["findLineBoundary"+l](this[s])}if(typeof u!==void 0&&this[s]!==u)return this[s]=u,!0},_moveLeft:function(a,s){return this._move(a,s,"Left")},_moveRight:function(a,s){return this._move(a,s,"Right")},moveCursorLeftWithoutShift:function(a){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(a,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(a){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(a,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(a,"selectionStart")):void 0},moveCursorRight:function(a){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",a)},_moveCursorLeftOrRight:function(a,s){var l="moveCursor"+a+"With";this._currentCursorOpacity=1,s.shiftKey?l+="Shift":l+="outShift",this[l](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(a){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(a,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(a,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(a){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(a,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(a,s){s===void 0&&(s=a+1),this.removeStyleFromTo(a,s),this._text.splice(a,s-a),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(a,s,l,u){u===void 0&&(u=l),u>l&&this.removeStyleFromTo(l,u);var r=y.util.string.graphemeSplit(a);this.insertNewStyleBlock(r,l,s),this._text=[].concat(this._text.slice(0,l),r,this._text.slice(u)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var a=y.util.toFixed,s=/  +/g;y.util.object.extend(y.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),u=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(u)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var u=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",u?'text-decoration="'+u+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,u){var r,o=[],c=[],_=l;this._setSVGBg(c);for(var f=0,g=this._textLines.length;f<g;f++)r=this._getLineLeftOffset(f),(this.textBackgroundColor||this.styleHas("textBackgroundColor",f))&&this._setSVGTextLineBg(c,f,u+r,_),this._setSVGTextLineText(o,f,u+r,_),_+=this.getHeightOfLine(f);return{textSpans:o,textBgRects:c}},_createTextCharSpan:function(l,u,r,o){var c=l!==l.trim()||l.match(s),_=this.getSvgSpanStyles(u,c),f=_?'style="'+_+'"':"",g=u.deltaY,m="",S=y.Object.NUM_FRACTION_DIGITS;return g&&(m=' dy="'+a(g,S)+'" '),['<tspan x="',a(r,S),'" y="',a(o,S),'" ',m,f,">",y.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,u,r,o){var c,_,f,g,m,S=this.getHeightOfLine(u),w=this.textAlign.indexOf("justify")!==-1,I="",T=0,A=this._textLines[u];o+=S*(1-this._fontSizeFraction)/this.lineHeight;for(var D=0,P=A.length-1;D<=P;D++)m=D===P||this.charSpacing,I+=A[D],f=this.__charBounds[u][D],T===0?(r+=f.kernedWidth-f.width,T+=f.width):T+=f.kernedWidth,w&&!m&&this._reSpaceAndTab.test(A[D])&&(m=!0),m||(c=c||this.getCompleteStyleDeclaration(u,D),_=this.getCompleteStyleDeclaration(u,D+1),m=this._hasStyleChangedForSvg(c,_)),m&&(g=this._getStyleDeclaration(u,D)||{},l.push(this._createTextCharSpan(I,g,r,o)),I="",c=_,r+=T,T=0)},_pushTextBgRect:function(l,u,r,o,c,_){var f=y.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(u),' x="',a(r,f),'" y="',a(o,f),'" width="',a(c,f),'" height="',a(_,f),`"></rect>
`)},_setSVGTextLineBg:function(l,u,r,o){for(var c,_,f=this._textLines[u],g=this.getHeightOfLine(u)/this.lineHeight,m=0,S=0,w=this.getValueOfPropertyAt(u,0,"textBackgroundColor"),I=0,T=f.length;I<T;I++)c=this.__charBounds[u][I],(_=this.getValueOfPropertyAt(u,I,"textBackgroundColor"))!==w?(w&&this._pushTextBgRect(l,w,r+S,o,m,g),S=c.left,m=c.width,w=_):m+=c.kernedWidth;_&&this._pushTextBgRect(l,_,r+S,o,m,g)},_getFillAttributes:function(l){var u=l&&typeof l=="string"?new y.Color(l):"";return u&&u.getSource()&&u.getAlpha()!==1?'opacity="'+u.getAlpha()+'" fill="'+u.setAlpha(1).toRgb()+'"':'fill="'+l+'"'},_getSVGLineTopOffset:function(l){for(var u,r=0,o=0;o<l;o++)r+=this.getHeightOfLine(o);return u=this.getHeightOfLine(o),{lineTop:r,offset:(this._fontSizeMult-this._fontSizeFraction)*u/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){return y.Object.prototype.getSvgStyles.call(this,l)+" white-space: pre;"}})}(),function(a){var s=a.fabric||(a.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var u=0,r=0,o=0,c={},_=0;_<l.graphemeLines.length;_++)l.graphemeText[o]===`
`&&_>0?(r=0,o++,u++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[o])&&_>0&&(r++,o++),c[_]={line:u,offset:r},o+=l.graphemeLines[_].length,r+=l.graphemeLines[_].length;return c},styleHas:function(l,u){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[u];r&&(u=r.line)}return s.Text.prototype.styleHas.call(this,l,u)},isEmptyStyles:function(l){if(!this.styles)return!0;var u,r,o=0,c=!1,_=this._styleMap[l],f=this._styleMap[l+1];for(var g in _&&(l=_.line,o=_.offset),f&&(c=f.line===l,u=f.offset),r=l===void 0?this.styles:{line:this.styles[l]})for(var m in r[g])if(m>=o&&(!c||m<u))for(var S in r[g][m])return!1;return!0},_getStyleDeclaration:function(l,u){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[l];if(!r)return null;l=r.line,u=r.offset+u}return this.callSuper("_getStyleDeclaration",l,u)},_setStyleDeclaration:function(l,u,r){var o=this._styleMap[l];l=o.line,u=o.offset+u,this.styles[l][u]=r},_deleteStyleDeclaration:function(l,u){var r=this._styleMap[l];l=r.line,u=r.offset+u,delete this.styles[l][u]},_getLineStyle:function(l){var u=this._styleMap[l];return!!this.styles[u.line]},_setLineStyle:function(l){var u=this._styleMap[l];this.styles[u.line]={}},_wrapText:function(l,u){var r,o=[];for(this.isWrapping=!0,r=0;r<l.length;r++)o=o.concat(this._wrapLine(l[r],r,u));return this.isWrapping=!1,o},_measureWord:function(l,u,r){var o,c=0;r=r||0;for(var _=0,f=l.length;_<f;_++)c+=this._getGraphemeBox(l[_],u,_+r,o,!0).kernedWidth,o=l[_];return c},_wrapLine:function(l,u,r,o){var c=0,_=this.splitByGrapheme,f=[],g=[],m=_?s.util.string.graphemeSplit(l):l.split(this._wordJoiners),S="",w=0,I=_?"":" ",T=0,A=0,D=0,P=!0,j=this._getWidthOfCharSpacing();o=o||0,m.length===0&&m.push([]),r-=o;for(var Z=0;Z<m.length;Z++)S=_?m[Z]:s.util.string.graphemeSplit(m[Z]),T=this._measureWord(S,u,w),w+=S.length,(c+=A+T-j)>r&&!P?(f.push(g),g=[],c=T,P=!0):c+=j,P||_||g.push(I),g=g.concat(S),A=_?0:this._measureWord([I],u,w),w++,P=!1,T>D&&(D=T);return Z&&f.push(g),D+o>this.dynamicMinWidth&&(this.dynamicMinWidth=D-j+o),f},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var u=s.Text.prototype._splitTextIntoLines.call(this,l),r=this._wrapText(u.lines,this.width),o=new Array(r.length),c=0;c<r.length;c++)o[c]=r[c].join("");return u.lines=o,u.graphemeLines=r,u},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var u in this._styleMap)this._textLines[u]&&(l[this._styleMap[u].line]=1);for(var u in this.styles)l[u]||delete this.styles[u]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),s.Textbox.fromObject=function(l,u){return s.Object._fromObject("Textbox",l,u,"text")}}(e),function(){var a=y.controlsUtils,s=a.scaleSkewCursorStyleHandler,l=a.scaleCursorStyleHandler,u=a.scalingEqually,r=a.scalingYOrSkewingX,o=a.scalingXOrSkewingY,c=a.scaleOrSkewActionName,_=y.Object.prototype.controls;if(_.ml=new y.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:o,getActionName:c}),_.mr=new y.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:o,getActionName:c}),_.mb=new y.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:r,getActionName:c}),_.mt=new y.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:r,getActionName:c}),_.tl=new y.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),_.tr=new y.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:u}),_.bl=new y.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:u}),_.br=new y.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:u}),_.mtr=new y.Control({x:0,y:-.5,actionHandler:a.rotationWithSnapping,cursorStyleHandler:a.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),y.Textbox){var f=y.Textbox.prototype.controls={};f.mtr=_.mtr,f.tr=_.tr,f.br=_.br,f.tl=_.tl,f.bl=_.bl,f.mt=_.mt,f.mb=_.mb,f.mr=new y.Control({x:.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),f.ml=new y.Control({x:-.5,y:0,actionHandler:a.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},es={};function vt(t){var e=es[t];if(e!==void 0)return e.exports;var i=es[t]={exports:{}};return ah[t](i,i.exports,vt),i.exports}vt.d=(t,e)=>{for(var i in e)vt.o(e,i)&&!vt.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},vt.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Oo={};(()=>{let t;vt.d(Oo,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?vt(653).fabric:{version:"5.2.1"}})();var Se=Oo.R;/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Camera Enhancer JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2023, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.3.9 (js 20231205)
 * @fileoverview Dynamsoft JavaScript Library for Camera Enhancer
 * More info on DCE JS: https://www.dynamsoft.com/camera-enhancer/docs/programming/javascript/?ver=latest
 */const zi=typeof self>"u";let qt,it,Si,Wi,Oe;if(typeof navigator<"u"&&(qt=navigator,it=qt.userAgent,Si=qt.platform,Wi=qt.mediaDevices),!zi){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:qt.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Si,search:"Win"},Mac:{str:Si},Linux:{str:Si}};let i="unknownBrowser",n=0,h="unknownOS";for(let d in t){const p=t[d]||{};let v=p.str||it,b=p.search||d,C=p.verStr||it,x=p.verSearch||d;if(x instanceof Array||(x=[x]),v.indexOf(b)!=-1){i=d;for(let E of x){let O=C.indexOf(E);if(O!=-1){n=parseFloat(C.substring(O+E.length+1));break}}break}}for(let d in e){const p=e[d]||{};let v=p.str||it,b=p.search||d;if(v.indexOf(b)!=-1){h=d;break}}h=="Linux"&&it.indexOf("Windows NT")!=-1&&(h="HarmonyOS"),Oe={browser:i,version:n,OS:h}}zi&&(Oe={browser:"ssr",version:0,OS:"ssr"});const lh=typeof WebAssembly<"u"&&it&&!(/Safari/.test(it)&&!/Chrome/.test(it)&&/\(.+\s11_2_([2-6]).*\)/.test(it)),ch=!(typeof Worker>"u"),Ao=!(!Wi||!Wi.getUserMedia),hh=async()=>{let t=!1;if(Ao)try{(await Wi.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch(e){}return t};Oe.browser==="Chrome"&&Oe.version>66||Oe.browser==="Safari"&&Oe.version>13||Oe.browser==="OPR"&&Oe.version>43||Oe.browser==="Edge"&&Oe.version;const uh=(()=>{if(!zi&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let i=t.indexOf("#");i!=-1&&(t=t.substring(0,i))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();class Ge{constructor(e,i){this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapStyle=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,this._setFabricObject(e),this._mediaType=e.type,this.styleSelector="default",this.styleId=i}get mediaType(){return this._mediaType}get drawingLayerId(){return this._drawingLayerId}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.styleSelector="selected"}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.styleSelector="selected":this.styleSelector="default",this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}_on(e,i){if(!i)return;const n=e.toLowerCase(),h=this.mapEvent_Callbacks.get(n);if(!h)throw new Error(`Event '${e}' does not exist.`);let d=h.get(i);d||(d=p=>{const v=p.e;if(!v)return void(i&&i.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const b={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let C,x,E,O;const N=v.target.getBoundingClientRect();C=N.left,x=N.top,E=C+window.scrollX,O=x+window.scrollY;const k=this._drawingLayer.fabricCanvas.lowerCanvasEl.width,H=this._drawingLayer.fabricCanvas.lowerCanvasEl.height,U=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).width),ee=parseFloat(window.getComputedStyle(this._drawingLayer.fabricCanvas.lowerCanvasEl).height),Y=U/ee,G=k/H,re=this._drawingLayer._getObjectFit();let de,fe,_e,y,ge=1;if(re==="contain")Y<G?(ge=U/k,de=C+this.get("x")*ge,fe=x+this.get("y")*ge+(ee-H*ge)/2,_e=E+this.get("x")*ge,y=O+this.get("y")*ge+(ee-H*ge)/2):(ge=ee/H,de=C+this.get("x")*ge+(U-k*ge)/2,fe=x+this.get("y")*ge,_e=E+this.get("x")*ge+(U-k*ge)/2,y=O+this.get("y")*ge);else if(re==="cover")if(Y<G){ge=ee/H;let me=this.get("x")*ge-(k*ge-U)/2;me=Math.max(me,0),me=Math.min(me,U),de=C+me,fe=x+this.get("y")*ge,_e=E+me,y=O+this.get("y")*ge}else{ge=U/k;let me=this.get("y")*ge-(H*ge-ee)/2;me=Math.max(me,0),me=Math.min(me,ee),de=C+this.get("x")*ge,fe=x+me,_e=E+this.get("x")*ge,y=O+me}b.itemClientX=Math.round(de),b.itemClientY=Math.round(fe),b.itemPageX=Math.round(_e),b.itemPageY=Math.round(y)}for(let C of Object.getOwnPropertyNames(b))Object.defineProperty(v,C,{value:b[C],writable:!0});i&&i.apply(this,[v])},h.set(i,d),this._fabricObject.on(n==="dblclick"?"mousedblclick":n,d))}on(e,i){this._on(e,i)}_off(e,i){const n=e.toLowerCase(),h=this.mapEvent_Callbacks.get(n);if(!h)throw new Error(`Event '${e}' does not exist.`);let d=h.get(i);d&&(h.delete(i),this._fabricObject.off(n==="dblclick"?"mousedblclick":n,d))}off(e,i){this._off(e,i)}_setEditable(e){const i=this._fabricObject;e?(i.selectable=!0,i.hasControls=!0,i.hoverCursor=null):(i.selectable=!1,i.hasControls=!1,i.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,i){if(this.hasNote(e.name)&&!i)throw new Error("A note with the same name already exists, please use a different name.");const n=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[n])}getNote(e){const i=this.mapNoteName_Content.get(e);return i?i.length===1?{name:e,content:i[0]?JSON.parse(JSON.stringify(i[0])):i[0]}:{name:e,content:JSON.parse(JSON.stringify(i))}:null}getNotes(){const e=[];for(let i of this.mapNoteName_Content){let n=i[1].length===1?i[1][0]:i[1];n=n&&JSON.parse(JSON.stringify(n)),e.push({name:i[0],content:n})}return e}updateNote(e,i,n){const h=this.mapNoteName_Content.get(e);if(!h)throw new Error("The note name does not exist.");n||(h.length=0),i=i&&JSON.parse(JSON.stringify(i)),h.push(i)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}_extendSet(e,i){return!1}_extendGet(e){}set(e,i){if(!this._extendSet(e,i))if(e==="x"){const n=this._fabricObject.group;n?(this._fabricObject.set("left",i-n.left-n.width/2),n.addWithUpdate()):this._fabricObject.set("left",i)}else if(e==="y"){const n=this._fabricObject.group;n?(this._fabricObject.set("top",i-n.top-n.height/2),n.addWithUpdate()):this._fabricObject.set("top",i)}else e==="styleId"?this.styleId=i:this._fabricObject.set(e,i);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let i=this._extendGet(e);if(i===void 0)if(e==="x"){const n=this._fabricObject.group;i=n?this._fabricObject.get("left")+n.left+n.width/2:this._fabricObject.get("left")}else if(e==="y"){const n=this._fabricObject.group;i=n?this._fabricObject.get("top")+n.top+n.height/2:this._fabricObject.get("top")}else i=["type","mediaType"].includes(e)?this.mediaType:e==="styleSelector"?this.styleSelector:e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return i}setAttribute(e,i){this.set(e,i)}getAttribute(e){return this.get(e)}}function Ir(t,e,i){let n=i.points[this.pointIndex].x-i.pathOffset.x,h=i.points[this.pointIndex].y-i.pathOffset.y;return Se.util.transformPoint({x:n,y:h},i.calcTransformMatrix())}function Do(t){let e=new Se.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new Se.Point(t.width+e.x,t.height+e.y)}function Er(t,e,i,n){let h=e.target,d=h.controls[h.__corner],p=h.toLocalPoint(new Se.Point(i,n),"center","center"),v=Do(h),b=h._getTransformedDimensions(0,0),C={x:p.x*v.x/b.x+h.pathOffset.x,y:p.y*v.y/b.y+h.pathOffset.y};return h.points[d.pointIndex]=C,!0}function Or(t,e){return function(i,n,h,d){let p=n.target,v=Se.util.transformPoint({x:p.points[t].x-p.pathOffset.x,y:p.points[t].y-p.pathOffset.y},p.calcTransformMatrix()),b=e(i,n,h,d);p._setPositionDimensions({});let C=Do(p),x=(p.points[t].x-p.pathOffset.x)/C.x,E=(p.points[t].y-p.pathOffset.y)/C.y;return p.setPositionByOrigin(v,x+.5,E+.5),b}}Ge.arrMediaTypes=["rect","arc","polygon","image","text","line","path"],Ge.arrStyleSelectors=["default","selected"];class ts extends Ge{constructor(e,i){super(new Se.Polygon(e,{objectCaching:!1}),i);const n=this._fabricObject;let h=n.points.length-1;n.controls=n.points.reduce(function(d,p,v){return d["p"+v]=new Se.Control({positionHandler:Ir,actionHandler:Or(v>0?v-1:h,Er),actionName:"modifyPolygon",pointIndex:v}),d},{})}_extendSet(e,i){if(e==="vertices"){const n=this._fabricObject;if(n.group){const d=n.group;n.points=i.map(p=>({x:p.x-d.left-d.width/2,y:p.y-d.top-d.height/2})),d.addWithUpdate()}else n.points=i;const h=n.points.length-1;return n.controls=n.points.reduce(function(d,p,v){return d["p"+v]=new Se.Control({positionHandler:Ir,actionHandler:Or(v>0?v-1:h,Er),actionName:"modifyPolygon",pointIndex:v}),d},{}),n._setPositionDimensions({}),!0}}_extendGet(e){if(e==="vertices"){const i=[],n=this._fabricObject;if(n.selectable&&!n.group)for(let h in n.oCoords)i.push({x:n.oCoords[h].x,y:n.oCoords[h].y});else for(let h of n.points){let d=h.x-n.pathOffset.x,p=h.y-n.pathOffset.y;const v=Se.util.transformPoint({x:d,y:p},n.calcTransformMatrix());i.push({x:v.x,y:v.y})}return i}}}const is=t=>{let e=(i=>i.split(`
`).map(n=>n.split("	")))(t);return(i=>{for(let n=0;;n++){let h=-1;for(let d=0;d<i.length;d++){let p=i[d][n];p!==void 0&&p.length>h&&(h=p.length)}if(h===-1)break;for(let d=0;d<i.length;d++){if(n>=i[d].length-1)continue;let p=" ".repeat(h+2-i[d][n].length);i[d][n]=i[d][n].concat(p)}}})(e),(i=>{let n="";for(let h=0;h<i.length;h++)n=n.concat(...i[h],h===i.length-1?"":`
`);return n})(e)};class Ro extends Ge{constructor(e,i,n,h,d){if(typeof h!="number"||h<=0)throw new RangeError("Invalid width.");super(new Se.Textbox(is(e),{left:i,top:n,width:h}),d),this._mediaType="text",this._text=e}_extendSet(e,i){if(e==="text")return this._text=i,this._fabricObject.set("text",is(i)),!0}_extendGet(e){if(e==="text")return this._text}}typeof document<"u"&&typeof window<"u"&&(Se.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Se.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Se.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Se.Object.prototype.transparentCorners=!1,Se.Object.prototype.cornerSize=20,Se.Object.prototype.touchCornerSize=100,Se.Object.prototype.cornerColor="rgb(254,142,20)",Se.Object.prototype.cornerStyle="circle",Se.Object.prototype.strokeUniform=!0,Se.Object.prototype.hasBorders=!1,Se.Canvas.prototype.containerClass="",Se.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var i,n=this.upperCanvasEl,h=Se.util.getPointer(t,n),d=n.getBoundingClientRect(),p=d.width||0,v=d.height||0;p&&v||("top"in d&&"bottom"in d&&(v=Math.abs(d.top-d.bottom)),"right"in d&&"left"in d&&(p=Math.abs(d.right-d.left))),this.calcOffset(),h.x=h.x-this._offset.left,h.y=h.y-this._offset.top,e||(h=this.restorePointerVpt(h));var b=this.getRetinaScaling();if(b!==1&&(h.x/=b,h.y/=b),p!==0&&v!==0){var C=window.getComputedStyle(n).objectFit,x=n.width,E=n.height,O=p,N=v;i={width:x/O,height:E/N};var k,H,U=x/E,ee=O/N;return C==="contain"?U>ee?(k=O,H=O/U,{x:h.x*i.width,y:(h.y-(N-H)/2)*i.width}):(k=N*U,H=N,{x:(h.x-(O-k)/2)*i.height,y:h.y*i.height}):C==="cover"?U>ee?{x:(x-i.height*O)/2+h.x*i.height,y:h.y*i.height}:{x:h.x*i.width,y:(E-i.width*N)/2+h.y*i.width}:{x:h.x*i.width,y:h.y*i.height}}return i={width:1,height:1},{x:h.x*i.width,y:h.y*i.height}},Se.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var i=this.upperCanvasEl,n=this._getEventPrefix();Se.util.addListener(Se.document,"touchend",this._onTouchEnd,{passive:!1}),Se.util.addListener(Se.document,"touchmove",this._onMouseMove,{passive:!1}),Se.util.removeListener(i,n+"down",this._onMouseDown)},Se.Textbox.prototype._wrapLine=function(t,e,i,n){const h=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),d=!(!h||!h.length);var p=0,v=this.splitByGrapheme||d,b=[],C=[],x=v?Se.util.string.graphemeSplit(t):t.split(this._wordJoiners),E="",O=0,N=v?"":" ",k=0,H=0,U=0,ee=!0,Y=this._getWidthOfCharSpacing();n=n||0,x.length===0&&x.push([]),i-=n;for(var G=0;G<x.length;G++)E=v?x[G]:Se.util.string.graphemeSplit(x[G]),k=this._measureWord(E,e,O),O+=E.length,(p+=H+k-Y)>i&&!ee?(b.push(C),C=[],p=k,ee=!0):p+=Y,ee||v||C.push(N),C=C.concat(E),H=v?0:this._measureWord([N],e,O),O++,ee=!1,k>U&&(U=k);return G&&b.push(C),U+n>this.dynamicMinWidth&&(this.dynamicMinWidth=U-Y+n),b});class dh{constructor(e,i,n,h){let d,p;switch(this.mapMediaType_Style=new Map,this.mode="viewer",this.onSelectionChange=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas")?this.fabricCanvas=e.getFabricCanvas():(this.fabricCanvas=new Se.Canvas(e,Object.assign(h,{allowTouchScrolling:!0})),this.fabricCanvas.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),this.fabricCanvas.lowerCanvasEl.className="",this.fabricCanvas.upperCanvasEl.className="",this.fabricCanvas.on("selection:created",function(v){const b=v.selected,C=[];for(let x of b){const E=x.getDrawingItem()._drawingLayer;E&&!C.includes(E)&&C.push(E)}for(let x of C){const E=[];for(let O of b){const N=O.getDrawingItem();N._drawingLayer===x&&E.push(N)}setTimeout(()=>{x.onSelectionChange&&x.onSelectionChange(E,[])},0)}}),this.fabricCanvas.on("before:selection:cleared",function(v){const b=this.getActiveObjects(),C=[];for(let x of b){const E=x.getDrawingItem()._drawingLayer;E&&!C.includes(E)&&C.push(E)}for(let x of C){const E=[];for(let O of b){const N=O.getDrawingItem();N._drawingLayer===x&&E.push(N)}setTimeout(()=>{const O=[];for(let N of E)x.hasDrawingItem(N)&&O.push(N);O.length>0&&x.onSelectionChange&&x.onSelectionChange([],O)},0)}}),this.fabricCanvas.on("selection:updated",function(v){const b=v.selected,C=v.deselected,x=[];for(let E of b){const O=E.getDrawingItem()._drawingLayer;O&&!x.includes(O)&&x.push(O)}for(let E of C){const O=E.getDrawingItem()._drawingLayer;O&&!x.includes(O)&&x.push(O)}for(let E of x){const O=[],N=[];for(let k of b){const H=k.getDrawingItem();H._drawingLayer===E&&O.push(H)}for(let k of C){const H=k.getDrawingItem();H._drawingLayer===E&&N.push(H)}setTimeout(()=>{E.onSelectionChange&&E.onSelectionChange(O,N)},0)}}),this.fabricCanvas.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas),this.id=i,this._mapDrawingStyles=n,i){case 1:d=n.get(1),p=n.get(5);break;case 2:d=n.get(2),p=n.get(6);break;case 3:d=n.get(3),p=n.get(7);break;default:d=n.get(4),p=n.get(8)}for(let v of Ge.arrMediaTypes)this.mapMediaType_Style.set(v,{default:d,selected:p})}getId(){return this.id}_getDrawingStyle(e,i){if(typeof e!="number")throw new Error("Invalid style id.");const n=this._mapDrawingStyles.get(e);return n?i?JSON.parse(JSON.stringify(n)):n:null}setVisible(e){if(e){for(let i of this._arrFabricObject)i.visible=!0;this._visible=!0}else{for(let i of this._arrFabricObject)i.visible=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyleId(e){return e.styleId?e.styleId:this.mapMediaType_Style.get(e._mediaType)[e.styleSelector].styleId}_getItemCurrentStyle(e){return e.styleId?this._getDrawingStyle(e.styleId):e._mapStyle.get(e.styleSelector)||null}_changeMediaTypeCurStyleInStyleSelector(e,i,n,h){let d;switch(e){case"rect":d=this.fabricCanvas.getObjects("rect");break;case"arc":d=this.fabricCanvas.getObjects("circle");break;case"polygon":d=this.fabricCanvas.getObjects("polygon");break;case"image":d=this.fabricCanvas.getObjects("image");break;case"text":d=this.fabricCanvas.getObjects("textbox");break;case"line":d=this.fabricCanvas.getObjects("line");break;case"path":d=this.fabricCanvas.getObjects("path")}for(let p of d){if(!this._arrFabricObject.includes(p))continue;const v=p.getDrawingItem();v.styleSelector===i&&this._changeItemStyle(v,n,!0)}h||this.fabricCanvas.renderAll()}_changeItemStyle(e,i,n){if(!e||!i)return;const h=e._getFabricObject();typeof e.styleId=="number"&&(i=this._getDrawingStyle(e.styleId)),h.strokeWidth=i.lineWidth,i.paintMode==="fill"?(h.fill=i.fillStyle,h.stroke=i.fillStyle):i.paintMode==="stroke"?(h.fill="transparent",h.stroke=i.strokeStyle):i.paintMode==="strokeAndFill"&&(h.fill=i.fillStyle,h.stroke=i.strokeStyle),h.fontFamily&&(h.fontFamily=i.fontFamily),h.fontSize&&(h.fontSize=i.fontSize),h.group||(h.dirty=!0),n||this.fabricCanvas.renderAll()}_updateGroupItem(e,i,n){if(!e||!i)return;const h=e.getChildItems();if(n==="add"){if(h.includes(i))return;const d=i._getFabricObject();if(this.fabricCanvas.getObjects().includes(d)){if(!this._arrFabricObject.includes(d))throw new Error("Existed in other drawing layers.");i._zIndex=null}else{let p;if(i.styleId)p=this._getDrawingStyle(i.styleId);else{p=this.mapMediaType_Style.get(i._mediaType)[e.styleSelector];const v=()=>{this._changeItemStyle(i,this.mapMediaType_Style.get(i._mediaType).selected,!0)},b=()=>{this._changeItemStyle(i,this.mapMediaType_Style.get(i._mediaType).default,!0)};i._on("selected",v),i._on("deselected",b),i._funcChangeStyleToSelected=v,i._funcChangeStyleToDefault=b}i._drawingLayer=this,i._drawingLayerId=this.id,this._changeItemStyle(i,p,!0)}e._fabricObject.addWithUpdate(i._getFabricObject())}else{if(n!=="remove"||!h.includes(i))return;i._zIndex=null,i._drawingLayer=null,i._drawingLayerId=null,i._off("selected",i._funcChangeStyleToSelected),i._off("deselected",i._funcChangeStyleToDefault),i._funcChangeStyleToSelected=null,i._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(i._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,i){let n=e._getFabricObject();const h=this.fabricCanvas.getObjects();let d,p;if(h.includes(n)){if(this._arrFabricObject.includes(n))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){d=e.getChildItems();for(let C of d)if(C._drawingLayer&&C._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(i&&typeof i=="object"&&!Array.isArray(i))for(let C in i)n.set(C,i[C]);if(d){for(let C of d){const x=this.mapMediaType_Style.get(C._mediaType);for(let E of Ge.arrStyleSelectors)C._mapStyle.set(E,x[E]);if(C.styleId)p=this._getDrawingStyle(C.styleId);else{p=x.default;const E=()=>{this._changeItemStyle(C,this.mapMediaType_Style.get(C._mediaType).selected,!0)},O=()=>{this._changeItemStyle(C,this.mapMediaType_Style.get(C._mediaType).default,!0)};C._on("selected",E),C._on("deselected",O),C._funcChangeStyleToSelected=E,C._funcChangeStyleToDefault=O}C._drawingLayer=this,C._drawingLayerId=this.id,this._changeItemStyle(C,p,!0)}n.dirty=!0,this.fabricCanvas.renderAll()}else{const C=this.mapMediaType_Style.get(e._mediaType);for(let x of Ge.arrStyleSelectors)e._mapStyle.set(x,C[x]);if(e.styleId)p=this._getDrawingStyle(e.styleId);else{p=C.default;const x=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).selected)},E=()=>{this._changeItemStyle(e,this.mapMediaType_Style.get(e._mediaType).default)};e._on("selected",x),e._on("deselected",E),e._funcChangeStyleToSelected=x,e._funcChangeStyleToDefault=E}this._changeItemStyle(e,p)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const v=this._arrFabricObject.length;let b=h.length;if(v)b=h.indexOf(this._arrFabricObject[v-1])+1;else for(let C=0;C<h.length;C++)if(e._zIndex<h[C].getDrawingItem()._zIndex){b=C;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(n),this._visible?n.visible=!0:n.visible=!1,this.fabricCanvas.insertAt(n,b,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e)}addDrawingItems(e){for(let i of e)this.addDrawingItem(i)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){const n=e.getChildItems();for(let h of n)h._zIndex=null,h._drawingLayer=null,h._drawingLayerId=null,h._off("selected",h._funcChangeStyleToSelected),h._off("deselected",h._funcChangeStyleToDefault),h._funcChangeStyleToSelected=null,h._funcChangeStyleToDefault=null,h._mapStyle.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapStyle.clear();const i=e._getFabricObject();e.styleSelector==="selected"&&(i.group?i.group.removeWithUpdate(i):this.fabricCanvas._activeObject=null,e.styleSelector="default"),this.fabricCanvas.remove(i),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(i),1)}removeDrawingItems(e){for(let i of e)this.removeDrawingItem(i)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),i=[];for(let n of e)this._arrFabricObject.includes(n)&&i.push(n.getDrawingItem());return i}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}setDrawingStyle(e,i,n){i=i?i.toLocaleLowerCase():"all",n=n?n.toLocaleLowerCase():"all";let h,d=this._getDrawingStyle(e);if(i==="all"){const p=this.mapMediaType_Style.keys();for(let v of p)if(h=this.mapMediaType_Style.get(v),n==="all")for(let b of Ge.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(v,b,d,!0),h[b]=d;for(let C of this._arrDrwaingItem)C._mapStyle.set(b,d)}else{this._changeMediaTypeCurStyleInStyleSelector(v,n,d,!0),h[n]=d;for(let b of this._arrDrwaingItem)b._mapStyle.set(n,d)}this.fabricCanvas.renderAll()}else if(h=this.mapMediaType_Style.get(i),n==="all")for(let p of Ge.arrStyleSelectors){this._changeMediaTypeCurStyleInStyleSelector(i,p,d,!0),h[p]=d;for(let v of this._arrDrwaingItem)v._mediaType===i&&v._mapStyle.set(p,d)}else{this._changeMediaTypeCurStyleInStyleSelector(i,n,d,!0),h[n]=d;for(let p of this._arrDrwaingItem)p._mediaType===i&&p._mapStyle.set(n,d)}}setMode(e){if((e=e.toLocaleLowerCase())==="viewer"){for(let i of this._arrDrwaingItem)i._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let i of this._arrDrwaingItem)i._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,i){this.fabricCanvas.setDimensions(e,i)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const i=this._getItemCurrentStyle(e);this._changeItemStyle(e,i,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}class fh{constructor(){this._arrDrawingLayer=[],this._mapDrawingStyles=new Map([[1,{id:1,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[2,{id:2,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[3,{id:3,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[4,{id:4,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[5,{id:5,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[6,{id:6,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[7,{id:7,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[8,{id:8,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]]),this._defaultStyleTemplate={lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}}createDrawingStyle(e){if(!e)throw new Error("Invalid style definition.");let i;if(e.hasOwnProperty("id")){if(this._mapDrawingStyles.has(e.id))throw new Error("Existing drawing style id.");i=e.id}else{let h=100;for(;this._mapDrawingStyles.has(h);)h++;i=h}const n=JSON.parse(JSON.stringify(e));n.id=i;for(let h in this._defaultStyleTemplate)n.hasOwnProperty(h)||(n[h]=this._defaultStyleTemplate[h]);return this._mapDrawingStyles.set(i,n),n.id}_getDrawingStyle(e,i){if(typeof e!="number")throw new Error("Invalid style id.");const n=this._mapDrawingStyles.get(e);return n?i?JSON.parse(JSON.stringify(n)):n:null}getDrawingStyle(e){return this._getDrawingStyle(e,!0)}getDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(this._mapDrawingStyles.values())))}_updateDrawingStyle(e,i){const n=this._mapDrawingStyles.get(e);if(n)for(let h in i)n.hasOwnProperty(h)&&(n[h]=i[h])}updateDrawingStyle(e,i){this._updateDrawingStyle(e,i);for(let n of this._arrDrawingLayer)n.renderAll()}createDrawingLayer(e,i){const n=d=>{for(let p of this._arrDrawingLayer)if(p.getId()===d)return!0;return!1};if(i===void 0){for(let d=100;;d++)if(!n(d)){i=d;break}}else if(n(i))throw new Error("Existed drawing layer id.");const h=new dh(e,i,this._mapDrawingStyles,{enableRetinaScaling:!1});return h._manager=this,this._arrDrawingLayer.push(h),this._switchPointerEvent(),h}deleteDrawingLayer(e){const i=this.getDrawingLayer(e);if(!i)return;const n=this._arrDrawingLayer;i.dispose(),n.splice(n.indexOf(i),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let i of this._arrDrawingLayer)if(i.getId()===e)return i;return null}getDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._arrDrawingLayer[0].fabricCanvas.getActiveObjects(),i=[];for(let n of e)i.push(n.getDrawingItem());return i}setDimensions(e,i){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,i)}setObjectFit(e){for(let i of this._arrDrawingLayer)i&&i._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){this._arrDrawingLayer.length&&(this._arrDrawingLayer[0].fabricCanvas.wrapperEl.style.display=e?"block":"none")}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class gh{constructor(e){this._controlTarget=null,this._arrUsers=[],this._mapAction_UserArgs=new Map,this._mapProperty_UserValue=new Map,this._mapAction_Callbacks=new Map,this._controlTarget=e}setControlTarget(e){this._controlTarget=e}getControlTarget(){return this._controlTarget}register(e){this._arrUsers.includes(e)||this._arrUsers.push(e)}logout(e){const i=this._arrUsers.indexOf(e);i!==-1&&(this.clearUserDisiredAction({user:e}),this.clearUserDisiredValue({user:e}),this._arrUsers.splice(i,1))}getRegisteredUsers(){return this._arrUsers}ifUserExisted(e){return this._arrUsers.includes(e)}setDisiredValue(e,i,n,h){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");h&&(this._controlTarget[i]=n),this._mapProperty_UserValue.get(i)?this._mapProperty_UserValue.get(i).set(e,n):this._mapProperty_UserValue.set(i,new Map([[e,n]]))}clearUserDisiredValue(e){if(e&&(e.user||e.property)){if(e.property&&e.user){const i=this._mapProperty_UserValue.get(e.property);if(!i)return;i.delete(e.user)}else if(e.property)this._mapProperty_UserValue.delete(e.property);else if(e.user)for(let i of this._mapProperty_UserValue.values())i.delete(e.user)}else this._mapProperty_UserValue=new Map}getValue(e){if(!this._controlTarget)throw new Error("Control target is not set.");return this._controlTarget[e]}getPropertyDisiredValue(e){if(this._mapProperty_UserValue.get(e)){const i=[],n=this._mapProperty_UserValue.get(e);for(let h of n.values())i.push(h);return i}return null}setDisiredAction(e,i,n,h){if(!this._arrUsers.includes(e))throw new Error("Unregistered user.");return n||(n=[]),h?this._controlTarget[i](...n):(this._mapAction_UserArgs.get(i)?this._mapAction_UserArgs.get(i).set(e,n):this._mapAction_UserArgs.set(i,new Map([[e,n]])),this._render(i))}clearUserDisiredAction(e){if(e&&(e.user||e.actionName)){if(e.actionName&&e.user){const i=this._mapAction_UserArgs.get(e.actionName);if(!i)return;i.delete(e.user)}else if(e.actionName)this._mapAction_UserArgs.delete(e.actionName);else if(e.user)for(let i of this._mapAction_UserArgs.values())i.delete(e.user);this.render()}else this._mapAction_UserArgs=new Map}addCallback(e,i){const n=this._mapAction_Callbacks.get(e);n?n.push(i):this._mapAction_Callbacks.set(e,[i])}removeCallback(e,i){const n=this._mapAction_Callbacks.get(e);if(!n)return;const h=n.indexOf(i);h!==-1&&n.splice(h,1)}clearCallback(e){e?this._mapAction_Callbacks.delete(e):this._mapAction_Callbacks.clear()}_fireCallback(e){const i=this._mapAction_Callbacks.get(e);if(i)for(let n of i){if(!n)return;setTimeout(n.bind(this._controlTarget),0)}}_render(e){const i=this._mapAction_UserArgs.get(e);if(!i)throw new Error("Unrecorded action.");if(i.size===this._arrUsers.length){let n=[];for(let h of i.values())h.length>0&&(n=h);if(this._controlTarget[e]){const h=this._controlTarget[e](...n);return this._mapAction_UserArgs.delete(e),this._fireCallback(e),h}}}render(e){if(e)return this._render(e);for(let i of this._mapAction_UserArgs.keys())this._render(i)}}class je{static multiply(e,i){const n=[];for(let h=0;h<3;h++){const d=i.slice(3*h,3*h+3);for(let p=0;p<3;p++){const v=[e[p],e[p+3],e[p+6]].reduce((b,C,x)=>b+C*d[x],0);n.push(v)}}return n}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,i,n){return je.multiply(e,[1,0,0,0,1,0,i,n,1])}static rotate(e,i){var n=Math.cos(i),h=Math.sin(i);return je.multiply(e,[n,-h,0,h,n,0,0,0,1])}static scale(e,i,n){return je.multiply(e,[i,0,0,0,n,0,0,0,1])}}var Ce;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(Ce||(Ce={}));const Ne=(t,e,i,n)=>{if(!i)return t;let h=e+Math.round((t-e)/i)*i;return n&&(h=Math.min(h,n)),h};class te{constructor(){this._maxCvsSideLength=void 0,this._defaultMaxCvsSideLength=null,this._predefinedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],this._mapCameraResolutions=new Map,this._bWebGLSupported=!0,this.extraBindings=[],this._cvsSingleFrameMode=null,this._cvsOriginalImage=null,this._imgWidth=0,this._imgHeight=0,this._singleFrameInputContainer=null,this._clickIptSingleFrameMode=()=>{if(!this._isSingleFrameModeEnabled()||this.getDrawingLayers().some(i=>i.getMode()=="editor"))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),this.singleFrameMode==="camera"?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):this.singleFrameMode!=1&&this.singleFrameMode!=="image"||(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",async()=>{const n=e.files[0];e.value="";const h=await(async x=>{let E=null,O=null;if(typeof createImageBitmap<"u")try{if(E=await createImageBitmap(x),E)return E}catch(k){}var N;return E||(O=await(N=x,new Promise((k,H)=>{let U=URL.createObjectURL(N),ee=new Image;ee.dbrObjUrl=U,ee.src=U,ee.onload=()=>{k(ee)},ee.onerror=Y=>{H(new Error("Can't convert blob to image : "+(Y instanceof Event?Y.type:Y)))}}))),O})(n),d=h instanceof HTMLImageElement?h.naturalWidth:h.width,p=h instanceof HTMLImageElement?h.naturalHeight:h.height;this._imgWidth=d,this._imgHeight=p;const v=x=>{const E=Date.now();if(d===0||p===0)return null;if(x instanceof HTMLImageElement&&!x.complete)throw new Error("The source is not loaded.");const O=this._scanRegion,N=this.getFrameSize(d,p,O,this.maxCvsSideLength);if(!N)return null;let k=!0;d===N.sWidth&&p===N.sHeight&&(k=!1);const H=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase()),U={data:null,region:O?JSON.parse(JSON.stringify(O)):null,sx:N.sx,sy:N.sy,width:N.dWidth,height:N.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:k,toCanvas:this._toCanvas,_sWidth:N.sWidth,_sHeight:N.sHeight,_bUseWebGL:null},ee=this._getImageData(x,d,p,N,null,{pixelFormat:H});if(!ee)return null;const Y=Date.now();return te._onLog&&te._onLog("DCE: _getVideoData(region?) END: "+Y),U.data=ee.data,U.pixelFormat=U.colorMode=ee.pixelFormat,U._bUseWebGL=ee._bUseWebGL,U.timeSpent=Y-E,U.timeStamp=Y,ee.pixelFormat===Ce.GREY?U.stride=U.width:U.stride=4*U.width,U};(x=>{let E=this._cvsSingleFrameMode;if(!E){if(E=document.createElement("canvas"),!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(E),E.style.position="absolute",E.style.width="100%",E.style.height="100%",E.style.left="0",E.style.top="0",E.style.objectFit="contain",E.style.pointerEvents="none",this._cvsSingleFrameMode=E}E.width==d&&E.height==p||(E.width=d,E.height=p);const O=E.getContext("2d");O.clearRect(0,0,E.width,E.height),O.drawImage(x,0,0)})(h),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let x of this._arrScanRegionOverlays)x&&this._updateScanRegionOverlay(x);let b;this._updateDrawingLayersSize();try{b=v(h)}catch(x){throw x}const C=this.mapCameraEvents.get("singleframeacquired");for(let x of C)if(x)try{const E={data:new Uint8Array(b.data),region:JSON.parse(JSON.stringify(b.region)),sx:b.sx,sy:b.sy,width:b.width,height:b.height,stride:b.stride,colorMode:b.colorMode,pixelFormat:b.pixelFormat,timeSpent:b.timeSpent,timeStamp:b.timeStamp,isCropped:b.isCropped,toCanvas:b.toCanvas,_sWidth:b._sWidth,_sHeight:b._sHeight,_bUseWebGL:b._bUseWebGL};await x.apply(this,[E])}catch(E){console.error(E)}}),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";const i=document.createElement("div");i.append(e),i.style.position="absolute",i.style.width="1px",i.style.height="1px",i.style.overflow="hidden",i.style.pointerEvents="none",this._elContainer.prepend(i),this._singleFrameInputContainer=i}e==null||e.click()},this.styleEls=[],this._framePixelFormat=void 0,this._defaultFramePixelFormat="rgba",this.mapPixelFormatString_Enum=new Map([["grey",Ce.GREY],["grey32",Ce.GREY32],["rgba",Ce.RGBA],["rbga",Ce.RBGA],["grba",Ce.GRBA],["gbra",Ce.GBRA],["brga",Ce.BRGA],["bgra",Ce.BGRA]]),this.shaderPixelFormat=Ce.RGBA,this.maxVideoCvsLength=3,this._reusedCvs=null,this._reusedWebGLCvs=null,this._tempDataContainer=null,this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._softwareScale=1,this._scaleCenter={x:0,y:0},this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,_focusArea:null},this._tapFocusEnabled=!0,this._focusSupported=!0,this._tapDoFocus=async e=>{if(this._touchMoved)return void(this._touchMoved=!1);if(!this._tapFocusEnabled||!this._bOpen||this._isSingleFrameModeEnabled()||!this._video||this._video.paused||!this._videoTrack||!this._focusSupported||this.getDrawingLayers().some(de=>de.getMode()=="editor"))return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let i,n,h,d;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),e instanceof MouseEvent)i=e.clientX,n=e.clientY;else{if(!(e instanceof TouchEvent))throw new Error("Unknown event type.");if(!e.changedTouches.length)return;i=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY}const p=this.getVideoFit(),v=this._video.videoWidth,b=this._video.videoHeight,C=this._elContainer.getBoundingClientRect(),x=C.left,E=C.top,O=window.getComputedStyle(this._elContainer),N=parseFloat(O.width),k=parseFloat(O.height),H=N/k,U=v/b;let ee=1;if(p==="contain")U>H?(ee=N/v,h=(i-x)/ee,d=(n-E-(k-N/U)/2)/ee):(ee=k/b,d=(n-E)/ee,h=(i-x-(N-k*U)/2)/ee);else{if(p!=="cover")throw new Error("Unsupported object-fit.");U>H?(ee=k/b,d=(n-E)/ee,h=(i-x+(k*U-N)/2)/ee):(ee=N/v,h=(i-x)/ee,d=(n-E+(N/U-k)/2)/ee)}const Y={x:h+"px",y:d+"px"},G=2*Math.round(Math.min(v,b)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px",re=G;await this._setLocalFocus(Y,G,re,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance),this._focusParameters.taskBackToContinous=setTimeout(()=>{this._videoTrack&&this._videoTrack.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime)},this._touchMoved=!1,this._touchMoveEvent=()=>{this._touchMoved=!0},this._recordedStates={},this.playCallbackInfo=null,this._toCanvas=function(){const e=document.createElement("canvas");let i;if(e.width=this.width,e.height=this.height,(this.pixelFormat||this.colorMode)==="grey"){i=new Uint8ClampedArray(this.width*this.height*4);for(let h=0;h<i.length;h+=4)i[h]=this.data[h/4],i[h+1]=this.data[h/4],i[h+2]=this.data[h/4],i[h+3]=255}else i=new Uint8ClampedArray(this.data.buffer);const n=new ImageData(i,this.width,this.height);return e.getContext("2d").putImageData(n,0,0),e},this._onCameraSelChange=async()=>{await this.selectCamera(this._selCam.value),this._bOpen||this.stop()},this._onResolutionSelChange=async()=>{let e,i;if(this._selRsl&&this._selRsl.selectedIndex!=-1){let n=this._selRsl.options[this._selRsl.selectedIndex];e=n.getAttribute("data-width"),i=n.getAttribute("data-height")}await this.setResolution(e,i),this._bOpen||this.stop()},this._onCloseBtnClick=()=>{this.close(!0)},this._bOpen=!1,this.isCameraEnhancer=!0,this.isDisposed=!1,this.disposed=!1,this.videoSrc=null,this.cameraOpenTimeout=4e3,this.videoSettings={video:{width:{ideal:1280},height:{ideal:720},facingMode:{ideal:"environment"}}},this.iPlayRound=0,this.promisePlay=null,this._ifSaveLastUsedCamera=!1,this.ifSkipCameraInspection=!1,this._allCameras=[],this._currentCamera=null,this._videoTrack=null,this._lastDeviceId=void 0,this._vc_bPlayingVideoBeforeHide=!1,this._ev_documentHideEvent=()=>{if(!this._isSingleFrameModeEnabled()){if(document.visibilityState==="visible"){if(te._onLog&&te._onLog("DCE: document visible."),this._bOpen&&this._vc_bPlayingVideoBeforeHide){if(this.videoSrc)this._video.play();else if(this._video.srcObject){const e=this._video.srcObject.getTracks()[0];if(this._video.srcObject.active&&e)if(e.muted&&["iPhone","iPad","Mac"].includes(Oe.OS)){if(Oe.version>=17)return;this.play()}else this._video.play();else this.play()}}}else if(document.visibilityState==="hidden")if(te._onLog&&te._onLog("DCE: document hidden."),["iPhone","iPad","Mac"].includes(Oe.OS)){if(this._vc_bPlayingVideoBeforeHide=!0,Oe.version>=17)return;this._video&&this._video.pause()}else this._video&&!this._video.paused?(this._vc_bPlayingVideoBeforeHide=!0,this._video.pause()):this._vc_bPlayingVideoBeforeHide=!1}},this.containerClassName="dce-video-container",this._elContainer=null,this._videoContainer=null,this._video=null,this.videoFit="contain",this._cvsScanRegion=null,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=2,this._bShowScanRegionMask=!0,this._bShowScanRegionLaser=void 0,this._defaultBShowScanRegionLaser=!1,this._scanRegion=null,this._arrScanRegionOverlays=[],this._layerBaseCvs=null,this._drawingLayerOfTip=null,this._tipArgs={x:void 0,y:void 0,width:void 0,duration:void 0,autoShowSuggestedTip:void 0},this._hideTipTimeoutId=null,this.onTipSuggested=null,this._cvsViewDecorator=null,this._decoratorType=[],this._decoratorArea=null,this._viewDecoratorInfo={rectangle:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},focus:{lineWidth:4,strokeStyle:"rgb(254,142,20)",fillStyle:"transparent",maskFillStyle:"transparent"},crossline:{lineWidth:2,strokeStyle:"rgb(254,142,20)"},crosshair:{lineWidth:4,strokeStyle:"rgb(254,142,20)"}},this._croppingRegions=void 0,this._defaultCroppingRegions=[null],this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0,this._loopInterval=void 0,this._defaultLoopInterval=0,this._maxNumberOfFramesInBuffer=void 0,this._defaultMaxNumberOfFramesInBuffer=1,this._frameQueue=[],this._bFetchingLoopStarted=!1,this._refreshInterval=void 0,this._defaultRefreshInterval=-1,this._updateLayersTimeout=500,this._updateLayers=()=>{this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none");for(let e of this._arrScanRegionOverlays)e&&(e.style.display="none");this._resizeTimeoutId&&clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=setTimeout(()=>{if(!this.isDisposed||!this.disposed){this.ifShowScanRegionMask&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this.showScanRegionLaser(),this._cvsViewDecorator&&this.showViewDecorator(),this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let e of this._arrScanRegionOverlays)e&&(e.style.display="",this._updateScanRegionOverlay(e));this._updateDrawingLayersSize(),this._updateVideoContainerStyle()}},this._updateLayersTimeout)},this._windowResizeListener=()=>{this._windowWidth!==document.documentElement.clientWidth&&(this._windowWidth=document.documentElement.clientWidth,this._updateLayers())},this.mapCameraEvents=new Map([["cameraopen",[]],["cameraclose",[]],["camerachange",[]],["resolutionchange",[]],["played",[]],["singleframeacquired",[]],["frameaddedtobuffer",[]]]),this._controler=null,navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this._singleFrameMode=!1:this._singleFrameMode=!0}static getVersion(){return this._version}static async detectEnvironment(){return await(async()=>({wasm:lh,worker:ch,getUserMedia:Ao,camera:await hh(),browser:Oe.browser,version:Oe.version,OS:Oe.OS}))()}static set engineResourcePath(e){if(this._hasEngineResourceLoaded)throw new Error("`engineResourcePath` is not allowed to change after `createInstance` is called.");te._engineResourcePath=(i=>{if(i==null&&(i="./"),!zi){let n=document.createElement("a");n.href=i,i=n.href}return i.endsWith("/")||(i+="/"),i})(e)}static get engineResourcePath(){return this._engineResourcePath}static isStorageAvailable(e){let i;try{i=window[e];const n="__storage_test__";return i.setItem(n,n),i.removeItem(n),!0}catch(n){return n instanceof DOMException&&(n.code===22||n.code===1014||n.name==="QuotaExceededError"||n.name==="NS_ERROR_DOM_QUOTA_REACHED")&&i&&i.length!==0}}static isDCEFrame(e){return!(!e||typeof e!="object"||Array.isArray(e))&&"data"in e&&"region"in e&&"sx"in e&&"sy"in e&&"width"in e&&"height"in e&&("colorMode"in e||"pixelFormat"in e)&&"timeSpent"in e&&"timeStamp"in e&&"isCropped"in e&&"toCanvas"in e&&"_sWidth"in e&&"_sHeight"in e&&"_bUseWebGL"in e}static async testCameraAccess(){try{if(!navigator||!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return{ok:!1,message:"Insecure context."};(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()})}catch(e){if(e.name==="OverconstrainedError"||e.name==="NotFoundError")return{ok:!1,message:"No camera detected."};if(e.name==="NotAllowedError")return{ok:!1,message:"No permission to access camera."};if(e.name==="AbortError")return{ok:!1,message:"Some problem occurred which prevented the device from being used."};if(e.name==="NotReadableError")return{ok:!1,message:"A hardware error occurred."};if(e.name==="SecurityError")return{ok:!1,message:"User media support is disabled."};throw e}return{ok:!0,message:"Successfully accessed the camera."}}set maxCvsSideLength(e){if(e<=0)throw new Error("Invalid value.");this._maxCvsSideLength=e}get maxCvsSideLength(){if(this._maxCvsSideLength!==void 0)return this._maxCvsSideLength;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxCvsSideLength");if(e&&e.length===1)return e[0]}return this._defaultMaxCvsSideLength}static set defaultUIElementURL(e){te._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=te._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",te.engineResourcePath)}getUIElement(){return this.UIElement}async setUIElement(e){if(this._bOpen)throw new Error("It is not allowed to change the UIElement when the camera is open.");if(typeof e=="string"||e instanceof String){if(!e.trim().startsWith("<")){let n=await fetch(e);if(!n.ok)throw Error("setUIElement(elementOrUrl): Network Error: "+n.statusText);e=await n.text()}if(!e.trim().startsWith("<"))throw Error("setUIElement(elementOrUrl): Can't get valid HTMLElement.");let i=document.createElement("div");i.innerHTML=e;for(let n=0;n<i.childElementCount;++n){let h=i.children[n];h instanceof HTMLStyleElement&&(this.styleEls.push(h),document.head.append(h))}(e=i.childElementCount==1?i.children[0]:i).remove()}this.UIElement=e,this._uiOriginalState={display:e&&e.style.display,inDom:document.body.contains(e)}}appendAndShowUI(){this.UIElement&&(this.UIElement.parentNode||(this.UIElement.style.position="fixed",this.UIElement.style.left="0",this.UIElement.style.top="0",document.body.append(this.UIElement)),this.UIElement.style.display=="none"&&(this.UIElement.style.display=""))}hideUI(){this.UIElement&&(this.UIElement.style.display="none")}get singleFrameMode(){return this._singleFrameMode}set singleFrameMode(e){var i;if(typeof e!="boolean"&&!["image","camera"].includes(e))throw new Error("Invalid value.");if(this._bOpen)throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");this._singleFrameMode=e;const n=(i=this._singleFrameInputContainer)===null||i===void 0?void 0:i.firstElementChild;n&&(e==="camera"?(n.setAttribute("capture",""),n.setAttribute("accept","image/*")):e!=1&&e!=="image"||(n.removeAttribute("capture"),n.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")))}set frameColorMode(e){this._framePixelFormat=e}get frameColorMode(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set framePixelFormat(e){this._framePixelFormat=e}get framePixelFormat(){if(this._framePixelFormat!==void 0)return this._framePixelFormat;if(this._controler){const e=this._controler.getPropertyDisiredValue("framePixelFormat")||this._controler.getPropertyDisiredValue("frameColorMode");if(e&&e.length===1)return e[0]}return this._defaultFramePixelFormat}set bOpen(e){if(this._bOpen=e,e){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let i of this._arrScanRegionOverlays)i&&this._updateScanRegionOverlay(i);this._updateDrawingLayersSize(),this.ifShowScanRegionMask?this.showScanRegionMask():this.hideScanRegionMask(),this.ifShowScanRegionLaser?this.showScanRegionLaser():this.hideScanRegionLaser(),this.showViewDecorator(),this.showScanRegionOverlays(),this._drawingLayersManager.setVisible(!0)}else this._softwareScale=1}set ifSaveLastUsedCamera(e){e?te.isStorageAvailable("localStorage")?this._ifSaveLastUsedCamera=!0:(this._ifSaveLastUsedCamera=!1,console.warn("Local storage is unavailable")):this._ifSaveLastUsedCamera=!1}get ifSaveLastUsedCamera(){return this._ifSaveLastUsedCamera}get video(){return this._video}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,this._video&&(this._video.style.objectFit=e,!this._isSingleFrameModeEnabled())){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let i of this._arrScanRegionOverlays)i&&this._updateScanRegionOverlay(i);this._updateVideoContainerStyle(),this._drawingLayersManager.setObjectFit(e)}}getVideoFit(){return this.videoFit}_showElClassName(){this._videoContainer&&this._videoContainer.classList.add("div-video-container"),this._cvsScanRegion&&this._cvsScanRegion.classList.add("cvs-scan-region-mask"),this._cvsViewDecorator&&this._cvsViewDecorator.classList.add("cvs-view-decorator"),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.classList.add("div-scan-region-overlay-container"),this._layerBaseCvs&&this._layerBaseCvs.classList.add("cvs-drawing-layer-base"),this._layerBaseCvs&&this._layerBaseCvs.parentElement.classList.add("div-drawing-layer-container"),this._cvsOriginalImage&&this._cvsOriginalImage.classList.add("cvs-original-image"),this._cvsSingleFrameMode&&this._cvsSingleFrameMode.classList.add("cvs-single-frame"),this._singleFrameInputContainer&&this._singleFrameInputContainer.classList.add("div-single-frame-input-container")}_hideElClassName(){this._videoContainer&&(this._videoContainer.className=""),this._cvsScanRegion&&(this._cvsScanRegion.className=""),this._cvsViewDecorator&&(this._cvsViewDecorator.className=""),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.className=""),this._layerBaseCvs&&(this._layerBaseCvs.className=""),this._layerBaseCvs&&(this._layerBaseCvs.className=""),this._cvsOriginalImage&&(this._cvsOriginalImage.className=""),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.className=""),this._singleFrameInputContainer&&(this._singleFrameInputContainer.className="")}set ifShowScanRegionMask(e){this._bShowScanRegionMask=e,e?this.showScanRegionMask():this.hideScanRegionMask()}get ifShowScanRegionMask(){return this._bShowScanRegionMask}showScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display=="none"&&(this._cvsScanRegion.style.display=""),this._recordedStates.maskShow=!0)}hideScanRegionMask(){this._cvsScanRegion&&(this._cvsScanRegion.style.display="none",this._recordedStates.maskShow=!1)}set ifShowScanRegionLaser(e){this._bShowScanRegionLaser=e,e?this.showScanRegionLaser():this.hideScanRegionLaser()}get ifShowScanRegionLaser(){if(this._bShowScanRegionLaser!==void 0)return this._bShowScanRegionLaser;if(this._controler){const e=this._controler.getPropertyDisiredValue("ifShowScanRegionLaser");if(e&&e.length){let i=0;for(let n of e)n||i++;return i!==this._controler.getRegisteredUsers().length}}return this._defaultBShowScanRegionLaser}showScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block"),this._recordedStates.laserShow=!0)}hideScanRegionLaser(){this._divScanLight&&(this._divScanLight.style.display="none",this._recordedStates.laserShow=!1)}_checkValidRegion(e){return!(e!==null&&(!e||!(e.hasOwnProperty("regionLeft")&&e.hasOwnProperty("regionTop")&&e.hasOwnProperty("regionRight")&&e.hasOwnProperty("regionBottom")&&e.hasOwnProperty("regionMeasuredByPercentage"))||e.regionLeft<0||e.regionTop<0||e.regionRight<0||e.regionBottom<0||e.regionMeasuredByPercentage&&(e.regionLeft>100||e.regionTop>100||e.regionRight>100||e.regionBottom>100)))}set scanRegion(e){if(!this._checkValidRegion(e))throw new Error("Invalid region.");this._scanRegion=JSON.parse(JSON.stringify(e)),this._updateScanRegionCanvas(),this._updateScanAreaDiv();for(let i of this._arrScanRegionOverlays)i&&this._updateScanRegionOverlay(i)}setScanRegion(e){this.scanRegion=e}getScanRegion(){return JSON.parse(JSON.stringify(this._scanRegion))}_calculateCvsSize(){var e,i;let n,h,d;if(this._isSingleFrameModeEnabled()?(n=this._imgWidth,h=this._imgHeight,d="contain"):(n=(e=this._video)===null||e===void 0?void 0:e.videoWidth,h=(i=this._video)===null||i===void 0?void 0:i.videoHeight,d=this.getVideoFit()),!n||!h)throw new Error("Invalid content dimensions.");return{width:n,height:h,objectFit:d}}addScanRegionOverlayCanvas(){this._assertOpen();const e=document.createElement("canvas");if(this._updateScanRegionOverlay(e),!this._scanRegionOverlayContainer){const i=document.createElement("div");if(this._scanRegionOverlayContainer=i,i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%",i.style.overflow="hidden",i.style.pointerEvents="none",this._layerBaseCvs)this._layerBaseCvs.parentElement.after(i);else if(this._cvsScanRegion)this._cvsScanRegion.after(i);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(i);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(i);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(i)}this._recordedStates.overlayShow=!0}return this._scanRegionOverlayContainer.append(e),this._arrScanRegionOverlays.push(e),e}removeScanRegionOverlayCanvas(e){const i=this._arrScanRegionOverlays.indexOf(e);i!==-1&&(e.remove(),this._arrScanRegionOverlays.splice(i,1))}_updateScanRegionOverlay(e){if(!e)return;let i;try{i=this._calculateCvsSize()}catch(re){if((re.message||re)==="Invalid content dimensions.")return;throw re}const{width:n,height:h,objectFit:d}=i;if(n<=0||h<=0)return e.width=0,void(e.height=0);const p=this._getRegionInPixels(n,h,this._scanRegion),v=this.getFrameSize(n,h,this._scanRegion,this.maxCvsSideLength),b=v.dWidth,C=v.dHeight;e.width==b&&e.height==C||(e.width=b,e.height=C);const x=window.getComputedStyle(this._elContainer),E=parseFloat(x.width),O=parseFloat(x.height),N=E/O,k=n/h;let H,U,ee,Y,G=1;d==="contain"?(k>N?(G=E/n,H=0,U=(O-h*G)/2):(G=O/h,H=(E-n*G)/2,U=0),H+=p.regionLeft*G,U+=p.regionTop*G,ee=(p.regionRight-p.regionLeft)*G,Y=(p.regionBottom-p.regionTop)*G):d==="cover"?(k>N?(G=O/h,H=p.regionLeft*G-(n*G-E)/2,U=p.regionTop*G):(G=E/n,H=p.regionLeft*G,U=p.regionTop*G-(h*G-O)/2),ee=(p.regionRight-p.regionLeft)*G,Y=(p.regionBottom-p.regionTop)*G):(H=0,U=0,ee=0,Y=0),e.style.position="absolute",e.style.left=H+"px",e.style.top=U+"px",e.style.width=ee+"px",e.style.height=Y+"px"}showScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display=="none"&&(this._scanRegionOverlayContainer.style.display=""),this._recordedStates.overlayShow=!0)}hideScanRegionOverlays(){this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none",this._recordedStates.overlayShow=!1)}setViewDecorator(e,i){if(!e)return void(this._cvsViewDecorator&&(this._cvsViewDecorator.remove(),this._cvsViewDecorator=null));if(!i)throw new Error("Invalid area.");this._assertOpen();let n=[];if(typeof e=="string"?n.push(e):Array.isArray(e)&&(n=JSON.parse(JSON.stringify(e))),!this._cvsViewDecorator){if(this._cvsViewDecorator=document.createElement("canvas"),this._scanRegionOverlayContainer)this._scanRegionOverlayContainer.after(this._cvsViewDecorator);else if(this._layerBaseCvs)this._layerBaseCvs.parentElement.after(this._cvsViewDecorator);else if(this._cvsScanRegion)this._cvsScanRegion.after(this._cvsViewDecorator);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsViewDecorator);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsViewDecorator);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsViewDecorator)}this._recordedStates.decoratorShow=!0}this._decoratorArea=JSON.parse(JSON.stringify(i)),this._decoratorType.length=0;const h=["rectangle","focus"],d=["crossline","crosshair"];let p=!1,v=!1;for(let b of n)b=b.toLowerCase(),h.includes(b)&&!p&&(p=!0,this._decoratorType.push(b)),d.includes(b)&&!v&&(v=!0,!this._decoratorType.includes(b)&&this._decoratorType.push(b));this._updateViewDecorator()}getViewDecorator(){return{type:JSON.parse(JSON.stringify(this._decoratorType)),area:JSON.parse(JSON.stringify(this._decoratorArea)),canvas:this._cvsViewDecorator}}showViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display=="none"&&(this._cvsViewDecorator.style.display=""),this._recordedStates.decoratorShow=!0)}hideViewDecorator(){this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none",this._recordedStates.decoratorShow=!1)}setViewDecoratorLineWidth(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("lineWidth"))throw new Error(`It is not allowed to change the property 'lineWidth' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].lineWidth=i,this._updateViewDecorator()}setViewDecoratorStrokeStyle(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("strokeStyle"))throw new Error(`It is not allowed to change the property 'strokeStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].strokeStyle=i,this._updateViewDecorator()}setViewDecoratorFillStyle(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("fillStyle"))throw new Error(`It is not allowed to change the property 'fillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].fillStyle=i,this._updateViewDecorator()}setViewDecoratorMaskFillStyle(e,i){if(typeof e!="string")throw new Error("The 'type' should be a string.");if(e=e.toLowerCase(),!this._viewDecoratorInfo.hasOwnProperty(e))throw new Error(`The type of '${e}' doesn't exist.`);if(!this._viewDecoratorInfo[e].hasOwnProperty("maskFillStyle"))throw new Error(`It is not allowed to change the property 'maskFillStyle' when the decorator type is '${e}'.`);this._viewDecoratorInfo[e].maskFillStyle=i,this._updateViewDecorator()}_updateViewDecorator(){if(!this._bOpen||!this._cvsViewDecorator||!this._decoratorArea)return;let e;if(this._isSingleFrameModeEnabled())e="contain";else{if(!this._video)return;e=this.getVideoFit()}const i=this._cvsViewDecorator;i.style.position="absolute",i.style.width="100%",i.style.height="100%",i.style.left="0",i.style.top="0",i.style.objectFit=e,i.style.pointerEvents="none";const n=this.getVisibleRegion(!0);if(!n)return;const h=n.regionRight-n.regionLeft,d=n.regionBottom-n.regionTop;if(i.width==h&&i.height==d||(i.width=h,i.height=d),h<=0||d<=0)return;const p=i.getContext("2d");p.clearRect(0,0,i.width,i.height);const v=this._decoratorArea.x/100*h,b=this._decoratorArea.y/100*d,C=this._decoratorArea.width/100*h,x=this._decoratorArea.height/100*d;for(let E of this._decoratorType){if(E==="rectangle"){p.fillStyle=this._viewDecoratorInfo.rectangle.maskFillStyle,p.fillRect(0,0,i.width,i.height),p.clearRect(Math.round(v),Math.round(b),Math.round(C),Math.round(x)),p.fillStyle=this._viewDecoratorInfo.rectangle.fillStyle,p.fillRect(Math.round(v),Math.round(b),Math.round(C),Math.round(x)),p.lineWidth=this._viewDecoratorInfo.rectangle.lineWidth,p.strokeStyle=this._viewDecoratorInfo.rectangle.strokeStyle;const O=p.lineWidth/2;p.strokeRect(Math.round(v-O),Math.round(b-O),Math.round(C+p.lineWidth),Math.round(x+p.lineWidth))}if(E==="focus"){p.fillStyle=this._viewDecoratorInfo.focus.maskFillStyle,p.fillRect(0,0,i.width,i.height),p.clearRect(Math.round(v),Math.round(b),Math.round(C),Math.round(x)),p.fillStyle=this._viewDecoratorInfo.focus.fillStyle,p.fillRect(Math.round(v),Math.round(b),Math.round(C),Math.round(x)),p.lineWidth=this._viewDecoratorInfo.focus.lineWidth,p.strokeStyle=this._viewDecoratorInfo.focus.strokeStyle;const O=p.lineWidth/2,N=[0,.25,.75,1],k=[0,.25,.75,1];p.beginPath();for(let H=0;H<N.length;H++)if(H==0||H==3)for(let U=0;U<k.length;U+=2)p.moveTo(Math.round(v+N[H]*C),Math.round(b+k[U]*x)),p.lineTo(Math.round(v+N[H]*C),Math.round(b+k[U+1]*x));for(let H=0;H<k.length;H++)if(H==0||H==3)for(let U=0;U<N.length;U+=2)p.moveTo(Math.round(v+N[U]*C-O),Math.round(b+k[H]*x)),p.lineTo(Math.round(v+N[U+1]*C+O),Math.round(b+k[H]*x));p.stroke()}if(E==="crossline"&&(p.beginPath(),p.lineWidth=this._viewDecoratorInfo.crossline.lineWidth,p.strokeStyle=this._viewDecoratorInfo.crossline.strokeStyle,p.moveTo(Math.round(v),Math.round(b+x/2)),p.lineTo(Math.round(v+C),Math.round(b+x/2)),p.moveTo(Math.round(v+C/2),Math.round(b)),p.lineTo(Math.round(v+C/2),Math.round(b+x)),p.stroke()),E==="crosshair"){p.beginPath();const O=.05*Math.min(C,x);p.lineWidth=this._viewDecoratorInfo.crosshair.lineWidth,p.strokeStyle=this._viewDecoratorInfo.crosshair.strokeStyle,p.moveTo(Math.round(v+(C-O)/2),Math.round(b+x/2)),p.lineTo(Math.round(v+(C+O)/2),Math.round(b+x/2)),p.moveTo(Math.round(v+C/2),Math.round(b+(x-O)/2)),p.lineTo(Math.round(v+C/2),Math.round(b+(x+O)/2)),p.stroke()}}}getVisibleRegion(e){let i;this._assertOpen();try{i=this._calculateCvsSize()}catch(v){if((v.message||v)==="Invalid content dimensions.")return null;throw v}const{width:n,height:h,objectFit:d}=i;let p=(()=>{const v=parseFloat(window.getComputedStyle(this._elContainer).width),b=parseFloat(window.getComputedStyle(this._elContainer).height);let C,x={regionBottom:h,regionRight:n,regionLeft:0,regionTop:0,regionMeasuredByPercentage:!1};return d==="cover"?v/b<n/h?(C=b/h,x.regionLeft=Math.floor((n-v/C)/2),x.regionRight=Math.ceil(n-x.regionLeft),x.regionTop=0,x.regionBottom=h):(C=v/n,x.regionTop=Math.floor((h-b/C)/2),x.regionBottom=Math.ceil(h-x.regionTop),x.regionLeft=0,x.regionRight=n):d==="none"&&(v<n&&b<h?(x.regionLeft=Math.floor((n-v)/2),x.regionRight=Math.ceil(n-x.regionLeft),x.regionTop=Math.floor((h-b)/2),x.regionBottom=Math.ceil(h-x.regionTop)):v<n?(x.regionLeft=Math.floor((n-v)/2),x.regionRight=Math.ceil(n-x.regionLeft),x.regionTop=0,x.regionBottom=h):b<h&&(x.regionTop=Math.floor((h-b)/2),x.regionBottom=Math.ceil(h-x.regionTop),x.regionLeft=0,x.regionRight=n)),x})();return e?p.regionMeasuredByPercentage=!1:(p.regionBottom=Math.ceil(p.regionBottom/h*100),p.regionRight=Math.ceil(p.regionRight/n*100),p.regionLeft=Math.floor(p.regionLeft/n*100),p.regionTop=Math.floor(p.regionTop/h*100),p.regionMeasuredByPercentage=!0),p}setScanRegionMaskStyle(e){e&&(e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._updateScanRegionCanvas())}_getRegionInPixels(e,i,n){if(!(e<=0||i<=0))return n?n.regionMeasuredByPercentage?{regionLeft:Math.round(n.regionLeft/100*e),regionTop:Math.round(n.regionTop/100*i),regionRight:Math.round(n.regionRight/100*e),regionBottom:Math.round(n.regionBottom/100*i),regionMeasuredByPercentage:!1}:JSON.parse(JSON.stringify(n)):{regionLeft:0,regionTop:0,regionRight:e,regionBottom:i,regionMeasuredByPercentage:!1}}_updateScanRegionCanvas(){if(!this._bOpen)return;let e;try{e=this._calculateCvsSize()}catch(b){if((b.message||b)==="Invalid content dimensions.")return;throw b}const{width:i,height:n,objectFit:h}=e;if(i<=0||n<=0)return void(this._cvsScanRegion&&(this._cvsScanRegion.width=0,this._cvsScanRegion.height=0));const d=this._getRegionInPixels(i,n,this._scanRegion);if(!this._cvsScanRegion){if(this._cvsScanRegion=document.createElement("canvas"),this._cvsOriginalImage)this._cvsOriginalImage.after(this._cvsScanRegion);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(this._cvsScanRegion);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(this._cvsScanRegion)}this._recordedStates.maskShow=!0}const p=this._cvsScanRegion;p.style.position="absolute",p.style.width="100%",p.style.height="100%",p.style.left="0",p.style.top="0",p.style.objectFit=h,p.style.pointerEvents="none",p.width==i&&p.height==n||(p.width=i,p.height=n);const v=p.getContext("2d");if(v.clearRect(0,0,p.width,p.height),d.regionLeft!=0||d.regionRight!=i||d.regionTop!=0||d.regionBottom!=n){const b=d.regionLeft,C=d.regionTop,x=d.regionRight-d.regionLeft,E=d.regionBottom-d.regionTop;v.fillStyle=this.regionMaskFillStyle,v.fillRect(0,0,p.width,p.height),v.clearRect(Math.round(b),Math.round(C),Math.round(x),Math.round(E)),v.strokeStyle=this.regionMaskStrokeStyle,v.lineWidth=this.regionMaskLineWidth;const O=v.lineWidth/2;v.strokeRect(Math.round(b-O),Math.round(C-O),Math.round(x+v.lineWidth),Math.round(E+v.lineWidth))}}_updateScanAreaDiv(){if(!this._bOpen)return;let e;try{e=this._calculateCvsSize()}catch(U){if((U.message||U)==="Invalid content dimensions.")return;throw U}const{width:i,height:n,objectFit:h}=e;if(!this._divScanArea)return;if(i<=0||n<=0)return this._divScanArea.style.width="0",void(this._divScanArea.style.height="0");const d=this._getRegionInPixels(i,n,this._scanRegion),p=window.getComputedStyle(this._elContainer),v=parseFloat(p.width),b=parseFloat(p.height),C=v/b,x=i/n;let E,O,N,k,H=1;if(h==="contain")C<x?(H=v/i,E=0,O=(b-n*H)/2):(H=b/n,E=(v-i*H)/2,O=0),E+=d.regionLeft*H,O+=d.regionTop*H,N=(d.regionRight-d.regionLeft)*H,k=(d.regionBottom-d.regionTop)*H;else if(h==="cover")if(C<x){H=b/n,E=d.regionLeft*H-(i*H-v)/2,E=Math.max(E,0),E=Math.min(E,parseFloat(p.width)),O=d.regionTop*H;let U=d.regionRight*H-(i*H-v)/2;U=Math.max(U,0),U=Math.min(U,parseFloat(p.width)),N=U-E,k=(d.regionBottom-d.regionTop)*H}else{H=v/i,E=d.regionLeft*H,O=d.regionTop*H-(n*H-b)/2,O=Math.max(O,0),O=Math.min(O,parseFloat(p.height));let U=d.regionBottom*H-(n*H-b)/2;U=Math.max(U,0),U=Math.min(U,parseFloat(p.height)),N=(d.regionRight-d.regionLeft)*H,k=U-O}else E=0,O=0,N=0,k=0;this._divScanArea.style.left=E+"px",this._divScanArea.style.top=O+"px",this._divScanArea.style.width=N+"px",this._divScanArea.style.height=k+"px"}set croppingRegions(e){this._croppingRegions=e,this._bFetchingLoopStarted&&(this.bIncreaseRegionIndexAuto&&(this._croppingRegionIndex=0),this._fetchingLoop(!1))}get croppingRegions(){if(this._croppingRegions!==void 0)return this._croppingRegions;if(this._controler){const e=this._controler.getPropertyDisiredValue("croppingRegions");if(e&&e.length===1)return e[0]}return this._defaultCroppingRegions}set croppingRegionIndex(e){e<0?(this.bIncreaseRegionIndexAuto=!0,this._croppingRegionIndex=0):(this.bIncreaseRegionIndexAuto=!1,this._croppingRegionIndex=e)}get croppingRegionIndex(){return this._croppingRegionIndex}set loopInterval(e){if(e<0)throw new Error("'Invalid value.");this._loopInterval=e,this._bFetchingLoopStarted&&this._fetchingLoop(!1)}get loopInterval(){if(this._loopInterval!==void 0)return this._loopInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("loopInterval");if(e&&e.length===1)return e[0]}return this._defaultLoopInterval}set maxNumberOfFramesInBuffer(e){if(e<=0)throw new Error("Invalid value.");for(this._maxNumberOfFramesInBuffer=e;this._frameQueue&&this._frameQueue.length>this.maxNumberOfFramesInBuffer;)this._frameQueue.shift()}get maxNumberOfFramesInBuffer(){if(this._maxNumberOfFramesInBuffer!==void 0)return this._maxNumberOfFramesInBuffer;if(this._controler){const e=this._controler.getPropertyDisiredValue("maxNumberOfFramesInBuffer");if(e&&e.length===1)return e[0]}return this._defaultMaxNumberOfFramesInBuffer}get numberOfFramesInBuffer(){return this._frameQueue.length}set refreshInterval(e){this._refreshInterval=e}get refreshInterval(){if(this._refreshInterval!==void 0)return this._refreshInterval;if(this._controler){const e=this._controler.getPropertyDisiredValue("refreshInterval");if(e&&e.length===1)return e[0]}return this._defaultRefreshInterval}static async createInstance(e){let i=new te;(typeof e=="string"||e instanceof String)&&(e=JSON.parse(e));for(let n in e)i[n]=e[n];return this._hasEngineResourceLoaded=!0,te.onWarning&&(location&&location.protocol==="file:"?setTimeout(()=>{te.onWarning&&te.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):window.isSecureContext!==!1&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{te.onWarning&&te.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),i._drawingLayersManager=new fh,i}static async playVideo(e,i,n){if(!e)throw new Error("Invalid 'videoEl'.");if(!i)throw new Error("Invalid 'source'.");return typeof i=="string"||i instanceof String?e.src=i:e.srcObject=i,new Promise((h,d)=>{let p;const v=()=>{e.removeEventListener("loadstart",x),e.removeEventListener("abort",E),e.removeEventListener("play",O),e.removeEventListener("error",N)},b=()=>{p&&clearTimeout(p),v(),h(e)},C=k=>{p&&clearTimeout(p),v(),d(k)},x=()=>{e.addEventListener("abort",E,{once:!0})},E=()=>{const k=new Error("Video playing was interrupted.");k.name="AbortError",C(k)},O=()=>{b()},N=()=>{C(new Error(`Video error ${e.error.code}: ${e.error.message}.`))};e.addEventListener("loadstart",x,{once:!0}),e.autoplay?(e.addEventListener("play",O,{once:!0}),e.addEventListener("error",N,{once:!0})):(e.load(),e.play().then(()=>{b()}).catch(k=>{C(k)})),n&&(p=setTimeout(()=>{v(),d(new Error("Failed to play video. Timeout."))},n))})}static findBestRearCameraInIOS(e){if(!e||!e.length)return null;const i=["back","baksidan","bakre","bak","\u5F8C\u7F6E","\u540E\u7F6E","\u80CC\u9762","\u062E\u0644\u0641\u064A\u0629","\u0437\u0430\u0434\u043D\u0430","posteriore","posterior","zadn\xED","bagside","r\xFCck","\u03C0\u03AF\u03C3\u03C9","trasera","taka","arri\xE8re","\u05D0\u05D7\u05D5\u05E8\u05D9\u05EA","\u092C\u0948\u0915","stra\u017Enja","h\xE1ts\xF3","belakang","a\u0440\u0442\u049B\u044B","\uD6C4\uBA74","achterzijde","tylny","traseira","spate","\u0437\u0430\u0434\u043D\u044F\u044F","\u0437\u0430\u0434\u043D\u0435\u0439","zadn\xE1","\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07","arka","sau"],n=["triple","\u4E09\u955C\u5934","\u4E09\u93E1\u982D","\u30C8\u30EA\u30D7\u30EB","\u062B\u0644\u0627\u062B\u064A\u0629","\u0442\u0440\u043E\u0439\u043D\u0430","trojn\xFD","\u03C4\u03C1\u03B9\u03C0\u03BB\u03AE","kolmois","\u05DE\u05E9\u05D5\u05DC\u05E9\u05EA","\u091F\u094D\u0930\u093F\u092A\u0932","trostruka","tiga","tripla","\u04AF\u0448\u0442\u0456\u043A","\uD2B8\uB9AC\uD50C","trippelt","trippel","tr\xF3jobiektywowy","tripl\u0103","\u0442\u0440\u043E\u0439\u043D\u0430\u044F","trojit\xE1","\u0E2A\u0E32\u0E21","\xFC\xE7l\xFC","\u043F\u043E\u0442\u0440\u043E\u0454\u043D\u0430","ba camera"],h=["dual wide","dual-weitwinkel","dual con gran angular","dual","doble","double","\u53CC\u5E7F\u89D2","\u96D9\u5EE3\u89D2","\u30C7\u30E5\u30A2\u30EB\u5E83\u89D2","\u0645\u0632\u062F\u0648\u062C\u0629 \u0639\u0631\u064A\u0636\u0629","\u0434\u0432\u043E\u0439\u043D\u0430 \u0448\u0438\u0440\u043E\u043A\u043E\u044A\u0433\u044A\u043B\u043D\u0430","du\xE1ln\xED \u0161iroko\xFAhl\xFD","\u03B4\u03B9\u03C0\u03BB\u03AE \u03B5\u03C5\u03C1\u03B5\u03AF\u03B1","laajakulmainen kaksois","\u05DB\u05E4\u05D5\u05DC\u05D4 \u05E8\u05D7\u05D1\u05D4","\u0921\u094D\u092F\u0941\u0905\u0932 \u0935\u093E\u0907\u0921","dvostruka \u0161iroka","kett\u0151s, sz\xE9les l\xE1t\xF3sz\xF6g\u0171","ganda","doppia con grandangolo","\u049B\u043E\u0441 \u043A\u0435\u04A3 \u0431\u04B1\u0440\u044B\u0448\u0442\u044B","\uB4C0\uC5BC \uC640\uC774\uB4DC","dwikamera","dobbelt vidvinkelkamera","dwuobiektywowy","dupla grande-angular","grande angular dupla","dubl\u0103","\u0434\u0432\u043E\u0439\u043D\u0430\u044F \u0448\u0438\u0440\u043E\u043A\u043E\u0443\u0433\u043E\u043B\u044C\u043D\u0430\u044F","du\xE1lna \u0161irokouhl\xE1","dubbel vidvinkel","\u0E04\u0E39\u0E48\u0E14\u0E49\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07\u0E21\u0E38\u0E21\u0E01\u0E27\u0E49\u0E32\u0E07","\xE7ift geni\u015F","\u0437\u0434\u0432\u043E\u0454\u043D\u0430 \u0448\u0438\u0440\u043E\u043A\u043E\u043A\u0443\u0442\u043D\u0430","k\xE9p r\u1ED9ng m\u1EB7t sau"],d=e.filter(b=>{const C=b.label.toLowerCase();return i.some(x=>C.includes(x))});if(!d.length)return null;const p=d.find(b=>{const C=b.label.toLowerCase();return n.some(x=>C.includes(x))});if(p)return p.deviceId;const v=d.find(b=>{const C=b.label.toLowerCase();return h.some(x=>C.includes(x))});return v?v.deviceId:d[0].deviceId}static findBestRearCamera(e){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(Oe.OS))return te.findBestRearCameraInIOS(e);const i=["rear","back","r\xFCck","arri\xE8re","trasera","tr\xE1s","traseira","posteriore","posterior","\u540E\u9762","\u5F8C\u9762","\u80CC\u9762","\u540E\u7F6E","\u5F8C\u7F6E","\u80CC\u7F6E","\u0437\u0430\u0434\u043D\u0435\u0439","\u062E\u0644\u0641\u064A\u0629","\uD6C4","arka","achterzijde","\u0E2B\u0E25\u0E31\u0E07","baksidan","bagside","sau","bak","tylny","taka","\u05D0\u05D7\u05D5\u05E8\u05D9\u05EA","\u03C0\u03AF\u03C3\u03C9","spate","h\xE1ts\xF3","zadn\xED","darrere","zadn\xE1","\u0437\u0430\u0434\u043D\u044F","stra\u017Enja","belakang","\u092C\u0948\u0915","\u0437\u0430\u0434\u043D\u0430","a\u0440\u0442\u049B\u044B","\u0437\u0430\u0434\u043D\u044F\u044F","bakre","\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07"];for(let n of e){const h=n.label.toLowerCase();if(h&&i.some(d=>h.includes(d))&&/\b0(\b)?/.test(h))return n.deviceId}return["Android","HarmonyOS"].includes(Oe.OS)?e[e.length-1].deviceId:null}_isSingleFrameModeEnabled(){return this.singleFrameMode!=0}async play(e,i,n,h){let d;if(this._video&&this.videoSrc){te._onLog&&(d=Date.now(),te._onLog("DCE: start loading static video: "+d));const b=await te.playVideo(this._video,this.videoSrc,this.cameraOpenTimeout);if(te._onLog&&te._onLog("DCE: finish loading static video. Costs: "+(Date.now()-d)),!this._video)return b.pause(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};const C={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.playCallbackInfo=JSON.parse(JSON.stringify(C));const x=this.mapCameraEvents.get("played");for(let E of x){if(!E)continue;const O=JSON.parse(JSON.stringify(C));setTimeout(()=>{this.isDisposed&&this.disposed||E.apply(this,[O])},0)}return this._recordedStates.videoPlaying=!0,C}if(this._isSingleFrameModeEnabled())return h&&h.notTriggerSingleFrameClick||this._clickIptSingleFrameMode(),this.playCallbackInfo={width:0,height:0,deviceId:null},{width:0,height:0,deviceId:null};if(!this._video)throw new Error("'video' is null or undefined.");const p=++this.iPlayRound;if(this.promisePlay&&(await this.promisePlay,p<this.iPlayRound))return this.playCallbackInfo={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId},{width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};this.promisePlay=(async()=>{var b;try{this._video&&this._video.srcObject&&this.stop(),te._onLog&&te._onLog("DCE: ======before video========");const C=()=>{if(!this._video)throw O&&O.getTracks().forEach(re=>{re.stop()}),this._videoTrack=null,this._currentCamera=null,new Error("'video' is null or undefined.")},x=this.getVideoSettings();let E,O;if(typeof x.video=="boolean"&&(x.video={}),e)delete x.video.facingMode,x.video.deviceId={exact:e};else if(!x.video.deviceId){if(this._lastDeviceId)delete x.video.facingMode,x.video.deviceId={exact:this._lastDeviceId};else if(this.ifSaveLastUsedCamera&&te.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete x.video.facingMode,x.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const re=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),de=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));re&&de&&(x.video.width=re,x.video.height=de)}else if(!this.ifSkipCameraInspection){if(x.video.facingMode){if(await this.getAllCameras(!1),!this._video)throw new Error("'video' is null or undefined.");let re=x.video.facingMode;if(re instanceof Array&&re.length&&(re=re[0]),re=re.exact||re.ideal||re,re==="environment"){E=!0;const de=te.findBestRearCamera(this._allCameras);de&&(delete x.video.facingMode,x.video.deviceId={exact:de})}}}}i&&(x.video.width={ideal:i}),n&&(x.video.height={ideal:n}),te._onLog&&te._onLog("DCE: ======try getUserMedia========");let N=[0,500],k=null;const H=async re=>{for(let de of N){de&&await new Promise(fe=>setTimeout(fe,de)),C();try{te._onLog&&te._onLog("DCE: ask "+JSON.stringify(re)),O=await navigator.mediaDevices.getUserMedia(re);break}catch(fe){if(C(),fe.name==="NotFoundError"||fe.name==="NotAllowedError")throw fe;k=fe,te._onLog&&te._onLog("DCE: "+fe.message||fe)}}C()};let U;if(await H(x),O||(te._onLog&&te._onLog("DCE: ======try getUserMedia again========"),U=JSON.parse(JSON.stringify(x)),typeof U.video=="object"&&(["iPhone","iPad"].includes(Oe.OS)?(i>=1280||n>=1280?U.video.width=1280:i>=640||n>=640?U.video.width=640:(i<640||n<640)&&(U.video.width=320),delete U.video.height):E&&!x.video.deviceId?(delete U.video.facingMode,this._allCameras.length&&(U.video.deviceId={ideal:this._allCameras[this._allCameras.length-1].deviceId})):U.video=!0),te._onLog&&te._onLog("DCE: "+U),await H(U)),O||(N=[1e3,2e3],await H(x)),O||await H(U),!O)throw k;const ee=()=>{const re=O.getVideoTracks();let de,fe;if(re.length&&(de=this._videoTrack=re[0]),this._video&&de){const _e=de.getSettings();if(_e){for(let y of this._allCameras)if(_e.deviceId===y.deviceId){y._checked=!0,y.label=de.label,fe=y;break}}}this._currentCamera=fe};if(await this.getAllCameras(!1),C(),E&&!this.ifSkipCameraInspection){ee();const re=te.findBestRearCamera(this._allCameras),de=(b=this._currentCamera)===null||b===void 0?void 0:b.deviceId;re&&re!=de&&(O.getTracks().forEach(fe=>{fe.stop()}),N=[0,500,1e3,2e3],x.video.deviceId={exact:re},await H(x))}te._onLog&&te._onLog("DCE: ======play video========"),C(),await te.playVideo(this._video,O,this.cameraOpenTimeout),C(),te._onLog&&te._onLog("DCE: ======played video========"),this._bgLoading&&(this._bgLoading.style.animationPlayState="paused");const Y="got "+this._video.videoWidth+"x"+this._video.videoHeight;this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",this._video.videoWidth),this._optGotRsl.setAttribute("data-height",this._video.videoHeight),this._optGotRsl.innerText=Y,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got")),te._onLog&&te._onLog("DCE: got "+Y),ee(),this._renderSelCameraInfo();const G={width:this._video.videoWidth,height:this._video.videoHeight,deviceId:this._currentCamera&&this._currentCamera.deviceId};if(G.deviceId&&(this._lastDeviceId=G.deviceId,this.ifSaveLastUsedCamera&&te.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",this._lastDeviceId),x.video.width&&x.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(x.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(x.video.height))))),!h||!h.notTriggerPlayedEvent){const re=this.mapCameraEvents.get("played");for(let de of re){if(!de)continue;const fe=JSON.parse(JSON.stringify(G));setTimeout(()=>{this.isDisposed&&this.disposed||de.apply(this,[fe])},0)}}return this.promisePlay=null,G}catch(C){throw this.promisePlay=null,this._bgLoading&&(this._bgLoading.style.display="none"),C.name==="NotFoundError"&&(DOMException?C=new DOMException("No camera available, please use a device with an accessible camera.",C.name):(C=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),C}})(),te._onLog&&(d=Date.now(),te._onLog("DCE: start opening camera: "+d));const v=await this.promisePlay;return te._onLog&&te._onLog("DCE: finish opening camera. Costs: "+(Date.now()-d)),this.playCallbackInfo=JSON.parse(JSON.stringify(v)),this._recordedStates.videoPlaying=!0,v}async resume(){this._assertOpen(),this._video&&(await this._video.play(),this._recordedStates.videoPlaying=!0),this.ifShowScanRegionLaser&&this.showScanRegionLaser()}pause(){this._assertOpen(),this._video&&(this._video.pause(),this._recordedStates.videoPlaying=!1),this.ifShowScanRegionLaser&&this.hideScanRegionLaser()}isPaused(){var e;return!this._isSingleFrameModeEnabled()&&((e=this._video)===null||e===void 0?void 0:e.paused)===!0}_bindUI(){if(!this.UIElement)throw new Error("Need to define `UIElement` before opening.");const e=[this.UIElement];for(let i=0;i<e.length;++i)for(let n of e[i].children)e.push(n);for(let i of e){if(!this._video&&i.classList.contains(this.containerClassName)){this._elContainer=i;const n=document.createElement("video");n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.objectFit=this.getVideoFit(),n.setAttribute("autoplay","true"),n.setAttribute("playsinline","true"),n.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(Oe.OS)&&Oe.version>=17&&n.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),this._video=n;const h=document.createElement("div");h.append(n),h.style.position="absolute",h.style.left="0",h.style.top="0",h.style.width="100%",h.style.height="100%",h.style.overflow="hidden",this._videoContainer=h,i.prepend(h)}else!this._divScanArea&&i.classList.contains("dce-scanarea")?this._divScanArea=i:!this._divScanLight&&i.classList.contains("dce-scanlight")?this._divScanLight=i:!this._bgLoading&&i.classList.contains("dce-bg-loading")?this._bgLoading=i:!this._bgCamera&&i.classList.contains("dce-bg-camera")?this._bgCamera=i:!this._selCam&&i.classList.contains("dce-sel-camera")?this._selCam=i:!this._selRsl&&i.classList.contains("dce-sel-resolution")?(this._selRsl=i,this.videoSrc||this._isSingleFrameModeEnabled()||this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&i.classList.contains("dce-opt-gotResolution")?this._optGotRsl=i:!this._btnClose&&i.classList.contains("dce-btn-close")?this._btnClose=i:!this._selMinLtr&&i.classList.contains("dlr-sel-minletter")?(this._selMinLtr=i,this._selMinLtr.options.length||(this._selMinLtr.innerHTML=[this._optGotMinLtr?"":'<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._optGotMinLtr||this._selMinLtr.options[0])):!this._optGotMinLtr&&i.classList.contains("dlr-opt-gotMinLtr")&&(this._optGotMinLtr=i);if(this.extraBindings&&this.extraBindings.length)for(let n of this.extraBindings)try{n(i)}catch(h){}}if(!this._video)throw this._unbindUI(),Error(`Can not find the video container element with class '${this.containerClassName}'`);this._isSingleFrameModeEnabled()||this.videoSrc?(this._isSingleFrameModeEnabled()&&(this._elContainer&&(this._elContainer.addEventListener("click",this._clickIptSingleFrameMode),this._elContainer.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._elContainer&&(["Android","HarmonyOS"].includes(Oe.OS)?(this._elContainer.addEventListener("touchend",this._tapDoFocus),this._elContainer.addEventListener("touchmove",this._touchMoveEvent)):this._elContainer.addEventListener("click",this._tapDoFocus)),this._selCam&&(this._selCam.style.display="block",this._selCam.addEventListener("change",this._onCameraSelChange)),this._selRsl&&(this._selRsl.style.display="block",this._selRsl.addEventListener("change",this._onResolutionSelChange)),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._bgLoading&&(this._bgLoading.style.display="block")),this._btnClose&&this._btnClose.addEventListener("click",this._onCloseBtnClick),document.addEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&(this._resizeObserver||(this._resizeObserver=new ResizeObserver(i=>{for(let n of i)n.target===this._elContainer&&this._updateLayers()})),this._elContainer&&this._resizeObserver.observe(this._elContainer)),this._windowWidth=document.documentElement.clientWidth,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){this._isSingleFrameModeEnabled()?(this._elContainer&&(this._elContainer.removeEventListener("click",this._clickIptSingleFrameMode),this._elContainer.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._bgLoading&&(this._bgLoading.style.display="none"),this._elContainer&&(this._elContainer.removeEventListener("click",this._tapDoFocus),this._elContainer.removeEventListener("touchend",this._tapDoFocus),this._elContainer.removeEventListener("touchmove",this._touchMoveEvent)),this._selCam&&this._selCam.removeEventListener("change",this._onCameraSelChange),this._selRsl&&this._selRsl.removeEventListener("change",this._onResolutionSelChange),this._btnClose&&this._btnClose.removeEventListener("click",this._onCloseBtnClick),this.hideScanRegionLaser(),this.hideViewDecorator(),this.hideScanRegionOverlays(),this._drawingLayersManager.setVisible(!1),this._hideOriginalImageCvs(),this._videoContainer&&this._videoContainer.remove(),this._video=null,this._videoContainer=null,this._elContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._cvsScanRegion&&(this._cvsScanRegion.remove(),this._cvsScanRegion=null),this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),this._cvsSingleFrameMode&&(this._cvsSingleFrameMode.remove(),this._cvsSingleFrameMode=null),document.removeEventListener("visibilitychange",this._ev_documentHideEvent),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_assertOpen(){if(!this._bOpen)throw Error("The camera is not open.")}async open(e){this.UIElement||await this.setUIElement(te.defaultUIElementURL),this._bindUI(),e&&this.appendAndShowUI();let i=await this.play();this.bOpen=!0,this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this._isSingleFrameModeEnabled()&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1));const n=this.mapCameraEvents.get("cameraopen");for(let h of n){if(!h)continue;const d=JSON.parse(JSON.stringify(i));setTimeout(()=>{this.isDisposed&&this.disposed||h.apply(this,[d])},0)}return i}close(e){if(!this._video)return;this.stop(),this._hideOriginalImage(!1),this.hideTip(),this._unbindUI(),e&&this.hideUI(),this.stopFetchingLoop(),this.bOpen=!1;const i=this.mapCameraEvents.get("cameraclose");for(let n of i){if(!n)continue;const h={width:0,height:0,deviceId:null};setTimeout(()=>{this.isDisposed&&this.disposed||n.apply(this,[h])},0)}}stop(){this._video&&this._video.srcObject&&(te._onLog&&te._onLog("DCE: ======stop video========"),this._video.srcObject.getTracks().forEach(e=>{e.stop()}),this._video.srcObject=null,this._videoTrack=null,this._currentCamera=null),this._video&&this.videoSrc&&(te._onLog&&te._onLog("DCE: ======stop existing video========"),this._video.pause(),this._video.currentTime=0),this._bgLoading&&(this._bgLoading.style.animationPlayState=""),this._frameQueue.length=0,this._reusedCvs&&this._reusedCvs.ctx2d&&this._reusedCvs.ctx2d.clearRect(0,0,this._reusedCvs.width,this._reusedCvs.height),this.forceLoseContext()}async getAllCameras(e=!0){let i=(await navigator.mediaDevices.enumerateDevices()).filter(d=>d.kind==="videoinput");if(e&&i&&i.length&&!i[0].deviceId){let d=await navigator.mediaDevices.getUserMedia({video:!0});i=(await navigator.mediaDevices.enumerateDevices()).filter(p=>p.kind==="videoinput"),d.getTracks().forEach(p=>{p.stop()})}const n=[],h=[];if(this._allCameras)for(let d of this._allCameras)d._checked&&h.push(d);for(let d=0;d<i.length;d++){let p,v=i[d];for(let b of h)if(v.deviceId==b.deviceId){p=b;break}p||(p={deviceId:v.deviceId,label:v.label?v.label:"camera "+d,_checked:!1}),p.deviceId&&n.push(p)}return this._allCameras=n,te._onLog&&te._onLog("DCE: "+JSON.stringify(this._allCameras)),n}_renderSelCameraInfo(){if(!this._selCam)return;let e;this._selCam.textContent="";for(let i of this._allCameras){const n=document.createElement("option");n.value=i.deviceId,n.innerText=i.label,this._selCam.append(n),i.deviceId&&this._currentCamera&&this._currentCamera.deviceId==i.deviceId&&(e=n)}this._selCam.value=e?e.value:""}getSelectedCamera(){if(!this._bOpen){let e="";const i=this.videoSettings.video.deviceId;i&&(e=i.exact||i.ideal||i);for(let n of this._allCameras)if(n.deviceId===e)return JSON.parse(JSON.stringify(n));return{deviceId:e,label:"",_checked:!1}}return this._currentCamera}async selectCamera(e){let i="";if(e&&(i=e.deviceId||e),this.videoSettings.video.deviceId={exact:i},!this._bOpen||this._video.paused)return null;let n=null;this._currentCamera&&(n=this._currentCamera.deviceId);const h=this._video.videoWidth,d=this._video.videoHeight,p=await this.play(e.deviceId||e);if(this._focusParameters.fds=null,this._focusParameters.kTimeout=void 0,this._focusSupported=!0,this._tapFocusEnabled&&!this._isSingleFrameModeEnabled()&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,this._focusParameters.fds||(this._focusSupported=!1,this._tapFocusEnabled=!1)),n!==p.deviceId){const v=this.mapCameraEvents.get("camerachange");for(let b of v){if(!b)continue;const C=JSON.parse(JSON.stringify(p));setTimeout(()=>{this.isDisposed&&this.disposed||b.apply(this,[C])},0)}}if(h!==p.width||d!==p.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let b of this._arrScanRegionOverlays)b&&this._updateScanRegionOverlay(b);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const v=this.mapCameraEvents.get("resolutionchange");for(let b of v){if(!b)continue;const C=JSON.parse(JSON.stringify(p));setTimeout(()=>{this.isDisposed&&this.disposed||b.apply(this,[C])},0)}}return p}getResolution(){if(this._bOpen)return[this._video.videoWidth,this._video.videoHeight];{let e=0,i=0;const n=this.videoSettings.video.width,h=this.videoSettings.video.height;return n&&(e=n.exact||n.ideal||n),h&&(i=h.exact||h.ideal||h),[e,i]}}async setResolution(e,i){let n,h;if(e instanceof Array?(n=e[0],h=e[1]):(n=e,h=i),this.videoSettings.video.width={ideal:n},this.videoSettings.video.height={ideal:h},!this._bOpen||this._video.paused)return null;const d=this._video.videoWidth,p=this._video.videoHeight,v=await this.play(null,n,h);if(d!==v.width||p!==v.height){this._updateScanRegionCanvas(),this._updateScanAreaDiv(),this._updateViewDecorator();for(let C of this._arrScanRegionOverlays)C&&this._updateScanRegionOverlay(C);this._updateDrawingLayersSize(),this._updateVideoContainerStyle();const b=this.mapCameraEvents.get("resolutionchange");for(let C of b){if(!C)continue;const x=JSON.parse(JSON.stringify(v));setTimeout(()=>{this.isDisposed&&this.disposed||C.apply(this,[x])},0)}}return v}async getResolutions(e){var i,n;let h="";const d=(v,b)=>{const C=this._mapCameraResolutions.get(v);if(!C||!C.length)return!1;for(let x of C)if(x[0]===b.width&&x[1]===b.height)return!0;return!1},p=async(v,b,C)=>{const x={video:{deviceId:{exact:v},width:{ideal:b},height:{ideal:C}}};let E=null;try{E=await navigator.mediaDevices.getUserMedia(x)}catch(k){return null}if(!E)return null;const O=E.getVideoTracks();let N=null;try{const k=O[0].getSettings();N={width:k.width,height:k.height}}catch(k){const H=document.createElement("video");H.srcObject=E,N={width:H.videoWidth,height:H.videoHeight},H.srcObject=null}return O.forEach(k=>{k.stop()}),N};if(!this._bOpen){const v=(n=(i=this.videoSettings)===null||i===void 0?void 0:i.video)===null||n===void 0?void 0:n.deviceId;if(!v||(h=v.hasOwnProperty("exact")?this.videoSettings.video.deviceId.exact:v.hasOwnProperty("ideal")?this.videoSettings.video.deviceId.ideal:this.videoSettings.video.deviceId,!h))return null;let b=this._mapCameraResolutions.get(h);if(b&&!e)return this._mapCameraResolutions.get(h);this._mapCameraResolutions.set(h,[]),b=this._mapCameraResolutions.get(h);for(let C of this._predefinedResolutions){const x=await p(h,C.width,C.height);x&&!d(h,x)&&b.push([x.width,x.height])}return b}if(this._currentCamera){h=this._currentCamera.deviceId;let v=this._mapCameraResolutions.get(h);if(v&&!e)return this._mapCameraResolutions.get(h);this._mapCameraResolutions.set(h,[]),v=this._mapCameraResolutions.get(h);let b=this._videoTrack;for(let C of this._predefinedResolutions){await b.applyConstraints({width:{ideal:C.width},height:{ideal:C.height}});const x=b.getSettings(),E={width:x.width,height:x.height};d(h,E)||v.push([E.width,E.height])}return this._video.srcObject.getTracks().forEach(C=>{C.stop()}),await this.play(h,null,null,{notTriggerPlayedEvent:!0}),v}return null}on(e,i){if(!i)return;const n=this.mapCameraEvents.get(e.toLowerCase());if(!n)throw new Error(`Event '${e}' does not exist.`);n.includes(i)||n.push(i)}off(e,i){const n=this.mapCameraEvents.get(e.toLowerCase());if(!n)throw new Error(`Event '${e}' does not exist.`);const h=n.indexOf(i);h!==-1&&n.splice(h,1)}offAll(e){if(e){if(typeof e=="string"){const i=this.mapCameraEvents.get(e);i&&(i.length=0)}}else for(let i of this.mapCameraEvents.values())i&&(i.length=0)}getVideoSettings(){return JSON.parse(JSON.stringify(this.videoSettings))}updateVideoSettings(e){if(this.videoSettings=JSON.parse(JSON.stringify(e)),this._lastDeviceId=null,this._bOpen)return this.play()}isOpen(){return this._bOpen}getCapabilities(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getCapabilities()' is unavailable in singleFrameMode.");return this._videoTrack&&this._videoTrack.getCapabilities?this._videoTrack.getCapabilities():{}}getCameraSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getCameraSettings()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings():null}getConstraints(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getConstraints()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getConstraints():null}async applyConstraints(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'applyConstraints()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error('"_videoTrack" is null.');if(!this._videoTrack.applyConstraints)throw Error("Not supported.");return await this._videoTrack.applyConstraints(e)}async turnOnTorch(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'turnOnTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!0}]});throw Error("Not supported.")}async turnOffTorch(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'turnOffTorch()' is unavailable in singleFrameMode.");if(this.getCapabilities().torch)return await this._videoTrack.applyConstraints({advanced:[{torch:!1}]});throw Error("Not supported.")}async setColorTemperature(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setColorTemperature()' is unavailable in singleFrameMode.");let i=this.getCapabilities().colorTemperature;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),await this._videoTrack.applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]})}getColorTemperature(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getColorTemperature()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().colorTemperature||0:null}async setExposureCompensation(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setExposureCompensation()' is unavailable in singleFrameMode.");let i=this.getCapabilities().exposureCompensation;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),await this._videoTrack.applyConstraints({advanced:[{exposureCompensation:e}]})}getExposureCompensation(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getExposureCompensation()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().exposureCompensation||0:null}async _setHardwareScale(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setHardwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");if(!this._videoTrack)return;const i=this.getCapabilities().zoom;if(!i)throw new Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),e=Ne(e,i.min,i.step,i.max),await this._videoTrack.applyConstraints({advanced:[{zoom:e}]}),e}_getHardwareScale(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().zoom||1:null}_setSoftwareScale(e,i){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setSoftwareScale()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");i&&this._setScaleCenter(i),this._softwareScale=e,this._scaleVideo(e,i)}_getSoftwareScale(){return this._softwareScale}_setScaleCenter(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_setScaleCenter()' is unavailable in singleFrameMode.");if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid center.");const i=this._video.videoWidth,n=this._video.videoHeight;let h=0,d=0;if(e.x.endsWith("px"))h=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid scale center.");h=parseFloat(e.x)/100*i}if(e.y.endsWith("px"))d=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid scale center.");d=parseFloat(e.y)/100*n}if(h==NaN||d==NaN)throw new Error("Invalid scale center.");this._scaleCenter={x:h,y:d}}_resetScaleCenter(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_resetScaleCenter()' is unavailable in singleFrameMode.");const e=this._video.videoWidth,i=this._video.videoHeight;this._scaleCenter={x:e/2,y:i/2}}_isVideoCenter(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_isVideoCenter()' is unavailable in singleFrameMode.");return e&&e.x==this._video.videoWidth/2&&e.y==this._video.videoHeight/2}async _setZoom(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e<1)throw new RangeError("Invalid value.");this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const i=await this._setHardwareScale(e);let n=this._getHardwareScale();n==1&&i!=1&&(n=i),e>n?this._setSoftwareScale(e/n):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e)}catch(i){if((i.message||i)!=="Not supported.")throw i;this._setSoftwareScale(e)}}async setZoom(e){if(typeof e!="number"&&typeof e!="object")throw new TypeError("Illegal type of argument.");if(typeof e=="number")return this._setZoom(e);if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setZoom()' is unavailable in singleFrameMode.");if(e){if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid value.");e.centerPoint?this._setScaleCenter(e.centerPoint):this._resetScaleCenter();try{if(this._isVideoCenter(this._scaleCenter)){const i=await this._setHardwareScale(e.factor);let n=this._getHardwareScale();n==1&&i!=1&&(n=i),e.factor>n?this._setSoftwareScale(e.factor/n):this._setSoftwareScale(1)}else await this._setHardwareScale(1),this._setSoftwareScale(e.factor)}catch(i){if((i.message||i)!=="Not supported.")throw i;this._setSoftwareScale(e.factor)}}}getZoom(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?this._getHardwareScale()*this._softwareScale:null}getZoomSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getZoom()' is unavailable in singleFrameMode.");return this._videoTrack?{factor:this._getHardwareScale()*this._softwareScale}:null}async resetZoom(){await this.setZoom({factor:1})}async setFrameRate(e){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setFrameRate()' is unavailable in singleFrameMode.");let i=this.getCapabilities().frameRate;if(!i)throw Error("Not supported.");return e<i.min?e=i.min:e>i.max&&(e=i.max),await this._videoTrack.applyConstraints({width:{ideal:Math.max(this._video.videoWidth,this._video.videoHeight)},frameRate:e})}getFrameRate(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getFrameRate()' is unavailable in singleFrameMode.");return this._videoTrack?this._videoTrack.getSettings().frameRate:null}async _setFocus(e,i){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(typeof e!="string")throw Error("Invalid focus mode.");e=e.toLowerCase();const n=this.getCapabilities().focusMode,h=this.getCapabilities().focusDistance;if(!n)throw Error("Not supported.");if(!n.includes(e))throw Error("Unsupported mode.");if(i>=0){if(!h)throw Error("Manual focus unsupported.");return i<h.min?i=h.min:i>h.max&&(i=h.max),i=Ne(i,h.min,h.step,h.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:e,focusDistance:i}]})}return await this._videoTrack.applyConstraints({advanced:[{focusMode:e}]})}async setFocus(e,i){if(typeof e=="string")return this._setFocus(e,i);if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'setFocus()' is unavailable in singleFrameMode.");if(!e)return;const n=this.getCapabilities(),h=n.focusMode,d=n.focusDistance;if(!h)throw Error("Not supported.");if(typeof e.mode!="string")throw Error("Invalid focus mode.");const p=e.mode.toLowerCase();if(!h.includes(p))throw Error("Unsupported focus mode.");if(p!=="manual")return this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:p}]});if(!d)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let v=e.distance;return v<d.min?v=d.min:v>d.max&&(v=d.max),v=Ne(v,d.min,d.step,d.max),this._focusParameters._focusArea=null,await this._videoTrack.applyConstraints({advanced:[{focusMode:p,focusDistance:v}]})}if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const v=e.area.centerPoint;let b=e.area.width,C=e.area.height;if(!b||!C){const x=this._video.videoWidth,E=this._video.videoHeight;b||(b=2*Math.round(Math.min(x,E)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),C||(C=2*Math.round(Math.min(x,E)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters._focusArea={centerPoint:{x:v.x,y:v.y},width:b,height:C},await this._setLocalFocus(v,b,C)}}getFocus(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings().focusMode;return e?e==="continuous"?{mode:e}:{mode:e,distance:this._videoTrack.getSettings().focusDistance}:null}getFocusSettings(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getHardwareScale()' is unavailable in singleFrameMode.");if(!this._videoTrack)return null;const e=this._videoTrack.getSettings(),i=e.focusMode;return i?i==="manual"?this._focusParameters._focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters._focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:i}:null}async _setFocusAndGetContract(e,i){const n=O=>{if(!this._bOpen||!this._videoTrack||this.video.paused||O.focusTaskId!=this._focusParameters.curFocusTaskId){this._bOpen&&this._videoTrack&&!this.video.paused||(this._focusParameters.isDoingFocus=0);const N=new Error(`Focus task ${O.focusTaskId} canceled.`);throw N.name="DeprecatedTaskError",N}this._focusParameters.isDoingFocus===1&&Date.now()-O.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let h;i=Ne(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}),n(e),h=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/i),Math.abs(1/this._focusParameters.fds.max-1/i))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/i)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=i,await new Promise(O=>{setTimeout(O,h)}),n(e);let d=e.focusL-e.focusW/2,p=e.focusT-e.focusH/2,v=e.focusW,b=e.focusH;if(d>=this.video.videoWidth||p>=this.video.videoHeight)throw new Error("Invalid area.");d+v>this.video.videoWidth&&(v=this.video.videoWidth-d),p+b>this.video.videoHeight&&(b=this.video.videoHeight-p);const C=this._getImageData(this.video,this.video.videoWidth,this.video.videoHeight,{sx:d,sy:p,sWidth:v,sHeight:b,dWidth:v,dHeight:b},null,{pixelFormat:Ce.RGBA});if(!C)return this._setFocusAndGetContract(e,i);const x=C.data;let E=0;for(let O=0,N=x.length-8;O<N;++O){let k=x[O]-x[O+8];++O;let H=x[O]-x[O+8];++O;let U=x[O]-x[O+8];++O,E+=k*k+H*H+U*U}return-E}async _doFocusDetail(e,i,n,h,d,p,v){let b;if(i=Ne(i,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),h=Ne(h,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),p?p=Ne(p,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(p=Ne(Math.sqrt((i||this._focusParameters.fds.step)*(h||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),v=await this._setFocusAndGetContract(e,p)),v<=n&&v<=d?b=3:n<d&&n<v?b=1:d<n&&d<v&&(b=2),(h-i)/2<=this._focusParameters.fds.step)return b===3||(b===1?await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:i}]}):b===2&&await this._videoTrack.applyConstraints({advanced:[{focusMode:"manual",focusDistance:h}]})),!0;if(b===1)return await this._doFocusDetail(e,i,n,p,v);if(b===2)return await this._doFocusDetail(e,p,v,h,d);if(b!==3)return n=await this._setFocusAndGetContract(e,i),d=await this._setFocusAndGetContract(e,h),await this._doFocusDetail(e,i,n,h,d);let C=Ne(Math.sqrt((i||this._focusParameters.fds.step)*(p||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),x=Ne(Math.sqrt((h||this._focusParameters.fds.step)*(p||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/C)<=Math.abs(1/this._focusParameters.oldDistance-1/x)){let E=await this._setFocusAndGetContract(e,C);if(E<v)return await this._doFocusDetail(e,i,n,p,v,C,E);if(E==v)return await this._doFocusDetail(e,C,E,p,v);let O=await this._setFocusAndGetContract(e,x);if(E>v&&v<O)return await this._doFocusDetail(e,C,E,x,O,p,v);if(v==O)return await this._doFocusDetail(e,p,v,x,O);if(v>O)return await this._doFocusDetail(e,p,v,h,d,x,O)}else{let E=await this._setFocusAndGetContract(e,x);if(v>E)return await this._doFocusDetail(e,p,v,h,d,x,E);if(v==E)return await this._doFocusDetail(e,p,v,x,E);let O=await this._setFocusAndGetContract(e,C);if(O>v&&v<E)return await this._doFocusDetail(e,C,O,x,E,p,v);if(O==v)return await this._doFocusDetail(e,C,O,p,v);if(O<v)return await this._doFocusDetail(e,i,n,p,v,C,O)}return!1}async _setLocalFocus(e,i,n,h,d){if(this._focusParameters.isDoingFocus==1)return!1;if(!e||typeof e.x!="string"||typeof e.y!="string")throw new Error("Invalid centerPoint.");if(!i||typeof i!="string")throw new Error("Invalid width.");if(!n||typeof n!="string")throw new Error("Invalid height.");const p=this._video.videoWidth,v=this._video.videoHeight;let b=0,C=0;if(e.x.endsWith("px"))b=parseFloat(e.x);else{if(!e.x.endsWith("%"))throw new Error("Invalid centerPoint.");b=parseFloat(e.x)/100*p}if(e.y.endsWith("px"))C=parseFloat(e.y);else{if(!e.y.endsWith("%"))throw new Error("Invalid centerPoint.");C=parseFloat(e.y)/100*v}if(b==NaN||C==NaN)throw new Error("Invalid centerPoint.");let x=0;if(i.endsWith("px"))x=parseFloat(i);else{if(!i.endsWith("%"))throw new Error("Invalid width.");x=parseFloat(i)/100*p}if(x==NaN)throw new Error("Invalid width.");let E=0;if(n.endsWith("px"))E=parseFloat(n);else{if(!n.endsWith("%"))throw new Error("Invalid height.");E=parseFloat(n)/100*v}if(E==NaN)throw new Error("Invalid height.");if(this._softwareScale!==1){const k=this._softwareScale,H=this._scaleCenter;x/=k,E/=k,b=(1-1/k)*H.x+b/k,C=(1-1/k)*H.y+C/k}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const O={focusL:b,focusT:C,focusW:x,focusH:E,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},N=async(k,H,U)=>{try{(H==null||H<this._focusParameters.fds.min)&&(H=this._focusParameters.fds.min),(U==null||U>this._focusParameters.fds.max)&&(U=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let ee=Ne(Math.sqrt(U*(H||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),Y=Ne(Math.sqrt((H||this._focusParameters.fds.step)*ee),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),G=Ne(Math.sqrt(ee*U),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),re=await this._setFocusAndGetContract(k,G),de=await this._setFocusAndGetContract(k,Y),fe=await this._setFocusAndGetContract(k,ee);if(de>fe&&fe<re){const _e=await this._doFocusDetail(k,Y,de,G,re,ee,fe);return this._focusParameters.isDoingFocus=0,_e}if(de<fe&&de<re){let _e=await this._setFocusAndGetContract(k,H);const y=await this._doFocusDetail(k,H,_e,ee,fe,Y,de);return this._focusParameters.isDoingFocus=0,y}if(fe>re&&de>re){let _e=await this._setFocusAndGetContract(k,U);const y=await this._doFocusDetail(k,ee,fe,U,_e,G,re);return this._focusParameters.isDoingFocus=0,y}if(de==fe&&fe<re){const _e=await this._doFocusDetail(k,Y,de,ee,fe);return this._focusParameters.isDoingFocus=0,_e}if(fe==re&&de>fe){const _e=await this._doFocusDetail(k,ee,fe,G,re);return this._focusParameters.isDoingFocus=0,_e}return N(k,H,U)}catch(ee){if(ee.name!=="DeprecatedTaskError")throw ee}};return N(O,h,d)}async enableTapToFocus(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'enableTapToFocus()' is unavailable in singleFrameMode.");if(!this._videoTrack)throw new Error("Video is not playing.");if(!this._focusSupported)throw new Error("Tapping to focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(await this.getCapabilities()).focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,this._tapFocusEnabled=!1,new Error("Tapping to focus unsupported.");this._tapFocusEnabled=!0}disableTapToFocus(){this._tapFocusEnabled=!1}isTapToFocusEnabled(){return this._tapFocusEnabled}_updateVideoContainerStyle(){if(!this._video||this._isSingleFrameModeEnabled())return;const e=this._getSoftwareScale(),i=this._videoContainer;if(this.videoFit==="contain"&&e>1){const n=this._video.videoWidth,h=this._video.videoHeight,d=window.getComputedStyle(this._elContainer),p=parseFloat(d.width),v=parseFloat(d.height),b=n/h;if(p/v<b){let C=p/b;i.style.left="0",i.style.top=(v-C)/2/v*100+"%",i.style.width="100%",i.style.height=C/v*100+"%"}else{let C=v*b;i.style.left=(p-C)/2/p*100+"%",i.style.top="0",i.style.width=C/p*100+"%",i.style.height="100%"}}else i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%"}_scaleVideo(e,i){if(this._video&&!this._isSingleFrameModeEnabled()){if(e<1)throw new RangeError("Invalid scale value.");if(i&&this._setScaleCenter(i),e===1)this._video.style.transform="";else{const n=this.getVideoFit(),h=this._video.videoWidth,d=this._video.videoHeight,p=window.getComputedStyle(this._elContainer),v=parseFloat(p.width),b=parseFloat(p.height),C=v/b,x=h/d;let E=1;n==="contain"?E=C<x?v/(h/e):b/(d/e):n==="cover"&&(E=x>C?b/(h/e):v/(d/e));const O=E*(1-1/e)*(h/2-this._scaleCenter.x),N=E*(1-1/e)*(d/2-this._scaleCenter.y);this._video.style.transform=`translate(${O}px, ${N}px) scale(${e})`}this._updateVideoContainerStyle()}}getFrameSize(e,i,n,h){if(!e||!i)return null;let d,p,v,b,C=e,x=i;const E={regionLeft:0,regionTop:0,regionRight:C,regionBottom:x,regionMeasuredByPercentage:!1};n?(n.regionMeasuredByPercentage?(E.regionLeft=n.regionLeft*C/100,E.regionTop=n.regionTop*x/100,E.regionRight=n.regionRight*C/100,E.regionBottom=n.regionBottom*x/100):(E.regionLeft=n.regionLeft,E.regionTop=n.regionTop,E.regionRight=n.regionRight,E.regionBottom=n.regionBottom),d=Math.round(E.regionLeft),p=Math.round(E.regionTop),C=Math.round(E.regionRight-E.regionLeft),x=Math.round(E.regionBottom-E.regionTop)):(d=0,p=0,C=Math.round(C),x=Math.round(x));const O=Math.max(C,x);if(h&&h>0&&O>h){const N=h/O;C>x?(v=h,b=Math.round(x*N)):(v=Math.round(C*N),b=h)}else v=C,b=x;return v<=0||b<=0?null:{sx:d,sy:p,sWidth:C,sHeight:x,dWidth:v,dHeight:b}}getFrame(){if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'getFrame()' is unavailable in singleFrameMode.");return this._getVideoData()}getImage(){return this.getFrame()}_drawImage(e,i,n,h,d,p,v){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!n||!h)return null;if(i instanceof HTMLVideoElement&&i.readyState!==4||i instanceof HTMLImageElement&&!i.complete)throw new Error("The source is not loaded.");let b;te._onLog&&(b=Date.now(),te._onLog("DCE: _drawImage(), START: "+b));let C=0,x=0,E=n,O=h,N=0,k=0,H=n,U=h;d&&(d.sx&&(C=Math.round(d.sx)),d.sy&&(x=Math.round(d.sy)),d.sWidth&&(E=Math.round(d.sWidth)),d.sHeight&&(O=Math.round(d.sHeight)),d.dx&&(N=Math.round(d.dx)),d.dy&&(k=Math.round(d.dy)),d.dWidth&&(H=Math.round(d.dWidth)),d.dHeight&&(U=Math.round(d.dHeight)));let ee=Ce.RGBA;v&&v.pixelFormat&&(ee=v.pixelFormat);const Y=e;if(!v||!v.bUseWebGL){te._onLog&&te._onLog("DCE: _drawImage() in context2d."),Y.ctx2d||(Y.ctx2d=Y.getContext("2d",{willReadFrequently:!0}));const G=Y.ctx2d;if(!G)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(Y.width<N+H||Y.height<k+U)&&(Y.width=N+H,Y.height=k+U),G.drawImage(i,C,x,E,O,N,k,H,U),te._onLog&&te._onLog("DCE: _drawImage() in context2d end. Costs: "+(Date.now()-b)),{context:G,pixelFormat:Ce.RGBA,_bUseWebGL:!1}}te._onLog&&te._onLog("DCE: _drawImage() in WebGL.");try{(Y.width<N+H||Y.height<k+U)&&(Y.width=N+H,Y.height=k+U,Y.ctxWebGL&&Y.ctxWebGL.viewport(0,0,N+H,k+U));const G=Y.ctxWebGL||Y.getContext("webgl",{antialias:!1})||Y.getContext("experimental-webgl",{antialias:!1});if(!G){te._onLog&&te._onLog("DCE: WebGL unavailable.");const y=new Error("WebGL error: unable to initialize WebGL. Your browser or machine may not support it.");throw y.name="WebGLError",y}if(!Y.ctxWebGL||ee!==this.shaderPixelFormat){Y.ctxWebGL=G;const y=r=>{const o=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,o),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),r.STATIC_DRAW);const c=r.createBuffer();return r.bindBuffer(r.ARRAY_BUFFER,c),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),r.STATIC_DRAW),{positions:o,texCoords:c}},ge=r=>{const o=r.createTexture();return r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),o},me=(r,o)=>{const c=r.createProgram();if(o.forEach(_=>r.attachShader(c,_)),r.linkProgram(c),!r.getProgramParameter(c,r.LINK_STATUS)){const _=new Error(`An error occured linking the program: ${r.getProgramInfoLog(c)}.`);throw _.name="WebGLError",_}return r.useProgram(c),c},we=(r,o,c)=>{const _=r.createShader(o);if(r.shaderSource(_,c),r.compileShader(_),!r.getShaderParameter(_,r.COMPILE_STATUS)){const f=new Error(`An error occured compiling the shader: ${r.getShaderInfoLog(_)}.`);throw f.name="WebGLError",f}return _},a=`
                        attribute vec2 a_position;
                        attribute vec2 a_texCoord;
    
                        uniform mat3 u_matrix;
                        uniform mat3 u_textureMatrix;
    
                        varying vec2 v_texCoord;
                        void main(void) {
                        gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                        v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                        }
                    `;let s="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(ee)&&(s=ee.slice(0,3));const l=`
                        precision mediump float;
                        varying vec2 v_texCoord;
                        uniform sampler2D u_image;
                        uniform float uColorFactor;
    
                        void main() {
                            vec4 sample = texture2D(u_image, v_texCoord);
                            float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                            gl_FragColor = vec4(sample.${s} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                        }
                    `,u=me(G,[we(G,G.VERTEX_SHADER,a),we(G,G.FRAGMENT_SHADER,l)]);this._webGLProgramInfo={program:u,attribLocations:{vertexPosition:G.getAttribLocation(u,"a_position"),texPosition:G.getAttribLocation(u,"a_texCoord")},uniformLocations:{uSampler:G.getUniformLocation(u,"u_image"),uColorFactor:G.getUniformLocation(u,"uColorFactor"),uMatrix:G.getUniformLocation(u,"u_matrix"),uTextureMatrix:G.getUniformLocation(u,"u_textureMatrix")}},this._webGLBuffers=y(G),this._webGLTexture=ge(G),this.shaderPixelFormat=ee}const re=(y,ge,me)=>{y.bindBuffer(y.ARRAY_BUFFER,ge),y.enableVertexAttribArray(me),y.vertexAttribPointer(me,2,y.FLOAT,!1,0,0)},de=(y,ge,me)=>{const we=y.RGBA,a=y.RGBA,s=y.UNSIGNED_BYTE;y.bindTexture(y.TEXTURE_2D,ge),y.texImage2D(y.TEXTURE_2D,0,we,a,s,me)},fe=(y,ge,me,we)=>{y.clearColor(0,0,0,1),y.clearDepth(1),y.enable(y.DEPTH_TEST),y.depthFunc(y.LEQUAL),y.clear(y.COLOR_BUFFER_BIT|y.DEPTH_BUFFER_BIT),re(y,me.positions,ge.attribLocations.vertexPosition),re(y,me.texCoords,ge.attribLocations.texPosition),y.activeTexture(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,we),y.uniform1i(ge.uniformLocations.uSampler,0),y.uniform1f(ge.uniformLocations.uColorFactor,[Ce.GREY,Ce.GREY32].includes(ee)?1:0);let a,s,l=je.translate(je.identity(),-1,-1);l=je.scale(l,2,2),l=je.scale(l,1/y.canvas.width,1/y.canvas.height),a=je.translate(l,N,k),a=je.scale(a,H,U),y.uniformMatrix3fv(ge.uniformLocations.uMatrix,!1,a),s=je.translate(je.identity(),C/n,x/h),s=je.scale(s,E/n,O/h),y.uniformMatrix3fv(ge.uniformLocations.uTextureMatrix,!1,s),y.drawArrays(y.TRIANGLES,0,6)};let _e;if(de(G,this._webGLTexture,i),fe(G,this._webGLProgramInfo,this._webGLBuffers,this._webGLTexture),p){if(p.length<H*U*4)throw new Error("Unexpected size of the 'bufferContainer'.");_e=p}else _e=new Uint8Array(H*U*4);if(G.readPixels(N,k,H,U,G.RGBA,G.UNSIGNED_BYTE,_e),_e[3]!==255){te._onLog&&te._onLog("DCE: WebGL drawing incorrect."),this._bWebGLSupported=!1;const y=new Error("WebGL error: incorrect WebGL drawing.");throw y.name="WebGLError",y}return te._onLog&&te._onLog("DCE: _drawImage() in WebGL end. Costs: "+(Date.now()-b)),{context:G,pixelFormat:ee===Ce.GREY?Ce.GREY32:ee,_bUseWebGL:!0}}catch(G){throw this._bWebGLSupported=!1,G.name="WebGLError",G}}_readCvsData(e,i,n){let h,d=0,p=0,v=e.canvas.width,b=e.canvas.height;if(i&&(i.x&&(d=i.x),i.y&&(p=i.y),i.width&&(v=i.width),i.height&&(b=i.height)),e instanceof WebGLRenderingContext){const C=e;if(n){if(n.length<v*b*4)throw new Error("Unexpected size of the 'bufferContainer'.");C.readPixels(d,p,v,b,C.RGBA,C.UNSIGNED_BYTE,n),h=new Uint8Array(n.buffer,0,v*b*4)}else h=new Uint8Array(v*b*4),C.readPixels(d,p,v,b,C.RGBA,C.UNSIGNED_BYTE,h)}else if(e instanceof CanvasRenderingContext2D){let C;if(C=e.getImageData(d,p,v,b),h=new Uint8Array(C.data.buffer),n){if(n.length<h.length)throw new Error("Unexpected size of the 'bufferContainer'.");n.set(h)}}return h}_transformPixelFormat(e,i,n,h){let d,p;if(te._onLog&&(d=Date.now(),te._onLog("DCE: _transformPixelFormat(), START: "+d)),i===n)return te._onLog&&te._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-d)),h?new Uint8Array(e):e;const v=[Ce.RGBA,Ce.RBGA,Ce.GRBA,Ce.GBRA,Ce.BRGA,Ce.BGRA];if(v.includes(i))if(n===Ce.GREY){p=new Uint8Array(e.length/4);for(let b=0;b<e.length;b+=4){const C=.21*e[b]+.71*e[b+1]+.07*e[b+2];p[b/4]=C}}else if(n===Ce.GREY32){p=h?new Uint8Array(e):e;for(let b=0;b<e.length;b+=4){const C=.21*e[b]+.71*e[b+1]+.07*e[b+2];p[b]=C,p[b+1]=C,p[b+2]=C}}else{if(!v.includes(n))throw new Error("Unable to transform.");if(h){p=new Uint8Array(e);const b=i.indexOf("r"),C=i.indexOf("g"),x=i.indexOf("b"),E=n.indexOf("r"),O=n.indexOf("g"),N=n.indexOf("b");for(let k=0;k<e.length;k+=4)p[k+E]=e[k+b],p[k+O]=e[k+C],p[k+N]=e[k+x]}else{p=e;const b=i.indexOf("r"),C=i.indexOf("g"),x=i.indexOf("b"),E=n.indexOf("r"),O=n.indexOf("g"),N=n.indexOf("b");for(let k=0;k<e.length;k+=4){let H=[e[k],e[k+1],e[k+2]];p[k+E]=H[b],p[k+O]=H[C],p[k+N]=H[x]}}}else if(i===Ce.GREY){if(n!==Ce.GREY32)throw new Error("Unable to transform.");p=new Uint8Array(4*e.length);for(let b=0;b<e.length;b++)p[4*b]=e[b],p[4*b+1]=e[b],p[4*b+2]=e[b],p[4*b+3]=255}else{if(i!==Ce.GREY32)throw new Error("Unable to transform.");if(n!==Ce.GREY)throw new Error("Unable to transform.");p=new Uint8Array(e.length/4);for(let b=0;b<e.length;b+=4)p[b/4]=e[b]}return te._onLog&&te._onLog("DCE: _transformPixelFormat() end. Costs: "+(Date.now()-d)),p}_getImageData(e,i,n,h,d,p){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(!i||!n)return null;if(h.sx>i||h.sy>n||h.sx+h.sWidth>i||h.sy+h.sHeight>n)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let v;te._onLog&&(v=Date.now(),te._onLog("DCE: _getImageData(), START: "+v));const b=Math.round(h.sx),C=Math.round(h.sy),x=Math.round(h.sWidth),E=Math.round(h.sHeight),O=Math.round(h.dWidth),N=Math.round(h.dHeight);let k=Ce.RGBA;p&&p.pixelFormat&&(k=p.pixelFormat);let H,U,ee,Y=this._bWebGLSupported;p&&p.bUseWebGL==0&&(Y=!1),Y?(this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),H=this._reusedWebGLCvs):(this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),H=this._reusedCvs);try{if(Y)if(te._onLog&&te._onLog("DCE: _getImageData() in WebGL."),d)if(k===Ce.GREY){if(ee=new Uint8Array(O*N*4),U=this._drawImage(H,e,i,n,{sx:b,sy:C,sWidth:x,sHeight:E,dWidth:O,dHeight:N},ee,{pixelFormat:k,bUseWebGL:Y}),ee=this._transformPixelFormat(ee,U.pixelFormat,k),d){if(d.length<ee.length)throw new Error("Unexpected size of the 'bufferContainer'.");d.set(ee)}}else U=this._drawImage(H,e,i,n,{sx:b,sy:C,sWidth:x,sHeight:E,dWidth:O,dHeight:N},d,{pixelFormat:k,bUseWebGL:Y}),ee=new Uint8Array(d.buffer,0,O*N*4),ee=this._transformPixelFormat(ee,U.pixelFormat,k);else k===Ce.GREY?((!this._tempDataContainer||this._tempDataContainer.length<O*N*4)&&(this._tempDataContainer=new Uint8Array(O*N*4)),ee=new Uint8Array(this._tempDataContainer.buffer,0,O*N*4)):ee=new Uint8Array(O*N*4),U=this._drawImage(H,e,i,n,{sx:b,sy:C,sWidth:x,sHeight:E,dWidth:O,dHeight:N},ee,{pixelFormat:k,bUseWebGL:Y}),ee=this._transformPixelFormat(ee,U.pixelFormat,k);else if(te._onLog&&te._onLog("DCE: _getImageData() in context2d."),U=this._drawImage(H,e,i,n,{sx:b,sy:C,sWidth:x,sHeight:E,dWidth:O,dHeight:N},null,{pixelFormat:Ce.RGBA,bUseWebGL:Y}),ee=this._readCvsData(U.context,{width:O,height:N},null),ee=this._transformPixelFormat(ee,U.pixelFormat,k),d){if(d.length<ee.length)throw new Error("Unexpected size of the 'bufferContainer'.");d.set(ee)}}catch(G){if(G.name==="WebGLError")return te._onLog&&te._onLog("DCE: _getImageData() in WebGL failed, try again in context2d."),this.forceLoseContext(),this._bWebGLSupported=!1,this._getImageData(e,i,n,{sx:b,sy:C,sWidth:x,sHeight:E,dWidth:O,dHeight:N},d,p);throw G}return te._onLog&&te._onLog("DCE: _getImageData() end. Costs: "+(Date.now()-v)),{data:ee,pixelFormat:k,_bUseWebGL:U._bUseWebGL}}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),this._webGLTexture=null,this._webGLProgramInfo=null,this._webGLBuffers=null,this._reusedWebGLCvs=null}_getVideoData(e,i){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this._isSingleFrameModeEnabled())throw new Error("'_getVideoData()' is unavailable in singleFrameMode.");if(!this._video||this._video.readyState!==4)return null;const n=Date.now();te._onLog&&te._onLog("DCE: _getVideoData() START: "+n);let h=this._scanRegion;i&&i.hasOwnProperty("region")&&(h=i.region);let d=this.mapPixelFormatString_Enum.get(this.framePixelFormat.toLowerCase());i&&i.pixelFormat&&(d=this.mapPixelFormatString_Enum.get(i.pixelFormat.toLowerCase()));let p=this._softwareScale;i&&i.scale&&(p=i.scale);const v=this._video.videoWidth,b=this._video.videoHeight;let C=this._scaleCenter;if(i&&i.scaleCenter){if(typeof i.scaleCenter.x!="string"||typeof i.scaleCenter.y!="string")throw new Error("Invalid scale center.");let H=0,U=0;if(i.scaleCenter.x.endsWith("px"))H=parseFloat(i.scaleCenter.x);else{if(!i.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");H=parseFloat(i.scaleCenter.x)/100*v}if(i.scaleCenter.y.endsWith("px"))U=parseFloat(i.scaleCenter.y);else{if(!i.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");U=parseFloat(i.scaleCenter.y)/100*b}if(H==NaN||U==NaN)throw new Error("Invalid scale center.");C.x=Math.round(H),C.y=Math.round(U)}if(v===0||b===0)return null;const x=this.getFrameSize(v,b,h,this.maxCvsSideLength);if(!x)return null;let E=!0;v===x.sWidth&&b===x.sHeight&&(E=!1);const O={data:null,region:h?JSON.parse(JSON.stringify(h)):null,sx:x.sx,sy:x.sy,width:x.dWidth,height:x.dHeight,colorMode:null,pixelFormat:null,timeSpent:null,timeStamp:null,isCropped:E,toCanvas:this._toCanvas,_sWidth:x.sWidth,_sHeight:x.sHeight,_bUseWebGL:null};p!==1&&(x.sWidth=Math.round(x.sWidth/p),x.sHeight=Math.round(x.sHeight/p),x.sx=Math.round((1-1/p)*C.x+x.sx/p),x.sy=Math.round((1-1/p)*C.y+x.sy/p));const N=this._getImageData(this._video,v,b,x,e,{pixelFormat:d});if(!N)return null;const k=Date.now();return te._onLog&&te._onLog("DCE: _getVideoData() END: "+k),O.data=N.data,O.pixelFormat=O.colorMode=N.pixelFormat,O._bUseWebGL=N._bUseWebGL,O.timeSpent=k-n,O.timeStamp=k,N.pixelFormat===Ce.GREY?O.stride=O.width:O.stride=4*O.width,O}getCurrentRegion(){let e=null;if(this._scanRegion)e=this._scanRegion;else if(this.croppingRegions){if(this._croppingRegionIndex>=this.croppingRegions.length||this._croppingRegionIndex<0)throw new Error("The 'croppingRegionIndex' is out of bounds.");e=this.croppingRegions[this._croppingRegionIndex],this.bIncreaseRegionIndexAuto&&++this._croppingRegionIndex>=this.croppingRegions.length&&(this._croppingRegionIndex=0)}return e}_fetchingLoop(e){if(this.isDisposed&&this.disposed)return;if(!this._bOpen||!this.isFetchingLoopStarted())return void this.stopFetchingLoop();const i=()=>{te._onLog&&te._onLog("DCE: start fetching a frame into buffer: "+Date.now());const h=this.getCurrentRegion();let d=this._getVideoData(null,{region:h});if(!d)return void(te._onLog&&te._onLog("DCE: get a invalid frame, abandon it: "+Date.now()));for(;this._frameQueue&&this._frameQueue.length>=this.maxNumberOfFramesInBuffer;)this._frameQueue.shift();this._frameQueue.push(d),te._onLog&&te._onLog("DCE: finish fetching a frame into buffer: "+Date.now());const p=this.mapCameraEvents.get("frameaddedtobuffer");for(let v of p)v&&setTimeout(()=>{this.isDisposed&&this.disposed||v.apply(this)},0)},n=()=>{this.isDisposed&&this.disposed||(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this.refreshInterval<=0||(this._frameLoopTimeoutId2=setTimeout(()=>{this.isDisposed&&this.disposed||(this._bOpen&&this.isFetchingLoopStarted()?(te._onLog&&te._onLog("DCE: second timeout executes: "+Date.now()),i(),n()):this.stopFetchingLoop())},this.refreshInterval)))};e&&(this._frameQueue.length<this.maxNumberOfFramesInBuffer?(i(),this.refreshInterval>0&&n()):this.refreshInterval===0&&i()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameLoopTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._fetchingLoop(!0)},this.loopInterval)}startFetchingLoop(){if(this.isDisposed&&this.disposed)throw Error("The 'CameraEnhancer' instance has been disposed.");if(this._assertOpen(),this._isSingleFrameModeEnabled())throw Error("'startFetchingLoop()' is unavailable in singleFrameMode.");this.isFetchingLoopStarted()||(this._bFetchingLoopStarted=!0,this._recordedStates.fetchingLoopStart=!0,te._onLog&&te._onLog("DCE: start fetching loop: "+Date.now()),this._fetchingLoop(!0))}isFetchingLoopStarted(){return this._bFetchingLoopStarted}stopFetchingLoop(){this._bFetchingLoopStarted&&(te._onLog&&te._onLog("DCE: stop fetching loop: "+Date.now()),this._frameLoopTimeoutId&&clearTimeout(this._frameLoopTimeoutId),this._frameQueue.length=0,this._bFetchingLoopStarted=!1,this._recordedStates.fetchingLoopStart=!1)}getFrameFromBuffer(e){return this._frameQueue&&this._frameQueue.length?e?e<this._frameQueue.length?(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.splice(e,1)[0]):void 0:(this._frameLoopTimeoutId2&&clearTimeout(this._frameLoopTimeoutId2),this._frameQueue.pop()):null}clearFrameBuffer(){this._frameQueue&&(this._frameQueue.length=0)}_createDrawingLayerBaseCvs(){let e;this._assertOpen();try{e=this._calculateCvsSize()}catch(p){throw p}let{width:i,height:n,objectFit:h}=e;(i<=0||n<=0)&&(i=2,n=2);const d=document.createElement("canvas");if(d.width==i&&d.height==n||(d.width=i,d.height=n),d.style.objectFit=h,this._cvsScanRegion)this._cvsScanRegion.after(d);else if(this._cvsOriginalImage)this._cvsOriginalImage.after(d);else if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(d);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(d)}return d}_updateDrawingLayersSize(e){let i;try{i=e&&e.width&&e.height&&e.objectFit?{width:e.width,height:e.height,objectFit:e.objectFit}:this._calculateCvsSize()}catch(p){if((p.message||p)==="Invalid content dimensions.")return;throw p}const{width:n,height:h,objectFit:d}=i;this._drawingLayersManager.setDimensions({width:n,height:h},{backstoreOnly:!0}),this._drawingLayersManager.setObjectFit(d)}_createDrawingLayer(e){this._layerBaseCvs||(this._layerBaseCvs=this._createDrawingLayerBaseCvs());const i=this._layerBaseCvs;return this._drawingLayersManager.createDrawingLayer(i,e)}deleteDrawingLayer(e){this._drawingLayersManager.deleteDrawingLayer(e),this._drawingLayersManager.getDrawingLayers().length||this._layerBaseCvs&&(this._layerBaseCvs.remove(),this._layerBaseCvs=null)}createDrawingLayer(){return this._createDrawingLayer()}getDrawingLayer(e){return this._drawingLayersManager.getDrawingLayer(e)||([1,2,3].includes(e)?this._createDrawingLayer(e):null)}getDrawingLayers(){return this._drawingLayersManager.getDrawingLayers().filter(e=>e.getId()>=0)}getSelectedDrawingItems(){return this._drawingLayersManager.getSelectedDrawingItems()}createDrawingStyle(e){return this._drawingLayersManager.createDrawingStyle(e)}getDrawingStyle(e){return this._drawingLayersManager.getDrawingStyle(e)}getDrawingStyles(){return this._drawingLayersManager.getDrawingStyles()}updateDrawingStyle(e,i){return this._drawingLayersManager.updateDrawingStyle(e,i)}clearDrawingLayers(){const e=this.getDrawingLayers();for(let i of e)this.deleteDrawingLayer(i.getId())}showTip(e,i,n,h,d=3e3,p=!0){this._assertOpen(),this._tipArgs.x=e,this._tipArgs.y=i,this._tipArgs.width=n,this._tipArgs.autoShowSuggestedTip=!!p,this._drawingLayerOfTip||(this._drawingLayerOfTip=this._createDrawingLayer(-1)),this._tipStyleId||(this._tipStyleId=this.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip.clearDrawingItems();const v=new Ro(h||"",e,i,n,this._tipStyleId);v._fabricObject.paddingTop=15,v._fabricObject.calcTextHeight=function(){for(var b=0,C=0,x=this._textLines.length;C<x;C++)b+=this.getHeightOfLine(C);return b+2*this.paddingTop},v._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},v.setAttribute("backgroundColor","rgba(50, 50, 52, .8)"),v.setAttribute("lineHeight",1.3),v.setAttribute("textAlign","center"),this._drawingLayerOfTip.addDrawingItem(v),this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._tipArgs.duration=d===void 0?3e3:d,this._tipArgs.duration>0&&(this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}_hideTip(){this._drawingLayerOfTip&&(this.deleteDrawingLayer(this._drawingLayerOfTip.getId()),this._drawingLayerOfTip=null,this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId))}hideTip(){this._hideTip(),this._tipArgs.x=null,this._tipArgs.y=null,this._tipArgs.width=null,this._tipArgs.autoShowSuggestedTip=null}updateTipMessage(e){if(!this._drawingLayerOfTip)throw new Error("The Tip is not showing.");this._drawingLayerOfTip.getDrawingItems()[0].setAttribute("text",e),this._drawingLayerOfTip.renderAll(),this._tipArgs.duration>0&&(this._hideTipTimeoutId&&clearTimeout(this._hideTipTimeoutId),this._hideTipTimeoutId=setTimeout(()=>{this.isDisposed&&this.disposed||this._hideTip()},this._tipArgs.duration))}suggestTip(e,i){this._tipArgs.autoShowSuggestedTip&&(this._drawingLayerOfTip?this.updateTipMessage(i):this._tipArgs.x!==void 0&&this.showTip(this._tipArgs.x,this._tipArgs.y,this._tipArgs.width,i,this._tipArgs.duration)),this.onTipSuggested&&setTimeout(()=>{this.isDisposed&&this.disposed||this.onTipSuggested.apply(this,[e,i])},0)}_createControler(){if(this._controler||(this._controler=new gh(this)),this._controler)return this._controler}_destroyControler(){this._controler=null}setOriginalImage(e,i,n){if(!e||!i||!n)throw new Error("Invalid arguments");this._originalImageData={imageData:e,width:i,height:n};let h=this._cvsOriginalImage;h||(h=document.createElement("canvas"),h.style.position="absolute",h.style.width="100%",h.style.height="100%",h.style.left="0",h.style.top="0",h.style.backgroundColor="white",h.style.objectFit="contain",this._cvsOriginalImage=h),h.width===i&&h.height===n||(h.width=i,h.height=n);const d=h.getContext("2d");d.clearRect(0,0,h.width,h.height),e instanceof Uint8Array||e instanceof Uint8ClampedArray?(e instanceof Uint8Array&&(e=new Uint8ClampedArray(e.buffer)),d.putImageData(new ImageData(e,i,n),0,0)):e instanceof HTMLCanvasElement&&d.drawImage(e,0,0),document.body.contains(h)&&h.style.display===""&&this._updateDrawingLayersSize({width:i,height:n,objectFit:"contain"})}getOriginalImage(){return this._originalImageData?Object.assign({},this._originalImageData):null}async deleteOriginalImage(){await this.hideOriginalImage(),this._cvsOriginalImage&&(this._cvsOriginalImage.remove(),this._cvsOriginalImage=null),this._originalImageData=null}_showOriginalImageCvs(){this._cvsOriginalImage&&this._cvsOriginalImage.style.display=="none"&&(this._cvsOriginalImage.style.display="")}_hideOriginalImageCvs(){this._cvsOriginalImage&&(this._cvsOriginalImage.style.display="none")}showOriginalImage(){if(!this._originalImageData)throw new Error("No original image is set.");const e=this._cvsOriginalImage;if(e.style.display===""&&document.body.contains(e))return;const{width:i,height:n}=this._originalImageData;if(this._updateDrawingLayersSize({width:i,height:n,objectFit:"contain"}),this._bOpen&&(this._video&&!this._video.paused&&this._video.pause(),this._bFetchingLoopStarted&&(this.stopFetchingLoop(),this._recordedStates.fetchingLoopStart=!0),this.ifShowScanRegionMask&&this._cvsScanRegion&&(this._cvsScanRegion.style.display="none"),this.ifShowScanRegionLaser&&this._divScanLight&&(this._divScanLight.style.display="none"),this._cvsViewDecorator&&(this._cvsViewDecorator.style.display="none"),this._scanRegionOverlayContainer&&(this._scanRegionOverlayContainer.style.display="none"),this._selCam&&(this._selCam.parentElement.style.display="none")),!document.body.contains(e))if(this._cvsSingleFrameMode)this._cvsSingleFrameMode.after(e);else{if(!this._videoContainer)throw new Error("Unable to find video element");this._videoContainer.after(e)}this._showOriginalImageCvs()}async _hideOriginalImage(e){this._originalImageData&&this._cvsOriginalImage&&this._cvsOriginalImage.style.display!=="none"&&(this._updateDrawingLayersSize(),this._bOpen&&e&&(this._video&&this._recordedStates.videoPlaying&&await this.play(null,null,null,{notTriggerSingleFrameClick:!0}),this._recordedStates.fetchingLoopStart&&!this._isSingleFrameModeEnabled()&&this.startFetchingLoop(),this.ifShowScanRegionMask&&this._cvsScanRegion&&this._recordedStates.maskShow&&this.showScanRegionMask(),this.ifShowScanRegionLaser&&this._divScanLight&&this._recordedStates.laserShow&&this.showScanRegionLaser(),this._cvsViewDecorator&&this._recordedStates.decoratorShow&&this.showViewDecorator(),this._scanRegionOverlayContainer&&this._recordedStates.overlayShow&&this.showScanRegionOverlays()),this._selCam&&(this._selCam.parentElement.style.display=""),this._hideOriginalImageCvs())}async hideOriginalImage(){return this._hideOriginalImage(!0)}transformCoord(e){if(!this.isOpen())throw new Error("Unavailable when the camera is not open.");if(this._isSingleFrameModeEnabled()&&!this._cvsSingleFrameMode)throw new Error("No image is selected. ");const i=this._elContainer.getBoundingClientRect();let n,h,d,p,v,b=i.left,C=i.top,x=b+window.scrollX,E=C+window.scrollY;this._isSingleFrameModeEnabled()?(n=this._cvsSingleFrameMode.width,h=this._cvsSingleFrameMode.height,d=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).width),p=parseFloat(window.getComputedStyle(this._cvsSingleFrameMode).height),v="contain"):(n=this.video.videoWidth,h=this.video.videoHeight,d=parseFloat(window.getComputedStyle(this._elContainer).width),p=parseFloat(window.getComputedStyle(this._elContainer).height),v=this.videoFit);const O=d/p,N=n/h;let k,H,U,ee,Y=1;if(v==="contain")O<N?(Y=d/n,k=b+e.x*Y,H=C+e.y*Y+(p-h*Y)/2,U=x+e.x*Y,ee=E+e.y*Y+(p-h*Y)/2):(Y=p/h,k=b+e.x*Y+(d-n*Y)/2,H=C+e.y*Y,U=x+e.x*Y+(d-n*Y)/2,ee=E+e.y*Y);else if(v==="cover")if(O<N){Y=p/h;let G=e.x*Y-(n*Y-d)/2;G=Math.max(G,0),G=Math.min(G,d),k=b+G,H=C+e.y*Y,U=x+G,ee=E+e.y*Y}else{Y=d/n;let G=e.y*Y-(h*Y-p)/2;G=Math.max(G,0),G=Math.min(G,p),k=b+e.x*Y,H=C+G,U=x+e.x*Y,ee=E+G}return{clientX:k,clientY:H,pageX:U,pageY:ee}}convertToPageCoordinates(e){const i=this.transformCoord(e);return{x:i.pageX,y:i.pageY}}convertToClientCoordinates(e){const i=this.transformCoord(e);return{x:i.clientX,y:i.clientY}}dispose(e){this.UIElement&&(this._uiOriginalState&&this._uiOriginalState.inDom?this.UIElement.style.display=this._uiOriginalState.display:this.UIElement.style.display="none"),this.clearDrawingLayers(),this.close(),this.forceLoseContext(),this.setViewDecorator(null,null),this._scanRegionOverlayContainer&&this._scanRegionOverlayContainer.remove(),this._arrScanRegionOverlays.length=0,e&&this.UIElement&&this.UIElement.remove(),this.__proto__=null;for(let i in this)delete this[i];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"isDisposed",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}te._jsVersion="3.3.9",te._jsEditVersion="20231205",te._version="JS "+te._jsVersion+"."+te._jsEditVersion,te.browserInfo=Oe,te._hasEngineResourceLoaded=!1,te._engineResourcePath=uh,te._defaultUIElementURL="@engineResourcePath/dce.ui.html";const ph={DT_Arc:class extends Ge{constructor(t,e,i,n,h,d){super(new Se.Circle({left:t,top:e,radius:i,startAngle:n,endAngle:h}),d),this._mediaType="arc"}},DT_Polygon:ts,DT_Rect:class extends Ge{constructor(t,e,i,n,h){super(new Se.Rect({left:t,top:e,width:i,height:n}),h)}},DT_Image:class extends Ge{constructor(t,e,i,n){super(new Se.Image(t,{left:e,top:i}),n),this.image=t}_extendSet(t,e){if(t==="image"){if(e instanceof HTMLImageElement)return this._fabricObject.setElement(e),this.image=e,!0;if(e instanceof HTMLCanvasElement){const i=new Image;return i.src=e.toDataURL(),this._fabricObject.setElement(i),this.image=e,!0}throw new Error("Unsupported value.")}}_extendGet(t){if(t==="image")return this.image}},DT_Text:Ro,DT_Line:class extends ts{constructor(t,e,i){super([t,e],i),this._mediaType="line"}_extendSet(t,e){if(t==="startPoint"||t==="endPoint"){e=t==="startPoint"?[e,this.get("endPoint")]:[this.get("startPoint"),e];const i=this._fabricObject;if(i.group){const h=i.group;i.points=e.map(d=>({x:d.x-h.left-h.width/2,y:d.y-h.top-h.height/2})),h.addWithUpdate()}else i.points=e;const n=i.points.length-1;return i.controls=i.points.reduce(function(h,d,p){return h["p"+p]=new Se.Control({positionHandler:Ir,actionHandler:Or(p>0?p-1:n,Er),actionName:"modifyPolygon",pointIndex:p}),h},{}),i._setPositionDimensions({}),!0}}_extendGet(t){if(t==="startPoint"||t==="endPoint"){const e=[],i=this._fabricObject;if(i.selectable&&!i.group)for(let n in i.oCoords)e.push({x:i.oCoords[n].x,y:i.oCoords[n].y});else for(let n of i.points){let h=n.x-i.pathOffset.x,d=n.y-i.pathOffset.y;const p=Se.util.transformPoint({x:h,y:d},i.calcTransformMatrix());e.push({x:p.x,y:p.y})}return t==="startPoint"?e[0]:e[1]}}},DT_Group:class extends Ge{constructor(t){super(new Se.Group(t.map(e=>e._getFabricObject()))),this._fabricObject.on("selected",()=>{this.styleSelector="selected";const e=this._fabricObject._objects;for(let i of e)setTimeout(()=>{i&&i.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.styleSelector="default";const e=this._fabricObject._objects;for(let i of e)setTimeout(()=>{i&&i.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)})}getChildItems(){return this._fabricObject._objects.map(t=>t.getDrawingItem())}addChildItem(t){if(!t||!t.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"add"):this._fabricObject.addWithUpdate(t._getFabricObject())}removeChildItem(t){t&&t.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,t,"remove"):this._fabricObject.removeWithUpdate(t._getFabricObject()))}}};function _h(t,e,i){return(i.x-t.x)*(e.y-t.y)==(e.x-t.x)*(i.y-t.y)&&Math.min(t.x,e.x)<=i.x&&i.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=i.y&&i.y<=Math.max(t.y,e.y)}function rr(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function bi(t,e,i,n){let h=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]),d=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]);return!((h^d)>=0&&h!==0&&d!==0)&&(h=i[0]*(t[1]-n[1])+n[0]*(i[1]-t[1])+t[0]*(n[1]-i[1]),d=i[0]*(e[1]-n[1])+n[0]*(i[1]-e[1])+e[0]*(n[1]-i[1]),!((h^d)>=0&&h!==0&&d!==0))}var Ar,Dr,rs,ns,ss,os,as,ls,cs,hs,us,ds,fs,gs,ps,_s,ms,vs,ys,Ss,bs,Cs,ws,xs,Ts,Is,Es,Os;class $e extends L{constructor(){super(),this._barcodeFillStyle="rgba(254,180,32,0.3)",this._barcodeStrokeStyle="rgba(254,180,32,0.9)",this._barcodeLineWidth=1,this._barcodeFillStyleBeforeVerification="rgba(248,252,0,0.2)",this._barcodeStrokeStyleBeforeVerification="transparent",this._barcodeLineWidthBeforeVerification=2,this.bFilterRegionInJs=!0,this._onPlayed=null}static set _onLog(e){(function(i,n,h,d,p){if(d==="m")throw new TypeError("Private method is not writable");if(d==="a"&&!p)throw new TypeError("Private accessor was defined without a setter");if(typeof n=="function"?i!==n||!p:!n.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");d==="a"?p.call(i,h):p?p.value=h:n.set(i,h)})($e,Ar,e,"f",Dr),te._onLog=e}static get _onLog(){return function(e,i,n,h){if(n==="a"&&!h)throw new TypeError("Private accessor was defined without a getter");if(typeof i=="function"?e!==i||!h:!i.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?h:n==="a"?h.call(e):h?h.value:i.get(e)}($e,Ar,"f",Dr)}static get version(){return this._version+`(DCE ${te.getVersion()})`}static _fireHTTPSWarnning(){$e.onWarning&&location&&location.protocol!=="https:"&&setTimeout(()=>{$e.onWarning&&$e.onWarning({id:2,message:"Not connected via SSL (HTTPS), the SDK may not work correctly."})},0)}static async testCameraAccess(){return te.testCameraAccess()}_fireResolutionWarning(){if(!this.singleFrameMode&&this.onWarning&&this.dce.isOpen()){const e=this.dce.getConstraints();e&&e.width<1280&&e.height<720&&setTimeout(()=>{this.onWarning&&this.onWarning({id:3,message:"Camera resolution too low, please use a higher resolution (720P or better)."})},0)}}getUIElement(){return this.dce.getUIElement()}async setUIElement(e){await this.dce.setUIElement(e)}get singleFrameMode(){return this.dce.singleFrameMode}set singleFrameMode(e){if(typeof e!="boolean"&&!["image","camera"].includes(e))throw new Error("Invalid value.");this.dce.singleFrameMode=e,e&&(this.dce.ifShowScanRegionLaser=!1,(async()=>{let i=await this.getScanSettings();i.oneDTrustFrameCount=1,await this.updateScanSettings(i)})())}get onUnduplicatedRead(){return this.onUniqueRead}set onUnduplicatedRead(e){this.onUniqueRead=e}get video(){return this.dce&&this.dce.video}set videoSrc(e){this.dce&&(this.dce.videoSrc=e)}get videoSrc(){return this.dce&&this.dce.videoSrc}set onTipSuggested(e){this.dce&&(this.dce.onTipSuggested=e)}get onTipSuggested(){return this.dce&&this.dce.onTipSuggested}_assertOpen(){if(!this.dce.isOpen())throw Error("The scanner is not open.")}set barcodeFillStyle(e){this._barcodeFillStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{fillStyle:e})}get barcodeFillStyle(){return this._barcodeFillStyle}set barcodeStrokeStyle(e){this._barcodeStrokeStyle=e,this.dce&&this.dce.updateDrawingStyle(3,{strokeStyle:e})}get barcodeStrokeStyle(){return this._barcodeStrokeStyle}set barcodeLineWidth(e){this._barcodeLineWidth=e,this.dce&&this.dce.updateDrawingStyle(3,{lineWidth:e})}get barcodeLineWidth(){return this._barcodeLineWidth}set barcodeFillStyleBeforeVerification(e){this._barcodeFillStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{fillStyle:e})}get barcodeFillStyleBeforeVerification(){return this._barcodeFillStyleBeforeVerification}set barcodeStrokeStyleBeforeVerification(e){this._barcodeStrokeStyleBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{strokeStyle:e})}get barcodeStrokeStyleBeforeVerification(){return this._barcodeStrokeStyleBeforeVerification}set barcodeLineWidthBeforeVerification(e){this._barcodeLineWidthBeforeVerification=e,this._styleIdBeforeVerification&&this.dce.updateDrawingStyle(this._styleIdBeforeVerification,{lineWidth:e})}get barcodeLineWidthBeforeVerification(){return this._barcodeLineWidthBeforeVerification}set regionMaskFillStyle(e){this.dce.setScanRegionMaskStyle({fillStyle:e})}get regionMaskFillStyle(){return this.dce.regionMaskFillStyle}set regionMaskStrokeStyle(e){this.dce.setScanRegionMaskStyle({strokeStyle:e})}get regionMaskStrokeStyle(){return this.dce.regionMaskStrokeStyle}set regionMaskLineWidth(e){this.dce.setScanRegionMaskStyle({lineWidth:e})}get regionMaskLineWidth(){return this.dce.regionMaskLineWidth}set region(e){this._region=e,this.dce&&(e?e instanceof Array||this.dce.setScanRegion(e):this.dce.setScanRegion(null)),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}get region(){return this._region}set ifSaveOriginalImageInACanvas(e){this._ifSaveOriginalImageInACanvas=e,this.dce.framePixelFormat=e?"rgba":"grey"}get ifSaveOriginalImageInACanvas(){return this._ifSaveOriginalImageInACanvas}async createDCEInstance(){this.dce||(L._onLog&&L._onLog("createDCEInstance()"),te.defaultUIElementURL=null,this.dce=await te.createInstance(),this.dce.refreshInterval=200,this.dce.framePixelFormat="grey",this.dce.maxCvsSideLength=this.maxCvsSideLength,this._drawingItemNamespace=ph,["iPhone","iPad","Android","HarmonyOS"].includes(L.browserInfo.OS)||this.dce.setResolution(1920,1080),this._styleIdBeforeVerification=this.dce.createDrawingStyle({fillStyle:"rgba(248,252,0,0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill"}),this.barcodeLineWidth=this._barcodeLineWidth,this.dce.on("cameraChange",()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}),this.dce.on("resolutionChange",()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}),this.dce.on("cameraClose",()=>{this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0,this._bPauseScan=!1}),this.dce.on("singleFrameAcquired",async e=>{if(!e||!e.data)return;let i;this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:n,sx:h,sy:d,width:p,height:v,stride:b,pixelFormat:C,timeStamp:x,_sWidth:E,_sHeight:O}=e,N={timeStamp:x};if(C==="grey")i=await this._decodeBuffer_Uint8Array(n,p,v,b,Ie.IPF_GrayScaled,0,N);else if(C==="rgba")i=await this._decodeBuffer_Uint8Array(n,p,v,b,Ie.IPF_ABGR_8888,0,N);else{if(C!=="bgra")throw new Error(`Pixel format '${C}' is not supported.`);i=await this._decodeBuffer_Uint8Array(n,p,v,b,Ie.IPF_ARGB_8888,0,N)}if(await this.clearMapDecodeRecord(),L.recalculateResultLocation(i,h,d,E,O,p,v),this._drawResults(i),this.onFrameRead&&this.isOpen()&&!this._bPauseScan){let k=this._cloneDecodeResults(i);this.onFrameRead(k)}if(this.onUniqueRead&&this.isOpen()&&!this._bPauseScan)for(let k of i)this.onUniqueRead(k.barcodeText,this._cloneDecodeResults(k))}))}set maxCvsSideLength(e){this._maxCvsSideLength=e,this.dce.maxCvsSideLength=e}get maxCvsSideLength(){return this._maxCvsSideLength}static async createInstance(e){const i=new $e;i._instanceID=await $e.createInstanceInWorker(!0),await i.createDCEInstance(),typeof e=="string"&&(e=JSON.parse(e));for(let n in e)i[n]=e[n];return await i.dce.setUIElement($e.defaultUIElementURL),i.singleFrameMode&&console.warn("The `navigator.mediaDevices.getUserMedia` is unavailable. automatically change to `singleFrameMode`."),$e._fireHTTPSWarnning(),i.singleFrameMode||await i.updateRuntimeSettings("single"),i}async decodeCurrentFrame(e){this._assertOpen();let i=null;e&&e.region&&(i=e.region);const n=this.dce._getVideoData(null,{region:i});return this._decode_DCEFrame(n)}async updateRuntimeSettings(e){let i;if(typeof e=="string")if(e=="speed"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=0,i.localizationModes=[2,0,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9}else if(e=="balance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=512,i.deblurLevel=3,i.localizationModes=[2,16,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if(e=="coverage"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=512,i.deblurLevel=5,i.scaleDownThreshold=1e5,i.localizationModes=[2,16,4,8,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if(e=="single"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region)}else if(e=="dense"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=0,i.deblurLevel=7,i.scaleDownThreshold=1e5,i.localizationModes=[2,8,0,0,0,0,0,0],i.minResultConfidence=0,i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else if(e=="distance"){let n=await this.getRuntimeSettings();await this.resetRuntimeSettings(),this.maxCvsSideLength=4096,i=await this.getRuntimeSettings(),i.barcodeFormatIds=n.barcodeFormatIds,i.barcodeFormatIds_2=n.barcodeFormatIds_2,n.region&&(i.region=n.region),i.expectedBarcodesCount=0,i.scaleDownThreshold=1e5,i.localizationModes=[2,8,0,0,0,0,0,0],i.barcodeZoneMinDistanceToImageBorders=9,i.timeout=1e5}else i=JSON.parse(e);else{if(typeof e!="object")throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'string' or 'PlainObject'.");if(i=JSON.parse(JSON.stringify(e)),i.region instanceof Array){let n=e.region;[n.regionLeft,n.regionTop,n.regionLeft,n.regionBottom,n.regionMeasuredByPercentage].some(h=>h!==void 0)&&(i.region={regionLeft:n.regionLeft||0,regionTop:n.regionTop||0,regionRight:n.regionRight||0,regionBottom:n.regionBottom||0,regionMeasuredByPercentage:n.regionMeasuredByPercentage||0})}}if(!L._bUseFullFeature){if((i.barcodeFormatIds&~(Ue.BF_ONED|Ue.BF_QR_CODE|Ue.BF_PDF417|Ue.BF_DATAMATRIX))!=0||i.barcodeFormatIds_2!=0)throw Error("Some of the specified barcode formats are not supported in the compact version. Please try the full-featured version.");if(i.intermediateResultTypes!=0)throw Error("Intermediate results is not supported in the compact version. Please try the full-featured version.")}{let n=i.region;if(this.bFilterRegionInJs?this.userDefinedRegion=JSON.parse(JSON.stringify(n)):this.userDefinedRegion=null,n instanceof Array)if(n.length){for(let h=0;h<n.length;++h){let d=n[h];d&&((d.regionLeft||d.regionTop||d.regionRight||d.regionBottom||d.regionMeasuredByPercentage)&&(d.regionLeft||d.regionTop||d.regionRight!=100||d.regionBottom!=100||!d.regionMeasuredByPercentage)||(n[h]=null))}this.region=n}else this.region=null;else n&&(n.regionLeft||n.regionTop||n.regionRight||n.regionBottom||n.regionMeasuredByPercentage)&&(n.regionLeft||n.regionTop||n.regionRight!=100||n.regionBottom!=100||!n.regionMeasuredByPercentage)?this.region=n:this.region=null;this.bFilterRegionInJs&&(i.region={regionLeft:0,regionTop:0,regionRight:0,regionBottom:0,regionMeasuredByPercentage:0})}(this.autoZoom||this.autoFocus)&&(i.intermediateResultTypes|=Bt.IRT_TYPED_BARCODE_ZONE),await new Promise((n,h)=>{let d=L._nextTaskID++;L._taskCallbackMap.set(d,p=>{if(p.success){try{this._handleRetJsonString(p.updateReturn)}catch(v){h(v)}return n()}{let v=new Error(p.message);return v.stack=p.stack+`
`+v.stack,h(v)}}),L._dbrWorker.postMessage({type:"updateRuntimeSettings",id:d,instanceID:this._instanceID,body:{settings:JSON.stringify(i)}})}),typeof e=="string"&&["speed","balance","coverage","dense","distance"].includes(e)&&(await this.setModeArgument("BinarizationModes",0,"EnableFillBinaryVacancy","1"),await this.setModeArgument("BinarizationModes",0,"BlockSizeX","0"),await this.setModeArgument("BinarizationModes",0,"BlockSizeY","0"))}_bindUI(){if(!this.getUIElement())throw new Error("Need to define `UIElement` before opening.");if(this.dce._bindUI(),!this.dce.video)throw this._unbindUI(),Error("Can not find the video container element with class 'dce-video-container'")}_unbindUI(){this.dce._unbindUI()}set onPlayed(e){this.dce.off("played",this._onPlayed),this._onPlayed=e,this.dce.on("played",this._onPlayed)}get onPlayed(){return this._onPlayed}async getAllCameras(){return this.dce.getAllCameras()}async getCurrentCamera(){return this.dce.getSelectedCamera()}async setCurrentCamera(e){const i=await this.dce.selectCamera(e);return this._fireResolutionWarning(),i}getResolution(){return this.dce.getResolution()}async setResolution(e,i){const n=await this.dce.setResolution(e,i);return this._fireResolutionWarning(),n}getVideoSettings(){return this.dce.getVideoSettings()}updateVideoSettings(e){return this.dce.updateVideoSettings(e)}isOpen(){return this.dce&&this.dce.isOpen()}setVideoFit(e){return this.dce&&this.dce.setVideoFit(e)}getVideoFit(){return this.dce&&this.dce.getVideoFit()}set ifShowScanRegionMask(e){this.dce&&(this.dce.ifShowScanRegionMask=e)}get ifShowScanRegionMask(){return this.dce&&this.dce.ifShowScanRegionMask}set ifSaveLastUsedCamera(e){this.dce&&(this.dce.ifSaveLastUsedCamera=e)}get ifSaveLastUsedCamera(){return this.dce&&this.dce.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){this.dce&&(this.dce.ifSkipCameraInspection=e)}get ifSkipCameraInspection(){return this.dce&&this.dce.ifSkipCameraInspection}stop(){this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this.dce.stop(),this.dce.ifShowScanRegionLaser=!1,this.dce.hideViewDecorator(),this.array_decodeFrameTimeCost.length=0,this.array_getFrameTimeCost.length=0,this._intervalGetVideoFrame=0}pause(){this.dce.pause()}async play(e,i,n){this.dce.ifShowScanRegionLaser=!0;const h=await this.dce.play(e,i,n);return this._fireResolutionWarning(),h}pauseScan(e){this._assertOpen(),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),e&&e.keepResultsHighlighted||this._drawResults(null),this._bPauseScan=!0,this.dce.ifShowScanRegionLaser=!1,this.dce.stopFetchingLoop()}resumeScan(){this._assertOpen(),this._bPauseScan=!1,this.dce.ifShowScanRegionLaser=!0}getCapabilities(){return this.dce.getCapabilities()}getCameraSettings(){return this.dce.getCameraSettings()}getConstraints(){return this.dce.getConstraints()}async applyConstraints(e){return this.dce.applyConstraints(e)}async turnOnTorch(){return this.dce.turnOnTorch()}async turnOffTorch(){return this.dce.turnOffTorch()}async setColorTemperature(e){return this.dce.setColorTemperature(e)}getColorTemperature(){return this.dce.getColorTemperature()}async setExposureCompensation(e){return this.dce.setExposureCompensation(e)}getExposureCompensation(){return this.dce.getExposureCompensation()}async setZoom(e){return this.dce.setZoom(e)}getZoomSettings(){return this.dce.getZoomSettings()}resetZoom(){return this.dce.resetZoom()}async setFrameRate(e){return this.dce.setFrameRate(e)}getFrameRate(){return this.dce.getFrameRate()}async setFocus(e,i){return this.dce.setFocus(e,i)}getFocus(){return this.dce.getFocus()}getFocusSettings(){return this.dce.getFocusSettings()}async _loopReadVideo(){if(this.bDestroyed)return this.dce&&this.dce.stopFetchingLoop(),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),void this._drawResults(null);if(!this.isOpen())return this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),void await this.clearMapDecodeRecord();if(!this.dce.video||this.dce.video.paused||this._bPauseScan)return L._onLog&&L._onLog("Video or scan is paused. Ask in 1s."),await this.clearMapDecodeRecord(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this._intervalDetectVideoPause));L._onLog&&L._onLog("======= once read ======="),L._onLog&&(this._timeStartDecode=Date.now());const e=this._getVideoFrame();if(!e)return L._onLog&&L._onLog("Get invalid frame."),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._drawResults(null),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),void(this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0));(async()=>{e._bUseWebGL||e.pixelFormat!=="grey"||(this.dce.framePixelFormat="rgba");let i=[];this.ifSaveOriginalImageInACanvas&&(this.oriCanvas=null,this.oriCanvasData={width:e.width,height:e.height,pixelFormat:e.pixelFormat,data:new Uint8Array(e.data),toCanvas:e.toCanvas});const{data:n,sx:h,sy:d,width:p,height:v,stride:b,pixelFormat:C,timeStamp:x,_sWidth:E,_sHeight:O}=e,N={timeStamp:x};if(C==="grey")i=await this._decodeBuffer_Uint8Array(n,p,v,b,Ie.IPF_GrayScaled,0,N);else if(C==="rgba")i=await this._decodeBuffer_Uint8Array(n,p,v,b,Ie.IPF_ABGR_8888,0,N);else{if(C!=="bgra")throw new Error(`Pixel format '${C}' is not supported.`);i=await this._decodeBuffer_Uint8Array(n,p,v,b,Ie.IPF_ARGB_8888,0,N)}if(L.recalculateResultLocation(i,h,d,E,O,p,v),this._resultHighlightingDuration==0?this._drawResults(null):this._drawResults(i),this._clearResultsCanvasTimeoutId&&clearTimeout(this._clearResultsCanvasTimeoutId),this._resultHighlightingDuration>0&&(this._clearResultsCanvasTimeoutId=setTimeout(()=>{this.bDestroyed||this._drawResults(null)},this._resultHighlightingDuration)),this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan&&(this.autoZoom||this.autoFocus||this.autoSuggestTip))if(i.length)this.autoZoomInFrameArray.length=0,this.autoZoomOutFrameCount=0,this.frameArrayInIdealZoom.length=0,this.suggestTipFrameArray.length=0,this.autoZoom&&this.autoFocus&&(this.nextActionInIdealZoom="focus"),this.autoFocusFrameArray.length=0,this.noIntermediateResultsCount=0;else{const k=async()=>new Promise((G,re)=>{let de=L._nextTaskID++;L._taskCallbackMap.set(de,fe=>{if(fe.success)return G(fe.results);{let _e=new Error(fe.message);return _e.stack=fe.stack+`
`+_e.stack,re(_e)}}),L._dbrWorker.postMessage({type:"getIntermediateResults",id:de,instanceID:this._instanceID,body:{isCharge:!1}})}),H=await k(),U=(G,re,de,fe,_e,y,ge)=>{let me=y/fe,we=ge/_e;G.x1=G.x1/me+re,G.x2=G.x2/me+re,G.x3=G.x3/me+re,G.x4=G.x4/me+re,G.y1=G.y1/we+de,G.y2=G.y2/we+de,G.y3=G.y3/we+de,G.y4=G.y4/we+de},ee=G=>{if(!G)return null;const re={};let de,fe,_e,y,ge;{const g=this.video.videoWidth*(1-this.autoZoomDetectionArea)/2,m=this.video.videoWidth*(1+this.autoZoomDetectionArea)/2,S=m,w=g,I=this.video.videoHeight*(1-this.autoZoomDetectionArea)/2,T=I,A=this.video.videoHeight*(1+this.autoZoomDetectionArea)/2;ge={x1:g,x2:m,x3:S,x4:w,y1:I,y2:T,y3:A,y4:A}}const me=(g,m)=>{const S=(I,T)=>{if(!I&&!T)throw new Error("Invalid arguments.");return function(A,D,P){let j=!1;const Z=A.length;if(Z<=2)return!1;for(let X=0;X<Z;X++){const W=A[X],M=A[(X+1)%Z];if(_h(W,M,{x:D,y:P}))return!0;rr(W.y-P)>0!=rr(M.y-P)>0&&rr(D-(P-W.y)*(W.x-M.x)/(W.y-M.y)-W.x)<0&&(j=!j)}return j}([{x:T.x1,y:T.y1},{x:T.x2,y:T.y2},{x:T.x3,y:T.y3},{x:T.x4,y:T.y4}],I.x,I.y)},w=(I,T)=>!!(bi([I[0],I[1]],[I[2],I[3]],[T.x1,T.y1],[T.x2,T.y2])||bi([I[0],I[1]],[I[2],I[3]],[T.x2,T.y2],[T.x3,T.y3])||bi([I[0],I[1]],[I[2],I[3]],[T.x3,T.y3],[T.x4,T.y4])||bi([I[0],I[1]],[I[2],I[3]],[T.x4,T.y4],[T.x1,T.y1]));return!!(S({x:g.x1,y:g.y1},m)||S({x:g.x2,y:g.y2},m)||S({x:g.x3,y:g.y3},m)||S({x:g.x4,y:g.y4},m))||!!(S({x:m.x1,y:m.y1},g)||S({x:m.x2,y:m.y2},g)||S({x:m.x3,y:m.y3},g)||S({x:m.x4,y:m.y4},g))||!!(w([m.x1,m.y1,m.x2,m.y2],g)||w([m.x2,m.y2,m.x3,m.y3],g)||w([m.x3,m.y3,m.x4,m.y4],g)||w([m.x4,m.y4,m.x1,m.y1],g))},we=[];for(let g of G){if(g.resultType!==Bt.IRT_TYPED_BARCODE_ZONE)continue;const m=g.scaleDownRatio;for(let S of g.results){if(!S)continue;const w={x1:S.x1=S.x1*m,x2:S.x2=S.x2*m,x3:S.x3=S.x3*m,x4:S.x4=S.x4*m,y1:S.y1=S.y1*m,y2:S.y2=S.y2*m,y3:S.y4=S.y3*m,y4:S.y4=S.y4*m};U(w,h,d,E,O,p,v),me(ge,w)&&we.push(S)}}const a=(g=>{if(!g||!g.length)return null;const m=T=>{const A=(T.x1+T.x2+T.x3+T.x4)/4,D=(T.y1+T.y2+T.y3+T.y4)/4;return(A-p/2)*(A-p/2)+(D-v/2)*(D-v/2)};let S,w=g.filter(T=>T.barcodeFormat==Ue.BF_QR_CODE||T.barcodeFormat==Ue.BF_DATAMATRIX);if(w.length||(w=g.filter(T=>T.barcodeFormat==Ue.BF_ONED),w.length||(w=g)),!w.length)return null;S=w[0];let I=m(S);if(w.length!=1)for(let T=1;T<w.length;T++){const A=m(w[T]);(w[T].confidence>1.1*S.confidence||w[T].confidence>.9*S.confidence&&A<I)&&(S=w[T],I=A)}return S})(we);if(!a)return null;const s=a.x1,l=a.x2,u=a.x3,r=a.x4,o=a.y1,c=a.y2,_=a.y3,f=a.y4;return de=Math.min(s,l,u,r),fe=Math.max(s,l,u,r),_e=Math.min(o,c,_,f),y=Math.max(o,c,_,f),re.x1=re.x4=de,re.x2=re.x3=fe,re.y1=re.y2=_e,re.y3=re.y4=y,re.result=a,re},Y=ee(H);if(Y&&Y.x1){if(this.autoZoomOutFrameCount=0,this.noIntermediateResultsCount=0,this.suggestTipFrameArray.push(!0),this.suggestTipFrameArray.splice(0,this.suggestTipFrameArray.length-this.suggestTipFrameLimit[0]),this.autoSuggestTip&&this.suggestTipFrameArray.filter(G=>G===!0).length>=this.suggestTipFrameLimit[1]){this.suggestTipFrameArray.length=0;const G=Y.x3-Y.x1,re=Y.y3-Y.y1;Y.result.moduleSize<this.tinyBarcodeTipModuleSizeLimit?this.dce&&this.dce.suggestTip("tiny-barcode","Please zoom in or move closer."):G>re?G>p*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):G>.6*p&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."):G<=re&&(re>v*this.hugeBarcodeTipLimit?this.dce&&this.dce.suggestTip("huge-barcode","Please zoom out or move farther."):re>.6*v&&Math.max(this.video.videoWidth,this.video.videoHeight)<=1280&&Math.min(this.video.videoWidth,this.video.videoHeight)<=720&&this.dce&&this.dce.suggestTip("low-resolution","Please use a higher resolution."))}if(this.autoZoom){const G=this.autoZoomIdealArea[1];let re=(1-this.autoZoomTargetBorder)/2;const de=Y.x1/E,fe=(E-Y.x3)/E,_e=Y.y1/O,y=(O-Y.y3)/O;if(de>G&&fe>G&&_e>G&&y>G&&Y.result.moduleSize<this.autoZoomInIdealModuleSize){if(this.autoZoomInFrameArray.push(!0),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.frameArrayInIdealZoom.length=0,this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(()=>{})),this.autoZoomInFrameArray.filter(ge=>ge===!0).length>=this.autoZoomInFrameLimit[1]){this.autoZoomInFrameArray.length=0;const ge=[(.5-re)/(.5-de),(.5-re)/(.5-fe),(.5-re)/(.5-_e),(.5-re)/(.5-y)].filter(l=>l>0),me=Math.min(...ge,this.autoZoomInIdealModuleSize/Y.result.moduleSize),we=this.dce.getZoomSettings().factor;let a=Math.max(Math.pow(we*me,1/this.autoZoomInMaxTimes),this.autoZoomInMinStep);a=Math.min(a,me);const s=we*a;await this.setZoom({factor:s}),this.dce.clearFrameBuffer()}}else if(this.autoZoomInFrameArray.length=0,this.frameArrayInIdealZoom.push(!0),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.frameArrayInIdealZoom.filter(ge=>ge===!0).length>=this.frameLimitInIdealZoom[1])if(this.frameArrayInIdealZoom.length=0,this.nextActionInIdealZoom==="focus"&&this.autoFocus){U(Y,h,d,E,O,p,v);try{await this.setFocus({mode:"manual",area:{centerPoint:{x:(Y.x1+Y.x3)/2+"px",y:(Y.y1+Y.y3)/2+"px"},width:Y.x3-Y.x1+"px",height:Y.y3-Y.y1+"px"}})}catch(ge){}this.dce.clearFrameBuffer(),this.nextActionInIdealZoom="zoomOut"}else{if(this.nextActionInIdealZoom!=="zoomOut"&&this.autoFocus)throw new Error("Invalid action.");if(this.enableZoomOutInIdealZoom){re=this.autoZoomIdealArea[1]+this.autoZoomOutStepRate_2;const ge=[(.5-re)/(.5-de),(.5-re)/(.5-fe),(.5-re)/(.5-_e),(.5-re)/(.5-y)].filter(we=>we>0);let me=Math.min(...ge)*this.dce.getZoomSettings().factor;await this.setZoom({factor:me}),this.dce.clearFrameBuffer(),this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(we=>{}))}}}else if(this.autoFocus&&(this.autoFocusFrameArray.push(!0),this.autoFocusFrameArray.splice(0,this.autoFocusFrameArray.length-this.autoFocusFrameLimit[0]),this.autoFocusFrameArray.filter(G=>G===!0).length>=this.autoFocusFrameLimit[1])){this.autoFocusFrameArray.length=0;try{U(Y,h,d,E,O,p,v),await this.setFocus({mode:"manual",area:{centerPoint:{x:(Y.x1+Y.x3)/2+"px",y:(Y.y1+Y.y3)/2+"px"},width:Y.x3-Y.x1+"px",height:Y.y3-Y.y1+"px"}})}catch(G){}this.dce.clearFrameBuffer()}}else if(this.noIntermediateResultsCount++,this.suggestTipFrameArray.push(!1),this.autoZoom){if(this.autoZoomInFrameArray.push(!1),this.autoZoomInFrameArray.splice(0,this.autoZoomInFrameArray.length-this.autoZoomInFrameLimit[0]),this.autoZoomOutFrameCount++,this.frameArrayInIdealZoom.push(!1),this.frameArrayInIdealZoom.splice(0,this.frameArrayInIdealZoom.length-this.frameLimitInIdealZoom[0]),this.autoZoomOutFrameCount>=this.autoZoomOutFrameLimit){this.autoZoomOutFrameCount=0;const G=this.getZoomSettings().factor;if(G>this.autoZoomOutMinValue){const re=Math.max((G-1)*this.autoZoomOutStepRate,this.autoZoomOutMinStep),de=Math.max(G-re,this.autoZoomOutMinValue);await this.setZoom({factor:de}),this.dce.clearFrameBuffer()}}this.autoFocus&&(this.nextActionInIdealZoom="focus",this.setFocus({mode:"continuous"}).catch(G=>{}))}else this.autoFocus&&(this.autoFocusFrameArray.length=0,this.setFocus({mode:"continuous"}).catch(G=>{}))}return i})().then(i=>{if(L._onLog&&L._onLog(i),this.captureAndDecodeInParallel){let n=this.array_decodeFrameTimeCost,h=this.array_getFrameTimeCost,d=this._indexCurrentDecodingFrame;const p=()=>{let v=0;if(this.region instanceof Array){let b=0,C=0;b=d+1>=this.region.length?0:d+1,C=b+1>=this.region.length?0:b+1,v=n[b]&&n[b].length&&h[C]&&h[C].length?Math.min(...n[b])-Math.max(...h[C]):0}else if(h&&h.length){let b=Math.min(...n),C=Math.max(...h);b&&C&&(v=b-C)}else v=0;return v>0?v:0};(()=>{if(this.region instanceof Array){for(n[d]&&n[d]instanceof Array||(n[d]=[]);n[d].length>=5;)n[d].shift();n[d].push(this._lastInnerDecodeDuration)}else{for(;n.length>=5;)n.shift();n.push(this._lastInnerDecodeDuration)}})(),this._intervalGetVideoFrame=p()+this.intervalTime,L._onLog&&L._onLog("Next fetching frame loop interval: "+this._intervalGetVideoFrame)}if(this.isOpen()&&this.dce.video&&!this.dce.video.paused&&!this._bPauseScan){if(this.bPlaySoundOnSuccessfulRead&&i.length){let n=!1;this.bPlaySoundOnSuccessfulRead===!0||this.bPlaySoundOnSuccessfulRead==="frame"?n=i.some(h=>h.resultState>=0):this.bPlaySoundOnSuccessfulRead==="unique"&&(n=i.some(h=>h.resultState==0)),n&&this.beepSound&&(this.beepSound.stop(),this.beepSound.play())}if(navigator.vibrate&&this.bVibrateOnSuccessfulRead&&i.length){let n=!1;if(this.bVibrateOnSuccessfulRead===!0||this.bVibrateOnSuccessfulRead==="frame"?n=i.some(h=>h.resultState>=0):this.bVibrateOnSuccessfulRead==="unique"&&(n=i.some(h=>h.resultState==0)),n)try{navigator.vibrate(this.vibrateDuration)}catch(h){console.warn("Vibration not allowed. User interaction required: "+(h.message||h))}}if(this.onFrameRead){i=i.filter(h=>h.resultState>=0);const n=this._cloneDecodeResults(i);this.onFrameRead(n)}if(this.onUniqueRead){i=i.filter(h=>h.resultState==0);const n=this._cloneDecodeResults(i);for(let h of n)this.onUniqueRead(h.barcodeText,h)}}this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this.intervalTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},this.intervalTime):this._loopReadVideo()})}_getVideoFrame(){if(!this.dce)return null;let e;if(this.captureAndDecodeInParallel){L._onLog&&L._onLog("Get frame in parallel.");let i=this.dce.isFetchingLoopStarted();if(this.dce.loopInterval=this._intervalGetVideoFrame,i||this.dce.startFetchingLoop(),!this.dce.numberOfFramesInBuffer)return this.dce.loopInterval=0,null;e=this.dce.getFrameFromBuffer(),(h=>{if(!h)return;let d=h.timeSpent,p=this.array_getFrameTimeCost;for(;p.length>=5;)p.shift();p.push(d)})(e)}else L._onLog&&L._onLog("Get frame in serial."),this.dce.stopFetchingLoop(),e=this.dce.getFrame();return e}async open(){this._bindUI();const e=await this.dce.open();return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}async openVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open();return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}close(){this._drawResults(null),this.dce.close(),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}async show(){this._bindUI();const e=await this.dce.open(!0);return this._bPauseScan=!1,this.singleFrameMode||(this.dce&&(this.dce.ifShowScanRegionLaser=!0),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}async showVideo(){this._bindUI(),this.dce.ifShowScanRegionLaser=!1;const e=await this.dce.open(!0);return this._bPauseScan=!0,this.singleFrameMode||(this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo()},0)),this._fireResolutionWarning(),e}hide(){this.dce.close(!0),this._bPauseScan=!0,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId)}showTip(e,i,n,h,d=3e3,p=!0){this.dce&&this.dce.showTip(e,i,n,h,d,p)}hideTip(){this.dce&&this.dce.hideTip()}updateTipMessage(e){this.dce&&this.dce.updateTipMessage(e)}async enableTapToFocus(){this.dce&&this.dce.enableTapToFocus()}disableTapToFocus(){this.dce&&this.dce.disableTapToFocus()}isTapToFocusEnabled(){return this.dce.isTapToFocusEnabled()}convertToPageCoordinates(e){return this.dce.convertToPageCoordinates(e)}convertToClientCoordinates(e){return this.dce.convertToClientCoordinates(e)}destroyContext(){this.close(),this.dce&&this.dce.dispose(!1),this.bDestroyed||super.destroyContext()}}Ar=$e,Dr={value:void 0},function(t){t[t.BICM_DARK_ON_LIGHT=1]="BICM_DARK_ON_LIGHT",t[t.BICM_LIGHT_ON_DARK=2]="BICM_LIGHT_ON_DARK",t[t.BICM_DARK_ON_DARK=4]="BICM_DARK_ON_DARK",t[t.BICM_LIGHT_ON_LIGHT=8]="BICM_LIGHT_ON_LIGHT",t[t.BICM_DARK_LIGHT_MIXED=16]="BICM_DARK_LIGHT_MIXED",t[t.BICM_DARK_ON_LIGHT_DARK_SURROUNDING=32]="BICM_DARK_ON_LIGHT_DARK_SURROUNDING",t[t.BICM_SKIP=0]="BICM_SKIP",t[t.BICM_REV=2147483648]="BICM_REV"}(rs||(rs={})),function(t){t[t.BCM_AUTO=1]="BCM_AUTO",t[t.BCM_GENERAL=2]="BCM_GENERAL",t[t.BCM_SKIP=0]="BCM_SKIP",t[t.BCM_REV=2147483648]="BCM_REV"}(ns||(ns={})),function(t){t[t.BF2_NULL=0]="BF2_NULL",t[t.BF2_POSTALCODE=32505856]="BF2_POSTALCODE",t[t.BF2_NONSTANDARD_BARCODE=1]="BF2_NONSTANDARD_BARCODE",t[t.BF2_USPSINTELLIGENTMAIL=1048576]="BF2_USPSINTELLIGENTMAIL",t[t.BF2_POSTNET=2097152]="BF2_POSTNET",t[t.BF2_PLANET=4194304]="BF2_PLANET",t[t.BF2_AUSTRALIANPOST=8388608]="BF2_AUSTRALIANPOST",t[t.BF2_RM4SCC=16777216]="BF2_RM4SCC",t[t.BF2_DOTCODE=2]="BF2_DOTCODE",t[t.BF2_PHARMACODE_ONE_TRACK=4]="BF2_PHARMACODE_ONE_TRACK",t[t.BF2_PHARMACODE_TWO_TRACK=8]="BF2_PHARMACODE_TWO_TRACK",t[t.BF2_PHARMACODE=12]="BF2_PHARMACODE",t[t.BF2_ALL=-1]="BF2_ALL"}(ss||(ss={})),function(t){t[t.BM_AUTO=1]="BM_AUTO",t[t.BM_LOCAL_BLOCK=2]="BM_LOCAL_BLOCK",t[t.BM_SKIP=0]="BM_SKIP",t[t.BM_THRESHOLD=4]="BM_THRESHOLD",t[t.BM_REV=2147483648]="BM_REV"}(os||(os={})),function(t){t[t.ECCM_CONTRAST=1]="ECCM_CONTRAST"}(as||(as={})),function(t){t[t.CFM_GENERAL=1]="CFM_GENERAL"}(ls||(ls={})),function(t){t[t.CCM_AUTO=1]="CCM_AUTO",t[t.CCM_GENERAL_HSV=2]="CCM_GENERAL_HSV",t[t.CCM_SKIP=0]="CCM_SKIP",t[t.CCM_REV=2147483648]="CCM_REV"}(cs||(cs={})),function(t){t[t.CICM_GENERAL=1]="CICM_GENERAL",t[t.CICM_SKIP=0]="CICM_SKIP",t[t.CICM_REV=2147483648]="CICM_REV"}(hs||(hs={})),function(t){t[t.CM_IGNORE=1]="CM_IGNORE",t[t.CM_OVERWRITE=2]="CM_OVERWRITE"}(us||(us={})),function(t){t[t.DM_SKIP=0]="DM_SKIP",t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING"}(ds||(ds={})),function(t){t[t.DRM_AUTO=1]="DRM_AUTO",t[t.DRM_GENERAL=2]="DRM_GENERAL",t[t.DRM_BROAD_WARP=4]="DRM_BROAD_WARP",t[t.DRM_LOCAL_REFERENCE=8]="DRM_LOCAL_REFERENCE",t[t.DRM_DEWRINKLE=16]="DRM_DEWRINKLE",t[t.DRM_SKIP=0]="DRM_SKIP",t[t.DRM_REV=2147483648]="DRM_REV"}(fs||(fs={})),function(t){t[t.DPMCRM_AUTO=1]="DPMCRM_AUTO",t[t.DPMCRM_GENERAL=2]="DPMCRM_GENERAL",t[t.DPMCRM_SKIP=0]="DPMCRM_SKIP",t[t.DPMCRM_REV=2147483648]="DPMCRM_REV"}(gs||(gs={})),function(t){t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_REV=2147483648]="GTM_REV"}(ps||(ps={})),function(t){t[t.IPM_AUTO=1]="IPM_AUTO",t[t.IPM_GENERAL=2]="IPM_GENERAL",t[t.IPM_GRAY_EQUALIZE=4]="IPM_GRAY_EQUALIZE",t[t.IPM_GRAY_SMOOTH=8]="IPM_GRAY_SMOOTH",t[t.IPM_SHARPEN_SMOOTH=16]="IPM_SHARPEN_SMOOTH",t[t.IPM_MORPHOLOGY=32]="IPM_MORPHOLOGY",t[t.IPM_SKIP=0]="IPM_SKIP",t[t.IPM_REV=2147483648]="IPM_REV"}(_s||(_s={})),function(t){t[t.IRSM_MEMORY=1]="IRSM_MEMORY",t[t.IRSM_FILESYSTEM=2]="IRSM_FILESYSTEM",t[t.IRSM_BOTH=4]="IRSM_BOTH"}(ms||(ms={})),function(t){t[t.LM_SKIP=0]="LM_SKIP",t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=2147483648]="LM_REV"}(vs||(vs={})),function(t){t[t.PDFRM_RASTER=1]="PDFRM_RASTER",t[t.PDFRM_AUTO=2]="PDFRM_AUTO",t[t.PDFRM_VECTOR=4]="PDFRM_VECTOR",t[t.PDFRM_REV=2147483648]="PDFRM_REV"}(ys||(ys={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Ss||(Ss={})),function(t){t[t.RPM_AUTO=1]="RPM_AUTO",t[t.RPM_GENERAL=2]="RPM_GENERAL",t[t.RPM_GENERAL_RGB_CONTRAST=4]="RPM_GENERAL_RGB_CONTRAST",t[t.RPM_GENERAL_GRAY_CONTRAST=8]="RPM_GENERAL_GRAY_CONTRAST",t[t.RPM_GENERAL_HSV_CONTRAST=16]="RPM_GENERAL_HSV_CONTRAST",t[t.RPM_SKIP=0]="RPM_SKIP",t[t.RPM_REV=2147483648]="RPM_REV"}(bs||(bs={})),function(t){t[t.RCT_PIXEL=1]="RCT_PIXEL",t[t.RCT_PERCENTAGE=2]="RCT_PERCENTAGE"}(Cs||(Cs={})),function(t){t[t.RT_STANDARD_TEXT=0]="RT_STANDARD_TEXT",t[t.RT_RAW_TEXT=1]="RT_RAW_TEXT",t[t.RT_CANDIDATE_TEXT=2]="RT_CANDIDATE_TEXT",t[t.RT_PARTIAL_TEXT=3]="RT_PARTIAL_TEXT"}(ws||(ws={})),function(t){t[t.SUM_AUTO=1]="SUM_AUTO",t[t.SUM_LINEAR_INTERPOLATION=2]="SUM_LINEAR_INTERPOLATION",t[t.SUM_NEAREST_NEIGHBOUR_INTERPOLATION=4]="SUM_NEAREST_NEIGHBOUR_INTERPOLATION",t[t.SUM_SKIP=0]="SUM_SKIP",t[t.SUM_REV=2147483648]="SUM_REV"}(xs||(xs={})),function(t){t[t.TP_REGION_PREDETECTED=1]="TP_REGION_PREDETECTED",t[t.TP_IMAGE_PREPROCESSED=2]="TP_IMAGE_PREPROCESSED",t[t.TP_IMAGE_BINARIZED=4]="TP_IMAGE_BINARIZED",t[t.TP_BARCODE_LOCALIZED=8]="TP_BARCODE_LOCALIZED",t[t.TP_BARCODE_TYPE_DETERMINED=16]="TP_BARCODE_TYPE_DETERMINED",t[t.TP_BARCODE_RECOGNIZED=32]="TP_BARCODE_RECOGNIZED"}(Ts||(Ts={})),function(t){t[t.TFM_AUTO=1]="TFM_AUTO",t[t.TFM_GENERAL_CONTOUR=2]="TFM_GENERAL_CONTOUR",t[t.TFM_SKIP=0]="TFM_SKIP",t[t.TFM_REV=2147483648]="TFM_REV"}(Is||(Is={})),function(t){t[t.TROM_CONFIDENCE=1]="TROM_CONFIDENCE",t[t.TROM_POSITION=2]="TROM_POSITION",t[t.TROM_FORMAT=4]="TROM_FORMAT",t[t.TROM_SKIP=0]="TROM_SKIP",t[t.TROM_REV=2147483648]="TROM_REV"}(Es||(Es={})),function(t){t[t.TDM_AUTO=1]="TDM_AUTO",t[t.TDM_GENERAL_WIDTH_CONCENTRATION=2]="TDM_GENERAL_WIDTH_CONCENTRATION",t[t.TDM_SKIP=0]="TDM_SKIP",t[t.TDM_REV=2147483648]="TDM_REV"}(Os||(Os={}));L.license="DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAwLWRicl9qc19zYW1wbGVzIiwib3JnYW5pemF0aW9uSUQiOiIyMDAwMDAifQ==";L.engineResourcePath="https://cdn.jsdelivr.net/npm/dynamsoft-javascript-barcode@9.6.32/dist/";function Yi(t,e,i,n,h,d,p,v){var b=typeof t=="function"?t.options:t;e&&(b.render=e,b.staticRenderFns=i,b._compiled=!0),n&&(b.functional=!0),d&&(b._scopeId="data-v-"+d);var C;if(p?(C=function(O){O=O||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!O&&typeof __VUE_SSR_CONTEXT__<"u"&&(O=__VUE_SSR_CONTEXT__),h&&h.call(this,O),O&&O._registeredComponents&&O._registeredComponents.add(p)},b._ssrRegister=C):h&&(C=v?function(){h.call(this,(b.functional?this.parent:this).$root.$options.shadowRoot)}:h),C)if(b.functional){b._injectStyles=C;var x=b.render;b.render=function(N,k){return C.call(k),x(N,k)}}else{var E=b.beforeCreate;b.beforeCreate=E?[].concat(E,C):[C]}return{exports:t,options:b}}const mh={data(){return{pScanner:null}},async mounted(){var t;try{const e=await(this.pScanner=$e.createInstance());await e.setUIElement(this.$el),e.onFrameRead=i=>{for(let n of i)console.log(n.barcodeText)},e.onUniqueRead=(i,n)=>{alert(i,n)},await e.open()}catch(e){let i;(t=e.message)!=null&&t.includes("network connection error")?i="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":i=e.message||e,console.error(i),alert(i)}},async beforeDestroy(){this.pScanner&&((await this.pScanner).destroyContext(),console.log("BarcodeScanner Component Unmount"))}};var vh=function(){var e=this;return e._self._c,e._m(2)},yh=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"dce-scanarea"},[e("div",{staticClass:"dce-scanlight"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"div-select-container"},[e("select",{staticClass:"dce-sel-camera"}),e("select",{staticClass:"dce-sel-resolution"})])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"component-barcode-scanner"},[e("svg",{staticClass:"dce-bg-loading",attrs:{viewBox:"0 0 1792 1792"}},[e("path",{attrs:{d:"M1760 896q0 176-68.5 336t-184 275.5-275.5 184-336 68.5-336-68.5-275.5-184-184-275.5-68.5-336q0-213 97-398.5t265-305.5 374-151v228q-221 45-366.5 221t-145.5 406q0 130 51 248.5t136.5 204 204 136.5 248.5 51 248.5-51 204-136.5 136.5-204 51-248.5q0-230-145.5-406t-366.5-221v-228q206 31 374 151t265 305.5 97 398.5z"}})]),e("svg",{staticClass:"dce-bg-camera",attrs:{viewBox:"0 0 2048 1792"}},[e("path",{attrs:{d:"M1024 672q119 0 203.5 84.5t84.5 203.5-84.5 203.5-203.5 84.5-203.5-84.5-84.5-203.5 84.5-203.5 203.5-84.5zm704-416q106 0 181 75t75 181v896q0 106-75 181t-181 75h-1408q-106 0-181-75t-75-181v-896q0-106 75-181t181-75h224l51-136q19-49 69.5-84.5t103.5-35.5h512q53 0 103.5 35.5t69.5 84.5l51 136h224zm-704 1152q185 0 316.5-131.5t131.5-316.5-131.5-316.5-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5z"}})]),e("div",{staticClass:"dce-video-container"}),t._m(0),t._m(1),e("div",{staticClass:"dbr-msg-poweredby"},[e("svg",{attrs:{viewBox:"0 0 94 17"}},[e("g",[e("path",{attrs:{d:"M0.9,14V4.3h2.3c0.6,0,1,0.1,1.4,0.3c0.3,0.2,0.6,0.5,0.7,0.9s0.2,0.8,0.2,1.4c0,0.5-0.1,0.9-0.2,1.3 C5.1,8.5,4.9,8.8,4.5,9.1C4.2,9.3,3.7,9.4,3.2,9.4H1.8V14H0.9z M1.8,8.7h1.2c0.4,0,0.7-0.1,1-0.2S4.3,8.2,4.4,8 c0.1-0.3,0.2-0.6,0.2-1.1c0-0.5,0-0.9-0.1-1.2C4.3,5.4,4.2,5.2,3.9,5.1S3.4,5,2.9,5H1.8V8.7z"}}),e("path",{attrs:{d:"M8.1,14.1c-0.5,0-0.8-0.1-1.1-0.3s-0.5-0.5-0.6-0.9s-0.2-0.9-0.2-1.4V9.6c0-0.6,0.1-1,0.2-1.4 C6.5,7.8,6.7,7.5,7,7.3S7.6,7,8.1,7C8.6,7,9,7.1,9.2,7.3s0.5,0.5,0.6,0.9C9.9,8.5,9.9,9,9.9,9.6v1.9c0,0.6-0.1,1-0.2,1.4 c-0.1,0.4-0.3,0.7-0.6,0.9S8.6,14.1,8.1,14.1z M8.1,13.4c0.3,0,0.5-0.1,0.7-0.2C8.9,13,9,12.8,9,12.5c0-0.3,0-0.6,0-1v-2 c0-0.4,0-0.7,0-1C9,8.2,8.9,8,8.8,7.9C8.6,7.7,8.4,7.6,8.1,7.6c-0.3,0-0.5,0.1-0.7,0.2C7.3,8,7.2,8.2,7.2,8.5c0,0.3-0.1,0.6-0.1,1 v2c0,0.4,0,0.7,0.1,1c0,0.3,0.1,0.5,0.3,0.7C7.6,13.4,7.8,13.4,8.1,13.4z"}}),e("path",{attrs:{d:"M12,14l-1.1-6.9h0.7l0.9,5.8l1.1-5.8h0.8l1.1,5.8l0.8-5.8H17L15.9,14H15l-1.1-5.6L12.8,14H12z"}}),e("path",{attrs:{d:"M19.8,14.1c-0.4,0-0.8-0.1-1.1-0.3s-0.5-0.5-0.6-0.9c-0.1-0.4-0.2-0.9-0.2-1.6V9.6c0-0.7,0.1-1.2,0.2-1.6 c0.1-0.4,0.3-0.7,0.6-0.8C19,7,19.3,7,19.8,7c0.5,0,0.9,0.1,1.1,0.3c0.3,0.2,0.4,0.5,0.5,0.9c0.1,0.4,0.1,1,0.1,1.6v0.6h-2.8v1.2 c0,0.4,0,0.8,0.1,1.1c0.1,0.3,0.2,0.4,0.3,0.6s0.3,0.2,0.6,0.2c0.2,0,0.3,0,0.5-0.1c0.1-0.1,0.3-0.2,0.3-0.4s0.1-0.5,0.1-0.8v-0.5 h0.9V12c0,0.6-0.1,1.1-0.4,1.5S20.4,14.1,19.8,14.1z M18.8,9.9h1.9V9.4c0-0.4,0-0.7-0.1-0.9c0-0.3-0.1-0.5-0.3-0.6S20,7.6,19.8,7.6 c-0.2,0-0.4,0.1-0.6,0.2c-0.1,0.1-0.3,0.3-0.3,0.6c-0.1,0.3-0.1,0.7-0.1,1.1V9.9z"}}),e("path",{attrs:{d:"M22.8,14V7.1h0.9V8c0.2-0.4,0.5-0.6,0.8-0.8C24.8,7.1,25,7,25.3,7c0,0,0,0,0.1,0s0.1,0,0.1,0v0.9 c-0.1,0-0.1,0-0.2-0.1c-0.1,0-0.2,0-0.2,0c-0.3,0-0.5,0.1-0.7,0.2c-0.2,0.1-0.4,0.3-0.6,0.6V14H22.8z"}}),e("path",{attrs:{d:"M28,14.1c-0.4,0-0.8-0.1-1.1-0.3s-0.5-0.5-0.6-0.9c-0.1-0.4-0.2-0.9-0.2-1.6V9.6c0-0.7,0.1-1.2,0.2-1.6 c0.1-0.4,0.3-0.7,0.6-0.8C27.3,7,27.6,7,28,7c0.5,0,0.9,0.1,1.1,0.3c0.3,0.2,0.4,0.5,0.5,0.9c0.1,0.4,0.1,1,0.1,1.6v0.6H27v1.2 c0,0.4,0,0.8,0.1,1.1c0.1,0.3,0.2,0.4,0.3,0.6s0.3,0.2,0.6,0.2c0.2,0,0.3,0,0.5-0.1c0.1-0.1,0.3-0.2,0.3-0.4s0.1-0.5,0.1-0.8v-0.5 h0.9V12c0,0.6-0.1,1.1-0.4,1.5S28.7,14.1,28,14.1z M27,9.9H29V9.4c0-0.4,0-0.7-0.1-0.9c0-0.3-0.1-0.5-0.3-0.6S28.3,7.6,28,7.6 c-0.2,0-0.4,0.1-0.6,0.2c-0.1,0.1-0.3,0.3-0.3,0.6C27.1,8.6,27,9,27,9.5V9.9z"}}),e("path",{attrs:{d:"M32.6,14.1c-0.6,0-1-0.2-1.3-0.7c-0.3-0.4-0.4-1.2-0.4-2.2V9.9c0-0.6,0-1.1,0.1-1.6c0.1-0.4,0.2-0.8,0.5-1 c0.2-0.2,0.6-0.4,1-0.4C32.8,7,33,7,33.2,7.1c0.2,0.1,0.4,0.3,0.5,0.4V4.3h0.9V14h-0.9v-0.5c-0.1,0.2-0.3,0.3-0.5,0.4 C33,14,32.8,14.1,32.6,14.1z M32.7,13.4c0.2,0,0.4,0,0.5-0.1c0.2-0.1,0.3-0.2,0.5-0.3V8.1c-0.1-0.1-0.3-0.2-0.4-0.3 c-0.2-0.1-0.4-0.2-0.6-0.2c-0.4,0-0.6,0.2-0.8,0.5S31.8,9,31.8,9.6v1.6c0,0.5,0,0.9,0.1,1.2c0.1,0.3,0.1,0.6,0.3,0.7 C32.3,13.3,32.5,13.4,32.7,13.4z"}}),e("path",{attrs:{d:"M40.5,14.1c-0.3,0-0.5-0.1-0.7-0.2c-0.2-0.1-0.4-0.3-0.5-0.4V14h-0.9V4.3h0.9v3.4c0.1-0.2,0.3-0.3,0.5-0.5 C40.1,7,40.3,7,40.6,7C41,7,41.2,7,41.4,7.2c0.2,0.2,0.4,0.4,0.5,0.6c0.1,0.3,0.2,0.6,0.2,0.9s0.1,0.7,0.1,1v1.5 c0,0.6,0,1.1-0.1,1.5c-0.1,0.4-0.3,0.8-0.5,1C41.3,14,41,14.1,40.5,14.1z M40.4,13.4c0.3,0,0.5-0.1,0.6-0.3 c0.1-0.2,0.2-0.4,0.3-0.8s0.1-0.7,0.1-1.2V9.7c0-0.5,0-0.8-0.1-1.1S41.1,8,41,7.9c-0.1-0.2-0.3-0.2-0.6-0.2c-0.2,0-0.4,0.1-0.6,0.2 c-0.2,0.1-0.3,0.2-0.5,0.4v4.7c0.1,0.1,0.3,0.3,0.5,0.4C40,13.4,40.2,13.4,40.4,13.4z"}}),e("path",{attrs:{d:"M43.2,15.7V15c0.4,0,0.7,0,0.9-0.1c0.2-0.1,0.3-0.1,0.4-0.3c0.1-0.1,0.1-0.2,0.1-0.4c0-0.1,0-0.3-0.1-0.5 c0-0.2-0.1-0.4-0.2-0.6L43,7.1h0.9l1.2,5.9l1.2-5.9h0.9l-1.7,7.4c-0.1,0.3-0.2,0.5-0.3,0.7c-0.2,0.2-0.4,0.3-0.6,0.4 c-0.3,0.1-0.6,0.1-1,0.1H43.2z"}}),e("path",{attrs:{d:"M50.6,14V4.3h2.1c0.7,0,1.2,0.1,1.6,0.4c0.4,0.2,0.6,0.6,0.8,1c0.2,0.4,0.2,0.9,0.2,1.5V11 c0,0.6-0.1,1.1-0.2,1.6s-0.4,0.8-0.8,1S53.5,14,52.8,14H50.6z M51.5,13.3h1.2c0.5,0,0.9-0.1,1.1-0.3s0.4-0.5,0.5-0.9 s0.1-0.8,0.1-1.3V7.2c0-0.5,0-0.9-0.1-1.2s-0.2-0.6-0.5-0.8S53.2,5,52.7,5h-1.2V13.3z"}}),e("path",{attrs:{d:"M56.5,15.7V15c0.4,0,0.7,0,0.9-0.1c0.2-0.1,0.3-0.1,0.4-0.3c0.1-0.1,0.1-0.2,0.1-0.4c0-0.1,0-0.3-0.1-0.5 c0-0.2-0.1-0.4-0.2-0.6l-1.4-6.1h0.9l1.2,5.9l1.2-5.9h0.9l-1.7,7.4c-0.1,0.3-0.2,0.5-0.3,0.7s-0.4,0.3-0.6,0.4s-0.6,0.1-1,0.1H56.5 z"}}),e("path",{attrs:{d:"M61.3,14V7.1h0.9v0.7c0.2-0.2,0.5-0.4,0.8-0.6C63.2,7,63.5,7,63.8,7C64,7,64.2,7,64.4,7.1s0.3,0.3,0.4,0.5 c0.1,0.2,0.1,0.5,0.1,0.8V14H64V8.6c0-0.4-0.1-0.6-0.2-0.8c-0.1-0.1-0.3-0.2-0.5-0.2c-0.2,0-0.4,0.1-0.6,0.2s-0.4,0.3-0.6,0.5V14 H61.3z"}}),e("path",{attrs:{d:"M67.4,14.1c-0.3,0-0.5-0.1-0.7-0.2c-0.2-0.1-0.4-0.3-0.5-0.6C66,13.1,66,12.8,66,12.6c0-0.4,0.1-0.7,0.2-0.9 s0.3-0.5,0.5-0.7c0.2-0.2,0.5-0.4,0.9-0.6c0.4-0.2,0.8-0.4,1.3-0.6V9.3c0-0.4,0-0.8-0.1-1c-0.1-0.2-0.1-0.4-0.3-0.5 c-0.1-0.1-0.3-0.2-0.5-0.2c-0.2,0-0.3,0-0.5,0.1c-0.1,0.1-0.3,0.2-0.3,0.4c-0.1,0.2-0.1,0.4-0.1,0.7V9l-0.9,0 c0-0.7,0.2-1.2,0.5-1.6C66.8,7.1,67.3,7,68,7c0.6,0,1.1,0.2,1.3,0.6c0.3,0.4,0.4,1,0.4,1.7v3.4c0,0.1,0,0.3,0,0.5 c0,0.2,0,0.4,0,0.5c0,0.2,0,0.3,0,0.4h-0.8c0-0.2-0.1-0.3-0.1-0.5c0-0.2,0-0.3-0.1-0.5c-0.1,0.3-0.3,0.5-0.5,0.7 S67.7,14.1,67.4,14.1z M67.6,13.4c0.2,0,0.3,0,0.5-0.1c0.1-0.1,0.3-0.2,0.4-0.3s0.2-0.3,0.3-0.4v-2.2c-0.3,0.2-0.6,0.3-0.9,0.5 c-0.2,0.1-0.4,0.3-0.6,0.4c-0.2,0.1-0.3,0.3-0.3,0.5s-0.1,0.4-0.1,0.6c0,0.4,0.1,0.6,0.2,0.8C67.2,13.3,67.4,13.4,67.6,13.4z"}}),e("path",{attrs:{d:"M70.9,14V7.1h0.8v0.7c0.2-0.3,0.5-0.5,0.8-0.6c0.3-0.1,0.6-0.2,0.9-0.2c0.2,0,0.5,0.1,0.7,0.2s0.3,0.4,0.4,0.7 c0.2-0.3,0.5-0.5,0.8-0.7c0.3-0.2,0.6-0.2,0.9-0.2c0.2,0,0.4,0,0.6,0.1s0.3,0.3,0.4,0.5c0.1,0.2,0.2,0.5,0.2,0.9V14h-0.8V8.6 c0-0.4-0.1-0.7-0.2-0.8s-0.3-0.2-0.5-0.2c-0.2,0-0.4,0.1-0.7,0.2S74.7,8,74.5,8.3c0,0,0,0.1,0,0.1s0,0.1,0,0.1V14h-0.8V8.6 c0-0.4-0.1-0.7-0.2-0.8c-0.1-0.1-0.3-0.2-0.5-0.2c-0.2,0-0.4,0.1-0.7,0.2c-0.2,0.1-0.4,0.3-0.6,0.5V14H70.9z"}}),e("path",{attrs:{d:"M80.2,14.1c-0.6,0-1-0.2-1.3-0.5c-0.3-0.4-0.5-0.8-0.6-1.4l0.7-0.2c0,0.5,0.2,0.9,0.4,1.2 c0.2,0.2,0.5,0.4,0.8,0.4c0.3,0,0.5-0.1,0.7-0.3c0.2-0.2,0.2-0.4,0.2-0.7c0-0.2-0.1-0.5-0.2-0.7c-0.1-0.2-0.4-0.5-0.6-0.7l-0.9-0.8 c-0.3-0.3-0.5-0.5-0.7-0.8c-0.2-0.3-0.2-0.6-0.2-0.9c0-0.3,0.1-0.6,0.2-0.8c0.1-0.2,0.3-0.4,0.6-0.5C79.5,7,79.8,7,80.2,7 c0.5,0,0.9,0.2,1.2,0.5c0.3,0.3,0.4,0.8,0.4,1.3L81.2,9c0-0.3-0.1-0.6-0.1-0.8s-0.2-0.4-0.3-0.5c-0.1-0.1-0.3-0.1-0.5-0.1 c-0.3,0-0.5,0.1-0.6,0.2c-0.2,0.1-0.2,0.4-0.2,0.6c0,0.2,0,0.4,0.1,0.6c0.1,0.2,0.2,0.3,0.4,0.5l1,0.9c0.2,0.2,0.4,0.3,0.6,0.5 c0.2,0.2,0.3,0.4,0.4,0.6c0.1,0.2,0.2,0.5,0.2,0.8c0,0.4-0.1,0.7-0.2,0.9c-0.1,0.2-0.4,0.4-0.6,0.6C80.9,14,80.6,14.1,80.2,14.1z"}}),e("path",{attrs:{d:"M84.7,14.1c-0.5,0-0.8-0.1-1.1-0.3c-0.3-0.2-0.5-0.5-0.6-0.9s-0.2-0.9-0.2-1.4V9.6c0-0.6,0.1-1,0.2-1.4 c0.1-0.4,0.3-0.7,0.6-0.9C83.9,7.1,84.3,7,84.7,7c0.5,0,0.9,0.1,1.1,0.3s0.5,0.5,0.6,0.9c0.1,0.4,0.2,0.9,0.2,1.4v1.9 c0,0.6-0.1,1-0.2,1.4s-0.3,0.7-0.6,0.9S85.2,14.1,84.7,14.1z M84.7,13.4c0.3,0,0.5-0.1,0.7-0.2c0.1-0.2,0.2-0.4,0.3-0.7 c0-0.3,0-0.6,0-1v-2c0-0.4,0-0.7,0-1c0-0.3-0.1-0.5-0.3-0.7c-0.1-0.2-0.4-0.2-0.7-0.2c-0.3,0-0.5,0.1-0.7,0.2 c-0.1,0.2-0.2,0.4-0.3,0.7c0,0.3-0.1,0.6-0.1,1v2c0,0.4,0,0.7,0.1,1c0,0.3,0.1,0.5,0.3,0.7C84.2,13.4,84.4,13.4,84.7,13.4z"}}),e("path",{attrs:{d:"M88.2,14V7.7h-0.9V7.1h0.9V6.3c0-0.3,0-0.6,0.1-0.9c0.1-0.3,0.2-0.5,0.4-0.6c0.2-0.2,0.5-0.2,0.8-0.2 c0.1,0,0.2,0,0.4,0c0.1,0,0.2,0,0.3,0.1v0.6c-0.1,0-0.2,0-0.2,0c-0.1,0-0.2,0-0.2,0c-0.3,0-0.4,0.1-0.5,0.2s-0.1,0.4-0.1,0.8v0.8 h1.1v0.6h-1.1V14H88.2z"}}),e("path",{attrs:{d:"M92.7,14.1c-0.3,0-0.6-0.1-0.8-0.2s-0.3-0.3-0.4-0.5c-0.1-0.2-0.1-0.5-0.1-0.8V7.6h-0.9V7.1h0.9V4.9h0.9v2.1 h1.2v0.6h-1.2v4.8c0,0.3,0,0.6,0.1,0.7c0.1,0.1,0.2,0.2,0.5,0.2c0.1,0,0.2,0,0.2,0s0.2,0,0.3,0V14c-0.1,0-0.2,0-0.4,0.1 C92.9,14.1,92.8,14.1,92.7,14.1z"}})])])])])}],Sh=Yi(mh,vh,yh,!1,null,"b9554a55",null,null);const bh=Sh.exports;const Ch={name:"ImgDecode",data(){return{pReader:null}},methods:{async decodeImg(t){var e;try{let n=await(await(this.pReader=this.pReader||L.createInstance())).decode(t.target.files[0]);for(let h of n)alert(h.barcodeText);n.length||alert("No barcode found")}catch(i){let n;(e=i.message)!=null&&e.includes("network connection error")?n="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":n=i.message||i,console.error(n),alert(n)}t.target.value=""}},async beforeDestroy(){this.pReader&&((await this.pReader).destroyContext(),console.log("ImgDecode Component Unmount"))}};var wh=function(){var e=this,i=e._self._c;return i("div",{staticClass:"ImgDecode"},[i("input",{attrs:{type:"file"},on:{change:e.decodeImg}})])},xh=[],Th=Yi(Ch,wh,xh,!1,null,"13a70124",null,null);const Ih=Th.exports,Eh=""+new URL("logo.da9b9095.svg",import.meta.url).href;const Oh={name:"HelloWorld",data(){return{bShowScanner:!0,bShowImgDecode:!1}},async mounted(){var t;try{await L.loadWasm()}catch(e){let i;(t=e.message)!=null&&t.includes("network connection error")?i="Failed to connect to Dynamsoft License Server: network connection error. Check your Internet connection or contact Dynamsoft Support (support@dynamsoft.com) to acquire an offline license.":i=e.message||e,console.error(i),alert(i)}},components:{VideoDecode:bh,ImgDecode:Ih},methods:{showScanner(){this.bShowScanner=!0,this.bShowImgDecode=!1},showImgDecode(){this.bShowScanner=!1,this.bShowImgDecode=!0}}};var Ah=function(){var e=this,i=e._self._c;return i("div",{staticClass:"helloWorld"},[e._m(0),i("div",[i("button",{style:{marginRight:"10px",backgroundColor:e.bShowScanner?"rgb(255,174,55)":"white"},on:{click:e.showScanner}},[e._v("Video Decode")]),i("button",{style:{backgroundColor:e.bShowImgDecode?"rgb(255,174,55)":"white"},on:{click:e.showImgDecode}},[e._v("Image Decode")])]),i("div",{staticClass:"container"},[e.bShowScanner?i("VideoDecode"):e._e(),e.bShowImgDecode?i("ImgDecode"):e._e()],1)])},Dh=[function(){var t=this,e=t._self._c;return e("h1",[t._v("Hello World for Vue"),e("img",{staticClass:"applogo",attrs:{alt:"Vue logo",src:Eh}})])}],Rh=Yi(Oh,Ah,Dh,!1,null,"4fc18f93",null,null);const Mh=Rh.exports;const Lh={name:"App",components:{HelloWorld:Mh}};var Fh=function(){var e=this,i=e._self._c;return i("div",{attrs:{id:"app"}},[i("HelloWorld")],1)},Ph=[],kh=Yi(Lh,Fh,Ph,!1,null,null,null,null);const Bh=kh.exports;new Re({render:t=>t(Bh)}).$mount("#app");export{Nh as __vite_legacy_guard};
