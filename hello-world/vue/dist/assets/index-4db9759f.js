(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))a(d);new MutationObserver(d=>{for(const p of d)if(p.type==="childList")for(const _ of p.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&a(_)}).observe(document,{childList:!0,subtree:!0});function r(d){const p={};return d.integrity&&(p.integrity=d.integrity),d.referrerPolicy&&(p.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?p.credentials="include":d.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function a(d){if(d.ep)return;d.ep=!0;const p=r(d);fetch(d.href,p)}})();/**
* @vue/shared v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function qo(t,e){const r=new Set(t.split(","));return e?a=>r.has(a.toLowerCase()):a=>r.has(a)}const Je={},Ar=[],Mt=()=>{},Sc=()=>!1,Ps=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),Jo=t=>t.startsWith("onUpdate:"),at=Object.assign,Qo=(t,e)=>{const r=t.indexOf(e);r>-1&&t.splice(r,1)},bc=Object.prototype.hasOwnProperty,Ue=(t,e)=>bc.call(t,e),Re=Array.isArray,fn=t=>ks(t)==="[object Map]",Tc=t=>ks(t)==="[object Set]",Le=t=>typeof t=="function",dt=t=>typeof t=="string",On=t=>typeof t=="symbol",st=t=>t!==null&&typeof t=="object",Xl=t=>(st(t)||Le(t))&&Le(t.then)&&Le(t.catch),Ic=Object.prototype.toString,ks=t=>Ic.call(t),xc=t=>ks(t).slice(8,-1),Ac=t=>ks(t)==="[object Object]",ea=t=>dt(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,gn=qo(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Ns=t=>{const e=Object.create(null);return r=>e[r]||(e[r]=t(r))},Oc=/-(\w)/g,Dr=Ns(t=>t.replace(Oc,(e,r)=>r?r.toUpperCase():"")),Rc=/\B([A-Z])/g,Mr=Ns(t=>t.replace(Rc,"-$1").toLowerCase()),zl=Ns(t=>t.charAt(0).toUpperCase()+t.slice(1)),zs=Ns(t=>t?`on${zl(t)}`:""),Mi=(t,e)=>!Object.is(t,e),Ks=(t,e)=>{for(let r=0;r<t.length;r++)t[r](e)},Kl=(t,e,r,a=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:a,value:r})},Dc=t=>{const e=parseFloat(t);return isNaN(e)?t:e};let Oa;const $l=()=>Oa||(Oa=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function wn(t){if(Re(t)){const e={};for(let r=0;r<t.length;r++){const a=t[r],d=dt(a)?Pc(a):wn(a);if(d)for(const p in d)e[p]=d[p]}return e}else if(dt(t)||st(t))return t}const Lc=/;(?![^(]*\))/g,Mc=/:([^]+)/,Fc=/\/\*[^]*?\*\//g;function Pc(t){const e={};return t.replace(Fc,"").split(Lc).forEach(r=>{if(r){const a=r.split(Mc);a.length>1&&(e[a[0].trim()]=a[1].trim())}}),e}function ta(t){let e="";if(dt(t))e=t;else if(Re(t))for(let r=0;r<t.length;r++){const a=ta(t[r]);a&&(e+=a+" ")}else if(st(t))for(const r in t)t[r]&&(e+=r+" ");return e.trim()}const kc="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Nc=qo(kc);function Zl(t){return!!t||t===""}/**
* @vue/reactivity v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Vt;class Bc{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Vt,!e&&Vt&&(this.index=(Vt.scopes||(Vt.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const r=Vt;try{return Vt=this,e()}finally{Vt=r}}}on(){Vt=this}off(){Vt=this.parent}stop(e){if(this._active){let r,a;for(r=0,a=this.effects.length;r<a;r++)this.effects[r].stop();for(r=0,a=this.cleanups.length;r<a;r++)this.cleanups[r]();if(this.scopes)for(r=0,a=this.scopes.length;r<a;r++)this.scopes[r].stop(!0);if(!this.detached&&this.parent&&!e){const d=this.parent.scopes.pop();d&&d!==this&&(this.parent.scopes[this.index]=d,d.index=this.index)}this.parent=void 0,this._active=!1}}}function jc(t,e=Vt){e&&e.active&&e.effects.push(t)}function Uc(){return Vt}let er;class ia{constructor(e,r,a,d){this.fn=e,this.trigger=r,this.scheduler=a,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,jc(this,d)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Pi();for(let e=0;e<this._depsLength;e++){const r=this.deps[e];if(r.computed&&(Vc(r.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),ki()}return this._dirtyLevel>=4}set dirty(e){this._dirtyLevel=e?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let e=Oi,r=er;try{return Oi=!0,er=this,this._runnings++,Ra(this),this.fn()}finally{Da(this),this._runnings--,er=r,Oi=e}}stop(){this.active&&(Ra(this),Da(this),this.onStop&&this.onStop(),this.active=!1)}}function Vc(t){return t.value}function Ra(t){t._trackId++,t._depsLength=0}function Da(t){if(t.deps.length>t._depsLength){for(let e=t._depsLength;e<t.deps.length;e++)ql(t.deps[e],t);t.deps.length=t._depsLength}}function ql(t,e){const r=t.get(e);r!==void 0&&e._trackId!==r&&(t.delete(e),t.size===0&&t.cleanup())}let Oi=!0,yo=0;const Jl=[];function Pi(){Jl.push(Oi),Oi=!1}function ki(){const t=Jl.pop();Oi=t===void 0?!0:t}function ra(){yo++}function na(){for(yo--;!yo&&Eo.length;)Eo.shift()()}function Ql(t,e,r){if(e.get(t)!==t._trackId){e.set(t,t._trackId);const a=t.deps[t._depsLength];a!==e?(a&&ql(a,t),t.deps[t._depsLength++]=e):t._depsLength++}}const Eo=[];function eh(t,e,r){ra();for(const a of t.keys()){let d;a._dirtyLevel<e&&(d??(d=t.get(a)===a._trackId))&&(a._shouldSchedule||(a._shouldSchedule=a._dirtyLevel===0),a._dirtyLevel=e),a._shouldSchedule&&(d??(d=t.get(a)===a._trackId))&&(a.trigger(),(!a._runnings||a.allowRecurse)&&a._dirtyLevel!==2&&(a._shouldSchedule=!1,a.scheduler&&Eo.push(a.scheduler)))}na()}const th=(t,e)=>{const r=new Map;return r.cleanup=t,r.computed=e,r},Co=new WeakMap,tr=Symbol(""),wo=Symbol("");function Tt(t,e,r){if(Oi&&er){let a=Co.get(t);a||Co.set(t,a=new Map);let d=a.get(r);d||a.set(r,d=th(()=>a.delete(r))),Ql(er,d)}}function pi(t,e,r,a,d,p){const _=Co.get(t);if(!_)return;let E=[];if(e==="clear")E=[..._.values()];else if(r==="length"&&Re(t)){const C=Number(a);_.forEach((b,O)=>{(O==="length"||!On(O)&&O>=C)&&E.push(b)})}else switch(r!==void 0&&E.push(_.get(r)),e){case"add":Re(t)?ea(r)&&E.push(_.get("length")):(E.push(_.get(tr)),fn(t)&&E.push(_.get(wo)));break;case"delete":Re(t)||(E.push(_.get(tr)),fn(t)&&E.push(_.get(wo)));break;case"set":fn(t)&&E.push(_.get(tr));break}ra();for(const C of E)C&&eh(C,4);na()}const Gc=qo("__proto__,__v_isRef,__isVue"),ih=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(On)),La=Wc();function Wc(){const t={};return["includes","indexOf","lastIndexOf"].forEach(e=>{t[e]=function(...r){const a=He(this);for(let p=0,_=this.length;p<_;p++)Tt(a,"get",p+"");const d=a[e](...r);return d===-1||d===!1?a[e](...r.map(He)):d}}),["push","pop","shift","unshift","splice"].forEach(e=>{t[e]=function(...r){Pi(),ra();const a=He(this)[e].apply(this,r);return na(),ki(),a}}),t}function Hc(t){On(t)||(t=String(t));const e=He(this);return Tt(e,"has",t),e.hasOwnProperty(t)}class rh{constructor(e=!1,r=!1){this._isReadonly=e,this._isShallow=r}get(e,r,a){const d=this._isReadonly,p=this._isShallow;if(r==="__v_isReactive")return!d;if(r==="__v_isReadonly")return d;if(r==="__v_isShallow")return p;if(r==="__v_raw")return a===(d?p?ru:ah:p?oh:sh).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(a)?e:void 0;const _=Re(e);if(!d){if(_&&Ue(La,r))return Reflect.get(La,r,a);if(r==="hasOwnProperty")return Hc}const E=Reflect.get(e,r,a);return(On(r)?ih.has(r):Gc(r))||(d||Tt(e,"get",r),p)?E:It(E)?_&&ea(r)?E:E.value:st(E)?d?lh(E):aa(E):E}}class nh extends rh{constructor(e=!1){super(!1,e)}set(e,r,a,d){let p=e[r];if(!this._isShallow){const C=Sn(p);if(!ys(a)&&!Sn(a)&&(p=He(p),a=He(a)),!Re(e)&&It(p)&&!It(a))return C?!1:(p.value=a,!0)}const _=Re(e)&&ea(r)?Number(r)<e.length:Ue(e,r),E=Reflect.set(e,r,a,d);return e===He(d)&&(_?Mi(a,p)&&pi(e,"set",r,a):pi(e,"add",r,a)),E}deleteProperty(e,r){const a=Ue(e,r);e[r];const d=Reflect.deleteProperty(e,r);return d&&a&&pi(e,"delete",r,void 0),d}has(e,r){const a=Reflect.has(e,r);return(!On(r)||!ih.has(r))&&Tt(e,"has",r),a}ownKeys(e){return Tt(e,"iterate",Re(e)?"length":tr),Reflect.ownKeys(e)}}class Yc extends rh{constructor(e=!1){super(!0,e)}set(e,r){return!0}deleteProperty(e,r){return!0}}const Xc=new nh,zc=new Yc,Kc=new nh(!0);const sa=t=>t,Bs=t=>Reflect.getPrototypeOf(t);function Mn(t,e,r=!1,a=!1){t=t.__v_raw;const d=He(t),p=He(e);r||(Mi(e,p)&&Tt(d,"get",e),Tt(d,"get",p));const{has:_}=Bs(d),E=a?sa:r?ha:bn;if(_.call(d,e))return E(t.get(e));if(_.call(d,p))return E(t.get(p));t!==d&&t.get(e)}function Fn(t,e=!1){const r=this.__v_raw,a=He(r),d=He(t);return e||(Mi(t,d)&&Tt(a,"has",t),Tt(a,"has",d)),t===d?r.has(t):r.has(t)||r.has(d)}function Pn(t,e=!1){return t=t.__v_raw,!e&&Tt(He(t),"iterate",tr),Reflect.get(t,"size",t)}function Ma(t){t=He(t);const e=He(this);return Bs(e).has.call(e,t)||(e.add(t),pi(e,"add",t,t)),this}function Fa(t,e){e=He(e);const r=He(this),{has:a,get:d}=Bs(r);let p=a.call(r,t);p||(t=He(t),p=a.call(r,t));const _=d.call(r,t);return r.set(t,e),p?Mi(e,_)&&pi(r,"set",t,e):pi(r,"add",t,e),this}function Pa(t){const e=He(this),{has:r,get:a}=Bs(e);let d=r.call(e,t);d||(t=He(t),d=r.call(e,t)),a&&a.call(e,t);const p=e.delete(t);return d&&pi(e,"delete",t,void 0),p}function ka(){const t=He(this),e=t.size!==0,r=t.clear();return e&&pi(t,"clear",void 0,void 0),r}function kn(t,e){return function(a,d){const p=this,_=p.__v_raw,E=He(_),C=e?sa:t?ha:bn;return!t&&Tt(E,"iterate",tr),_.forEach((b,O)=>a.call(d,C(b),C(O),p))}}function Nn(t,e,r){return function(...a){const d=this.__v_raw,p=He(d),_=fn(p),E=t==="entries"||t===Symbol.iterator&&_,C=t==="keys"&&_,b=d[t](...a),O=r?sa:e?ha:bn;return!e&&Tt(p,"iterate",C?wo:tr),{next(){const{value:M,done:k}=b.next();return k?{value:M,done:k}:{value:E?[O(M[0]),O(M[1])]:O(M),done:k}},[Symbol.iterator](){return this}}}}function _i(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function $c(){const t={get(p){return Mn(this,p)},get size(){return Pn(this)},has:Fn,add:Ma,set:Fa,delete:Pa,clear:ka,forEach:kn(!1,!1)},e={get(p){return Mn(this,p,!1,!0)},get size(){return Pn(this)},has:Fn,add:Ma,set:Fa,delete:Pa,clear:ka,forEach:kn(!1,!0)},r={get(p){return Mn(this,p,!0)},get size(){return Pn(this,!0)},has(p){return Fn.call(this,p,!0)},add:_i("add"),set:_i("set"),delete:_i("delete"),clear:_i("clear"),forEach:kn(!0,!1)},a={get(p){return Mn(this,p,!0,!0)},get size(){return Pn(this,!0)},has(p){return Fn.call(this,p,!0)},add:_i("add"),set:_i("set"),delete:_i("delete"),clear:_i("clear"),forEach:kn(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(p=>{t[p]=Nn(p,!1,!1),r[p]=Nn(p,!0,!1),e[p]=Nn(p,!1,!0),a[p]=Nn(p,!0,!0)}),[t,r,e,a]}const[Zc,qc,Jc,Qc]=$c();function oa(t,e){const r=e?t?Qc:Jc:t?qc:Zc;return(a,d,p)=>d==="__v_isReactive"?!t:d==="__v_isReadonly"?t:d==="__v_raw"?a:Reflect.get(Ue(r,d)&&d in a?r:a,d,p)}const eu={get:oa(!1,!1)},tu={get:oa(!1,!0)},iu={get:oa(!0,!1)};const sh=new WeakMap,oh=new WeakMap,ah=new WeakMap,ru=new WeakMap;function nu(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function su(t){return t.__v_skip||!Object.isExtensible(t)?0:nu(xc(t))}function aa(t){return Sn(t)?t:la(t,!1,Xc,eu,sh)}function ou(t){return la(t,!1,Kc,tu,oh)}function lh(t){return la(t,!0,zc,iu,ah)}function la(t,e,r,a,d){if(!st(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const p=d.get(t);if(p)return p;const _=su(t);if(_===0)return t;const E=new Proxy(t,_===2?a:r);return d.set(t,E),E}function pn(t){return Sn(t)?pn(t.__v_raw):!!(t&&t.__v_isReactive)}function Sn(t){return!!(t&&t.__v_isReadonly)}function ys(t){return!!(t&&t.__v_isShallow)}function hh(t){return t?!!t.__v_raw:!1}function He(t){const e=t&&t.__v_raw;return e?He(e):t}function au(t){return Object.isExtensible(t)&&Kl(t,"__v_skip",!0),t}const bn=t=>st(t)?aa(t):t,ha=t=>st(t)?lh(t):t;class ch{constructor(e,r,a,d){this.getter=e,this._setter=r,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new ia(()=>e(this._value),()=>Hn(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!d,this.__v_isReadonly=a}get value(){const e=He(this);return(!e._cacheable||e.effect.dirty)&&Mi(e._value,e._value=e.effect.run())&&Hn(e,4),uh(e),e.effect._dirtyLevel>=2&&Hn(e,2),e._value}set value(e){this._setter(e)}get _dirty(){return this.effect.dirty}set _dirty(e){this.effect.dirty=e}}function lu(t,e,r=!1){let a,d;const p=Le(t);return p?(a=t,d=Mt):(a=t.get,d=t.set),new ch(a,d,p||!d,r)}function uh(t){var e;Oi&&er&&(t=He(t),Ql(er,(e=t.dep)!=null?e:t.dep=th(()=>t.dep=void 0,t instanceof ch?t:void 0)))}function Hn(t,e=4,r){t=He(t);const a=t.dep;a&&eh(a,e)}function It(t){return!!(t&&t.__v_isRef===!0)}function Es(t){return hu(t,!1)}function hu(t,e){return It(t)?t:new cu(t,e)}class cu{constructor(e,r){this.__v_isShallow=r,this.dep=void 0,this.__v_isRef=!0,this._rawValue=r?e:He(e),this._value=r?e:bn(e)}get value(){return uh(this),this._value}set value(e){const r=this.__v_isShallow||ys(e)||Sn(e);e=r?e:He(e),Mi(e,this._rawValue)&&(this._rawValue=e,this._value=r?e:bn(e),Hn(this,4))}}function dh(t){return It(t)?t.value:t}const uu={get:(t,e,r)=>dh(Reflect.get(t,e,r)),set:(t,e,r,a)=>{const d=t[e];return It(d)&&!It(r)?(d.value=r,!0):Reflect.set(t,e,r,a)}};function fh(t){return pn(t)?t:new Proxy(t,uu)}/**
* @vue/runtime-core v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ri(t,e,r,a){try{return a?t(...a):t()}catch(d){js(d,e,r)}}function Wt(t,e,r,a){if(Le(t)){const d=Ri(t,e,r,a);return d&&Xl(d)&&d.catch(p=>{js(p,e,r)}),d}if(Re(t)){const d=[];for(let p=0;p<t.length;p++)d.push(Wt(t[p],e,r,a));return d}}function js(t,e,r,a=!0){const d=e?e.vnode:null;if(e){let p=e.parent;const _=e.proxy,E=`https://vuejs.org/error-reference/#runtime-${r}`;for(;p;){const b=p.ec;if(b){for(let O=0;O<b.length;O++)if(b[O](t,_,E)===!1)return}p=p.parent}const C=e.appContext.config.errorHandler;if(C){Pi(),Ri(C,null,10,[t,_,E]),ki();return}}du(t,r,d,a)}function du(t,e,r,a=!0){console.error(t)}let Tn=!1,So=!1;const gt=[];let Zt=0;const Or=[];let Ti=null,Zi=0;const gh=Promise.resolve();let ca=null;function fu(t){const e=ca||gh;return t?e.then(this?t.bind(this):t):e}function gu(t){let e=Zt+1,r=gt.length;for(;e<r;){const a=e+r>>>1,d=gt[a],p=In(d);p<t||p===t&&d.pre?e=a+1:r=a}return e}function ua(t){(!gt.length||!gt.includes(t,Tn&&t.allowRecurse?Zt+1:Zt))&&(t.id==null?gt.push(t):gt.splice(gu(t.id),0,t),ph())}function ph(){!Tn&&!So&&(So=!0,ca=gh.then(_h))}function pu(t){const e=gt.indexOf(t);e>Zt&&gt.splice(e,1)}function mu(t){Re(t)?Or.push(...t):(!Ti||!Ti.includes(t,t.allowRecurse?Zi+1:Zi))&&Or.push(t),ph()}function Na(t,e,r=Tn?Zt+1:0){for(;r<gt.length;r++){const a=gt[r];if(a&&a.pre){if(t&&a.id!==t.uid)continue;gt.splice(r,1),r--,a()}}}function mh(t){if(Or.length){const e=[...new Set(Or)].sort((r,a)=>In(r)-In(a));if(Or.length=0,Ti){Ti.push(...e);return}for(Ti=e,Zi=0;Zi<Ti.length;Zi++)Ti[Zi]();Ti=null,Zi=0}}const In=t=>t.id==null?1/0:t.id,_u=(t,e)=>{const r=In(t)-In(e);if(r===0){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return r};function _h(t){So=!1,Tn=!0,gt.sort(_u);const e=Mt;try{for(Zt=0;Zt<gt.length;Zt++){const r=gt[Zt];r&&r.active!==!1&&Ri(r,null,14)}}finally{Zt=0,gt.length=0,mh(),Tn=!1,ca=null,(gt.length||Or.length)&&_h()}}function vu(t,e,...r){if(t.isUnmounted)return;const a=t.vnode.props||Je;let d=r;const p=e.startsWith("update:"),_=p&&e.slice(7);if(_&&_ in a){const O=`${_==="modelValue"?"model":_}Modifiers`,{number:M,trim:k}=a[O]||Je;k&&(d=r.map(V=>dt(V)?V.trim():V)),M&&(d=r.map(Dc))}let E,C=a[E=zs(e)]||a[E=zs(Dr(e))];!C&&p&&(C=a[E=zs(Mr(e))]),C&&Wt(C,t,6,d);const b=a[E+"Once"];if(b){if(!t.emitted)t.emitted={};else if(t.emitted[E])return;t.emitted[E]=!0,Wt(b,t,6,d)}}function vh(t,e,r=!1){const a=e.emitsCache,d=a.get(t);if(d!==void 0)return d;const p=t.emits;let _={},E=!1;if(!Le(t)){const C=b=>{const O=vh(b,e,!0);O&&(E=!0,at(_,O))};!r&&e.mixins.length&&e.mixins.forEach(C),t.extends&&C(t.extends),t.mixins&&t.mixins.forEach(C)}return!p&&!E?(st(t)&&a.set(t,null),null):(Re(p)?p.forEach(C=>_[C]=null):at(_,p),st(t)&&a.set(t,_),_)}function Us(t,e){return!t||!Ps(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ue(t,e[0].toLowerCase()+e.slice(1))||Ue(t,Mr(e))||Ue(t,e))}let qt=null,Vs=null;function Cs(t){const e=qt;return qt=t,Vs=t&&t.type.__scopeId||null,e}function yh(t){Vs=t}function Eh(){Vs=null}function yu(t,e=qt,r){if(!e||t._n)return t;const a=(...d)=>{a._d&&za(-1);const p=Cs(e);let _;try{_=t(...d)}finally{Cs(p),a._d&&za(1)}return _};return a._n=!0,a._c=!0,a._d=!0,a}function $s(t){const{type:e,vnode:r,proxy:a,withProxy:d,propsOptions:[p],slots:_,attrs:E,emit:C,render:b,renderCache:O,props:M,data:k,setupState:V,ctx:H,inheritAttrs:z}=t,Z=Cs(t);let $,J;try{if(r.shapeFlag&4){const he=d||a,ce=he;$=Kt(b.call(ce,he,O,M,V,k,H)),J=E}else{const he=e;$=Kt(he.length>1?he(M,{attrs:E,slots:_,emit:C}):he(M,null)),J=e.props?E:Eu(E)}}catch(he){vn.length=0,js(he,t,1),$=Di(xn)}let te=$;if(J&&z!==!1){const he=Object.keys(J),{shapeFlag:ce}=te;he.length&&ce&7&&(p&&he.some(Jo)&&(J=Cu(J,p)),te=Lr(te,J,!1,!0))}return r.dirs&&(te=Lr(te,null,!1,!0),te.dirs=te.dirs?te.dirs.concat(r.dirs):r.dirs),r.transition&&(te.transition=r.transition),$=te,Cs(Z),$}const Eu=t=>{let e;for(const r in t)(r==="class"||r==="style"||Ps(r))&&((e||(e={}))[r]=t[r]);return e},Cu=(t,e)=>{const r={};for(const a in t)(!Jo(a)||!(a.slice(9)in e))&&(r[a]=t[a]);return r};function wu(t,e,r){const{props:a,children:d,component:p}=t,{props:_,children:E,patchFlag:C}=e,b=p.emitsOptions;if(e.dirs||e.transition)return!0;if(r&&C>=0){if(C&1024)return!0;if(C&16)return a?Ba(a,_,b):!!_;if(C&8){const O=e.dynamicProps;for(let M=0;M<O.length;M++){const k=O[M];if(_[k]!==a[k]&&!Us(b,k))return!0}}}else return(d||E)&&(!E||!E.$stable)?!0:a===_?!1:a?_?Ba(a,_,b):!0:!!_;return!1}function Ba(t,e,r){const a=Object.keys(e);if(a.length!==Object.keys(t).length)return!0;for(let d=0;d<a.length;d++){const p=a[d];if(e[p]!==t[p]&&!Us(r,p))return!0}return!1}function Su({vnode:t,parent:e},r){for(;e;){const a=e.subTree;if(a.suspense&&a.suspense.activeBranch===t&&(a.el=t.el),a===t)(t=e.vnode).el=r,e=e.parent;else break}}const bu=Symbol.for("v-ndc"),Tu=t=>t.__isSuspense;function Iu(t,e){e&&e.pendingBranch?Re(t)?e.effects.push(...t):e.effects.push(t):mu(t)}const xu=Symbol.for("v-scx"),Au=()=>Xn(xu),Bn={};function Zs(t,e,r){return Ch(t,e,r)}function Ch(t,e,{immediate:r,deep:a,flush:d,once:p,onTrack:_,onTrigger:E}=Je){if(e&&p){const ue=e;e=(...be)=>{ue(...be),ce()}}const C=vt,b=ue=>a===!0?ue:Sr(ue,a===!1?1:void 0);let O,M=!1,k=!1;if(It(t)?(O=()=>t.value,M=ys(t)):pn(t)?(O=()=>b(t),M=!0):Re(t)?(k=!0,M=t.some(ue=>pn(ue)||ys(ue)),O=()=>t.map(ue=>{if(It(ue))return ue.value;if(pn(ue))return b(ue);if(Le(ue))return Ri(ue,C,2)})):Le(t)?e?O=()=>Ri(t,C,2):O=()=>(V&&V(),Wt(t,C,3,[H])):O=Mt,e&&a){const ue=O;O=()=>Sr(ue())}let V,H=ue=>{V=te.onStop=()=>{Ri(ue,C,4),V=te.onStop=void 0}},z;if(Hs)if(H=Mt,e?r&&Wt(e,C,3,[O(),k?[]:void 0,H]):O(),d==="sync"){const ue=Au();z=ue.__watcherHandles||(ue.__watcherHandles=[])}else return Mt;let Z=k?new Array(t.length).fill(Bn):Bn;const $=()=>{if(!(!te.active||!te.dirty))if(e){const ue=te.run();(a||M||(k?ue.some((be,v)=>Mi(be,Z[v])):Mi(ue,Z)))&&(V&&V(),Wt(e,C,3,[ue,Z===Bn?void 0:k&&Z[0]===Bn?[]:Z,H]),Z=ue)}else te.run()};$.allowRecurse=!!e;let J;d==="sync"?J=$:d==="post"?J=()=>Et($,C&&C.suspense):($.pre=!0,C&&($.id=C.uid),J=()=>ua($));const te=new ia(O,Mt,J),he=Uc(),ce=()=>{te.stop(),he&&Qo(he.effects,te)};return e?r?$():Z=te.run():d==="post"?Et(te.run.bind(te),C&&C.suspense):te.run(),z&&z.push(ce),ce}function Ou(t,e,r){const a=this.proxy,d=dt(t)?t.includes(".")?wh(a,t):()=>a[t]:t.bind(a,a);let p;Le(e)?p=e:(p=e.handler,r=e);const _=Rn(this),E=Ch(d,p.bind(a),r);return _(),E}function wh(t,e){const r=e.split(".");return()=>{let a=t;for(let d=0;d<r.length&&a;d++)a=a[r[d]];return a}}function Sr(t,e=1/0,r){if(e<=0||!st(t)||t.__v_skip||(r=r||new Set,r.has(t)))return t;if(r.add(t),e--,It(t))Sr(t.value,e,r);else if(Re(t))for(let a=0;a<t.length;a++)Sr(t[a],e,r);else if(Tc(t)||fn(t))t.forEach(a=>{Sr(a,e,r)});else if(Ac(t))for(const a in t)Sr(t[a],e,r);return t}function ji(t,e,r,a){const d=t.dirs,p=e&&e.dirs;for(let _=0;_<d.length;_++){const E=d[_];p&&(E.oldValue=p[_].value);let C=E.dir[a];C&&(Pi(),Wt(C,r,8,[t.el,E,t,e]),ki())}}/*! #__NO_SIDE_EFFECTS__ */function da(t,e){return Le(t)?(()=>at({name:t.name},e,{setup:t}))():t}const Yn=t=>!!t.type.__asyncLoader,Sh=t=>t.type.__isKeepAlive;function Ru(t,e){bh(t,"a",e)}function Du(t,e){bh(t,"da",e)}function bh(t,e,r=vt){const a=t.__wdc||(t.__wdc=()=>{let d=r;for(;d;){if(d.isDeactivated)return;d=d.parent}return t()});if(Gs(e,a,r),r){let d=r.parent;for(;d&&d.parent;)Sh(d.parent.vnode)&&Lu(a,e,r,d),d=d.parent}}function Lu(t,e,r,a){const d=Gs(e,t,a,!0);Ih(()=>{Qo(a[e],d)},r)}function Gs(t,e,r=vt,a=!1){if(r){const d=r[t]||(r[t]=[]),p=e.__weh||(e.__weh=(..._)=>{if(r.isUnmounted)return;Pi();const E=Rn(r),C=Wt(e,r,t,_);return E(),ki(),C});return a?d.unshift(p):d.push(p),p}}const mi=t=>(e,r=vt)=>(!Hs||t==="sp")&&Gs(t,(...a)=>e(...a),r),Mu=mi("bm"),Th=mi("m"),Fu=mi("bu"),Pu=mi("u"),fa=mi("bum"),Ih=mi("um"),ku=mi("sp"),Nu=mi("rtg"),Bu=mi("rtc");function ju(t,e=vt){Gs("ec",t,e)}const bo=t=>t?Gh(t)?va(t)||t.proxy:bo(t.parent):null,mn=at(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>bo(t.parent),$root:t=>bo(t.root),$emit:t=>t.emit,$options:t=>ga(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,ua(t.update)}),$nextTick:t=>t.n||(t.n=fu.bind(t.proxy)),$watch:t=>Ou.bind(t)}),qs=(t,e)=>t!==Je&&!t.__isScriptSetup&&Ue(t,e),Uu={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:r,setupState:a,data:d,props:p,accessCache:_,type:E,appContext:C}=t;let b;if(e[0]!=="$"){const V=_[e];if(V!==void 0)switch(V){case 1:return a[e];case 2:return d[e];case 4:return r[e];case 3:return p[e]}else{if(qs(a,e))return _[e]=1,a[e];if(d!==Je&&Ue(d,e))return _[e]=2,d[e];if((b=t.propsOptions[0])&&Ue(b,e))return _[e]=3,p[e];if(r!==Je&&Ue(r,e))return _[e]=4,r[e];To&&(_[e]=0)}}const O=mn[e];let M,k;if(O)return e==="$attrs"&&Tt(t.attrs,"get",""),O(t);if((M=E.__cssModules)&&(M=M[e]))return M;if(r!==Je&&Ue(r,e))return _[e]=4,r[e];if(k=C.config.globalProperties,Ue(k,e))return k[e]},set({_:t},e,r){const{data:a,setupState:d,ctx:p}=t;return qs(d,e)?(d[e]=r,!0):a!==Je&&Ue(a,e)?(a[e]=r,!0):Ue(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(p[e]=r,!0)},has({_:{data:t,setupState:e,accessCache:r,ctx:a,appContext:d,propsOptions:p}},_){let E;return!!r[_]||t!==Je&&Ue(t,_)||qs(e,_)||(E=p[0])&&Ue(E,_)||Ue(a,_)||Ue(mn,_)||Ue(d.config.globalProperties,_)},defineProperty(t,e,r){return r.get!=null?t._.accessCache[e]=0:Ue(r,"value")&&this.set(t,e,r.value,null),Reflect.defineProperty(t,e,r)}};function ja(t){return Re(t)?t.reduce((e,r)=>(e[r]=null,e),{}):t}let To=!0;function Vu(t){const e=ga(t),r=t.proxy,a=t.ctx;To=!1,e.beforeCreate&&Ua(e.beforeCreate,t,"bc");const{data:d,computed:p,methods:_,watch:E,provide:C,inject:b,created:O,beforeMount:M,mounted:k,beforeUpdate:V,updated:H,activated:z,deactivated:Z,beforeDestroy:$,beforeUnmount:J,destroyed:te,unmounted:he,render:ce,renderTracked:ue,renderTriggered:be,errorCaptured:v,serverPrefetch:pe,expose:Ce,inheritAttrs:fe,components:l,directives:s,filters:o}=e;if(b&&Gu(b,a,null),_)for(const n in _){const h=_[n];Le(h)&&(a[n]=h.bind(r))}if(d){const n=d.call(r,r);st(n)&&(t.data=aa(n))}if(To=!0,p)for(const n in p){const h=p[n],g=Le(h)?h.bind(r,r):Le(h.get)?h.get.bind(r,r):Mt,u=!Le(h)&&Le(h.set)?h.set.bind(r):Mt,f=vd({get:g,set:u});Object.defineProperty(a,n,{enumerable:!0,configurable:!0,get:()=>f.value,set:m=>f.value=m})}if(E)for(const n in E)xh(E[n],a,r,n);if(C){const n=Le(C)?C.call(r):C;Reflect.ownKeys(n).forEach(h=>{Ku(h,n[h])})}O&&Ua(O,t,"c");function i(n,h){Re(h)?h.forEach(g=>n(g.bind(r))):h&&n(h.bind(r))}if(i(Mu,M),i(Th,k),i(Fu,V),i(Pu,H),i(Ru,z),i(Du,Z),i(ju,v),i(Bu,ue),i(Nu,be),i(fa,J),i(Ih,he),i(ku,pe),Re(Ce))if(Ce.length){const n=t.exposed||(t.exposed={});Ce.forEach(h=>{Object.defineProperty(n,h,{get:()=>r[h],set:g=>r[h]=g})})}else t.exposed||(t.exposed={});ce&&t.render===Mt&&(t.render=ce),fe!=null&&(t.inheritAttrs=fe),l&&(t.components=l),s&&(t.directives=s)}function Gu(t,e,r=Mt){Re(t)&&(t=Io(t));for(const a in t){const d=t[a];let p;st(d)?"default"in d?p=Xn(d.from||a,d.default,!0):p=Xn(d.from||a):p=Xn(d),It(p)?Object.defineProperty(e,a,{enumerable:!0,configurable:!0,get:()=>p.value,set:_=>p.value=_}):e[a]=p}}function Ua(t,e,r){Wt(Re(t)?t.map(a=>a.bind(e.proxy)):t.bind(e.proxy),e,r)}function xh(t,e,r,a){const d=a.includes(".")?wh(r,a):()=>r[a];if(dt(t)){const p=e[t];Le(p)&&Zs(d,p)}else if(Le(t))Zs(d,t.bind(r));else if(st(t))if(Re(t))t.forEach(p=>xh(p,e,r,a));else{const p=Le(t.handler)?t.handler.bind(r):e[t.handler];Le(p)&&Zs(d,p,t)}}function ga(t){const e=t.type,{mixins:r,extends:a}=e,{mixins:d,optionsCache:p,config:{optionMergeStrategies:_}}=t.appContext,E=p.get(e);let C;return E?C=E:!d.length&&!r&&!a?C=e:(C={},d.length&&d.forEach(b=>ws(C,b,_,!0)),ws(C,e,_)),st(e)&&p.set(e,C),C}function ws(t,e,r,a=!1){const{mixins:d,extends:p}=e;p&&ws(t,p,r,!0),d&&d.forEach(_=>ws(t,_,r,!0));for(const _ in e)if(!(a&&_==="expose")){const E=Wu[_]||r&&r[_];t[_]=E?E(t[_],e[_]):e[_]}return t}const Wu={data:Va,props:Ga,emits:Ga,methods:Hr,computed:Hr,beforeCreate:_t,created:_t,beforeMount:_t,mounted:_t,beforeUpdate:_t,updated:_t,beforeDestroy:_t,beforeUnmount:_t,destroyed:_t,unmounted:_t,activated:_t,deactivated:_t,errorCaptured:_t,serverPrefetch:_t,components:Hr,directives:Hr,watch:Yu,provide:Va,inject:Hu};function Va(t,e){return e?t?function(){return at(Le(t)?t.call(this,this):t,Le(e)?e.call(this,this):e)}:e:t}function Hu(t,e){return Hr(Io(t),Io(e))}function Io(t){if(Re(t)){const e={};for(let r=0;r<t.length;r++)e[t[r]]=t[r];return e}return t}function _t(t,e){return t?[...new Set([].concat(t,e))]:e}function Hr(t,e){return t?at(Object.create(null),t,e):e}function Ga(t,e){return t?Re(t)&&Re(e)?[...new Set([...t,...e])]:at(Object.create(null),ja(t),ja(e??{})):e}function Yu(t,e){if(!t)return e;if(!e)return t;const r=at(Object.create(null),t);for(const a in e)r[a]=_t(t[a],e[a]);return r}function Ah(){return{app:null,config:{isNativeTag:Sc,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Xu=0;function zu(t,e){return function(a,d=null){Le(a)||(a=at({},a)),d!=null&&!st(d)&&(d=null);const p=Ah(),_=new WeakSet;let E=!1;const C=p.app={_uid:Xu++,_component:a,_props:d,_container:null,_context:p,_instance:null,version:yd,get config(){return p.config},set config(b){},use(b,...O){return _.has(b)||(b&&Le(b.install)?(_.add(b),b.install(C,...O)):Le(b)&&(_.add(b),b(C,...O))),C},mixin(b){return p.mixins.includes(b)||p.mixins.push(b),C},component(b,O){return O?(p.components[b]=O,C):p.components[b]},directive(b,O){return O?(p.directives[b]=O,C):p.directives[b]},mount(b,O,M){if(!E){const k=Di(a,d);return k.appContext=p,M===!0?M="svg":M===!1&&(M=void 0),O&&e?e(k,b):t(k,b,M),E=!0,C._container=b,b.__vue_app__=C,va(k.component)||k.component.proxy}},unmount(){E&&(t(null,C._container),delete C._container.__vue_app__)},provide(b,O){return p.provides[b]=O,C},runWithContext(b){const O=_n;_n=C;try{return b()}finally{_n=O}}};return C}}let _n=null;function Ku(t,e){if(vt){let r=vt.provides;const a=vt.parent&&vt.parent.provides;a===r&&(r=vt.provides=Object.create(a)),r[t]=e}}function Xn(t,e,r=!1){const a=vt||qt;if(a||_n){const d=a?a.parent==null?a.vnode.appContext&&a.vnode.appContext.provides:a.parent.provides:_n._context.provides;if(d&&t in d)return d[t];if(arguments.length>1)return r&&Le(e)?e.call(a&&a.proxy):e}}const Oh={},Rh=()=>Object.create(Oh),Dh=t=>Object.getPrototypeOf(t)===Oh;function $u(t,e,r,a=!1){const d={},p=Rh();t.propsDefaults=Object.create(null),Lh(t,e,d,p);for(const _ in t.propsOptions[0])_ in d||(d[_]=void 0);r?t.props=a?d:ou(d):t.type.props?t.props=d:t.props=p,t.attrs=p}function Zu(t,e,r,a){const{props:d,attrs:p,vnode:{patchFlag:_}}=t,E=He(d),[C]=t.propsOptions;let b=!1;if((a||_>0)&&!(_&16)){if(_&8){const O=t.vnode.dynamicProps;for(let M=0;M<O.length;M++){let k=O[M];if(Us(t.emitsOptions,k))continue;const V=e[k];if(C)if(Ue(p,k))V!==p[k]&&(p[k]=V,b=!0);else{const H=Dr(k);d[H]=xo(C,E,H,V,t,!1)}else V!==p[k]&&(p[k]=V,b=!0)}}}else{Lh(t,e,d,p)&&(b=!0);let O;for(const M in E)(!e||!Ue(e,M)&&((O=Mr(M))===M||!Ue(e,O)))&&(C?r&&(r[M]!==void 0||r[O]!==void 0)&&(d[M]=xo(C,E,M,void 0,t,!0)):delete d[M]);if(p!==E)for(const M in p)(!e||!Ue(e,M))&&(delete p[M],b=!0)}b&&pi(t.attrs,"set","")}function Lh(t,e,r,a){const[d,p]=t.propsOptions;let _=!1,E;if(e)for(let C in e){if(gn(C))continue;const b=e[C];let O;d&&Ue(d,O=Dr(C))?!p||!p.includes(O)?r[O]=b:(E||(E={}))[O]=b:Us(t.emitsOptions,C)||(!(C in a)||b!==a[C])&&(a[C]=b,_=!0)}if(p){const C=He(r),b=E||Je;for(let O=0;O<p.length;O++){const M=p[O];r[M]=xo(d,C,M,b[M],t,!Ue(b,M))}}return _}function xo(t,e,r,a,d,p){const _=t[r];if(_!=null){const E=Ue(_,"default");if(E&&a===void 0){const C=_.default;if(_.type!==Function&&!_.skipFactory&&Le(C)){const{propsDefaults:b}=d;if(r in b)a=b[r];else{const O=Rn(d);a=b[r]=C.call(null,e),O()}}else a=C}_[0]&&(p&&!E?a=!1:_[1]&&(a===""||a===Mr(r))&&(a=!0))}return a}function Mh(t,e,r=!1){const a=e.propsCache,d=a.get(t);if(d)return d;const p=t.props,_={},E=[];let C=!1;if(!Le(t)){const O=M=>{C=!0;const[k,V]=Mh(M,e,!0);at(_,k),V&&E.push(...V)};!r&&e.mixins.length&&e.mixins.forEach(O),t.extends&&O(t.extends),t.mixins&&t.mixins.forEach(O)}if(!p&&!C)return st(t)&&a.set(t,Ar),Ar;if(Re(p))for(let O=0;O<p.length;O++){const M=Dr(p[O]);Wa(M)&&(_[M]=Je)}else if(p)for(const O in p){const M=Dr(O);if(Wa(M)){const k=p[O],V=_[M]=Re(k)||Le(k)?{type:k}:at({},k);if(V){const H=Xa(Boolean,V.type),z=Xa(String,V.type);V[0]=H>-1,V[1]=z<0||H<z,(H>-1||Ue(V,"default"))&&E.push(M)}}}const b=[_,E];return st(t)&&a.set(t,b),b}function Wa(t){return t[0]!=="$"&&!gn(t)}function Ha(t){return t===null?"null":typeof t=="function"?t.name||"":typeof t=="object"&&t.constructor&&t.constructor.name||""}function Ya(t,e){return Ha(t)===Ha(e)}function Xa(t,e){return Re(e)?e.findIndex(r=>Ya(r,t)):Le(e)&&Ya(e,t)?0:-1}const Fh=t=>t[0]==="_"||t==="$stable",pa=t=>Re(t)?t.map(Kt):[Kt(t)],qu=(t,e,r)=>{if(e._n)return e;const a=yu((...d)=>pa(e(...d)),r);return a._c=!1,a},Ph=(t,e,r)=>{const a=t._ctx;for(const d in t){if(Fh(d))continue;const p=t[d];if(Le(p))e[d]=qu(d,p,a);else if(p!=null){const _=pa(p);e[d]=()=>_}}},kh=(t,e)=>{const r=pa(e);t.slots.default=()=>r},Ju=(t,e)=>{const r=t.slots=Rh();if(t.vnode.shapeFlag&32){const a=e._;a?(at(r,e),Kl(r,"_",a,!0)):Ph(e,r)}else e&&kh(t,e)},Qu=(t,e,r)=>{const{vnode:a,slots:d}=t;let p=!0,_=Je;if(a.shapeFlag&32){const E=e._;E?r&&E===1?p=!1:(at(d,e),!r&&E===1&&delete d._):(p=!e.$stable,Ph(e,d)),_=e}else e&&(kh(t,e),_={default:1});if(p)for(const E in d)!Fh(E)&&_[E]==null&&delete d[E]};function Ao(t,e,r,a,d=!1){if(Re(t)){t.forEach((k,V)=>Ao(k,e&&(Re(e)?e[V]:e),r,a,d));return}if(Yn(a)&&!d)return;const p=a.shapeFlag&4?va(a.component)||a.component.proxy:a.el,_=d?null:p,{i:E,r:C}=t,b=e&&e.r,O=E.refs===Je?E.refs={}:E.refs,M=E.setupState;if(b!=null&&b!==C&&(dt(b)?(O[b]=null,Ue(M,b)&&(M[b]=null)):It(b)&&(b.value=null)),Le(C))Ri(C,E,12,[_,O]);else{const k=dt(C),V=It(C);if(k||V){const H=()=>{if(t.f){const z=k?Ue(M,C)?M[C]:O[C]:C.value;d?Re(z)&&Qo(z,p):Re(z)?z.includes(p)||z.push(p):k?(O[C]=[p],Ue(M,C)&&(M[C]=O[C])):(C.value=[p],t.k&&(O[t.k]=C.value))}else k?(O[C]=_,Ue(M,C)&&(M[C]=_)):V&&(C.value=_,t.k&&(O[t.k]=_))};_?(H.id=-1,Et(H,r)):H()}}}const Et=Iu;function ed(t){return td(t)}function td(t,e){const r=$l();r.__VUE__=!0;const{insert:a,remove:d,patchProp:p,createElement:_,createText:E,createComment:C,setText:b,setElementText:O,parentNode:M,nextSibling:k,setScopeId:V=Mt,insertStaticContent:H}=t,z=(A,x,R,P=null,U=null,W=null,F=void 0,L=null,B=!!x.dynamicChildren)=>{if(A===x)return;A&&!Nr(A,x)&&(P=D(A),m(A,U,W,!0),A=null),x.patchFlag===-2&&(B=!1,x.dynamicChildren=null);const{type:G,ref:Y,shapeFlag:q}=x;switch(G){case Ws:Z(A,x,R,P);break;case xn:$(A,x,R,P);break;case Qs:A==null&&J(x,R,P,F);break;case ai:l(A,x,R,P,U,W,F,L,B);break;default:q&1?ce(A,x,R,P,U,W,F,L,B):q&6?s(A,x,R,P,U,W,F,L,B):(q&64||q&128)&&G.process(A,x,R,P,U,W,F,L,B,K)}Y!=null&&U&&Ao(Y,A&&A.ref,W,x||A,!x)},Z=(A,x,R,P)=>{if(A==null)a(x.el=E(x.children),R,P);else{const U=x.el=A.el;x.children!==A.children&&b(U,x.children)}},$=(A,x,R,P)=>{A==null?a(x.el=C(x.children||""),R,P):x.el=A.el},J=(A,x,R,P)=>{[A.el,A.anchor]=H(A.children,x,R,P,A.el,A.anchor)},te=({el:A,anchor:x},R,P)=>{let U;for(;A&&A!==x;)U=k(A),a(A,R,P),A=U;a(x,R,P)},he=({el:A,anchor:x})=>{let R;for(;A&&A!==x;)R=k(A),d(A),A=R;d(x)},ce=(A,x,R,P,U,W,F,L,B)=>{x.type==="svg"?F="svg":x.type==="math"&&(F="mathml"),A==null?ue(x,R,P,U,W,F,L,B):pe(A,x,U,W,F,L,B)},ue=(A,x,R,P,U,W,F,L)=>{let B,G;const{props:Y,shapeFlag:q,transition:ie,dirs:ne}=A;if(B=A.el=_(A.type,W,Y&&Y.is,Y),q&8?O(B,A.children):q&16&&v(A.children,B,null,P,U,Js(A,W),F,L),ne&&ji(A,null,P,"created"),be(B,A,A.scopeId,F,P),Y){for(const se in Y)se!=="value"&&!gn(se)&&p(B,se,null,Y[se],W,A.children,P,U,S);"value"in Y&&p(B,"value",null,Y.value,W),(G=Y.onVnodeBeforeMount)&&Ht(G,P,A)}ne&&ji(A,null,P,"beforeMount");const re=id(U,ie);re&&ie.beforeEnter(B),a(B,x,R),((G=Y&&Y.onVnodeMounted)||re||ne)&&Et(()=>{G&&Ht(G,P,A),re&&ie.enter(B),ne&&ji(A,null,P,"mounted")},U)},be=(A,x,R,P,U)=>{if(R&&V(A,R),P)for(let W=0;W<P.length;W++)V(A,P[W]);if(U){let W=U.subTree;if(x===W){const F=U.vnode;be(A,F,F.scopeId,F.slotScopeIds,U.parent)}}},v=(A,x,R,P,U,W,F,L,B=0)=>{for(let G=B;G<A.length;G++){const Y=A[G]=L?Ii(A[G]):Kt(A[G]);z(null,Y,x,R,P,U,W,F,L)}},pe=(A,x,R,P,U,W,F)=>{const L=x.el=A.el;let{patchFlag:B,dynamicChildren:G,dirs:Y}=x;B|=A.patchFlag&16;const q=A.props||Je,ie=x.props||Je;let ne;if(R&&Ui(R,!1),(ne=ie.onVnodeBeforeUpdate)&&Ht(ne,R,x,A),Y&&ji(x,A,R,"beforeUpdate"),R&&Ui(R,!0),G?Ce(A.dynamicChildren,G,L,R,P,Js(x,U),W):F||h(A,x,L,null,R,P,Js(x,U),W,!1),B>0){if(B&16)fe(L,x,q,ie,R,P,U);else if(B&2&&q.class!==ie.class&&p(L,"class",null,ie.class,U),B&4&&p(L,"style",q.style,ie.style,U),B&8){const re=x.dynamicProps;for(let se=0;se<re.length;se++){const oe=re[se],ae=q[oe],ge=ie[oe];(ge!==ae||oe==="value")&&p(L,oe,ae,ge,U,A.children,R,P,S)}}B&1&&A.children!==x.children&&O(L,x.children)}else!F&&G==null&&fe(L,x,q,ie,R,P,U);((ne=ie.onVnodeUpdated)||Y)&&Et(()=>{ne&&Ht(ne,R,x,A),Y&&ji(x,A,R,"updated")},P)},Ce=(A,x,R,P,U,W,F)=>{for(let L=0;L<x.length;L++){const B=A[L],G=x[L],Y=B.el&&(B.type===ai||!Nr(B,G)||B.shapeFlag&70)?M(B.el):R;z(B,G,Y,null,P,U,W,F,!0)}},fe=(A,x,R,P,U,W,F)=>{if(R!==P){if(R!==Je)for(const L in R)!gn(L)&&!(L in P)&&p(A,L,R[L],null,F,x.children,U,W,S);for(const L in P){if(gn(L))continue;const B=P[L],G=R[L];B!==G&&L!=="value"&&p(A,L,G,B,F,x.children,U,W,S)}"value"in P&&p(A,"value",R.value,P.value,F)}},l=(A,x,R,P,U,W,F,L,B)=>{const G=x.el=A?A.el:E(""),Y=x.anchor=A?A.anchor:E("");let{patchFlag:q,dynamicChildren:ie,slotScopeIds:ne}=x;ne&&(L=L?L.concat(ne):ne),A==null?(a(G,R,P),a(Y,R,P),v(x.children||[],R,Y,U,W,F,L,B)):q>0&&q&64&&ie&&A.dynamicChildren?(Ce(A.dynamicChildren,ie,R,U,W,F,L),(x.key!=null||U&&x===U.subTree)&&Nh(A,x,!0)):h(A,x,R,Y,U,W,F,L,B)},s=(A,x,R,P,U,W,F,L,B)=>{x.slotScopeIds=L,A==null?x.shapeFlag&512?U.ctx.activate(x,R,P,F,B):o(x,R,P,U,W,F,B):c(A,x,B)},o=(A,x,R,P,U,W,F)=>{const L=A.component=dd(A,P,U);if(Sh(A)&&(L.ctx.renderer=K),fd(L),L.asyncDep){if(U&&U.registerDep(L,i),!A.el){const B=L.subTree=Di(xn);$(null,B,x,R)}}else i(L,A,x,R,U,W,F)},c=(A,x,R)=>{const P=x.component=A.component;if(wu(A,x,R))if(P.asyncDep&&!P.asyncResolved){n(P,x,R);return}else P.next=x,pu(P.update),P.effect.dirty=!0,P.update();else x.el=A.el,P.vnode=x},i=(A,x,R,P,U,W,F)=>{const L=()=>{if(A.isMounted){let{next:Y,bu:q,u:ie,parent:ne,vnode:re}=A;{const de=Bh(A);if(de){Y&&(Y.el=re.el,n(A,Y,F)),de.asyncDep.then(()=>{A.isUnmounted||L()});return}}let se=Y,oe;Ui(A,!1),Y?(Y.el=re.el,n(A,Y,F)):Y=re,q&&Ks(q),(oe=Y.props&&Y.props.onVnodeBeforeUpdate)&&Ht(oe,ne,Y,re),Ui(A,!0);const ae=$s(A),ge=A.subTree;A.subTree=ae,z(ge,ae,M(ge.el),D(ge),A,U,W),Y.el=ae.el,se===null&&Su(A,ae.el),ie&&Et(ie,U),(oe=Y.props&&Y.props.onVnodeUpdated)&&Et(()=>Ht(oe,ne,Y,re),U)}else{let Y;const{el:q,props:ie}=x,{bm:ne,m:re,parent:se}=A,oe=Yn(x);if(Ui(A,!1),ne&&Ks(ne),!oe&&(Y=ie&&ie.onVnodeBeforeMount)&&Ht(Y,se,x),Ui(A,!0),q&&Q){const ae=()=>{A.subTree=$s(A),Q(q,A.subTree,A,U,null)};oe?x.type.__asyncLoader().then(()=>!A.isUnmounted&&ae()):ae()}else{const ae=A.subTree=$s(A);z(null,ae,R,P,A,U,W),x.el=ae.el}if(re&&Et(re,U),!oe&&(Y=ie&&ie.onVnodeMounted)){const ae=x;Et(()=>Ht(Y,se,ae),U)}(x.shapeFlag&256||se&&Yn(se.vnode)&&se.vnode.shapeFlag&256)&&A.a&&Et(A.a,U),A.isMounted=!0,x=R=P=null}},B=A.effect=new ia(L,Mt,()=>ua(G),A.scope),G=A.update=()=>{B.dirty&&B.run()};G.id=A.uid,Ui(A,!0),G()},n=(A,x,R)=>{x.component=A;const P=A.vnode.props;A.vnode=x,A.next=null,Zu(A,x.props,P,R),Qu(A,x.children,R),Pi(),Na(A),ki()},h=(A,x,R,P,U,W,F,L,B=!1)=>{const G=A&&A.children,Y=A?A.shapeFlag:0,q=x.children,{patchFlag:ie,shapeFlag:ne}=x;if(ie>0){if(ie&128){u(G,q,R,P,U,W,F,L,B);return}else if(ie&256){g(G,q,R,P,U,W,F,L,B);return}}ne&8?(Y&16&&S(G,U,W),q!==G&&O(R,q)):Y&16?ne&16?u(G,q,R,P,U,W,F,L,B):S(G,U,W,!0):(Y&8&&O(R,""),ne&16&&v(q,R,P,U,W,F,L,B))},g=(A,x,R,P,U,W,F,L,B)=>{A=A||Ar,x=x||Ar;const G=A.length,Y=x.length,q=Math.min(G,Y);let ie;for(ie=0;ie<q;ie++){const ne=x[ie]=B?Ii(x[ie]):Kt(x[ie]);z(A[ie],ne,R,null,U,W,F,L,B)}G>Y?S(A,U,W,!0,!1,q):v(x,R,P,U,W,F,L,B,q)},u=(A,x,R,P,U,W,F,L,B)=>{let G=0;const Y=x.length;let q=A.length-1,ie=Y-1;for(;G<=q&&G<=ie;){const ne=A[G],re=x[G]=B?Ii(x[G]):Kt(x[G]);if(Nr(ne,re))z(ne,re,R,null,U,W,F,L,B);else break;G++}for(;G<=q&&G<=ie;){const ne=A[q],re=x[ie]=B?Ii(x[ie]):Kt(x[ie]);if(Nr(ne,re))z(ne,re,R,null,U,W,F,L,B);else break;q--,ie--}if(G>q){if(G<=ie){const ne=ie+1,re=ne<Y?x[ne].el:P;for(;G<=ie;)z(null,x[G]=B?Ii(x[G]):Kt(x[G]),R,re,U,W,F,L,B),G++}}else if(G>ie)for(;G<=q;)m(A[G],U,W,!0),G++;else{const ne=G,re=G,se=new Map;for(G=re;G<=ie;G++){const Qe=x[G]=B?Ii(x[G]):Kt(x[G]);Qe.key!=null&&se.set(Qe.key,G)}let oe,ae=0;const ge=ie-re+1;let de=!1,xe=0;const ke=new Array(ge);for(G=0;G<ge;G++)ke[G]=0;for(G=ne;G<=q;G++){const Qe=A[G];if(ae>=ge){m(Qe,U,W,!0);continue}let lt;if(Qe.key!=null)lt=se.get(Qe.key);else for(oe=re;oe<=ie;oe++)if(ke[oe-re]===0&&Nr(Qe,x[oe])){lt=oe;break}lt===void 0?m(Qe,U,W,!0):(ke[lt-re]=G+1,lt>=xe?xe=lt:de=!0,z(Qe,x[lt],R,null,U,W,F,L,B),ae++)}const pt=de?rd(ke):Ar;for(oe=pt.length-1,G=ge-1;G>=0;G--){const Qe=re+G,lt=x[Qe],Ke=Qe+1<Y?x[Qe+1].el:P;ke[G]===0?z(null,lt,R,Ke,U,W,F,L,B):de&&(oe<0||G!==pt[oe]?f(lt,R,Ke,2):oe--)}}},f=(A,x,R,P,U=null)=>{const{el:W,type:F,transition:L,children:B,shapeFlag:G}=A;if(G&6){f(A.component.subTree,x,R,P);return}if(G&128){A.suspense.move(x,R,P);return}if(G&64){F.move(A,x,R,K);return}if(F===ai){a(W,x,R);for(let q=0;q<B.length;q++)f(B[q],x,R,P);a(A.anchor,x,R);return}if(F===Qs){te(A,x,R);return}if(P!==2&&G&1&&L)if(P===0)L.beforeEnter(W),a(W,x,R),Et(()=>L.enter(W),U);else{const{leave:q,delayLeave:ie,afterLeave:ne}=L,re=()=>a(W,x,R),se=()=>{q(W,()=>{re(),ne&&ne()})};ie?ie(W,re,se):se()}else a(W,x,R)},m=(A,x,R,P=!1,U=!1)=>{const{type:W,props:F,ref:L,children:B,dynamicChildren:G,shapeFlag:Y,patchFlag:q,dirs:ie}=A;if(L!=null&&Ao(L,null,R,A,!0),Y&256){x.ctx.deactivate(A);return}const ne=Y&1&&ie,re=!Yn(A);let se;if(re&&(se=F&&F.onVnodeBeforeUnmount)&&Ht(se,x,A),Y&6)T(A.component,R,P);else{if(Y&128){A.suspense.unmount(R,P);return}ne&&ji(A,null,x,"beforeUnmount"),Y&64?A.type.remove(A,x,R,U,K,P):G&&(W!==ai||q>0&&q&64)?S(G,x,R,!1,!0):(W===ai&&q&384||!U&&Y&16)&&S(B,x,R),P&&y(A)}(re&&(se=F&&F.onVnodeUnmounted)||ne)&&Et(()=>{se&&Ht(se,x,A),ne&&ji(A,null,x,"unmounted")},R)},y=A=>{const{type:x,el:R,anchor:P,transition:U}=A;if(x===ai){w(R,P);return}if(x===Qs){he(A);return}const W=()=>{d(R),U&&!U.persisted&&U.afterLeave&&U.afterLeave()};if(A.shapeFlag&1&&U&&!U.persisted){const{leave:F,delayLeave:L}=U,B=()=>F(R,W);L?L(A.el,W,B):B()}else W()},w=(A,x)=>{let R;for(;A!==x;)R=k(A),d(A),A=R;d(x)},T=(A,x,R)=>{const{bum:P,scope:U,update:W,subTree:F,um:L}=A;P&&Ks(P),U.stop(),W&&(W.active=!1,m(F,A,x,R)),L&&Et(L,x),Et(()=>{A.isUnmounted=!0},x),x&&x.pendingBranch&&!x.isUnmounted&&A.asyncDep&&!A.asyncResolved&&A.suspenseId===x.pendingId&&(x.deps--,x.deps===0&&x.resolve())},S=(A,x,R,P=!1,U=!1,W=0)=>{for(let F=W;F<A.length;F++)m(A[F],x,R,P,U)},D=A=>A.shapeFlag&6?D(A.component.subTree):A.shapeFlag&128?A.suspense.next():k(A.anchor||A.el);let N=!1;const X=(A,x,R)=>{A==null?x._vnode&&m(x._vnode,null,null,!0):z(x._vnode||null,A,x,null,null,null,R),N||(N=!0,Na(),mh(),N=!1),x._vnode=A},K={p:z,um:m,m:f,r:y,mt:o,mc:v,pc:h,pbc:Ce,n:D,o:t};let ee,Q;return e&&([ee,Q]=e(K)),{render:X,hydrate:ee,createApp:zu(X,ee)}}function Js({type:t,props:e},r){return r==="svg"&&t==="foreignObject"||r==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:r}function Ui({effect:t,update:e},r){t.allowRecurse=e.allowRecurse=r}function id(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function Nh(t,e,r=!1){const a=t.children,d=e.children;if(Re(a)&&Re(d))for(let p=0;p<a.length;p++){const _=a[p];let E=d[p];E.shapeFlag&1&&!E.dynamicChildren&&((E.patchFlag<=0||E.patchFlag===32)&&(E=d[p]=Ii(d[p]),E.el=_.el),r||Nh(_,E)),E.type===Ws&&(E.el=_.el)}}function rd(t){const e=t.slice(),r=[0];let a,d,p,_,E;const C=t.length;for(a=0;a<C;a++){const b=t[a];if(b!==0){if(d=r[r.length-1],t[d]<b){e[a]=d,r.push(a);continue}for(p=0,_=r.length-1;p<_;)E=p+_>>1,t[r[E]]<b?p=E+1:_=E;b<t[r[p]]&&(p>0&&(e[a]=r[p-1]),r[p]=a)}}for(p=r.length,_=r[p-1];p-- >0;)r[p]=_,_=e[_];return r}function Bh(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Bh(e)}const nd=t=>t.__isTeleport,ai=Symbol.for("v-fgt"),Ws=Symbol.for("v-txt"),xn=Symbol.for("v-cmt"),Qs=Symbol.for("v-stc"),vn=[];let Gt=null;function yn(t=!1){vn.push(Gt=t?null:[])}function sd(){vn.pop(),Gt=vn[vn.length-1]||null}let An=1;function za(t){An+=t}function jh(t){return t.dynamicChildren=An>0?Gt||Ar:null,sd(),An>0&&Gt&&Gt.push(t),t}function ma(t,e,r,a,d,p){return jh(bt(t,e,r,a,d,p,!0))}function Ka(t,e,r,a,d){return jh(Di(t,e,r,a,d,!0))}function od(t){return t?t.__v_isVNode===!0:!1}function Nr(t,e){return t.type===e.type&&t.key===e.key}const Uh=({key:t})=>t??null,zn=({ref:t,ref_key:e,ref_for:r})=>(typeof t=="number"&&(t=""+t),t!=null?dt(t)||It(t)||Le(t)?{i:qt,r:t,k:e,f:!!r}:t:null);function bt(t,e=null,r=null,a=0,d=null,p=t===ai?0:1,_=!1,E=!1){const C={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Uh(e),ref:e&&zn(e),scopeId:Vs,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:p,patchFlag:a,dynamicProps:d,dynamicChildren:null,appContext:null,ctx:qt};return E?(_a(C,r),p&128&&t.normalize(C)):r&&(C.shapeFlag|=dt(r)?8:16),An>0&&!_&&Gt&&(C.patchFlag>0||p&6)&&C.patchFlag!==32&&Gt.push(C),C}const Di=ad;function ad(t,e=null,r=null,a=0,d=null,p=!1){if((!t||t===bu)&&(t=xn),od(t)){const E=Lr(t,e,!0);return r&&_a(E,r),An>0&&!p&&Gt&&(E.shapeFlag&6?Gt[Gt.indexOf(t)]=E:Gt.push(E)),E.patchFlag|=-2,E}if(_d(t)&&(t=t.__vccOpts),e){e=ld(e);let{class:E,style:C}=e;E&&!dt(E)&&(e.class=ta(E)),st(C)&&(hh(C)&&!Re(C)&&(C=at({},C)),e.style=wn(C))}const _=dt(t)?1:Tu(t)?128:nd(t)?64:st(t)?4:Le(t)?2:0;return bt(t,e,r,a,d,_,p,!0)}function ld(t){return t?hh(t)||Dh(t)?at({},t):t:null}function Lr(t,e,r=!1,a=!1){const{props:d,ref:p,patchFlag:_,children:E,transition:C}=t,b=e?hd(d||{},e):d,O={__v_isVNode:!0,__v_skip:!0,type:t.type,props:b,key:b&&Uh(b),ref:e&&e.ref?r&&p?Re(p)?p.concat(zn(e)):[p,zn(e)]:zn(e):p,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:E,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==ai?_===-1?16:_|16:_,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:C,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&Lr(t.ssContent),ssFallback:t.ssFallback&&Lr(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return C&&a&&(O.transition=C.clone(O)),O}function Vh(t=" ",e=0){return Di(Ws,null,t,e)}function Kt(t){return t==null||typeof t=="boolean"?Di(xn):Re(t)?Di(ai,null,t.slice()):typeof t=="object"?Ii(t):Di(Ws,null,String(t))}function Ii(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:Lr(t)}function _a(t,e){let r=0;const{shapeFlag:a}=t;if(e==null)e=null;else if(Re(e))r=16;else if(typeof e=="object")if(a&65){const d=e.default;d&&(d._c&&(d._d=!1),_a(t,d()),d._c&&(d._d=!0));return}else{r=32;const d=e._;!d&&!Dh(e)?e._ctx=qt:d===3&&qt&&(qt.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else Le(e)?(e={default:e,_ctx:qt},r=32):(e=String(e),a&64?(r=16,e=[Vh(e)]):r=8);t.children=e,t.shapeFlag|=r}function hd(...t){const e={};for(let r=0;r<t.length;r++){const a=t[r];for(const d in a)if(d==="class")e.class!==a.class&&(e.class=ta([e.class,a.class]));else if(d==="style")e.style=wn([e.style,a.style]);else if(Ps(d)){const p=e[d],_=a[d];_&&p!==_&&!(Re(p)&&p.includes(_))&&(e[d]=p?[].concat(p,_):_)}else d!==""&&(e[d]=a[d])}return e}function Ht(t,e,r,a=null){Wt(t,e,7,[r,a])}const cd=Ah();let ud=0;function dd(t,e,r){const a=t.type,d=(e?e.appContext:t.appContext)||cd,p={uid:ud++,vnode:t,type:a,parent:e,appContext:d,root:null,next:null,subTree:null,effect:null,update:null,scope:new Bc(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(d.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Mh(a,d),emitsOptions:vh(a,d),emit:null,emitted:null,propsDefaults:Je,inheritAttrs:a.inheritAttrs,ctx:Je,data:Je,props:Je,attrs:Je,slots:Je,refs:Je,setupState:Je,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:r,suspenseId:r?r.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return p.ctx={_:p},p.root=e?e.root:p,p.emit=vu.bind(null,p),t.ce&&t.ce(p),p}let vt=null,Ss,Oo;{const t=$l(),e=(r,a)=>{let d;return(d=t[r])||(d=t[r]=[]),d.push(a),p=>{d.length>1?d.forEach(_=>_(p)):d[0](p)}};Ss=e("__VUE_INSTANCE_SETTERS__",r=>vt=r),Oo=e("__VUE_SSR_SETTERS__",r=>Hs=r)}const Rn=t=>{const e=vt;return Ss(t),t.scope.on(),()=>{t.scope.off(),Ss(e)}},$a=()=>{vt&&vt.scope.off(),Ss(null)};function Gh(t){return t.vnode.shapeFlag&4}let Hs=!1;function fd(t,e=!1){e&&Oo(e);const{props:r,children:a}=t.vnode,d=Gh(t);$u(t,r,d,e),Ju(t,a);const p=d?gd(t,e):void 0;return e&&Oo(!1),p}function gd(t,e){const r=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,Uu);const{setup:a}=r;if(a){const d=t.setupContext=a.length>1?md(t):null,p=Rn(t);Pi();const _=Ri(a,t,0,[t.props,d]);if(ki(),p(),Xl(_)){if(_.then($a,$a),e)return _.then(E=>{Za(t,E,e)}).catch(E=>{js(E,t,0)});t.asyncDep=_}else Za(t,_,e)}else Wh(t,e)}function Za(t,e,r){Le(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:st(e)&&(t.setupState=fh(e)),Wh(t,r)}let qa;function Wh(t,e,r){const a=t.type;if(!t.render){if(!e&&qa&&!a.render){const d=a.template||ga(t).template;if(d){const{isCustomElement:p,compilerOptions:_}=t.appContext.config,{delimiters:E,compilerOptions:C}=a,b=at(at({isCustomElement:p,delimiters:E},_),C);a.render=qa(d,b)}}t.render=a.render||Mt}{const d=Rn(t);Pi();try{Vu(t)}finally{ki(),d()}}}const pd={get(t,e){return Tt(t,"get",""),t[e]}};function md(t){const e=r=>{t.exposed=r||{}};return{attrs:new Proxy(t.attrs,pd),slots:t.slots,emit:t.emit,expose:e}}function va(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy(fh(au(t.exposed)),{get(e,r){if(r in e)return e[r];if(r in mn)return mn[r](t)},has(e,r){return r in e||r in mn}}))}function _d(t){return Le(t)&&"__vccOpts"in t}const vd=(t,e)=>lu(t,e,Hs),yd="3.4.27";/**
* @vue/runtime-dom v3.4.27
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Ed="http://www.w3.org/2000/svg",Cd="http://www.w3.org/1998/Math/MathML",xi=typeof document<"u"?document:null,Ja=xi&&xi.createElement("template"),wd={insert:(t,e,r)=>{e.insertBefore(t,r||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,r,a)=>{const d=e==="svg"?xi.createElementNS(Ed,t):e==="mathml"?xi.createElementNS(Cd,t):xi.createElement(t,r?{is:r}:void 0);return t==="select"&&a&&a.multiple!=null&&d.setAttribute("multiple",a.multiple),d},createText:t=>xi.createTextNode(t),createComment:t=>xi.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>xi.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,r,a,d,p){const _=r?r.previousSibling:e.lastChild;if(d&&(d===p||d.nextSibling))for(;e.insertBefore(d.cloneNode(!0),r),!(d===p||!(d=d.nextSibling)););else{Ja.innerHTML=a==="svg"?`<svg>${t}</svg>`:a==="mathml"?`<math>${t}</math>`:t;const E=Ja.content;if(a==="svg"||a==="mathml"){const C=E.firstChild;for(;C.firstChild;)E.appendChild(C.firstChild);E.removeChild(C)}e.insertBefore(E,r)}return[_?_.nextSibling:e.firstChild,r?r.previousSibling:e.lastChild]}},Sd=Symbol("_vtc");function bd(t,e,r){const a=t[Sd];a&&(e=(e?[e,...a]:[...a]).join(" ")),e==null?t.removeAttribute("class"):r?t.setAttribute("class",e):t.className=e}const Qa=Symbol("_vod"),Td=Symbol("_vsh"),Id=Symbol(""),xd=/(^|;)\s*display\s*:/;function Ad(t,e,r){const a=t.style,d=dt(r);let p=!1;if(r&&!d){if(e)if(dt(e))for(const _ of e.split(";")){const E=_.slice(0,_.indexOf(":")).trim();r[E]==null&&Kn(a,E,"")}else for(const _ in e)r[_]==null&&Kn(a,_,"");for(const _ in r)_==="display"&&(p=!0),Kn(a,_,r[_])}else if(d){if(e!==r){const _=a[Id];_&&(r+=";"+_),a.cssText=r,p=xd.test(r)}}else e&&t.removeAttribute("style");Qa in t&&(t[Qa]=p?a.display:"",t[Td]&&(a.display="none"))}const el=/\s*!important$/;function Kn(t,e,r){if(Re(r))r.forEach(a=>Kn(t,e,a));else if(r==null&&(r=""),e.startsWith("--"))t.setProperty(e,r);else{const a=Od(t,e);el.test(r)?t.setProperty(Mr(a),r.replace(el,""),"important"):t[a]=r}}const tl=["Webkit","Moz","ms"],eo={};function Od(t,e){const r=eo[e];if(r)return r;let a=Dr(e);if(a!=="filter"&&a in t)return eo[e]=a;a=zl(a);for(let d=0;d<tl.length;d++){const p=tl[d]+a;if(p in t)return eo[e]=p}return e}const il="http://www.w3.org/1999/xlink";function Rd(t,e,r,a,d){if(a&&e.startsWith("xlink:"))r==null?t.removeAttributeNS(il,e.slice(6,e.length)):t.setAttributeNS(il,e,r);else{const p=Nc(e);r==null||p&&!Zl(r)?t.removeAttribute(e):t.setAttribute(e,p?"":r)}}function Dd(t,e,r,a,d,p,_){if(e==="innerHTML"||e==="textContent"){a&&_(a,d,p),t[e]=r??"";return}const E=t.tagName;if(e==="value"&&E!=="PROGRESS"&&!E.includes("-")){const b=E==="OPTION"?t.getAttribute("value")||"":t.value,O=r??"";(b!==O||!("_value"in t))&&(t.value=O),r==null&&t.removeAttribute(e),t._value=r;return}let C=!1;if(r===""||r==null){const b=typeof t[e];b==="boolean"?r=Zl(r):r==null&&b==="string"?(r="",C=!0):b==="number"&&(r=0,C=!0)}try{t[e]=r}catch{}C&&t.removeAttribute(e)}function Ld(t,e,r,a){t.addEventListener(e,r,a)}function Md(t,e,r,a){t.removeEventListener(e,r,a)}const rl=Symbol("_vei");function Fd(t,e,r,a,d=null){const p=t[rl]||(t[rl]={}),_=p[e];if(a&&_)_.value=a;else{const[E,C]=Pd(e);if(a){const b=p[e]=Bd(a,d);Ld(t,E,b,C)}else _&&(Md(t,E,_,C),p[e]=void 0)}}const nl=/(?:Once|Passive|Capture)$/;function Pd(t){let e;if(nl.test(t)){e={};let a;for(;a=t.match(nl);)t=t.slice(0,t.length-a[0].length),e[a[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):Mr(t.slice(2)),e]}let to=0;const kd=Promise.resolve(),Nd=()=>to||(kd.then(()=>to=0),to=Date.now());function Bd(t,e){const r=a=>{if(!a._vts)a._vts=Date.now();else if(a._vts<=r.attached)return;Wt(jd(a,r.value),e,5,[a])};return r.value=t,r.attached=Nd(),r}function jd(t,e){if(Re(e)){const r=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{r.call(t),t._stopped=!0},e.map(a=>d=>!d._stopped&&a&&a(d))}else return e}const sl=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,Ud=(t,e,r,a,d,p,_,E,C)=>{const b=d==="svg";e==="class"?bd(t,a,b):e==="style"?Ad(t,r,a):Ps(e)?Jo(e)||Fd(t,e,r,a,_):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Vd(t,e,a,b))?Dd(t,e,a,p,_,E,C):(e==="true-value"?t._trueValue=a:e==="false-value"&&(t._falseValue=a),Rd(t,e,a,b))};function Vd(t,e,r,a){if(a)return!!(e==="innerHTML"||e==="textContent"||e in t&&sl(e)&&Le(r));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const d=t.tagName;if(d==="IMG"||d==="VIDEO"||d==="CANVAS"||d==="SOURCE")return!1}return sl(e)&&dt(r)?!1:e in t}const Gd=at({patchProp:Ud},wd);let ol;function Wd(){return ol||(ol=ed(Gd))}const Hd=(...t)=>{const e=Wd().createApp(...t),{mount:r}=e;return e.mount=a=>{const d=Xd(a);if(!d)return;const p=e._component;!Le(p)&&!p.render&&!p.template&&(p.template=d.innerHTML),d.innerHTML="";const _=r(d,!1,Yd(d));return d instanceof Element&&(d.removeAttribute("v-cloak"),d.setAttribute("data-v-app","")),_},e};function Yd(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function Xd(t){return dt(t)?document.querySelector(t):t}const zd=""+new URL("logo-da9b9095.svg",import.meta.url).href;/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Core JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.2.10
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info on Dynamsoft Core JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/core/core-module.html
 */function De(t,e,r,a){if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?a:r==="a"?a.call(t):a?a.value:e.get(t)}function Vi(t,e,r,a,d){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!d)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!d:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?d.call(t,r):d?d.value=r:e.set(t,r),r}var ir,Jt,we;typeof SuppressedError=="function"&&SuppressedError,function(t){t[t.BOPM_BLOCK=0]="BOPM_BLOCK",t[t.BOPM_UPDATE=1]="BOPM_UPDATE"}(ir||(ir={})),function(t){t[t.CCUT_AUTO=0]="CCUT_AUTO",t[t.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",t[t.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",t[t.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",t[t.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",t[t.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(Jt||(Jt={})),function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",t[t.IPF_BINARY_8=13]="IPF_BINARY_8",t[t.IPF_NV12=14]="IPF_NV12",t[t.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(we||(we={}));const Hh=t=>Object.prototype.toString.call(t),Yh=t=>Array.isArray?Array.isArray(t):Hh(t)==="[object Array]",ya=t=>Hh(t)==="[object Boolean]",ut=t=>typeof t=="number"&&!Number.isNaN(t),Ni=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),Xh=t=>!!Ni(t)&&t.bytes instanceof Uint8Array&&!!ut(t.width)&&!(t.width<=0)&&!!ut(t.height)&&!(t.height<=0)&&!!ut(t.stride)&&!(t.stride<=0)&&"format"in t&&!("tag"in t&&!$d(t.tag)),Kd=t=>!!Ni(t)&&!!ut(t.left)&&!(t.left<0)&&!!ut(t.top)&&!(t.top<0)&&!!ut(t.right)&&!(t.right<0)&&!!ut(t.bottom)&&!(t.bottom<0)&&!(t.left>=t.right)&&!(t.top>=t.bottom)&&!!ya(t.isMeasuredInPercentage),$d=t=>!!Ni(t)&&!!ut(t.imageId)&&"type"in t,Ea=t=>!!Ni(t)&&!!ut(t.x)&&!!ut(t.y),Zd=t=>!!Ni(t)&&!!Yh(t.points)&&t.points.length!=0&&!t.points.some(e=>!Ea(e)),qd=t=>!!Ni(t)&&!!Yh(t.points)&&t.points.length!=0&&t.points.length==4&&!t.points.some(e=>!Ea(e)),Jd=t=>!!Ni(t)&&!!ut(t.x)&&!!ut(t.y)&&!!ut(t.width)&&!(t.width<0)&&!!ut(t.height)&&!(t.height<0)&&!("isMeasuredInPercentage"in t&&!ya(t.isMeasuredInPercentage));async function al(t,e){return await new Promise((r,a)=>{let d=new XMLHttpRequest;d.open("GET",t,!0),d.responseType=e,d.send(),d.onloadend=async()=>{r(d.response)},d.onerror=()=>{a(new Error("Network Error: "+d.statusText))}})}const Dn=(t,e)=>{let r=t.split("."),a=e.split(".");for(let d=0;d<r.length&&d<a.length;++d){let p=r[d],_=a[d];if(p===_)continue;let E=parseInt(r[d]),C=parseInt(a[d]);return E===C||Number.isNaN(E)&&Number.isNaN(C)?p<_?-1:1:E<C||Number.isNaN(E)&&Number.isInteger(C)?-1:1}return r.length===a.length?0:r.length<a.length?-1:1},Qd=typeof BigInt=="function";var $n,rt,Gi,Yr,Xr,Pt,Wi,Ro;let Do=class ti{get _isFetchingStarted(){return De(this,Xr,"f")}constructor(){$n.add(this),rt.set(this,[]),Gi.set(this,1),Yr.set(this,ir.BOPM_BLOCK),Xr.set(this,!1),Pt.set(this,void 0),Wi.set(this,Jt.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var r;if(!Xh(e))throw new TypeError("Invalid 'image'.");if(!((r=e.tag)===null||r===void 0)&&r.hasOwnProperty("imageId")&&typeof e.tag.imageId=="number"&&this.hasImage(e.tag.imageId))throw new Error("Existed imageId.");if(De(this,rt,"f").length>=De(this,Gi,"f"))switch(De(this,Yr,"f")){case ir.BOPM_BLOCK:break;case ir.BOPM_UPDATE:if(De(this,rt,"f").push(e),Ni(De(this,Pt,"f"))&&ut(De(this,Pt,"f").imageId)&&De(this,Pt,"f").keepInBuffer==1)for(;De(this,rt,"f").length>De(this,Gi,"f");){const a=De(this,rt,"f").findIndex(d=>{var p;return((p=d.tag)===null||p===void 0?void 0:p.imageId)!==De(this,Pt,"f").imageId});De(this,rt,"f").splice(a,1)}else De(this,rt,"f").splice(0,De(this,rt,"f").length-De(this,Gi,"f"))}else De(this,rt,"f").push(e)}getImage(){if(De(this,rt,"f").length===0)return null;let e;if(De(this,Pt,"f")&&ut(De(this,Pt,"f").imageId)){const r=De(this,$n,"m",Ro).call(this,De(this,Pt,"f").imageId);if(r<0)throw new Error(`Image with id ${De(this,Pt,"f").imageId} doesn't exist.`);e=De(this,rt,"f").slice(r,r+1)[0]}else e=De(this,rt,"f").pop();if([we.IPF_RGB_565,we.IPF_RGB_555,we.IPF_RGB_888,we.IPF_ARGB_8888,we.IPF_RGB_161616,we.IPF_ARGB_16161616,we.IPF_ABGR_8888,we.IPF_ABGR_16161616,we.IPF_BGR_888].includes(e.format)){if(De(this,Wi,"f")===Jt.CCUT_RGB_R_CHANNEL_ONLY){ti._onLog&&ti._onLog("only get R channel data.");const r=new Uint8Array(e.width*e.height);for(let a=0;a<r.length;a++)switch(e.format){case we.IPF_RGB_565:case we.IPF_RGB_555:case we.IPF_RGB_888:case we.IPF_RGB_161616:r[a]=e.bytes[3*a+2];break;case we.IPF_ARGB_8888:case we.IPF_ARGB_16161616:r[a]=e.bytes[4*a+2];break;case we.IPF_BGR_888:r[a]=e.bytes[3*a];break;case we.IPF_ABGR_8888:case we.IPF_ABGR_16161616:r[a]=e.bytes[4*a]}e.bytes=r,e.stride=e.width,e.format=we.IPF_GRAYSCALED}else if(De(this,Wi,"f")===Jt.CCUT_RGB_G_CHANNEL_ONLY){ti._onLog&&ti._onLog("only get G channel data.");const r=new Uint8Array(e.width*e.height);for(let a=0;a<r.length;a++)switch(e.format){case we.IPF_RGB_565:case we.IPF_RGB_555:case we.IPF_RGB_888:case we.IPF_RGB_161616:case we.IPF_BGR_888:r[a]=e.bytes[3*a+1];break;case we.IPF_ARGB_8888:case we.IPF_ARGB_16161616:case we.IPF_ABGR_8888:case we.IPF_ABGR_16161616:r[a]=e.bytes[4*a+1]}e.bytes=r,e.stride=e.width,e.format=we.IPF_GRAYSCALED}else if(De(this,Wi,"f")===Jt.CCUT_RGB_B_CHANNEL_ONLY){ti._onLog&&ti._onLog("only get B channel data.");const r=new Uint8Array(e.width*e.height);for(let a=0;a<r.length;a++)switch(e.format){case we.IPF_RGB_565:case we.IPF_RGB_555:case we.IPF_RGB_888:case we.IPF_RGB_161616:r[a]=e.bytes[3*a];break;case we.IPF_ARGB_8888:case we.IPF_ARGB_16161616:r[a]=e.bytes[4*a];break;case we.IPF_BGR_888:r[a]=e.bytes[3*a+2];break;case we.IPF_ABGR_8888:case we.IPF_ABGR_16161616:r[a]=e.bytes[4*a+2]}e.bytes=r,e.stride=e.width,e.format=we.IPF_GRAYSCALED}}else[we.IPF_NV21,we.IPF_NV12].includes(e.format)&&ti._onLog&&ti._onLog("NV21 or NV12 is not supported.");return e}setNextImageToReturn(e,r){if(!((...a)=>a.length!==0&&a.every(d=>ut(d)))(e))throw new TypeError("Invalid 'imageId'.");if(r!==void 0&&!ya(r))throw new TypeError("Invalid 'keepInBuffer'.");Vi(this,Pt,{imageId:e,keepInBuffer:r},"f")}_resetNextReturnedImage(){Vi(this,Pt,null,"f")}hasImage(e){return De(this,$n,"m",Ro).call(this,e)>=0}startFetching(){Vi(this,Xr,!0,"f")}stopFetching(){Vi(this,Xr,!1,"f")}setMaxImageCount(e){if(typeof e!="number")throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(Vi(this,Gi,e,"f");De(this,rt,"f")&&De(this,rt,"f").length>e;)De(this,rt,"f").shift()}getMaxImageCount(){return De(this,Gi,"f")}getImageCount(){return De(this,rt,"f").length}clearBuffer(){De(this,rt,"f").length=0}isBufferEmpty(){return De(this,rt,"f").length===0}setBufferOverflowProtectionMode(e){Vi(this,Yr,e,"f")}getBufferOverflowProtectionMode(){return De(this,Yr,"f")}setColourChannelUsageType(e){Vi(this,Wi,e,"f")}getColourChannelUsageType(){return De(this,Wi,"f")}};rt=new WeakMap,Gi=new WeakMap,Yr=new WeakMap,Xr=new WeakMap,Pt=new WeakMap,Wi=new WeakMap,$n=new WeakSet,Ro=function(t){if(typeof t!="number")throw new TypeError("Invalid 'imageId'.");return De(this,rt,"f").findIndex(e=>{var r;return((r=e.tag)===null||r===void 0?void 0:r.imageId)===t})};const bs=typeof self>"u",ll=(()=>{if(!bs&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),zh=t=>{if(t==null&&(t="./"),!bs){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};let Br,ui,jn,Ts,wt;typeof navigator<"u"&&(Br=navigator,ui=Br.userAgent,jn=Br.platform,Ts=Br.mediaDevices),function(){if(!bs){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Br.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:jn,search:"Win"},Mac:{str:jn},Linux:{str:jn}};let r="unknownBrowser",a=0,d="unknownOS";for(let p in t){const _=t[p]||{};let E=_.str||ui,C=_.search||p,b=_.verStr||ui,O=_.verSearch||p;if(O instanceof Array||(O=[O]),E.indexOf(C)!=-1){r=p;for(let M of O){let k=b.indexOf(M);if(k!=-1){a=parseFloat(b.substring(k+M.length+1));break}}break}}for(let p in e){const _=e[p]||{};let E=_.str||ui,C=_.search||p;if(E.indexOf(C)!=-1){d=p;break}}d=="Linux"&&ui.indexOf("Windows NT")!=-1&&(d="HarmonyOS"),wt={browser:r,version:a,OS:d}}bs&&(wt={browser:"ssr",version:0,OS:"ssr"})}();const ef=typeof WebAssembly<"u"&&ui&&!(/Safari/.test(ui)&&!/Chrome/.test(ui)&&/\(.+\s11_2_([2-6]).*\)/.test(ui)),tf=!(typeof Worker>"u"),Kh=!(!Ts||!Ts.getUserMedia),rf=async()=>{let t=!1;if(Kh)try{(await Ts.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};wt.browser==="Chrome"&&wt.version>66||wt.browser==="Safari"&&wt.version>13||wt.browser==="OPR"&&wt.version>43||wt.browser==="Edge"&&wt.version;const hl=t=>t&&typeof t=="object"&&typeof t.then=="function";let Ca=class extends Promise{constructor(e){let r,a;super((d,p)=>{r=d,a=p}),this._s="pending",this.resolve=d=>{this.isPending&&(hl(d)?this.task=d:(this._s="fulfilled",r(d)))},this.reject=d=>{this.isPending&&(this._s="rejected",a(d))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let r;this._task=e,hl(e)?r=e:typeof e=="function"&&(r=new Promise(e)),r&&(async()=>{try{const a=await r;e===this._task&&this.resolve(a)}catch(a){e===this._task&&this.reject(a)}})()}get isEmpty(){return this._task==null}};const Qt={},$h=async t=>{let e=typeof t=="string"?[t]:t,r=[];for(let a of e)r.push(Qt[a]=Qt[a]||new Ca);await Promise.all(r)},Is=async(t,e)=>{let r,a=typeof t=="string"?[t]:t,d=[];for(let p of a){let _;d.push(_=Qt[p]=Qt[p]||new Ca(r=r||e())),_.isEmpty&&(_.task=r=r||e())}await Promise.all(d)};let je,Zh=0;const $e=()=>Zh++,Ge={};let Li;const nf=t=>{Li=t,je&&je.postMessage({type:"setBLog",body:{value:!!t}})};let wa=!1;const sf=t=>{wa=t,je&&je.postMessage({type:"setBDebug",body:{value:!!t}})},qi={},yt={},We={std:{version:"1.2.0",path:zh(ll+"../../dynamsoft-capture-vision-std@1.2.0/dist/")},core:{version:"3.2.10",path:ll}},zr=new Proxy(We,{get(t,e,r){let a=Reflect.get(t,e,r);return a&&a.path&&(a=a.path),a}}),rr={dip:{wasm:!0}},zt=async t=>{let e;t instanceof Array||(t=t?[t]:[]);{let d=Qt.core;e=!d||d.isEmpty}let r=new Map;for(let d of t){if(d=d.toLowerCase(),d=="std"||d=="core")continue;if(!rr[d])throw Error("Module '"+d+"' not existed.");let p=rr[d].deps;if(p!=null&&p.length)for(let E of p){let C=Qt[E];r.has(E)||r.set(E,!C||C.isEmpty)}let _=Qt[d];r.has(d)||r.set(d,!_||_.isEmpty)}let a=[];e&&a.push("core"),a.push(...r.keys()),await Is(a,async()=>{const d=[...r.entries()].filter(O=>O[1]).map(O=>O[0]),p={};for(let O in zr){if(O=="rootDirectory")continue;let M=zr[O];zr.rootDirectory&&(M.startsWith("http://")||M.startsWith("https://")||(M=zr.rootDirectory+"/"+M)),p[O]=zh(M)}const _={};for(let O of d)_[O]=rr[O];const E={engineResourcePaths:p,autoResources:_,names:d};let C=new Ca;if(e){E.needLoadCore=!0;let O=p.core+tt._workerName;p.rootDirectory&&(O=p.rootDirectory+O),O.startsWith(location.origin)||(O=await fetch(O).then(M=>M.blob()).then(M=>URL.createObjectURL(M))),je=new Worker(O),je.onerror=M=>{let k=new Error(M.message);C.reject(k)},je.addEventListener("message",M=>{let k=M.data?M.data:M,V=k.type,H=k.id,z=k.body;switch(V){case"log":Li&&Li(k.message);break;case"task":try{Ge[H](z),delete Ge[H]}catch(Z){throw delete Ge[H],Z}break;case"event":try{Ge[H](z)}catch(Z){throw Z}break;default:console.log(M)}}),E.bLog=!!Li,E.bd=wa,E.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else await $h("worker");let b=Zh++;Ge[b]=O=>{if(O.success)Object.assign(qi,O.versions),JSON.stringify(O.versions)!=="{}"&&(tt._versions=O.versions),C.resolve(void 0);else{const M=Error(O.message);O.stack&&(M.stack=O.stack),C.reject(M)}},je.postMessage({type:"loadWasm",body:E,id:b}),e&&Is("worker",()=>Promise.resolve()),await C})};class tt{static get engineResourcePaths(){return zr}static set engineResourcePaths(e){Object.assign(We,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return Li}static set _onLog(e){nf(e)}static get _bDebug(){return wa}static set _bDebug(e){sf(e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!Qt[e]&&Qt[e].isFulfilled}static async loadWasm(e){return await zt(e)}static async detectEnvironment(){return await(async()=>({wasm:ef,worker:tf,getUserMedia:Kh,camera:await rf(),browser:wt.browser,version:wt.version,OS:wt.OS}))()}static async getModuleVersion(){return await new Promise((e,r)=>{let a=$e();Ge[a]=async d=>{if(d.success)return e(d.versions);{let p=new Error(d.message);return p.stack=d.stack+`
`+p.stack,r(p)}},je.postMessage({type:"getModuleVersion",id:a})})}static getVersion(){const e=qi.core&&qi.core.worker,r=qi.core&&qi.core.wasm;return`3.2.10(Worker: ${e||"Not Loaded"}, Wasm: ${r||"Not Loaded"})`}static enableLogging(){Do._onLog=console.log,tt._onLog=console.log}static disableLogging(){Do._onLog=null,tt._onLog=null}static async cfd(e){return await new Promise((r,a)=>{let d=$e();Ge[d]=async p=>{if(p.success)return r();{let _=new Error(p.message);return _.stack=p.stack+`
`+_.stack,a(_)}},je.postMessage({type:"cfd",id:d,body:{count:e}})})}}var Se,cl,Lo,ul,dl,xs,fl,gl,br,pl,ml;tt._bSupportDce4Module=-1,tt._bSupportIRTModule=-1,tt._versions=null,tt._workerName="core.worker.js",tt.browserInfo=wt,function(t){t[t.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",t[t.CRIT_BARCODE=2]="CRIT_BARCODE",t[t.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",t[t.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",t[t.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",t[t.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(Se||(Se={})),function(t){t[t.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",t[t.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",t[t.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",t[t.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(cl||(cl={})),function(t){t[t.EC_OK=0]="EC_OK",t[t.EC_UNKNOWN=-1e4]="EC_UNKNOWN",t[t.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",t[t.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",t[t.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",t[t.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",t[t.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",t[t.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",t[t.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",t[t.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",t[t.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",t[t.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",t[t.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",t[t.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",t[t.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",t[t.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",t[t.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",t[t.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",t[t.EC_TIMEOUT=-10026]="EC_TIMEOUT",t[t.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",t[t.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",t[t.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",t[t.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",t[t.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",t[t.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",t[t.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",t[t.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",t[t.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",t[t.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",t[t.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",t[t.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",t[t.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",t[t.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",t[t.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",t[t.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",t[t.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",t[t.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",t[t.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",t[t.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",t[t.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",t[t.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",t[t.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",t[t.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",t[t.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",t[t.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",t[t.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",t[t.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",t[t.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",t[t.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",t[t.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",t[t.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",t[t.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",t[t.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",t[t.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",t[t.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",t[t.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",t[t.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",t[t.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",t[t.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",t[t.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",t[t.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",t[t.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",t[t.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",t[t.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",t[t.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",t[t.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",t[t.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",t[t.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",t[t.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",t[t.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",t[t.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",t[t.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",t[t.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",t[t.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",t[t.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",t[t.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",t[t.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",t[t.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",t[t.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",t[t.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",t[t.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",t[t.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",t[t.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",t[t.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",t[t.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",t[t.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",t[t.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",t[t.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",t[t.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",t[t.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",t[t.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",t[t.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",t[t.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",t[t.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",t[t.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",t[t.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",t[t.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",t[t.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",t[t.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",t[t.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(Lo||(Lo={})),function(t){t[t.GEM_SKIP=0]="GEM_SKIP",t[t.GEM_AUTO=1]="GEM_AUTO",t[t.GEM_GENERAL=2]="GEM_GENERAL",t[t.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",t[t.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",t[t.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",t[t.GEM_REV=-2147483648]="GEM_REV"}(ul||(ul={})),function(t){t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_AUTO=4]="GTM_AUTO",t[t.GTM_REV=-2147483648]="GTM_REV"}(dl||(dl={})),function(t){t[t.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",t[t.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(xs||(xs={})),function(t){t[t.PDFRM_VECTOR=1]="PDFRM_VECTOR",t[t.PDFRM_RASTER=2]="PDFRM_RASTER",t[t.PDFRM_REV=-2147483648]="PDFRM_REV"}(fl||(fl={})),function(t){t[t.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",t[t.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(gl||(gl={})),function(t){t[t.IRUT_NULL=0]="IRUT_NULL",t[t.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",t[t.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",t[t.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",t[t.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",t[t.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",t[t.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",t[t.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",t[t.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",t[t.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",t[t.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",t[t.IRUT_CONTOURS=1024]="IRUT_CONTOURS",t[t.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",t[t.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",t[t.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",t[t.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",t[t.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",t[t.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",t[t.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",t[t.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",t[t.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",t[t.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",t[t.IRUT_CORNERS=2097152]="IRUT_CORNERS",t[t.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",t[t.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",t[t.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",t[t.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",t[t.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",t[t.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",t[t.IRUT_ALL=268435455]="IRUT_ALL"}(br||(br={})),function(t){t[t.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",t[t.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",t[t.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",t[t.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",t[t.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",t[t.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",t[t.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",t[t.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",t[t.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(pl||(pl={})),function(t){t[t.ST_NULL=0]="ST_NULL",t[t.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",t[t.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",t[t.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",t[t.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",t[t.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",t[t.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",t[t.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(ml||(ml={}));/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft License JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 3.2.10
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info DL JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/license/license-module.html
 */const Fi=typeof self>"u",_l=Fi?{}:self,qh=(()=>{if(!Fi&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Jh=t=>{if(t==null&&(t="./"),!Fi){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},vl=t=>t&&typeof t=="object"&&typeof t.then=="function";class Sa extends Promise{constructor(e){let r,a;super((d,p)=>{r=d,a=p}),this._s="pending",this.resolve=d=>{this.isPending&&(vl(d)?this.task=d:(this._s="fulfilled",r(d)))},this.reject=d=>{this.isPending&&(this._s="rejected",a(d))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let r;this._task=e,vl(e)?r=e:typeof e=="function"&&(r=new Promise(e)),r&&(async()=>{try{const a=await r;e===this._task&&this.resolve(a)}catch(a){e===this._task&&this.reject(a)}})()}get isEmpty(){return this._task==null}}const Ys=" is not allowed to change after `createInstance` or `loadWasm` is called.",of=!Fi&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",yl=(t,e)=>{const r=t;if(!r._pLoad.isEmpty)throw new Error("`license`"+Ys);r._license=e};!Fi&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");const Qh=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!Fi){let r=document.createElement("a");r.href=t[e],t[e]=r.href}t[e].endsWith("/")||(t[e]+="/")}}return t},El=(t,e)=>{const r=t;if(!r._pLoad.isEmpty)throw new Error("`licenseServer`"+Ys);r._licenseServer=Qh(e)},Cl=(t,e)=>{const r=t;if(!r._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+Ys);r._deviceFriendlyName=e||""};let jr,Ur,Un,io,jt;typeof navigator<"u"&&(jr=navigator,Ur=jr.userAgent,Un=jr.platform,io=jr.mediaDevices),function(){if(!Fi){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:jr.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Un,search:"Win"},Mac:{str:Un},Linux:{str:Un}};let r="unknownBrowser",a=0,d="unknownOS";for(let p in t){const _=t[p]||{};let E=_.str||Ur,C=_.search||p,b=_.verStr||Ur,O=_.verSearch||p;if(O instanceof Array||(O=[O]),E.indexOf(C)!=-1){r=p;for(let M of O){let k=b.indexOf(M);if(k!=-1){a=parseFloat(b.substring(k+M.length+1));break}}break}}for(let p in e){const _=e[p]||{};let E=_.str||Ur,C=_.search||p;if(E.indexOf(C)!=-1){d=p;break}}d=="Linux"&&Ur.indexOf("Windows NT")!=-1&&(d="HarmonyOS"),jt={browser:r,version:a,OS:d}}Fi&&(jt={browser:"ssr",version:0,OS:"ssr"})}(),io&&io.getUserMedia,jt.browser==="Chrome"&&jt.version>66||jt.browser==="Safari"&&jt.version>13||jt.browser==="OPR"&&jt.version>43||jt.browser==="Edge"&&jt.version;const ec=async()=>(zt("license"),Is("dynamsoft_inited",async()=>{let{lt:t,l:e,ls:r,sp:a,rmk:d,cv:p}=((C,b=!1)=>{const O=C;if(O._pLoad.isEmpty){let M,k,V,H=O._license||"",z=JSON.parse(JSON.stringify(O._licenseServer)),Z=O._sessionPassword,$=0;if(H.startsWith("t")||H.startsWith("f"))$=0;else if(H.length===0||H.startsWith("P")||H.startsWith("L")||H.startsWith("Y")||H.startsWith("A"))$=1;else{$=2;const J=H.indexOf(":");J!=-1&&(H=H.substring(J+1));const te=H.indexOf("?");if(te!=-1&&(k=H.substring(te+1),H=H.substring(0,te)),H.startsWith("DLC2"))$=0;else{if(H.startsWith("DLS2")){let he;try{let ce=H.substring(4);ce=atob(ce),he=JSON.parse(ce)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(H=he.handshakeCode?he.handshakeCode:he.organizationID?he.organizationID:"",typeof H=="number"&&(H=JSON.stringify(H)),z.length===0){let ce=[];he.mainServerURL&&(ce[0]=he.mainServerURL),he.standbyServerURL&&(ce[1]=he.standbyServerURL),z=Qh(ce)}!Z&&he.sessionPassword&&(Z=he.sessionPassword),M=he.remark}H&&H!=="200001"&&!H.startsWith("200001-")||($=1)}}if($&&(b||(_l.crypto||(V="Please upgrade your browser to support online key."),_l.crypto.subtle||(V="Require https to use online key in this browser."))),V){if($!==1)throw new Error(V);$=0,console.warn(V),O._lastErrorCode=-1,O._lastErrorString=V}return $===1&&(H="",console.warn("Applying for a public trial license ...")),{lt:$,l:H,ls:z,sp:Z,rmk:M,cv:k}}throw new Error("Can't preprocess license again"+Ys)})(ot),_=new Sa;ot._pLoad.task=_,(async()=>{try{await ot._pLoad}catch{}})();let E=$e();Ge[E]=C=>{if(C.message&&ot._onAuthMessage){let M=ot._onAuthMessage(C.message);M!=null&&(C.message=M)}let b,O=!1;if(t===1&&(O=!0),C.success?(Li&&Li("init license success"),C.message&&console.warn(C.message),tt._bSupportIRTModule=C.bSupportIRTModule,tt._bSupportDce4Module=C.bSupportDce4Module,ot.bPassValidation=!0):(b=Error(C.message),C.stack&&(b.stack=C.stack),C.ltsErrorCode&&(b.ltsErrorCode=C.ltsErrorCode),O||C.ltsErrorCode==111&&C.message.toLowerCase().indexOf("trial license")!=-1&&(O=!0)),O){let M=We.license;We.rootDirectory&&(M=We.rootDirectory+"/"+M),M=Jh(M),(async(k,V,H)=>{if(!k._bNeverShowDialog)try{let z=await fetch(k.engineResourcePath+"dls.license.dialog.html");if(!z.ok)throw Error("Get license dialog fail. Network Error: "+z.statusText);let Z=await z.text();if(!Z.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let $=document.createElement("div");$.innerHTML=Z;let J=[];for(let fe=0;fe<$.childElementCount;++fe){let l=$.children[fe];l instanceof HTMLStyleElement&&(J.push(l),document.head.append(l))}let te=$.childElementCount==1?$.children[0]:$;te.remove();let he,ce,ue,be,v,pe=[te],Ce=te.children;for(let fe of Ce)pe.push(fe);for(let fe=0;fe<pe.length;++fe)for(let l of pe[fe].children)pe.push(l);for(let fe of pe)if(!he&&fe.classList.contains("dls-license-mask"))he=fe,fe.addEventListener("click",l=>{if(fe==l.target){te.remove();for(let s of J)s.remove()}});else if(!ce&&fe.classList.contains("dls-license-icon-close"))ce=fe,fe.addEventListener("click",()=>{te.remove();for(let l of J)l.remove()});else if(!ue&&fe.classList.contains("dls-license-icon-error"))ue=fe,V!="error"&&fe.remove();else if(!be&&fe.classList.contains("dls-license-icon-warn"))be=fe,V!="warn"&&fe.remove();else if(!v&&fe.classList.contains("dls-license-msg-content")){v=fe;let l=H;for(;l;){let s=l.indexOf("["),o=l.indexOf("]",s),c=l.indexOf("(",o),i=l.indexOf(")",c);if(s==-1||o==-1||c==-1||i==-1){fe.appendChild(new Text(l));break}s>0&&fe.appendChild(new Text(l.substring(0,s)));let n=document.createElement("a"),h=l.substring(s+1,o);n.innerText=h;let g=l.substring(c+1,i);n.setAttribute("href",g),n.setAttribute("target","_blank"),fe.appendChild(n),l=l.substring(i+1)}}document.body.appendChild(te)}catch(z){k._onLog&&k._onLog(z.message||z)}})({_bNeverShowDialog:ot._bNeverShowDialog,engineResourcePath:M,_onLog:Li},C.success?"warn":"error",C.message)}C.success?_.resolve(void 0):_.reject(b)},await $h("worker"),je.postMessage({type:"dynamsoft",body:{v:"3.2.10",brtk:!!t,bptk:t===1,l:e,os:jt,fn:ot.deviceFriendlyName,ls:r,sp:a,rmk:d,cv:p},id:E}),ot.bCallInitLicense=!0,await _}));let wl;yt.license={},yt.license.dynamsoft=ec,yt.license.getAR=async()=>{{let t=Qt.dynamsoft_inited;t&&t.isRejected&&await t}return je?new Promise((t,e)=>{let r=$e();Ge[r]=async a=>{if(a.success){delete a.success;{let d=ot.license;d&&(d.startsWith("t")||d.startsWith("f"))&&(a.pk=d)}if(Object.keys(a).length){if(a.lem){let d=Error(a.lem);d.ltsErrorCode=a.lec,delete a.lem,delete a.lec,a.ae=d}t(a)}else t(null)}else{let d=Error(a.message);a.stack&&(d.stack=a.stack),e(d)}},je.postMessage({type:"getAR",id:r})}):null};let ot=class ii{static setLicenseServer(e){El(ii,e)}static get license(){return this._license}static set license(e){yl(ii,e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){El(ii,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){Cl(ii,e)}static initLicense(e,r){if(yl(ii,e),ii.bCallInitLicense=!0,r)return ec()}static setDeviceFriendlyName(e){Cl(ii,e)}static getDeviceFriendlyName(){return ii._deviceFriendlyName}static getDeviceUUID(){return(async()=>(await Is("dynamsoft_uuid",async()=>{await zt();let e=new Sa,r=$e();Ge[r]=a=>{if(a.success)e.resolve(a.uuid);else{const d=Error(a.message);a.stack&&(d.stack=a.stack),e.reject(d)}},je.postMessage({type:"getDeviceUUID",id:r}),wl=await e}),wl))()}};ot._pLoad=new Sa,ot.bPassValidation=!1,ot.bCallInitLicense=!1,ot._license=of,ot._licenseServer=[],ot._deviceFriendlyName="",We.license==null&&(We.license=qh),rr.license={wasm:!0},yt.license.LicenseManager=ot;const ro="1.2.0";typeof We.std!="string"&&Dn(We.std.version,ro)<0&&(We.std={version:ro,path:Jh(qh+`../../dynamsoft-capture-vision-std@${ro}/dist/`)});/*!
* Dynamsoft JavaScript Library
* @product Dynamsoft Barcode Reader JS Edition
* @website http://www.dynamsoft.com
* @copyright Copyright 2024, Dynamsoft Corporation
* @author Dynamsoft
* @version 10.2.10
* @fileoverview Dynamsoft JavaScript Library for Barcode Reader
* More info on dbr JS: https://www.dynamsoft.com/barcode-reader/docs/web/programming/javascript/
*/const tc=typeof self>"u",ba=(()=>{if(!tc&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),ic=t=>{if(t==null&&(t="./"),!tc){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};We.dbr==null&&(We.dbr=ba),rr.dbr={js:!1,wasm:!0,deps:["license","dip"]},yt.dbr={};const no="1.2.0";typeof We.std!="string"&&Dn(We.std.version,no)<0&&(We.std={version:no,path:ic(ba+`../../dynamsoft-capture-vision-std@${no}/dist/`)});const so="2.2.10";(!We.dip||typeof We.dip!="string"&&Dn(We.dip.version,so)<0)&&(We.dip={version:so,path:ic(ba+`../../dynamsoft-image-processing@${so}/dist/`)});typeof BigInt=="function"&&(BigInt(0),BigInt(18446744073709552e3),BigInt(4265345023),BigInt(3147775),BigInt(260096),BigInt(1),BigInt(2),BigInt(4),BigInt(8),BigInt(16),BigInt(32),BigInt(64),BigInt(128),BigInt(256),BigInt(512),BigInt(1024),BigInt(2048),BigInt(4096),BigInt(8192),BigInt(16384),BigInt(32768),BigInt(65536),BigInt(131072),BigInt(262144),BigInt(16777216),BigInt(33554432),BigInt(67108864),BigInt(134217728),BigInt(268435456),BigInt(536870912),BigInt(1073741824),BigInt(524288),BigInt(2147483648),BigInt(1048576),BigInt(2097152),BigInt(4194304),BigInt(8388608),BigInt(68719476736),BigInt(0x3f0000000000000),BigInt(4294967296),BigInt(4503599627370496),BigInt(9007199254740992),BigInt(0x40000000000000),BigInt(0x80000000000000),BigInt(72057594037927940),BigInt(0x200000000000000),BigInt(8589934592),BigInt(17179869184),BigInt(34359738368),BigInt(51539607552));var Sl,bl,Tl,Il;(function(t){t[t.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",t[t.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",t[t.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"})(Sl||(Sl={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(bl||(bl={})),function(t){t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=-2147483648]="LM_REV",t[t.LM_SKIP=0]="LM_SKIP"}(Tl||(Tl={})),function(t){t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",t[t.DM_REV=-2147483648]="DM_REV",t[t.DM_SKIP=0]="DM_SKIP"}(Il||(Il={}));ot.initLicense("DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAwLWRicl9qc19zYW1wbGVzIiwib3JnYW5pemF0aW9uSUQiOiIyMDAwMDAifQ==");tt.engineResourcePaths={std:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-std@1.2.10/dist/",dip:"https://cdn.jsdelivr.net/npm/dynamsoft-image-processing@2.2.30/dist/",core:"https://cdn.jsdelivr.net/npm/dynamsoft-core@3.2.30/dist/",license:"https://cdn.jsdelivr.net/npm/dynamsoft-license@3.2.21/dist/",cvr:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-router@2.2.30/dist/",dbr:"https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader@10.2.10/dist/",dce:"https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@4.0.3/dist/"};tt.loadWasm(["DBR"]);/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Camera Enhancer JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 4.0.3
 * @fileoverview Dynamsoft JavaScript Library for Camera Enhancer
 * More info on DCE JS: https://www.dynamsoft.com/camera-enhancer/docs/programming/javascript/?ver=latest
 */const Mo=typeof self>"u",af=(()=>{if(!Mo&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();We.dce==null&&(We.dce=af),rr.dce={wasm:!1,js:!1},yt.dce={};function I(t,e,r,a){if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?a:r==="a"?a.call(t):a?a.value:e.get(t)}function Ee(t,e,r,a,d){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!d)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!d:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?d.call(t,r):d?d.value=r:e.set(t,r),r}let Vr,di,Vn,As,ht;typeof SuppressedError=="function"&&SuppressedError,typeof navigator<"u"&&(Vr=navigator,di=Vr.userAgent,Vn=Vr.platform,As=Vr.mediaDevices),function(){if(!Mo){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Vr.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Vn,search:"Win"},Mac:{str:Vn},Linux:{str:Vn}};let r="unknownBrowser",a=0,d="unknownOS";for(let p in t){const _=t[p]||{};let E=_.str||di,C=_.search||p,b=_.verStr||di,O=_.verSearch||p;if(O instanceof Array||(O=[O]),E.indexOf(C)!=-1){r=p;for(let M of O){let k=b.indexOf(M);if(k!=-1){a=parseFloat(b.substring(k+M.length+1));break}}break}}for(let p in e){const _=e[p]||{};let E=_.str||di,C=_.search||p;if(E.indexOf(C)!=-1){d=p;break}}d=="Linux"&&di.indexOf("Windows NT")!=-1&&(d="HarmonyOS"),ht={browser:r,version:a,OS:d}}Mo&&(ht={browser:"ssr",version:0,OS:"ssr"})}();const lf=typeof WebAssembly<"u"&&di&&!(/Safari/.test(di)&&!/Chrome/.test(di)&&/\(.+\s11_2_([2-6]).*\)/.test(di)),hf=!(typeof Worker>"u"),rc=!(!As||!As.getUserMedia),cf=async()=>{let t=!1;if(rc)try{(await As.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t};ht.browser==="Chrome"&&ht.version>66||ht.browser==="Safari"&&ht.version>13||ht.browser==="OPR"&&ht.version>43||ht.browser==="Edge"&&ht.version;var uf={653:(t,e,r)=>{var a,d,p,_,E,C,b,O,M,k,V,H,z,Z,$,J,te,he,ce,ue,be,v=v||{version:"5.2.1"};if(e.fabric=v,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?v.document=document:v.document=document.implementation.createHTMLDocument(""),v.window=window;else{var pe=new(r(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;v.document=pe.document,v.jsdomImplForWrapper=r(898).implForWrapper,v.nodeCanvas=r(245).Canvas,v.window=pe,DOMParser=v.window.DOMParser}function Ce(l,s){var o=l.canvas,c=s.targetCanvas,i=c.getContext("2d");i.translate(0,c.height),i.scale(1,-1);var n=o.height-c.height;i.drawImage(o,0,n,c.width,c.height,0,0,c.width,c.height)}function fe(l,s){var o=s.targetCanvas.getContext("2d"),c=s.destinationWidth,i=s.destinationHeight,n=c*i*4,h=new Uint8Array(this.imageBuffer,0,n),g=new Uint8ClampedArray(this.imageBuffer,0,n);l.readPixels(0,0,c,i,l.RGBA,l.UNSIGNED_BYTE,h);var u=new ImageData(g,c,i);o.putImageData(u,0,0)}v.isTouchSupported="ontouchstart"in v.window||"ontouchstart"in v.document||v.window&&v.window.navigator&&v.window.navigator.maxTouchPoints>0,v.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",v.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],v.DPI=96,v.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",v.commaWsp="(?:\\s+,?\\s*|,\\s*)",v.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,v.reNonWord=/[ \n\.,;!\?\-]/,v.fontPaths={},v.iMatrix=[1,0,0,1,0,0],v.svgNS="http://www.w3.org/2000/svg",v.perfLimitSizeTotal=2097152,v.maxCacheSideLimit=4096,v.minCacheSideLimit=256,v.charWidthsCache={},v.textureSize=2048,v.disableStyleCopyPaste=!1,v.enableGLFiltering=!0,v.devicePixelRatio=v.window.devicePixelRatio||v.window.webkitDevicePixelRatio||v.window.mozDevicePixelRatio||1,v.browserShadowBlurConstant=1,v.arcToSegmentsCache={},v.boundsOfCurveCache={},v.cachesBoundsOfCurve=!0,v.forceGLPutImageData=!1,v.initFilterBackend=function(){return v.enableGLFiltering&&v.isWebglSupported&&v.isWebglSupported(v.textureSize)?(console.log("max texture size: "+v.maxTextureSize),new v.WebglFilterBackend({tileSize:v.textureSize})):v.Canvas2dFilterBackend?new v.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=v),function(){function l(o,c){if(this.__eventListeners[o]){var i=this.__eventListeners[o];c?i[i.indexOf(c)]=!1:v.util.array.fill(i,!1)}}function s(o,c){var i=(function(){c.apply(this,arguments),this.off(o,i)}).bind(this);this.on(o,i)}v.Observable={fire:function(o,c){if(!this.__eventListeners)return this;var i=this.__eventListeners[o];if(!i)return this;for(var n=0,h=i.length;n<h;n++)i[n]&&i[n].call(this,c||{});return this.__eventListeners[o]=i.filter(function(g){return g!==!1}),this},on:function(o,c){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var i in o)this.on(i,o[i]);else this.__eventListeners[o]||(this.__eventListeners[o]=[]),this.__eventListeners[o].push(c);return this},once:function(o,c){if(arguments.length===1)for(var i in o)s.call(this,i,o[i]);else s.call(this,o,c);return this},off:function(o,c){if(!this.__eventListeners)return this;if(arguments.length===0)for(o in this.__eventListeners)l.call(this,o);else if(arguments.length===1&&typeof arguments[0]=="object")for(var i in o)l.call(this,i,o[i]);else l.call(this,o,c);return this}}}(),v.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var l=0,s=arguments.length;l<s;l++)this._onObjectAdded(arguments[l]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(l,s,o){var c=this._objects;return o?c[s]=l:c.splice(s,0,l),this._onObjectAdded&&this._onObjectAdded(l),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var l,s=this._objects,o=!1,c=0,i=arguments.length;c<i;c++)(l=s.indexOf(arguments[c]))!==-1&&(o=!0,s.splice(l,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[c]));return this.renderOnAddRemove&&o&&this.requestRenderAll(),this},forEachObject:function(l,s){for(var o=this.getObjects(),c=0,i=o.length;c<i;c++)l.call(s,o[c],c,o);return this},getObjects:function(l){return l===void 0?this._objects.concat():this._objects.filter(function(s){return s.type===l})},item:function(l){return this._objects[l]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(l,s){return this._objects.indexOf(l)>-1||!!s&&this._objects.some(function(o){return typeof o.contains=="function"&&o.contains(l,!0)})},complexity:function(){return this._objects.reduce(function(l,s){return l+(s.complexity?s.complexity():0)},0)}},v.CommonMethods={_setOptions:function(l){for(var s in l)this.set(s,l[s])},_initGradient:function(l,s){!l||!l.colorStops||l instanceof v.Gradient||this.set(s,new v.Gradient(l))},_initPattern:function(l,s,o){!l||!l.source||l instanceof v.Pattern?o&&o():this.set(s,new v.Pattern(l,o))},_setObject:function(l){for(var s in l)this._set(s,l[s])},set:function(l,s){return typeof l=="object"?this._setObject(l):this._set(l,s),this},_set:function(l,s){this[l]=s},toggle:function(l){var s=this.get(l);return typeof s=="boolean"&&this.set(l,!s),this},get:function(l){return this[l]}},a=e,d=Math.sqrt,p=Math.atan2,_=Math.pow,E=Math.PI/180,C=Math.PI/2,v.util={cos:function(l){if(l===0)return 1;switch(l<0&&(l=-l),l/C){case 1:case 3:return 0;case 2:return-1}return Math.cos(l)},sin:function(l){if(l===0)return 0;var s=1;switch(l<0&&(s=-1),l/C){case 1:return s;case 2:return 0;case 3:return-s}return Math.sin(l)},removeFromArray:function(l,s){var o=l.indexOf(s);return o!==-1&&l.splice(o,1),l},getRandomInt:function(l,s){return Math.floor(Math.random()*(s-l+1))+l},degreesToRadians:function(l){return l*E},radiansToDegrees:function(l){return l/E},rotatePoint:function(l,s,o){var c=new v.Point(l.x-s.x,l.y-s.y),i=v.util.rotateVector(c,o);return new v.Point(i.x,i.y).addEquals(s)},rotateVector:function(l,s){var o=v.util.sin(s),c=v.util.cos(s);return{x:l.x*c-l.y*o,y:l.x*o+l.y*c}},createVector:function(l,s){return new v.Point(s.x-l.x,s.y-l.y)},calcAngleBetweenVectors:function(l,s){return Math.acos((l.x*s.x+l.y*s.y)/(Math.hypot(l.x,l.y)*Math.hypot(s.x,s.y)))},getHatVector:function(l){return new v.Point(l.x,l.y).multiply(1/Math.hypot(l.x,l.y))},getBisector:function(l,s,o){var c=v.util.createVector(l,s),i=v.util.createVector(l,o),n=v.util.calcAngleBetweenVectors(c,i),h=n*(v.util.calcAngleBetweenVectors(v.util.rotateVector(c,n),i)===0?1:-1)/2;return{vector:v.util.getHatVector(v.util.rotateVector(c,h)),angle:n}},projectStrokeOnPoints:function(l,s,o){var c=[],i=s.strokeWidth/2,n=s.strokeUniform?new v.Point(1/s.scaleX,1/s.scaleY):new v.Point(1,1),h=function(g){var u=i/Math.hypot(g.x,g.y);return new v.Point(g.x*u*n.x,g.y*u*n.y)};return l.length<=1||l.forEach(function(g,u){var f,m,y=new v.Point(g.x,g.y);u===0?(m=l[u+1],f=o?h(v.util.createVector(m,y)).addEquals(y):l[l.length-1]):u===l.length-1?(f=l[u-1],m=o?h(v.util.createVector(f,y)).addEquals(y):l[0]):(f=l[u-1],m=l[u+1]);var w,T,S=v.util.getBisector(y,f,m),D=S.vector,N=S.angle;if(s.strokeLineJoin==="miter"&&(w=-i/Math.sin(N/2),T=new v.Point(D.x*w*n.x,D.y*w*n.y),Math.hypot(T.x,T.y)/i<=s.strokeMiterLimit))return c.push(y.add(T)),void c.push(y.subtract(T));w=-i*Math.SQRT2,T=new v.Point(D.x*w*n.x,D.y*w*n.y),c.push(y.add(T)),c.push(y.subtract(T))}),c},transformPoint:function(l,s,o){return o?new v.Point(s[0]*l.x+s[2]*l.y,s[1]*l.x+s[3]*l.y):new v.Point(s[0]*l.x+s[2]*l.y+s[4],s[1]*l.x+s[3]*l.y+s[5])},makeBoundingBoxFromPoints:function(l,s){if(s)for(var o=0;o<l.length;o++)l[o]=v.util.transformPoint(l[o],s);var c=[l[0].x,l[1].x,l[2].x,l[3].x],i=v.util.array.min(c),n=v.util.array.max(c)-i,h=[l[0].y,l[1].y,l[2].y,l[3].y],g=v.util.array.min(h);return{left:i,top:g,width:n,height:v.util.array.max(h)-g}},invertTransform:function(l){var s=1/(l[0]*l[3]-l[1]*l[2]),o=[s*l[3],-s*l[1],-s*l[2],s*l[0]],c=v.util.transformPoint({x:l[4],y:l[5]},o,!0);return o[4]=-c.x,o[5]=-c.y,o},toFixed:function(l,s){return parseFloat(Number(l).toFixed(s))},parseUnit:function(l,s){var o=/\D{0,2}$/.exec(l),c=parseFloat(l);switch(s||(s=v.Text.DEFAULT_SVG_FONT_SIZE),o[0]){case"mm":return c*v.DPI/25.4;case"cm":return c*v.DPI/2.54;case"in":return c*v.DPI;case"pt":return c*v.DPI/72;case"pc":return c*v.DPI/72*12;case"em":return c*s;default:return c}},falseFunction:function(){return!1},getKlass:function(l,s){return l=v.util.string.camelize(l.charAt(0).toUpperCase()+l.slice(1)),v.util.resolveNamespace(s)[l]},getSvgAttributes:function(l){var s=["instantiated_by_use","style","id","class"];switch(l){case"linearGradient":s=s.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":s=s.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":s=s.concat(["offset","stop-color","stop-opacity"])}return s},resolveNamespace:function(l){if(!l)return v;var s,o=l.split("."),c=o.length,i=a||v.window;for(s=0;s<c;++s)i=i[o[s]];return i},loadImage:function(l,s,o,c){if(l){var i=v.util.createImage(),n=function(){s&&s.call(o,i,!1),i=i.onload=i.onerror=null};i.onload=n,i.onerror=function(){v.log("Error loading "+i.src),s&&s.call(o,null,!0),i=i.onload=i.onerror=null},l.indexOf("data")!==0&&c!=null&&(i.crossOrigin=c),l.substring(0,14)==="data:image/svg"&&(i.onload=null,v.util.loadImageInDom(i,n)),i.src=l}else s&&s.call(o,l)},loadImageInDom:function(l,s){var o=v.document.createElement("div");o.style.width=o.style.height="1px",o.style.left=o.style.top="-100%",o.style.position="absolute",o.appendChild(l),v.document.querySelector("body").appendChild(o),l.onload=function(){s(),o.parentNode.removeChild(o),o=null}},enlivenObjects:function(l,s,o,c){var i=[],n=0,h=(l=l||[]).length;function g(){++n===h&&s&&s(i.filter(function(u){return u}))}h?l.forEach(function(u,f){u&&u.type?v.util.getKlass(u.type,o).fromObject(u,function(m,y){y||(i[f]=m),c&&c(u,m,y),g()}):g()}):s&&s(i)},enlivenObjectEnlivables:function(l,s,o){var c=v.Object.ENLIVEN_PROPS.filter(function(i){return!!l[i]});v.util.enlivenObjects(c.map(function(i){return l[i]}),function(i){var n={};c.forEach(function(h,g){n[h]=i[g],s&&(s[h]=i[g])}),o&&o(n)})},enlivenPatterns:function(l,s){function o(){++i===n&&s&&s(c)}var c=[],i=0,n=(l=l||[]).length;n?l.forEach(function(h,g){h&&h.source?new v.Pattern(h,function(u){c[g]=u,o()}):(c[g]=h,o())}):s&&s(c)},groupSVGElements:function(l,s,o){var c;return l&&l.length===1?l[0]:(s&&(s.width&&s.height?s.centerPoint={x:s.width/2,y:s.height/2}:(delete s.width,delete s.height)),c=new v.Group(l,s),o!==void 0&&(c.sourcePath=o),c)},populateWithProperties:function(l,s,o){if(o&&Array.isArray(o))for(var c=0,i=o.length;c<i;c++)o[c]in l&&(s[o[c]]=l[o[c]])},createCanvasElement:function(){return v.document.createElement("canvas")},copyCanvasElement:function(l){var s=v.util.createCanvasElement();return s.width=l.width,s.height=l.height,s.getContext("2d").drawImage(l,0,0),s},toDataURL:function(l,s,o){return l.toDataURL("image/"+s,o)},createImage:function(){return v.document.createElement("img")},multiplyTransformMatrices:function(l,s,o){return[l[0]*s[0]+l[2]*s[1],l[1]*s[0]+l[3]*s[1],l[0]*s[2]+l[2]*s[3],l[1]*s[2]+l[3]*s[3],o?0:l[0]*s[4]+l[2]*s[5]+l[4],o?0:l[1]*s[4]+l[3]*s[5]+l[5]]},qrDecompose:function(l){var s=p(l[1],l[0]),o=_(l[0],2)+_(l[1],2),c=d(o),i=(l[0]*l[3]-l[2]*l[1])/c,n=p(l[0]*l[2]+l[1]*l[3],o);return{angle:s/E,scaleX:c,scaleY:i,skewX:n/E,skewY:0,translateX:l[4],translateY:l[5]}},calcRotateMatrix:function(l){if(!l.angle)return v.iMatrix.concat();var s=v.util.degreesToRadians(l.angle),o=v.util.cos(s),c=v.util.sin(s);return[o,c,-c,o,0,0]},calcDimensionsMatrix:function(l){var s=l.scaleX===void 0?1:l.scaleX,o=l.scaleY===void 0?1:l.scaleY,c=[l.flipX?-s:s,0,0,l.flipY?-o:o,0,0],i=v.util.multiplyTransformMatrices,n=v.util.degreesToRadians;return l.skewX&&(c=i(c,[1,0,Math.tan(n(l.skewX)),1],!0)),l.skewY&&(c=i(c,[1,Math.tan(n(l.skewY)),0,1],!0)),c},composeMatrix:function(l){var s=[1,0,0,1,l.translateX||0,l.translateY||0],o=v.util.multiplyTransformMatrices;return l.angle&&(s=o(s,v.util.calcRotateMatrix(l))),(l.scaleX!==1||l.scaleY!==1||l.skewX||l.skewY||l.flipX||l.flipY)&&(s=o(s,v.util.calcDimensionsMatrix(l))),s},resetObjectTransform:function(l){l.scaleX=1,l.scaleY=1,l.skewX=0,l.skewY=0,l.flipX=!1,l.flipY=!1,l.rotate(0)},saveObjectTransform:function(l){return{scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,angle:l.angle,left:l.left,flipX:l.flipX,flipY:l.flipY,top:l.top}},isTransparent:function(l,s,o,c){c>0&&(s>c?s-=c:s=0,o>c?o-=c:o=0);var i,n=!0,h=l.getImageData(s,o,2*c||1,2*c||1),g=h.data.length;for(i=3;i<g&&(n=h.data[i]<=0)!=0;i+=4);return h=null,n},parsePreserveAspectRatioAttribute:function(l){var s,o="meet",c=l.split(" ");return c&&c.length&&((o=c.pop())!=="meet"&&o!=="slice"?(s=o,o="meet"):c.length&&(s=c.pop())),{meetOrSlice:o,alignX:s!=="none"?s.slice(1,4):"none",alignY:s!=="none"?s.slice(5,8):"none"}},clearFabricFontCache:function(l){(l=(l||"").toLowerCase())?v.charWidthsCache[l]&&delete v.charWidthsCache[l]:v.charWidthsCache={}},limitDimsByArea:function(l,s){var o=Math.sqrt(s*l),c=Math.floor(s/o);return{x:Math.floor(o),y:c}},capValue:function(l,s,o){return Math.max(l,Math.min(s,o))},findScaleToFit:function(l,s){return Math.min(s.width/l.width,s.height/l.height)},findScaleToCover:function(l,s){return Math.max(s.width/l.width,s.height/l.height)},matrixToSVG:function(l){return"matrix("+l.map(function(s){return v.util.toFixed(s,v.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(l,s){var o=v.util.invertTransform(s),c=v.util.multiplyTransformMatrices(o,l.calcOwnMatrix());v.util.applyTransformToObject(l,c)},addTransformToObject:function(l,s){v.util.applyTransformToObject(l,v.util.multiplyTransformMatrices(s,l.calcOwnMatrix()))},applyTransformToObject:function(l,s){var o=v.util.qrDecompose(s),c=new v.Point(o.translateX,o.translateY);l.flipX=!1,l.flipY=!1,l.set("scaleX",o.scaleX),l.set("scaleY",o.scaleY),l.skewX=o.skewX,l.skewY=o.skewY,l.angle=o.angle,l.setPositionByOrigin(c,"center","center")},sizeAfterTransform:function(l,s,o){var c=l/2,i=s/2,n=[{x:-c,y:-i},{x:c,y:-i},{x:-c,y:i},{x:c,y:i}],h=v.util.calcDimensionsMatrix(o),g=v.util.makeBoundingBoxFromPoints(n,h);return{x:g.width,y:g.height}},mergeClipPaths:function(l,s){var o=l,c=s;o.inverted&&!c.inverted&&(o=s,c=l),v.util.applyTransformToObject(c,v.util.multiplyTransformMatrices(v.util.invertTransform(o.calcTransformMatrix()),c.calcTransformMatrix()));var i=o.inverted&&c.inverted;return i&&(o.inverted=c.inverted=!1),new v.Group([o],{clipPath:c,inverted:i})}},function(){var l=Array.prototype.join,s={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},o={m:"l",M:"L"};function c(T,S,D,N,X,K,ee,Q,A,x,R){var P=v.util.cos(T),U=v.util.sin(T),W=v.util.cos(S),F=v.util.sin(S),L=D*X*W-N*K*F+ee,B=N*X*W+D*K*F+Q;return["C",x+A*(-D*X*U-N*K*P),R+A*(-N*X*U+D*K*P),L+A*(D*X*F+N*K*W),B+A*(N*X*F-D*K*W),L,B]}function i(T,S,D,N){var X=Math.atan2(S,T),K=Math.atan2(N,D);return K>=X?K-X:2*Math.PI-(X-K)}function n(T,S,D){for(var N=D[1],X=D[2],K=D[3],ee=D[4],Q=D[5],A=function(P,U,W,F,L,B,G){var Y=Math.PI,q=G*Y/180,ie=v.util.sin(q),ne=v.util.cos(q),re=0,se=0,oe=-ne*P*.5-ie*U*.5,ae=-ne*U*.5+ie*P*.5,ge=(W=Math.abs(W))*W,de=(F=Math.abs(F))*F,xe=ae*ae,ke=oe*oe,pt=ge*de-ge*xe-de*ke,Qe=0;if(pt<0){var lt=Math.sqrt(1-pt/(ge*de));W*=lt,F*=lt}else Qe=(L===B?-1:1)*Math.sqrt(pt/(ge*xe+de*ke));var Ke=Qe*W*ae/F,Ft=-Qe*F*oe/W,Fr=ne*Ke-ie*Ft+.5*P,sr=ie*Ke+ne*Ft+.5*U,Bi=i(1,0,(oe-Ke)/W,(ae-Ft)/F),or=i((oe-Ke)/W,(ae-Ft)/F,(-oe-Ke)/W,(-ae-Ft)/F);B===0&&or>0?or-=2*Y:B===1&&or<0&&(or+=2*Y);for(var Aa=Math.ceil(Math.abs(or/Y*2)),Ln=[],Pr=or/Aa,wc=8/3*Math.sin(Pr/4)*Math.sin(Pr/4)/Math.sin(Pr/2),Xs=Bi+Pr,kr=0;kr<Aa;kr++)Ln[kr]=c(Bi,Xs,ne,ie,W,F,Fr,sr,wc,re,se),re=Ln[kr][5],se=Ln[kr][6],Bi=Xs,Xs+=Pr;return Ln}(D[6]-T,D[7]-S,N,X,ee,Q,K),x=0,R=A.length;x<R;x++)A[x][1]+=T,A[x][2]+=S,A[x][3]+=T,A[x][4]+=S,A[x][5]+=T,A[x][6]+=S;return A}function h(T,S,D,N){return Math.sqrt((D-T)*(D-T)+(N-S)*(N-S))}function g(T,S,D,N,X,K,ee,Q){return function(A){var x,R=(x=A)*x*x,P=function(F){return 3*F*F*(1-F)}(A),U=function(F){return 3*F*(1-F)*(1-F)}(A),W=function(F){return(1-F)*(1-F)*(1-F)}(A);return{x:ee*R+X*P+D*U+T*W,y:Q*R+K*P+N*U+S*W}}}function u(T,S,D,N,X,K,ee,Q){return function(A){var x=1-A,R=3*x*x*(D-T)+6*x*A*(X-D)+3*A*A*(ee-X),P=3*x*x*(N-S)+6*x*A*(K-N)+3*A*A*(Q-K);return Math.atan2(P,R)}}function f(T,S,D,N,X,K){return function(ee){var Q,A=(Q=ee)*Q,x=function(P){return 2*P*(1-P)}(ee),R=function(P){return(1-P)*(1-P)}(ee);return{x:X*A+D*x+T*R,y:K*A+N*x+S*R}}}function m(T,S,D,N,X,K){return function(ee){var Q=1-ee,A=2*Q*(D-T)+2*ee*(X-D),x=2*Q*(N-S)+2*ee*(K-N);return Math.atan2(x,A)}}function y(T,S,D){var N,X,K={x:S,y:D},ee=0;for(X=1;X<=100;X+=1)N=T(X/100),ee+=h(K.x,K.y,N.x,N.y),K=N;return ee}function w(T){for(var S,D,N,X,K=0,ee=T.length,Q=0,A=0,x=0,R=0,P=[],U=0;U<ee;U++){switch(N={x:Q,y:A,command:(S=T[U])[0]},S[0]){case"M":N.length=0,x=Q=S[1],R=A=S[2];break;case"L":N.length=h(Q,A,S[1],S[2]),Q=S[1],A=S[2];break;case"C":D=g(Q,A,S[1],S[2],S[3],S[4],S[5],S[6]),X=u(Q,A,S[1],S[2],S[3],S[4],S[5],S[6]),N.iterator=D,N.angleFinder=X,N.length=y(D,Q,A),Q=S[5],A=S[6];break;case"Q":D=f(Q,A,S[1],S[2],S[3],S[4]),X=m(Q,A,S[1],S[2],S[3],S[4]),N.iterator=D,N.angleFinder=X,N.length=y(D,Q,A),Q=S[3],A=S[4];break;case"Z":case"z":N.destX=x,N.destY=R,N.length=h(Q,A,x,R),Q=x,A=R}K+=N.length,P.push(N)}return P.push({length:K,x:Q,y:A}),P}v.util.joinPath=function(T){return T.map(function(S){return S.join(" ")}).join(" ")},v.util.parsePath=function(T){var S,D,N,X,K,ee=[],Q=[],A=v.rePathCommand,x="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",R="("+x+")"+v.commaWsp,P="([01])"+v.commaWsp+"?",U=new RegExp(R+"?"+R+"?"+R+P+P+R+"?("+x+")","g");if(!T||!T.match)return ee;for(var W,F=0,L=(K=T.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;F<L;F++){X=(S=K[F]).slice(1).trim(),Q.length=0;var B=S.charAt(0);if(W=[B],B.toLowerCase()==="a")for(var G;G=U.exec(X);)for(var Y=1;Y<G.length;Y++)Q.push(G[Y]);else for(;N=A.exec(X);)Q.push(N[0]);Y=0;for(var q=Q.length;Y<q;Y++)D=parseFloat(Q[Y]),isNaN(D)||W.push(D);var ie=s[B.toLowerCase()],ne=o[B]||B;if(W.length-1>ie)for(var re=1,se=W.length;re<se;re+=ie)ee.push([B].concat(W.slice(re,re+ie))),B=ne;else ee.push(W)}return ee},v.util.makePathSimpler=function(T){var S,D,N,X,K,ee,Q=0,A=0,x=T.length,R=0,P=0,U=[];for(D=0;D<x;++D){switch(N=!1,(S=T[D].slice(0))[0]){case"l":S[0]="L",S[1]+=Q,S[2]+=A;case"L":Q=S[1],A=S[2];break;case"h":S[1]+=Q;case"H":S[0]="L",S[2]=A,Q=S[1];break;case"v":S[1]+=A;case"V":S[0]="L",A=S[1],S[1]=Q,S[2]=A;break;case"m":S[0]="M",S[1]+=Q,S[2]+=A;case"M":Q=S[1],A=S[2],R=S[1],P=S[2];break;case"c":S[0]="C",S[1]+=Q,S[2]+=A,S[3]+=Q,S[4]+=A,S[5]+=Q,S[6]+=A;case"C":K=S[3],ee=S[4],Q=S[5],A=S[6];break;case"s":S[0]="S",S[1]+=Q,S[2]+=A,S[3]+=Q,S[4]+=A;case"S":X==="C"?(K=2*Q-K,ee=2*A-ee):(K=Q,ee=A),Q=S[3],A=S[4],S[0]="C",S[5]=S[3],S[6]=S[4],S[3]=S[1],S[4]=S[2],S[1]=K,S[2]=ee,K=S[3],ee=S[4];break;case"q":S[0]="Q",S[1]+=Q,S[2]+=A,S[3]+=Q,S[4]+=A;case"Q":K=S[1],ee=S[2],Q=S[3],A=S[4];break;case"t":S[0]="T",S[1]+=Q,S[2]+=A;case"T":X==="Q"?(K=2*Q-K,ee=2*A-ee):(K=Q,ee=A),S[0]="Q",Q=S[1],A=S[2],S[1]=K,S[2]=ee,S[3]=Q,S[4]=A;break;case"a":S[0]="A",S[6]+=Q,S[7]+=A;case"A":N=!0,U=U.concat(n(Q,A,S)),Q=S[6],A=S[7];break;case"z":case"Z":Q=R,A=P}N||U.push(S),X=S[0]}return U},v.util.getSmoothPathFromPoints=function(T,S){var D,N=[],X=new v.Point(T[0].x,T[0].y),K=new v.Point(T[1].x,T[1].y),ee=T.length,Q=1,A=0,x=ee>2;for(S=S||0,x&&(Q=T[2].x<K.x?-1:T[2].x===K.x?0:1,A=T[2].y<K.y?-1:T[2].y===K.y?0:1),N.push(["M",X.x-Q*S,X.y-A*S]),D=1;D<ee;D++){if(!X.eq(K)){var R=X.midPointFrom(K);N.push(["Q",X.x,X.y,R.x,R.y])}X=T[D],D+1<T.length&&(K=T[D+1])}return x&&(Q=X.x>T[D-2].x?1:X.x===T[D-2].x?0:-1,A=X.y>T[D-2].y?1:X.y===T[D-2].y?0:-1),N.push(["L",X.x+Q*S,X.y+A*S]),N},v.util.getPathSegmentsInfo=w,v.util.getBoundsOfCurve=function(T,S,D,N,X,K,ee,Q){var A;if(v.cachesBoundsOfCurve&&(A=l.call(arguments),v.boundsOfCurveCache[A]))return v.boundsOfCurveCache[A];var x,R,P,U,W,F,L,B,G=Math.sqrt,Y=Math.min,q=Math.max,ie=Math.abs,ne=[],re=[[],[]];R=6*T-12*D+6*X,x=-3*T+9*D-9*X+3*ee,P=3*D-3*T;for(var se=0;se<2;++se)if(se>0&&(R=6*S-12*N+6*K,x=-3*S+9*N-9*K+3*Q,P=3*N-3*S),ie(x)<1e-12){if(ie(R)<1e-12)continue;0<(U=-P/R)&&U<1&&ne.push(U)}else(L=R*R-4*P*x)<0||(0<(W=(-R+(B=G(L)))/(2*x))&&W<1&&ne.push(W),0<(F=(-R-B)/(2*x))&&F<1&&ne.push(F));for(var oe,ae,ge,de=ne.length,xe=de;de--;)oe=(ge=1-(U=ne[de]))*ge*ge*T+3*ge*ge*U*D+3*ge*U*U*X+U*U*U*ee,re[0][de]=oe,ae=ge*ge*ge*S+3*ge*ge*U*N+3*ge*U*U*K+U*U*U*Q,re[1][de]=ae;re[0][xe]=T,re[1][xe]=S,re[0][xe+1]=ee,re[1][xe+1]=Q;var ke=[{x:Y.apply(null,re[0]),y:Y.apply(null,re[1])},{x:q.apply(null,re[0]),y:q.apply(null,re[1])}];return v.cachesBoundsOfCurve&&(v.boundsOfCurveCache[A]=ke),ke},v.util.getPointOnPath=function(T,S,D){D||(D=w(T));for(var N=0;S-D[N].length>0&&N<D.length-2;)S-=D[N].length,N++;var X,K=D[N],ee=S/K.length,Q=K.command,A=T[N];switch(Q){case"M":return{x:K.x,y:K.y,angle:0};case"Z":case"z":return(X=new v.Point(K.x,K.y).lerp(new v.Point(K.destX,K.destY),ee)).angle=Math.atan2(K.destY-K.y,K.destX-K.x),X;case"L":return(X=new v.Point(K.x,K.y).lerp(new v.Point(A[1],A[2]),ee)).angle=Math.atan2(A[2]-K.y,A[1]-K.x),X;case"C":case"Q":return function(x,R){for(var P,U,W,F=0,L=0,B=x.iterator,G={x:x.x,y:x.y},Y=.01,q=x.angleFinder;L<R&&Y>1e-4;)P=B(F),W=F,(U=h(G.x,G.y,P.x,P.y))+L>R?(F-=Y,Y/=2):(G=P,F+=Y,L+=U);return P.angle=q(W),P}(K,S)}},v.util.transformPath=function(T,S,D){return D&&(S=v.util.multiplyTransformMatrices(S,[1,0,0,1,-D.x,-D.y])),T.map(function(N){for(var X=N.slice(0),K={},ee=1;ee<N.length-1;ee+=2)K.x=N[ee],K.y=N[ee+1],K=v.util.transformPoint(K,S),X[ee]=K.x,X[ee+1]=K.y;return X})}}(),function(){var l=Array.prototype.slice;function s(o,c,i){if(o&&o.length!==0){var n=o.length-1,h=c?o[n][c]:o[n];if(c)for(;n--;)i(o[n][c],h)&&(h=o[n][c]);else for(;n--;)i(o[n],h)&&(h=o[n]);return h}}v.util.array={fill:function(o,c){for(var i=o.length;i--;)o[i]=c;return o},invoke:function(o,c){for(var i=l.call(arguments,2),n=[],h=0,g=o.length;h<g;h++)n[h]=i.length?o[h][c].apply(o[h],i):o[h][c].call(o[h]);return n},min:function(o,c){return s(o,c,function(i,n){return i<n})},max:function(o,c){return s(o,c,function(i,n){return i>=n})}}}(),function(){function l(s,o,c){if(c)if(!v.isLikelyNode&&o instanceof Element)s=o;else if(o instanceof Array){s=[];for(var i=0,n=o.length;i<n;i++)s[i]=l({},o[i],c)}else if(o&&typeof o=="object")for(var h in o)h==="canvas"||h==="group"?s[h]=null:o.hasOwnProperty(h)&&(s[h]=l({},o[h],c));else s=o;else for(var h in o)s[h]=o[h];return s}v.util.object={extend:l,clone:function(s,o){return l({},s,o)}},v.util.object.extend(v.util,v.Observable)}(),function(){function l(s,o){var c=s.charCodeAt(o);if(isNaN(c))return"";if(c<55296||c>57343)return s.charAt(o);if(55296<=c&&c<=56319){if(s.length<=o+1)throw"High surrogate without following low surrogate";var i=s.charCodeAt(o+1);if(56320>i||i>57343)throw"High surrogate without following low surrogate";return s.charAt(o)+s.charAt(o+1)}if(o===0)throw"Low surrogate without preceding high surrogate";var n=s.charCodeAt(o-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1}v.util.string={camelize:function(s){return s.replace(/-+(.)?/g,function(o,c){return c?c.toUpperCase():""})},capitalize:function(s,o){return s.charAt(0).toUpperCase()+(o?s.slice(1):s.slice(1).toLowerCase())},escapeXml:function(s){return s.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(s){var o,c=0,i=[];for(c=0;c<s.length;c++)(o=l(s,c))!==!1&&i.push(o);return i}}}(),function(){var l=Array.prototype.slice,s=function(){},o=function(){for(var h in{toString:1})if(h==="toString")return!1;return!0}(),c=function(h,g,u){for(var f in g)f in h.prototype&&typeof h.prototype[f]=="function"&&(g[f]+"").indexOf("callSuper")>-1?h.prototype[f]=function(m){return function(){var y=this.constructor.superclass;this.constructor.superclass=u;var w=g[m].apply(this,arguments);if(this.constructor.superclass=y,m!=="initialize")return w}}(f):h.prototype[f]=g[f],o&&(g.toString!==Object.prototype.toString&&(h.prototype.toString=g.toString),g.valueOf!==Object.prototype.valueOf&&(h.prototype.valueOf=g.valueOf))};function i(){}function n(h){for(var g=null,u=this;u.constructor.superclass;){var f=u.constructor.superclass.prototype[h];if(u[h]!==f){g=f;break}u=u.constructor.superclass.prototype}return g?arguments.length>1?g.apply(this,l.call(arguments,1)):g.call(this):console.log("tried to callSuper "+h+", method not found in prototype chain",this)}v.util.createClass=function(){var h=null,g=l.call(arguments,0);function u(){this.initialize.apply(this,arguments)}typeof g[0]=="function"&&(h=g.shift()),u.superclass=h,u.subclasses=[],h&&(i.prototype=h.prototype,u.prototype=new i,h.subclasses.push(u));for(var f=0,m=g.length;f<m;f++)c(u,g[f],h);return u.prototype.initialize||(u.prototype.initialize=s),u.prototype.constructor=u,u.prototype.callSuper=n,u}}(),b=!!v.document.createElement("div").attachEvent,O=["touchstart","touchmove","touchend"],v.util.addListener=function(l,s,o,c){l&&l.addEventListener(s,o,!b&&c)},v.util.removeListener=function(l,s,o,c){l&&l.removeEventListener(s,o,!b&&c)},v.util.getPointer=function(l){var s=l.target,o=v.util.getScrollLeftTop(s),c=function(i){var n=i.changedTouches;return n&&n[0]?n[0]:i}(l);return{x:c.clientX+o.left,y:c.clientY+o.top}},v.util.isTouchEvent=function(l){return O.indexOf(l.type)>-1||l.pointerType==="touch"},k=typeof(M=v.document.createElement("div")).style.opacity=="string",V=typeof M.style.filter=="string",H=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,z=function(l){return l},k?z=function(l,s){return l.style.opacity=s,l}:V&&(z=function(l,s){var o=l.style;return l.currentStyle&&!l.currentStyle.hasLayout&&(o.zoom=1),H.test(o.filter)?(s=s>=.9999?"":"alpha(opacity="+100*s+")",o.filter=o.filter.replace(H,s)):o.filter+=" alpha(opacity="+100*s+")",l}),v.util.setStyle=function(l,s){var o=l.style;if(!o)return l;if(typeof s=="string")return l.style.cssText+=";"+s,s.indexOf("opacity")>-1?z(l,s.match(/opacity:\s*(\d?\.?\d*)/)[1]):l;for(var c in s)c==="opacity"?z(l,s[c]):o[c==="float"||c==="cssFloat"?o.styleFloat===void 0?"cssFloat":"styleFloat":c]=s[c];return l},function(){var l,s,o,c,i=Array.prototype.slice,n=function(u){return i.call(u,0)};try{l=n(v.document.childNodes)instanceof Array}catch{}function h(u,f){var m=v.document.createElement(u);for(var y in f)y==="class"?m.className=f[y]:y==="for"?m.htmlFor=f[y]:m.setAttribute(y,f[y]);return m}function g(u){for(var f=0,m=0,y=v.document.documentElement,w=v.document.body||{scrollLeft:0,scrollTop:0};u&&(u.parentNode||u.host)&&((u=u.parentNode||u.host)===v.document?(f=w.scrollLeft||y.scrollLeft||0,m=w.scrollTop||y.scrollTop||0):(f+=u.scrollLeft||0,m+=u.scrollTop||0),u.nodeType!==1||u.style.position!=="fixed"););return{left:f,top:m}}l||(n=function(u){for(var f=new Array(u.length),m=u.length;m--;)f[m]=u[m];return f}),s=v.document.defaultView&&v.document.defaultView.getComputedStyle?function(u,f){var m=v.document.defaultView.getComputedStyle(u,null);return m?m[f]:void 0}:function(u,f){var m=u.style[f];return!m&&u.currentStyle&&(m=u.currentStyle[f]),m},o=v.document.documentElement.style,c="userSelect"in o?"userSelect":"MozUserSelect"in o?"MozUserSelect":"WebkitUserSelect"in o?"WebkitUserSelect":"KhtmlUserSelect"in o?"KhtmlUserSelect":"",v.util.makeElementUnselectable=function(u){return u.onselectstart!==void 0&&(u.onselectstart=v.util.falseFunction),c?u.style[c]="none":typeof u.unselectable=="string"&&(u.unselectable="on"),u},v.util.makeElementSelectable=function(u){return u.onselectstart!==void 0&&(u.onselectstart=null),c?u.style[c]="":typeof u.unselectable=="string"&&(u.unselectable=""),u},v.util.setImageSmoothing=function(u,f){u.imageSmoothingEnabled=u.imageSmoothingEnabled||u.webkitImageSmoothingEnabled||u.mozImageSmoothingEnabled||u.msImageSmoothingEnabled||u.oImageSmoothingEnabled,u.imageSmoothingEnabled=f},v.util.getById=function(u){return typeof u=="string"?v.document.getElementById(u):u},v.util.toArray=n,v.util.addClass=function(u,f){u&&(" "+u.className+" ").indexOf(" "+f+" ")===-1&&(u.className+=(u.className?" ":"")+f)},v.util.makeElement=h,v.util.wrapElement=function(u,f,m){return typeof f=="string"&&(f=h(f,m)),u.parentNode&&u.parentNode.replaceChild(f,u),f.appendChild(u),f},v.util.getScrollLeftTop=g,v.util.getElementOffset=function(u){var f,m,y=u&&u.ownerDocument,w={left:0,top:0},T={left:0,top:0},S={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!y)return T;for(var D in S)T[S[D]]+=parseInt(s(u,D),10)||0;return f=y.documentElement,u.getBoundingClientRect!==void 0&&(w=u.getBoundingClientRect()),m=g(u),{left:w.left+m.left-(f.clientLeft||0)+T.left,top:w.top+m.top-(f.clientTop||0)+T.top}},v.util.getNodeCanvas=function(u){var f=v.jsdomImplForWrapper(u);return f._canvas||f._image},v.util.cleanUpJsdomNode=function(u){if(v.isLikelyNode){var f=v.jsdomImplForWrapper(u);f&&(f._image=null,f._canvas=null,f._currentSrc=null,f._attributes=null,f._classList=null)}}}(),function(){function l(){}v.util.request=function(s,o){o||(o={});var c=o.method?o.method.toUpperCase():"GET",i=o.onComplete||function(){},n=new v.window.XMLHttpRequest,h=o.body||o.parameters;return n.onreadystatechange=function(){n.readyState===4&&(i(n),n.onreadystatechange=l)},c==="GET"&&(h=null,typeof o.parameters=="string"&&(s=function(g,u){return g+(/\?/.test(g)?"&":"?")+u}(s,o.parameters))),n.open(c,s,!0),c!=="POST"&&c!=="PUT"||n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(h),n}}(),v.log=console.log,v.warn=console.warn,function(){var l=v.util.object.extend,s=v.util.object.clone,o=[];function c(){return!1}function i(u,f,m,y){return-m*Math.cos(u/y*(Math.PI/2))+m+f}v.util.object.extend(o,{cancelAll:function(){var u=this.splice(0);return u.forEach(function(f){f.cancel()}),u},cancelByCanvas:function(u){if(!u)return[];var f=this.filter(function(m){return typeof m.target=="object"&&m.target.canvas===u});return f.forEach(function(m){m.cancel()}),f},cancelByTarget:function(u){var f=this.findAnimationsByTarget(u);return f.forEach(function(m){m.cancel()}),f},findAnimationIndex:function(u){return this.indexOf(this.findAnimation(u))},findAnimation:function(u){return this.find(function(f){return f.cancel===u})},findAnimationsByTarget:function(u){return u?this.filter(function(f){return f.target===u}):[]}});var n=v.window.requestAnimationFrame||v.window.webkitRequestAnimationFrame||v.window.mozRequestAnimationFrame||v.window.oRequestAnimationFrame||v.window.msRequestAnimationFrame||function(u){return v.window.setTimeout(u,1e3/60)},h=v.window.cancelAnimationFrame||v.window.clearTimeout;function g(){return n.apply(v.window,arguments)}v.util.animate=function(u){u||(u={});var f,m=!1,y=function(){var w=v.runningAnimations.indexOf(f);return w>-1&&v.runningAnimations.splice(w,1)[0]};return f=l(s(u),{cancel:function(){return m=!0,y()},currentValue:"startValue"in u?u.startValue:0,completionRate:0,durationRate:0}),v.runningAnimations.push(f),g(function(w){var T,S=w||+new Date,D=u.duration||500,N=S+D,X=u.onChange||c,K=u.abort||c,ee=u.onComplete||c,Q=u.easing||i,A="startValue"in u&&u.startValue.length>0,x="startValue"in u?u.startValue:0,R="endValue"in u?u.endValue:100,P=u.byValue||(A?x.map(function(U,W){return R[W]-x[W]}):R-x);u.onStart&&u.onStart(),function U(W){var F=(T=W||+new Date)>N?D:T-S,L=F/D,B=A?x.map(function(Y,q){return Q(F,x[q],P[q],D)}):Q(F,x,P,D),G=Math.abs(A?(B[0]-x[0])/P[0]:(B-x)/P);if(f.currentValue=A?B.slice():B,f.completionRate=G,f.durationRate=L,!m){if(!K(B,G,L))return T>N?(f.currentValue=A?R.slice():R,f.completionRate=1,f.durationRate=1,X(A?R.slice():R,1,1),ee(R,1,1),void y()):(X(B,G,L),void g(U));y()}}(S)}),f.cancel},v.util.requestAnimFrame=g,v.util.cancelAnimFrame=function(){return h.apply(v.window,arguments)},v.runningAnimations=o}(),function(){function l(s,o,c){var i="rgba("+parseInt(s[0]+c*(o[0]-s[0]),10)+","+parseInt(s[1]+c*(o[1]-s[1]),10)+","+parseInt(s[2]+c*(o[2]-s[2]),10);return(i+=","+(s&&o?parseFloat(s[3]+c*(o[3]-s[3])):1))+")"}v.util.animateColor=function(s,o,c,i){var n=new v.Color(s).getSource(),h=new v.Color(o).getSource(),g=i.onComplete,u=i.onChange;return i=i||{},v.util.animate(v.util.object.extend(i,{duration:c||500,startValue:n,endValue:h,byValue:h,easing:function(f,m,y,w){return l(m,y,i.colorEasing?i.colorEasing(f,w):1-Math.cos(f/w*(Math.PI/2)))},onComplete:function(f,m,y){if(g)return g(l(h,h,0),m,y)},onChange:function(f,m,y){if(u){if(Array.isArray(f))return u(l(f,f,0),m,y);u(f,m,y)}}}))}}(),function(){function l(i,n,h,g){return i<Math.abs(n)?(i=n,g=h/4):g=n===0&&i===0?h/(2*Math.PI)*Math.asin(1):h/(2*Math.PI)*Math.asin(n/i),{a:i,c:n,p:h,s:g}}function s(i,n,h){return i.a*Math.pow(2,10*(n-=1))*Math.sin((n*h-i.s)*(2*Math.PI)/i.p)}function o(i,n,h,g){return h-c(g-i,0,h,g)+n}function c(i,n,h,g){return(i/=g)<1/2.75?h*(7.5625*i*i)+n:i<2/2.75?h*(7.5625*(i-=1.5/2.75)*i+.75)+n:i<2.5/2.75?h*(7.5625*(i-=2.25/2.75)*i+.9375)+n:h*(7.5625*(i-=2.625/2.75)*i+.984375)+n}v.util.ease={easeInQuad:function(i,n,h,g){return h*(i/=g)*i+n},easeOutQuad:function(i,n,h,g){return-h*(i/=g)*(i-2)+n},easeInOutQuad:function(i,n,h,g){return(i/=g/2)<1?h/2*i*i+n:-h/2*(--i*(i-2)-1)+n},easeInCubic:function(i,n,h,g){return h*(i/=g)*i*i+n},easeOutCubic:function(i,n,h,g){return h*((i=i/g-1)*i*i+1)+n},easeInOutCubic:function(i,n,h,g){return(i/=g/2)<1?h/2*i*i*i+n:h/2*((i-=2)*i*i+2)+n},easeInQuart:function(i,n,h,g){return h*(i/=g)*i*i*i+n},easeOutQuart:function(i,n,h,g){return-h*((i=i/g-1)*i*i*i-1)+n},easeInOutQuart:function(i,n,h,g){return(i/=g/2)<1?h/2*i*i*i*i+n:-h/2*((i-=2)*i*i*i-2)+n},easeInQuint:function(i,n,h,g){return h*(i/=g)*i*i*i*i+n},easeOutQuint:function(i,n,h,g){return h*((i=i/g-1)*i*i*i*i+1)+n},easeInOutQuint:function(i,n,h,g){return(i/=g/2)<1?h/2*i*i*i*i*i+n:h/2*((i-=2)*i*i*i*i+2)+n},easeInSine:function(i,n,h,g){return-h*Math.cos(i/g*(Math.PI/2))+h+n},easeOutSine:function(i,n,h,g){return h*Math.sin(i/g*(Math.PI/2))+n},easeInOutSine:function(i,n,h,g){return-h/2*(Math.cos(Math.PI*i/g)-1)+n},easeInExpo:function(i,n,h,g){return i===0?n:h*Math.pow(2,10*(i/g-1))+n},easeOutExpo:function(i,n,h,g){return i===g?n+h:h*(1-Math.pow(2,-10*i/g))+n},easeInOutExpo:function(i,n,h,g){return i===0?n:i===g?n+h:(i/=g/2)<1?h/2*Math.pow(2,10*(i-1))+n:h/2*(2-Math.pow(2,-10*--i))+n},easeInCirc:function(i,n,h,g){return-h*(Math.sqrt(1-(i/=g)*i)-1)+n},easeOutCirc:function(i,n,h,g){return h*Math.sqrt(1-(i=i/g-1)*i)+n},easeInOutCirc:function(i,n,h,g){return(i/=g/2)<1?-h/2*(Math.sqrt(1-i*i)-1)+n:h/2*(Math.sqrt(1-(i-=2)*i)+1)+n},easeInElastic:function(i,n,h,g){var u=0;return i===0?n:(i/=g)==1?n+h:(u||(u=.3*g),-s(l(h,h,u,1.70158),i,g)+n)},easeOutElastic:function(i,n,h,g){var u=0;if(i===0)return n;if((i/=g)==1)return n+h;u||(u=.3*g);var f=l(h,h,u,1.70158);return f.a*Math.pow(2,-10*i)*Math.sin((i*g-f.s)*(2*Math.PI)/f.p)+f.c+n},easeInOutElastic:function(i,n,h,g){var u=0;if(i===0)return n;if((i/=g/2)==2)return n+h;u||(u=g*(.3*1.5));var f=l(h,h,u,1.70158);return i<1?-.5*s(f,i,g)+n:f.a*Math.pow(2,-10*(i-=1))*Math.sin((i*g-f.s)*(2*Math.PI)/f.p)*.5+f.c+n},easeInBack:function(i,n,h,g,u){return u===void 0&&(u=1.70158),h*(i/=g)*i*((u+1)*i-u)+n},easeOutBack:function(i,n,h,g,u){return u===void 0&&(u=1.70158),h*((i=i/g-1)*i*((u+1)*i+u)+1)+n},easeInOutBack:function(i,n,h,g,u){return u===void 0&&(u=1.70158),(i/=g/2)<1?h/2*(i*i*((1+(u*=1.525))*i-u))+n:h/2*((i-=2)*i*((1+(u*=1.525))*i+u)+2)+n},easeInBounce:o,easeOutBounce:c,easeInOutBounce:function(i,n,h,g){return i<g/2?.5*o(2*i,0,h,g)+n:.5*c(2*i-g,0,h,g)+.5*h+n}}}(),function(l){var s=l.fabric||(l.fabric={}),o=s.util.object.extend,c=s.util.object.clone,i=s.util.toFixed,n=s.util.parseUnit,h=s.util.multiplyTransformMatrices,g={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},u={stroke:"strokeOpacity",fill:"fillOpacity"},f="font-size",m="clip-path";function y(x){return x in g?g[x]:x}function w(x,R,P,U){var W,F=Array.isArray(R);if(x!=="fill"&&x!=="stroke"||R!=="none"){if(x==="strokeUniform")return R==="non-scaling-stroke";if(x==="strokeDashArray")R=R==="none"?null:R.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(x==="transformMatrix")R=P&&P.transformMatrix?h(P.transformMatrix,s.parseTransformAttribute(R)):s.parseTransformAttribute(R);else if(x==="visible")R=R!=="none"&&R!=="hidden",P&&P.visible===!1&&(R=!1);else if(x==="opacity")R=parseFloat(R),P&&P.opacity!==void 0&&(R*=P.opacity);else if(x==="textAnchor")R=R==="start"?"left":R==="end"?"right":"center";else if(x==="charSpacing")W=n(R,U)/U*1e3;else if(x==="paintFirst"){var L=R.indexOf("fill"),B=R.indexOf("stroke");R="fill",(L>-1&&B>-1&&B<L||L===-1&&B>-1)&&(R="stroke")}else{if(x==="href"||x==="xlink:href"||x==="font")return R;if(x==="imageSmoothing")return R==="optimizeQuality";W=F?R.map(n):n(R,U)}}else R="";return!F&&isNaN(W)?R:W}function T(x){return new RegExp("^("+x.join("|")+")\\b","i")}function S(x,R){var P,U,W,F,L=[];for(W=0,F=R.length;W<F;W++)P=R[W],U=x.getElementsByTagName(P),L=L.concat(Array.prototype.slice.call(U));return L}function D(x,R){var P,U=!0;return(P=N(x,R.pop()))&&R.length&&(U=function(W,F){for(var L,B=!0;W.parentNode&&W.parentNode.nodeType===1&&F.length;)B&&(L=F.pop()),B=N(W=W.parentNode,L);return F.length===0}(x,R)),P&&U&&R.length===0}function N(x,R){var P,U,W=x.nodeName,F=x.getAttribute("class"),L=x.getAttribute("id");if(P=new RegExp("^"+W,"i"),R=R.replace(P,""),L&&R.length&&(P=new RegExp("#"+L+"(?![a-zA-Z\\-]+)","i"),R=R.replace(P,"")),F&&R.length)for(U=(F=F.split(" ")).length;U--;)P=new RegExp("\\."+F[U]+"(?![a-zA-Z\\-]+)","i"),R=R.replace(P,"");return R.length===0}function X(x,R){var P;if(x.getElementById&&(P=x.getElementById(R)),P)return P;var U,W,F,L=x.getElementsByTagName("*");for(W=0,F=L.length;W<F;W++)if(R===(U=L[W]).getAttribute("id"))return U}s.svgValidTagNamesRegEx=T(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),s.svgViewBoxElementsRegEx=T(["symbol","image","marker","pattern","view","svg"]),s.svgInvalidAncestorsRegEx=T(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),s.svgValidParentsRegEx=T(["symbol","g","a","svg","clipPath","defs"]),s.cssRules={},s.gradientDefs={},s.clipPaths={},s.parseTransformAttribute=function(){function x(B,G,Y){B[Y]=Math.tan(s.util.degreesToRadians(G[0]))}var R=s.iMatrix,P=s.reNum,U=s.commaWsp,W="(?:(?:(matrix)\\s*\\(\\s*("+P+")"+U+"("+P+")"+U+"("+P+")"+U+"("+P+")"+U+"("+P+")"+U+"("+P+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+P+")(?:"+U+"("+P+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+P+")(?:"+U+"("+P+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+P+")(?:"+U+"("+P+")"+U+"("+P+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+P+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+P+")\\s*\\)))",F=new RegExp("^\\s*(?:(?:"+W+"(?:"+U+"*"+W+")*)?)\\s*$"),L=new RegExp(W,"g");return function(B){var G=R.concat(),Y=[];if(!B||B&&!F.test(B))return G;B.replace(L,function(ie){var ne=new RegExp(W).exec(ie).filter(function(oe){return!!oe}),re=ne[1],se=ne.slice(2).map(parseFloat);switch(re){case"translate":(function(oe,ae){oe[4]=ae[0],ae.length===2&&(oe[5]=ae[1])})(G,se);break;case"rotate":se[0]=s.util.degreesToRadians(se[0]),function(oe,ae){var ge=s.util.cos(ae[0]),de=s.util.sin(ae[0]),xe=0,ke=0;ae.length===3&&(xe=ae[1],ke=ae[2]),oe[0]=ge,oe[1]=de,oe[2]=-de,oe[3]=ge,oe[4]=xe-(ge*xe-de*ke),oe[5]=ke-(de*xe+ge*ke)}(G,se);break;case"scale":(function(oe,ae){var ge=ae[0],de=ae.length===2?ae[1]:ae[0];oe[0]=ge,oe[3]=de})(G,se);break;case"skewX":x(G,se,2);break;case"skewY":x(G,se,1);break;case"matrix":G=se}Y.push(G.concat()),G=R.concat()});for(var q=Y[0];Y.length>1;)Y.shift(),q=s.util.multiplyTransformMatrices(q,Y[0]);return q}}();var K=new RegExp("^\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*,?\\s*("+s.reNum+"+)\\s*$");function ee(x){if(!s.svgViewBoxElementsRegEx.test(x.nodeName))return{};var R,P,U,W,F,L,B=x.getAttribute("viewBox"),G=1,Y=1,q=x.getAttribute("width"),ie=x.getAttribute("height"),ne=x.getAttribute("x")||0,re=x.getAttribute("y")||0,se=x.getAttribute("preserveAspectRatio")||"",oe=!B||!(B=B.match(K)),ae=!q||!ie||q==="100%"||ie==="100%",ge=oe&&ae,de={},xe="",ke=0,pt=0;if(de.width=0,de.height=0,de.toBeParsed=ge,oe&&(ne||re)&&x.parentNode&&x.parentNode.nodeName!=="#document"&&(xe=" translate("+n(ne)+" "+n(re)+") ",F=(x.getAttribute("transform")||"")+xe,x.setAttribute("transform",F),x.removeAttribute("x"),x.removeAttribute("y")),ge)return de;if(oe)return de.width=n(q),de.height=n(ie),de;if(R=-parseFloat(B[1]),P=-parseFloat(B[2]),U=parseFloat(B[3]),W=parseFloat(B[4]),de.minX=R,de.minY=P,de.viewBoxWidth=U,de.viewBoxHeight=W,ae?(de.width=U,de.height=W):(de.width=n(q),de.height=n(ie),G=de.width/U,Y=de.height/W),(se=s.util.parsePreserveAspectRatioAttribute(se)).alignX!=="none"&&(se.meetOrSlice==="meet"&&(Y=G=G>Y?Y:G),se.meetOrSlice==="slice"&&(Y=G=G>Y?G:Y),ke=de.width-U*G,pt=de.height-W*G,se.alignX==="Mid"&&(ke/=2),se.alignY==="Mid"&&(pt/=2),se.alignX==="Min"&&(ke=0),se.alignY==="Min"&&(pt=0)),G===1&&Y===1&&R===0&&P===0&&ne===0&&re===0)return de;if((ne||re)&&x.parentNode.nodeName!=="#document"&&(xe=" translate("+n(ne)+" "+n(re)+") "),F=xe+" matrix("+G+" 0 0 "+Y+" "+(R*G+ke)+" "+(P*Y+pt)+") ",x.nodeName==="svg"){for(L=x.ownerDocument.createElementNS(s.svgNS,"g");x.firstChild;)L.appendChild(x.firstChild);x.appendChild(L)}else(L=x).removeAttribute("x"),L.removeAttribute("y"),F=L.getAttribute("transform")+F;return L.setAttribute("transform",F),de}function Q(x,R){var P="xlink:href",U=X(x,R.getAttribute(P).slice(1));if(U&&U.getAttribute(P)&&Q(x,U),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(F){U&&!R.hasAttribute(F)&&U.hasAttribute(F)&&R.setAttribute(F,U.getAttribute(F))}),!R.children.length)for(var W=U.cloneNode(!0);W.firstChild;)R.appendChild(W.firstChild);R.removeAttribute(P)}s.parseSVGDocument=function(x,R,P,U){if(x){(function(ne){for(var re=S(ne,["use","svg:use"]),se=0;re.length&&se<re.length;){var oe=re[se],ae=oe.getAttribute("xlink:href")||oe.getAttribute("href");if(ae===null)return;var ge,de,xe,ke,pt=ae.slice(1),Qe=oe.getAttribute("x")||0,lt=oe.getAttribute("y")||0,Ke=X(ne,pt).cloneNode(!0),Ft=(Ke.getAttribute("transform")||"")+" translate("+Qe+", "+lt+")",Fr=re.length,sr=s.svgNS;if(ee(Ke),/^svg$/i.test(Ke.nodeName)){var Bi=Ke.ownerDocument.createElementNS(sr,"g");for(de=0,ke=(xe=Ke.attributes).length;de<ke;de++)ge=xe.item(de),Bi.setAttributeNS(sr,ge.nodeName,ge.nodeValue);for(;Ke.firstChild;)Bi.appendChild(Ke.firstChild);Ke=Bi}for(de=0,ke=(xe=oe.attributes).length;de<ke;de++)(ge=xe.item(de)).nodeName!=="x"&&ge.nodeName!=="y"&&ge.nodeName!=="xlink:href"&&ge.nodeName!=="href"&&(ge.nodeName==="transform"?Ft=ge.nodeValue+" "+Ft:Ke.setAttribute(ge.nodeName,ge.nodeValue));Ke.setAttribute("transform",Ft),Ke.setAttribute("instantiated_by_use","1"),Ke.removeAttribute("id"),oe.parentNode.replaceChild(Ke,oe),re.length===Fr&&se++}})(x);var W,F,L=s.Object.__uid++,B=ee(x),G=s.util.toArray(x.getElementsByTagName("*"));if(B.crossOrigin=U&&U.crossOrigin,B.svgUid=L,G.length===0&&s.isLikelyNode){var Y=[];for(W=0,F=(G=x.selectNodes('//*[name(.)!="svg"]')).length;W<F;W++)Y[W]=G[W];G=Y}var q=G.filter(function(ne){return ee(ne),s.svgValidTagNamesRegEx.test(ne.nodeName.replace("svg:",""))&&!function(re,se){for(;re&&(re=re.parentNode);)if(re.nodeName&&se.test(re.nodeName.replace("svg:",""))&&!re.getAttribute("instantiated_by_use"))return!0;return!1}(ne,s.svgInvalidAncestorsRegEx)});if(!q||q&&!q.length)R&&R([],{});else{var ie={};G.filter(function(ne){return ne.nodeName.replace("svg:","")==="clipPath"}).forEach(function(ne){var re=ne.getAttribute("id");ie[re]=s.util.toArray(ne.getElementsByTagName("*")).filter(function(se){return s.svgValidTagNamesRegEx.test(se.nodeName.replace("svg:",""))})}),s.gradientDefs[L]=s.getGradientDefs(x),s.cssRules[L]=s.getCSSRules(x),s.clipPaths[L]=ie,s.parseElements(q,function(ne,re){R&&(R(ne,B,re,G),delete s.gradientDefs[L],delete s.cssRules[L],delete s.clipPaths[L])},c(B),P,U)}}};var A=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+s.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+s.reNum+"))?\\s+(.*)");o(s,{parseFontDeclaration:function(x,R){var P=x.match(A);if(P){var U=P[1],W=P[3],F=P[4],L=P[5],B=P[6];U&&(R.fontStyle=U),W&&(R.fontWeight=isNaN(parseFloat(W))?W:parseFloat(W)),F&&(R.fontSize=n(F)),B&&(R.fontFamily=B),L&&(R.lineHeight=L==="normal"?1:L)}},getGradientDefs:function(x){var R,P=S(x,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),U=0,W={};for(U=P.length;U--;)(R=P[U]).getAttribute("xlink:href")&&Q(x,R),W[R.getAttribute("id")]=R;return W},parseAttributes:function(x,R,P){if(x){var U,W,F,L={};P===void 0&&(P=x.getAttribute("svgUid")),x.parentNode&&s.svgValidParentsRegEx.test(x.parentNode.nodeName)&&(L=s.parseAttributes(x.parentNode,R,P));var B=R.reduce(function(se,oe){return(U=x.getAttribute(oe))&&(se[oe]=U),se},{}),G=o(function(se,oe){var ae={};for(var ge in s.cssRules[oe])if(D(se,ge.split(" ")))for(var de in s.cssRules[oe][ge])ae[de]=s.cssRules[oe][ge][de];return ae}(x,P),s.parseStyleAttribute(x));B=o(B,G),G[m]&&x.setAttribute(m,G[m]),W=F=L.fontSize||s.Text.DEFAULT_SVG_FONT_SIZE,B[f]&&(B[f]=W=n(B[f],F));var Y,q,ie={};for(var ne in B)q=w(Y=y(ne),B[ne],L,W),ie[Y]=q;ie&&ie.font&&s.parseFontDeclaration(ie.font,ie);var re=o(L,ie);return s.svgValidParentsRegEx.test(x.nodeName)?re:function(se){for(var oe in u)if(se[u[oe]]!==void 0&&se[oe]!==""){if(se[oe]===void 0){if(!s.Object.prototype[oe])continue;se[oe]=s.Object.prototype[oe]}if(se[oe].indexOf("url(")!==0){var ae=new s.Color(se[oe]);se[oe]=ae.setAlpha(i(ae.getAlpha()*se[u[oe]],2)).toRgba()}}return se}(re)}},parseElements:function(x,R,P,U,W){new s.ElementsParser(x,R,P,U,W).parse()},parseStyleAttribute:function(x){var R={},P=x.getAttribute("style");return P&&(typeof P=="string"?function(U,W){var F,L;U.replace(/;\s*$/,"").split(";").forEach(function(B){var G=B.split(":");F=G[0].trim().toLowerCase(),L=G[1].trim(),W[F]=L})}(P,R):function(U,W){var F,L;for(var B in U)U[B]!==void 0&&(F=B.toLowerCase(),L=U[B],W[F]=L)}(P,R)),R},parsePointsAttribute:function(x){if(!x)return null;var R,P,U=[];for(R=0,P=(x=(x=x.replace(/,/g," ").trim()).split(/\s+/)).length;R<P;R+=2)U.push({x:parseFloat(x[R]),y:parseFloat(x[R+1])});return U},getCSSRules:function(x){var R,P,U=x.getElementsByTagName("style"),W={};for(R=0,P=U.length;R<P;R++){var F=U[R].textContent;(F=F.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&F.split("}").filter(function(L){return L.trim()}).forEach(function(L){var B=L.split("{"),G={},Y=B[1].trim().split(";").filter(function(re){return re.trim()});for(R=0,P=Y.length;R<P;R++){var q=Y[R].split(":"),ie=q[0].trim(),ne=q[1].trim();G[ie]=ne}(L=B[0].trim()).split(",").forEach(function(re){(re=re.replace(/^svg/i,"").trim())!==""&&(W[re]?s.util.object.extend(W[re],G):W[re]=s.util.object.clone(G))})})}return W},loadSVGFromURL:function(x,R,P,U){x=x.replace(/^\n\s*/,"").trim(),new s.util.request(x,{method:"get",onComplete:function(W){var F=W.responseXML;if(!F||!F.documentElement)return R&&R(null),!1;s.parseSVGDocument(F.documentElement,function(L,B,G,Y){R&&R(L,B,G,Y)},P,U)}})},loadSVGFromString:function(x,R,P,U){var W=new s.window.DOMParser().parseFromString(x.trim(),"text/xml");s.parseSVGDocument(W.documentElement,function(F,L,B,G){R(F,L,B,G)},P,U)}})}(e),v.ElementsParser=function(l,s,o,c,i,n){this.elements=l,this.callback=s,this.options=o,this.reviver=c,this.svgUid=o&&o.svgUid||0,this.parsingOptions=i,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=n},(Z=v.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},Z.createObjects=function(){var l=this;this.elements.forEach(function(s,o){s.setAttribute("svgUid",l.svgUid),l.createObject(s,o)})},Z.findTag=function(l){return v[v.util.string.capitalize(l.tagName.replace("svg:",""))]},Z.createObject=function(l,s){var o=this.findTag(l);if(o&&o.fromElement)try{o.fromElement(l,this.createCallback(s,l),this.options)}catch(c){v.log(c)}else this.checkIfDone()},Z.createCallback=function(l,s){var o=this;return function(c){var i;o.resolveGradient(c,s,"fill"),o.resolveGradient(c,s,"stroke"),c instanceof v.Image&&c._originalElement&&(i=c.parsePreserveAspectRatioAttribute(s)),c._removeTransformMatrix(i),o.resolveClipPath(c,s),o.reviver&&o.reviver(s,c),o.instances[l]=c,o.checkIfDone()}},Z.extractPropertyDefinition=function(l,s,o){var c=l[s],i=this.regexUrl;if(i.test(c)){i.lastIndex=0;var n=i.exec(c)[1];return i.lastIndex=0,v[o][this.svgUid][n]}},Z.resolveGradient=function(l,s,o){var c=this.extractPropertyDefinition(l,o,"gradientDefs");if(c){var i=s.getAttribute(o+"-opacity"),n=v.Gradient.fromElement(c,l,i,this.options);l.set(o,n)}},Z.createClipPathCallback=function(l,s){return function(o){o._removeTransformMatrix(),o.fillRule=o.clipRule,s.push(o)}},Z.resolveClipPath=function(l,s){var o,c,i,n,h=this.extractPropertyDefinition(l,"clipPath","clipPaths");if(h){i=[],c=v.util.invertTransform(l.calcTransformMatrix());for(var g=h[0].parentNode,u=s;u.parentNode&&u.getAttribute("clip-path")!==l.clipPath;)u=u.parentNode;u.parentNode.appendChild(g);for(var f=0;f<h.length;f++)o=h[f],this.findTag(o).fromElement(o,this.createClipPathCallback(l,i),this.options);h=i.length===1?i[0]:new v.Group(i),n=v.util.multiplyTransformMatrices(c,h.calcTransformMatrix()),h.clipPath&&this.resolveClipPath(h,u);var m=v.util.qrDecompose(n);h.flipX=!1,h.flipY=!1,h.set("scaleX",m.scaleX),h.set("scaleY",m.scaleY),h.angle=m.angle,h.skewX=m.skewX,h.skewY=0,h.setPositionByOrigin({x:m.translateX,y:m.translateY},"center","center"),l.clipPath=h}else delete l.clipPath},Z.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(l){return l!=null}),this.callback(this.instances,this.elements))},function(l){var s=l.fabric||(l.fabric={});function o(c,i){this.x=c,this.y=i}s.Point?s.warn("fabric.Point is already defined"):(s.Point=o,o.prototype={type:"point",constructor:o,add:function(c){return new o(this.x+c.x,this.y+c.y)},addEquals:function(c){return this.x+=c.x,this.y+=c.y,this},scalarAdd:function(c){return new o(this.x+c,this.y+c)},scalarAddEquals:function(c){return this.x+=c,this.y+=c,this},subtract:function(c){return new o(this.x-c.x,this.y-c.y)},subtractEquals:function(c){return this.x-=c.x,this.y-=c.y,this},scalarSubtract:function(c){return new o(this.x-c,this.y-c)},scalarSubtractEquals:function(c){return this.x-=c,this.y-=c,this},multiply:function(c){return new o(this.x*c,this.y*c)},multiplyEquals:function(c){return this.x*=c,this.y*=c,this},divide:function(c){return new o(this.x/c,this.y/c)},divideEquals:function(c){return this.x/=c,this.y/=c,this},eq:function(c){return this.x===c.x&&this.y===c.y},lt:function(c){return this.x<c.x&&this.y<c.y},lte:function(c){return this.x<=c.x&&this.y<=c.y},gt:function(c){return this.x>c.x&&this.y>c.y},gte:function(c){return this.x>=c.x&&this.y>=c.y},lerp:function(c,i){return i===void 0&&(i=.5),i=Math.max(Math.min(1,i),0),new o(this.x+(c.x-this.x)*i,this.y+(c.y-this.y)*i)},distanceFrom:function(c){var i=this.x-c.x,n=this.y-c.y;return Math.sqrt(i*i+n*n)},midPointFrom:function(c){return this.lerp(c)},min:function(c){return new o(Math.min(this.x,c.x),Math.min(this.y,c.y))},max:function(c){return new o(Math.max(this.x,c.x),Math.max(this.y,c.y))},toString:function(){return this.x+","+this.y},setXY:function(c,i){return this.x=c,this.y=i,this},setX:function(c){return this.x=c,this},setY:function(c){return this.y=c,this},setFromPoint:function(c){return this.x=c.x,this.y=c.y,this},swap:function(c){var i=this.x,n=this.y;this.x=c.x,this.y=c.y,c.x=i,c.y=n},clone:function(){return new o(this.x,this.y)}})}(e),function(l){var s=l.fabric||(l.fabric={});function o(c){this.status=c,this.points=[]}s.Intersection?s.warn("fabric.Intersection is already defined"):(s.Intersection=o,s.Intersection.prototype={constructor:o,appendPoint:function(c){return this.points.push(c),this},appendPoints:function(c){return this.points=this.points.concat(c),this}},s.Intersection.intersectLineLine=function(c,i,n,h){var g,u=(h.x-n.x)*(c.y-n.y)-(h.y-n.y)*(c.x-n.x),f=(i.x-c.x)*(c.y-n.y)-(i.y-c.y)*(c.x-n.x),m=(h.y-n.y)*(i.x-c.x)-(h.x-n.x)*(i.y-c.y);if(m!==0){var y=u/m,w=f/m;0<=y&&y<=1&&0<=w&&w<=1?(g=new o("Intersection")).appendPoint(new s.Point(c.x+y*(i.x-c.x),c.y+y*(i.y-c.y))):g=new o}else g=new o(u===0||f===0?"Coincident":"Parallel");return g},s.Intersection.intersectLinePolygon=function(c,i,n){var h,g,u,f,m=new o,y=n.length;for(f=0;f<y;f++)h=n[f],g=n[(f+1)%y],u=o.intersectLineLine(c,i,h,g),m.appendPoints(u.points);return m.points.length>0&&(m.status="Intersection"),m},s.Intersection.intersectPolygonPolygon=function(c,i){var n,h=new o,g=c.length;for(n=0;n<g;n++){var u=c[n],f=c[(n+1)%g],m=o.intersectLinePolygon(u,f,i);h.appendPoints(m.points)}return h.points.length>0&&(h.status="Intersection"),h},s.Intersection.intersectPolygonRectangle=function(c,i,n){var h=i.min(n),g=i.max(n),u=new s.Point(g.x,h.y),f=new s.Point(h.x,g.y),m=o.intersectLinePolygon(h,u,c),y=o.intersectLinePolygon(u,g,c),w=o.intersectLinePolygon(g,f,c),T=o.intersectLinePolygon(f,h,c),S=new o;return S.appendPoints(m.points),S.appendPoints(y.points),S.appendPoints(w.points),S.appendPoints(T.points),S.points.length>0&&(S.status="Intersection"),S})}(e),function(l){var s=l.fabric||(l.fabric={});function o(i){i?this._tryParsingColor(i):this.setSource([0,0,0,1])}function c(i,n,h){return h<0&&(h+=1),h>1&&(h-=1),h<1/6?i+6*(n-i)*h:h<.5?n:h<2/3?i+(n-i)*(2/3-h)*6:i}s.Color?s.warn("fabric.Color is already defined."):(s.Color=o,s.Color.prototype={_tryParsingColor:function(i){var n;i in o.colorNameMap&&(i=o.colorNameMap[i]),i==="transparent"&&(n=[255,255,255,0]),n||(n=o.sourceFromHex(i)),n||(n=o.sourceFromRgb(i)),n||(n=o.sourceFromHsl(i)),n||(n=[0,0,0,1]),n&&this.setSource(n)},_rgbToHsl:function(i,n,h){i/=255,n/=255,h/=255;var g,u,f,m=s.util.array.max([i,n,h]),y=s.util.array.min([i,n,h]);if(f=(m+y)/2,m===y)g=u=0;else{var w=m-y;switch(u=f>.5?w/(2-m-y):w/(m+y),m){case i:g=(n-h)/w+(n<h?6:0);break;case n:g=(h-i)/w+2;break;case h:g=(i-n)/w+4}g/=6}return[Math.round(360*g),Math.round(100*u),Math.round(100*f)]},getSource:function(){return this._source},setSource:function(i){this._source=i},toRgb:function(){var i=this.getSource();return"rgb("+i[0]+","+i[1]+","+i[2]+")"},toRgba:function(){var i=this.getSource();return"rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")"},toHsl:function(){var i=this.getSource(),n=this._rgbToHsl(i[0],i[1],i[2]);return"hsl("+n[0]+","+n[1]+"%,"+n[2]+"%)"},toHsla:function(){var i=this.getSource(),n=this._rgbToHsl(i[0],i[1],i[2]);return"hsla("+n[0]+","+n[1]+"%,"+n[2]+"%,"+i[3]+")"},toHex:function(){var i,n,h,g=this.getSource();return i=(i=g[0].toString(16)).length===1?"0"+i:i,n=(n=g[1].toString(16)).length===1?"0"+n:n,h=(h=g[2].toString(16)).length===1?"0"+h:h,i.toUpperCase()+n.toUpperCase()+h.toUpperCase()},toHexa:function(){var i,n=this.getSource();return i=(i=(i=Math.round(255*n[3])).toString(16)).length===1?"0"+i:i,this.toHex()+i.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(i){var n=this.getSource();return n[3]=i,this.setSource(n),this},toGrayscale:function(){var i=this.getSource(),n=parseInt((.3*i[0]+.59*i[1]+.11*i[2]).toFixed(0),10),h=i[3];return this.setSource([n,n,n,h]),this},toBlackWhite:function(i){var n=this.getSource(),h=(.3*n[0]+.59*n[1]+.11*n[2]).toFixed(0),g=n[3];return i=i||127,h=Number(h)<Number(i)?0:255,this.setSource([h,h,h,g]),this},overlayWith:function(i){i instanceof o||(i=new o(i));var n,h=[],g=this.getAlpha(),u=this.getSource(),f=i.getSource();for(n=0;n<3;n++)h.push(Math.round(.5*u[n]+.5*f[n]));return h[3]=g,this.setSource(h),this}},s.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,s.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,s.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,s.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},s.Color.fromRgb=function(i){return o.fromSource(o.sourceFromRgb(i))},s.Color.sourceFromRgb=function(i){var n=i.match(o.reRGBa);if(n){var h=parseInt(n[1],10)/(/%$/.test(n[1])?100:1)*(/%$/.test(n[1])?255:1),g=parseInt(n[2],10)/(/%$/.test(n[2])?100:1)*(/%$/.test(n[2])?255:1),u=parseInt(n[3],10)/(/%$/.test(n[3])?100:1)*(/%$/.test(n[3])?255:1);return[parseInt(h,10),parseInt(g,10),parseInt(u,10),n[4]?parseFloat(n[4]):1]}},s.Color.fromRgba=o.fromRgb,s.Color.fromHsl=function(i){return o.fromSource(o.sourceFromHsl(i))},s.Color.sourceFromHsl=function(i){var n=i.match(o.reHSLa);if(n){var h,g,u,f=(parseFloat(n[1])%360+360)%360/360,m=parseFloat(n[2])/(/%$/.test(n[2])?100:1),y=parseFloat(n[3])/(/%$/.test(n[3])?100:1);if(m===0)h=g=u=y;else{var w=y<=.5?y*(m+1):y+m-y*m,T=2*y-w;h=c(T,w,f+1/3),g=c(T,w,f),u=c(T,w,f-1/3)}return[Math.round(255*h),Math.round(255*g),Math.round(255*u),n[4]?parseFloat(n[4]):1]}},s.Color.fromHsla=o.fromHsl,s.Color.fromHex=function(i){return o.fromSource(o.sourceFromHex(i))},s.Color.sourceFromHex=function(i){if(i.match(o.reHex)){var n=i.slice(i.indexOf("#")+1),h=n.length===3||n.length===4,g=n.length===8||n.length===4,u=h?n.charAt(0)+n.charAt(0):n.substring(0,2),f=h?n.charAt(1)+n.charAt(1):n.substring(2,4),m=h?n.charAt(2)+n.charAt(2):n.substring(4,6),y=g?h?n.charAt(3)+n.charAt(3):n.substring(6,8):"FF";return[parseInt(u,16),parseInt(f,16),parseInt(m,16),parseFloat((parseInt(y,16)/255).toFixed(2))]}},s.Color.fromSource=function(i){var n=new o;return n.setSource(i),n})}(e),function(l){var s=l.fabric||(l.fabric={}),o=["e","se","s","sw","w","nw","n","ne","e"],c=["ns","nesw","ew","nwse"],i={},n="left",h="top",g="right",u="bottom",f="center",m={top:u,bottom:h,left:g,right:n,center:f},y=s.util.radiansToDegrees,w=Math.sign||function(F){return(F>0)-(F<0)||+F};function T(F,L){var B=F.angle+y(Math.atan2(L.y,L.x))+360;return Math.round(B%360/45)}function S(F,L){var B=L.transform.target,G=B.canvas,Y=s.util.object.clone(L);Y.target=B,G&&G.fire("object:"+F,Y),B.fire(F,L)}function D(F,L){var B=L.canvas,G=F[B.uniScaleKey];return B.uniformScaling&&!G||!B.uniformScaling&&G}function N(F){return F.originX===f&&F.originY===f}function X(F,L,B){var G=F.lockScalingX,Y=F.lockScalingY;return!((!G||!Y)&&(L||!G&&!Y||!B)&&(!G||L!=="x")&&(!Y||L!=="y"))}function K(F,L,B,G){return{e:F,transform:L,pointer:{x:B,y:G}}}function ee(F){return function(L,B,G,Y){var q=B.target,ie=q.getCenterPoint(),ne=q.translateToOriginPoint(ie,B.originX,B.originY),re=F(L,B,G,Y);return q.setPositionByOrigin(ne,B.originX,B.originY),re}}function Q(F,L){return function(B,G,Y,q){var ie=L(B,G,Y,q);return ie&&S(F,K(B,G,Y,q)),ie}}function A(F,L,B,G,Y){var q=F.target,ie=q.controls[F.corner],ne=q.canvas.getZoom(),re=q.padding/ne,se=q.toLocalPoint(new s.Point(G,Y),L,B);return se.x>=re&&(se.x-=re),se.x<=-re&&(se.x+=re),se.y>=re&&(se.y-=re),se.y<=re&&(se.y+=re),se.x-=ie.offsetX,se.y-=ie.offsetY,se}function x(F){return F.flipX!==F.flipY}function R(F,L,B,G,Y){if(F[L]!==0){var q=Y/F._getTransformedDimensions()[G]*F[B];F.set(B,q)}}function P(F,L,B,G){var Y,q=L.target,ie=q._getTransformedDimensions(0,q.skewY),ne=A(L,L.originX,L.originY,B,G),re=Math.abs(2*ne.x)-ie.x,se=q.skewX;re<2?Y=0:(Y=y(Math.atan2(re/q.scaleX,ie.y/q.scaleY)),L.originX===n&&L.originY===u&&(Y=-Y),L.originX===g&&L.originY===h&&(Y=-Y),x(q)&&(Y=-Y));var oe=se!==Y;if(oe){var ae=q._getTransformedDimensions().y;q.set("skewX",Y),R(q,"skewY","scaleY","y",ae)}return oe}function U(F,L,B,G){var Y,q=L.target,ie=q._getTransformedDimensions(q.skewX,0),ne=A(L,L.originX,L.originY,B,G),re=Math.abs(2*ne.y)-ie.y,se=q.skewY;re<2?Y=0:(Y=y(Math.atan2(re/q.scaleY,ie.x/q.scaleX)),L.originX===n&&L.originY===u&&(Y=-Y),L.originX===g&&L.originY===h&&(Y=-Y),x(q)&&(Y=-Y));var oe=se!==Y;if(oe){var ae=q._getTransformedDimensions().x;q.set("skewY",Y),R(q,"skewX","scaleX","x",ae)}return oe}function W(F,L,B,G,Y){Y=Y||{};var q,ie,ne,re,se,oe,ae=L.target,ge=ae.lockScalingX,de=ae.lockScalingY,xe=Y.by,ke=D(F,ae),pt=X(ae,xe,ke),Qe=L.gestureScale;if(pt)return!1;if(Qe)ie=L.scaleX*Qe,ne=L.scaleY*Qe;else{if(q=A(L,L.originX,L.originY,B,G),se=xe!=="y"?w(q.x):1,oe=xe!=="x"?w(q.y):1,L.signX||(L.signX=se),L.signY||(L.signY=oe),ae.lockScalingFlip&&(L.signX!==se||L.signY!==oe))return!1;if(re=ae._getTransformedDimensions(),ke&&!xe){var lt=Math.abs(q.x)+Math.abs(q.y),Ke=L.original,Ft=lt/(Math.abs(re.x*Ke.scaleX/ae.scaleX)+Math.abs(re.y*Ke.scaleY/ae.scaleY));ie=Ke.scaleX*Ft,ne=Ke.scaleY*Ft}else ie=Math.abs(q.x*ae.scaleX/re.x),ne=Math.abs(q.y*ae.scaleY/re.y);N(L)&&(ie*=2,ne*=2),L.signX!==se&&xe!=="y"&&(L.originX=m[L.originX],ie*=-1,L.signX=se),L.signY!==oe&&xe!=="x"&&(L.originY=m[L.originY],ne*=-1,L.signY=oe)}var Fr=ae.scaleX,sr=ae.scaleY;return xe?(xe==="x"&&ae.set("scaleX",ie),xe==="y"&&ae.set("scaleY",ne)):(!ge&&ae.set("scaleX",ie),!de&&ae.set("scaleY",ne)),Fr!==ae.scaleX||sr!==ae.scaleY}i.scaleCursorStyleHandler=function(F,L,B){var G=D(F,B),Y="";if(L.x!==0&&L.y===0?Y="x":L.x===0&&L.y!==0&&(Y="y"),X(B,Y,G))return"not-allowed";var q=T(B,L);return o[q]+"-resize"},i.skewCursorStyleHandler=function(F,L,B){var G="not-allowed";if(L.x!==0&&B.lockSkewingY||L.y!==0&&B.lockSkewingX)return G;var Y=T(B,L)%4;return c[Y]+"-resize"},i.scaleSkewCursorStyleHandler=function(F,L,B){return F[B.canvas.altActionKey]?i.skewCursorStyleHandler(F,L,B):i.scaleCursorStyleHandler(F,L,B)},i.rotationWithSnapping=Q("rotating",ee(function(F,L,B,G){var Y=L,q=Y.target,ie=q.translateToOriginPoint(q.getCenterPoint(),Y.originX,Y.originY);if(q.lockRotation)return!1;var ne,re=Math.atan2(Y.ey-ie.y,Y.ex-ie.x),se=Math.atan2(G-ie.y,B-ie.x),oe=y(se-re+Y.theta);if(q.snapAngle>0){var ae=q.snapAngle,ge=q.snapThreshold||ae,de=Math.ceil(oe/ae)*ae,xe=Math.floor(oe/ae)*ae;Math.abs(oe-xe)<ge?oe=xe:Math.abs(oe-de)<ge&&(oe=de)}return oe<0&&(oe=360+oe),oe%=360,ne=q.angle!==oe,q.angle=oe,ne})),i.scalingEqually=Q("scaling",ee(function(F,L,B,G){return W(F,L,B,G)})),i.scalingX=Q("scaling",ee(function(F,L,B,G){return W(F,L,B,G,{by:"x"})})),i.scalingY=Q("scaling",ee(function(F,L,B,G){return W(F,L,B,G,{by:"y"})})),i.scalingYOrSkewingX=function(F,L,B,G){return F[L.target.canvas.altActionKey]?i.skewHandlerX(F,L,B,G):i.scalingY(F,L,B,G)},i.scalingXOrSkewingY=function(F,L,B,G){return F[L.target.canvas.altActionKey]?i.skewHandlerY(F,L,B,G):i.scalingX(F,L,B,G)},i.changeWidth=Q("resizing",ee(function(F,L,B,G){var Y=L.target,q=A(L,L.originX,L.originY,B,G),ie=Y.strokeWidth/(Y.strokeUniform?Y.scaleX:1),ne=N(L)?2:1,re=Y.width,se=Math.abs(q.x*ne/Y.scaleX)-ie;return Y.set("width",Math.max(se,0)),re!==se})),i.skewHandlerX=function(F,L,B,G){var Y,q=L.target,ie=q.skewX,ne=L.originY;return!q.lockSkewingX&&(ie===0?Y=A(L,f,f,B,G).x>0?n:g:(ie>0&&(Y=ne===h?n:g),ie<0&&(Y=ne===h?g:n),x(q)&&(Y=Y===n?g:n)),L.originX=Y,Q("skewing",ee(P))(F,L,B,G))},i.skewHandlerY=function(F,L,B,G){var Y,q=L.target,ie=q.skewY,ne=L.originX;return!q.lockSkewingY&&(ie===0?Y=A(L,f,f,B,G).y>0?h:u:(ie>0&&(Y=ne===n?h:u),ie<0&&(Y=ne===n?u:h),x(q)&&(Y=Y===h?u:h)),L.originY=Y,Q("skewing",ee(U))(F,L,B,G))},i.dragHandler=function(F,L,B,G){var Y=L.target,q=B-L.offsetX,ie=G-L.offsetY,ne=!Y.get("lockMovementX")&&Y.left!==q,re=!Y.get("lockMovementY")&&Y.top!==ie;return ne&&Y.set("left",q),re&&Y.set("top",ie),(ne||re)&&S("moving",K(F,L,B,G)),ne||re},i.scaleOrSkewActionName=function(F,L,B){var G=F[B.canvas.altActionKey];return L.x===0?G?"skewX":"scaleY":L.y===0?G?"skewY":"scaleX":void 0},i.rotationStyleHandler=function(F,L,B){return B.lockRotation?"not-allowed":L.cursorStyle},i.fireEvent=S,i.wrapWithFixedAnchor=ee,i.wrapWithFireEvent=Q,i.getLocalPoint=A,s.controlsUtils=i}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.degreesToRadians,c=s.controlsUtils;c.renderCircleControl=function(i,n,h,g,u){g=g||{};var f,m=this.sizeX||g.cornerSize||u.cornerSize,y=this.sizeY||g.cornerSize||u.cornerSize,w=g.transparentCorners!==void 0?g.transparentCorners:u.transparentCorners,T=w?"stroke":"fill",S=!w&&(g.cornerStrokeColor||u.cornerStrokeColor),D=n,N=h;i.save(),i.fillStyle=g.cornerColor||u.cornerColor,i.strokeStyle=g.cornerStrokeColor||u.cornerStrokeColor,m>y?(f=m,i.scale(1,y/m),N=h*m/y):y>m?(f=y,i.scale(m/y,1),D=n*y/m):f=m,i.lineWidth=1,i.beginPath(),i.arc(D,N,f/2,0,2*Math.PI,!1),i[T](),S&&i.stroke(),i.restore()},c.renderSquareControl=function(i,n,h,g,u){g=g||{};var f=this.sizeX||g.cornerSize||u.cornerSize,m=this.sizeY||g.cornerSize||u.cornerSize,y=g.transparentCorners!==void 0?g.transparentCorners:u.transparentCorners,w=y?"stroke":"fill",T=!y&&(g.cornerStrokeColor||u.cornerStrokeColor),S=f/2,D=m/2;i.save(),i.fillStyle=g.cornerColor||u.cornerColor,i.strokeStyle=g.cornerStrokeColor||u.cornerStrokeColor,i.lineWidth=1,i.translate(n,h),i.rotate(o(u.angle)),i[w+"Rect"](-S,-D,f,m),T&&i.strokeRect(-S,-D,f,m),i.restore()}}(e),function(l){var s=l.fabric||(l.fabric={});s.Control=function(o){for(var c in o)this[c]=o[c]},s.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(o,c){return c.cursorStyle},getActionName:function(o,c){return c.actionName},getVisibility:function(o,c){var i=o._controlsVisibility;return i&&i[c]!==void 0?i[c]:this.visible},setVisibility:function(o){this.visible=o},positionHandler:function(o,c){return s.util.transformPoint({x:this.x*o.x+this.offsetX,y:this.y*o.y+this.offsetY},c)},calcCornerCoords:function(o,c,i,n,h){var g,u,f,m,y=h?this.touchSizeX:this.sizeX,w=h?this.touchSizeY:this.sizeY;if(y&&w&&y!==w){var T=Math.atan2(w,y),S=Math.sqrt(y*y+w*w)/2,D=T-s.util.degreesToRadians(o),N=Math.PI/2-T-s.util.degreesToRadians(o);g=S*s.util.cos(D),u=S*s.util.sin(D),f=S*s.util.cos(N),m=S*s.util.sin(N)}else S=.7071067812*(y&&w?y:c),D=s.util.degreesToRadians(45-o),g=f=S*s.util.cos(D),u=m=S*s.util.sin(D);return{tl:{x:i-m,y:n-f},tr:{x:i+g,y:n-u},bl:{x:i-g,y:n+u},br:{x:i+m,y:n+f}}},render:function(o,c,i,n,h){((n=n||{}).cornerStyle||h.cornerStyle)==="circle"?s.controlsUtils.renderCircleControl.call(this,o,c,i,n,h):s.controlsUtils.renderSquareControl.call(this,o,c,i,n,h)}}}(e),function(){function l(o,c){var i,n,h,g,u=o.getAttribute("style"),f=o.getAttribute("offset")||0;if(f=(f=parseFloat(f)/(/%$/.test(f)?100:1))<0?0:f>1?1:f,u){var m=u.split(/\s*;\s*/);for(m[m.length-1]===""&&m.pop(),g=m.length;g--;){var y=m[g].split(/\s*:\s*/),w=y[0].trim(),T=y[1].trim();w==="stop-color"?i=T:w==="stop-opacity"&&(h=T)}}return i||(i=o.getAttribute("stop-color")||"rgb(0,0,0)"),h||(h=o.getAttribute("stop-opacity")),n=(i=new v.Color(i)).getAlpha(),h=isNaN(parseFloat(h))?1:parseFloat(h),h*=n*c,{offset:f,color:i.toRgb(),opacity:h}}var s=v.util.object.clone;v.Gradient=v.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(o){o||(o={}),o.coords||(o.coords={});var c,i=this;Object.keys(o).forEach(function(n){i[n]=o[n]}),this.id?this.id+="_"+v.Object.__uid++:this.id=v.Object.__uid++,c={x1:o.coords.x1||0,y1:o.coords.y1||0,x2:o.coords.x2||0,y2:o.coords.y2||0},this.type==="radial"&&(c.r1=o.coords.r1||0,c.r2=o.coords.r2||0),this.coords=c,this.colorStops=o.colorStops.slice()},addColorStop:function(o){for(var c in o){var i=new v.Color(o[c]);this.colorStops.push({offset:parseFloat(c),color:i.toRgb(),opacity:i.getAlpha()})}return this},toObject:function(o){var c={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return v.util.populateWithProperties(this,c,o),c},toSVG:function(o,c){var i,n,h,g,u=s(this.coords,!0),f=(c=c||{},s(this.colorStops,!0)),m=u.r1>u.r2,y=this.gradientTransform?this.gradientTransform.concat():v.iMatrix.concat(),w=-this.offsetX,T=-this.offsetY,S=!!c.additionalTransform,D=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(f.sort(function(ee,Q){return ee.offset-Q.offset}),D==="objectBoundingBox"?(w/=o.width,T/=o.height):(w+=o.width/2,T+=o.height/2),o.type==="path"&&this.gradientUnits!=="percentage"&&(w-=o.pathOffset.x,T-=o.pathOffset.y),y[4]-=w,y[5]-=T,g='id="SVGID_'+this.id+'" gradientUnits="'+D+'"',g+=' gradientTransform="'+(S?c.additionalTransform+" ":"")+v.util.matrixToSVG(y)+'" ',this.type==="linear"?h=["<linearGradient ",g,' x1="',u.x1,'" y1="',u.y1,'" x2="',u.x2,'" y2="',u.y2,`">
`]:this.type==="radial"&&(h=["<radialGradient ",g,' cx="',m?u.x1:u.x2,'" cy="',m?u.y1:u.y2,'" r="',m?u.r1:u.r2,'" fx="',m?u.x2:u.x1,'" fy="',m?u.y2:u.y1,`">
`]),this.type==="radial"){if(m)for((f=f.concat()).reverse(),i=0,n=f.length;i<n;i++)f[i].offset=1-f[i].offset;var N=Math.min(u.r1,u.r2);if(N>0){var X=N/Math.max(u.r1,u.r2);for(i=0,n=f.length;i<n;i++)f[i].offset+=X*(1-f[i].offset)}}for(i=0,n=f.length;i<n;i++){var K=f[i];h.push("<stop ",'offset="',100*K.offset+"%",'" style="stop-color:',K.color,K.opacity!==void 0?";stop-opacity: "+K.opacity:";",`"/>
`)}return h.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),h.join("")},toLive:function(o){var c,i,n,h=v.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?c=o.createLinearGradient(h.x1,h.y1,h.x2,h.y2):this.type==="radial"&&(c=o.createRadialGradient(h.x1,h.y1,h.r1,h.x2,h.y2,h.r2)),i=0,n=this.colorStops.length;i<n;i++){var g=this.colorStops[i].color,u=this.colorStops[i].opacity,f=this.colorStops[i].offset;u!==void 0&&(g=new v.Color(g).setAlpha(u).toRgba()),c.addColorStop(f,g)}return c}}}),v.util.object.extend(v.Gradient,{fromElement:function(o,c,i,n){var h=parseFloat(i)/(/%$/.test(i)?100:1);h=h<0?0:h>1?1:h,isNaN(h)&&(h=1);var g,u,f,m,y=o.getElementsByTagName("stop"),w=o.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",T=o.getAttribute("gradientTransform")||"",S=[],D=0,N=0;for(o.nodeName==="linearGradient"||o.nodeName==="LINEARGRADIENT"?(g="linear",u=function(X){return{x1:X.getAttribute("x1")||0,y1:X.getAttribute("y1")||0,x2:X.getAttribute("x2")||"100%",y2:X.getAttribute("y2")||0}}(o)):(g="radial",u=function(X){return{x1:X.getAttribute("fx")||X.getAttribute("cx")||"50%",y1:X.getAttribute("fy")||X.getAttribute("cy")||"50%",r1:0,x2:X.getAttribute("cx")||"50%",y2:X.getAttribute("cy")||"50%",r2:X.getAttribute("r")||"50%"}}(o)),f=y.length;f--;)S.push(l(y[f],h));return m=v.parseTransformAttribute(T),function(X,K,ee,Q){var A,x;Object.keys(K).forEach(function(R){(A=K[R])==="Infinity"?x=1:A==="-Infinity"?x=0:(x=parseFloat(K[R],10),typeof A=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(A)&&(x*=.01,Q==="pixels"&&(R!=="x1"&&R!=="x2"&&R!=="r2"||(x*=ee.viewBoxWidth||ee.width),R!=="y1"&&R!=="y2"||(x*=ee.viewBoxHeight||ee.height)))),K[R]=x})}(0,u,n,w),w==="pixels"&&(D=-c.left,N=-c.top),new v.Gradient({id:o.getAttribute("id"),type:g,coords:u,colorStops:S,gradientUnits:w,gradientTransform:m,offsetX:D,offsetY:N})}})}(),$=v.util.toFixed,v.Pattern=v.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(l,s){if(l||(l={}),this.id=v.Object.__uid++,this.setOptions(l),!l.source||l.source&&typeof l.source!="string")s&&s(this);else{var o=this;this.source=v.util.createImage(),v.util.loadImage(l.source,function(c,i){o.source=c,s&&s(o,i)},null,this.crossOrigin)}},toObject:function(l){var s,o,c=v.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?s=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(s=this.source.toDataURL()),o={type:"pattern",source:s,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:$(this.offsetX,c),offsetY:$(this.offsetY,c),patternTransform:this.patternTransform?this.patternTransform.concat():null},v.util.populateWithProperties(this,o,l),o},toSVG:function(l){var s=typeof this.source=="function"?this.source():this.source,o=s.width/l.width,c=s.height/l.height,i=this.offsetX/l.width,n=this.offsetY/l.height,h="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(c=1,n&&(c+=Math.abs(n))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(o=1,i&&(o+=Math.abs(i))),s.src?h=s.src:s.toDataURL&&(h=s.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+i+'" y="'+n+'" width="'+o+'" height="'+c+`">
<image x="0" y="0" width="`+s.width+'" height="'+s.height+'" xlink:href="'+h+`"></image>
</pattern>
`},setOptions:function(l){for(var s in l)this[s]=l[s]},toLive:function(l){var s=this.source;return!s||s.src!==void 0&&(!s.complete||s.naturalWidth===0||s.naturalHeight===0)?"":l.createPattern(s,this.repeat)}}),function(l){var s=l.fabric||(l.fabric={}),o=s.util.toFixed;s.Shadow?s.warn("fabric.Shadow is already defined."):(s.Shadow=s.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(c){for(var i in typeof c=="string"&&(c=this._parseShadow(c)),c)this[i]=c[i];this.id=s.Object.__uid++},_parseShadow:function(c){var i=c.trim(),n=s.Shadow.reOffsetsAndBlur.exec(i)||[];return{color:(i.replace(s.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(n[1],10)||0,offsetY:parseFloat(n[2],10)||0,blur:parseFloat(n[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(c){var i=40,n=40,h=s.Object.NUM_FRACTION_DIGITS,g=s.util.rotateVector({x:this.offsetX,y:this.offsetY},s.util.degreesToRadians(-c.angle)),u=new s.Color(this.color);return c.width&&c.height&&(i=100*o((Math.abs(g.x)+this.blur)/c.width,h)+20,n=100*o((Math.abs(g.y)+this.blur)/c.height,h)+20),c.flipX&&(g.x*=-1),c.flipY&&(g.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+n+'%" height="'+(100+2*n)+'%" x="-'+i+'%" width="'+(100+2*i)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+o(this.blur?this.blur/2:0,h)+`"></feGaussianBlur>
	<feOffset dx="`+o(g.x,h)+'" dy="'+o(g.y,h)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+u.toRgb()+'" flood-opacity="'+u.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var c={},i=s.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(n){this[n]!==i[n]&&(c[n]=this[n])},this),c}}),s.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(v.StaticCanvas)v.warn("fabric.StaticCanvas is already defined.");else{var l=v.util.object.extend,s=v.util.getElementOffset,o=v.util.removeFromArray,c=v.util.toFixed,i=v.util.transformPoint,n=v.util.invertTransform,h=v.util.getNodeCanvas,g=v.util.createCanvasElement,u=new Error("Could not initialize `canvas` element");v.StaticCanvas=v.util.createClass(v.CommonMethods,{initialize:function(f,m){m||(m={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(f,m)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:v.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(f,m){var y=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(f),this._initOptions(m),this.interactive||this._initRetinaScaling(),m.overlayImage&&this.setOverlayImage(m.overlayImage,y),m.backgroundImage&&this.setBackgroundImage(m.backgroundImage,y),m.backgroundColor&&this.setBackgroundColor(m.backgroundColor,y),m.overlayColor&&this.setOverlayColor(m.overlayColor,y),this.calcOffset()},_isRetinaScaling:function(){return v.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,v.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var f=v.devicePixelRatio;this.__initRetinaScaling(f,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(f,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(f,m,y){m.setAttribute("width",this.width*f),m.setAttribute("height",this.height*f),y.scale(f,f)},calcOffset:function(){return this._offset=s(this.lowerCanvasEl),this},setOverlayImage:function(f,m,y){return this.__setBgOverlayImage("overlayImage",f,m,y)},setBackgroundImage:function(f,m,y){return this.__setBgOverlayImage("backgroundImage",f,m,y)},setOverlayColor:function(f,m){return this.__setBgOverlayColor("overlayColor",f,m)},setBackgroundColor:function(f,m){return this.__setBgOverlayColor("backgroundColor",f,m)},__setBgOverlayImage:function(f,m,y,w){return typeof m=="string"?v.util.loadImage(m,function(T,S){if(T){var D=new v.Image(T,w);this[f]=D,D.canvas=this}y&&y(T,S)},this,w&&w.crossOrigin):(w&&m.setOptions(w),this[f]=m,m&&(m.canvas=this),y&&y(m,!1)),this},__setBgOverlayColor:function(f,m,y){return this[f]=m,this._initGradient(m,f),this._initPattern(m,f,y),this},_createCanvasElement:function(){var f=g();if(!f||(f.style||(f.style={}),f.getContext===void 0))throw u;return f},_initOptions:function(f){var m=this.lowerCanvasEl;this._setOptions(f),this.width=this.width||parseInt(m.width,10)||0,this.height=this.height||parseInt(m.height,10)||0,this.lowerCanvasEl.style&&(m.width=this.width,m.height=this.height,m.style.width=this.width+"px",m.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(f){f&&f.getContext?this.lowerCanvasEl=f:this.lowerCanvasEl=v.util.getById(f)||this._createCanvasElement(),v.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(f,m){return this.setDimensions({width:f},m)},setHeight:function(f,m){return this.setDimensions({height:f},m)},setDimensions:function(f,m){var y;for(var w in m=m||{},f)y=f[w],m.cssOnly||(this._setBackstoreDimension(w,f[w]),y+="px",this.hasLostContext=!0),m.backstoreOnly||this._setCssDimension(w,y);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),m.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(f,m){return this.lowerCanvasEl[f]=m,this.upperCanvasEl&&(this.upperCanvasEl[f]=m),this.cacheCanvasEl&&(this.cacheCanvasEl[f]=m),this[f]=m,this},_setCssDimension:function(f,m){return this.lowerCanvasEl.style[f]=m,this.upperCanvasEl&&(this.upperCanvasEl.style[f]=m),this.wrapperEl&&(this.wrapperEl.style[f]=m),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(f){var m,y,w,T=this._activeObject,S=this.backgroundImage,D=this.overlayImage;for(this.viewportTransform=f,y=0,w=this._objects.length;y<w;y++)(m=this._objects[y]).group||m.setCoords(!0);return T&&T.setCoords(),S&&S.setCoords(!0),D&&D.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(f,m){var y=f,w=this.viewportTransform.slice(0);f=i(f,n(this.viewportTransform)),w[0]=m,w[3]=m;var T=i(f,w);return w[4]+=y.x-T.x,w[5]+=y.y-T.y,this.setViewportTransform(w)},setZoom:function(f){return this.zoomToPoint(new v.Point(0,0),f),this},absolutePan:function(f){var m=this.viewportTransform.slice(0);return m[4]=-f.x,m[5]=-f.y,this.setViewportTransform(m)},relativePan:function(f){return this.absolutePan(new v.Point(-f.x-this.viewportTransform[4],-f.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(f){this.stateful&&f.setupState(),f._set("canvas",this),f.setCoords(),this.fire("object:added",{target:f}),f.fire("added")},_onObjectRemoved:function(f){this.fire("object:removed",{target:f}),f.fire("removed"),delete f.canvas},clearContext:function(f){return f.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var f=this.contextContainer;return this.renderCanvas(f,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=v.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var f={},m=this.width,y=this.height,w=n(this.viewportTransform);return f.tl=i({x:0,y:0},w),f.br=i({x:m,y},w),f.tr=new v.Point(f.br.x,f.tl.y),f.bl=new v.Point(f.tl.x,f.br.y),this.vptCoords=f,f},cancelRequestedRender:function(){this.isRendering&&(v.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(f,m){var y=this.viewportTransform,w=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(f),v.util.setImageSmoothing(f,this.imageSmoothingEnabled),this.fire("before:render",{ctx:f}),this._renderBackground(f),f.save(),f.transform(y[0],y[1],y[2],y[3],y[4],y[5]),this._renderObjects(f,m),f.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),w&&(w.canvas=this,w.shouldCache(),w._transformDone=!0,w.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(f)),this._renderOverlay(f),this.controlsAboveOverlay&&this.interactive&&this.drawControls(f),this.fire("after:render",{ctx:f})},drawClipPathOnCanvas:function(f){var m=this.viewportTransform,y=this.clipPath;f.save(),f.transform(m[0],m[1],m[2],m[3],m[4],m[5]),f.globalCompositeOperation="destination-in",y.transform(f),f.scale(1/y.zoomX,1/y.zoomY),f.drawImage(y._cacheCanvas,-y.cacheTranslationX,-y.cacheTranslationY),f.restore()},_renderObjects:function(f,m){var y,w;for(y=0,w=m.length;y<w;++y)m[y]&&m[y].render(f)},_renderBackgroundOrOverlay:function(f,m){var y=this[m+"Color"],w=this[m+"Image"],T=this.viewportTransform,S=this[m+"Vpt"];if(y||w){if(y){f.save(),f.beginPath(),f.moveTo(0,0),f.lineTo(this.width,0),f.lineTo(this.width,this.height),f.lineTo(0,this.height),f.closePath(),f.fillStyle=y.toLive?y.toLive(f,this):y,S&&f.transform(T[0],T[1],T[2],T[3],T[4],T[5]),f.transform(1,0,0,1,y.offsetX||0,y.offsetY||0);var D=y.gradientTransform||y.patternTransform;D&&f.transform(D[0],D[1],D[2],D[3],D[4],D[5]),f.fill(),f.restore()}w&&(f.save(),S&&f.transform(T[0],T[1],T[2],T[3],T[4],T[5]),w.render(f),f.restore())}},_renderBackground:function(f){this._renderBackgroundOrOverlay(f,"background")},_renderOverlay:function(f){this._renderBackgroundOrOverlay(f,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new v.Point(this.width/2,this.height/2)},centerObjectH:function(f){return this._centerObject(f,new v.Point(this.getCenterPoint().x,f.getCenterPoint().y))},centerObjectV:function(f){return this._centerObject(f,new v.Point(f.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(f){var m=this.getCenterPoint();return this._centerObject(f,m)},viewportCenterObject:function(f){var m=this.getVpCenter();return this._centerObject(f,m)},viewportCenterObjectH:function(f){var m=this.getVpCenter();return this._centerObject(f,new v.Point(m.x,f.getCenterPoint().y)),this},viewportCenterObjectV:function(f){var m=this.getVpCenter();return this._centerObject(f,new v.Point(f.getCenterPoint().x,m.y))},getVpCenter:function(){var f=this.getCenterPoint(),m=n(this.viewportTransform);return i(f,m)},_centerObject:function(f,m){return f.setPositionByOrigin(m,"center","center"),f.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(f){return this.toDatalessObject(f)},toObject:function(f){return this._toObjectMethod("toObject",f)},toDatalessObject:function(f){return this._toObjectMethod("toDatalessObject",f)},_toObjectMethod:function(f,m){var y=this.clipPath,w={version:v.version,objects:this._toObjects(f,m)};return y&&!y.excludeFromExport&&(w.clipPath=this._toObject(this.clipPath,f,m)),l(w,this.__serializeBgOverlay(f,m)),v.util.populateWithProperties(this,w,m),w},_toObjects:function(f,m){return this._objects.filter(function(y){return!y.excludeFromExport}).map(function(y){return this._toObject(y,f,m)},this)},_toObject:function(f,m,y){var w;this.includeDefaultValues||(w=f.includeDefaultValues,f.includeDefaultValues=!1);var T=f[m](y);return this.includeDefaultValues||(f.includeDefaultValues=w),T},__serializeBgOverlay:function(f,m){var y={},w=this.backgroundImage,T=this.overlayImage,S=this.backgroundColor,D=this.overlayColor;return S&&S.toObject?S.excludeFromExport||(y.background=S.toObject(m)):S&&(y.background=S),D&&D.toObject?D.excludeFromExport||(y.overlay=D.toObject(m)):D&&(y.overlay=D),w&&!w.excludeFromExport&&(y.backgroundImage=this._toObject(w,f,m)),T&&!T.excludeFromExport&&(y.overlayImage=this._toObject(T,f,m)),y},svgViewportTransformation:!0,toSVG:function(f,m){f||(f={}),f.reviver=m;var y=[];return this._setSVGPreamble(y,f),this._setSVGHeader(y,f),this.clipPath&&y.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(y,"background"),this._setSVGBgOverlayImage(y,"backgroundImage",m),this._setSVGObjects(y,m),this.clipPath&&y.push(`</g>
`),this._setSVGBgOverlayColor(y,"overlay"),this._setSVGBgOverlayImage(y,"overlayImage",m),y.push("</svg>"),y.join("")},_setSVGPreamble:function(f,m){m.suppressPreamble||f.push('<?xml version="1.0" encoding="',m.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(f,m){var y,w=m.width||this.width,T=m.height||this.height,S='viewBox="0 0 '+this.width+" "+this.height+'" ',D=v.Object.NUM_FRACTION_DIGITS;m.viewBox?S='viewBox="'+m.viewBox.x+" "+m.viewBox.y+" "+m.viewBox.width+" "+m.viewBox.height+'" ':this.svgViewportTransformation&&(y=this.viewportTransform,S='viewBox="'+c(-y[4]/y[0],D)+" "+c(-y[5]/y[3],D)+" "+c(this.width/y[0],D)+" "+c(this.height/y[3],D)+'" '),f.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',w,'" ','height="',T,'" ',S,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",v.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(m),`</defs>
`)},createSVGClipPathMarkup:function(f){var m=this.clipPath;return m?(m.clipPathId="CLIPPATH_"+v.Object.__uid++,'<clipPath id="'+m.clipPathId+`" >
`+this.clipPath.toClipPathSVG(f.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var f=this;return["background","overlay"].map(function(m){var y=f[m+"Color"];if(y&&y.toLive){var w=f[m+"Vpt"],T=f.viewportTransform,S={width:f.width/(w?T[0]:1),height:f.height/(w?T[3]:1)};return y.toSVG(S,{additionalTransform:w?v.util.matrixToSVG(T):""})}}).join("")},createSVGFontFacesMarkup:function(){var f,m,y,w,T,S,D,N,X="",K={},ee=v.fontPaths,Q=[];for(this._objects.forEach(function x(R){Q.push(R),R._objects&&R._objects.forEach(x)}),D=0,N=Q.length;D<N;D++)if(m=(f=Q[D]).fontFamily,f.type.indexOf("text")!==-1&&!K[m]&&ee[m]&&(K[m]=!0,f.styles))for(T in y=f.styles)for(S in w=y[T])!K[m=w[S].fontFamily]&&ee[m]&&(K[m]=!0);for(var A in K)X+=[`		@font-face {
`,"			font-family: '",A,`';
`,"			src: url('",ee[A],`');
`,`		}
`].join("");return X&&(X=['	<style type="text/css">',`<![CDATA[
`,X,"]]>",`</style>
`].join("")),X},_setSVGObjects:function(f,m){var y,w,T,S=this._objects;for(w=0,T=S.length;w<T;w++)(y=S[w]).excludeFromExport||this._setSVGObject(f,y,m)},_setSVGObject:function(f,m,y){f.push(m.toSVG(y))},_setSVGBgOverlayImage:function(f,m,y){this[m]&&!this[m].excludeFromExport&&this[m].toSVG&&f.push(this[m].toSVG(y))},_setSVGBgOverlayColor:function(f,m){var y=this[m+"Color"],w=this.viewportTransform,T=this.width,S=this.height;if(y)if(y.toLive){var D=y.repeat,N=v.util.invertTransform(w),X=this[m+"Vpt"]?v.util.matrixToSVG(N):"";f.push('<rect transform="'+X+" translate(",T/2,",",S/2,')"',' x="',y.offsetX-T/2,'" y="',y.offsetY-S/2,'" ','width="',D==="repeat-y"||D==="no-repeat"?y.source.width:T,'" height="',D==="repeat-x"||D==="no-repeat"?y.source.height:S,'" fill="url(#SVGID_'+y.id+')"',`></rect>
`)}else f.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',y,'"',`></rect>
`)},sendToBack:function(f){if(!f)return this;var m,y,w,T=this._activeObject;if(f===T&&f.type==="activeSelection")for(m=(w=T._objects).length;m--;)y=w[m],o(this._objects,y),this._objects.unshift(y);else o(this._objects,f),this._objects.unshift(f);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(f){if(!f)return this;var m,y,w,T=this._activeObject;if(f===T&&f.type==="activeSelection")for(w=T._objects,m=0;m<w.length;m++)y=w[m],o(this._objects,y),this._objects.push(y);else o(this._objects,f),this._objects.push(f);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(f,m){if(!f)return this;var y,w,T,S,D,N=this._activeObject,X=0;if(f===N&&f.type==="activeSelection")for(D=N._objects,y=0;y<D.length;y++)w=D[y],(T=this._objects.indexOf(w))>0+X&&(S=T-1,o(this._objects,w),this._objects.splice(S,0,w)),X++;else(T=this._objects.indexOf(f))!==0&&(S=this._findNewLowerIndex(f,T,m),o(this._objects,f),this._objects.splice(S,0,f));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(f,m,y){var w,T;if(y){for(w=m,T=m-1;T>=0;--T)if(f.intersectsWithObject(this._objects[T])||f.isContainedWithinObject(this._objects[T])||this._objects[T].isContainedWithinObject(f)){w=T;break}}else w=m-1;return w},bringForward:function(f,m){if(!f)return this;var y,w,T,S,D,N=this._activeObject,X=0;if(f===N&&f.type==="activeSelection")for(y=(D=N._objects).length;y--;)w=D[y],(T=this._objects.indexOf(w))<this._objects.length-1-X&&(S=T+1,o(this._objects,w),this._objects.splice(S,0,w)),X++;else(T=this._objects.indexOf(f))!==this._objects.length-1&&(S=this._findNewUpperIndex(f,T,m),o(this._objects,f),this._objects.splice(S,0,f));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(f,m,y){var w,T,S;if(y){for(w=m,T=m+1,S=this._objects.length;T<S;++T)if(f.intersectsWithObject(this._objects[T])||f.isContainedWithinObject(this._objects[T])||this._objects[T].isContainedWithinObject(f)){w=T;break}}else w=m+1;return w},moveTo:function(f,m){return o(this._objects,f),this._objects.splice(m,0,f),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(v.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(f){f.dispose&&f.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),v.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),v.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),l(v.StaticCanvas.prototype,v.Observable),l(v.StaticCanvas.prototype,v.Collection),l(v.StaticCanvas.prototype,v.DataURLExporter),l(v.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(f){var m=g();if(!m||!m.getContext)return null;var y=m.getContext("2d");return y&&f==="setLineDash"?y.setLineDash!==void 0:null}}),v.StaticCanvas.prototype.toJSON=v.StaticCanvas.prototype.toObject,v.isLikelyNode&&(v.StaticCanvas.prototype.createPNGStream=function(){var f=h(this.lowerCanvasEl);return f&&f.createPNGStream()},v.StaticCanvas.prototype.createJPEGStream=function(f){var m=h(this.lowerCanvasEl);return m&&m.createJPEGStream(f)})}}(),v.BaseBrush=v.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(l){l.strokeStyle=this.color,l.lineWidth=this.width,l.lineCap=this.strokeLineCap,l.miterLimit=this.strokeMiterLimit,l.lineJoin=this.strokeLineJoin,l.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(l){var s=this.canvas.viewportTransform;l.save(),l.transform(s[0],s[1],s[2],s[3],s[4],s[5])},_setShadow:function(){if(this.shadow){var l=this.canvas,s=this.shadow,o=l.contextTop,c=l.getZoom();l&&l._isRetinaScaling()&&(c*=v.devicePixelRatio),o.shadowColor=s.color,o.shadowBlur=s.blur*c,o.shadowOffsetX=s.offsetX*c,o.shadowOffsetY=s.offsetY*c}},needsFullRender:function(){return new v.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var l=this.canvas.contextTop;l.shadowColor="",l.shadowBlur=l.shadowOffsetX=l.shadowOffsetY=0},_isOutSideCanvas:function(l){return l.x<0||l.x>this.canvas.getWidth()||l.y<0||l.y>this.canvas.getHeight()}}),v.PencilBrush=v.util.createClass(v.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(l){this.canvas=l,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(l,s,o){var c=s.midPointFrom(o);return l.quadraticCurveTo(s.x,s.y,c.x,c.y),c},onMouseDown:function(l,s){this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],this._prepareForDrawing(l),this._captureDrawingPath(l),this._render())},onMouseMove:function(l,s){if(this.canvas._isMainEvent(s.e)&&(this.drawStraightLine=s.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(l))&&this._captureDrawingPath(l)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var o=this._points,c=o.length,i=this.canvas.contextTop;this._saveAndTransform(i),this.oldEnd&&(i.beginPath(),i.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(i,o[c-2],o[c-1],!0),i.stroke(),i.restore()}},onMouseUp:function(l){return!this.canvas._isMainEvent(l.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(l){var s=new v.Point(l.x,l.y);this._reset(),this._addPoint(s),this.canvas.contextTop.moveTo(s.x,s.y)},_addPoint:function(l){return!(this._points.length>1&&l.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(l),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(l){var s=new v.Point(l.x,l.y);return this._addPoint(s)},_render:function(l){var s,o,c=this._points[0],i=this._points[1];if(l=l||this.canvas.contextTop,this._saveAndTransform(l),l.beginPath(),this._points.length===2&&c.x===i.x&&c.y===i.y){var n=this.width/1e3;c=new v.Point(c.x,c.y),i=new v.Point(i.x,i.y),c.x-=n,i.x+=n}for(l.moveTo(c.x,c.y),s=1,o=this._points.length;s<o;s++)this._drawSegment(l,c,i),c=this._points[s],i=this._points[s+1];l.lineTo(c.x,c.y),l.stroke(),l.restore()},convertPointsToSVGPath:function(l){var s=this.width/1e3;return v.util.getSmoothPathFromPoints(l,s)},_isEmptySVGPath:function(l){return v.util.joinPath(l)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(l){var s=new v.Path(l,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,s.shadow=new v.Shadow(this.shadow)),s},decimatePoints:function(l,s){if(l.length<=2)return l;var o,c=this.canvas.getZoom(),i=Math.pow(s/c,2),n=l.length-1,h=l[0],g=[h];for(o=1;o<n-1;o++)Math.pow(h.x-l[o].x,2)+Math.pow(h.y-l[o].y,2)>=i&&(h=l[o],g.push(h));return g.push(l[n]),g},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var l=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(l))this.canvas.requestRenderAll();else{var s=this.createPath(l);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:s}),this.canvas.add(s),this.canvas.requestRenderAll(),s.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:s})}}}),v.CircleBrush=v.util.createClass(v.BaseBrush,{width:10,initialize:function(l){this.canvas=l,this.points=[]},drawDot:function(l){var s=this.addPoint(l),o=this.canvas.contextTop;this._saveAndTransform(o),this.dot(o,s),o.restore()},dot:function(l,s){l.fillStyle=s.fill,l.beginPath(),l.arc(s.x,s.y,s.radius,0,2*Math.PI,!1),l.closePath(),l.fill()},onMouseDown:function(l){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(l)},_render:function(){var l,s,o=this.canvas.contextTop,c=this.points;for(this._saveAndTransform(o),l=0,s=c.length;l<s;l++)this.dot(o,c[l]);o.restore()},onMouseMove:function(l){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(l)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(l),this._render()):this.drawDot(l))},onMouseUp:function(){var l,s,o=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var c=[];for(l=0,s=this.points.length;l<s;l++){var i=this.points[l],n=new v.Circle({radius:i.radius,left:i.x,top:i.y,originX:"center",originY:"center",fill:i.fill});this.shadow&&(n.shadow=new v.Shadow(this.shadow)),c.push(n)}var h=new v.Group(c);h.canvas=this.canvas,this.canvas.fire("before:path:created",{path:h}),this.canvas.add(h),this.canvas.fire("path:created",{path:h}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=o,this.canvas.requestRenderAll()},addPoint:function(l){var s=new v.Point(l.x,l.y),o=v.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,c=new v.Color(this.color).setAlpha(v.util.getRandomInt(0,100)/100).toRgba();return s.radius=o,s.fill=c,this.points.push(s),s}}),v.SprayBrush=v.util.createClass(v.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(l){this.canvas=l,this.sprayChunks=[]},onMouseDown:function(l){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(l),this.render(this.sprayChunkPoints)},onMouseMove:function(l){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(l)||(this.addSprayChunk(l),this.render(this.sprayChunkPoints))},onMouseUp:function(){var l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var s=[],o=0,c=this.sprayChunks.length;o<c;o++)for(var i=this.sprayChunks[o],n=0,h=i.length;n<h;n++){var g=new v.Rect({width:i[n].width,height:i[n].width,left:i[n].x+1,top:i[n].y+1,originX:"center",originY:"center",fill:this.color});s.push(g)}this.optimizeOverlapping&&(s=this._getOptimizedRects(s));var u=new v.Group(s);this.shadow&&u.set("shadow",new v.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.fire("path:created",{path:u}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=l,this.canvas.requestRenderAll()},_getOptimizedRects:function(l){var s,o,c,i={};for(o=0,c=l.length;o<c;o++)i[s=l[o].left+""+l[o].top]||(i[s]=l[o]);var n=[];for(s in i)n.push(i[s]);return n},render:function(l){var s,o,c=this.canvas.contextTop;for(c.fillStyle=this.color,this._saveAndTransform(c),s=0,o=l.length;s<o;s++){var i=l[s];i.opacity!==void 0&&(c.globalAlpha=i.opacity),c.fillRect(i.x,i.y,i.width,i.width)}c.restore()},_render:function(){var l,s,o=this.canvas.contextTop;for(o.fillStyle=this.color,this._saveAndTransform(o),l=0,s=this.sprayChunks.length;l<s;l++)this.render(this.sprayChunks[l]);o.restore()},addSprayChunk:function(l){this.sprayChunkPoints=[];var s,o,c,i,n=this.width/2;for(i=0;i<this.density;i++){s=v.util.getRandomInt(l.x-n,l.x+n),o=v.util.getRandomInt(l.y-n,l.y+n),c=this.dotWidthVariance?v.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var h=new v.Point(s,o);h.width=c,this.randomOpacity&&(h.opacity=v.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(h)}this.sprayChunks.push(this.sprayChunkPoints)}}),v.PatternBrush=v.util.createClass(v.PencilBrush,{getPatternSrc:function(){var l=v.util.createCanvasElement(),s=l.getContext("2d");return l.width=l.height=25,s.fillStyle=this.color,s.beginPath(),s.arc(10,10,10,0,2*Math.PI,!1),s.closePath(),s.fill(),l},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(l){return l.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(l){this.callSuper("_setBrushStyles",l),l.strokeStyle=this.getPattern(l)},createPath:function(l){var s=this.callSuper("createPath",l),o=s._getLeftTopCoords().scalarAdd(s.strokeWidth/2);return s.stroke=new v.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-o.x,offsetY:-o.y}),s}}),function(){var l=v.util.getPointer,s=v.util.degreesToRadians,o=v.util.isTouchEvent;for(var c in v.Canvas=v.util.createClass(v.StaticCanvas,{initialize:function(i,n){n||(n={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(i,n),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=v.PencilBrush&&new v.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var i,n,h,g=this.getActiveObjects();if(g.length>0&&!this.preserveObjectStacking){n=[],h=[];for(var u=0,f=this._objects.length;u<f;u++)i=this._objects[u],g.indexOf(i)===-1?n.push(i):h.push(i);g.length>1&&(this._activeObject._objects=h),n.push.apply(n,h)}else n=this._objects;return n},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var i=this.contextContainer;return this.renderCanvas(i,this._chooseObjectsToRender()),this},renderTopLayer:function(i){i.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(i),this.contextTopDirty=!0),i.restore()},renderTop:function(){var i=this.contextTop;return this.clearContext(i),this.renderTopLayer(i),this.fire("after:render"),this},_normalizePointer:function(i,n){var h=i.calcTransformMatrix(),g=v.util.invertTransform(h),u=this.restorePointerVpt(n);return v.util.transformPoint(u,g)},isTargetTransparent:function(i,n,h){if(i.shouldCache()&&i._cacheCanvas&&i!==this._activeObject){var g=this._normalizePointer(i,{x:n,y:h}),u=Math.max(i.cacheTranslationX+g.x*i.zoomX,0),f=Math.max(i.cacheTranslationY+g.y*i.zoomY,0);return v.util.isTransparent(i._cacheContext,Math.round(u),Math.round(f),this.targetFindTolerance)}var m=this.contextCache,y=i.selectionBackgroundColor,w=this.viewportTransform;return i.selectionBackgroundColor="",this.clearContext(m),m.save(),m.transform(w[0],w[1],w[2],w[3],w[4],w[5]),i.render(m),m.restore(),i.selectionBackgroundColor=y,v.util.isTransparent(m,n,h,this.targetFindTolerance)},_isSelectionKeyPressed:function(i){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(n){return i[n]===!0}):i[this.selectionKey]},_shouldClearSelection:function(i,n){var h=this.getActiveObjects(),g=this._activeObject;return!n||n&&g&&h.length>1&&h.indexOf(n)===-1&&g!==n&&!this._isSelectionKeyPressed(i)||n&&!n.evented||n&&!n.selectable&&g&&g!==n},_shouldCenterTransform:function(i,n,h){var g;if(i)return n==="scale"||n==="scaleX"||n==="scaleY"||n==="resizing"?g=this.centeredScaling||i.centeredScaling:n==="rotate"&&(g=this.centeredRotation||i.centeredRotation),g?!h:h},_getOriginFromCorner:function(i,n){var h={x:i.originX,y:i.originY};return n==="ml"||n==="tl"||n==="bl"?h.x="right":n!=="mr"&&n!=="tr"&&n!=="br"||(h.x="left"),n==="tl"||n==="mt"||n==="tr"?h.y="bottom":n!=="bl"&&n!=="mb"&&n!=="br"||(h.y="top"),h},_getActionFromCorner:function(i,n,h,g){if(!n||!i)return"drag";var u=g.controls[n];return u.getActionName(h,u,g)},_setupCurrentTransform:function(i,n,h){if(n){var g=this.getPointer(i),u=n.__corner,f=n.controls[u],m=h&&u?f.getActionHandler(i,n,f):v.controlsUtils.dragHandler,y=this._getActionFromCorner(h,u,i,n),w=this._getOriginFromCorner(n,u),T=i[this.centeredKey],S={target:n,action:y,actionHandler:m,corner:u,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,offsetX:g.x-n.left,offsetY:g.y-n.top,originX:w.x,originY:w.y,ex:g.x,ey:g.y,lastX:g.x,lastY:g.y,theta:s(n.angle),width:n.width*n.scaleX,shiftKey:i.shiftKey,altKey:T,original:v.util.saveObjectTransform(n)};this._shouldCenterTransform(n,y,T)&&(S.originX="center",S.originY="center"),S.original.originX=w.x,S.original.originY=w.y,this._currentTransform=S,this._beforeTransform(i)}},setCursor:function(i){this.upperCanvasEl.style.cursor=i},_drawSelection:function(i){var n=this._groupSelector,h=new v.Point(n.ex,n.ey),g=v.util.transformPoint(h,this.viewportTransform),u=new v.Point(n.ex+n.left,n.ey+n.top),f=v.util.transformPoint(u,this.viewportTransform),m=Math.min(g.x,f.x),y=Math.min(g.y,f.y),w=Math.max(g.x,f.x),T=Math.max(g.y,f.y),S=this.selectionLineWidth/2;this.selectionColor&&(i.fillStyle=this.selectionColor,i.fillRect(m,y,w-m,T-y)),this.selectionLineWidth&&this.selectionBorderColor&&(i.lineWidth=this.selectionLineWidth,i.strokeStyle=this.selectionBorderColor,m+=S,y+=S,w-=S,T-=S,v.Object.prototype._setLineDash.call(this,i,this.selectionDashArray),i.strokeRect(m,y,w-m,T-y))},findTarget:function(i,n){if(!this.skipTargetFind){var h,g,u=this.getPointer(i,!0),f=this._activeObject,m=this.getActiveObjects(),y=o(i),w=m.length>1&&!n||m.length===1;if(this.targets=[],w&&f._findTargetCorner(u,y)||m.length>1&&!n&&f===this._searchPossibleTargets([f],u))return f;if(m.length===1&&f===this._searchPossibleTargets([f],u)){if(!this.preserveObjectStacking)return f;h=f,g=this.targets,this.targets=[]}var T=this._searchPossibleTargets(this._objects,u);return i[this.altSelectionKey]&&T&&h&&T!==h&&(T=h,this.targets=g),T}},_checkTarget:function(i,n,h){if(n&&n.visible&&n.evented&&n.containsPoint(i)&&(!this.perPixelTargetFind&&!n.perPixelTargetFind||n.isEditing||!this.isTargetTransparent(n,h.x,h.y)))return!0},_searchPossibleTargets:function(i,n){for(var h,g,u=i.length;u--;){var f=i[u],m=f.group?this._normalizePointer(f.group,n):n;if(this._checkTarget(m,f,n)){(h=i[u]).subTargetCheck&&h instanceof v.Group&&(g=this._searchPossibleTargets(h._objects,n))&&this.targets.push(g);break}}return h},restorePointerVpt:function(i){return v.util.transformPoint(i,v.util.invertTransform(this.viewportTransform))},getPointer:function(i,n){if(this._absolutePointer&&!n)return this._absolutePointer;if(this._pointer&&n)return this._pointer;var h,g=l(i),u=this.upperCanvasEl,f=u.getBoundingClientRect(),m=f.width||0,y=f.height||0;m&&y||("top"in f&&"bottom"in f&&(y=Math.abs(f.top-f.bottom)),"right"in f&&"left"in f&&(m=Math.abs(f.right-f.left))),this.calcOffset(),g.x=g.x-this._offset.left,g.y=g.y-this._offset.top,n||(g=this.restorePointerVpt(g));var w=this.getRetinaScaling();return w!==1&&(g.x/=w,g.y/=w),h=m===0||y===0?{width:1,height:1}:{width:u.width/m,height:u.height/y},{x:g.x*h.width,y:g.y*h.height}},_createUpperCanvas:function(){var i=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),n=this.lowerCanvasEl,h=this.upperCanvasEl;h?h.className="":(h=this._createCanvasElement(),this.upperCanvasEl=h),v.util.addClass(h,"upper-canvas "+i),this.wrapperEl.appendChild(h),this._copyCanvasStyle(n,h),this._applyCanvasStyle(h),this.contextTop=h.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=v.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),v.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),v.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(i){var n=this.width||i.width,h=this.height||i.height;v.util.setStyle(i,{position:"absolute",width:n+"px",height:h+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),i.width=n,i.height=h,v.util.makeElementUnselectable(i)},_copyCanvasStyle:function(i,n){n.style.cssText=i.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var i=this._activeObject;return i?i.type==="activeSelection"&&i._objects?i._objects.slice(0):[i]:[]},_onObjectRemoved:function(i){i===this._activeObject&&(this.fire("before:selection:cleared",{target:i}),this._discardActiveObject(),this.fire("selection:cleared",{target:i}),i.fire("deselected")),i===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",i)},_fireSelectionEvents:function(i,n){var h=!1,g=this.getActiveObjects(),u=[],f=[];i.forEach(function(m){g.indexOf(m)===-1&&(h=!0,m.fire("deselected",{e:n,target:m}),f.push(m))}),g.forEach(function(m){i.indexOf(m)===-1&&(h=!0,m.fire("selected",{e:n,target:m}),u.push(m))}),i.length>0&&g.length>0?h&&this.fire("selection:updated",{e:n,selected:u,deselected:f}):g.length>0?this.fire("selection:created",{e:n,selected:u}):i.length>0&&this.fire("selection:cleared",{e:n,deselected:f})},setActiveObject:function(i,n){var h=this.getActiveObjects();return this._setActiveObject(i,n),this._fireSelectionEvents(h,n),this},_setActiveObject:function(i,n){return this._activeObject!==i&&!!this._discardActiveObject(n,i)&&!i.onSelect({e:n})&&(this._activeObject=i,!0)},_discardActiveObject:function(i,n){var h=this._activeObject;if(h){if(h.onDeselect({e:i,object:n}))return!1;this._activeObject=null}return!0},discardActiveObject:function(i){var n=this.getActiveObjects(),h=this.getActiveObject();return n.length&&this.fire("before:selection:cleared",{target:h,e:i}),this._discardActiveObject(i),this._fireSelectionEvents(n,i),this},dispose:function(){var i=this.wrapperEl;return this.removeListeners(),i.removeChild(this.upperCanvasEl),i.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(n){v.util.cleanUpJsdomNode(this[n]),this[n]=void 0}).bind(this)),i.parentNode&&i.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,v.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(i){var n=this._activeObject;n&&n._renderControls(i)},_toObject:function(i,n,h){var g=this._realizeGroupTransformOnObject(i),u=this.callSuper("_toObject",i,n,h);return this._unwindGroupTransformOnObject(i,g),u},_realizeGroupTransformOnObject:function(i){if(i.group&&i.group.type==="activeSelection"&&this._activeObject===i.group){var n={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(h){n[h]=i[h]}),v.util.addTransformToObject(i,this._activeObject.calcOwnMatrix()),n}return null},_unwindGroupTransformOnObject:function(i,n){n&&i.set(n)},_setSVGObject:function(i,n,h){var g=this._realizeGroupTransformOnObject(n);this.callSuper("_setSVGObject",i,n,h),this._unwindGroupTransformOnObject(n,g)},setViewportTransform:function(i){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),v.StaticCanvas.prototype.setViewportTransform.call(this,i)}}),v.StaticCanvas)c!=="prototype"&&(v.Canvas[c]=v.StaticCanvas[c])}(),function(){var l=v.util.addListener,s=v.util.removeListener,o={passive:!1};function c(i,n){return i.button&&i.button===n-1}v.util.object.extend(v.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(l,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(i,n){var h=this.upperCanvasEl,g=this._getEventPrefix();i(v.window,"resize",this._onResize),i(h,g+"down",this._onMouseDown),i(h,g+"move",this._onMouseMove,o),i(h,g+"out",this._onMouseOut),i(h,g+"enter",this._onMouseEnter),i(h,"wheel",this._onMouseWheel),i(h,"contextmenu",this._onContextMenu),i(h,"dblclick",this._onDoubleClick),i(h,"dragover",this._onDragOver),i(h,"dragenter",this._onDragEnter),i(h,"dragleave",this._onDragLeave),i(h,"drop",this._onDrop),this.enablePointerEvents||i(h,"touchstart",this._onTouchStart,o),typeof eventjs<"u"&&n in eventjs&&(eventjs[n](h,"gesture",this._onGesture),eventjs[n](h,"drag",this._onDrag),eventjs[n](h,"orientation",this._onOrientationChange),eventjs[n](h,"shake",this._onShake),eventjs[n](h,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(s,"remove");var i=this._getEventPrefix();s(v.document,i+"up",this._onMouseUp),s(v.document,"touchend",this._onTouchEnd,o),s(v.document,i+"move",this._onMouseMove,o),s(v.document,"touchmove",this._onMouseMove,o)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(i,n){this.__onTransformGesture&&this.__onTransformGesture(i,n)},_onDrag:function(i,n){this.__onDrag&&this.__onDrag(i,n)},_onMouseWheel:function(i){this.__onMouseWheel(i)},_onMouseOut:function(i){var n=this._hoveredTarget;this.fire("mouse:out",{target:n,e:i}),this._hoveredTarget=null,n&&n.fire("mouseout",{e:i});var h=this;this._hoveredTargets.forEach(function(g){h.fire("mouse:out",{target:n,e:i}),g&&n.fire("mouseout",{e:i})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(g){g.isEditing&&g.hiddenTextarea.focus()})},_onMouseEnter:function(i){this._currentTransform||this.findTarget(i)||(this.fire("mouse:over",{target:null,e:i}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(i,n){this.__onOrientationChange&&this.__onOrientationChange(i,n)},_onShake:function(i,n){this.__onShake&&this.__onShake(i,n)},_onLongPress:function(i,n){this.__onLongPress&&this.__onLongPress(i,n)},_onDragOver:function(i){i.preventDefault();var n=this._simpleEventHandler("dragover",i);this._fireEnterLeaveEvents(n,i)},_onDrop:function(i){return this._simpleEventHandler("drop:before",i),this._simpleEventHandler("drop",i)},_onContextMenu:function(i){return this.stopContextMenu&&(i.stopPropagation(),i.preventDefault()),!1},_onDoubleClick:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"dblclick"),this._resetTransformEventData(i)},getPointerId:function(i){var n=i.changedTouches;return n?n[0]&&n[0].identifier:this.enablePointerEvents?i.pointerId:-1},_isMainEvent:function(i){return i.isPrimary===!0||i.isPrimary!==!1&&(i.type==="touchend"&&i.touches.length===0||!i.changedTouches||i.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(i){i.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(i)),this.__onMouseDown(i),this._resetTransformEventData();var n=this.upperCanvasEl,h=this._getEventPrefix();l(v.document,"touchend",this._onTouchEnd,o),l(v.document,"touchmove",this._onMouseMove,o),s(n,h+"down",this._onMouseDown)},_onMouseDown:function(i){this.__onMouseDown(i),this._resetTransformEventData();var n=this.upperCanvasEl,h=this._getEventPrefix();s(n,h+"move",this._onMouseMove,o),l(v.document,h+"up",this._onMouseUp),l(v.document,h+"move",this._onMouseMove,o)},_onTouchEnd:function(i){if(!(i.touches.length>0)){this.__onMouseUp(i),this._resetTransformEventData(),this.mainTouchId=null;var n=this._getEventPrefix();s(v.document,"touchend",this._onTouchEnd,o),s(v.document,"touchmove",this._onMouseMove,o);var h=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){l(h.upperCanvasEl,n+"down",h._onMouseDown),h._willAddMouseDown=0},400)}},_onMouseUp:function(i){this.__onMouseUp(i),this._resetTransformEventData();var n=this.upperCanvasEl,h=this._getEventPrefix();this._isMainEvent(i)&&(s(v.document,h+"up",this._onMouseUp),s(v.document,h+"move",this._onMouseMove,o),l(n,h+"move",this._onMouseMove,o))},_onMouseMove:function(i){!this.allowTouchScrolling&&i.preventDefault&&i.preventDefault(),this.__onMouseMove(i)},_onResize:function(){this.calcOffset()},_shouldRender:function(i){var n=this._activeObject;return!!(!!n!=!!i||n&&i&&n!==i)||(n&&n.isEditing,!1)},__onMouseUp:function(i){var n,h=this._currentTransform,g=this._groupSelector,u=!1,f=!g||g.left===0&&g.top===0;if(this._cacheTransformEventData(i),n=this._target,this._handleEvent(i,"up:before"),c(i,3))this.fireRightClick&&this._handleEvent(i,"up",3,f);else{if(c(i,2))return this.fireMiddleClick&&this._handleEvent(i,"up",2,f),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(i);else if(this._isMainEvent(i)){if(h&&(this._finalizeCurrentTransform(i),u=h.actionPerformed),!f){var m=n===this._activeObject;this._maybeGroupObjects(i),u||(u=this._shouldRender(n)||!m&&n===this._activeObject)}var y,w;if(n){if(y=n._findTargetCorner(this.getPointer(i,!0),v.util.isTouchEvent(i)),n.selectable&&n!==this._activeObject&&n.activeOn==="up")this.setActiveObject(n,i),u=!0;else{var T=n.controls[y],S=T&&T.getMouseUpHandler(i,n,T);S&&S(i,h,(w=this.getPointer(i)).x,w.y)}n.isMoving=!1}if(h&&(h.target!==n||h.corner!==y)){var D=h.target&&h.target.controls[h.corner],N=D&&D.getMouseUpHandler(i,n,T);w=w||this.getPointer(i),N&&N(i,h,w.x,w.y)}this._setCursorFromEvent(i,n),this._handleEvent(i,"up",1,f),this._groupSelector=null,this._currentTransform=null,n&&(n.__corner=0),u?this.requestRenderAll():f||this.renderTop()}}},_simpleEventHandler:function(i,n){var h=this.findTarget(n),g=this.targets,u={e:n,target:h,subTargets:g};if(this.fire(i,u),h&&h.fire(i,u),!g)return h;for(var f=0;f<g.length;f++)g[f].fire(i,u);return h},_handleEvent:function(i,n,h,g){var u=this._target,f=this.targets||[],m={e:i,target:u,subTargets:f,button:h||1,isClick:g||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};n==="up"&&(m.currentTarget=this.findTarget(i),m.currentSubTargets=this.targets),this.fire("mouse:"+n,m),u&&u.fire("mouse"+n,m);for(var y=0;y<f.length;y++)f[y].fire("mouse"+n,m)},_finalizeCurrentTransform:function(i){var n=this._currentTransform,h=n.target,g={e:i,target:h,transform:n,action:n.action};h._scaling&&(h._scaling=!1),h.setCoords(),(n.actionPerformed||this.stateful&&h.hasStateChanged())&&this._fire("modified",g)},_onMouseDownInDrawingMode:function(i){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(i).requestRenderAll();var n=this.getPointer(i);this.freeDrawingBrush.onMouseDown(n,{e:i,pointer:n}),this._handleEvent(i,"down")},_onMouseMoveInDrawingMode:function(i){if(this._isCurrentlyDrawing){var n=this.getPointer(i);this.freeDrawingBrush.onMouseMove(n,{e:i,pointer:n})}this.setCursor(this.freeDrawingCursor),this._handleEvent(i,"move")},_onMouseUpInDrawingMode:function(i){var n=this.getPointer(i);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:i,pointer:n}),this._handleEvent(i,"up")},__onMouseDown:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"down:before");var n=this._target;if(c(i,3))this.fireRightClick&&this._handleEvent(i,"down",3);else if(c(i,2))this.fireMiddleClick&&this._handleEvent(i,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(i);else if(this._isMainEvent(i)&&!this._currentTransform){var h=this._pointer;this._previousPointer=h;var g=this._shouldRender(n),u=this._shouldGroup(i,n);if(this._shouldClearSelection(i,n)?this.discardActiveObject(i):u&&(this._handleGrouping(i,n),n=this._activeObject),!this.selection||n&&(n.selectable||n.isEditing||n===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),n){var f=n===this._activeObject;n.selectable&&n.activeOn==="down"&&this.setActiveObject(n,i);var m=n._findTargetCorner(this.getPointer(i,!0),v.util.isTouchEvent(i));if(n.__corner=m,n===this._activeObject&&(m||!u)){this._setupCurrentTransform(i,n,f);var y=n.controls[m],w=(h=this.getPointer(i),y&&y.getMouseDownHandler(i,n,y));w&&w(i,this._currentTransform,h.x,h.y)}}this._handleEvent(i,"down"),(g||u)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(i){this._resetTransformEventData(),this._pointer=this.getPointer(i,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(i)||null},_beforeTransform:function(i){var n=this._currentTransform;this.stateful&&n.target.saveState(),this.fire("before:transform",{e:i,transform:n})},__onMouseMove:function(i){var n,h;if(this._handleEvent(i,"move:before"),this._cacheTransformEventData(i),this.isDrawingMode)this._onMouseMoveInDrawingMode(i);else if(this._isMainEvent(i)){var g=this._groupSelector;g?(h=this._absolutePointer,g.left=h.x-g.ex,g.top=h.y-g.ey,this.renderTop()):this._currentTransform?this._transformObject(i):(n=this.findTarget(i)||null,this._setCursorFromEvent(i,n),this._fireOverOutEvents(n,i)),this._handleEvent(i,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(i,n){var h=this._hoveredTarget,g=this._hoveredTargets,u=this.targets,f=Math.max(g.length,u.length);this.fireSyntheticInOutEvents(i,n,{oldTarget:h,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var m=0;m<f;m++)this.fireSyntheticInOutEvents(u[m],n,{oldTarget:g[m],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=i,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(i,n){var h=this._draggedoverTarget,g=this._hoveredTargets,u=this.targets,f=Math.max(g.length,u.length);this.fireSyntheticInOutEvents(i,n,{oldTarget:h,evtOut:"dragleave",evtIn:"dragenter"});for(var m=0;m<f;m++)this.fireSyntheticInOutEvents(u[m],n,{oldTarget:g[m],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=i},fireSyntheticInOutEvents:function(i,n,h){var g,u,f,m=h.oldTarget,y=m!==i,w=h.canvasEvtIn,T=h.canvasEvtOut;y&&(g={e:n,target:i,previousTarget:m},u={e:n,target:m,nextTarget:i}),f=i&&y,m&&y&&(T&&this.fire(T,u),m.fire(h.evtOut,u)),f&&(w&&this.fire(w,g),i.fire(h.evtIn,g))},__onMouseWheel:function(i){this._cacheTransformEventData(i),this._handleEvent(i,"wheel"),this._resetTransformEventData()},_transformObject:function(i){var n=this.getPointer(i),h=this._currentTransform;h.reset=!1,h.shiftKey=i.shiftKey,h.altKey=i[this.centeredKey],this._performTransformAction(i,h,n),h.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(i,n,h){var g=h.x,u=h.y,f=n.action,m=!1,y=n.actionHandler;y&&(m=y(i,n,g,u)),f==="drag"&&m&&(n.target.isMoving=!0,this.setCursor(n.target.moveCursor||this.moveCursor)),n.actionPerformed=n.actionPerformed||m},_fire:v.controlsUtils.fireEvent,_setCursorFromEvent:function(i,n){if(!n)return this.setCursor(this.defaultCursor),!1;var h=n.hoverCursor||this.hoverCursor,g=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,u=(!g||!g.contains(n))&&n._findTargetCorner(this.getPointer(i,!0));u?this.setCursor(this.getCornerCursor(u,n,i)):(n.subTargetCheck&&this.targets.concat().reverse().map(function(f){h=f.hoverCursor||h}),this.setCursor(h))},getCornerCursor:function(i,n,h){var g=n.controls[i];return g.cursorStyleHandler(h,g,n)}})}(),J=Math.min,te=Math.max,v.util.object.extend(v.Canvas.prototype,{_shouldGroup:function(l,s){var o=this._activeObject;return o&&this._isSelectionKeyPressed(l)&&s&&s.selectable&&this.selection&&(o!==s||o.type==="activeSelection")&&!s.onSelect({e:l})},_handleGrouping:function(l,s){var o=this._activeObject;o.__corner||(s!==o||(s=this.findTarget(l,!0))&&s.selectable)&&(o&&o.type==="activeSelection"?this._updateActiveSelection(s,l):this._createActiveSelection(s,l))},_updateActiveSelection:function(l,s){var o=this._activeObject,c=o._objects.slice(0);o.contains(l)?(o.removeWithUpdate(l),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat(),o.size()===1&&this._setActiveObject(o.item(0),s)):(o.addWithUpdate(l),this._hoveredTarget=o,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(c,s)},_createActiveSelection:function(l,s){var o=this.getActiveObjects(),c=this._createGroup(l);this._hoveredTarget=c,this._setActiveObject(c,s),this._fireSelectionEvents(o,s)},_createGroup:function(l){var s=this._objects,o=s.indexOf(this._activeObject)<s.indexOf(l)?[this._activeObject,l]:[l,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new v.ActiveSelection(o,{canvas:this})},_groupSelectedObjects:function(l){var s,o=this._collectObjects(l);o.length===1?this.setActiveObject(o[0],l):o.length>1&&(s=new v.ActiveSelection(o.reverse(),{canvas:this}),this.setActiveObject(s,l))},_collectObjects:function(l){for(var s,o=[],c=this._groupSelector.ex,i=this._groupSelector.ey,n=c+this._groupSelector.left,h=i+this._groupSelector.top,g=new v.Point(J(c,n),J(i,h)),u=new v.Point(te(c,n),te(i,h)),f=!this.selectionFullyContained,m=c===n&&i===h,y=this._objects.length;y--&&!((s=this._objects[y])&&s.selectable&&s.visible&&(f&&s.intersectsWithRect(g,u,!0)||s.isContainedWithinRect(g,u,!0)||f&&s.containsPoint(g,null,!0)||f&&s.containsPoint(u,null,!0))&&(o.push(s),m)););return o.length>1&&(o=o.filter(function(w){return!w.onSelect({e:l})})),o},_maybeGroupObjects:function(l){this.selection&&this._groupSelector&&this._groupSelectedObjects(l),this.setCursor(this.defaultCursor),this._groupSelector=null}}),v.util.object.extend(v.StaticCanvas.prototype,{toDataURL:function(l){l||(l={});var s=l.format||"png",o=l.quality||1,c=(l.multiplier||1)*(l.enableRetinaScaling?this.getRetinaScaling():1),i=this.toCanvasElement(c,l);return v.util.toDataURL(i,s,o)},toCanvasElement:function(l,s){l=l||1;var o=((s=s||{}).width||this.width)*l,c=(s.height||this.height)*l,i=this.getZoom(),n=this.width,h=this.height,g=i*l,u=this.viewportTransform,f=(u[4]-(s.left||0))*l,m=(u[5]-(s.top||0))*l,y=this.interactive,w=[g,0,0,g,f,m],T=this.enableRetinaScaling,S=v.util.createCanvasElement(),D=this.contextTop;return S.width=o,S.height=c,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=w,this.width=o,this.height=c,this.calcViewportBoundaries(),this.renderCanvas(S.getContext("2d"),this._objects),this.viewportTransform=u,this.width=n,this.height=h,this.calcViewportBoundaries(),this.interactive=y,this.enableRetinaScaling=T,this.contextTop=D,S}}),v.util.object.extend(v.StaticCanvas.prototype,{loadFromJSON:function(l,s,o){if(l){var c=typeof l=="string"?JSON.parse(l):v.util.object.clone(l),i=this,n=c.clipPath,h=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete c.clipPath,this._enlivenObjects(c.objects,function(g){i.clear(),i._setBgOverlay(c,function(){n?i._enlivenObjects([n],function(u){i.clipPath=u[0],i.__setupCanvas.call(i,c,g,h,s)}):i.__setupCanvas.call(i,c,g,h,s)})},o),this}},__setupCanvas:function(l,s,o,c){var i=this;s.forEach(function(n,h){i.insertAt(n,h)}),this.renderOnAddRemove=o,delete l.objects,delete l.backgroundImage,delete l.overlayImage,delete l.background,delete l.overlay,this._setOptions(l),this.renderAll(),c&&c()},_setBgOverlay:function(l,s){var o={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(l.backgroundImage||l.overlayImage||l.background||l.overlay){var c=function(){o.backgroundImage&&o.overlayImage&&o.backgroundColor&&o.overlayColor&&s&&s()};this.__setBgOverlay("backgroundImage",l.backgroundImage,o,c),this.__setBgOverlay("overlayImage",l.overlayImage,o,c),this.__setBgOverlay("backgroundColor",l.background,o,c),this.__setBgOverlay("overlayColor",l.overlay,o,c)}else s&&s()},__setBgOverlay:function(l,s,o,c){var i=this;if(!s)return o[l]=!0,void(c&&c());l==="backgroundImage"||l==="overlayImage"?v.util.enlivenObjects([s],function(n){i[l]=n[0],o[l]=!0,c&&c()}):this["set"+v.util.string.capitalize(l,!0)](s,function(){o[l]=!0,c&&c()})},_enlivenObjects:function(l,s,o){l&&l.length!==0?v.util.enlivenObjects(l,function(c){s&&s(c)},null,o):s&&s([])},_toDataURL:function(l,s){this.clone(function(o){s(o.toDataURL(l))})},_toDataURLWithMultiplier:function(l,s,o){this.clone(function(c){o(c.toDataURLWithMultiplier(l,s))})},clone:function(l,s){var o=JSON.stringify(this.toJSON(s));this.cloneWithoutData(function(c){c.loadFromJSON(o,function(){l&&l(c)})})},cloneWithoutData:function(l){var s=v.util.createCanvasElement();s.width=this.width,s.height=this.height;var o=new v.Canvas(s);this.backgroundImage?(o.setBackgroundImage(this.backgroundImage.src,function(){o.renderAll(),l&&l(o)}),o.backgroundImageOpacity=this.backgroundImageOpacity,o.backgroundImageStretch=this.backgroundImageStretch):l&&l(o)}}),function(l){var s=l.fabric||(l.fabric={}),o=s.util.object.extend,c=s.util.object.clone,i=s.util.toFixed,n=s.util.string.capitalize,h=s.util.degreesToRadians,g=!s.isLikelyNode;s.Object||(s.Object=s.util.createClass(s.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:g,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(u){u&&this.setOptions(u)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=s.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(u){var f=s.perfLimitSizeTotal,m=u.width,y=u.height,w=s.maxCacheSideLimit,T=s.minCacheSideLimit;if(m<=w&&y<=w&&m*y<=f)return m<T&&(u.width=T),y<T&&(u.height=T),u;var S=m/y,D=s.util.limitDimsByArea(S,f),N=s.util.capValue,X=N(T,D.x,w),K=N(T,D.y,w);return m>X&&(u.zoomX/=m/X,u.width=X,u.capped=!0),y>K&&(u.zoomY/=y/K,u.height=K,u.capped=!0),u},_getCacheCanvasDimensions:function(){var u=this.getTotalObjectScaling(),f=this._getTransformedDimensions(0,0),m=f.x*u.scaleX/this.scaleX,y=f.y*u.scaleY/this.scaleY;return{width:m+2,height:y+2,zoomX:u.scaleX,zoomY:u.scaleY,x:m,y}},_updateCacheCanvas:function(){var u=this.canvas;if(this.noScaleCache&&u&&u._currentTransform){var f=u._currentTransform.target,m=u._currentTransform.action;if(this===f&&m.slice&&m.slice(0,5)==="scale")return!1}var y,w,T=this._cacheCanvas,S=this._limitCacheSize(this._getCacheCanvasDimensions()),D=s.minCacheSideLimit,N=S.width,X=S.height,K=S.zoomX,ee=S.zoomY,Q=N!==this.cacheWidth||X!==this.cacheHeight,A=this.zoomX!==K||this.zoomY!==ee,x=Q||A,R=0,P=0,U=!1;if(Q){var W=this._cacheCanvas.width,F=this._cacheCanvas.height,L=N>W||X>F;U=L||(N<.9*W||X<.9*F)&&W>D&&F>D,L&&!S.capped&&(N>D||X>D)&&(R=.1*N,P=.1*X)}return this instanceof s.Text&&this.path&&(x=!0,U=!0,R+=this.getHeightOfLine(0)*this.zoomX,P+=this.getHeightOfLine(0)*this.zoomY),!!x&&(U?(T.width=Math.ceil(N+R),T.height=Math.ceil(X+P)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,T.width,T.height)),y=S.x/2,w=S.y/2,this.cacheTranslationX=Math.round(T.width/2-y)+y,this.cacheTranslationY=Math.round(T.height/2-w)+w,this.cacheWidth=N,this.cacheHeight=X,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(K,ee),this.zoomX=K,this.zoomY=ee,!0)},setOptions:function(u){this._setOptions(u),this._initGradient(u.fill,"fill"),this._initGradient(u.stroke,"stroke"),this._initPattern(u.fill,"fill"),this._initPattern(u.stroke,"stroke")},transform:function(u){var f=this.group&&!this.group._transformDone||this.group&&this.canvas&&u===this.canvas.contextTop,m=this.calcTransformMatrix(!f);u.transform(m[0],m[1],m[2],m[3],m[4],m[5])},toObject:function(u){var f=s.Object.NUM_FRACTION_DIGITS,m={type:this.type,version:s.version,originX:this.originX,originY:this.originY,left:i(this.left,f),top:i(this.top,f),width:i(this.width,f),height:i(this.height,f),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:i(this.strokeWidth,f),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:i(this.strokeMiterLimit,f),scaleX:i(this.scaleX,f),scaleY:i(this.scaleY,f),angle:i(this.angle,f),flipX:this.flipX,flipY:this.flipY,opacity:i(this.opacity,f),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:i(this.skewX,f),skewY:i(this.skewY,f)};return this.clipPath&&!this.clipPath.excludeFromExport&&(m.clipPath=this.clipPath.toObject(u),m.clipPath.inverted=this.clipPath.inverted,m.clipPath.absolutePositioned=this.clipPath.absolutePositioned),s.util.populateWithProperties(this,m,u),this.includeDefaultValues||(m=this._removeDefaultValues(m)),m},toDatalessObject:function(u){return this.toObject(u)},_removeDefaultValues:function(u){var f=s.util.getKlass(u.type).prototype;return f.stateProperties.forEach(function(m){m!=="left"&&m!=="top"&&(u[m]===f[m]&&delete u[m],Array.isArray(u[m])&&Array.isArray(f[m])&&u[m].length===0&&f[m].length===0&&delete u[m])}),u},toString:function(){return"#<fabric."+n(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var u=s.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(u.scaleX),scaleY:Math.abs(u.scaleY)}},getTotalObjectScaling:function(){var u=this.getObjectScaling(),f=u.scaleX,m=u.scaleY;if(this.canvas){var y=this.canvas.getZoom(),w=this.canvas.getRetinaScaling();f*=y*w,m*=y*w}return{scaleX:f,scaleY:m}},getObjectOpacity:function(){var u=this.opacity;return this.group&&(u*=this.group.getObjectOpacity()),u},_set:function(u,f){var m=u==="scaleX"||u==="scaleY",y=this[u]!==f,w=!1;return m&&(f=this._constrainScale(f)),u==="scaleX"&&f<0?(this.flipX=!this.flipX,f*=-1):u==="scaleY"&&f<0?(this.flipY=!this.flipY,f*=-1):u!=="shadow"||!f||f instanceof s.Shadow?u==="dirty"&&this.group&&this.group.set("dirty",f):f=new s.Shadow(f),this[u]=f,y&&(w=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(u)>-1?(this.dirty=!0,w&&this.group.set("dirty",!0)):w&&this.stateProperties.indexOf(u)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:s.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(u){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(u.save(),this._setupCompositeOperation(u),this.drawSelectionBackground(u),this.transform(u),this._setOpacity(u),this._setShadow(u,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(u)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(u),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),u.restore())},renderCache:function(u){u=u||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,u.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(u,f){if(u.save(),f.inverted?u.globalCompositeOperation="destination-out":u.globalCompositeOperation="destination-in",f.absolutePositioned){var m=s.util.invertTransform(this.calcTransformMatrix());u.transform(m[0],m[1],m[2],m[3],m[4],m[5])}f.transform(u),u.scale(1/f.zoomX,1/f.zoomY),u.drawImage(f._cacheCanvas,-f.cacheTranslationX,-f.cacheTranslationY),u.restore()},drawObject:function(u,f){var m=this.fill,y=this.stroke;f?(this.fill="black",this.stroke="",this._setClippingProperties(u)):this._renderBackground(u),this._render(u),this._drawClipPath(u,this.clipPath),this.fill=m,this.stroke=y},_drawClipPath:function(u,f){f&&(f.canvas=this.canvas,f.shouldCache(),f._transformDone=!0,f.renderCache({forClipping:!0}),this.drawClipPathOnCache(u,f))},drawCacheOnCanvas:function(u){u.scale(1/this.zoomX,1/this.zoomY),u.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(u){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!u&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!u){var f=this.cacheWidth/this.zoomX,m=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-f/2,-m/2,f,m)}return!0}return!1},_renderBackground:function(u){if(this.backgroundColor){var f=this._getNonTransformedDimensions();u.fillStyle=this.backgroundColor,u.fillRect(-f.x/2,-f.y/2,f.x,f.y),this._removeShadow(u)}},_setOpacity:function(u){this.group&&!this.group._transformDone?u.globalAlpha=this.getObjectOpacity():u.globalAlpha*=this.opacity},_setStrokeStyles:function(u,f){var m=f.stroke;m&&(u.lineWidth=f.strokeWidth,u.lineCap=f.strokeLineCap,u.lineDashOffset=f.strokeDashOffset,u.lineJoin=f.strokeLineJoin,u.miterLimit=f.strokeMiterLimit,m.toLive?m.gradientUnits==="percentage"||m.gradientTransform||m.patternTransform?this._applyPatternForTransformedGradient(u,m):(u.strokeStyle=m.toLive(u,this),this._applyPatternGradientTransform(u,m)):u.strokeStyle=f.stroke)},_setFillStyles:function(u,f){var m=f.fill;m&&(m.toLive?(u.fillStyle=m.toLive(u,this),this._applyPatternGradientTransform(u,f.fill)):u.fillStyle=m)},_setClippingProperties:function(u){u.globalAlpha=1,u.strokeStyle="transparent",u.fillStyle="#000000"},_setLineDash:function(u,f){f&&f.length!==0&&(1&f.length&&f.push.apply(f,f),u.setLineDash(f))},_renderControls:function(u,f){var m,y,w,T=this.getViewportTransform(),S=this.calcTransformMatrix();y=(f=f||{}).hasBorders!==void 0?f.hasBorders:this.hasBorders,w=f.hasControls!==void 0?f.hasControls:this.hasControls,S=s.util.multiplyTransformMatrices(T,S),m=s.util.qrDecompose(S),u.save(),u.translate(m.translateX,m.translateY),u.lineWidth=1*this.borderScaleFactor,this.group||(u.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(m.angle-=180),u.rotate(h(this.group?m.angle:this.angle)),f.forActiveSelection||this.group?y&&this.drawBordersInGroup(u,m,f):y&&this.drawBorders(u,f),w&&this.drawControls(u,f),u.restore()},_setShadow:function(u){if(this.shadow){var f,m=this.shadow,y=this.canvas,w=y&&y.viewportTransform[0]||1,T=y&&y.viewportTransform[3]||1;f=m.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),y&&y._isRetinaScaling()&&(w*=s.devicePixelRatio,T*=s.devicePixelRatio),u.shadowColor=m.color,u.shadowBlur=m.blur*s.browserShadowBlurConstant*(w+T)*(f.scaleX+f.scaleY)/4,u.shadowOffsetX=m.offsetX*w*f.scaleX,u.shadowOffsetY=m.offsetY*T*f.scaleY}},_removeShadow:function(u){this.shadow&&(u.shadowColor="",u.shadowBlur=u.shadowOffsetX=u.shadowOffsetY=0)},_applyPatternGradientTransform:function(u,f){if(!f||!f.toLive)return{offsetX:0,offsetY:0};var m=f.gradientTransform||f.patternTransform,y=-this.width/2+f.offsetX||0,w=-this.height/2+f.offsetY||0;return f.gradientUnits==="percentage"?u.transform(this.width,0,0,this.height,y,w):u.transform(1,0,0,1,y,w),m&&u.transform(m[0],m[1],m[2],m[3],m[4],m[5]),{offsetX:y,offsetY:w}},_renderPaintInOrder:function(u){this.paintFirst==="stroke"?(this._renderStroke(u),this._renderFill(u)):(this._renderFill(u),this._renderStroke(u))},_render:function(){},_renderFill:function(u){this.fill&&(u.save(),this._setFillStyles(u,this),this.fillRule==="evenodd"?u.fill("evenodd"):u.fill(),u.restore())},_renderStroke:function(u){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(u),u.save(),this.strokeUniform&&this.group){var f=this.getObjectScaling();u.scale(1/f.scaleX,1/f.scaleY)}else this.strokeUniform&&u.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(u,this.strokeDashArray),this._setStrokeStyles(u,this),u.stroke(),u.restore()}},_applyPatternForTransformedGradient:function(u,f){var m,y=this._limitCacheSize(this._getCacheCanvasDimensions()),w=s.util.createCanvasElement(),T=this.canvas.getRetinaScaling(),S=y.x/this.scaleX/T,D=y.y/this.scaleY/T;w.width=S,w.height=D,(m=w.getContext("2d")).beginPath(),m.moveTo(0,0),m.lineTo(S,0),m.lineTo(S,D),m.lineTo(0,D),m.closePath(),m.translate(S/2,D/2),m.scale(y.zoomX/this.scaleX/T,y.zoomY/this.scaleY/T),this._applyPatternGradientTransform(m,f),m.fillStyle=f.toLive(u),m.fill(),u.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),u.scale(T*this.scaleX/y.zoomX,T*this.scaleY/y.zoomY),u.strokeStyle=m.createPattern(w,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var u=s.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",u.scaleX),this.set("scaleY",u.scaleY),this.angle=u.angle,this.skewX=u.skewX,this.skewY=0}},_removeTransformMatrix:function(u){var f=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),f=s.util.transformPoint(f,this.transformMatrix)),this.transformMatrix=null,u&&(this.scaleX*=u.scaleX,this.scaleY*=u.scaleY,this.cropX=u.cropX,this.cropY=u.cropY,f.x+=u.offsetLeft,f.y+=u.offsetTop,this.width=u.width,this.height=u.height),this.setPositionByOrigin(f,"center","center")},clone:function(u,f){var m=this.toObject(f);this.constructor.fromObject?this.constructor.fromObject(m,u):s.Object._fromObject("Object",m,u)},cloneAsImage:function(u,f){var m=this.toCanvasElement(f);return u&&u(new s.Image(m)),this},toCanvasElement:function(u){u||(u={});var f=s.util,m=f.saveObjectTransform(this),y=this.group,w=this.shadow,T=Math.abs,S=(u.multiplier||1)*(u.enableRetinaScaling?s.devicePixelRatio:1);delete this.group,u.withoutTransform&&f.resetObjectTransform(this),u.withoutShadow&&(this.shadow=null);var D,N,X,K,ee=s.util.createCanvasElement(),Q=this.getBoundingRect(!0,!0),A=this.shadow,x={x:0,y:0};A&&(N=A.blur,D=A.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),x.x=2*Math.round(T(A.offsetX)+N)*T(D.scaleX),x.y=2*Math.round(T(A.offsetY)+N)*T(D.scaleY)),X=Q.width+x.x,K=Q.height+x.y,ee.width=Math.ceil(X),ee.height=Math.ceil(K);var R=new s.StaticCanvas(ee,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});u.format==="jpeg"&&(R.backgroundColor="#fff"),this.setPositionByOrigin(new s.Point(R.width/2,R.height/2),"center","center");var P=this.canvas;R.add(this);var U=R.toCanvasElement(S||1,u);return this.shadow=w,this.set("canvas",P),y&&(this.group=y),this.set(m).setCoords(),R._objects=[],R.dispose(),R=null,U},toDataURL:function(u){return u||(u={}),s.util.toDataURL(this.toCanvasElement(u),u.format||"png",u.quality||1)},isType:function(u){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===u},complexity:function(){return 1},toJSON:function(u){return this.toObject(u)},rotate:function(u){var f=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return f&&this._setOriginToCenter(),this.set("angle",u),f&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(u,f){f=f||this.canvas.getPointer(u);var m=new s.Point(f.x,f.y),y=this._getLeftTopCoords();return this.angle&&(m=s.util.rotatePoint(m,y,h(-this.angle))),{x:m.x-y.x,y:m.y-y.y}},_setupCompositeOperation:function(u){this.globalCompositeOperation&&(u.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){s.runningAnimations&&s.runningAnimations.cancelByTarget(this)}}),s.util.createAccessors&&s.util.createAccessors(s.Object),o(s.Object.prototype,s.Observable),s.Object.NUM_FRACTION_DIGITS=2,s.Object.ENLIVEN_PROPS=["clipPath"],s.Object._fromObject=function(u,f,m,y){var w=s[u];f=c(f,!0),s.util.enlivenPatterns([f.fill,f.stroke],function(T){T[0]!==void 0&&(f.fill=T[0]),T[1]!==void 0&&(f.stroke=T[1]),s.util.enlivenObjectEnlivables(f,f,function(){var S=y?new w(f[y],f):new w(f);m&&m(S)})})},s.Object.__uid=0)}(e),he=v.util.degreesToRadians,ce={left:-.5,center:0,right:.5},ue={top:-.5,center:0,bottom:.5},v.util.object.extend(v.Object.prototype,{translateToGivenOrigin:function(l,s,o,c,i){var n,h,g,u=l.x,f=l.y;return typeof s=="string"?s=ce[s]:s-=.5,typeof c=="string"?c=ce[c]:c-=.5,typeof o=="string"?o=ue[o]:o-=.5,typeof i=="string"?i=ue[i]:i-=.5,h=i-o,((n=c-s)||h)&&(g=this._getTransformedDimensions(),u=l.x+n*g.x,f=l.y+h*g.y),new v.Point(u,f)},translateToCenterPoint:function(l,s,o){var c=this.translateToGivenOrigin(l,s,o,"center","center");return this.angle?v.util.rotatePoint(c,l,he(this.angle)):c},translateToOriginPoint:function(l,s,o){var c=this.translateToGivenOrigin(l,"center","center",s,o);return this.angle?v.util.rotatePoint(c,l,he(this.angle)):c},getCenterPoint:function(){var l=new v.Point(this.left,this.top);return this.translateToCenterPoint(l,this.originX,this.originY)},getPointByOrigin:function(l,s){var o=this.getCenterPoint();return this.translateToOriginPoint(o,l,s)},toLocalPoint:function(l,s,o){var c,i,n=this.getCenterPoint();return c=s!==void 0&&o!==void 0?this.translateToGivenOrigin(n,"center","center",s,o):new v.Point(this.left,this.top),i=new v.Point(l.x,l.y),this.angle&&(i=v.util.rotatePoint(i,n,-he(this.angle))),i.subtractEquals(c)},setPositionByOrigin:function(l,s,o){var c=this.translateToCenterPoint(l,s,o),i=this.translateToOriginPoint(c,this.originX,this.originY);this.set("left",i.x),this.set("top",i.y)},adjustPosition:function(l){var s,o,c=he(this.angle),i=this.getScaledWidth(),n=v.util.cos(c)*i,h=v.util.sin(c)*i;s=typeof this.originX=="string"?ce[this.originX]:this.originX-.5,o=typeof l=="string"?ce[l]:l-.5,this.left+=n*(o-s),this.top+=h*(o-s),this.setCoords(),this.originX=l},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var l=this.getCenterPoint();this.originX="center",this.originY="center",this.left=l.x,this.top=l.y},_resetOrigin:function(){var l=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=l.x,this.top=l.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var l=v.util,s=l.degreesToRadians,o=l.multiplyTransformMatrices,c=l.transformPoint;l.object.extend(v.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(i,n){return n?i?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),i?this.aCoords:this.lineCoords)},getCoords:function(i,n){return h=this._getCoords(i,n),[new v.Point(h.tl.x,h.tl.y),new v.Point(h.tr.x,h.tr.y),new v.Point(h.br.x,h.br.y),new v.Point(h.bl.x,h.bl.y)];var h},intersectsWithRect:function(i,n,h,g){var u=this.getCoords(h,g);return v.Intersection.intersectPolygonRectangle(u,i,n).status==="Intersection"},intersectsWithObject:function(i,n,h){return v.Intersection.intersectPolygonPolygon(this.getCoords(n,h),i.getCoords(n,h)).status==="Intersection"||i.isContainedWithinObject(this,n,h)||this.isContainedWithinObject(i,n,h)},isContainedWithinObject:function(i,n,h){for(var g=this.getCoords(n,h),u=n?i.aCoords:i.lineCoords,f=0,m=i._getImageLines(u);f<4;f++)if(!i.containsPoint(g[f],m))return!1;return!0},isContainedWithinRect:function(i,n,h,g){var u=this.getBoundingRect(h,g);return u.left>=i.x&&u.left+u.width<=n.x&&u.top>=i.y&&u.top+u.height<=n.y},containsPoint:function(i,n,h,g){var u=this._getCoords(h,g),f=(n=n||this._getImageLines(u),this._findCrossPoints(i,n));return f!==0&&f%2==1},isOnScreen:function(i){if(!this.canvas)return!1;var n=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.getCoords(!0,i).some(function(g){return g.x<=h.x&&g.x>=n.x&&g.y<=h.y&&g.y>=n.y})||!!this.intersectsWithRect(n,h,!0,i)||this._containsCenterOfCanvas(n,h,i)},_containsCenterOfCanvas:function(i,n,h){var g={x:(i.x+n.x)/2,y:(i.y+n.y)/2};return!!this.containsPoint(g,null,!0,h)},isPartiallyOnScreen:function(i){if(!this.canvas)return!1;var n=this.canvas.vptCoords.tl,h=this.canvas.vptCoords.br;return!!this.intersectsWithRect(n,h,!0,i)||this.getCoords(!0,i).every(function(g){return(g.x>=h.x||g.x<=n.x)&&(g.y>=h.y||g.y<=n.y)})&&this._containsCenterOfCanvas(n,h,i)},_getImageLines:function(i){return{topline:{o:i.tl,d:i.tr},rightline:{o:i.tr,d:i.br},bottomline:{o:i.br,d:i.bl},leftline:{o:i.bl,d:i.tl}}},_findCrossPoints:function(i,n){var h,g,u,f=0;for(var m in n)if(!((u=n[m]).o.y<i.y&&u.d.y<i.y||u.o.y>=i.y&&u.d.y>=i.y||(u.o.x===u.d.x&&u.o.x>=i.x?g=u.o.x:(h=(u.d.y-u.o.y)/(u.d.x-u.o.x),g=-(i.y-0*i.x-(u.o.y-h*u.o.x))/(0-h)),g>=i.x&&(f+=1),f!==2)))break;return f},getBoundingRect:function(i,n){var h=this.getCoords(i,n);return l.makeBoundingBoxFromPoints(h)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(i){return Math.abs(i)<this.minScaleLimit?i<0?-this.minScaleLimit:this.minScaleLimit:i===0?1e-4:i},scale:function(i){return this._set("scaleX",i),this._set("scaleY",i),this.setCoords()},scaleToWidth:function(i,n){var h=this.getBoundingRect(n).width/this.getScaledWidth();return this.scale(i/this.width/h)},scaleToHeight:function(i,n){var h=this.getBoundingRect(n).height/this.getScaledHeight();return this.scale(i/this.height/h)},calcLineCoords:function(){var i=this.getViewportTransform(),n=this.padding,h=s(this.angle),g=l.cos(h)*n,u=l.sin(h)*n,f=g+u,m=g-u,y=this.calcACoords(),w={tl:c(y.tl,i),tr:c(y.tr,i),bl:c(y.bl,i),br:c(y.br,i)};return n&&(w.tl.x-=m,w.tl.y-=f,w.tr.x+=f,w.tr.y-=m,w.bl.x-=f,w.bl.y+=m,w.br.x+=m,w.br.y+=f),w},calcOCoords:function(){var i=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),h=this.getViewportTransform(),g=o(h,n),u=o(g,i),f=(u=o(u,[1/h[0],0,0,1/h[3],0,0]),this._calculateCurrentDimensions()),m={};return this.forEachControl(function(y,w,T){m[w]=y.positionHandler(f,u,T)}),m},calcACoords:function(){var i=this._calcRotateMatrix(),n=this._calcTranslateMatrix(),h=o(n,i),g=this._getTransformedDimensions(),u=g.x/2,f=g.y/2;return{tl:c({x:-u,y:-f},h),tr:c({x:u,y:-f},h),bl:c({x:-u,y:f},h),br:c({x:u,y:f},h)}},setCoords:function(i){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),i||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return l.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var i=this.getCenterPoint();return[1,0,0,1,i.x,i.y]},transformMatrixKey:function(i){var n="_",h="";return!i&&this.group&&(h=this.group.transformMatrixKey(i)+n),h+this.top+n+this.left+n+this.scaleX+n+this.scaleY+n+this.skewX+n+this.skewY+n+this.angle+n+this.originX+n+this.originY+n+this.width+n+this.height+n+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(i){var n=this.calcOwnMatrix();if(i||!this.group)return n;var h=this.transformMatrixKey(i),g=this.matrixCache||(this.matrixCache={});return g.key===h?g.value:(this.group&&(n=o(this.group.calcTransformMatrix(!1),n)),g.key=h,g.value=n,n)},calcOwnMatrix:function(){var i=this.transformMatrixKey(!0),n=this.ownMatrixCache||(this.ownMatrixCache={});if(n.key===i)return n.value;var h=this._calcTranslateMatrix(),g={angle:this.angle,translateX:h[4],translateY:h[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return n.key=i,n.value=l.composeMatrix(g),n.value},_getNonTransformedDimensions:function(){var i=this.strokeWidth;return{x:this.width+i,y:this.height+i}},_getTransformedDimensions:function(i,n){i===void 0&&(i=this.skewX),n===void 0&&(n=this.skewY);var h,g,u,f=i===0&&n===0;if(this.strokeUniform?(g=this.width,u=this.height):(g=(h=this._getNonTransformedDimensions()).x,u=h.y),f)return this._finalizeDimensions(g*this.scaleX,u*this.scaleY);var m=l.sizeAfterTransform(g,u,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:i,skewY:n});return this._finalizeDimensions(m.x,m.y)},_finalizeDimensions:function(i,n){return this.strokeUniform?{x:i+this.strokeWidth,y:n+this.strokeWidth}:{x:i,y:n}},_calculateCurrentDimensions:function(){var i=this.getViewportTransform(),n=this._getTransformedDimensions();return c(n,i,!0).scalarAdd(2*this.padding)}})}(),v.util.object.extend(v.Object.prototype,{sendToBack:function(){return this.group?v.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?v.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(l){return this.group?v.StaticCanvas.prototype.sendBackwards.call(this.group,this,l):this.canvas&&this.canvas.sendBackwards(this,l),this},bringForward:function(l){return this.group?v.StaticCanvas.prototype.bringForward.call(this.group,this,l):this.canvas&&this.canvas.bringForward(this,l),this},moveTo:function(l){return this.group&&this.group.type!=="activeSelection"?v.StaticCanvas.prototype.moveTo.call(this.group,this,l):this.canvas&&this.canvas.moveTo(this,l),this}}),function(){function l(o,c){if(c){if(c.toLive)return o+": url(#SVGID_"+c.id+"); ";var i=new v.Color(c),n=o+": "+i.toRgb()+"; ",h=i.getAlpha();return h!==1&&(n+=o+"-opacity: "+h.toString()+"; "),n}return o+": none; "}var s=v.util.toFixed;v.util.object.extend(v.Object.prototype,{getSvgStyles:function(o){var c=this.fillRule?this.fillRule:"nonzero",i=this.strokeWidth?this.strokeWidth:"0",n=this.strokeDashArray?this.strokeDashArray.join(" "):"none",h=this.strokeDashOffset?this.strokeDashOffset:"0",g=this.strokeLineCap?this.strokeLineCap:"butt",u=this.strokeLineJoin?this.strokeLineJoin:"miter",f=this.strokeMiterLimit?this.strokeMiterLimit:"4",m=this.opacity!==void 0?this.opacity:"1",y=this.visible?"":" visibility: hidden;",w=o?"":this.getSvgFilter(),T=l("fill",this.fill);return[l("stroke",this.stroke),"stroke-width: ",i,"; ","stroke-dasharray: ",n,"; ","stroke-linecap: ",g,"; ","stroke-dashoffset: ",h,"; ","stroke-linejoin: ",u,"; ","stroke-miterlimit: ",f,"; ",T,"fill-rule: ",c,"; ","opacity: ",m,";",w,y].join("")},getSvgSpanStyles:function(o,c){var i="; ",n=o.fontFamily?"font-family: "+(o.fontFamily.indexOf("'")===-1&&o.fontFamily.indexOf('"')===-1?"'"+o.fontFamily+"'":o.fontFamily)+i:"",h=o.strokeWidth?"stroke-width: "+o.strokeWidth+i:"",g=o.fontSize?"font-size: "+o.fontSize+"px"+i:"",u=o.fontStyle?"font-style: "+o.fontStyle+i:"",f=o.fontWeight?"font-weight: "+o.fontWeight+i:"",m=o.fill?l("fill",o.fill):"",y=o.stroke?l("stroke",o.stroke):"",w=this.getSvgTextDecoration(o);return w&&(w="text-decoration: "+w+i),[y,h,n,g,u,f,w,m,o.deltaY?"baseline-shift: "+-o.deltaY+"; ":"",c?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(o){return["overline","underline","line-through"].filter(function(c){return o[c.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(o,c){var i=o?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+v.util.matrixToSVG(i)+(c||"")+'" '},_setSVGBg:function(o){if(this.backgroundColor){var c=v.Object.NUM_FRACTION_DIGITS;o.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',s(-this.width/2,c),'" y="',s(-this.height/2,c),'" width="',s(this.width,c),'" height="',s(this.height,c),`"></rect>
`)}},toSVG:function(o){return this._createBaseSVGMarkup(this._toSVG(o),{reviver:o})},toClipPathSVG:function(o){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(o),{reviver:o})},_createBaseClipPathSVGMarkup:function(o,c){var i=(c=c||{}).reviver,n=c.additionalTransform||"",h=[this.getSvgTransform(!0,n),this.getSvgCommons()].join(""),g=o.indexOf("COMMON_PARTS");return o[g]=h,i?i(o.join("")):o.join("")},_createBaseSVGMarkup:function(o,c){var i,n,h=(c=c||{}).noStyle,g=c.reviver,u=h?"":'style="'+this.getSvgStyles()+'" ',f=c.withShadow?'style="'+this.getSvgFilter()+'" ':"",m=this.clipPath,y=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",w=m&&m.absolutePositioned,T=this.stroke,S=this.fill,D=this.shadow,N=[],X=o.indexOf("COMMON_PARTS"),K=c.additionalTransform;return m&&(m.clipPathId="CLIPPATH_"+v.Object.__uid++,n='<clipPath id="'+m.clipPathId+`" >
`+m.toClipPathSVG(g)+`</clipPath>
`),w&&N.push("<g ",f,this.getSvgCommons(),` >
`),N.push("<g ",this.getSvgTransform(!1),w?"":f+this.getSvgCommons(),` >
`),i=[u,y,h?"":this.addPaintOrder()," ",K?'transform="'+K+'" ':""].join(""),o[X]=i,S&&S.toLive&&N.push(S.toSVG(this)),T&&T.toLive&&N.push(T.toSVG(this)),D&&N.push(D.toSVG(this)),m&&N.push(n),N.push(o.join("")),N.push(`</g>
`),w&&N.push(`</g>
`),g?g(N.join("")):N.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var l=v.util.object.extend,s="stateProperties";function o(i,n,h){var g={};h.forEach(function(u){g[u]=i[u]}),l(i[n],g,!0)}function c(i,n,h){if(i===n)return!0;if(Array.isArray(i)){if(!Array.isArray(n)||i.length!==n.length)return!1;for(var g=0,u=i.length;g<u;g++)if(!c(i[g],n[g]))return!1;return!0}if(i&&typeof i=="object"){var f,m=Object.keys(i);if(!n||typeof n!="object"||!h&&m.length!==Object.keys(n).length)return!1;for(g=0,u=m.length;g<u;g++)if((f=m[g])!=="canvas"&&f!=="group"&&!c(i[f],n[f]))return!1;return!0}}v.util.object.extend(v.Object.prototype,{hasStateChanged:function(i){var n="_"+(i=i||s);return Object.keys(this[n]).length<this[i].length||!c(this[n],this,!0)},saveState:function(i){var n=i&&i.propertySet||s,h="_"+n;return this[h]?(o(this,h,this[n]),i&&i.stateProperties&&o(this,h,i.stateProperties),this):this.setupState(i)},setupState:function(i){var n=(i=i||{}).propertySet||s;return i.propertySet=n,this["_"+n]={},this.saveState(i),this}})}(),function(){var l=v.util.degreesToRadians;v.util.object.extend(v.Object.prototype,{_findTargetCorner:function(s,o){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var c,i,n,h=s.x,g=s.y,u=Object.keys(this.oCoords),f=u.length-1;for(this.__corner=0;f>=0;f--)if(n=u[f],this.isControlVisible(n)&&(i=this._getImageLines(o?this.oCoords[n].touchCorner:this.oCoords[n].corner),(c=this._findCrossPoints({x:h,y:g},i))!==0&&c%2==1))return this.__corner=n,n;return!1},forEachControl:function(s){for(var o in this.controls)s(this.controls[o],o,this)},_setCornerCoords:function(){var s=this.oCoords;for(var o in s){var c=this.controls[o];s[o].corner=c.calcCornerCoords(this.angle,this.cornerSize,s[o].x,s[o].y,!1),s[o].touchCorner=c.calcCornerCoords(this.angle,this.touchCornerSize,s[o].x,s[o].y,!0)}},drawSelectionBackground:function(s){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;s.save();var o=this.getCenterPoint(),c=this._calculateCurrentDimensions(),i=this.canvas.viewportTransform;return s.translate(o.x,o.y),s.scale(1/i[0],1/i[3]),s.rotate(l(this.angle)),s.fillStyle=this.selectionBackgroundColor,s.fillRect(-c.x/2,-c.y/2,c.x,c.y),s.restore(),this},drawBorders:function(s,o){o=o||{};var c=this._calculateCurrentDimensions(),i=this.borderScaleFactor,n=c.x+i,h=c.y+i,g=o.hasControls!==void 0?o.hasControls:this.hasControls,u=!1;return s.save(),s.strokeStyle=o.borderColor||this.borderColor,this._setLineDash(s,o.borderDashArray||this.borderDashArray),s.strokeRect(-n/2,-h/2,n,h),g&&(s.beginPath(),this.forEachControl(function(f,m,y){f.withConnection&&f.getVisibility(y,m)&&(u=!0,s.moveTo(f.x*n,f.y*h),s.lineTo(f.x*n+f.offsetX,f.y*h+f.offsetY))}),u&&s.stroke()),s.restore(),this},drawBordersInGroup:function(s,o,c){c=c||{};var i=v.util.sizeAfterTransform(this.width,this.height,o),n=this.strokeWidth,h=this.strokeUniform,g=this.borderScaleFactor,u=i.x+n*(h?this.canvas.getZoom():o.scaleX)+g,f=i.y+n*(h?this.canvas.getZoom():o.scaleY)+g;return s.save(),this._setLineDash(s,c.borderDashArray||this.borderDashArray),s.strokeStyle=c.borderColor||this.borderColor,s.strokeRect(-u/2,-f/2,u,f),s.restore(),this},drawControls:function(s,o){o=o||{},s.save();var c,i,n=this.canvas.getRetinaScaling();return s.setTransform(n,0,0,n,0,0),s.strokeStyle=s.fillStyle=o.cornerColor||this.cornerColor,this.transparentCorners||(s.strokeStyle=o.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(s,o.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(c=this.group.calcTransformMatrix()),this.forEachControl(function(h,g,u){i=u.oCoords[g],h.getVisibility(u,g)&&(c&&(i=v.util.transformPoint(i,c)),h.render(s,i.x,i.y,o,u))}),s.restore(),this},isControlVisible:function(s){return this.controls[s]&&this.controls[s].getVisibility(this,s)},setControlVisible:function(s,o){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[s]=o,this},setControlsVisibility:function(s){for(var o in s||(s={}),s)this.setControlVisible(o,s[o]);return this},onDeselect:function(){},onSelect:function(){}})}(),v.util.object.extend(v.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(l,s){var o=function(){},c=(s=s||{}).onComplete||o,i=s.onChange||o,n=this;return v.util.animate({target:this,startValue:l.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(h){l.set("left",h),n.requestRenderAll(),i()},onComplete:function(){l.setCoords(),c()}})},fxCenterObjectV:function(l,s){var o=function(){},c=(s=s||{}).onComplete||o,i=s.onChange||o,n=this;return v.util.animate({target:this,startValue:l.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(h){l.set("top",h),n.requestRenderAll(),i()},onComplete:function(){l.setCoords(),c()}})},fxRemove:function(l,s){var o=function(){},c=(s=s||{}).onComplete||o,i=s.onChange||o,n=this;return v.util.animate({target:this,startValue:l.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(h){l.set("opacity",h),n.requestRenderAll(),i()},onComplete:function(){n.remove(l),c()}})}}),v.util.object.extend(v.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var l,s,o=[],c=[];for(l in arguments[0])o.push(l);for(var i=0,n=o.length;i<n;i++)l=o[i],s=i!==n-1,c.push(this._animate(l,arguments[0][l],arguments[1],s));return c}return this._animate.apply(this,arguments)},_animate:function(l,s,o,c){var i,n=this;s=s.toString(),o=o?v.util.object.clone(o):{},~l.indexOf(".")&&(i=l.split("."));var h=n.colorProperties.indexOf(l)>-1||i&&n.colorProperties.indexOf(i[1])>-1,g=i?this.get(i[0])[i[1]]:this.get(l);"from"in o||(o.from=g),h||(s=~s.indexOf("=")?g+parseFloat(s.replace("=","")):parseFloat(s));var u={target:this,startValue:o.from,endValue:s,byValue:o.by,easing:o.easing,duration:o.duration,abort:o.abort&&function(f,m,y){return o.abort.call(n,f,m,y)},onChange:function(f,m,y){i?n[i[0]][i[1]]=f:n.set(l,f),c||o.onChange&&o.onChange(f,m,y)},onComplete:function(f,m,y){c||(n.setCoords(),o.onComplete&&o.onComplete(f,m,y))}};return h?v.util.animateColor(u.startValue,u.endValue,u.duration,u):v.util.animate(u)}}),function(l){var s=l.fabric||(l.fabric={}),o=s.util.object.extend,c=s.util.object.clone,i={x1:1,x2:1,y1:1,y2:1};function n(h,g){var u=h.origin,f=h.axis1,m=h.axis2,y=h.dimension,w=g.nearest,T=g.center,S=g.farthest;return function(){switch(this.get(u)){case w:return Math.min(this.get(f),this.get(m));case T:return Math.min(this.get(f),this.get(m))+.5*this.get(y);case S:return Math.max(this.get(f),this.get(m))}}}s.Line?s.warn("fabric.Line is already defined"):(s.Line=s.util.createClass(s.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:s.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(h,g){h||(h=[0,0,0,0]),this.callSuper("initialize",g),this.set("x1",h[0]),this.set("y1",h[1]),this.set("x2",h[2]),this.set("y2",h[3]),this._setWidthHeight(g)},_setWidthHeight:function(h){h||(h={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in h?h.left:this._getLeftToOriginX(),this.top="top"in h?h.top:this._getTopToOriginY()},_set:function(h,g){return this.callSuper("_set",h,g),i[h]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:n({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:n({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(h){h.beginPath();var g=this.calcLinePoints();h.moveTo(g.x1,g.y1),h.lineTo(g.x2,g.y2),h.lineWidth=this.strokeWidth;var u=h.strokeStyle;h.strokeStyle=this.stroke||h.fillStyle,this.stroke&&this._renderStroke(h),h.strokeStyle=u},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(h){return o(this.callSuper("toObject",h),this.calcLinePoints())},_getNonTransformedDimensions:function(){var h=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(h.y-=this.strokeWidth),this.height===0&&(h.x-=this.strokeWidth)),h},calcLinePoints:function(){var h=this.x1<=this.x2?-1:1,g=this.y1<=this.y2?-1:1,u=h*this.width*.5,f=g*this.height*.5;return{x1:u,x2:h*this.width*-.5,y1:f,y2:g*this.height*-.5}},_toSVG:function(){var h=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',h.x1,'" y1="',h.y1,'" x2="',h.x2,'" y2="',h.y2,`" />
`]}}),s.Line.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),s.Line.fromElement=function(h,g,u){u=u||{};var f=s.parseAttributes(h,s.Line.ATTRIBUTE_NAMES),m=[f.x1||0,f.y1||0,f.x2||0,f.y2||0];g(new s.Line(m,o(f,u)))},s.Line.fromObject=function(h,g){var u=c(h,!0);u.points=[h.x1,h.y1,h.x2,h.y2],s.Object._fromObject("Line",u,function(f){delete f.points,g&&g(f)},"points")})}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.degreesToRadians;s.Circle?s.warn("fabric.Circle is already defined."):(s.Circle=s.util.createClass(s.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:s.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(c,i){return this.callSuper("_set",c,i),c==="radius"&&this.setRadius(i),this},toObject:function(c){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(c))},_toSVG:function(){var c,i=(this.endAngle-this.startAngle)%360;if(i===0)c=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var n=o(this.startAngle),h=o(this.endAngle),g=this.radius;c=['<path d="M '+s.util.cos(n)*g+" "+s.util.sin(n)*g," A "+g+" "+g," 0 ",+(i>180?"1":"0")+" 1"," "+s.util.cos(h)*g+" "+s.util.sin(h)*g,'" ',"COMMON_PARTS",` />
`]}return c},_render:function(c){c.beginPath(),c.arc(0,0,this.radius,o(this.startAngle),o(this.endAngle),!1),this._renderPaintInOrder(c)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(c){return this.radius=c,this.set("width",2*c).set("height",2*c)}}),s.Circle.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),s.Circle.fromElement=function(c,i){var n,h=s.parseAttributes(c,s.Circle.ATTRIBUTE_NAMES);if(!("radius"in(n=h)&&n.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");h.left=(h.left||0)-h.radius,h.top=(h.top||0)-h.radius,i(new s.Circle(h))},s.Circle.fromObject=function(c,i){s.Object._fromObject("Circle",c,i)})}(e),function(l){var s=l.fabric||(l.fabric={});s.Triangle?s.warn("fabric.Triangle is already defined"):(s.Triangle=s.util.createClass(s.Object,{type:"triangle",width:100,height:100,_render:function(o){var c=this.width/2,i=this.height/2;o.beginPath(),o.moveTo(-c,i),o.lineTo(0,-i),o.lineTo(c,i),o.closePath(),this._renderPaintInOrder(o)},_toSVG:function(){var o=this.width/2,c=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-o+" "+c,"0 "+-c,o+" "+c].join(","),'" />']}}),s.Triangle.fromObject=function(o,c){return s.Object._fromObject("Triangle",o,c)})}(e),function(l){var s=l.fabric||(l.fabric={}),o=2*Math.PI;s.Ellipse?s.warn("fabric.Ellipse is already defined."):(s.Ellipse=s.util.createClass(s.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(c){this.callSuper("initialize",c),this.set("rx",c&&c.rx||0),this.set("ry",c&&c.ry||0)},_set:function(c,i){switch(this.callSuper("_set",c,i),c){case"rx":this.rx=i,this.set("width",2*i);break;case"ry":this.ry=i,this.set("height",2*i)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(c){return this.callSuper("toObject",["rx","ry"].concat(c))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(c){c.beginPath(),c.save(),c.transform(1,0,0,this.ry/this.rx,0,0),c.arc(0,0,this.rx,0,o,!1),c.restore(),this._renderPaintInOrder(c)}}),s.Ellipse.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),s.Ellipse.fromElement=function(c,i){var n=s.parseAttributes(c,s.Ellipse.ATTRIBUTE_NAMES);n.left=(n.left||0)-n.rx,n.top=(n.top||0)-n.ry,i(new s.Ellipse(n))},s.Ellipse.fromObject=function(c,i){s.Object._fromObject("Ellipse",c,i)})}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.object.extend;s.Rect?s.warn("fabric.Rect is already defined"):(s.Rect=s.util.createClass(s.Object,{stateProperties:s.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:s.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(c){this.callSuper("initialize",c),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(c){var i=this.rx?Math.min(this.rx,this.width/2):0,n=this.ry?Math.min(this.ry,this.height/2):0,h=this.width,g=this.height,u=-this.width/2,f=-this.height/2,m=i!==0||n!==0,y=.4477152502;c.beginPath(),c.moveTo(u+i,f),c.lineTo(u+h-i,f),m&&c.bezierCurveTo(u+h-y*i,f,u+h,f+y*n,u+h,f+n),c.lineTo(u+h,f+g-n),m&&c.bezierCurveTo(u+h,f+g-y*n,u+h-y*i,f+g,u+h-i,f+g),c.lineTo(u+i,f+g),m&&c.bezierCurveTo(u+y*i,f+g,u,f+g-y*n,u,f+g-n),c.lineTo(u,f+n),m&&c.bezierCurveTo(u,f+y*n,u+y*i,f,u+i,f),c.closePath(),this._renderPaintInOrder(c)},toObject:function(c){return this.callSuper("toObject",["rx","ry"].concat(c))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),s.Rect.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),s.Rect.fromElement=function(c,i,n){if(!c)return i(null);n=n||{};var h=s.parseAttributes(c,s.Rect.ATTRIBUTE_NAMES);h.left=h.left||0,h.top=h.top||0,h.height=h.height||0,h.width=h.width||0;var g=new s.Rect(o(n?s.util.object.clone(n):{},h));g.visible=g.visible&&g.width>0&&g.height>0,i(g)},s.Rect.fromObject=function(c,i){return s.Object._fromObject("Rect",c,i)})}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.object.extend,c=s.util.array.min,i=s.util.array.max,n=s.util.toFixed,h=s.util.projectStrokeOnPoints;s.Polyline?s.warn("fabric.Polyline is already defined"):(s.Polyline=s.util.createClass(s.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:s.Object.prototype.cacheProperties.concat("points"),initialize:function(g,u){u=u||{},this.points=g||[],this.callSuper("initialize",u),this._setPositionDimensions(u)},_projectStrokeOnPoints:function(){return h(this.points,this,!0)},_setPositionDimensions:function(g){var u,f=this._calcDimensions(g),m=this.exactBoundingBox?this.strokeWidth:0;this.width=f.width-m,this.height=f.height-m,g.fromSVG||(u=this.translateToGivenOrigin({x:f.left-this.strokeWidth/2+m/2,y:f.top-this.strokeWidth/2+m/2},"left","top",this.originX,this.originY)),g.left===void 0&&(this.left=g.fromSVG?f.left:u.x),g.top===void 0&&(this.top=g.fromSVG?f.top:u.y),this.pathOffset={x:f.left+this.width/2+m/2,y:f.top+this.height/2+m/2}},_calcDimensions:function(){var g=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,u=c(g,"x")||0,f=c(g,"y")||0;return{left:u,top:f,width:(i(g,"x")||0)-u,height:(i(g,"y")||0)-f}},toObject:function(g){return o(this.callSuper("toObject",g),{points:this.points.concat()})},_toSVG:function(){for(var g=[],u=this.pathOffset.x,f=this.pathOffset.y,m=s.Object.NUM_FRACTION_DIGITS,y=0,w=this.points.length;y<w;y++)g.push(n(this.points[y].x-u,m),",",n(this.points[y].y-f,m)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',g.join(""),`" />
`]},commonRender:function(g){var u,f=this.points.length,m=this.pathOffset.x,y=this.pathOffset.y;if(!f||isNaN(this.points[f-1].y))return!1;g.beginPath(),g.moveTo(this.points[0].x-m,this.points[0].y-y);for(var w=0;w<f;w++)u=this.points[w],g.lineTo(u.x-m,u.y-y);return!0},_render:function(g){this.commonRender(g)&&this._renderPaintInOrder(g)},complexity:function(){return this.get("points").length}}),s.Polyline.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polyline.fromElementGenerator=function(g){return function(u,f,m){if(!u)return f(null);m||(m={});var y=s.parsePointsAttribute(u.getAttribute("points")),w=s.parseAttributes(u,s[g].ATTRIBUTE_NAMES);w.fromSVG=!0,f(new s[g](y,o(w,m)))}},s.Polyline.fromElement=s.Polyline.fromElementGenerator("Polyline"),s.Polyline.fromObject=function(g,u){return s.Object._fromObject("Polyline",g,u,"points")})}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.projectStrokeOnPoints;s.Polygon?s.warn("fabric.Polygon is already defined"):(s.Polygon=s.util.createClass(s.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return o(this.points,this)},_render:function(c){this.commonRender(c)&&(c.closePath(),this._renderPaintInOrder(c))}}),s.Polygon.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(),s.Polygon.fromElement=s.Polyline.fromElementGenerator("Polygon"),s.Polygon.fromObject=function(c,i){s.Object._fromObject("Polygon",c,i,"points")})}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.array.min,c=s.util.array.max,i=s.util.object.extend,n=s.util.object.clone,h=s.util.toFixed;s.Path?s.warn("fabric.Path is already defined"):(s.Path=s.util.createClass(s.Object,{type:"path",path:null,cacheProperties:s.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:s.Object.prototype.stateProperties.concat("path"),initialize:function(g,u){delete(u=n(u||{})).path,this.callSuper("initialize",u),this._setPath(g||[],u)},_setPath:function(g,u){this.path=s.util.makePathSimpler(Array.isArray(g)?g:s.util.parsePath(g)),s.Polyline.prototype._setPositionDimensions.call(this,u||{})},_renderPathCommands:function(g){var u,f=0,m=0,y=0,w=0,T=0,S=0,D=-this.pathOffset.x,N=-this.pathOffset.y;g.beginPath();for(var X=0,K=this.path.length;X<K;++X)switch((u=this.path[X])[0]){case"L":y=u[1],w=u[2],g.lineTo(y+D,w+N);break;case"M":f=y=u[1],m=w=u[2],g.moveTo(y+D,w+N);break;case"C":y=u[5],w=u[6],T=u[3],S=u[4],g.bezierCurveTo(u[1]+D,u[2]+N,T+D,S+N,y+D,w+N);break;case"Q":g.quadraticCurveTo(u[1]+D,u[2]+N,u[3]+D,u[4]+N),y=u[3],w=u[4],T=u[1],S=u[2];break;case"z":case"Z":y=f,w=m,g.closePath()}},_render:function(g){this._renderPathCommands(g),this._renderPaintInOrder(g)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(g){return i(this.callSuper("toObject",g),{path:this.path.map(function(u){return u.slice()})})},toDatalessObject:function(g){var u=this.toObject(["sourcePath"].concat(g));return u.sourcePath&&delete u.path,u},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',s.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var g=s.Object.NUM_FRACTION_DIGITS;return" translate("+h(-this.pathOffset.x,g)+", "+h(-this.pathOffset.y,g)+")"},toClipPathSVG:function(g){var u=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:g,additionalTransform:u})},toSVG:function(g){var u=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:g,additionalTransform:u})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var g,u,f=[],m=[],y=0,w=0,T=0,S=0,D=0,N=this.path.length;D<N;++D){switch((g=this.path[D])[0]){case"L":T=g[1],S=g[2],u=[];break;case"M":y=T=g[1],w=S=g[2],u=[];break;case"C":u=s.util.getBoundsOfCurve(T,S,g[1],g[2],g[3],g[4],g[5],g[6]),T=g[5],S=g[6];break;case"Q":u=s.util.getBoundsOfCurve(T,S,g[1],g[2],g[1],g[2],g[3],g[4]),T=g[3],S=g[4];break;case"z":case"Z":T=y,S=w}u.forEach(function(ee){f.push(ee.x),m.push(ee.y)}),f.push(T),m.push(S)}var X=o(f)||0,K=o(m)||0;return{left:X,top:K,width:(c(f)||0)-X,height:(c(m)||0)-K}}}),s.Path.fromObject=function(g,u){if(typeof g.sourcePath=="string"){var f=g.sourcePath;s.loadSVGFromURL(f,function(m){var y=m[0];y.setOptions(g),u&&u(y)})}else s.Object._fromObject("Path",g,u,"path")},s.Path.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat(["d"]),s.Path.fromElement=function(g,u,f){var m=s.parseAttributes(g,s.Path.ATTRIBUTE_NAMES);m.fromSVG=!0,u(new s.Path(m.d,i(m,f)))})}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.array.min,c=s.util.array.max;s.Group||(s.Group=s.util.createClass(s.Object,s.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(i,n,h){n=n||{},this._objects=[],h&&this.callSuper("initialize",n),this._objects=i||[];for(var g=this._objects.length;g--;)this._objects[g].group=this;if(h)this._updateObjectsACoords();else{var u=n&&n.centerPoint;n.originX!==void 0&&(this.originX=n.originX),n.originY!==void 0&&(this.originY=n.originY),u||this._calcBounds(),this._updateObjectsCoords(u),delete n.centerPoint,this.callSuper("initialize",n)}this.setCoords()},_updateObjectsACoords:function(){for(var i=this._objects.length;i--;)this._objects[i].setCoords(!0)},_updateObjectsCoords:function(i){i=i||this.getCenterPoint();for(var n=this._objects.length;n--;)this._updateObjectCoords(this._objects[n],i)},_updateObjectCoords:function(i,n){var h=i.left,g=i.top;i.set({left:h-n.x,top:g-n.y}),i.group=this,i.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(i){var n=!!this.group;return this._restoreObjectsState(),s.util.resetObjectTransform(this),i&&(n&&s.util.removeTransformFromObject(i,this.group.calcTransformMatrix()),this._objects.push(i),i.group=this,i._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,n?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(i){return this._restoreObjectsState(),s.util.resetObjectTransform(this),this.remove(i),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(i){this.dirty=!0,i.group=this,i._set("canvas",this.canvas)},_onObjectRemoved:function(i){this.dirty=!0,delete i.group},_set:function(i,n){var h=this._objects.length;if(this.useSetOnGroup)for(;h--;)this._objects[h].setOnGroup(i,n);if(i==="canvas")for(;h--;)this._objects[h]._set(i,n);s.Object.prototype._set.call(this,i,n)},toObject:function(i){var n=this.includeDefaultValues,h=this._objects.filter(function(u){return!u.excludeFromExport}).map(function(u){var f=u.includeDefaultValues;u.includeDefaultValues=n;var m=u.toObject(i);return u.includeDefaultValues=f,m}),g=s.Object.prototype.toObject.call(this,i);return g.objects=h,g},toDatalessObject:function(i){var n,h=this.sourcePath;if(h)n=h;else{var g=this.includeDefaultValues;n=this._objects.map(function(f){var m=f.includeDefaultValues;f.includeDefaultValues=g;var y=f.toDatalessObject(i);return f.includeDefaultValues=m,y})}var u=s.Object.prototype.toDatalessObject.call(this,i);return u.objects=n,u},render:function(i){this._transformDone=!0,this.callSuper("render",i),this._transformDone=!1},shouldCache:function(){var i=s.Object.prototype.shouldCache.call(this);if(i){for(var n=0,h=this._objects.length;n<h;n++)if(this._objects[n].willDrawShadow())return this.ownCaching=!1,!1}return i},willDrawShadow:function(){if(s.Object.prototype.willDrawShadow.call(this))return!0;for(var i=0,n=this._objects.length;i<n;i++)if(this._objects[i].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(i){for(var n=0,h=this._objects.length;n<h;n++)this._objects[n].render(i);this._drawClipPath(i,this.clipPath)},isCacheDirty:function(i){if(this.callSuper("isCacheDirty",i))return!0;if(!this.statefullCache)return!1;for(var n=0,h=this._objects.length;n<h;n++)if(this._objects[n].isCacheDirty(!0)){if(this._cacheCanvas){var g=this.cacheWidth/this.zoomX,u=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-u/2,g,u)}return!0}return!1},_restoreObjectsState:function(){var i=this.calcOwnMatrix();return this._objects.forEach(function(n){s.util.addTransformToObject(n,i),delete n.group,n.setCoords()}),this},destroy:function(){return this._objects.forEach(function(i){i.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(i){i.dispose&&i.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var i=this._objects,n=this.canvas;this._objects=[];var h=this.toObject();delete h.objects;var g=new s.ActiveSelection([]);return g.set(h),g.type="activeSelection",n.remove(this),i.forEach(function(u){u.group=g,u.dirty=!0,n.add(u)}),g.canvas=n,g._objects=i,n._activeObject=g,g.setCoords(),g}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(i){i.setCoords(!0)}),this},_calcBounds:function(i){for(var n,h,g,u,f=[],m=[],y=["tr","br","bl","tl"],w=0,T=this._objects.length,S=y.length;w<T;++w){for(g=(n=this._objects[w]).calcACoords(),u=0;u<S;u++)h=y[u],f.push(g[h].x),m.push(g[h].y);n.aCoords=g}this._getBounds(f,m,i)},_getBounds:function(i,n,h){var g=new s.Point(o(i),o(n)),u=new s.Point(c(i),c(n)),f=g.y||0,m=g.x||0,y=u.x-g.x||0,w=u.y-g.y||0;this.width=y,this.height=w,h||this.setPositionByOrigin({x:m,y:f},"left","top")},_toSVG:function(i){for(var n=["<g ","COMMON_PARTS",` >
`],h=0,g=this._objects.length;h<g;h++)n.push("		",this._objects[h].toSVG(i));return n.push(`</g>
`),n},getSvgStyles:function(){var i=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",n=this.visible?"":" visibility: hidden;";return[i,this.getSvgFilter(),n].join("")},toClipPathSVG:function(i){for(var n=[],h=0,g=this._objects.length;h<g;h++)n.push("	",this._objects[h].toClipPathSVG(i));return this._createBaseClipPathSVGMarkup(n,{reviver:i})}}),s.Group.fromObject=function(i,n){var h=i.objects,g=s.util.object.clone(i,!0);delete g.objects,typeof h!="string"?s.util.enlivenObjects(h,function(u){var f=s.util.object.clone(i,!0);delete f.objects,s.util.enlivenObjectEnlivables(i,f,function(){n&&n(new s.Group(u,f,!0))})}):s.loadSVGFromURL(h,function(u){var f=s.util.groupSVGElements(u,i,h);f.set(g),n&&n(f)})})}(e),function(l){var s=l.fabric||(l.fabric={});s.ActiveSelection||(s.ActiveSelection=s.util.createClass(s.Group,{type:"activeSelection",initialize:function(o,c){c=c||{},this._objects=o||[];for(var i=this._objects.length;i--;)this._objects[i].group=this;c.originX&&(this.originX=c.originX),c.originY&&(this.originY=c.originY),this._calcBounds(),this._updateObjectsCoords(),s.Object.prototype.initialize.call(this,c),this.setCoords()},toGroup:function(){var o=this._objects.concat();this._objects=[];var c=s.Object.prototype.toObject.call(this),i=new s.Group([]);if(delete c.type,i.set(c),o.forEach(function(h){h.canvas.remove(h),h.group=i}),i._objects=o,!this.canvas)return i;var n=this.canvas;return n.add(i),n._activeObject=i,i.setCoords(),i},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(o,c,i){o.save(),o.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",o,c),(i=i||{}).hasControls===void 0&&(i.hasControls=!1),i.forActiveSelection=!0;for(var n=0,h=this._objects.length;n<h;n++)this._objects[n]._renderControls(o,i);o.restore()}}),s.ActiveSelection.fromObject=function(o,c){s.util.enlivenObjects(o.objects,function(i){delete o.objects,c&&c(new s.ActiveSelection(i,o,!0))})})}(e),function(l){var s=v.util.object.extend;l.fabric||(l.fabric={}),l.fabric.Image?v.warn("fabric.Image is already defined."):(v.Image=v.util.createClass(v.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:v.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:v.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(o,c){c||(c={}),this.filters=[],this.cacheKey="texture"+v.Object.__uid++,this.callSuper("initialize",c),this._initElement(o,c)},getElement:function(){return this._element||{}},setElement:function(o,c){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=o,this._originalElement=o,this._initConfig(c),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(o){var c=v.filterBackend;c&&c.evictCachesForKey&&c.evictCachesForKey(o)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(o){v.util.cleanUpJsdomNode(this[o]),this[o]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var o=this.getElement();return{width:o.naturalWidth||o.width,height:o.naturalHeight||o.height}},_stroke:function(o){if(this.stroke&&this.strokeWidth!==0){var c=this.width/2,i=this.height/2;o.beginPath(),o.moveTo(-c,-i),o.lineTo(c,-i),o.lineTo(c,i),o.lineTo(-c,i),o.lineTo(-c,-i),o.closePath()}},toObject:function(o){var c=[];this.filters.forEach(function(n){n&&c.push(n.toObject())});var i=s(this.callSuper("toObject",["cropX","cropY"].concat(o)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:c});return this.resizeFilter&&(i.resizeFilter=this.resizeFilter.toObject()),i},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var o,c=[],i=[],n=this._element,h=-this.width/2,g=-this.height/2,u="",f="";if(!n)return[];if(this.hasCrop()){var m=v.Object.__uid++;c.push('<clipPath id="imageCrop_'+m+`">
`,'	<rect x="'+h+'" y="'+g+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),u=' clip-path="url(#imageCrop_'+m+')" '}if(this.imageSmoothing||(f='" image-rendering="optimizeSpeed'),i.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',h-this.cropX,'" y="',g-this.cropY,'" width="',n.width||n.naturalWidth,'" height="',n.height||n.height,f,'"',u,`></image>
`),this.stroke||this.strokeDashArray){var y=this.fill;this.fill=null,o=["	<rect ",'x="',h,'" y="',g,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=y}return this.paintFirst!=="fill"?c.concat(o,i):c.concat(i,o)},getSrc:function(o){var c=o?this._element:this._originalElement;return c?c.toDataURL?c.toDataURL():this.srcFromAttribute?c.getAttribute("src"):c.src:this.src||""},setSrc:function(o,c,i){return v.util.loadImage(o,function(n,h){this.setElement(n,i),this._setWidthHeight(),c&&c(this,h)},this,i&&i.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var o=this.resizeFilter,c=this.minimumScaleTrigger,i=this.getTotalObjectScaling(),n=i.scaleX,h=i.scaleY,g=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!o||n>c&&h>c)return this._element=g,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=n,void(this._lastScaleY=h);v.filterBackend||(v.filterBackend=v.initFilterBackend());var u=v.util.createCanvasElement(),f=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,m=g.width,y=g.height;u.width=m,u.height=y,this._element=u,this._lastScaleX=o.scaleX=n,this._lastScaleY=o.scaleY=h,v.filterBackend.applyFilters([o],g,m,y,this._element,f),this._filterScalingX=u.width/this._originalElement.width,this._filterScalingY=u.height/this._originalElement.height},applyFilters:function(o){if(o=(o=o||this.filters||[]).filter(function(g){return g&&!g.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),o.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var c=this._originalElement,i=c.naturalWidth||c.width,n=c.naturalHeight||c.height;if(this._element===this._originalElement){var h=v.util.createCanvasElement();h.width=i,h.height=n,this._element=h,this._filteredEl=h}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,i,n),this._lastScaleX=1,this._lastScaleY=1;return v.filterBackend||(v.filterBackend=v.initFilterBackend()),v.filterBackend.applyFilters(o,this._originalElement,i,n,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(o){v.util.setImageSmoothing(o,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(o),this._renderPaintInOrder(o)},drawCacheOnCanvas:function(o){v.util.setImageSmoothing(o,this.imageSmoothing),v.Object.prototype.drawCacheOnCanvas.call(this,o)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(o){var c=this._element;if(c){var i=this._filterScalingX,n=this._filterScalingY,h=this.width,g=this.height,u=Math.min,f=Math.max,m=f(this.cropX,0),y=f(this.cropY,0),w=c.naturalWidth||c.width,T=c.naturalHeight||c.height,S=m*i,D=y*n,N=u(h*i,w-S),X=u(g*n,T-D),K=-h/2,ee=-g/2,Q=u(h,w/i-m),A=u(g,T/n-y);c&&o.drawImage(c,S,D,N,X,K,ee,Q,A)}},_needsResize:function(){var o=this.getTotalObjectScaling();return o.scaleX!==this._lastScaleX||o.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(o,c){this.setElement(v.util.getById(o),c),v.util.addClass(this.getElement(),v.Image.CSS_CANVAS)},_initConfig:function(o){o||(o={}),this.setOptions(o),this._setWidthHeight(o)},_initFilters:function(o,c){o&&o.length?v.util.enlivenObjects(o,function(i){c&&c(i)},"fabric.Image.filters"):c&&c()},_setWidthHeight:function(o){o||(o={});var c=this.getElement();this.width=o.width||c.naturalWidth||c.width||0,this.height=o.height||c.naturalHeight||c.height||0},parsePreserveAspectRatioAttribute:function(){var o,c=v.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),i=this._element.width,n=this._element.height,h=1,g=1,u=0,f=0,m=0,y=0,w=this.width,T=this.height,S={width:w,height:T};return!c||c.alignX==="none"&&c.alignY==="none"?(h=w/i,g=T/n):(c.meetOrSlice==="meet"&&(o=(w-i*(h=g=v.util.findScaleToFit(this._element,S)))/2,c.alignX==="Min"&&(u=-o),c.alignX==="Max"&&(u=o),o=(T-n*g)/2,c.alignY==="Min"&&(f=-o),c.alignY==="Max"&&(f=o)),c.meetOrSlice==="slice"&&(o=i-w/(h=g=v.util.findScaleToCover(this._element,S)),c.alignX==="Mid"&&(m=o/2),c.alignX==="Max"&&(m=o),o=n-T/g,c.alignY==="Mid"&&(y=o/2),c.alignY==="Max"&&(y=o),i=w/h,n=T/g)),{width:i,height:n,scaleX:h,scaleY:g,offsetLeft:u,offsetTop:f,cropX:m,cropY:y}}}),v.Image.CSS_CANVAS="canvas-img",v.Image.prototype.getSvgSrc=v.Image.prototype.getSrc,v.Image.fromObject=function(o,c){var i=v.util.object.clone(o);v.util.loadImage(i.src,function(n,h){h?c&&c(null,!0):v.Image.prototype._initFilters.call(i,i.filters,function(g){i.filters=g||[],v.Image.prototype._initFilters.call(i,[i.resizeFilter],function(u){i.resizeFilter=u[0],v.util.enlivenObjectEnlivables(i,i,function(){var f=new v.Image(n,i);c(f,!1)})})})},null,i.crossOrigin)},v.Image.fromURL=function(o,c,i){v.util.loadImage(o,function(n,h){c&&c(new v.Image(n,i),h)},null,i&&i.crossOrigin)},v.Image.ATTRIBUTE_NAMES=v.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),v.Image.fromElement=function(o,c,i){var n=v.parseAttributes(o,v.Image.ATTRIBUTE_NAMES);v.Image.fromURL(n["xlink:href"],c,s(i?v.util.object.clone(i):{},n))})}(e),v.util.object.extend(v.Object.prototype,{_getAngleValueForStraighten:function(){var l=this.angle%360;return l>0?90*Math.round((l-1)/90):90*Math.round(l/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(l){var s=function(){},o=(l=l||{}).onComplete||s,c=l.onChange||s,i=this;return v.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(n){i.rotate(n),c()},onComplete:function(){i.setCoords(),o()}})}}),v.util.object.extend(v.StaticCanvas.prototype,{straightenObject:function(l){return l.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(l){return l.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function l(o,c){var i="precision "+c+` float;
void main(){}`,n=o.createShader(o.FRAGMENT_SHADER);return o.shaderSource(n,i),o.compileShader(n),!!o.getShaderParameter(n,o.COMPILE_STATUS)}function s(o){o&&o.tileSize&&(this.tileSize=o.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}v.isWebglSupported=function(o){if(v.isLikelyNode)return!1;o=o||v.WebglFilterBackend.prototype.tileSize;var c=document.createElement("canvas"),i=c.getContext("webgl")||c.getContext("experimental-webgl"),n=!1;if(i){v.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),n=v.maxTextureSize>=o;for(var h=["highp","mediump","lowp"],g=0;g<3;g++)if(l(i,h[g])){v.webGlPrecision=h[g];break}}return this.isSupported=n,n},v.WebglFilterBackend=s,s.prototype={tileSize:2048,resources:{},setupGLContext:function(o,c){this.dispose(),this.createWebGLCanvas(o,c),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(o,c)},chooseFastestCopyGLTo2DMethod:function(o,c){var i,n=window.performance!==void 0;try{new ImageData(1,1),i=!0}catch{i=!1}var h=typeof ArrayBuffer<"u",g=typeof Uint8ClampedArray<"u";if(n&&i&&h&&g){var u=v.util.createCanvasElement(),f=new ArrayBuffer(o*c*4);if(v.forceGLPutImageData)return this.imageBuffer=f,void(this.copyGLTo2D=fe);var m,y,w={imageBuffer:f,destinationWidth:o,destinationHeight:c,targetCanvas:u};u.width=o,u.height=c,m=window.performance.now(),Ce.call(w,this.gl,w),y=window.performance.now()-m,m=window.performance.now(),fe.call(w,this.gl,w),y>window.performance.now()-m?(this.imageBuffer=f,this.copyGLTo2D=fe):this.copyGLTo2D=Ce}},createWebGLCanvas:function(o,c){var i=v.util.createCanvasElement();i.width=o,i.height=c;var n={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},h=i.getContext("webgl",n);h||(h=i.getContext("experimental-webgl",n)),h&&(h.clearColor(0,0,0,0),this.canvas=i,this.gl=h)},applyFilters:function(o,c,i,n,h,g){var u,f=this.gl;g&&(u=this.getCachedTexture(g,c));var m={originalWidth:c.width||c.originalWidth,originalHeight:c.height||c.originalHeight,sourceWidth:i,sourceHeight:n,destinationWidth:i,destinationHeight:n,context:f,sourceTexture:this.createTexture(f,i,n,!u&&c),targetTexture:this.createTexture(f,i,n),originalTexture:u||this.createTexture(f,i,n,!u&&c),passes:o.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:h},y=f.createFramebuffer();return f.bindFramebuffer(f.FRAMEBUFFER,y),o.forEach(function(w){w&&w.applyTo(m)}),function(w){var T=w.targetCanvas,S=T.width,D=T.height,N=w.destinationWidth,X=w.destinationHeight;S===N&&D===X||(T.width=N,T.height=X)}(m),this.copyGLTo2D(f,m),f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(m.sourceTexture),f.deleteTexture(m.targetTexture),f.deleteFramebuffer(y),h.getContext("2d").setTransform(1,0,0,1,0,0),m},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(o,c,i,n){var h=o.createTexture();return o.bindTexture(o.TEXTURE_2D,h),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),n?o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,n):o.texImage2D(o.TEXTURE_2D,0,o.RGBA,c,i,0,o.RGBA,o.UNSIGNED_BYTE,null),h},getCachedTexture:function(o,c){if(this.textureCache[o])return this.textureCache[o];var i=this.createTexture(this.gl,c.width,c.height,c);return this.textureCache[o]=i,i},evictCachesForKey:function(o){this.textureCache[o]&&(this.gl.deleteTexture(this.textureCache[o]),delete this.textureCache[o])},copyGLTo2D:Ce,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var o=this.gl,c={renderer:"",vendor:""};if(!o)return c;var i=o.getExtension("WEBGL_debug_renderer_info");if(i){var n=o.getParameter(i.UNMASKED_RENDERER_WEBGL),h=o.getParameter(i.UNMASKED_VENDOR_WEBGL);n&&(c.renderer=n.toLowerCase()),h&&(c.vendor=h.toLowerCase())}return this.gpuInfo=c,c}}}(),function(){var l=function(){};function s(){}v.Canvas2dFilterBackend=s,s.prototype={evictCachesForKey:l,dispose:l,clearWebGLCaches:l,resources:{},applyFilters:function(o,c,i,n,h){var g=h.getContext("2d");g.drawImage(c,0,0,i,n);var u={sourceWidth:i,sourceHeight:n,imageData:g.getImageData(0,0,i,n),originalEl:c,originalImageData:g.getImageData(0,0,i,n),canvasEl:h,ctx:g,filterBackend:this};return o.forEach(function(f){f.applyTo(u)}),u.imageData.width===i&&u.imageData.height===n||(h.width=u.imageData.width,h.height=u.imageData.height),g.putImageData(u.imageData,0,0),u}}}(),v.Image=v.Image||{},v.Image.filters=v.Image.filters||{},v.Image.filters.BaseFilter=v.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(l){l&&this.setOptions(l)},setOptions:function(l){for(var s in l)this[s]=l[s]},createProgram:function(l,s,o){s=s||this.fragmentSource,o=o||this.vertexSource,v.webGlPrecision!=="highp"&&(s=s.replace(/precision highp float/g,"precision "+v.webGlPrecision+" float"));var c=l.createShader(l.VERTEX_SHADER);if(l.shaderSource(c,o),l.compileShader(c),!l.getShaderParameter(c,l.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+l.getShaderInfoLog(c));var i=l.createShader(l.FRAGMENT_SHADER);if(l.shaderSource(i,s),l.compileShader(i),!l.getShaderParameter(i,l.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+l.getShaderInfoLog(i));var n=l.createProgram();if(l.attachShader(n,c),l.attachShader(n,i),l.linkProgram(n),!l.getProgramParameter(n,l.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+l.getProgramInfoLog(n));var h=this.getAttributeLocations(l,n),g=this.getUniformLocations(l,n)||{};return g.uStepW=l.getUniformLocation(n,"uStepW"),g.uStepH=l.getUniformLocation(n,"uStepH"),{program:n,attributeLocations:h,uniformLocations:g}},getAttributeLocations:function(l,s){return{aPosition:l.getAttribLocation(s,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(l,s,o){var c=s.aPosition,i=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,i),l.enableVertexAttribArray(c),l.vertexAttribPointer(c,2,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,o,l.STATIC_DRAW)},_setupFrameBuffer:function(l){var s,o,c=l.context;l.passes>1?(s=l.destinationWidth,o=l.destinationHeight,l.sourceWidth===s&&l.sourceHeight===o||(c.deleteTexture(l.targetTexture),l.targetTexture=l.filterBackend.createTexture(c,s,o)),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,l.targetTexture,0)):(c.bindFramebuffer(c.FRAMEBUFFER,null),c.finish())},_swapTextures:function(l){l.passes--,l.pass++;var s=l.targetTexture;l.targetTexture=l.sourceTexture,l.sourceTexture=s},isNeutralState:function(){var l=this.mainParameter,s=v.Image.filters[this.type].prototype;if(l){if(Array.isArray(s[l])){for(var o=s[l].length;o--;)if(this[l][o]!==s[l][o])return!1;return!0}return s[l]===this[l]}return!1},applyTo:function(l){l.webgl?(this._setupFrameBuffer(l),this.applyToWebGL(l),this._swapTextures(l)):this.applyTo2d(l)},retrieveShader:function(l){return l.programCache.hasOwnProperty(this.type)||(l.programCache[this.type]=this.createProgram(l.context)),l.programCache[this.type]},applyToWebGL:function(l){var s=l.context,o=this.retrieveShader(l);l.pass===0&&l.originalTexture?s.bindTexture(s.TEXTURE_2D,l.originalTexture):s.bindTexture(s.TEXTURE_2D,l.sourceTexture),s.useProgram(o.program),this.sendAttributeData(s,o.attributeLocations,l.aPosition),s.uniform1f(o.uniformLocations.uStepW,1/l.sourceWidth),s.uniform1f(o.uniformLocations.uStepH,1/l.sourceHeight),this.sendUniformData(s,o.uniformLocations),s.viewport(0,0,l.destinationWidth,l.destinationHeight),s.drawArrays(s.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(l,s,o){l.activeTexture(o),l.bindTexture(l.TEXTURE_2D,s),l.activeTexture(l.TEXTURE0)},unbindAdditionalTexture:function(l,s){l.activeTexture(s),l.bindTexture(l.TEXTURE_2D,null),l.activeTexture(l.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(l){this[this.mainParameter]=l},sendUniformData:function(){},createHelpLayer:function(l){if(!l.helpLayer){var s=document.createElement("canvas");s.width=l.sourceWidth,s.height=l.sourceHeight,l.helpLayer=s}},toObject:function(){var l={type:this.type},s=this.mainParameter;return s&&(l[s]=this[s]),l},toJSON:function(){return this.toObject()}}),v.Image.filters.BaseFilter.fromObject=function(l,s){var o=new v.Image.filters[l.type](l);return s&&s(o),o},function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.ColorMatrix=c(o.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(i){this.callSuper("initialize",i),this.matrix=this.matrix.slice(0)},applyTo2d:function(i){var n,h,g,u,f,m=i.imageData.data,y=m.length,w=this.matrix,T=this.colorsOnly;for(f=0;f<y;f+=4)n=m[f],h=m[f+1],g=m[f+2],T?(m[f]=n*w[0]+h*w[1]+g*w[2]+255*w[4],m[f+1]=n*w[5]+h*w[6]+g*w[7]+255*w[9],m[f+2]=n*w[10]+h*w[11]+g*w[12]+255*w[14]):(u=m[f+3],m[f]=n*w[0]+h*w[1]+g*w[2]+u*w[3]+255*w[4],m[f+1]=n*w[5]+h*w[6]+g*w[7]+u*w[8]+255*w[9],m[f+2]=n*w[10]+h*w[11]+g*w[12]+u*w[13]+255*w[14],m[f+3]=n*w[15]+h*w[16]+g*w[17]+u*w[18]+255*w[19])},getUniformLocations:function(i,n){return{uColorMatrix:i.getUniformLocation(n,"uColorMatrix"),uConstants:i.getUniformLocation(n,"uConstants")}},sendUniformData:function(i,n){var h=this.matrix,g=[h[0],h[1],h[2],h[3],h[5],h[6],h[7],h[8],h[10],h[11],h[12],h[13],h[15],h[16],h[17],h[18]],u=[h[4],h[9],h[14],h[19]];i.uniformMatrix4fv(n.uColorMatrix,!1,g),i.uniform4fv(n.uConstants,u)}}),s.Image.filters.ColorMatrix.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Brightness=c(o.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(i){if(this.brightness!==0){var n,h=i.imageData.data,g=h.length,u=Math.round(255*this.brightness);for(n=0;n<g;n+=4)h[n]=h[n]+u,h[n+1]=h[n+1]+u,h[n+2]=h[n+2]+u}},getUniformLocations:function(i,n){return{uBrightness:i.getUniformLocation(n,"uBrightness")}},sendUniformData:function(i,n){i.uniform1f(n.uBrightness,this.brightness)}}),s.Image.filters.Brightness.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.object.extend,c=s.Image.filters,i=s.util.createClass;c.Convolute=i(c.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(n){var h=Math.sqrt(this.matrix.length),g=this.type+"_"+h+"_"+(this.opaque?1:0),u=this.fragmentSource[g];return n.programCache.hasOwnProperty(g)||(n.programCache[g]=this.createProgram(n.context,u)),n.programCache[g]},applyTo2d:function(n){var h,g,u,f,m,y,w,T,S,D,N,X,K,ee=n.imageData,Q=ee.data,A=this.matrix,x=Math.round(Math.sqrt(A.length)),R=Math.floor(x/2),P=ee.width,U=ee.height,W=n.ctx.createImageData(P,U),F=W.data,L=this.opaque?1:0;for(N=0;N<U;N++)for(D=0;D<P;D++){for(m=4*(N*P+D),h=0,g=0,u=0,f=0,K=0;K<x;K++)for(X=0;X<x;X++)y=D+X-R,(w=N+K-R)<0||w>=U||y<0||y>=P||(T=4*(w*P+y),S=A[K*x+X],h+=Q[T]*S,g+=Q[T+1]*S,u+=Q[T+2]*S,L||(f+=Q[T+3]*S));F[m]=h,F[m+1]=g,F[m+2]=u,F[m+3]=L?Q[m+3]:f}n.imageData=W},getUniformLocations:function(n,h){return{uMatrix:n.getUniformLocation(h,"uMatrix"),uOpaque:n.getUniformLocation(h,"uOpaque"),uHalfSize:n.getUniformLocation(h,"uHalfSize"),uSize:n.getUniformLocation(h,"uSize")}},sendUniformData:function(n,h){n.uniform1fv(h.uMatrix,this.matrix)},toObject:function(){return o(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),s.Image.filters.Convolute.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Grayscale=c(o.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(i){var n,h,g=i.imageData.data,u=g.length,f=this.mode;for(n=0;n<u;n+=4)f==="average"?h=(g[n]+g[n+1]+g[n+2])/3:f==="lightness"?h=(Math.min(g[n],g[n+1],g[n+2])+Math.max(g[n],g[n+1],g[n+2]))/2:f==="luminosity"&&(h=.21*g[n]+.72*g[n+1]+.07*g[n+2]),g[n]=h,g[n+1]=h,g[n+2]=h},retrieveShader:function(i){var n=this.type+"_"+this.mode;if(!i.programCache.hasOwnProperty(n)){var h=this.fragmentSource[this.mode];i.programCache[n]=this.createProgram(i.context,h)}return i.programCache[n]},getUniformLocations:function(i,n){return{uMode:i.getUniformLocation(n,"uMode")}},sendUniformData:function(i,n){i.uniform1i(n.uMode,1)},isNeutralState:function(){return!1}}),s.Image.filters.Grayscale.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Invert=c(o.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(i){var n,h=i.imageData.data,g=h.length;for(n=0;n<g;n+=4)h[n]=255-h[n],h[n+1]=255-h[n+1],h[n+2]=255-h[n+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(i,n){return{uInvert:i.getUniformLocation(n,"uInvert")}},sendUniformData:function(i,n){i.uniform1i(n.uInvert,this.invert)}}),s.Image.filters.Invert.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.object.extend,c=s.Image.filters,i=s.util.createClass;c.Noise=i(c.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(n){if(this.noise!==0){var h,g,u=n.imageData.data,f=u.length,m=this.noise;for(h=0,f=u.length;h<f;h+=4)g=(.5-Math.random())*m,u[h]+=g,u[h+1]+=g,u[h+2]+=g}},getUniformLocations:function(n,h){return{uNoise:n.getUniformLocation(h,"uNoise"),uSeed:n.getUniformLocation(h,"uSeed")}},sendUniformData:function(n,h){n.uniform1f(h.uNoise,this.noise/255),n.uniform1f(h.uSeed,Math.random())},toObject:function(){return o(this.callSuper("toObject"),{noise:this.noise})}}),s.Image.filters.Noise.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Pixelate=c(o.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(i){var n,h,g,u,f,m,y,w,T,S,D,N=i.imageData,X=N.data,K=N.height,ee=N.width;for(h=0;h<K;h+=this.blocksize)for(g=0;g<ee;g+=this.blocksize)for(u=X[n=4*h*ee+4*g],f=X[n+1],m=X[n+2],y=X[n+3],S=Math.min(h+this.blocksize,K),D=Math.min(g+this.blocksize,ee),w=h;w<S;w++)for(T=g;T<D;T++)X[n=4*w*ee+4*T]=u,X[n+1]=f,X[n+2]=m,X[n+3]=y},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(i,n){return{uBlocksize:i.getUniformLocation(n,"uBlocksize"),uStepW:i.getUniformLocation(n,"uStepW"),uStepH:i.getUniformLocation(n,"uStepH")}},sendUniformData:function(i,n){i.uniform1f(n.uBlocksize,this.blocksize)}}),s.Image.filters.Pixelate.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.object.extend,c=s.Image.filters,i=s.util.createClass;c.RemoveColor=i(c.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(n){var h,g,u,f,m=n.imageData.data,y=255*this.distance,w=new s.Color(this.color).getSource(),T=[w[0]-y,w[1]-y,w[2]-y],S=[w[0]+y,w[1]+y,w[2]+y];for(h=0;h<m.length;h+=4)g=m[h],u=m[h+1],f=m[h+2],g>T[0]&&u>T[1]&&f>T[2]&&g<S[0]&&u<S[1]&&f<S[2]&&(m[h+3]=0)},getUniformLocations:function(n,h){return{uLow:n.getUniformLocation(h,"uLow"),uHigh:n.getUniformLocation(h,"uHigh")}},sendUniformData:function(n,h){var g=new s.Color(this.color).getSource(),u=parseFloat(this.distance),f=[0+g[0]/255-u,0+g[1]/255-u,0+g[2]/255-u,1],m=[g[0]/255+u,g[1]/255+u,g[2]/255+u,1];n.uniform4fv(h.uLow,f),n.uniform4fv(h.uHigh,m)},toObject:function(){return o(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),s.Image.filters.RemoveColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass,i={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var n in i)o[n]=c(o.ColorMatrix,{type:n,matrix:i[n],mainParameter:!1,colorsOnly:!0}),s.Image.filters[n].fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric,o=s.Image.filters,c=s.util.createClass;o.BlendColor=c(o.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(i){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[i]+`}
}`},retrieveShader:function(i){var n,h=this.type+"_"+this.mode;return i.programCache.hasOwnProperty(h)||(n=this.buildSource(this.mode),i.programCache[h]=this.createProgram(i.context,n)),i.programCache[h]},applyTo2d:function(i){var n,h,g,u,f,m,y,w=i.imageData.data,T=w.length,S=1-this.alpha;n=(y=new s.Color(this.color).getSource())[0]*this.alpha,h=y[1]*this.alpha,g=y[2]*this.alpha;for(var D=0;D<T;D+=4)switch(u=w[D],f=w[D+1],m=w[D+2],this.mode){case"multiply":w[D]=u*n/255,w[D+1]=f*h/255,w[D+2]=m*g/255;break;case"screen":w[D]=255-(255-u)*(255-n)/255,w[D+1]=255-(255-f)*(255-h)/255,w[D+2]=255-(255-m)*(255-g)/255;break;case"add":w[D]=u+n,w[D+1]=f+h,w[D+2]=m+g;break;case"diff":case"difference":w[D]=Math.abs(u-n),w[D+1]=Math.abs(f-h),w[D+2]=Math.abs(m-g);break;case"subtract":w[D]=u-n,w[D+1]=f-h,w[D+2]=m-g;break;case"darken":w[D]=Math.min(u,n),w[D+1]=Math.min(f,h),w[D+2]=Math.min(m,g);break;case"lighten":w[D]=Math.max(u,n),w[D+1]=Math.max(f,h),w[D+2]=Math.max(m,g);break;case"overlay":w[D]=n<128?2*u*n/255:255-2*(255-u)*(255-n)/255,w[D+1]=h<128?2*f*h/255:255-2*(255-f)*(255-h)/255,w[D+2]=g<128?2*m*g/255:255-2*(255-m)*(255-g)/255;break;case"exclusion":w[D]=n+u-2*n*u/255,w[D+1]=h+f-2*h*f/255,w[D+2]=g+m-2*g*m/255;break;case"tint":w[D]=n+u*S,w[D+1]=h+f*S,w[D+2]=g+m*S}},getUniformLocations:function(i,n){return{uColor:i.getUniformLocation(n,"uColor")}},sendUniformData:function(i,n){var h=new s.Color(this.color).getSource();h[0]=this.alpha*h[0]/255,h[1]=this.alpha*h[1]/255,h[2]=this.alpha*h[2]/255,h[3]=this.alpha,i.uniform4fv(n.uColor,h)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendColor.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric,o=s.Image.filters,c=s.util.createClass;o.BlendImage=c(o.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(i){var n=this.type+"_"+this.mode,h=this.fragmentSource[this.mode];return i.programCache.hasOwnProperty(n)||(i.programCache[n]=this.createProgram(i.context,h)),i.programCache[n]},applyToWebGL:function(i){var n=i.context,h=this.createTexture(i.filterBackend,this.image);this.bindAdditionalTexture(n,h,n.TEXTURE1),this.callSuper("applyToWebGL",i),this.unbindAdditionalTexture(n,n.TEXTURE1)},createTexture:function(i,n){return i.getCachedTexture(n.cacheKey,n._element)},calculateMatrix:function(){var i=this.image,n=i._element.width,h=i._element.height;return[1/i.scaleX,0,0,0,1/i.scaleY,0,-i.left/n,-i.top/h,1]},applyTo2d:function(i){var n,h,g,u,f,m,y,w,T,S,D,N=i.imageData,X=i.filterBackend.resources,K=N.data,ee=K.length,Q=N.width,A=N.height,x=this.image;X.blendImage||(X.blendImage=s.util.createCanvasElement()),S=(T=X.blendImage).getContext("2d"),T.width!==Q||T.height!==A?(T.width=Q,T.height=A):S.clearRect(0,0,Q,A),S.setTransform(x.scaleX,0,0,x.scaleY,x.left,x.top),S.drawImage(x._element,0,0,Q,A),D=S.getImageData(0,0,Q,A).data;for(var R=0;R<ee;R+=4)switch(f=K[R],m=K[R+1],y=K[R+2],w=K[R+3],n=D[R],h=D[R+1],g=D[R+2],u=D[R+3],this.mode){case"multiply":K[R]=f*n/255,K[R+1]=m*h/255,K[R+2]=y*g/255,K[R+3]=w*u/255;break;case"mask":K[R+3]=u}},getUniformLocations:function(i,n){return{uTransformMatrix:i.getUniformLocation(n,"uTransformMatrix"),uImage:i.getUniformLocation(n,"uImage")}},sendUniformData:function(i,n){var h=this.calculateMatrix();i.uniform1i(n.uImage,1),i.uniformMatrix3fv(n.uTransformMatrix,!1,h)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),s.Image.filters.BlendImage.fromObject=function(i,n){s.Image.fromObject(i.image,function(h){var g=s.util.object.clone(i);g.image=h,n(new s.Image.filters.BlendImage(g))})}}(e),function(l){var s=l.fabric||(l.fabric={}),o=Math.pow,c=Math.floor,i=Math.sqrt,n=Math.abs,h=Math.round,g=Math.sin,u=Math.ceil,f=s.Image.filters,m=s.util.createClass;f.Resize=m(f.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(y,w){return{uDelta:y.getUniformLocation(w,"uDelta"),uTaps:y.getUniformLocation(w,"uTaps")}},sendUniformData:function(y,w){y.uniform2fv(w.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),y.uniform1fv(w.uTaps,this.taps)},retrieveShader:function(y){var w=this.getFilterWindow(),T=this.type+"_"+w;if(!y.programCache.hasOwnProperty(T)){var S=this.generateShader(w);y.programCache[T]=this.createProgram(y.context,S)}return y.programCache[T]},getFilterWindow:function(){var y=this.tempScale;return Math.ceil(this.lanczosLobes/y)},getTaps:function(){for(var y=this.lanczosCreate(this.lanczosLobes),w=this.tempScale,T=this.getFilterWindow(),S=new Array(T),D=1;D<=T;D++)S[D-1]=y(D*w);return S},generateShader:function(y){for(var w=new Array(y),T=this.fragmentSourceTOP,S=1;S<=y;S++)w[S-1]=S+".0 * uDelta";return T+="uniform float uTaps["+y+`];
`,T+=`void main() {
`,T+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,T+=`  float sum = 1.0;
`,w.forEach(function(D,N){T+="  color += texture2D(uTexture, vTexCoord + "+D+") * uTaps["+N+`];
`,T+="  color += texture2D(uTexture, vTexCoord - "+D+") * uTaps["+N+`];
`,T+="  sum += 2.0 * uTaps["+N+`];
`}),T+=`  gl_FragColor = color / sum;
`,T+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(y){y.webgl?(y.passes++,this.width=y.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=y.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),y.destinationWidth=this.dW,this._setupFrameBuffer(y),this.applyToWebGL(y),this._swapTextures(y),y.sourceWidth=y.destinationWidth,this.height=y.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),y.destinationHeight=this.dH,this._setupFrameBuffer(y),this.applyToWebGL(y),this._swapTextures(y),y.sourceHeight=y.destinationHeight):this.applyTo2d(y)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(y){return function(w){if(w>=y||w<=-y)return 0;if(w<11920929e-14&&w>-11920929e-14)return 1;var T=(w*=Math.PI)/y;return g(w)/w*g(T)/T}},applyTo2d:function(y){var w=y.imageData,T=this.scaleX,S=this.scaleY;this.rcpScaleX=1/T,this.rcpScaleY=1/S;var D,N=w.width,X=w.height,K=h(N*T),ee=h(X*S);this.resizeType==="sliceHack"?D=this.sliceByTwo(y,N,X,K,ee):this.resizeType==="hermite"?D=this.hermiteFastResize(y,N,X,K,ee):this.resizeType==="bilinear"?D=this.bilinearFiltering(y,N,X,K,ee):this.resizeType==="lanczos"&&(D=this.lanczosResize(y,N,X,K,ee)),y.imageData=D},sliceByTwo:function(y,w,T,S,D){var N,X,K=y.imageData,ee=.5,Q=!1,A=!1,x=w*ee,R=T*ee,P=s.filterBackend.resources,U=0,W=0,F=w,L=0;for(P.sliceByTwo||(P.sliceByTwo=document.createElement("canvas")),((N=P.sliceByTwo).width<1.5*w||N.height<T)&&(N.width=1.5*w,N.height=T),(X=N.getContext("2d")).clearRect(0,0,1.5*w,T),X.putImageData(K,0,0),S=c(S),D=c(D);!Q||!A;)w=x,T=R,S<c(x*ee)?x=c(x*ee):(x=S,Q=!0),D<c(R*ee)?R=c(R*ee):(R=D,A=!0),X.drawImage(N,U,W,w,T,F,L,x,R),U=F,W=L,L+=R;return X.getImageData(U,W,S,D)},lanczosResize:function(y,w,T,S,D){var N=y.imageData.data,X=y.ctx.createImageData(S,D),K=X.data,ee=this.lanczosCreate(this.lanczosLobes),Q=this.rcpScaleX,A=this.rcpScaleY,x=2/this.rcpScaleX,R=2/this.rcpScaleY,P=u(Q*this.lanczosLobes/2),U=u(A*this.lanczosLobes/2),W={},F={},L={};return function B(G){var Y,q,ie,ne,re,se,oe,ae,ge,de,xe;for(F.x=(G+.5)*Q,L.x=c(F.x),Y=0;Y<D;Y++){for(F.y=(Y+.5)*A,L.y=c(F.y),re=0,se=0,oe=0,ae=0,ge=0,q=L.x-P;q<=L.x+P;q++)if(!(q<0||q>=w)){de=c(1e3*n(q-F.x)),W[de]||(W[de]={});for(var ke=L.y-U;ke<=L.y+U;ke++)ke<0||ke>=T||(xe=c(1e3*n(ke-F.y)),W[de][xe]||(W[de][xe]=ee(i(o(de*x,2)+o(xe*R,2))/1e3)),(ie=W[de][xe])>0&&(re+=ie,se+=ie*N[ne=4*(ke*w+q)],oe+=ie*N[ne+1],ae+=ie*N[ne+2],ge+=ie*N[ne+3]))}K[ne=4*(Y*S+G)]=se/re,K[ne+1]=oe/re,K[ne+2]=ae/re,K[ne+3]=ge/re}return++G<S?B(G):X}(0)},bilinearFiltering:function(y,w,T,S,D){var N,X,K,ee,Q,A,x,R,P,U=0,W=this.rcpScaleX,F=this.rcpScaleY,L=4*(w-1),B=y.imageData.data,G=y.ctx.createImageData(S,D),Y=G.data;for(K=0;K<D;K++)for(ee=0;ee<S;ee++)for(Q=W*ee-(N=c(W*ee)),A=F*K-(X=c(F*K)),P=4*(X*w+N),x=0;x<4;x++)R=B[P+x]*(1-Q)*(1-A)+B[P+4+x]*Q*(1-A)+B[P+L+x]*A*(1-Q)+B[P+L+4+x]*Q*A,Y[U++]=R;return G},hermiteFastResize:function(y,w,T,S,D){for(var N=this.rcpScaleX,X=this.rcpScaleY,K=u(N/2),ee=u(X/2),Q=y.imageData.data,A=y.ctx.createImageData(S,D),x=A.data,R=0;R<D;R++)for(var P=0;P<S;P++){for(var U=4*(P+R*S),W=0,F=0,L=0,B=0,G=0,Y=0,q=0,ie=(R+.5)*X,ne=c(R*X);ne<(R+1)*X;ne++)for(var re=n(ie-(ne+.5))/ee,se=(P+.5)*N,oe=re*re,ae=c(P*N);ae<(P+1)*N;ae++){var ge=n(se-(ae+.5))/K,de=i(oe+ge*ge);de>1&&de<-1||(W=2*de*de*de-3*de*de+1)>0&&(q+=W*Q[3+(ge=4*(ae+ne*w))],L+=W,Q[ge+3]<255&&(W=W*Q[ge+3]/250),B+=W*Q[ge],G+=W*Q[ge+1],Y+=W*Q[ge+2],F+=W)}x[U]=B/F,x[U+1]=G/F,x[U+2]=Y/F,x[U+3]=q/L}return A},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),s.Image.filters.Resize.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Contrast=c(o.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(i){if(this.contrast!==0){var n,h=i.imageData.data,g=h.length,u=Math.floor(255*this.contrast),f=259*(u+255)/(255*(259-u));for(n=0;n<g;n+=4)h[n]=f*(h[n]-128)+128,h[n+1]=f*(h[n+1]-128)+128,h[n+2]=f*(h[n+2]-128)+128}},getUniformLocations:function(i,n){return{uContrast:i.getUniformLocation(n,"uContrast")}},sendUniformData:function(i,n){i.uniform1f(n.uContrast,this.contrast)}}),s.Image.filters.Contrast.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Saturation=c(o.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(i){if(this.saturation!==0){var n,h,g=i.imageData.data,u=g.length,f=-this.saturation;for(n=0;n<u;n+=4)h=Math.max(g[n],g[n+1],g[n+2]),g[n]+=h!==g[n]?(h-g[n])*f:0,g[n+1]+=h!==g[n+1]?(h-g[n+1])*f:0,g[n+2]+=h!==g[n+2]?(h-g[n+2])*f:0}},getUniformLocations:function(i,n){return{uSaturation:i.getUniformLocation(n,"uSaturation")}},sendUniformData:function(i,n){i.uniform1f(n.uSaturation,-this.saturation)}}),s.Image.filters.Saturation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Vibrance=c(o.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(i){if(this.vibrance!==0){var n,h,g,u,f=i.imageData.data,m=f.length,y=-this.vibrance;for(n=0;n<m;n+=4)h=Math.max(f[n],f[n+1],f[n+2]),g=(f[n]+f[n+1]+f[n+2])/3,u=2*Math.abs(h-g)/255*y,f[n]+=h!==f[n]?(h-f[n])*u:0,f[n+1]+=h!==f[n+1]?(h-f[n+1])*u:0,f[n+2]+=h!==f[n+2]?(h-f[n+2])*u:0}},getUniformLocations:function(i,n){return{uVibrance:i.getUniformLocation(n,"uVibrance")}},sendUniformData:function(i,n){i.uniform1f(n.uVibrance,-this.vibrance)}}),s.Image.filters.Vibrance.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Blur=c(o.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(i){i.webgl?(this.aspectRatio=i.sourceWidth/i.sourceHeight,i.passes++,this._setupFrameBuffer(i),this.horizontal=!0,this.applyToWebGL(i),this._swapTextures(i),this._setupFrameBuffer(i),this.horizontal=!1,this.applyToWebGL(i),this._swapTextures(i)):this.applyTo2d(i)},applyTo2d:function(i){i.imageData=this.simpleBlur(i)},simpleBlur:function(i){var n,h,g=i.filterBackend.resources,u=i.imageData.width,f=i.imageData.height;g.blurLayer1||(g.blurLayer1=s.util.createCanvasElement(),g.blurLayer2=s.util.createCanvasElement()),n=g.blurLayer1,h=g.blurLayer2,n.width===u&&n.height===f||(h.width=n.width=u,h.height=n.height=f);var m,y,w,T,S=n.getContext("2d"),D=h.getContext("2d"),N=.06*this.blur*.5;for(S.putImageData(i.imageData,0,0),D.clearRect(0,0,u,f),T=-15;T<=15;T++)w=N*(y=T/15)*u+(m=(Math.random()-.5)/4),D.globalAlpha=1-Math.abs(y),D.drawImage(n,w,m),S.drawImage(h,0,0),D.globalAlpha=1,D.clearRect(0,0,h.width,h.height);for(T=-15;T<=15;T++)w=N*(y=T/15)*f+(m=(Math.random()-.5)/4),D.globalAlpha=1-Math.abs(y),D.drawImage(n,m,w),S.drawImage(h,0,0),D.globalAlpha=1,D.clearRect(0,0,h.width,h.height);i.ctx.drawImage(n,0,0);var X=i.ctx.getImageData(0,0,n.width,n.height);return S.globalAlpha=1,S.clearRect(0,0,n.width,n.height),X},getUniformLocations:function(i,n){return{delta:i.getUniformLocation(n,"uDelta")}},sendUniformData:function(i,n){var h=this.chooseRightDelta();i.uniform2fv(n.delta,h)},chooseRightDelta:function(){var i,n=1,h=[0,0];return this.horizontal?this.aspectRatio>1&&(n=1/this.aspectRatio):this.aspectRatio<1&&(n=this.aspectRatio),i=n*this.blur*.12,this.horizontal?h[0]=i:h[1]=i,h}}),o.Blur.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Gamma=c(o.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(i){this.gamma=[1,1,1],o.BaseFilter.prototype.initialize.call(this,i)},applyTo2d:function(i){var n,h=i.imageData.data,g=this.gamma,u=h.length,f=1/g[0],m=1/g[1],y=1/g[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),n=0,u=256;n<u;n++)this.rVals[n]=255*Math.pow(n/255,f),this.gVals[n]=255*Math.pow(n/255,m),this.bVals[n]=255*Math.pow(n/255,y);for(n=0,u=h.length;n<u;n+=4)h[n]=this.rVals[h[n]],h[n+1]=this.gVals[h[n+1]],h[n+2]=this.bVals[h[n+2]]},getUniformLocations:function(i,n){return{uGamma:i.getUniformLocation(n,"uGamma")}},sendUniformData:function(i,n){i.uniform3fv(n.uGamma,this.gamma)}}),s.Image.filters.Gamma.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.Composed=c(o.BaseFilter,{type:"Composed",subFilters:[],initialize:function(i){this.callSuper("initialize",i),this.subFilters=this.subFilters.slice(0)},applyTo:function(i){i.passes+=this.subFilters.length-1,this.subFilters.forEach(function(n){n.applyTo(i)})},toObject:function(){return s.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(i){return i.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(i){return!i.isNeutralState()})}}),s.Image.filters.Composed.fromObject=function(i,n){var h=(i.subFilters||[]).map(function(u){return new s.Image.filters[u.type](u)}),g=new s.Image.filters.Composed({subFilters:h});return n&&n(g),g}}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.Image.filters,c=s.util.createClass;o.HueRotation=c(o.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var i=this.rotation*Math.PI,n=s.util.cos(i),h=s.util.sin(i),g=1/3,u=Math.sqrt(g)*h,f=1-n;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=n+f/3,this.matrix[1]=g*f-u,this.matrix[2]=g*f+u,this.matrix[5]=g*f+u,this.matrix[6]=n+g*f,this.matrix[7]=g*f-u,this.matrix[10]=g*f-u,this.matrix[11]=g*f+u,this.matrix[12]=n+g*f},isNeutralState:function(i){return this.calculateMatrix(),o.BaseFilter.prototype.isNeutralState.call(this,i)},applyTo:function(i){this.calculateMatrix(),o.BaseFilter.prototype.applyTo.call(this,i)}}),s.Image.filters.HueRotation.fromObject=s.Image.filters.BaseFilter.fromObject}(e),function(l){var s=l.fabric||(l.fabric={}),o=s.util.object.clone;if(s.Text)s.warn("fabric.Text is already defined");else{var c="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");s.Text=s.util.createClass(s.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:s.Object.prototype.stateProperties.concat(c),cacheProperties:s.Object.prototype.cacheProperties.concat(c),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(i,n){this.styles=n&&n.styles||{},this.text=i,this.__skipDimension=!0,this.callSuper("initialize",n),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var i=this.path;i&&(i.segmentsInfo=s.util.getPathSegmentsInfo(i.path))},getMeasuringContext:function(){return s._measuringContext||(s._measuringContext=this.canvas&&this.canvas.contextCache||s.util.createCanvasElement().getContext("2d")),s._measuringContext},_splitText:function(){var i=this._splitTextIntoLines(this.text);return this.textLines=i.lines,this._textLines=i.graphemeLines,this._unwrappedTextLines=i._unwrappedLines,this._text=i.graphemeText,i},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var i,n,h,g,u,f,m,y=0,w=this._textLines.length;y<w;y++)if((this.textAlign==="justify"||y!==w-1&&!this.isEndOfWrapping(y))&&(g=0,u=this._textLines[y],(n=this.getLineWidth(y))<this.width&&(m=this.textLines[y].match(this._reSpacesAndTabs)))){h=m.length,i=(this.width-n)/h;for(var T=0,S=u.length;T<=S;T++)f=this.__charBounds[y][T],this._reSpaceAndTab.test(u[T])?(f.width+=i,f.kernedWidth+=i,f.left+=g,g+=i):f.left+=g}},isEndOfWrapping:function(i){return i===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var i=this.callSuper("_getCacheCanvasDimensions"),n=this.fontSize;return i.width+=n*i.zoomX,i.height+=n*i.zoomY,i},_render:function(i){var n=this.path;n&&!n.isNotVisible()&&n._render(i),this._setTextStyles(i),this._renderTextLinesBackground(i),this._renderTextDecoration(i,"underline"),this._renderText(i),this._renderTextDecoration(i,"overline"),this._renderTextDecoration(i,"linethrough")},_renderText:function(i){this.paintFirst==="stroke"?(this._renderTextStroke(i),this._renderTextFill(i)):(this._renderTextFill(i),this._renderTextStroke(i))},_setTextStyles:function(i,n,h){if(i.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":i.textBaseline="middle";break;case"ascender":i.textBaseline="top";break;case"descender":i.textBaseline="bottom"}i.font=this._getFontDeclaration(n,h)},calcTextWidth:function(){for(var i=this.getLineWidth(0),n=1,h=this._textLines.length;n<h;n++){var g=this.getLineWidth(n);g>i&&(i=g)}return i},_renderTextLine:function(i,n,h,g,u,f){this._renderChars(i,n,h,g,u,f)},_renderTextLinesBackground:function(i){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var n,h,g,u,f,m,y,w=i.fillStyle,T=this._getLeftOffset(),S=this._getTopOffset(),D=0,N=0,X=this.path,K=0,ee=this._textLines.length;K<ee;K++)if(n=this.getHeightOfLine(K),this.textBackgroundColor||this.styleHas("textBackgroundColor",K)){g=this._textLines[K],h=this._getLineLeftOffset(K),N=0,D=0,u=this.getValueOfPropertyAt(K,0,"textBackgroundColor");for(var Q=0,A=g.length;Q<A;Q++)f=this.__charBounds[K][Q],m=this.getValueOfPropertyAt(K,Q,"textBackgroundColor"),X?(i.save(),i.translate(f.renderLeft,f.renderTop),i.rotate(f.angle),i.fillStyle=m,m&&i.fillRect(-f.width/2,-n/this.lineHeight*(1-this._fontSizeFraction),f.width,n/this.lineHeight),i.restore()):m!==u?(y=T+h+D,this.direction==="rtl"&&(y=this.width-y-N),i.fillStyle=u,u&&i.fillRect(y,S,N,n/this.lineHeight),D=f.left,N=f.width,u=m):N+=f.kernedWidth;m&&!X&&(y=T+h+D,this.direction==="rtl"&&(y=this.width-y-N),i.fillStyle=m,i.fillRect(y,S,N,n/this.lineHeight)),S+=n}else S+=n;i.fillStyle=w,this._removeShadow(i)}},getFontCache:function(i){var n=i.fontFamily.toLowerCase();s.charWidthsCache[n]||(s.charWidthsCache[n]={});var h=s.charWidthsCache[n],g=i.fontStyle.toLowerCase()+"_"+(i.fontWeight+"").toLowerCase();return h[g]||(h[g]={}),h[g]},_measureChar:function(i,n,h,g){var u,f,m,y,w=this.getFontCache(n),T=h+i,S=this._getFontDeclaration(n)===this._getFontDeclaration(g),D=n.fontSize/this.CACHE_FONT_SIZE;if(h&&w[h]!==void 0&&(m=w[h]),w[i]!==void 0&&(y=u=w[i]),S&&w[T]!==void 0&&(y=(f=w[T])-m),u===void 0||m===void 0||f===void 0){var N=this.getMeasuringContext();this._setTextStyles(N,n,!0)}return u===void 0&&(y=u=N.measureText(i).width,w[i]=u),m===void 0&&S&&h&&(m=N.measureText(h).width,w[h]=m),S&&f===void 0&&(f=N.measureText(T).width,w[T]=f,y=f-m),{width:u*D,kernedWidth:y*D}},getHeightOfChar:function(i,n){return this.getValueOfPropertyAt(i,n,"fontSize")},measureLine:function(i){var n=this._measureLine(i);return this.charSpacing!==0&&(n.width-=this._getWidthOfCharSpacing()),n.width<0&&(n.width=0),n},_measureLine:function(i){var n,h,g,u,f,m,y=0,w=this._textLines[i],T=new Array(w.length),S=0,D=this.path,N=this.pathSide==="right";for(this.__charBounds[i]=T,n=0;n<w.length;n++)h=w[n],u=this._getGraphemeBox(h,i,n,g),T[n]=u,y+=u.kernedWidth,g=h;if(T[n]={left:u?u.left+u.width:0,width:0,kernedWidth:0,height:this.fontSize},D){switch(m=D.segmentsInfo[D.segmentsInfo.length-1].length,(f=s.util.getPointOnPath(D.path,0,D.segmentsInfo)).x+=D.pathOffset.x,f.y+=D.pathOffset.y,this.textAlign){case"left":S=N?m-y:0;break;case"center":S=(m-y)/2;break;case"right":S=N?0:m-y}for(S+=this.pathStartOffset*(N?-1:1),n=N?w.length-1:0;N?n>=0:n<w.length;N?n--:n++)u=T[n],S>m?S%=m:S<0&&(S+=m),this._setGraphemeOnPath(S,u,f),S+=u.kernedWidth}return{width:y,numOfSpaces:0}},_setGraphemeOnPath:function(i,n,h){var g=i+n.kernedWidth/2,u=this.path,f=s.util.getPointOnPath(u.path,g,u.segmentsInfo);n.renderLeft=f.x-h.x,n.renderTop=f.y-h.y,n.angle=f.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(i,n,h,g,u){var f,m=this.getCompleteStyleDeclaration(n,h),y=g?this.getCompleteStyleDeclaration(n,h-1):{},w=this._measureChar(i,m,g,y),T=w.kernedWidth,S=w.width;this.charSpacing!==0&&(S+=f=this._getWidthOfCharSpacing(),T+=f);var D={width:S,left:0,height:m.fontSize,kernedWidth:T,deltaY:m.deltaY};if(h>0&&!u){var N=this.__charBounds[n][h-1];D.left=N.left+N.width+w.kernedWidth-w.width}return D},getHeightOfLine:function(i){if(this.__lineHeights[i])return this.__lineHeights[i];for(var n=this._textLines[i],h=this.getHeightOfChar(i,0),g=1,u=n.length;g<u;g++)h=Math.max(this.getHeightOfChar(i,g),h);return this.__lineHeights[i]=h*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var i,n=0,h=0,g=this._textLines.length;h<g;h++)i=this.getHeightOfLine(h),n+=h===g-1?i/this.lineHeight:i;return n},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(i,n){i.save();for(var h=0,g=this._getLeftOffset(),u=this._getTopOffset(),f=0,m=this._textLines.length;f<m;f++){var y=this.getHeightOfLine(f),w=y/this.lineHeight,T=this._getLineLeftOffset(f);this._renderTextLine(n,i,this._textLines[f],g+T,u+h+w,f),h+=y}i.restore()},_renderTextFill:function(i){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(i,"fillText")},_renderTextStroke:function(i){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(i),i.save(),this._setLineDash(i,this.strokeDashArray),i.beginPath(),this._renderTextCommon(i,"strokeText"),i.closePath(),i.restore())},_renderChars:function(i,n,h,g,u,f){var m,y,w,T,S,D=this.getHeightOfLine(f),N=this.textAlign.indexOf("justify")!==-1,X="",K=0,ee=this.path,Q=!N&&this.charSpacing===0&&this.isEmptyStyles(f)&&!ee,A=this.direction==="ltr",x=this.direction==="ltr"?1:-1,R=n.canvas.getAttribute("dir");if(n.save(),R!==this.direction&&(n.canvas.setAttribute("dir",A?"ltr":"rtl"),n.direction=A?"ltr":"rtl",n.textAlign=A?"left":"right"),u-=D*this._fontSizeFraction/this.lineHeight,Q)return this._renderChar(i,n,f,0,h.join(""),g,u,D),void n.restore();for(var P=0,U=h.length-1;P<=U;P++)T=P===U||this.charSpacing||ee,X+=h[P],w=this.__charBounds[f][P],K===0?(g+=x*(w.kernedWidth-w.width),K+=w.width):K+=w.kernedWidth,N&&!T&&this._reSpaceAndTab.test(h[P])&&(T=!0),T||(m=m||this.getCompleteStyleDeclaration(f,P),y=this.getCompleteStyleDeclaration(f,P+1),T=this._hasStyleChanged(m,y)),T&&(ee?(n.save(),n.translate(w.renderLeft,w.renderTop),n.rotate(w.angle),this._renderChar(i,n,f,P,X,-K/2,0,D),n.restore()):(S=g,this._renderChar(i,n,f,P,X,S,u,D)),X="",m=y,g+=x*K,K=0);n.restore()},_applyPatternGradientTransformText:function(i){var n,h=s.util.createCanvasElement(),g=this.width+this.strokeWidth,u=this.height+this.strokeWidth;return h.width=g,h.height=u,(n=h.getContext("2d")).beginPath(),n.moveTo(0,0),n.lineTo(g,0),n.lineTo(g,u),n.lineTo(0,u),n.closePath(),n.translate(g/2,u/2),n.fillStyle=i.toLive(n),this._applyPatternGradientTransform(n,i),n.fill(),n.createPattern(h,"no-repeat")},handleFiller:function(i,n,h){var g,u;return h.toLive?h.gradientUnits==="percentage"||h.gradientTransform||h.patternTransform?(g=-this.width/2,u=-this.height/2,i.translate(g,u),i[n]=this._applyPatternGradientTransformText(h),{offsetX:g,offsetY:u}):(i[n]=h.toLive(i,this),this._applyPatternGradientTransform(i,h)):(i[n]=h,{offsetX:0,offsetY:0})},_setStrokeStyles:function(i,n){return i.lineWidth=n.strokeWidth,i.lineCap=this.strokeLineCap,i.lineDashOffset=this.strokeDashOffset,i.lineJoin=this.strokeLineJoin,i.miterLimit=this.strokeMiterLimit,this.handleFiller(i,"strokeStyle",n.stroke)},_setFillStyles:function(i,n){return this.handleFiller(i,"fillStyle",n.fill)},_renderChar:function(i,n,h,g,u,f,m){var y,w,T=this._getStyleDeclaration(h,g),S=this.getCompleteStyleDeclaration(h,g),D=i==="fillText"&&S.fill,N=i==="strokeText"&&S.stroke&&S.strokeWidth;(N||D)&&(n.save(),D&&(y=this._setFillStyles(n,S)),N&&(w=this._setStrokeStyles(n,S)),n.font=this._getFontDeclaration(S),T&&T.textBackgroundColor&&this._removeShadow(n),T&&T.deltaY&&(m+=T.deltaY),D&&n.fillText(u,f-y.offsetX,m-y.offsetY),N&&n.strokeText(u,f-w.offsetX,m-w.offsetY),n.restore())},setSuperscript:function(i,n){return this._setScript(i,n,this.superscript)},setSubscript:function(i,n){return this._setScript(i,n,this.subscript)},_setScript:function(i,n,h){var g=this.get2DCursorLocation(i,!0),u=this.getValueOfPropertyAt(g.lineIndex,g.charIndex,"fontSize"),f=this.getValueOfPropertyAt(g.lineIndex,g.charIndex,"deltaY"),m={fontSize:u*h.size,deltaY:f+u*h.baseline};return this.setSelectionStyles(m,i,n),this},_hasStyleChanged:function(i,n){return i.fill!==n.fill||i.stroke!==n.stroke||i.strokeWidth!==n.strokeWidth||i.fontSize!==n.fontSize||i.fontFamily!==n.fontFamily||i.fontWeight!==n.fontWeight||i.fontStyle!==n.fontStyle||i.deltaY!==n.deltaY},_hasStyleChangedForSvg:function(i,n){return this._hasStyleChanged(i,n)||i.overline!==n.overline||i.underline!==n.underline||i.linethrough!==n.linethrough},_getLineLeftOffset:function(i){var n=this.getLineWidth(i),h=this.width-n,g=this.textAlign,u=this.direction,f=0,m=this.isEndOfWrapping(i);return g==="justify"||g==="justify-center"&&!m||g==="justify-right"&&!m||g==="justify-left"&&!m?0:(g==="center"&&(f=h/2),g==="right"&&(f=h),g==="justify-center"&&(f=h/2),g==="justify-right"&&(f=h),u==="rtl"&&(f-=h),f)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var i=this._forceClearCache;return i||(i=this.hasStateChanged("_dimensionAffectingProps")),i&&(this.dirty=!0,this._forceClearCache=!1),i},getLineWidth:function(i){if(this.__lineWidths[i]!==void 0)return this.__lineWidths[i];var n=this.measureLine(i).width;return this.__lineWidths[i]=n,n},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(i,n,h){var g=this._getStyleDeclaration(i,n);return g&&g[h]!==void 0?g[h]:this[h]},_renderTextDecoration:function(i,n){if(this[n]||this.styleHas(n)){for(var h,g,u,f,m,y,w,T,S,D,N,X,K,ee,Q,A,x=this._getLeftOffset(),R=this._getTopOffset(),P=this.path,U=this._getWidthOfCharSpacing(),W=this.offsets[n],F=0,L=this._textLines.length;F<L;F++)if(h=this.getHeightOfLine(F),this[n]||this.styleHas(n,F)){w=this._textLines[F],ee=h/this.lineHeight,f=this._getLineLeftOffset(F),D=0,N=0,T=this.getValueOfPropertyAt(F,0,n),A=this.getValueOfPropertyAt(F,0,"fill"),S=R+ee*(1-this._fontSizeFraction),g=this.getHeightOfChar(F,0),m=this.getValueOfPropertyAt(F,0,"deltaY");for(var B=0,G=w.length;B<G;B++)if(X=this.__charBounds[F][B],K=this.getValueOfPropertyAt(F,B,n),Q=this.getValueOfPropertyAt(F,B,"fill"),u=this.getHeightOfChar(F,B),y=this.getValueOfPropertyAt(F,B,"deltaY"),P&&K&&Q)i.save(),i.fillStyle=A,i.translate(X.renderLeft,X.renderTop),i.rotate(X.angle),i.fillRect(-X.kernedWidth/2,W*u+y,X.kernedWidth,this.fontSize/15),i.restore();else if((K!==T||Q!==A||u!==g||y!==m)&&N>0){var Y=x+f+D;this.direction==="rtl"&&(Y=this.width-Y-N),T&&A&&(i.fillStyle=A,i.fillRect(Y,S+W*g+m,N,this.fontSize/15)),D=X.left,N=X.width,T=K,A=Q,g=u,m=y}else N+=X.kernedWidth;Y=x+f+D,this.direction==="rtl"&&(Y=this.width-Y-N),i.fillStyle=Q,K&&Q&&i.fillRect(Y,S+W*g+m,N-U,this.fontSize/15),R+=h}else R+=h;this._removeShadow(i)}},_getFontDeclaration:function(i,n){var h=i||this,g=this.fontFamily,u=s.Text.genericFonts.indexOf(g.toLowerCase())>-1,f=g===void 0||g.indexOf("'")>-1||g.indexOf(",")>-1||g.indexOf('"')>-1||u?h.fontFamily:'"'+h.fontFamily+'"';return[s.isLikelyNode?h.fontWeight:h.fontStyle,s.isLikelyNode?h.fontStyle:h.fontWeight,n?this.CACHE_FONT_SIZE+"px":h.fontSize+"px",f].join(" ")},render:function(i){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",i)))},_splitTextIntoLines:function(i){for(var n=i.split(this._reNewline),h=new Array(n.length),g=[`
`],u=[],f=0;f<n.length;f++)h[f]=s.util.string.graphemeSplit(n[f]),u=u.concat(h[f],g);return u.pop(),{_unwrappedLines:h,lines:n,graphemeText:u,graphemeLines:h}},toObject:function(i){var n=c.concat(i),h=this.callSuper("toObject",n);return h.styles=o(this.styles,!0),h.path&&(h.path=this.path.toObject()),h},set:function(i,n){this.callSuper("set",i,n);var h=!1,g=!1;if(typeof i=="object")for(var u in i)u==="path"&&this.setPathInfo(),h=h||this._dimensionAffectingProps.indexOf(u)!==-1,g=g||u==="path";else h=this._dimensionAffectingProps.indexOf(i)!==-1,g=i==="path";return g&&this.setPathInfo(),h&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),s.Text.ATTRIBUTE_NAMES=s.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),s.Text.DEFAULT_SVG_FONT_SIZE=16,s.Text.fromElement=function(i,n,h){if(!i)return n(null);var g=s.parseAttributes(i,s.Text.ATTRIBUTE_NAMES),u=g.textAnchor||"left";if((h=s.util.object.extend(h?o(h):{},g)).top=h.top||0,h.left=h.left||0,g.textDecoration){var f=g.textDecoration;f.indexOf("underline")!==-1&&(h.underline=!0),f.indexOf("overline")!==-1&&(h.overline=!0),f.indexOf("line-through")!==-1&&(h.linethrough=!0),delete h.textDecoration}"dx"in g&&(h.left+=g.dx),"dy"in g&&(h.top+=g.dy),"fontSize"in h||(h.fontSize=s.Text.DEFAULT_SVG_FONT_SIZE);var m="";"textContent"in i?m=i.textContent:"firstChild"in i&&i.firstChild!==null&&"data"in i.firstChild&&i.firstChild.data!==null&&(m=i.firstChild.data),m=m.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var y=h.strokeWidth;h.strokeWidth=0;var w=new s.Text(m,h),T=w.getScaledHeight()/w.height,S=((w.height+w.strokeWidth)*w.lineHeight-w.height)*T,D=w.getScaledHeight()+S,N=0;u==="center"&&(N=w.getScaledWidth()/2),u==="right"&&(N=w.getScaledWidth()),w.set({left:w.left-N,top:w.top-(D-w.fontSize*(.07+w._fontSizeFraction))/w.lineHeight,strokeWidth:y!==void 0?y:1}),n(w)},s.Text.fromObject=function(i,n){var h=o(i),g=i.path;return delete h.path,s.Object._fromObject("Text",h,function(u){g?s.Object._fromObject("Path",g,function(f){u.set("path",f),n(u)},"path"):n(u)},"text")},s.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],s.util.createAccessors&&s.util.createAccessors(s.Text)}}(e),v.util.object.extend(v.Text.prototype,{isEmptyStyles:function(l){if(!this.styles||l!==void 0&&!this.styles[l])return!0;var s=l===void 0?this.styles:{line:this.styles[l]};for(var o in s)for(var c in s[o])for(var i in s[o][c])return!1;return!0},styleHas:function(l,s){if(!this.styles||!l||l===""||s!==void 0&&!this.styles[s])return!1;var o=s===void 0?this.styles:{0:this.styles[s]};for(var c in o)for(var i in o[c])if(o[c][i][l]!==void 0)return!0;return!1},cleanStyle:function(l){if(!this.styles||!l||l==="")return!1;var s,o,c=this.styles,i=0,n=!0,h=0;for(var g in c){for(var u in s=0,c[g]){var f;i++,(f=c[g][u]).hasOwnProperty(l)?(o?f[l]!==o&&(n=!1):o=f[l],f[l]===this[l]&&delete f[l]):n=!1,Object.keys(f).length!==0?s++:delete c[g][u]}s===0&&delete c[g]}for(var m=0;m<this._textLines.length;m++)h+=this._textLines[m].length;n&&i===h&&(this[l]=o,this.removeStyle(l))},removeStyle:function(l){if(this.styles&&l&&l!==""){var s,o,c,i=this.styles;for(o in i){for(c in s=i[o])delete s[c][l],Object.keys(s[c]).length===0&&delete s[c];Object.keys(s).length===0&&delete i[o]}}},_extendStyles:function(l,s){var o=this.get2DCursorLocation(l);this._getLineStyle(o.lineIndex)||this._setLineStyle(o.lineIndex),this._getStyleDeclaration(o.lineIndex,o.charIndex)||this._setStyleDeclaration(o.lineIndex,o.charIndex,{}),v.util.object.extend(this._getStyleDeclaration(o.lineIndex,o.charIndex),s)},get2DCursorLocation:function(l,s){l===void 0&&(l=this.selectionStart);for(var o=s?this._unwrappedTextLines:this._textLines,c=o.length,i=0;i<c;i++){if(l<=o[i].length)return{lineIndex:i,charIndex:l};l-=o[i].length+this.missingNewlineOffset(i)}return{lineIndex:i-1,charIndex:o[i-1].length<l?o[i-1].length:l}},getSelectionStyles:function(l,s,o){l===void 0&&(l=this.selectionStart||0),s===void 0&&(s=this.selectionEnd||l);for(var c=[],i=l;i<s;i++)c.push(this.getStyleAtPosition(i,o));return c},getStyleAtPosition:function(l,s){var o=this.get2DCursorLocation(l);return(s?this.getCompleteStyleDeclaration(o.lineIndex,o.charIndex):this._getStyleDeclaration(o.lineIndex,o.charIndex))||{}},setSelectionStyles:function(l,s,o){s===void 0&&(s=this.selectionStart||0),o===void 0&&(o=this.selectionEnd||s);for(var c=s;c<o;c++)this._extendStyles(c,l);return this._forceClearCache=!0,this},_getStyleDeclaration:function(l,s){var o=this.styles&&this.styles[l];return o?o[s]:null},getCompleteStyleDeclaration:function(l,s){for(var o,c=this._getStyleDeclaration(l,s)||{},i={},n=0;n<this._styleProperties.length;n++)i[o=this._styleProperties[n]]=c[o]===void 0?this[o]:c[o];return i},_setStyleDeclaration:function(l,s,o){this.styles[l][s]=o},_deleteStyleDeclaration:function(l,s){delete this.styles[l][s]},_getLineStyle:function(l){return!!this.styles[l]},_setLineStyle:function(l){this.styles[l]={}},_deleteLineStyle:function(l){delete this.styles[l]}}),function(){function l(s){s.textDecoration&&(s.textDecoration.indexOf("underline")>-1&&(s.underline=!0),s.textDecoration.indexOf("line-through")>-1&&(s.linethrough=!0),s.textDecoration.indexOf("overline")>-1&&(s.overline=!0),delete s.textDecoration)}v.IText=v.util.createClass(v.Text,v.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(s,o){this.callSuper("initialize",s,o),this.initBehavior()},setSelectionStart:function(s){s=Math.max(s,0),this._updateAndFire("selectionStart",s)},setSelectionEnd:function(s){s=Math.min(s,this.text.length),this._updateAndFire("selectionEnd",s)},_updateAndFire:function(s,o){this[s]!==o&&(this._fireSelectionChanged(),this[s]=o),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(s){this.clearContextTop(),this.callSuper("render",s),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(s){this.callSuper("_render",s)},clearContextTop:function(s){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var o=this.canvas.contextTop,c=this.canvas.viewportTransform;o.save(),o.transform(c[0],c[1],c[2],c[3],c[4],c[5]),this.transform(o),this._clearTextArea(o),s||o.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var s=this._getCursorBoundaries(),o=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(s,o):this.renderSelection(s,o),o.restore()}},_clearTextArea:function(s){var o=this.width+4,c=this.height+4;s.clearRect(-o/2,-c/2,o,c)},_getCursorBoundaries:function(s){s===void 0&&(s=this.selectionStart);var o=this._getLeftOffset(),c=this._getTopOffset(),i=this._getCursorBoundariesOffsets(s);return{left:o,top:c,leftOffset:i.left,topOffset:i.top}},_getCursorBoundariesOffsets:function(s){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var o,c,i,n,h=0,g=0,u=this.get2DCursorLocation(s);i=u.charIndex,c=u.lineIndex;for(var f=0;f<c;f++)h+=this.getHeightOfLine(f);o=this._getLineLeftOffset(c);var m=this.__charBounds[c][i];return m&&(g=m.left),this.charSpacing!==0&&i===this._textLines[c].length&&(g-=this._getWidthOfCharSpacing()),n={top:h,left:o+(g>0?g:0)},this.direction==="rtl"&&(n.left*=-1),this.cursorOffsetCache=n,this.cursorOffsetCache},renderCursor:function(s,o){var c=this.get2DCursorLocation(),i=c.lineIndex,n=c.charIndex>0?c.charIndex-1:0,h=this.getValueOfPropertyAt(i,n,"fontSize"),g=this.scaleX*this.canvas.getZoom(),u=this.cursorWidth/g,f=s.topOffset,m=this.getValueOfPropertyAt(i,n,"deltaY");f+=(1-this._fontSizeFraction)*this.getHeightOfLine(i)/this.lineHeight-h*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(s,o),o.fillStyle=this.cursorColor||this.getValueOfPropertyAt(i,n,"fill"),o.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,o.fillRect(s.left+s.leftOffset-u/2,f+s.top+m,u,h)},renderSelection:function(s,o){for(var c=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,i=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,n=this.textAlign.indexOf("justify")!==-1,h=this.get2DCursorLocation(c),g=this.get2DCursorLocation(i),u=h.lineIndex,f=g.lineIndex,m=h.charIndex<0?0:h.charIndex,y=g.charIndex<0?0:g.charIndex,w=u;w<=f;w++){var T,S=this._getLineLeftOffset(w)||0,D=this.getHeightOfLine(w),N=0,X=0;if(w===u&&(N=this.__charBounds[u][m].left),w>=u&&w<f)X=n&&!this.isEndOfWrapping(w)?this.width:this.getLineWidth(w)||5;else if(w===f)if(y===0)X=this.__charBounds[f][y].left;else{var K=this._getWidthOfCharSpacing();X=this.__charBounds[f][y-1].left+this.__charBounds[f][y-1].width-K}T=D,(this.lineHeight<1||w===f&&this.lineHeight>1)&&(D/=this.lineHeight);var ee=s.left+S+N,Q=X-N,A=D,x=0;this.inCompositionMode?(o.fillStyle=this.compositionColor||"black",A=1,x=D):o.fillStyle=this.selectionColor,this.direction==="rtl"&&(ee=this.width-ee-Q),o.fillRect(ee,s.top+s.topOffset+x,Q,A),s.topOffset+=T}},getCurrentCharFontSize:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fontSize")},getCurrentCharColor:function(){var s=this._getCurrentCharIndex();return this.getValueOfPropertyAt(s.l,s.c,"fill")},_getCurrentCharIndex:function(){var s=this.get2DCursorLocation(this.selectionStart,!0),o=s.charIndex>0?s.charIndex-1:0;return{l:s.lineIndex,c:o}}}),v.IText.fromObject=function(s,o){if(l(s),s.styles)for(var c in s.styles)for(var i in s.styles[c])l(s.styles[c][i]);v.Object._fromObject("IText",s,o,"text")}}(),be=v.util.object.clone,v.util.object.extend(v.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var l=this;this.on("added",function(){var s=l.canvas;s&&(s._hasITextHandlers||(s._hasITextHandlers=!0,l._initCanvasHandlers(s)),s._iTextInstances=s._iTextInstances||[],s._iTextInstances.push(l))})},initRemovedHandler:function(){var l=this;this.on("removed",function(){var s=l.canvas;s&&(s._iTextInstances=s._iTextInstances||[],v.util.removeFromArray(s._iTextInstances,l),s._iTextInstances.length===0&&(s._hasITextHandlers=!1,l._removeCanvasHandlers(s)))})},_initCanvasHandlers:function(l){l._mouseUpITextHandler=function(){l._iTextInstances&&l._iTextInstances.forEach(function(s){s.__isMousedown=!1})},l.on("mouse:up",l._mouseUpITextHandler)},_removeCanvasHandlers:function(l){l.off("mouse:up",l._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(l,s,o,c){var i;return i={isAborted:!1,abort:function(){this.isAborted=!0}},l.animate("_currentCursorOpacity",s,{duration:o,onComplete:function(){i.isAborted||l[c]()},onChange:function(){l.canvas&&l.selectionStart===l.selectionEnd&&l.renderCursorOrSelection()},abort:function(){return i.isAborted}}),i},_onTickComplete:function(){var l=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){l._currentTickCompleteState=l._animateCursor(l,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(l){var s=this,o=l?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){s._tick()},o)},abortCursorAnimation:function(){var l=this._currentTickState||this._currentTickCompleteState,s=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,l&&s&&s.clearContext(s.contextTop||s.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(l){var s=0,o=l-1;if(this._reSpace.test(this._text[o]))for(;this._reSpace.test(this._text[o]);)s++,o--;for(;/\S/.test(this._text[o])&&o>-1;)s++,o--;return l-s},findWordBoundaryRight:function(l){var s=0,o=l;if(this._reSpace.test(this._text[o]))for(;this._reSpace.test(this._text[o]);)s++,o++;for(;/\S/.test(this._text[o])&&o<this._text.length;)s++,o++;return l+s},findLineBoundaryLeft:function(l){for(var s=0,o=l-1;!/\n/.test(this._text[o])&&o>-1;)s++,o--;return l-s},findLineBoundaryRight:function(l){for(var s=0,o=l;!/\n/.test(this._text[o])&&o<this._text.length;)s++,o++;return l+s},searchWordBoundary:function(l,s){for(var o=this._text,c=this._reSpace.test(o[l])?l-1:l,i=o[c],n=v.reNonWord;!n.test(i)&&c>0&&c<o.length;)i=o[c+=s];return n.test(i)&&(c+=s===1?0:1),c},selectWord:function(l){l=l||this.selectionStart;var s=this.searchWordBoundary(l,-1),o=this.searchWordBoundary(l,1);this.selectionStart=s,this.selectionEnd=o,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(l){l=l||this.selectionStart;var s=this.findLineBoundaryLeft(l),o=this.findLineBoundaryRight(l);return this.selectionStart=s,this.selectionEnd=o,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(l){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(l),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(l){l._iTextInstances&&l._iTextInstances.forEach(function(s){s.selected=!1,s.isEditing&&s.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(l){if(this.__isMousedown&&this.isEditing){var s=this.getSelectionStartFromPointer(l.e),o=this.selectionStart,c=this.selectionEnd;(s===this.__selectionStartOnMouseDown&&o!==c||o!==s&&c!==s)&&(s>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=s):(this.selectionStart=s,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===o&&this.selectionEnd===c||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(l,s,o){var c=o.slice(0,l),i=v.util.string.graphemeSplit(c).length;if(l===s)return{selectionStart:i,selectionEnd:i};var n=o.slice(l,s);return{selectionStart:i,selectionEnd:i+v.util.string.graphemeSplit(n).length}},fromGraphemeToStringSelection:function(l,s,o){var c=o.slice(0,l).join("").length;return l===s?{selectionStart:c,selectionEnd:c}:{selectionStart:c,selectionEnd:c+o.slice(l,s).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var l=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=l.selectionStart,this.hiddenTextarea.selectionEnd=l.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var l=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=l.selectionEnd,this.inCompositionMode||(this.selectionStart=l.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var l=this._calcTextareaPosition();this.hiddenTextarea.style.left=l.left,this.hiddenTextarea.style.top=l.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var l=this.inCompositionMode?this.compositionStart:this.selectionStart,s=this._getCursorBoundaries(l),o=this.get2DCursorLocation(l),c=o.lineIndex,i=o.charIndex,n=this.getValueOfPropertyAt(c,i,"fontSize")*this.lineHeight,h=s.leftOffset,g=this.calcTransformMatrix(),u={x:s.left+h,y:s.top+s.topOffset+n},f=this.canvas.getRetinaScaling(),m=this.canvas.upperCanvasEl,y=m.width/f,w=m.height/f,T=y-n,S=w-n,D=m.clientWidth/y,N=m.clientHeight/w;return u=v.util.transformPoint(u,g),(u=v.util.transformPoint(u,this.canvas.viewportTransform)).x*=D,u.y*=N,u.x<0&&(u.x=0),u.x>T&&(u.x=T),u.y<0&&(u.y=0),u.y>S&&(u.y=S),u.x+=this.canvas._offset.left,u.y+=this.canvas._offset.top,{left:u.x+"px",top:u.y+"px",fontSize:n+"px",charHeight:n}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var l=this._textBeforeEdit!==this.text,s=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,s&&(s.blur&&s.blur(),s.parentNode&&s.parentNode.removeChild(s)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),l&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),l&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var l in this.styles)this._textLines[l]||delete this.styles[l]},removeStyleFromTo:function(l,s){var o,c,i=this.get2DCursorLocation(l,!0),n=this.get2DCursorLocation(s,!0),h=i.lineIndex,g=i.charIndex,u=n.lineIndex,f=n.charIndex;if(h!==u){if(this.styles[h])for(o=g;o<this._unwrappedTextLines[h].length;o++)delete this.styles[h][o];if(this.styles[u])for(o=f;o<this._unwrappedTextLines[u].length;o++)(c=this.styles[u][o])&&(this.styles[h]||(this.styles[h]={}),this.styles[h][g+o-f]=c);for(o=h+1;o<=u;o++)delete this.styles[o];this.shiftLineStyles(u,h-u)}else if(this.styles[h]){c=this.styles[h];var m,y,w=f-g;for(o=g;o<f;o++)delete c[o];for(y in this.styles[h])(m=parseInt(y,10))>=f&&(c[m-w]=c[y],delete c[y])}},shiftLineStyles:function(l,s){var o=be(this.styles);for(var c in this.styles){var i=parseInt(c,10);i>l&&(this.styles[i+s]=o[i],o[i-s]||delete this.styles[i])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(l,s,o,c){var i,n={},h=!1,g=this._unwrappedTextLines[l].length===s;for(var u in o||(o=1),this.shiftLineStyles(l,o),this.styles[l]&&(i=this.styles[l][s===0?s:s-1]),this.styles[l]){var f=parseInt(u,10);f>=s&&(h=!0,n[f-s]=this.styles[l][u],g&&s===0||delete this.styles[l][u])}var m=!1;for(h&&!g&&(this.styles[l+o]=n,m=!0),m&&o--;o>0;)c&&c[o-1]?this.styles[l+o]={0:be(c[o-1])}:i?this.styles[l+o]={0:be(i)}:delete this.styles[l+o],o--;this._forceClearCache=!0},insertCharStyleObject:function(l,s,o,c){this.styles||(this.styles={});var i=this.styles[l],n=i?be(i):{};for(var h in o||(o=1),n){var g=parseInt(h,10);g>=s&&(i[g+o]=n[g],n[g-o]||delete i[g])}if(this._forceClearCache=!0,c)for(;o--;)Object.keys(c[o]).length&&(this.styles[l]||(this.styles[l]={}),this.styles[l][s+o]=be(c[o]));else if(i)for(var u=i[s?s-1:1];u&&o--;)this.styles[l][s+o]=be(u)},insertNewStyleBlock:function(l,s,o){for(var c=this.get2DCursorLocation(s,!0),i=[0],n=0,h=0;h<l.length;h++)l[h]===`
`?i[++n]=0:i[n]++;for(i[0]>0&&(this.insertCharStyleObject(c.lineIndex,c.charIndex,i[0],o),o=o&&o.slice(i[0]+1)),n&&this.insertNewlineStyleObject(c.lineIndex,c.charIndex+i[0],n),h=1;h<n;h++)i[h]>0?this.insertCharStyleObject(c.lineIndex+h,0,i[h],o):o&&this.styles[c.lineIndex+h]&&o[0]&&(this.styles[c.lineIndex+h][0]=o[0]),o=o&&o.slice(i[h]+1);i[h]>0&&this.insertCharStyleObject(c.lineIndex+h,0,i[h],o)},setSelectionStartEndWithShift:function(l,s,o){o<=l?(s===l?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=l),this.selectionStart=o):o>l&&o<s?this._selectionDirection==="right"?this.selectionEnd=o:this.selectionStart=o:(s===l?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=s),this.selectionEnd=o)},setSelectionInBoundaries:function(){var l=this.text.length;this.selectionStart>l?this.selectionStart=l:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>l?this.selectionEnd=l:this.selectionEnd<0&&(this.selectionEnd=0)}}),v.util.object.extend(v.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(l){if(this.canvas){this.__newClickTime=+new Date;var s=l.pointer;this.isTripleClick(s)&&(this.fire("tripleclick",l),this._stopEvent(l.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=s,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(l){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===l.x&&this.__lastPointer.y===l.y},_stopEvent:function(l){l.preventDefault&&l.preventDefault(),l.stopPropagation&&l.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(l){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(l.e))},tripleClickHandler:function(l){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(l.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(l){!this.canvas||!this.editable||l.e.button&&l.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(l.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(l){!this.canvas||!this.editable||l.e.button&&l.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(l){if(this.__isMousedown=!1,!(!this.editable||this.group||l.transform&&l.transform.actionPerformed||l.e.button&&l.e.button!==1)){if(this.canvas){var s=this.canvas._activeObject;if(s&&s!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(l.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(l){var s=this.getSelectionStartFromPointer(l),o=this.selectionStart,c=this.selectionEnd;l.shiftKey?this.setSelectionStartEndWithShift(o,c,s):(this.selectionStart=s,this.selectionEnd=s),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(l){for(var s,o=this.getLocalPointer(l),c=0,i=0,n=0,h=0,g=0,u=0,f=this._textLines.length;u<f&&n<=o.y;u++)n+=this.getHeightOfLine(u)*this.scaleY,g=u,u>0&&(h+=this._textLines[u-1].length+this.missingNewlineOffset(u-1));i=this._getLineLeftOffset(g)*this.scaleX,s=this._textLines[g],this.direction==="rtl"&&(o.x=this.width*this.scaleX-o.x+i);for(var m=0,y=s.length;m<y&&(c=i,(i+=this.__charBounds[g][m].kernedWidth*this.scaleX)<=o.x);m++)h++;return this._getNewSelectionStartFromOffset(o,c,i,h,y)},_getNewSelectionStartFromOffset:function(l,s,o,c,i){var n=l.x-s,h=o-l.x,g=c+(h>n||h<0?0:1);return this.flipX&&(g=i-g),g>this._text.length&&(g=this._text.length),g}}),v.util.object.extend(v.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=v.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var l=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+l.top+"; left: "+l.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; paddingｰtop: "+l.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):v.document.body.appendChild(this.hiddenTextarea),v.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),v.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),v.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),v.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),v.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),v.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),v.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),v.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),v.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(v.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(l){if(this.isEditing){var s=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(l.keyCode in s)this[s[l.keyCode]](l);else{if(!(l.keyCode in this.ctrlKeysMapDown)||!l.ctrlKey&&!l.metaKey)return;this[this.ctrlKeysMapDown[l.keyCode]](l)}l.stopImmediatePropagation(),l.preventDefault(),l.keyCode>=33&&l.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(l){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:l.keyCode in this.ctrlKeysMapUp&&(l.ctrlKey||l.metaKey)&&(this[this.ctrlKeysMapUp[l.keyCode]](l),l.stopImmediatePropagation(),l.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(l){var s=this.fromPaste;if(this.fromPaste=!1,l&&l.stopPropagation(),this.isEditing){var o,c,i,n,h,g=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,u=this._text.length,f=g.length,m=f-u,y=this.selectionStart,w=this.selectionEnd,T=y!==w;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var S=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),D=y>S.selectionStart;T?(o=this._text.slice(y,w),m+=w-y):f<u&&(o=D?this._text.slice(w+m,w):this._text.slice(y,y-m)),c=g.slice(S.selectionEnd-m,S.selectionEnd),o&&o.length&&(c.length&&(i=this.getSelectionStyles(y,y+1,!1),i=c.map(function(){return i[0]})),T?(n=y,h=w):D?(n=w-o.length,h=w):(n=w,h=w+o.length),this.removeStyleFromTo(n,h)),c.length&&(s&&c.join("")===v.copiedText&&!v.disableStyleCopyPaste&&(i=v.copiedTextStyle),this.insertNewStyleBlock(c,y,i)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(l){this.compositionStart=l.target.selectionStart,this.compositionEnd=l.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(v.copiedText=this.getSelectedText(),v.disableStyleCopyPaste?v.copiedTextStyle=null:v.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(l){return l&&l.clipboardData||v.window.clipboardData},_getWidthBeforeCursor:function(l,s){var o,c=this._getLineLeftOffset(l);return s>0&&(c+=(o=this.__charBounds[l][s-1]).left+o.width),c},getDownCursorOffset:function(l,s){var o=this._getSelectionForOffset(l,s),c=this.get2DCursorLocation(o),i=c.lineIndex;if(i===this._textLines.length-1||l.metaKey||l.keyCode===34)return this._text.length-o;var n=c.charIndex,h=this._getWidthBeforeCursor(i,n),g=this._getIndexOnLine(i+1,h);return this._textLines[i].slice(n).length+g+1+this.missingNewlineOffset(i)},_getSelectionForOffset:function(l,s){return l.shiftKey&&this.selectionStart!==this.selectionEnd&&s?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(l,s){var o=this._getSelectionForOffset(l,s),c=this.get2DCursorLocation(o),i=c.lineIndex;if(i===0||l.metaKey||l.keyCode===33)return-o;var n=c.charIndex,h=this._getWidthBeforeCursor(i,n),g=this._getIndexOnLine(i-1,h),u=this._textLines[i].slice(0,n),f=this.missingNewlineOffset(i-1);return-this._textLines[i-1].length+g-u.length+(1-f)},_getIndexOnLine:function(l,s){for(var o,c,i=this._textLines[l],n=this._getLineLeftOffset(l),h=0,g=0,u=i.length;g<u;g++)if((n+=o=this.__charBounds[l][g].width)>s){c=!0;var f=n-o,m=n,y=Math.abs(f-s);h=Math.abs(m-s)<y?g:g-1;break}return c||(h=i.length-1),h},moveCursorDown:function(l){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",l)},moveCursorUp:function(l){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",l)},_moveCursorUpOrDown:function(l,s){var o=this["get"+l+"CursorOffset"](s,this._selectionDirection==="right");s.shiftKey?this.moveCursorWithShift(o):this.moveCursorWithoutShift(o),o!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(l){var s=this._selectionDirection==="left"?this.selectionStart+l:this.selectionEnd+l;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,s),l!==0},moveCursorWithoutShift:function(l){return l<0?(this.selectionStart+=l,this.selectionEnd=this.selectionStart):(this.selectionEnd+=l,this.selectionStart=this.selectionEnd),l!==0},moveCursorLeft:function(l){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",l)},_move:function(l,s,o){var c;if(l.altKey)c=this["findWordBoundary"+o](this[s]);else{if(!l.metaKey&&l.keyCode!==35&&l.keyCode!==36)return this[s]+=o==="Left"?-1:1,!0;c=this["findLineBoundary"+o](this[s])}if(typeof c!==void 0&&this[s]!==c)return this[s]=c,!0},_moveLeft:function(l,s){return this._move(l,s,"Left")},_moveRight:function(l,s){return this._move(l,s,"Right")},moveCursorLeftWithoutShift:function(l){var s=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(s=this._moveLeft(l,"selectionStart")),this.selectionEnd=this.selectionStart,s},moveCursorLeftWithShift:function(l){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(l,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(l,"selectionStart")):void 0},moveCursorRight:function(l){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",l)},_moveCursorLeftOrRight:function(l,s){var o="moveCursor"+l+"With";this._currentCursorOpacity=1,s.shiftKey?o+="Shift":o+="outShift",this[o](s)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(l){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(l,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(l,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(l){var s=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(s=this._moveRight(l,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,s},removeChars:function(l,s){s===void 0&&(s=l+1),this.removeStyleFromTo(l,s),this._text.splice(l,s-l),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(l,s,o,c){c===void 0&&(c=o),c>o&&this.removeStyleFromTo(o,c);var i=v.util.string.graphemeSplit(l);this.insertNewStyleBlock(i,o,s),this._text=[].concat(this._text.slice(0,o),i,this._text.slice(c)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var l=v.util.toFixed,s=/  +/g;v.util.object.extend(v.Text.prototype,{_toSVG:function(){var o=this._getSVGLeftTopOffsets(),c=this._getSVGTextAndBg(o.textTop,o.textLeft);return this._wrapSVGTextAndBg(c)},toSVG:function(o){return this._createBaseSVGMarkup(this._toSVG(),{reviver:o,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(o){var c=this.getSvgTextDecoration(this);return[o.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",c?'text-decoration="'+c+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",o.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(o,c){var i,n=[],h=[],g=o;this._setSVGBg(h);for(var u=0,f=this._textLines.length;u<f;u++)i=this._getLineLeftOffset(u),(this.textBackgroundColor||this.styleHas("textBackgroundColor",u))&&this._setSVGTextLineBg(h,u,c+i,g),this._setSVGTextLineText(n,u,c+i,g),g+=this.getHeightOfLine(u);return{textSpans:n,textBgRects:h}},_createTextCharSpan:function(o,c,i,n){var h=o!==o.trim()||o.match(s),g=this.getSvgSpanStyles(c,h),u=g?'style="'+g+'"':"",f=c.deltaY,m="",y=v.Object.NUM_FRACTION_DIGITS;return f&&(m=' dy="'+l(f,y)+'" '),['<tspan x="',l(i,y),'" y="',l(n,y),'" ',m,u,">",v.util.string.escapeXml(o),"</tspan>"].join("")},_setSVGTextLineText:function(o,c,i,n){var h,g,u,f,m,y=this.getHeightOfLine(c),w=this.textAlign.indexOf("justify")!==-1,T="",S=0,D=this._textLines[c];n+=y*(1-this._fontSizeFraction)/this.lineHeight;for(var N=0,X=D.length-1;N<=X;N++)m=N===X||this.charSpacing,T+=D[N],u=this.__charBounds[c][N],S===0?(i+=u.kernedWidth-u.width,S+=u.width):S+=u.kernedWidth,w&&!m&&this._reSpaceAndTab.test(D[N])&&(m=!0),m||(h=h||this.getCompleteStyleDeclaration(c,N),g=this.getCompleteStyleDeclaration(c,N+1),m=this._hasStyleChangedForSvg(h,g)),m&&(f=this._getStyleDeclaration(c,N)||{},o.push(this._createTextCharSpan(T,f,i,n)),T="",h=g,i+=S,S=0)},_pushTextBgRect:function(o,c,i,n,h,g){var u=v.Object.NUM_FRACTION_DIGITS;o.push("		<rect ",this._getFillAttributes(c),' x="',l(i,u),'" y="',l(n,u),'" width="',l(h,u),'" height="',l(g,u),`"></rect>
`)},_setSVGTextLineBg:function(o,c,i,n){for(var h,g,u=this._textLines[c],f=this.getHeightOfLine(c)/this.lineHeight,m=0,y=0,w=this.getValueOfPropertyAt(c,0,"textBackgroundColor"),T=0,S=u.length;T<S;T++)h=this.__charBounds[c][T],(g=this.getValueOfPropertyAt(c,T,"textBackgroundColor"))!==w?(w&&this._pushTextBgRect(o,w,i+y,n,m,f),y=h.left,m=h.width,w=g):m+=h.kernedWidth;g&&this._pushTextBgRect(o,g,i+y,n,m,f)},_getFillAttributes:function(o){var c=o&&typeof o=="string"?new v.Color(o):"";return c&&c.getSource()&&c.getAlpha()!==1?'opacity="'+c.getAlpha()+'" fill="'+c.setAlpha(1).toRgb()+'"':'fill="'+o+'"'},_getSVGLineTopOffset:function(o){for(var c,i=0,n=0;n<o;n++)i+=this.getHeightOfLine(n);return c=this.getHeightOfLine(n),{lineTop:i,offset:(this._fontSizeMult-this._fontSizeFraction)*c/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(o){return v.Object.prototype.getSvgStyles.call(this,o)+" white-space: pre;"}})}(),function(l){var s=l.fabric||(l.fabric={});s.Textbox=s.util.createClass(s.IText,s.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:s.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(o){for(var c=0,i=0,n=0,h={},g=0;g<o.graphemeLines.length;g++)o.graphemeText[n]===`
`&&g>0?(i=0,n++,c++):!this.splitByGrapheme&&this._reSpaceAndTab.test(o.graphemeText[n])&&g>0&&(i++,n++),h[g]={line:c,offset:i},n+=o.graphemeLines[g].length,i+=o.graphemeLines[g].length;return h},styleHas:function(o,c){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[c];i&&(c=i.line)}return s.Text.prototype.styleHas.call(this,o,c)},isEmptyStyles:function(o){if(!this.styles)return!0;var c,i,n=0,h=!1,g=this._styleMap[o],u=this._styleMap[o+1];for(var f in g&&(o=g.line,n=g.offset),u&&(h=u.line===o,c=u.offset),i=o===void 0?this.styles:{line:this.styles[o]})for(var m in i[f])if(m>=n&&(!h||m<c))for(var y in i[f][m])return!1;return!0},_getStyleDeclaration:function(o,c){if(this._styleMap&&!this.isWrapping){var i=this._styleMap[o];if(!i)return null;o=i.line,c=i.offset+c}return this.callSuper("_getStyleDeclaration",o,c)},_setStyleDeclaration:function(o,c,i){var n=this._styleMap[o];o=n.line,c=n.offset+c,this.styles[o][c]=i},_deleteStyleDeclaration:function(o,c){var i=this._styleMap[o];o=i.line,c=i.offset+c,delete this.styles[o][c]},_getLineStyle:function(o){var c=this._styleMap[o];return!!this.styles[c.line]},_setLineStyle:function(o){var c=this._styleMap[o];this.styles[c.line]={}},_wrapText:function(o,c){var i,n=[];for(this.isWrapping=!0,i=0;i<o.length;i++)n=n.concat(this._wrapLine(o[i],i,c));return this.isWrapping=!1,n},_measureWord:function(o,c,i){var n,h=0;i=i||0;for(var g=0,u=o.length;g<u;g++)h+=this._getGraphemeBox(o[g],c,g+i,n,!0).kernedWidth,n=o[g];return h},_wrapLine:function(o,c,i,n){var h=0,g=this.splitByGrapheme,u=[],f=[],m=g?s.util.string.graphemeSplit(o):o.split(this._wordJoiners),y="",w=0,T=g?"":" ",S=0,D=0,N=0,X=!0,K=this._getWidthOfCharSpacing();n=n||0,m.length===0&&m.push([]),i-=n;for(var ee=0;ee<m.length;ee++)y=g?m[ee]:s.util.string.graphemeSplit(m[ee]),S=this._measureWord(y,c,w),w+=y.length,(h+=D+S-K)>i&&!X?(u.push(f),f=[],h=S,X=!0):h+=K,X||g||f.push(T),f=f.concat(y),D=g?0:this._measureWord([T],c,w),w++,X=!1,S>N&&(N=S);return ee&&u.push(f),N+n>this.dynamicMinWidth&&(this.dynamicMinWidth=N-K+n),u},isEndOfWrapping:function(o){return!this._styleMap[o+1]||this._styleMap[o+1].line!==this._styleMap[o].line},missingNewlineOffset:function(o){return this.splitByGrapheme?this.isEndOfWrapping(o)?1:0:1},_splitTextIntoLines:function(o){for(var c=s.Text.prototype._splitTextIntoLines.call(this,o),i=this._wrapText(c.lines,this.width),n=new Array(i.length),h=0;h<i.length;h++)n[h]=i[h].join("");return c.lines=n,c.graphemeLines=i,c},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var o={};for(var c in this._styleMap)this._textLines[c]&&(o[this._styleMap[c].line]=1);for(var c in this.styles)o[c]||delete this.styles[c]},toObject:function(o){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(o))}}),s.Textbox.fromObject=function(o,c){return s.Object._fromObject("Textbox",o,c,"text")}}(e),function(){var l=v.controlsUtils,s=l.scaleSkewCursorStyleHandler,o=l.scaleCursorStyleHandler,c=l.scalingEqually,i=l.scalingYOrSkewingX,n=l.scalingXOrSkewingY,h=l.scaleOrSkewActionName,g=v.Object.prototype.controls;if(g.ml=new v.Control({x:-.5,y:0,cursorStyleHandler:s,actionHandler:n,getActionName:h}),g.mr=new v.Control({x:.5,y:0,cursorStyleHandler:s,actionHandler:n,getActionName:h}),g.mb=new v.Control({x:0,y:.5,cursorStyleHandler:s,actionHandler:i,getActionName:h}),g.mt=new v.Control({x:0,y:-.5,cursorStyleHandler:s,actionHandler:i,getActionName:h}),g.tl=new v.Control({x:-.5,y:-.5,cursorStyleHandler:o,actionHandler:c}),g.tr=new v.Control({x:.5,y:-.5,cursorStyleHandler:o,actionHandler:c}),g.bl=new v.Control({x:-.5,y:.5,cursorStyleHandler:o,actionHandler:c}),g.br=new v.Control({x:.5,y:.5,cursorStyleHandler:o,actionHandler:c}),g.mtr=new v.Control({x:0,y:-.5,actionHandler:l.rotationWithSnapping,cursorStyleHandler:l.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),v.Textbox){var u=v.Textbox.prototype.controls={};u.mtr=g.mtr,u.tr=g.tr,u.br=g.br,u.tl=g.tl,u.bl=g.bl,u.mt=g.mt,u.mb=g.mb,u.mr=new v.Control({x:.5,y:0,actionHandler:l.changeWidth,cursorStyleHandler:s,actionName:"resizing"}),u.ml=new v.Control({x:-.5,y:0,actionHandler:l.changeWidth,cursorStyleHandler:s,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},xl={};function Ji(t){var e=xl[t];if(e!==void 0)return e.exports;var r=xl[t]={exports:{}};return uf[t](r,r.exports,Ji),r.exports}Ji.d=(t,e)=>{for(var r in e)Ji.o(e,r)&&!Ji.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},Ji.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var nc={};(()=>{let t;Ji.d(nc,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?Ji(653).fabric:{version:"5.2.1"}})();var ct,Lt,Ai,Al,Ne=nc.R;(function(t){t[t.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",t[t.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",t[t.DIMT_TEXT=4]="DIMT_TEXT",t[t.DIMT_ARC=8]="DIMT_ARC",t[t.DIMT_IMAGE=16]="DIMT_IMAGE",t[t.DIMT_POLYGON=32]="DIMT_POLYGON",t[t.DIMT_LINE=64]="DIMT_LINE",t[t.DIMT_GROUP=128]="DIMT_GROUP"})(ct||(ct={})),function(t){t[t.DIS_DEFAULT=1]="DIS_DEFAULT",t[t.DIS_SELECTED=2]="DIS_SELECTED"}(Lt||(Lt={})),function(t){t[t.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",t[t.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",t[t.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(Ai||(Ai={})),function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}(Al||(Al={}));const Rr=t=>typeof t=="number"&&!Number.isNaN(t),Fo=t=>typeof t=="string";var Zn,Kr,dr,Po,Xt,Os;(function(t){t[t.ARC=0]="ARC",t[t.IMAGE=1]="IMAGE",t[t.LINE=2]="LINE",t[t.POLYGON=3]="POLYGON",t[t.QUAD=4]="QUAD",t[t.RECT=5]="RECT",t[t.TEXT=6]="TEXT",t[t.GROUP=7]="GROUP"})(Xt||(Xt={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SELECTED=1]="SELECTED"}(Os||(Os={}));class St{get mediaType(){return new Map([["rect",ct.DIMT_RECTANGLE],["quad",ct.DIMT_QUADRILATERAL],["text",ct.DIMT_TEXT],["arc",ct.DIMT_ARC],["image",ct.DIMT_IMAGE],["polygon",ct.DIMT_POLYGON],["line",ct.DIMT_LINE],["group",ct.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(I(this,Kr,"f")){case Lt.DIS_DEFAULT:return"default";case Lt.DIS_SELECTED:return"selected"}}set drawingStyleId(e){this.styleId=e}get drawingStyleId(){return this.styleId}set coordinateBase(e){if(!["view","image"].includes(e))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&(I(this,dr,"f")==="image"&&e==="view"?this.updateCoordinateBaseFromImageToView():I(this,dr,"f")==="view"&&e==="image"&&this.updateCoordinateBaseFromViewToImage()),Ee(this,dr,e,"f")}get coordinateBase(){return I(this,dr,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(e,r){if(Zn.add(this),Kr.set(this,void 0),dr.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,r!=null&&!Rr(r))throw new TypeError("Invalid 'drawingStyleId'.");e&&this._setFabricObject(e),this.setState(Lt.DIS_DEFAULT),this.styleId=r}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.setState(Lt.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(Lt.DIS_SELECTED):this.setState(Lt.DIS_DEFAULT),this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(e){Ee(this,Kr,e,"f")}getState(){return I(this,Kr,"f")}_on(e,r){if(!r)return;const a=e.toLowerCase(),d=this.mapEvent_Callbacks.get(a);if(!d)throw new Error(`Event '${e}' does not exist.`);let p=d.get(r);p||(p=_=>{const E=_.e;if(!E)return void(r&&r.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));const C={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let b,O,M,k;const V=E.target.getBoundingClientRect();b=V.left,O=V.top,M=b+window.scrollX,k=O+window.scrollY;const{width:H,height:z}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),Z=this._drawingLayer.width,$=this._drawingLayer.height,J=H/z,te=Z/$,he=this._drawingLayer._getObjectFit();let ce,ue,be,v,pe=1;if(he==="contain")J<te?(pe=H/Z,ce=b+this.get("x")*pe,ue=O+this.get("y")*pe+(z-$*pe)/2,be=M+this.get("x")*pe,v=k+this.get("y")*pe+(z-$*pe)/2):(pe=z/$,ce=b+this.get("x")*pe+(H-Z*pe)/2,ue=O+this.get("y")*pe,be=M+this.get("x")*pe+(H-Z*pe)/2,v=k+this.get("y")*pe);else if(he==="cover")if(J<te){pe=z/$;let Ce=this.get("x")*pe-(Z*pe-H)/2;Ce=Math.max(Ce,0),Ce=Math.min(Ce,H),ce=b+Ce,ue=O+this.get("y")*pe,be=M+Ce,v=k+this.get("y")*pe}else{pe=H/Z;let Ce=this.get("y")*pe-($*pe-z)/2;Ce=Math.max(Ce,0),Ce=Math.min(Ce,z),ce=b+this.get("x")*pe,ue=O+Ce,be=M+this.get("x")*pe,v=k+Ce}C.itemClientX=Math.round(ce),C.itemClientY=Math.round(ue),C.itemPageX=Math.round(be),C.itemPageY=Math.round(v)}for(let b of Object.getOwnPropertyNames(C))Object.defineProperty(E,b,{value:C[b],writable:!0});r&&r.apply(this,[E])},d.set(r,p),this._fabricObject.on(a==="dblclick"?"mousedblclick":a,p))}on(e,r){this._on(e,r)}_off(e,r){const a=e.toLowerCase(),d=this.mapEvent_Callbacks.get(a);if(!d)throw new Error(`Event '${e}' does not exist.`);let p=d.get(r);p&&(d.delete(r),this._fabricObject.off(a==="dblclick"?"mousedblclick":a,p))}off(e,r){this._off(e,r)}_setEditable(e){const r=this._fabricObject;e?(r.selectable=!0,r.hasControls=!0,r.hoverCursor=null):(r.selectable=!1,r.hasControls=!1,r.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,r){if(this.hasNote(e.name)&&!r)throw new Error("A note with the same name already exists, please use a different name.");const a=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[a])}getNote(e){const r=this.mapNoteName_Content.get(e);return r?r.length===1?{name:e,content:r[0]?JSON.parse(JSON.stringify(r[0])):r[0]}:{name:e,content:JSON.parse(JSON.stringify(r))}:null}getNotes(){const e=[];for(let r of this.mapNoteName_Content){let a=r[1].length===1?r[1][0]:r[1];a=a&&JSON.parse(JSON.stringify(a)),e.push({name:r[0],content:a})}return e}updateNote(e,r,a){const d=this.mapNoteName_Content.get(e);if(!d)throw new Error("The note name does not exist.");a||(d.length=0),r=r&&JSON.parse(JSON.stringify(r)),d.push(r)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}set(e,r){if(!this.extendSet(e,r))if(e==="x"){const a=this._fabricObject.group;a?(this._fabricObject.set("left",r-a.left-a.width/2),a.addWithUpdate()):this._fabricObject.set("left",r)}else if(e==="y"){const a=this._fabricObject.group;a?(this._fabricObject.set("top",r-a.top-a.height/2),a.addWithUpdate()):this._fabricObject.set("top",r)}else e==="styleId"?this.styleId=r:this._fabricObject.set(e,r);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let r=this.extendGet(e);if(r===void 0)if(e==="x"){const a=this._fabricObject.group;r=a?this._fabricObject.get("left")+a.left+a.width/2:this._fabricObject.get("left")}else if(e==="y"){const a=this._fabricObject.group;r=a?this._fabricObject.get("top")+a.top+a.height/2:this._fabricObject.get("top")}else r=e==="scaledWidth"?this._fabricObject.getScaledWidth():e==="scaledHeight"?this._fabricObject.getScaledHeight():["type","mediaType"].includes(e)?this.mediaType:e==="state"?this.getState():e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return r}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e*I(this,Zn,"m",Po).call(this)}convertPropFromViewToImage(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e/I(this,Zn,"m",Po).call(this)}_setLineWidth(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("strokeWidth",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",e)}}_getLineWidth(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("strokeWidth"));if(this.coordinateBase==="image")return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("fontSize",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",e)}}_getFontSize(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("fontSize"));if(this.coordinateBase==="image")return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}}Kr=new WeakMap,dr=new WeakMap,Zn=new WeakSet,Po=function(){const t=this._drawingLayer;if(!t)return 1;const e=t.width,r=t.height,{width:a,height:d}=t.fabricCanvas.wrapperEl.getBoundingClientRect();if(a<=0||d<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");const p=a/e,_=d/r,E=t._getObjectFit();let C=1;return E==="contain"?p<_?C=a/e:C=d/r:E==="cover"&&(p<_?C=d/r:C=a/e),C},St.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],St.mapItemType=new Map([[Xt.ARC,"arc"],[Xt.IMAGE,"image"],[Xt.LINE,"line"],[Xt.POLYGON,"polygon"],[Xt.QUAD,"quad"],[Xt.RECT,"rect"],[Xt.TEXT,"text"],[Xt.GROUP,"group"]]),St.arrStyleSelectors=["default","selected"],St.mapItemState=new Map([[Os.DEFAULT,"default"],[Os.SELECTED,"selected"]]);const sc=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),oo=t=>!!Fo(t)&&t!=="",Ta=Kd,Ol=Zd,df=Ea,Rl=qd,nr=Jd,Dl=t=>!!sc(t)&&!("id"in t&&!Rr(t.id))&&!("lineWidth"in t&&!Rr(t.lineWidth))&&!("fillStyle"in t&&!oo(t.fillStyle))&&!("strokeStyle"in t&&!oo(t.strokeStyle))&&!("paintMode"in t&&!["fill","stroke","strokeAndFill"].includes(t.paintMode))&&!("fontFamily"in t&&!oo(t.fontFamily))&&!("fontSize"in t&&!Rr(t.fontSize));class qn{static convert(e,r,a){const d={x:0,y:0,width:r,height:a};if(!e)return d;if(nr(e))e.isMeasuredInPercentage?(d.x=e.x/100*r,d.y=e.y/100*a,d.width=e.width/100*r,d.height=e.height/100*a):(d.x=e.x,d.y=e.y,d.width=e.width,d.height=e.height);else{if(!Ta(e))throw TypeError("Invalid region.");e.isMeasuredInPercentage?(d.x=e.left/100*r,d.y=e.top/100*a,d.width=(e.right-e.left)/100*r,d.height=(e.bottom-e.top)/100*a):(d.x=e.left,d.y=e.top,d.width=e.right-e.left,d.height=e.bottom-e.top)}return d.x=Math.round(d.x),d.y=Math.round(d.y),d.width=Math.round(d.width),d.height=Math.round(d.height),d}}var Hi,Jn;class oc{constructor(){Hi.set(this,new Map),Jn.set(this,!1)}get disposed(){return I(this,Jn,"f")}on(e,r){e=e.toLowerCase();const a=I(this,Hi,"f").get(e);if(a){if(a.includes(r))return;a.push(r)}else I(this,Hi,"f").set(e,[r])}off(e,r){e=e.toLowerCase();const a=I(this,Hi,"f").get(e);if(!a)return;const d=a.indexOf(r);d!==-1&&a.splice(d,1)}offAll(e){e=e.toLowerCase();const r=I(this,Hi,"f").get(e);r&&(r.length=0)}fire(e,r=[],a={async:!1,copy:!0}){r||(r=[]),e=e.toLowerCase();const d=I(this,Hi,"f").get(e);if(d&&d.length){a=Object.assign({async:!1,copy:!0},a);for(let p of d){if(!p)continue;let _=[];if(a.copy)for(let C of r){try{C=JSON.parse(JSON.stringify(C))}catch{}_.push(C)}else _=r;let E=!1;if(a.async)setTimeout(()=>{this.disposed||d.includes(p)&&p.apply(a.target,_)},0);else try{E=p.apply(a.target,_)}catch{}if(E===!0)break}}}dispose(){Ee(this,Jn,!0,"f")}}function ff(t,e,r){return(r.x-t.x)*(e.y-t.y)==(e.x-t.x)*(r.y-t.y)&&Math.min(t.x,e.x)<=r.x&&r.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=r.y&&r.y<=Math.max(t.y,e.y)}function ao(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function Gn(t,e,r,a){let d=t[0]*(r[1]-e[1])+e[0]*(t[1]-r[1])+r[0]*(e[1]-t[1]),p=t[0]*(a[1]-e[1])+e[0]*(t[1]-a[1])+a[0]*(e[1]-t[1]);return!((d^p)>=0&&d!==0&&p!==0)&&(d=r[0]*(t[1]-a[1])+a[0]*(r[1]-t[1])+t[0]*(a[1]-r[1]),p=r[0]*(e[1]-a[1])+a[0]*(r[1]-e[1])+e[0]*(a[1]-r[1]),!((d^p)>=0&&d!==0&&p!==0))}Hi=new WeakMap,Jn=new WeakMap;const Ll=async t=>{if(typeof t!="string")throw new TypeError("Invalid url.");const e=await fetch(t);if(!e.ok)throw Error("Network Error: "+e.statusText);const r=await e.text();if(!r.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");const a=document.createElement("div");a.insertAdjacentHTML("beforeend",r);for(let d=0;d<a.childElementCount;++d){let p=a.children[d];p instanceof HTMLStyleElement&&document.head.append(p)}return a.childElementCount==1?a.children[0]:a};var yi,Ei,Ci;class ar extends St{constructor(e,r){if(super(null,r),yi.set(this,void 0),!nr(e))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Ne.Rect({left:e.x,top:e.y,width:e.width,height:e.height})),Ee(this,yi,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="rect"}extendSet(e,r){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(e){this.setRect(e)}getPosition(){return this.getRect()}updatePosition(){I(this,yi,"f")&&this.setRect(I(this,yi,"f"))}setRect(e){if(!nr(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width)),this.set("height",this.convertPropFromViewToImage(e.height));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width),this.set("height",e.height)}this._drawingLayer.renderAll()}else Ee(this,yi,JSON.parse(JSON.stringify(e)),"f")}getRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return I(this,yi,"f")?JSON.parse(JSON.stringify(I(this,yi,"f"))):null}}function Ml(t,e,r){let a=r.points[this.pointIndex].x-r.pathOffset.x,d=r.points[this.pointIndex].y-r.pathOffset.y;return Ne.util.transformPoint({x:a,y:d},r.calcTransformMatrix())}function ac(t){let e=new Ne.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new Ne.Point(t.width+e.x,t.height+e.y)}function Fl(t,e,r,a){let d=e.target,p=d.controls[d.__corner],_=d.toLocalPoint(new Ne.Point(r,a),"center","center"),E=ac(d),C=d._getTransformedDimensions(0,0),b={x:_.x*E.x/C.x+d.pathOffset.x,y:_.y*E.y/C.y+d.pathOffset.y};return d.points[p.pointIndex]=b,Ne.controlsUtils.fireEvent("scaling",{e:t,transform:e,pointer:{x:r,y:a}}),!0}function Pl(t,e){return function(r,a,d,p){let _=a.target,E=Ne.util.transformPoint({x:_.points[t].x-_.pathOffset.x,y:_.points[t].y-_.pathOffset.y},_.calcTransformMatrix()),C=e(r,a,d,p);_._setPositionDimensions({});let b=ac(_),O=(_.points[t].x-_.pathOffset.x)/b.x,M=(_.points[t].y-_.pathOffset.y)/b.y;return _.setPositionByOrigin(E,O+.5,M+.5),C}}yi=new WeakMap;class ko extends St{constructor(e,r){if(super(null,r),Ei.set(this,void 0),!Ol(e))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new Ne.Polygon(e.points,{objectCaching:!1}));const a=this._fabricObject;let d=a.points.length-1;a.controls=a.points.reduce(function(p,_,E){return p["p"+E]=new Ne.Control({positionHandler:Ml,actionHandler:Pl(E>0?E-1:d,Fl),actionName:"modifyPolygon",pointIndex:E}),p},{}),Ee(this,Ei,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="polygon"}extendSet(e,r){if(e==="vertices"){const a=this._fabricObject;if(a.group){const p=a.group;a.points=r.map(_=>({x:_.x-p.left-p.width/2,y:_.y-p.top-p.height/2})),p.addWithUpdate()}else a.points=r;const d=a.points.length-1;return a.controls=a.points.reduce(function(p,_,E){return p["p"+E]=new Ne.Control({positionHandler:Ml,actionHandler:Pl(E>0?E-1:d,Fl),actionName:"modifyPolygon",pointIndex:E}),p},{}),a._setPositionDimensions({}),!0}}extendGet(e){if(e==="vertices"){const r=[],a=this._fabricObject;if(a.selectable&&!a.group)for(let d in a.oCoords)r.push({x:a.oCoords[d].x,y:a.oCoords[d].y});else for(let d of a.points){let p=d.x-a.pathOffset.x,_=d.y-a.pathOffset.y;const E=Ne.util.transformPoint({x:p,y:_},a.calcTransformMatrix());r.push({x:E.x,y:E.y})}return r}}updateCoordinateBaseFromImageToView(){const e=this.get("vertices").map(r=>({x:this.convertPropFromViewToImage(r.x),y:this.convertPropFromViewToImage(r.y)}));this.set("vertices",e)}updateCoordinateBaseFromViewToImage(){const e=this.get("vertices").map(r=>({x:this.convertPropFromImageToView(r.x),y:this.convertPropFromImageToView(r.y)}));this.set("vertices",e)}setPosition(e){this.setPolygon(e)}getPosition(){return this.getPolygon()}updatePosition(){I(this,Ei,"f")&&this.setPolygon(I(this,Ei,"f"))}setPolygon(e){if(!Ol(e))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if(this.coordinateBase==="view"){const r=e.points.map(a=>({x:this.convertPropFromViewToImage(a.x),y:this.convertPropFromViewToImage(a.y)}));this.set("vertices",r)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Ee(this,Ei,JSON.parse(JSON.stringify(e)),"f")}getPolygon(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return I(this,Ei,"f")?JSON.parse(JSON.stringify(I(this,Ei,"f"))):null}}Ei=new WeakMap;const kl=t=>{let e=(r=>r.split(`
`).map(a=>a.split("	")))(t);return(r=>{for(let a=0;;a++){let d=-1;for(let p=0;p<r.length;p++){let _=r[p][a];_!==void 0&&_.length>d&&(d=_.length)}if(d===-1)break;for(let p=0;p<r.length;p++){if(a>=r[p].length-1)continue;let _=" ".repeat(d+2-r[p][a].length);r[p][a]=r[p][a].concat(_)}}})(e),(r=>{let a="";for(let d=0;d<r.length;d++)a=a.concat(...r[d],d===r.length-1?"":`
`);return a})(e)};class gf extends St{constructor(e,r,a){if(super(null,a),Ci.set(this,void 0),!Fo(e))throw new TypeError("Invalid 'text'.");if(!nr(r))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new Ne.Textbox(kl(e),{left:r.x,top:r.y,width:r.width})),this._text=e,Ee(this,Ci,JSON.parse(JSON.stringify(r)),"f"),this._mediaType="text"}extendSet(e,r){if(e==="text")return this._text=r,this._fabricObject.set("text",kl(r)),!0}extendGet(e){if(e==="text")return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(e){this.setTextRect(e)}getPosition(){return this.getTextRect()}updatePosition(){I(this,Ci,"f")&&this.setTextRect(I(this,Ci,"f"))}setText(e){if(!Fo(e))throw new TypeError("Invalid 'text'.");this.set("text",e)}getText(){return this.get("text")}setTextRect(e){if(!nr(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width)}this._drawingLayer.renderAll()}else Ee(this,Ci,JSON.parse(JSON.stringify(e)),"f")}getTextRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return I(this,Ci,"f")?JSON.parse(JSON.stringify(I(this,Ci,"f"))):null}}var wi,Si,fr,No,gr,$r,pr,Ot,Zr,qr,Jr,lc,hc,cc,uc,Qn,Ye,Qr,en,tn,it,es,ts,is,bi,rn,nn,Bo,At,rs,dc,jo,Uo,sn,ns;Ci=new WeakMap;class pf extends ko{constructor(e,r){if(super({points:e==null?void 0:e.points},r),wi.set(this,void 0),!Rl(e))throw new TypeError("Invalid 'quad'.");Ee(this,wi,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="quad"}setPosition(e){this.setQuad(e)}getPosition(){return this.getQuad()}updatePosition(){I(this,wi,"f")&&this.setQuad(I(this,wi,"f"))}setPolygon(){}getPolygon(){return null}setQuad(e){if(!Rl(e))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if(this.coordinateBase==="view"){const r=e.points.map(a=>({x:this.convertPropFromViewToImage(a.x),y:this.convertPropFromViewToImage(a.y)}));this.set("vertices",r)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Ee(this,wi,JSON.parse(JSON.stringify(e)),"f")}getQuad(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return I(this,wi,"f")?JSON.parse(JSON.stringify(I(this,wi,"f"))):null}}wi=new WeakMap;class mf extends St{constructor(e){super(new Ne.Group(e.map(r=>r._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(Lt.DIS_SELECTED);const r=this._fabricObject._objects;for(let a of r)setTimeout(()=>{a&&a.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(Lt.DIS_DEFAULT);const r=this._fabricObject._objects;for(let a of r)setTimeout(()=>{a&&a.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(e,r){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(e=>e.getDrawingItem())}setChildDrawingItems(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"add"):this._fabricObject.addWithUpdate(e._getFabricObject())}removeChildItem(e){e&&e.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"remove"):this._fabricObject.removeWithUpdate(e._getFabricObject()))}}class le{static createDrawingStyle(e){if(!Dl(e))throw new Error("Invalid style definition.");let r,a=le.USER_START_STYLE_ID;for(;I(le,Si,"f",fr).has(a);)a++;r=a;const d=JSON.parse(JSON.stringify(e));d.id=r;for(let p in I(le,Si,"f",No))d.hasOwnProperty(p)||(d[p]=I(le,Si,"f",No)[p]);return I(le,Si,"f",fr).set(r,d),d.id}static _getDrawingStyle(e,r){if(typeof e!="number")throw new Error("Invalid style id.");const a=I(le,Si,"f",fr).get(e);return a?r?JSON.parse(JSON.stringify(a)):a:null}static getDrawingStyle(e){return this._getDrawingStyle(e,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(I(le,Si,"f",fr).values())))}static _updateDrawingStyle(e,r){if(!Dl(r))throw new Error("Invalid style definition.");const a=I(le,Si,"f",fr).get(e);if(a)for(let d in r)a.hasOwnProperty(d)&&(a[d]=r[d])}static updateDrawingStyle(e,r){this._updateDrawingStyle(e,r)}}Si=le,le.STYLE_BLUE_STROKE=1,le.STYLE_GREEN_STROKE=2,le.STYLE_ORANGE_STROKE=3,le.STYLE_YELLOW_STROKE=4,le.STYLE_BLUE_STROKE_FILL=5,le.STYLE_GREEN_STROKE_FILL=6,le.STYLE_ORANGE_STROKE_FILL=7,le.STYLE_YELLOW_STROKE_FILL=8,le.STYLE_BLUE_STROKE_TRANSPARENT=9,le.STYLE_GREEN_STROKE_TRANSPARENT=10,le.STYLE_ORANGE_STROKE_TRANSPARENT=11,le.USER_START_STYLE_ID=1024,fr={value:new Map([[le.STYLE_BLUE_STROKE,{id:le.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[le.STYLE_GREEN_STROKE,{id:le.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_ORANGE_STROKE,{id:le.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_YELLOW_STROKE,{id:le.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[le.STYLE_BLUE_STROKE_FILL,{id:le.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_GREEN_STROKE_FILL,{id:le.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_ORANGE_STROKE_FILL,{id:le.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_YELLOW_STROKE_FILL,{id:le.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_BLUE_STROKE_TRANSPARENT,{id:le.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_GREEN_STROKE_TRANSPARENT,{id:le.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_ORANGE_STROKE_TRANSPARENT,{id:le.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},No={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},typeof document<"u"&&typeof window<"u"&&(Ne.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(Ne.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),Ne.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},Ne.Object.prototype.transparentCorners=!1,Ne.Object.prototype.cornerSize=20,Ne.Object.prototype.touchCornerSize=100,Ne.Object.prototype.cornerColor="rgb(254,142,20)",Ne.Object.prototype.cornerStyle="circle",Ne.Object.prototype.strokeUniform=!0,Ne.Object.prototype.hasBorders=!1,Ne.Canvas.prototype.containerClass="",Ne.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var r,a=this.upperCanvasEl,d=Ne.util.getPointer(t,a),p=a.getBoundingClientRect(),_=p.width||0,E=p.height||0;_&&E||("top"in p&&"bottom"in p&&(E=Math.abs(p.top-p.bottom)),"right"in p&&"left"in p&&(_=Math.abs(p.right-p.left))),this.calcOffset(),d.x=d.x-this._offset.left,d.y=d.y-this._offset.top,e||(d=this.restorePointerVpt(d));var C=this.getRetinaScaling();if(C!==1&&(d.x/=C,d.y/=C),_!==0&&E!==0){var b=window.getComputedStyle(a).objectFit,O=a.width,M=a.height,k=_,V=E;r={width:O/k,height:M/V};var H,z,Z=O/M,$=k/V;return b==="contain"?Z>$?(H=k,z=k/Z,{x:d.x*r.width,y:(d.y-(V-z)/2)*r.width}):(H=V*Z,z=V,{x:(d.x-(k-H)/2)*r.height,y:d.y*r.height}):b==="cover"?Z>$?{x:(O-r.height*k)/2+d.x*r.height,y:d.y*r.height}:{x:d.x*r.width,y:(M-r.width*V)/2+d.y*r.width}:{x:d.x*r.width,y:d.y*r.height}}return r={width:1,height:1},{x:d.x*r.width,y:d.y*r.height}},Ne.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var r=this.upperCanvasEl,a=this._getEventPrefix();Ne.util.addListener(Ne.document,"touchend",this._onTouchEnd,{passive:!1}),Ne.util.addListener(Ne.document,"touchmove",this._onMouseMove,{passive:!1}),Ne.util.removeListener(r,a+"down",this._onMouseDown)},Ne.Textbox.prototype._wrapLine=function(t,e,r,a){const d=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),p=!(!d||!d.length);var _=0,E=this.splitByGrapheme||p,C=[],b=[],O=E?Ne.util.string.graphemeSplit(t):t.split(this._wordJoiners),M="",k=0,V=E?"":" ",H=0,z=0,Z=0,$=!0,J=this._getWidthOfCharSpacing();a=a||0,O.length===0&&O.push([]),r-=a;for(var te=0;te<O.length;te++)M=E?O[te]:Ne.util.string.graphemeSplit(O[te]),H=this._measureWord(M,e,k),k+=M.length,(_+=z+H-J)>r&&!$?(C.push(b),b=[],_=H,$=!0):_+=J,$||E||b.push(V),b=b.concat(M),z=E?0:this._measureWord([V],e,k),k++,$=!1,H>Z&&(Z=H);return te&&C.push(b),Z+a>this.dynamicMinWidth&&(this.dynamicMinWidth=Z-J+a),C});class Ze{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(e){this.fabricCanvas.selection=e,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(e,r,a){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=e.getFabricCanvas();else{let _=this.fabricCanvas=new Ne.Canvas(e,Object.assign(a,{allowTouchScrolling:!0,selection:!1}));_.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),_.lowerCanvasEl.className="",_.upperCanvasEl.className="",_.on("selection:created",function(E){const C=E.selected,b=[];for(let O of C){const M=O.getDrawingItem()._drawingLayer;M&&!b.includes(M)&&b.push(M)}for(let O of b){const M=[];for(let k of C){const V=k.getDrawingItem();V._drawingLayer===O&&M.push(V)}setTimeout(()=>{O.onSelectionChanged&&O.onSelectionChanged(M,[])},0)}}),_.on("before:selection:cleared",function(E){const C=this.getActiveObjects(),b=[];for(let O of C){const M=O.getDrawingItem()._drawingLayer;M&&!b.includes(M)&&b.push(M)}for(let O of b){const M=[];for(let k of C){const V=k.getDrawingItem();V._drawingLayer===O&&M.push(V)}setTimeout(()=>{const k=[];for(let V of M)O.hasDrawingItem(V)&&k.push(V);k.length>0&&O.onSelectionChanged&&O.onSelectionChanged([],k)},0)}}),_.on("selection:updated",function(E){const C=E.selected,b=E.deselected,O=[];for(let M of C){const k=M.getDrawingItem()._drawingLayer;k&&!O.includes(k)&&O.push(k)}for(let M of b){const k=M.getDrawingItem()._drawingLayer;k&&!O.includes(k)&&O.push(k)}for(let M of O){const k=[],V=[];for(let H of C){const z=H.getDrawingItem();z._drawingLayer===M&&k.push(z)}for(let H of b){const z=H.getDrawingItem();z._drawingLayer===M&&V.push(z)}setTimeout(()=>{M.onSelectionChanged&&M.onSelectionChanged(k,V)},0)}}),_.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas}let d,p;switch(this.id=r,r){case Ze.DDN_LAYER_ID:d=le.getDrawingStyle(le.STYLE_BLUE_STROKE),p=le.getDrawingStyle(le.STYLE_BLUE_STROKE_FILL);break;case Ze.DBR_LAYER_ID:d=le.getDrawingStyle(le.STYLE_ORANGE_STROKE),p=le.getDrawingStyle(le.STYLE_ORANGE_STROKE_FILL);break;case Ze.DLR_LAYER_ID:d=le.getDrawingStyle(le.STYLE_GREEN_STROKE),p=le.getDrawingStyle(le.STYLE_GREEN_STROKE_FILL);break;default:d=le.getDrawingStyle(le.STYLE_YELLOW_STROKE),p=le.getDrawingStyle(le.STYLE_YELLOW_STROKE_FILL)}for(let _ of St.arrMediaTypes)this.mapType_StateAndStyleId.set(_,{default:d.id,selected:p.id})}getId(){return this.id}setVisible(e){if(e){for(let r of this._arrFabricObject)r.visible=!0,r.hasControls=!0;this._visible=!0}else{for(let r of this._arrFabricObject)r.visible=!1,r.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(e){return e.styleId?le.getDrawingStyle(e.styleId):le.getDrawingStyle(e._mapState_StyleId.get(e.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(e,r,a,d){const p=this.getDrawingItems(_=>_._mediaType===e);for(let _ of p)_.styleSelector===r&&this._changeItemStyle(_,a,!0);d||this.fabricCanvas.renderAll()}_changeItemStyle(e,r,a){if(!e||!r)return;const d=e._getFabricObject();typeof e.styleId=="number"&&(r=le.getDrawingStyle(e.styleId)),d.strokeWidth=r.lineWidth,r.paintMode==="fill"?(d.fill=r.fillStyle,d.stroke=r.fillStyle):r.paintMode==="stroke"?(d.fill="transparent",d.stroke=r.strokeStyle):r.paintMode==="strokeAndFill"&&(d.fill=r.fillStyle,d.stroke=r.strokeStyle),d.fontFamily&&(d.fontFamily=r.fontFamily),d.fontSize&&(d.fontSize=r.fontSize),d.group||(d.dirty=!0),a||this.fabricCanvas.renderAll()}_updateGroupItem(e,r,a){if(!e||!r)return;const d=e.getChildDrawingItems();if(a==="add"){if(d.includes(r))return;const p=r._getFabricObject();if(this.fabricCanvas.getObjects().includes(p)){if(!this._arrFabricObject.includes(p))throw new Error("Existed in other drawing layers.");r._zIndex=null}else{let _;if(r.styleId)_=le.getDrawingStyle(r.styleId);else{const E=this.mapType_StateAndStyleId.get(r._mediaType);_=le.getDrawingStyle(E[e.styleSelector]);const C=()=>{this._changeItemStyle(r,le.getDrawingStyle(this.mapType_StateAndStyleId.get(r._mediaType).selected),!0)},b=()=>{this._changeItemStyle(r,le.getDrawingStyle(this.mapType_StateAndStyleId.get(r._mediaType).default),!0)};r._on("selected",C),r._on("deselected",b),r._funcChangeStyleToSelected=C,r._funcChangeStyleToDefault=b}r._drawingLayer=this,r._drawingLayerId=this.id,this._changeItemStyle(r,_,!0)}e._fabricObject.addWithUpdate(r._getFabricObject())}else{if(a!=="remove"||!d.includes(r))return;r._zIndex=null,r._drawingLayer=null,r._drawingLayerId=null,r._off("selected",r._funcChangeStyleToSelected),r._off("deselected",r._funcChangeStyleToDefault),r._funcChangeStyleToSelected=null,r._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(r._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,r){if(!(e instanceof St))throw new TypeError("Invalid 'drawingItem'.");if(e._drawingLayer){if(e._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let a=e._getFabricObject();const d=this.fabricCanvas.getObjects();let p,_;if(d.includes(a)){if(this._arrFabricObject.includes(a))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){p=e.getChildDrawingItems();for(let b of p)if(b._drawingLayer&&b._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(r&&typeof r=="object"&&!Array.isArray(r))for(let b in r)a.set(b,r[b]);if(p){for(let b of p){const O=this.mapType_StateAndStyleId.get(b._mediaType);for(let M of St.arrStyleSelectors)b._mapState_StyleId.set(M,O[M]);if(b.styleId)_=le.getDrawingStyle(b.styleId);else{_=le.getDrawingStyle(O.default);const M=()=>{this._changeItemStyle(b,le.getDrawingStyle(this.mapType_StateAndStyleId.get(b._mediaType).selected),!0)},k=()=>{this._changeItemStyle(b,le.getDrawingStyle(this.mapType_StateAndStyleId.get(b._mediaType).default),!0)};b._on("selected",M),b._on("deselected",k),b._funcChangeStyleToSelected=M,b._funcChangeStyleToDefault=k}b._drawingLayer=this,b._drawingLayerId=this.id,this._changeItemStyle(b,_,!0)}a.dirty=!0,this.fabricCanvas.renderAll()}else{const b=this.mapType_StateAndStyleId.get(e._mediaType);for(let O of St.arrStyleSelectors)e._mapState_StyleId.set(O,b[O]);if(e.styleId)_=le.getDrawingStyle(e.styleId);else{_=le.getDrawingStyle(b.default);const O=()=>{this._changeItemStyle(e,le.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected))},M=()=>{this._changeItemStyle(e,le.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default))};e._on("selected",O),e._on("deselected",M),e._funcChangeStyleToSelected=O,e._funcChangeStyleToDefault=M}this._changeItemStyle(e,_)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;const E=this._arrFabricObject.length;let C=d.length;if(E)C=d.indexOf(this._arrFabricObject[E-1])+1;else for(let b=0;b<d.length;b++)if(e._zIndex<d[b].getDrawingItem()._zIndex){C=b;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(a),this._visible?a.visible=!0:a.visible=!1,this.fabricCanvas.insertAt(a,C,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e),e.updatePosition()}addDrawingItems(e){for(let r of e)this.addDrawingItem(r)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){const a=e.getChildDrawingItems();for(let d of a)d._zIndex=null,d._drawingLayer=null,d._drawingLayerId=null,d._off("selected",d._funcChangeStyleToSelected),d._off("deselected",d._funcChangeStyleToDefault),d._funcChangeStyleToSelected=null,d._funcChangeStyleToDefault=null,d._mapState_StyleId.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapState_StyleId.clear();const r=e._getFabricObject();e.styleSelector==="selected"&&(r.group?r.group.removeWithUpdate(r):this.fabricCanvas._activeObject=null,e.setState(Lt.DIS_DEFAULT)),this.fabricCanvas.remove(r),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(r),1)}removeDrawingItems(e){for(let r of e)this.removeDrawingItem(r)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){const e=this.fabricCanvas.getActiveObjects(),r=[];for(let a of e)this._arrFabricObject.includes(a)&&r.push(a.getDrawingItem());return r}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(e,r,a){r?r.forEach(_=>_.toLowerCase()):r=St.arrMediaTypes,a?a.forEach(_=>_.toLowerCase()):a=St.arrStyleSelectors;const d=le.getDrawingStyle(e);if(!d)throw new Error(`The 'drawingStyle' with id '${e}' doesn't exist.`);let p;for(let _ of r)if(p=this.mapType_StateAndStyleId.get(_),p)for(let E of a){this._changeMediaTypeCurStyleInStyleSelector(_,E,d,!0),p[E]=e;for(let C of this._arrDrwaingItem)C._mediaType===_&&C._mapState_StyleId.set(E,e)}this.fabricCanvas.renderAll()}setDefaultStyle(e,r,a){const d=[];a&ct.DIMT_RECTANGLE&&d.push("rect"),a&ct.DIMT_QUADRILATERAL&&d.push("quad"),a&ct.DIMT_TEXT&&d.push("text"),a&ct.DIMT_ARC&&d.push("arc"),a&ct.DIMT_IMAGE&&d.push("image"),a&ct.DIMT_POLYGON&&d.push("polygon"),a&ct.DIMT_LINE&&d.push("line");const p=[];r&Lt.DIS_DEFAULT&&p.push("default"),r&Lt.DIS_SELECTED&&p.push("selected"),this._setDefaultStyle(e,d.length?d:null,p.length?p:null)}setMode(e){if((e=e.toLowerCase())==="viewer"){for(let r of this._arrDrwaingItem)r._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let r of this._arrDrwaingItem)r._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,r){this.fabricCanvas.setDimensions(e,r)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){const r=this._getItemCurrentStyle(e);this._changeItemStyle(e,r,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}}Ze.DDN_LAYER_ID=1,Ze.DBR_LAYER_ID=2,Ze.DLR_LAYER_ID=3,Ze.USER_DEFINED_LAYER_BASE_ID=100,Ze.TIP_LAYER_ID=999;class _f{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(e,r){if(this.getDrawingLayer(r))throw new Error("Existed drawing layer id.");const a=new Ze(e,r,{enableRetinaScaling:!1});return a._manager=this,this._arrDrawingLayer.push(a),this._switchPointerEvent(),a}deleteDrawingLayer(e){const r=this.getDrawingLayer(e);if(!r)return;const a=this._arrDrawingLayer;r.dispose(),a.splice(a.indexOf(r),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let r of this._arrDrawingLayer)if(r.getId()===e)return r;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;const e=this._getFabricCanvas().getActiveObjects(),r=[];for(let a of e)r.push(a.getDrawingItem());return r}setDimensions(e,r){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,r)}setObjectFit(e){for(let r of this._arrDrawingLayer)r&&r._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){if(!this._arrDrawingLayer.length)return;const r=this._getFabricCanvas();r.wrapperEl.style.display=e?"block":"none"}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}}class vf extends gf{constructor(e,r,a,d,p){super(e,{x:r,y:a,width:d,height:0},p),gr.set(this,void 0),$r.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var _=0,E=0,C=this._textLines.length;E<C;E++)_+=this.getHeightOfLine(E);return _+=2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(e){Ee(this,gr,e,"f"),I(this,$r,"f")&&clearTimeout(I(this,$r,"f")),I(this,gr,"f")>=0&&Ee(this,$r,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},I(this,gr,"f")),"f")}getDuration(){return I(this,gr,"f")}}gr=new WeakMap,$r=new WeakMap;class yf{constructor(){pr.add(this),Ot.set(this,void 0),Zr.set(this,void 0),qr.set(this,void 0),Jr.set(this,!0),this._drawingLayerManager=new _f}createDrawingLayerBaseCvs(e,r,a="contain"){if(typeof e!="number"||e<=1)throw new Error("Invalid 'width'.");if(typeof r!="number"||r<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(a))throw new Error("Unsupported 'objectFit'.");const d=document.createElement("canvas");return d.width==e&&d.height==r||(d.width=e,d.height=r),d.style.objectFit=a,d}_createDrawingLayer(e,r,a,d){if(!this._layerBaseCvs){let E;try{E=this.getContentDimensions()}catch(C){if((C.message||C)!=="Invalid content dimensions.")throw C}r||(r=(E==null?void 0:E.width)||1280),a||(a=(E==null?void 0:E.height)||720),d||(d=(E==null?void 0:E.objectFit)||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(r,a,d)}const p=this._layerBaseCvs,_=this._drawingLayerManager.createDrawingLayer(p,e);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",p.parentElement),_}createDrawingLayer(){let e;for(let r=Ze.USER_DEFINED_LAYER_BASE_ID;;r++)if(!this._drawingLayerManager.getDrawingLayer(r)&&r!==Ze.TIP_LAYER_ID){e=r;break}return this._createDrawingLayer(e)}deleteDrawingLayer(e){var r;this._drawingLayerManager.deleteDrawingLayer(e),this._drawingLayerManager.getAllDrawingLayers().length||((r=this._innerComponent)===null||r===void 0||r.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(e){if(typeof e!="number")throw new TypeError("Invalid id.");if(e<Ze.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${e} is not defined by users.`);this.deleteDrawingLayer(e)}_clearDrawingLayers(){const e=this.getAllDrawingLayers();for(let r of e)this.deleteDrawingLayer(r.getId())}clearUserDefinedDrawingLayers(){const e=this.getAllDrawingLayers();for(let r of e){const a=r.getId();a<Ze.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(a)}}getDrawingLayer(e){return e==Ze.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(e)||([Ze.DDN_LAYER_ID,Ze.DBR_LAYER_ID,Ze.DLR_LAYER_ID].includes(e)?this._createDrawingLayer(e):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(e=>e.getId()>=0&&e.getId()!==Ze.TIP_LAYER_ID)}updateDrawingLayers(e){((r,a,d)=>{if(!(r<=1||a<=1)){if(!["contain","cover"].includes(d))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:r,height:a},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(d)}})(e.width,e.height,e.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(e){if(!(sc(r=e)&&df(r.topLeftPoint)&&Rr(r.width))||r.width<=0||!Rr(r.duration)||"coordinateBase"in r&&!["view","image"].includes(r.coordinateBase))throw new Error("Invalid tip config.");var r;Ee(this,Ot,JSON.parse(JSON.stringify(e)),"f"),I(this,Ot,"f").coordinateBase||(I(this,Ot,"f").coordinateBase="view"),Ee(this,qr,e.duration,"f"),I(this,pr,"m",uc).call(this)}getTipConfig(){return I(this,Ot,"f")?I(this,Ot,"f"):null}setTipVisible(e){if(typeof e!="boolean")throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",e),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Ee(this,Jr,e,"f")}isTipVisible(){return I(this,Jr,"f")}updateTipMessage(e){if(!I(this,Ot,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=le.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(Ze.TIP_LAYER_ID)||this._createDrawingLayer(Ze.TIP_LAYER_ID)),this._tip?this._tip.set("text",e):this._tip=I(this,pr,"m",lc).call(this,e,I(this,Ot,"f").topLeftPoint.x,I(this,Ot,"f").topLeftPoint.y,I(this,Ot,"f").width,I(this,Ot,"f").coordinateBase,this._tipStyleId),I(this,pr,"m",hc).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",I(this,Jr,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),I(this,Zr,"f")&&clearTimeout(I(this,Zr,"f")),I(this,qr,"f")>=0&&Ee(this,Zr,setTimeout(()=>{I(this,pr,"m",cc).call(this)},I(this,qr,"f")),"f")}}Ot=new WeakMap,Zr=new WeakMap,qr=new WeakMap,Jr=new WeakMap,pr=new WeakSet,lc=function(t,e,r,a,d,p){const _=new vf(t,e,r,a,p);return _.coordinateBase=d,_},hc=function(t,e){e.hasDrawingItem(t)||e.addDrawingItems([t])},cc=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},uc=function(){if(!this._tip)return;const t=I(this,Ot,"f");this._tip.coordinateBase=t.coordinateBase,this._tip.setTextRect({x:t.topLeftPoint.x,y:t.topLeftPoint.y,width:t.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};class fc extends HTMLElement{constructor(){super(),Qn.set(this,void 0);const e=document.createElement("template").content,r=document.createElement("div");r.setAttribute("class","wrapper"),e.appendChild(r),Ee(this,Qn,r,"f");const a=document.createElement("slot");a.setAttribute("name","single-frame-input-container"),r.append(a);const d=document.createElement("slot");d.setAttribute("name","content"),r.append(d);const p=document.createElement("slot");p.setAttribute("name","drawing-layer"),r.append(p);const _=document.createElement("style");_.textContent=`
.wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}
::slotted(canvas[slot="content"]) {
  object-fit: contain;
  pointer-events: none;
}
::slotted(div[slot="single-frame-input-container"]) {
  width: 1px;
  height: 1px;
  overflow: hidden;
  pointer-events: none;
}
::slotted(*) {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
    `,e.appendChild(_),this.attachShadow({mode:"open"}).appendChild(e.cloneNode(!0))}getWrapper(){return I(this,Qn,"f")}setElement(e,r){if(!(r instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");this.removeElement(e),r.setAttribute("slot",e),this.appendChild(r)}getElement(e){if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${e}"]`)}removeElement(e){var r;if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");(r=this.querySelectorAll(`[slot="${e}"]`))===null||r===void 0||r.forEach(a=>a.remove())}}Qn=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",fc);class lr extends HTMLElement{constructor(){super();const e=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(e.cloneNode(!0))}showScanLaser(){const e=this.shadowRoot.querySelector(".dce-scanlight");e&&(e.style.display="")}hideScanLaser(){const e=this.shadowRoot.querySelector(".dce-scanlight");e&&(e.style.display="none")}getElement(e){return this.shadowRoot.querySelector(e)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}}class et extends yf{static get engineResourcePath(){return tt.engineResourcePaths.dce}static set defaultUIElementURL(e){et._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=et._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",et.engineResourcePath)}static async createInstance(e){customElements.get(et.uiComponentName)||customElements.define(et.uiComponentName,lr);const r=new et;return await r.setUIElement(e||et.defaultUIElementURL),r}static _transformCoordinates(e,r,a,d,p,_,E){const C=_/d,b=E/p;e.x=Math.round(e.x/C+r),e.y=Math.round(e.y/b+a)}set _singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(e!==I(this,rn,"f")){if(Ee(this,rn,e,"f"),I(this,Ye,"m",At).call(this))Ee(this,it,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!I(this,it,"f")){const r=document.createElement("video");r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.width="100%",r.style.height="100%",r.style.objectFit=this.getVideoFit(),r.setAttribute("autoplay","true"),r.setAttribute("playsinline","true"),r.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(ht.OS)&&r.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Ee(this,it,r,"f");const a=document.createElement("div");a.append(r),a.style.overflow="hidden",this._videoContainer=a,this._innerComponent.setElement("content",a)}I(this,Ye,"m",At).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return I(this,rn,"f")}get disposed(){return I(this,Bo,"f")}constructor(){super(),Ye.add(this),Qr.set(this,void 0),en.set(this,void 0),tn.set(this,void 0),this.containerClassName="dce-video-container",it.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,es.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,ts.set(this,!1),is.set(this,!1),bi.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{I(this,Ye,"m",sn).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&I(this,Ye,"m",Uo).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{et._onLog&&et._onLog("window resize event triggered."),I(this,bi,"f").width===document.documentElement.clientWidth&&I(this,bi,"f").height===document.documentElement.clientHeight||(I(this,bi,"f").width=document.documentElement.clientWidth,I(this,bi,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},rn.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!I(this,Ye,"m",At).call(this))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),this._singleFrameMode==="camera"?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):this._singleFrameMode==="image"&&(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",async()=>{const a=e.files[0];e.value="";{const d=async k=>{let V=null,H=null;if(typeof createImageBitmap<"u")try{if(V=await createImageBitmap(k),V)return V}catch{}var z;return V||(H=await(z=k,new Promise((Z,$)=>{let J=URL.createObjectURL(z),te=new Image;te.src=J,te.onload=()=>{URL.revokeObjectURL(te.src),Z(te)},te.onerror=he=>{$(new Error("Can't convert blob to image : "+(he instanceof Event?he.type:he)))}}))),H},p=(k,V,H,z)=>{k.width==H&&k.height==z||(k.width=H,k.height=z);const Z=k.getContext("2d");Z.clearRect(0,0,k.width,k.height),Z.drawImage(V,0,0)},_=await d(a),E=_ instanceof HTMLImageElement?_.naturalWidth:_.width,C=_ instanceof HTMLImageElement?_.naturalHeight:_.height;let b=this._cvsSingleFrameMode;const O=b==null?void 0:b.width,M=b==null?void 0:b.height;b||(b=document.createElement("canvas"),this._cvsSingleFrameMode=b),p(b,_,E,C),this._innerComponent.setElement("content",b),O===b.width&&M===b.height||this.eventHandler.fire("content:updated",null,{async:!1})}this._onSingleFrameAcquired&&setTimeout(()=>{this._onSingleFrameAcquired(this._cvsSingleFrameMode)},0)}),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";const r=document.createElement("div");r.append(e),this._innerComponent.setElement("single-frame-input-container",r),this._singleFrameInputContainer=r}e==null||e.click()},nn.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(e,r)=>{var a,d,p,_;if(this.disposed||(this.clearAllInnerDrawingItems(),!e))return;const E=e.originalImageTag;if(!E)return;const C=e.items;if(!(C!=null&&C.length))return;const b=((a=E.cropRegion)===null||a===void 0?void 0:a.left)||0,O=((d=E.cropRegion)===null||d===void 0?void 0:d.top)||0,M=!((p=E.cropRegion)===null||p===void 0)&&p.right?E.cropRegion.right-b:E.originalWidth,k=!((_=E.cropRegion)===null||_===void 0)&&_.bottom?E.cropRegion.bottom-O:E.originalHeight,V=E.currentWidth,H=E.currentHeight,z=(J,te,he,ce,ue,be,v,pe,Ce=[],fe)=>{te.forEach(s=>et._transformCoordinates(s,he,ce,ue,be,v,pe));const l=new pf({points:[{x:te[0].x,y:te[0].y},{x:te[1].x,y:te[1].y},{x:te[2].x,y:te[2].y},{x:te[3].x,y:te[3].y}]},fe);for(let s of Ce)l.addNote(s);J.addDrawingItems([l]),I(this,nn,"f").push(l)};let Z,$;for(let J of C)switch(J.type){case Se.CRIT_ORIGINAL_IMAGE:break;case Se.CRIT_BARCODE:Z=this.getDrawingLayer(Ze.DBR_LAYER_ID),$=[{name:"format",content:J.formatString},{name:"text",content:J.text}],r!=null&&r.isBarcodeVerifyOpen?J.verified?z(Z,J.location.points,b,O,M,k,V,H,$):z(Z,J.location.points,b,O,M,k,V,H,$,le.STYLE_ORANGE_STROKE_TRANSPARENT):z(Z,J.location.points,b,O,M,k,V,H,$);break;case Se.CRIT_TEXT_LINE:Z=this.getDrawingLayer(Ze.DLR_LAYER_ID),$=[{name:"text",content:J.text}],r.isLabelVerifyOpen?J.verified?z(Z,J.location.points,b,O,M,k,V,H,$):z(Z,J.location.points,b,O,M,k,V,H,$,le.STYLE_GREEN_STROKE_TRANSPARENT):z(Z,J.location.points,b,O,M,k,V,H,$);break;case Se.CRIT_DETECTED_QUAD:Z=this.getDrawingLayer(Ze.DDN_LAYER_ID),r!=null&&r.isDetectVerifyOpen?J.verified?z(Z,J.location.points,b,O,M,k,V,H,[]):z(Z,J.location.points,b,O,M,k,V,H,[],le.STYLE_BLUE_STROKE_TRANSPARENT):z(Z,J.location.points,b,O,M,k,V,H,[]);break;case Se.CRIT_NORMALIZED_IMAGE:Z=this.getDrawingLayer(Ze.DDN_LAYER_ID),r!=null&&r.isNormalizeVerifyOpen?J.verified?z(Z,J.location.points,b,O,M,k,V,H,[]):z(Z,J.location.points,b,O,M,k,V,H,[],le.STYLE_BLUE_STROKE_TRANSPARENT):z(Z,J.location.points,b,O,M,k,V,H,[]);break;case Se.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},Bo.set(this,!1),this.eventHandler=new oc,this.eventHandler.on("content:updated",()=>{I(this,Qr,"f")&&clearTimeout(I(this,Qr,"f")),Ee(this,Qr,setTimeout(()=>{if(this.disposed)return;let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(r){if((r.message||r)==="Invalid content dimensions.")return;throw r}this.updateDrawingLayers(e),this.updateConvertedRegion(e)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{I(this,en,"f")&&clearTimeout(I(this,en,"f")),Ee(this,en,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(e){e instanceof HTMLTemplateElement?(window._dce_default_template=e,this.UIElement=new lr):this.UIElement=e,this._unbindUI(),this._bindUI()}async setUIElement(e){let r;if(r=typeof e=="string"?await Ll(e):e,r instanceof HTMLDivElement&&r.childElementCount==0){const a=await Ll(et.defaultUIElementURL);a instanceof HTMLTemplateElement?(window._dce_default_template=a,r.append(new lr)):r.append(a),this._setUIElement(r)}else this._setUIElement(r)}getUIElement(){return this.UIElement}_bindUI(){var e;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let r,a=this.UIElement;if(a instanceof lr?r=a.getElement(`.${this.containerClassName}`):a instanceof HTMLDivElement&&a.childElementCount===1&&a.firstElementChild instanceof lr?(r=a.firstElementChild.getElement(`.${this.containerClassName}`),a=a.firstElementChild):r=a.classList.contains(this.containerClassName)?a:a.querySelector(`.${this.containerClassName}`),!r)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new fc,r.appendChild(this._innerComponent),!I(this,Ye,"m",At).call(this)){const d=document.createElement("video");d.style.position="absolute",d.style.left="0",d.style.top="0",d.style.width="100%",d.style.height="100%",d.style.objectFit=this.getVideoFit(),d.setAttribute("autoplay","true"),d.setAttribute("playsinline","true"),d.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(ht.OS)&&d.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Ee(this,it,d,"f");const p=document.createElement("div");p.append(d),p.style.overflow="hidden",this._videoContainer=p,this._innerComponent.setElement("content",p)}if(a instanceof lr?(this._selRsl=a.getElement(".dce-sel-resolution"),this._selMinLtr=a.getElement(".dlr-sel-minletter"),this._divScanArea=a.getElement(".dce-scanarea"),this._divScanLight=a.getElement(".dce-scanlight"),this._bgLoading=a.getElement(".dce-bg-loading"),this._bgCamera=a.getElement(".dce-bg-camera"),this._selCam=a.getElement(".dce-sel-camera"),this._optGotRsl=a.getElement(".dce-opt-gotResolution"),this._btnClose=a.getElement(".dce-btn-close"),this._optGotMinLtr=a.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=a.querySelector(".dce-sel-resolution"),this._selMinLtr=a.querySelector(".dlr-sel-minletter"),this._divScanArea=a.querySelector(".dce-scanarea"),this._divScanLight=a.querySelector(".dce-scanlight"),this._bgLoading=a.querySelector(".dce-bg-loading"),this._bgCamera=a.querySelector(".dce-bg-camera"),this._selCam=a.querySelector(".dce-sel-camera"),this._optGotRsl=a.querySelector(".dce-opt-gotResolution"),this._btnClose=a.querySelector(".dce-btn-close"),this._optGotMinLtr=a.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||I(this,Ye,"m",At).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||I(this,Ye,"m",At).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||I(this,Ye,"m",sn).call(this),I(this,Ye,"m",At).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),I(this,Ye,"m",At).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(p=>{var _;et._onLog&&et._onLog("resize observer triggered.");for(let E of p)E.target===((_=this._innerComponent)===null||_===void 0?void 0:_.getWrapper())&&this._videoResizeListener()}));const d=(e=this._innerComponent)===null||e===void 0?void 0:e.getWrapper();d&&this._resizeObserver.observe(d)}I(this,bi,"f").width=document.documentElement.clientWidth,I(this,bi,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var e,r,a,d;I(this,Ye,"m",At).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),I(this,Ye,"m",sn).call(this),(e=this._drawingLayerManager)===null||e===void 0||e.clearDrawingLayers(),(r=this._innerComponent)===null||r===void 0||r.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,(a=this._innerComponent)===null||a===void 0||a.remove(),this._innerComponent=null,Ee(this,it,null,"f"),(d=this._videoContainer)===null||d===void 0||d.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(e,r){if(!this._selCam)return;let a;this._selCam.textContent="";for(let d of r){const p=document.createElement("option");p.value=d.deviceId,p.innerText=d.label,this._selCam.append(p),d.deviceId&&e&&e.deviceId==d.deviceId&&(a=p)}this._selCam.value=a?a.value:""}_renderResolutionInfo(e){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",e.width),this._optGotRsl.setAttribute("data-height",e.height),this._optGotRsl.innerText="got "+e.width+"x"+e.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return I(this,it,"f")}isVideoLoaded(){return!!I(this,it,"f")&&I(this,it,"f").readyState==4}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,!I(this,it,"f")||(I(this,it,"f").style.objectFit=e,I(this,Ye,"m",At).call(this)))return;let r;this._updateVideoContainer();try{r=this.getContentDimensions()}catch(a){if((a.message||a)==="Invalid content dimensions.")return;throw a}I(this,Ye,"m",ns).call(this,r,this.getConvertedRegion()),this.updateDrawingLayers(r)}getVideoFit(){return this.videoFit}getContentDimensions(){var e,r,a,d;let p,_,E;if(I(this,Ye,"m",At).call(this)?(p=(a=this._cvsSingleFrameMode)===null||a===void 0?void 0:a.width,_=(d=this._cvsSingleFrameMode)===null||d===void 0?void 0:d.height,E="contain"):(p=(e=I(this,it,"f"))===null||e===void 0?void 0:e.videoWidth,_=(r=I(this,it,"f"))===null||r===void 0?void 0:r.videoHeight,E=this.getVideoFit()),!p||!_)throw new Error("Invalid content dimensions.");return{width:p,height:_,objectFit:E}}updateConvertedRegion(e){const r=qn.convert(this.scanRegion,e.width,e.height);Ee(this,es,r,"f"),I(this,tn,"f")&&clearTimeout(I(this,tn,"f")),Ee(this,tn,setTimeout(()=>{let a;try{a=this.getContentDimensions()}catch(d){if((d.message||d)==="Invalid content dimensions.")return;throw d}I(this,Ye,"m",rs).call(this,a,r),I(this,Ye,"m",ns).call(this,a,r)},0),"f")}getConvertedRegion(){return I(this,es,"f")}setScanRegion(e){if(e!=null&&!Ta(e)&&!nr(e))throw TypeError("Invalid 'region'.");let r;this.scanRegion=e?JSON.parse(JSON.stringify(e)):null;try{r=this.getContentDimensions()}catch(a){if((a.message||a)==="Invalid content dimensions.")return;throw a}this.updateConvertedRegion(r)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(e){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");const r=I(this,it,"f").videoWidth,a=I(this,it,"f").videoHeight,d=this.getVideoFit(),{width:p,height:_}=this._innerComponent.getBoundingClientRect();if(p<=0||_<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let E;const C={x:0,y:0,width:r,height:a,isMeasuredInPercentage:!1};if(d==="cover"&&(p/_<r/a?(E=_/a,C.x=Math.floor((r-p/E)/2),C.y=0,C.width=Math.ceil(p/E),C.height=a):(E=p/r,C.x=0,C.y=Math.floor((a-_/E)/2),C.width=r,C.height=Math.ceil(_/E))),e==null?void 0:e.inPixels)return C;const b=C;return b.x=Math.ceil(b.x/a*100),b.y=Math.ceil(b.y/r*100),b.width=Math.floor(b.width/r*100),b.height=Math.floor(b.height/a*100),b.isMeasuredInPercentage=!0,C}setScanRegionMask(e,r,a,d){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||I(this,Ye,"m",jo).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=le.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=le.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));const p=this._drawingLayerOfMask.width,_=this._drawingLayerOfMask.height,E=new ar({x:0,y:0,width:p,height:_},this._maskBackRectStyleId),C=new ar({x:-p/2,y:-_/2+r,width:e,height:d}),b=new ar({x:-p/2+e+a,y:-_/2+r,width:p-e-a<0?0:p-e-a,height:d}),O=new ar({x:-p/2,y:-_/2,width:p,height:r}),M=new ar({x:-p/2,y:-_/2+r+d,width:p,height:_-r-d<0?0:_-r-d});C.set("strokeWidth",0),b.set("strokeWidth",0),O.set("strokeWidth",0),M.set("strokeWidth",0);const k=new mf([C,b,O,M])._getFabricObject();E.set("clipPath",k);const V=new ar({x:e,y:r,width:a,height:d},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([E,V])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(e){Ee(this,ts,e,"f"),e?I(this,Ye,"m",dc).call(this):I(this,Ye,"m",jo).call(this)}setScanRegionMaskVisible(e){this._setScanRegionMaskVisible(e),this._userSetMaskVisible=e}isScanRegionMaskVisible(){return I(this,ts,"f")}setScanRegionMaskStyle(e){if(!e)return;let r;e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._maskBackRectStyleId&&le.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&le.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{r=this.getContentDimensions()}catch(a){if((a.message||a)==="Invalid content dimensions.")return;throw a}I(this,Ye,"m",rs).call(this,r,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(e){Ee(this,is,e,"f"),e?I(this,Ye,"m",Uo).call(this):I(this,Ye,"m",sn).call(this)}setScanLaserVisible(e){this._setScanLaserVisible(e),this._userSetLaserVisible=e}isScanLaserVisible(){return I(this,is,"f")}_updateVideoContainer(){if(!I(this,it,"f")||I(this,Ye,"m",At).call(this))return;let e=1;const r=I(this,it,"f").style.transform.match(/scale\((.+)\)/);r&&(e=parseFloat(r[1]));const a=this._videoContainer;if(this.videoFit==="contain"&&e>1){const d=I(this,it,"f").videoWidth,p=I(this,it,"f").videoHeight,{width:_,height:E}=this._innerComponent.getBoundingClientRect(),C=d/p;if(_/E<C){let b=_/C;a.style.left="0",a.style.top=(E-b)/2/E*100+"%",a.style.width="100%",a.style.height=b/E*100+"%"}else{let b=E*C;a.style.left=(_-b)/2/_*100+"%",a.style.top="0",a.style.width=b/_*100+"%",a.style.height="100%"}}else a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%"}updateLayers(){let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(a){if((a.message||a)==="Invalid content dimensions.")return;throw a}const r=this.getConvertedRegion();I(this,Ye,"m",ns).call(this,e,r),this.updateDrawingLayers(e),I(this,Ye,"m",rs).call(this,e,r)}clearAllInnerDrawingItems(){I(this,nn,"f").forEach(e=>e.remove()),I(this,nn,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"disposed",{value:!0})}}function j(t,e,r,a){if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?a:r==="a"?a.call(t):a?a.value:e.get(t)}function Pe(t,e,r,a,d){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!d)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!d:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?d.call(t,r):d?d.value=r:e.set(t,r),r}Qr=new WeakMap,en=new WeakMap,tn=new WeakMap,it=new WeakMap,es=new WeakMap,ts=new WeakMap,is=new WeakMap,bi=new WeakMap,rn=new WeakMap,nn=new WeakMap,Bo=new WeakMap,Ye=new WeakSet,At=function(){return this._singleFrameMode!=="disabled"},rs=function(t,e){e&&(e.x!==0||e.y!==0||e.width!==t.width||e.height!==t.height)?this.setScanRegionMask(e.x,e.y,e.width,e.height):this.clearScanRegionMask()},dc=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},jo=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},Uo=function(){this._divScanLight&&this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block")},sn=function(){this._divScanLight&&(this._divScanLight.style.display="none")},ns=function(t,e){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;const{width:r,height:a,objectFit:d}=t;e||(e={x:0,y:0,width:r,height:a});const{width:p,height:_}=this._innerComponent.getBoundingClientRect();if(p<=0||_<=0)return;const E=p/_,C=r/a;let b,O,M,k,V=1;if(d==="contain")E<C?(V=p/r,b=0,O=(_-a*V)/2):(V=_/a,b=(p-r*V)/2,O=0),b+=e.x*V,O+=e.y*V,M=e.width*V,k=e.height*V;else if(d==="cover")if(E<C){V=_/a,b=e.x*V-(r*V-p)/2,b=Math.max(b,0),b=Math.min(b,p),O=e.y*V;let H=(e.x+e.width)*V-(r*V-p)/2;H=Math.max(H,0),H=Math.min(H,p),M=H-b,k=e.height*V}else{V=p/r,b=e.x*V,O=e.y*V-(a*V-_)/2,O=Math.max(O,0),O=Math.min(O,_);let H=(e.y+e.height)*V-(a*V-_)/2;H=Math.max(H,0),H=Math.min(H,_),M=e.width*V,k=H-O}else b=0,O=0,M=0,k=0;this._divScanArea.style.left=b+"px",this._divScanArea.style.top=O+"px",this._divScanArea.style.width=M+"px",this._divScanArea.style.height=k+"px"},et.uiComponentName="default-camera-view",et._defaultUIElementURL="@engineResourcePath/dce.ui.html",typeof SuppressedError=="function"&&SuppressedError;const Nl=typeof self>"u";let Gr,Wr,Wn,lo,ft;function mt(t,e,r,a){if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?a:r==="a"?a.call(t):a?a.value:e.get(t)}function Bt(t,e,r,a,d){if(a==="m")throw new TypeError("Private method is not writable");if(a==="a"&&!d)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!d:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return a==="a"?d.call(t,r):d?d.value=r:e.set(t,r),r}typeof navigator<"u"&&(Gr=navigator,Wr=Gr.userAgent,Wn=Gr.platform,lo=Gr.mediaDevices),function(){if(!Nl){const t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:Gr.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Wn,search:"Win"},Mac:{str:Wn},Linux:{str:Wn}};let r="unknownBrowser",a=0,d="unknownOS";for(let p in t){const _=t[p]||{};let E=_.str||Wr,C=_.search||p,b=_.verStr||Wr,O=_.verSearch||p;if(O instanceof Array||(O=[O]),E.indexOf(C)!=-1){r=p;for(let M of O){let k=b.indexOf(M);if(k!=-1){a=parseFloat(b.substring(k+M.length+1));break}}break}}for(let p in e){const _=e[p]||{};let E=_.str||Wr,C=_.search||p;if(E.indexOf(C)!=-1){d=p;break}}d=="Linux"&&Wr.indexOf("Windows NT")!=-1&&(d="HarmonyOS"),ft={browser:r,version:a,OS:d}}Nl&&(ft={browser:"ssr",version:0,OS:"ssr"})}(),lo&&lo.getUserMedia,ft.browser==="Chrome"&&ft.version>66||ft.browser==="Safari"&&ft.version>13||ft.browser==="OPR"&&ft.version>43||ft.browser==="Edge"&&ft.version,typeof SuppressedError=="function"&&SuppressedError;let ei=class ss{static multiply(e,r){const a=[];for(let d=0;d<3;d++){const p=r.slice(3*d,3*d+3);for(let _=0;_<3;_++){const E=[e[_],e[_+3],e[_+6]].reduce((C,b,O)=>C+b*p[O],0);a.push(E)}}return a}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,r,a){return ss.multiply(e,[1,0,0,0,1,0,r,a,1])}static rotate(e,r){var a=Math.cos(r),d=Math.sin(r);return ss.multiply(e,[a,-d,0,d,a,0,0,0,1])}static scale(e,r,a){return ss.multiply(e,[r,0,0,0,a,0,0,0,1])}};var Fe,ri,ni,os,mr,on,an,_r,as;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(Fe||(Fe={}));class Ie{static get version(){return"1.1.0"}static checkWebGLSupport(){return document.createElement("canvas").getContext("webgl")===null?(Bt(Ie,ri,!1,"f",ni),!1):(Bt(Ie,ri,!0,"f",ni),!0)}get disposed(){return mt(this,as,"f")}constructor(){os.set(this,Fe.RGBA),mr.set(this,null),on.set(this,null),an.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,_r.set(this,null),as.set(this,!1)}drawImage(e,r,a,d,p,_){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!a||!d)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(mt(Ie,ri,"f",ni)==null&&Ie.checkWebGLSupport(),(_==null?void 0:_.bUseWebGL)&&!mt(Ie,ri,"f",ni))throw new Error("Your browser or machine may not support WebGL.");if(r instanceof HTMLVideoElement&&r.readyState!==4||r instanceof HTMLImageElement&&!r.complete)throw new Error("The source is not loaded.");let E;Ie._onLog&&(E=Date.now(),Ie._onLog("drawImage(), START: "+E));let C=0,b=0,O=a,M=d,k=0,V=0,H=a,z=d;p&&(p.sx&&(C=Math.round(p.sx)),p.sy&&(b=Math.round(p.sy)),p.sWidth&&(O=Math.round(p.sWidth)),p.sHeight&&(M=Math.round(p.sHeight)),p.dx&&(k=Math.round(p.dx)),p.dy&&(V=Math.round(p.dy)),p.dWidth&&(H=Math.round(p.dWidth)),p.dHeight&&(z=Math.round(p.dHeight)));let Z,$=Fe.RGBA;if(_!=null&&_.pixelFormat&&($=_.pixelFormat),(_==null?void 0:_.bufferContainer)&&(Z=_.bufferContainer,Z.length<4*H*z))throw new Error("Unexpected size of the 'bufferContainer'.");const J=e;if(!mt(Ie,ri,"f",ni)||!(this.useWebGLByDefault&&(_==null?void 0:_.bUseWebGL)==null||_!=null&&_.bUseWebGL)){Ie._onLog&&Ie._onLog("drawImage() in context2d."),J.ctx2d||(J.ctx2d=J.getContext("2d",{willReadFrequently:!0}));const te=J.ctx2d;if(!te)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(J.width<k+H||J.height<V+z)&&(J.width=k+H,J.height=V+z),te.drawImage(r,C,b,O,M,k,V,H,z),Ie._onLog&&Ie._onLog("drawImage() in context2d end. Costs: "+(Date.now()-E)),{context:te,pixelFormat:Fe.RGBA,bUseWebGL:!1}}Ie._onLog&&Ie._onLog("drawImage() in WebGL.");try{(J.width<k+H||J.height<V+z)&&(J.width=k+H,J.height=V+z,J.ctxWebGL&&J.ctxWebGL.viewport(0,0,k+H,V+z));const te=J.ctxWebGL||J.getContext("webgl",{antialias:!1})||J.getContext("experimental-webgl",{antialias:!1});if(!te){Ie._onLog&&Ie._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");const v=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw v.name="WebGLError",v}if(!J.ctxWebGL||$!==mt(this,os,"f")){J.ctxWebGL=te;const v=i=>{const n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW);const h=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,h),i.bufferData(i.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),i.STATIC_DRAW),{positions:n,texCoords:h}},pe=i=>{const n=i.createTexture();return i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),n},Ce=(i,n)=>{const h=i.createProgram();if(n.forEach(g=>i.attachShader(h,g)),i.linkProgram(h),!i.getProgramParameter(h,i.LINK_STATUS)){const g=new Error(`An error occured linking the program: ${i.getProgramInfoLog(h)}.`);throw g.name="WebGLError",g}return i.useProgram(h),h},fe=(i,n,h)=>{const g=i.createShader(n);if(i.shaderSource(g,h),i.compileShader(g),!i.getShaderParameter(g,i.COMPILE_STATUS)){const u=new Error(`An error occured compiling the shader: ${i.getShaderInfoLog(g)}.`);throw u.name="WebGLError",u}return g},l=`
                  attribute vec2 a_position;
                  attribute vec2 a_texCoord;
  
                  uniform mat3 u_matrix;
                  uniform mat3 u_textureMatrix;
  
                  varying vec2 v_texCoord;
                  void main(void) {
                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                  }
              `;let s="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes($)&&(s=$.slice(0,3));const o=`
                  precision mediump float;
                  varying vec2 v_texCoord;
                  uniform sampler2D u_image;
                  uniform float uColorFactor;
  
                  void main() {
                      vec4 sample = texture2D(u_image, v_texCoord);
                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                      gl_FragColor = vec4(sample.${s} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                  }
              `,c=Ce(te,[fe(te,te.VERTEX_SHADER,l),fe(te,te.FRAGMENT_SHADER,o)]);Bt(this,on,{program:c,attribLocations:{vertexPosition:te.getAttribLocation(c,"a_position"),texPosition:te.getAttribLocation(c,"a_texCoord")},uniformLocations:{uSampler:te.getUniformLocation(c,"u_image"),uColorFactor:te.getUniformLocation(c,"uColorFactor"),uMatrix:te.getUniformLocation(c,"u_matrix"),uTextureMatrix:te.getUniformLocation(c,"u_textureMatrix")}},"f"),Bt(this,an,v(te),"f"),Bt(this,mr,pe(te),"f"),Bt(this,os,$,"f")}const he=(v,pe,Ce)=>{v.bindBuffer(v.ARRAY_BUFFER,pe),v.enableVertexAttribArray(Ce),v.vertexAttribPointer(Ce,2,v.FLOAT,!1,0,0)},ce=(v,pe,Ce)=>{const fe=v.RGBA,l=v.RGBA,s=v.UNSIGNED_BYTE;v.bindTexture(v.TEXTURE_2D,pe),v.texImage2D(v.TEXTURE_2D,0,fe,l,s,Ce)},ue=(v,pe,Ce,fe)=>{v.clearColor(0,0,0,1),v.clearDepth(1),v.enable(v.DEPTH_TEST),v.depthFunc(v.LEQUAL),v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT),he(v,Ce.positions,pe.attribLocations.vertexPosition),he(v,Ce.texCoords,pe.attribLocations.texPosition),v.activeTexture(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,fe),v.uniform1i(pe.uniformLocations.uSampler,0),v.uniform1f(pe.uniformLocations.uColorFactor,[Fe.GREY,Fe.GREY32].includes($)?1:0);let l,s,o=ei.translate(ei.identity(),-1,-1);o=ei.scale(o,2,2),o=ei.scale(o,1/v.canvas.width,1/v.canvas.height),l=ei.translate(o,k,V),l=ei.scale(l,H,z),v.uniformMatrix3fv(pe.uniformLocations.uMatrix,!1,l),s=ei.translate(ei.identity(),C/a,b/d),s=ei.scale(s,O/a,M/d),v.uniformMatrix3fv(pe.uniformLocations.uTextureMatrix,!1,s),v.drawArrays(v.TRIANGLES,0,6)};ce(te,mt(this,mr,"f"),r),ue(te,mt(this,on,"f"),mt(this,an,"f"),mt(this,mr,"f"));const be=Z||new Uint8Array(4*H*z);if(te.readPixels(k,V,H,z,te.RGBA,te.UNSIGNED_BYTE,be),be[3]!==255){Ie._onLog&&Ie._onLog("Incorrect WebGL drawing .");const v=new Error("WebGL error: incorrect drawing.");throw v.name="WebGLError",v}return Ie._onLog&&Ie._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-E)),{context:te,pixelFormat:$===Fe.GREY?Fe.GREY32:$,bUseWebGL:!0}}catch(te){if(this.forceLoseContext(),(_==null?void 0:_.bUseWebGL)==null)return Ie._onLog&&Ie._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,r,a,d,p,Object.assign({},_,{bUseWebGL:!1}));throw te.name="WebGLError",te}}readCvsData(e,r,a){if(!(e instanceof CanvasRenderingContext2D||e instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let d,p=0,_=0,E=e.canvas.width,C=e.canvas.height;if(r&&(r.x&&(p=r.x),r.y&&(_=r.y),r.width&&(E=r.width),r.height&&(C=r.height)),(a==null?void 0:a.length)<4*E*C)throw new Error("Unexpected size of the 'bufferContainer'.");if(e instanceof WebGLRenderingContext){const b=e;a?(b.readPixels(p,_,E,C,b.RGBA,b.UNSIGNED_BYTE,a),d=new Uint8Array(a.buffer,0,4*E*C)):(d=new Uint8Array(4*E*C),b.readPixels(p,_,E,C,b.RGBA,b.UNSIGNED_BYTE,d))}else if(e instanceof CanvasRenderingContext2D){let b;b=e.getImageData(p,_,E,C),d=new Uint8Array(b.data.buffer),a==null||a.set(d)}return d}transformPixelFormat(e,r,a,d){let p,_;if(Ie._onLog&&(p=Date.now(),Ie._onLog("transformPixelFormat(), START: "+p)),r===a)return Ie._onLog&&Ie._onLog("transformPixelFormat() end. Costs: "+(Date.now()-p)),d?new Uint8Array(e):e;const E=[Fe.RGBA,Fe.RBGA,Fe.GRBA,Fe.GBRA,Fe.BRGA,Fe.BGRA];if(E.includes(r))if(a===Fe.GREY){_=new Uint8Array(e.length/4);for(let C=0;C<e.length;C+=4){const b=.21*e[C]+.71*e[C+1]+.07*e[C+2];_[C/4]=b}}else if(a===Fe.GREY32){_=d?new Uint8Array(e):e;for(let C=0;C<e.length;C+=4){const b=.21*e[C]+.71*e[C+1]+.07*e[C+2];_[C]=b,_[C+1]=b,_[C+2]=b}}else{if(!E.includes(a))throw new Error("Unable to transform.");if(d){_=new Uint8Array(e);const C=r.indexOf("r"),b=r.indexOf("g"),O=r.indexOf("b"),M=a.indexOf("r"),k=a.indexOf("g"),V=a.indexOf("b");for(let H=0;H<e.length;H+=4)_[H+M]=e[H+C],_[H+k]=e[H+b],_[H+V]=e[H+O]}else{_=e;const C=r.indexOf("r"),b=r.indexOf("g"),O=r.indexOf("b"),M=a.indexOf("r"),k=a.indexOf("g"),V=a.indexOf("b");for(let H=0;H<e.length;H+=4){let z=[e[H],e[H+1],e[H+2]];_[H+M]=z[C],_[H+k]=z[b],_[H+V]=z[O]}}}else if(r===Fe.GREY){if(a!==Fe.GREY32)throw new Error("Unable to transform.");_=new Uint8Array(4*e.length);for(let C=0;C<e.length;C++)_[4*C]=e[C],_[4*C+1]=e[C],_[4*C+2]=e[C],_[4*C+3]=255}else{if(r!==Fe.GREY32)throw new Error("Unable to transform.");if(a!==Fe.GREY)throw new Error("Unable to transform.");_=new Uint8Array(e.length/4);for(let C=0;C<e.length;C+=4)_[C/4]=e[C]}return Ie._onLog&&Ie._onLog("transformPixelFormat() end. Costs: "+(Date.now()-p)),_}getImageData(e,r,a,d,p){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!r||!a)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(mt(Ie,ri,"f",ni)==null&&Ie.checkWebGLSupport(),(p==null?void 0:p.bUseWebGL)&&!mt(Ie,ri,"f",ni))throw new Error("Your browser or machine may not support WebGL.");if(d.sx>r||d.sy>a||d.sx+d.sWidth>r||d.sy+d.sHeight>a)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let _;Ie._onLog&&(_=Date.now(),Ie._onLog("getImageData(), START: "+_));const E=Math.round(d.sx),C=Math.round(d.sy),b=Math.round(d.sWidth),O=Math.round(d.sHeight),M=Math.round(d.dWidth),k=Math.round(d.dHeight);let V=Fe.RGBA;p!=null&&p.pixelFormat&&(V=p.pixelFormat);let H,z,Z,$=null;if(p!=null&&p.bufferContainer&&($=p.bufferContainer),mt(Ie,ri,"f",ni)&&(this.useWebGLByDefault&&(p==null?void 0:p.bUseWebGL)==null||(p==null?void 0:p.bUseWebGL))){Ie._onLog&&Ie._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),H=this._reusedWebGLCvs;try{if($)if(V===Fe.GREY){if(Z=new Uint8Array(4*M*k),z=this.drawImage(H,e,r,a,{sx:E,sy:C,sWidth:b,sHeight:O,dWidth:M,dHeight:k},{pixelFormat:V,bUseWebGL:!0,bufferContainer:Z}),Z=this.transformPixelFormat(Z,z.pixelFormat,V),$){if($.length<Z.length)throw new Error("Unexpected size of the 'bufferContainer'.");$.set(Z)}}else z=this.drawImage(H,e,r,a,{sx:E,sy:C,sWidth:b,sHeight:O,dWidth:M,dHeight:k},{pixelFormat:V,bUseWebGL:!0,bufferContainer:$}),Z=new Uint8Array($.buffer,0,4*M*k),Z=this.transformPixelFormat(Z,z.pixelFormat,V);else V===Fe.GREY?((!mt(this,_r,"f")||mt(this,_r,"f").length<4*M*k)&&Bt(this,_r,new Uint8Array(4*M*k),"f"),Z=new Uint8Array(mt(this,_r,"f").buffer,0,4*M*k)):Z=new Uint8Array(4*M*k),z=this.drawImage(H,e,r,a,{sx:E,sy:C,sWidth:b,sHeight:O,dWidth:M,dHeight:k},{pixelFormat:V,bUseWebGL:!0,bufferContainer:Z}),Z=this.transformPixelFormat(Z,z.pixelFormat,V)}catch(J){if(J.name==="WebGLError"&&(this.forceLoseContext(),(p==null?void 0:p.bUseWebGL)==null))return Ie._onLog&&Ie._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(e,r,a,{sx:E,sy:C,sWidth:b,sHeight:O,dWidth:M,dHeight:k},Object.assign({},p,{bUseWebGL:!1}));throw J}}else if(Ie._onLog&&Ie._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),H=this._reusedCvs,z=this.drawImage(H,e,r,a,{sx:E,sy:C,sWidth:b,sHeight:O,dWidth:M,dHeight:k},{pixelFormat:Fe.RGBA,bUseWebGL:!1}),Z=this.readCvsData(z.context,{width:M,height:k},null),Z=this.transformPixelFormat(Z,z.pixelFormat,V),$){if($.length<Z.length)throw new Error("Unexpected size of the 'bufferContainer'.");$.set(Z)}return Ie._onLog&&Ie._onLog("getImageData() end. Costs: "+(Date.now()-_)),{data:Z,pixelFormat:V,width:M,height:k,bUseWebGL:z.bUseWebGL}}convertDataToCvs(e,r,a,d){if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if(typeof r!="number"||r<=0)throw new Error("Invalid 'width'.");if(typeof a!="number"||a<=0)throw new Error("Invalid 'height'.");const p=document.createElement("canvas");let _;if(p.width=r,p.height=a,d===Fe.GREY){_=new Uint8ClampedArray(4*r*a);for(let C=0;C<_.length;C+=4)_[C]=e[C/4],_[C+1]=e[C/4],_[C+2]=e[C/4],_[C+3]=255}else _=new Uint8ClampedArray(e.buffer);const E=new ImageData(_,r,a);return p.getContext("2d").putImageData(E,0,0),p}forceLoseContext(){if(!this._reusedWebGLCvs)return;const e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),Bt(this,mr,null,"f"),Bt(this,on,null,"f"),Bt(this,an,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Bt(this,as,!0,"f")}}ri=Ie,os=new WeakMap,mr=new WeakMap,on=new WeakMap,an=new WeakMap,_r=new WeakMap,as=new WeakMap,ni={value:void 0};var Yi,ls,ho,_e,Ae,Be,hs,cs,Xe,Nt,li,vr,us,$t,fi,Rt,yr,Er,ln,ds,Cr,Xi,hi,ci,Vo,nt,Go,zi,gc,fs,gs,Bl,Ut,co,uo,Tr,hn,Rs,xt,hr,Wo,Ho,pc;class Ef{constructor(){Yi.set(this,new Map),ls.set(this,!1)}get disposed(){return j(this,ls,"f")}on(e,r){e=e.toLowerCase();const a=j(this,Yi,"f").get(e);if(a){if(a.includes(r))return;a.push(r)}else j(this,Yi,"f").set(e,[r])}off(e,r){e=e.toLowerCase();const a=j(this,Yi,"f").get(e);if(!a)return;const d=a.indexOf(r);d!==-1&&a.splice(d,1)}offAll(e){e=e.toLowerCase();const r=j(this,Yi,"f").get(e);r&&(r.length=0)}async fire(e,r=[],a={async:!1,copy:!0}){r||(r=[]),e=e.toLowerCase();const d=j(this,Yi,"f").get(e);if(d&&d.length){a=Object.assign({async:!1,copy:!0},a);for(let p of d){if(!p)continue;let _=[];if(a.copy)for(let C of r){try{C=JSON.parse(JSON.stringify(C))}catch{}_.push(C)}else _=r;let E=!1;if(a.async)setTimeout(()=>{this.disposed||p.apply(a.target,_)},0);else try{E=p.apply(a.target,_)}catch{}if(E===!0)break}}}dispose(){Pe(this,ls,!0,"f")}}Yi=new WeakMap,ls=new WeakMap;const Ct=(t,e,r,a)=>{if(!r)return t;let d=e+Math.round((t-e)/r)*r;return a&&(d=Math.min(d,a)),d};class Te{static get version(){return"2.0.7"}static isStorageAvailable(e){let r;try{r=window[e];const a="__storage_test__";return r.setItem(a,a),r.removeItem(a),!0}catch(a){return a instanceof DOMException&&(a.code===22||a.code===1014||a.name==="QuotaExceededError"||a.name==="NS_ERROR_DOM_QUOTA_REACHED")&&r&&r.length!==0}}static findBestRearCameraInIOS(e,r){if(!e||!e.length)return null;let a=!1;if(r!=null&&r.getMainCamera&&(a=!0),a){const d=["후면 카메라","背面カメラ","後置鏡頭","后置相机","กล้องด้านหลัง","बैक कैमरा","الكاميرا الخلفية","מצלמה אחורית","камера на задней панели","задня камера","задна камера","артқы камера","πίσω κάμερα","zadní fotoaparát","zadná kamera","tylny aparat","takakamera","stražnja kamera","rückkamera","kamera på baksidan","kamera belakang","kamera bak","hátsó kamera","fotocamera (posteriore)","câmera traseira","câmara traseira","cámara trasera","càmera posterior","caméra arrière","cameră spate","camera mặt sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],p=e.find(_=>d.includes(_.label.toLowerCase()));return p==null?void 0:p.deviceId}{const d=["후면","背面","後置","后置","านหลัง","बैक","خلفية","אחורית","задняя","задней","задна","πίσω","zadní","zadná","tylny","trasera","traseira","taka","stražnja","spate","sau","rück","posteriore","posterior","hátsó","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"],p=["트리플","三镜头","三鏡頭","トリプル","สาม","ट्रिपल","ثلاثية","משולשת","үштік","тройная","тройна","потроєна","τριπλή","üçlü","trójobiektywowy","trostruka","trojný","trojitá","trippelt","trippel","triplă","triple","tripla","tiga","kolmois","ba camera"],_=["듀얼 와이드","雙廣角","双广角","デュアル広角","คู่ด้านหลังมุมกว้าง","ड्युअल वाइड","مزدوجة عريضة","כפולה רחבה","қос кең бұрышты","здвоєна ширококутна","двойная широкоугольная","двойна широкоъгълна","διπλή ευρεία","çift geniş","laajakulmainen kaksois","kép rộng mặt sau","kettős, széles látószögű","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka široka","duální širokoúhlý","duálna širokouhlá","dupla grande-angular","dublă","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],E=e.filter(O=>{const M=O.label.toLowerCase();return d.some(k=>M.includes(k))});if(!E.length)return null;const C=E.find(O=>{const M=O.label.toLowerCase();return p.some(k=>M.includes(k))});if(C)return C.deviceId;const b=E.find(O=>{const M=O.label.toLowerCase();return _.some(k=>M.includes(k))});return b?b.deviceId:E[0].deviceId}}static findBestRearCamera(e,r){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(ft.OS))return Te.findBestRearCameraInIOS(e,{getMainCamera:r==null?void 0:r.getMainCameraInIOS});const a=["후","背面","背置","後面","後置","后面","后置","านหลัง","หลัง","बैक","خلفية","אחורית","задняя","задня","задней","задна","πίσω","zadní","zadná","tylny","trás","trasera","traseira","taka","stražnja","spate","sau","rück","rear","posteriore","posterior","hátsó","darrere","belakang","baksidan","bakre","bak","bagside","back","aртқы","arrière","arka","achterzijde"];for(let d of e){const p=d.label.toLowerCase();if(p&&a.some(_=>p.includes(_))&&/\b0(\b)?/.test(p))return d.deviceId}return["Android","HarmonyOS"].includes(ft.OS)?e[e.length-1].deviceId:null}static findBestCamera(e,r,a){return e&&e.length?r==="environment"?this.findBestRearCamera(e,a):r==="user"?null:r?void 0:null:null}static async playVideo(e,r,a){if(!e)throw new Error("Invalid 'videoEl'.");if(!r)throw new Error("Invalid 'source'.");return new Promise(async(d,p)=>{let _;const E=()=>{e.removeEventListener("loadstart",M),e.removeEventListener("abort",k),e.removeEventListener("play",V),e.removeEventListener("error",H),e.removeEventListener("loadedmetadata",$)};let C=!1;const b=()=>{C=!0,_&&clearTimeout(_),E(),d(e)},O=J=>{_&&clearTimeout(_),E(),p(J)},M=()=>{e.addEventListener("abort",k,{once:!0})},k=()=>{const J=new Error("Video playing was interrupted.");J.name="AbortError",O(J)},V=()=>{b()},H=()=>{O(new Error(`Video error ${e.error.code}: ${e.error.message}.`))};let z;const Z=new Promise(J=>{z=J}),$=()=>{z()};if(e.addEventListener("loadstart",M,{once:!0}),e.addEventListener("play",V,{once:!0}),e.addEventListener("error",H,{once:!0}),e.addEventListener("loadedmetadata",$,{once:!0}),typeof r=="string"||r instanceof String?e.src=r:e.srcObject=r,e.autoplay&&await new Promise(J=>{setTimeout(J,1e3)}),!C){a&&(_=setTimeout(()=>{E(),p(new Error("Failed to play video. Timeout."))},a));try{e.src&&await e.load(),await e.play(),b()}catch(J){console.warn("1st play error: "+((J==null?void 0:J.message)||J))}if(!C){await Z;try{await e.play(),b()}catch(J){console.warn("2rd play error: "+((J==null?void 0:J.message)||J)),O(J)}}}})}static async testCameraAccess(e){var r,a;if(!(!((a=(r=window==null?void 0:window.navigator)===null||r===void 0?void 0:r.mediaDevices)===null||a===void 0)&&a.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let d;try{d=e?await navigator.mediaDevices.getUserMedia(e):await navigator.mediaDevices.getUserMedia({video:!0})}catch(p){return{ok:!1,errorName:p.name,errorMessage:p.message}}finally{d==null||d.getTracks().forEach(p=>{p.stop()})}return{ok:!0}}get state(){if(!j(this,Rt,"f"))return"closed";if(j(this,Rt,"f")==="pending")return"opening";if(j(this,Rt,"f")==="fulfilled")return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(e){e?Te.isStorageAvailable("localStorage")?Pe(this,vr,!0,"f"):(Pe(this,vr,!1,"f"),console.warn("Local storage is unavailable")):Pe(this,vr,!1,"f")}get ifSaveLastUsedCamera(){return j(this,vr,"f")}get isVideoPlaying(){return!(!j(this,Ae,"f")||j(this,Ae,"f").paused)&&this.state==="opened"}set tapFocusEventBoundEl(e){var r,a,d;if(!(e instanceof HTMLElement)&&e!=null)throw new TypeError("Invalid 'element'.");(r=j(this,Xi,"f"))===null||r===void 0||r.removeEventListener("click",j(this,Cr,"f")),(a=j(this,Xi,"f"))===null||a===void 0||a.removeEventListener("touchend",j(this,Cr,"f")),(d=j(this,Xi,"f"))===null||d===void 0||d.removeEventListener("touchmove",j(this,ds,"f")),Pe(this,Xi,e,"f"),e&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(ft.OS)?(e.addEventListener("touchend",j(this,Cr,"f")),e.addEventListener("touchmove",j(this,ds,"f"))):e.addEventListener("click",j(this,Cr,"f")))}get tapFocusEventBoundEl(){return j(this,Xi,"f")}get disposed(){return j(this,gs,"f")}constructor(e){var r,a;_e.add(this),Ae.set(this,null),Be.set(this,void 0),hs.set(this,()=>{this.state==="opened"&&j(this,nt,"f").fire("resumed",null,{target:this,async:!0})}),cs.set(this,()=>{j(this,nt,"f").fire("paused",null,{target:this,async:!1})}),Xe.set(this,void 0),Nt.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],li.set(this,void 0),vr.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,us.set(this,void 0),$t.set(this,!0),fi.set(this,void 0),Rt.set(this,void 0),yr.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},Er.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(d,p)=>{let _,E;const C=window.getComputedStyle(j(this,Ae,"f")).objectFit,b=this.getResolution(),O=j(this,Ae,"f").getBoundingClientRect(),M=O.left,k=O.top,{width:V,height:H}=j(this,Ae,"f").getBoundingClientRect();if(V<=0||H<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const z=V/H,Z=b.width/b.height;let $=1;if(C==="contain")Z>z?($=V/b.width,_=(d-M)/$,E=(p-k-(H-V/Z)/2)/$):($=H/b.height,E=(p-k)/$,_=(d-M-(V-H*Z)/2)/$);else{if(C!=="cover")throw new Error("Unsupported object-fit.");Z>z?($=H/b.height,E=(p-k)/$,_=(d-M+(H*Z-V)/2)/$):($=V/b.width,_=(d-M)/$,E=(p-k+(V/Z-H)/2)/$)}return{x:_,y:E}},ln.set(this,!1),ds.set(this,()=>{Pe(this,ln,!0,"f")}),Cr.set(this,async d=>{var p;if(j(this,ln,"f"))return void Pe(this,ln,!1,"f");if(!j(this,Er,"f")||!this.isVideoPlaying||!j(this,Be,"f")||!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(p=this.getCameraCapabilities())===null||p===void 0?void 0:p.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let _,E;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),d instanceof MouseEvent)_=d.clientX,E=d.clientY;else{if(!(d instanceof TouchEvent))throw new Error("Unknown event type.");if(!d.changedTouches.length)return;_=d.changedTouches[0].clientX,E=d.changedTouches[0].clientY}const C=this.getResolution(),b=2*Math.round(Math.min(C.width,C.height)/this._focusParameters.defaultFocusAreaSizeRatio/2);let O;try{O=this.calculateCoordInVideo(_,E)}catch{}if(O.x<0||O.x>C.width||O.y<0||O.y>C.height)return;const M={x:O.x+"px",y:O.y+"px"},k=b+"px",V=k;let H;Te._onLog&&(H=Date.now());try{await j(this,_e,"m",Wo).call(this,M,k,V,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(z){if(Te._onLog)throw Te._onLog(z),z}Te._onLog&&Te._onLog(`Tap focus costs: ${Date.now()-H} ms`),this._focusParameters.taskBackToContinous=setTimeout(()=>{var z;Te._onLog&&Te._onLog("Back to continuous focus."),(z=j(this,Be,"f"))===null||z===void 0||z.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime),j(this,nt,"f").fire("tapfocus",null,{target:this,async:!0})}),Xi.set(this,null),hi.set(this,1),ci.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!j(this,Ae,"f"))return;const d=j(this,hi,"f");if(d<1)throw new RangeError("Invalid scale value.");if(d===1)j(this,Ae,"f").style.transform="";else{const p=window.getComputedStyle(j(this,Ae,"f")).objectFit,_=j(this,Ae,"f").videoWidth,E=j(this,Ae,"f").videoHeight,{width:C,height:b}=j(this,Ae,"f").getBoundingClientRect();if(C<=0||b<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");const O=C/b,M=_/E;let k=1;p==="contain"?k=O<M?C/(_/d):b/(E/d):p==="cover"&&(k=M>O?b/(_/d):C/(E/d));const V=k*(1-1/d)*(_/2-j(this,ci,"f").x),H=k*(1-1/d)*(E/2-j(this,ci,"f").y);j(this,Ae,"f").style.transform=`translate(${V}px, ${H}px) scale(${d})`}},Vo.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");const d=document.createElement("canvas");let p;if(d.width=this.width,d.height=this.height,this.pixelFormat===Fe.GREY){p=new Uint8ClampedArray(this.width*this.height*4);for(let E=0;E<p.length;E+=4)p[E]=this.data[E/4],p[E+1]=this.data[E/4],p[E+2]=this.data[E/4],p[E+3]=255}else p=new Uint8ClampedArray(this.data.buffer);const _=new ImageData(p,this.width,this.height);return d.getContext("2d").putImageData(_,0,0),d}),nt.set(this,void 0),Go.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],zi.set(this,new Map),gc.set(this,!1),fs.set(this,async()=>{var d,p;if(document.visibilityState==="visible"){if(Te._onLog&&Te._onLog("document visible. video paused: "+((d=j(this,Ae,"f"))===null||d===void 0?void 0:d.paused)),this.state=="opening"||this.state=="opened"){let _=!1;if(!this.isVideoPlaying){Te._onLog&&Te._onLog("document visible. Not auto resume. 1st resume start.");try{await this.resume(),_=!0}catch{Te._onLog&&Te._onLog("document visible. 1st resume video failed, try open instead.")}_||await j(this,_e,"m",Tr).call(this)}if(await new Promise(E=>setTimeout(E,300)),!this.isVideoPlaying){Te._onLog&&Te._onLog("document visible. 1st open failed. 2rd resume start."),_=!1;try{await this.resume(),_=!0}catch{Te._onLog&&Te._onLog("document visible. 2rd resume video failed, try open instead.")}_||await j(this,_e,"m",Tr).call(this)}}}else document.visibilityState==="hidden"&&(Te._onLog&&Te._onLog("document hidden. video paused: "+((p=j(this,Ae,"f"))===null||p===void 0?void 0:p.paused)),this.state=="opening"||this.state=="opened"&&this.isVideoPlaying&&this.pause())}),gs.set(this,!1),!((a=(r=window==null?void 0:window.navigator)===null||r===void 0?void 0:r.mediaDevices)===null||a===void 0)&&a.getUserMedia||setTimeout(()=>{Te.onWarning&&Te.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),e instanceof HTMLVideoElement&&this.setVideoEl(e),Pe(this,nt,new Ef,"f"),this.imageDataGetter=new Ie,document.addEventListener("visibilitychange",j(this,fs,"f"))}setVideoEl(e){if(!(e&&e instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");e.addEventListener("play",j(this,hs,"f")),e.addEventListener("pause",j(this,cs,"f")),Pe(this,Ae,e,"f")}getVideoEl(){return j(this,Ae,"f")}releaseVideoEl(){var e,r;(e=j(this,Ae,"f"))===null||e===void 0||e.removeEventListener("play",j(this,hs,"f")),(r=j(this,Ae,"f"))===null||r===void 0||r.removeEventListener("pause",j(this,cs,"f")),Pe(this,Ae,null,"f")}isVideoLoaded(){return!!j(this,Ae,"f")&&j(this,Ae,"f").readyState==4}async open(){if(j(this,fi,"f")&&!j(this,$t,"f")){if(j(this,Rt,"f")==="pending")return j(this,fi,"f");if(j(this,Rt,"f")==="fulfilled")return}j(this,nt,"f").fire("before:open",null,{target:this}),await j(this,_e,"m",Tr).call(this),j(this,nt,"f").fire("played",null,{target:this,async:!0}),j(this,nt,"f").fire("opened",null,{target:this,async:!0})}async close(){if(this.state==="closed")return;j(this,nt,"f").fire("before:close",null,{target:this});const e=j(this,fi,"f");if(j(this,_e,"m",Rs).call(this),e&&j(this,Rt,"f")==="pending"){try{await e}catch{}if(j(this,$t,"f")===!1){const r=new Error("'close()' was interrupted.");throw r.name="AbortError",r}}Pe(this,fi,null,"f"),Pe(this,Rt,null,"f"),j(this,nt,"f").fire("closed",null,{target:this,async:!0})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");j(this,Ae,"f").pause()}async resume(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");await j(this,Ae,"f").play()}async setCamera(e){if(typeof e!="string")throw new TypeError("Invalid 'deviceId'.");if(typeof j(this,Xe,"f").video!="object"&&(j(this,Xe,"f").video={}),delete j(this,Xe,"f").video.facingMode,j(this,Xe,"f").video.deviceId={exact:e},!(this.state==="closed"||this.videoSrc||this.state==="opening"&&j(this,$t,"f"))){j(this,nt,"f").fire("before:camera:change",[],{target:this,async:!1}),await j(this,_e,"m",hn).call(this);try{this.resetSoftwareScale()}catch{}return j(this,Nt,"f")}}async switchToFrontCamera(e){if(typeof j(this,Xe,"f").video!="object"&&(j(this,Xe,"f").video={}),e!=null&&e.resolution&&(j(this,Xe,"f").video.width={ideal:e.resolution.width},j(this,Xe,"f").video.height={ideal:e.resolution.height}),delete j(this,Xe,"f").video.deviceId,j(this,Xe,"f").video.facingMode={exact:"user"},Pe(this,li,null,"f"),!(this.state==="closed"||this.videoSrc||this.state==="opening"&&j(this,$t,"f"))){j(this,nt,"f").fire("before:camera:change",[],{target:this,async:!1}),j(this,_e,"m",hn).call(this);try{this.resetSoftwareScale()}catch{}return j(this,Nt,"f")}}getCamera(){var e;if(j(this,Nt,"f"))return j(this,Nt,"f");{let r=((e=j(this,Xe,"f").video)===null||e===void 0?void 0:e.deviceId)||"";if(r){r=r.exact||r.ideal||r;for(let a of this._arrCameras)if(a.deviceId===r)return JSON.parse(JSON.stringify(a))}return{deviceId:"",label:"",_checked:!1}}}async _getCameras(e){var r,a;if(!(!((a=(r=window==null?void 0:window.navigator)===null||r===void 0?void 0:r.mediaDevices)===null||a===void 0)&&a.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let d;if(e){let E=await navigator.mediaDevices.getUserMedia({video:!0});d=(await navigator.mediaDevices.enumerateDevices()).filter(C=>C.kind==="videoinput"),E.getTracks().forEach(C=>{C.stop()})}else d=(await navigator.mediaDevices.enumerateDevices()).filter(E=>E.kind==="videoinput");const p=[],_=[];if(this._arrCameras)for(let E of this._arrCameras)E._checked&&_.push(E);for(let E=0;E<d.length;E++){let C,b=d[E];for(let O of _)if(b.deviceId==O.deviceId){C=O;break}C||(C={deviceId:b.deviceId,label:b.label?b.label:"camera "+E,_checked:!1}),C.deviceId&&p.push(C)}return this._arrCameras=p,Te._onLog&&Te._onLog(JSON.stringify(this._arrCameras)),p}async getCameras(){var e,r;if(!(!((r=(e=window==null?void 0:window.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||r===void 0)&&r.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");const a=(await navigator.mediaDevices.enumerateDevices()).filter(d=>d.kind==="videoinput");return a&&a.length&&!a[0].deviceId?this._getCameras(!0):this._getCameras(!1)}async getAllCameras(){return this.getCameras()}async setResolution(e,r,a){if(typeof e!="number"||e<=0)throw new TypeError("Invalid 'width'.");if(typeof r!="number"||r<=0)throw new TypeError("Invalid 'height'.");if(typeof j(this,Xe,"f").video!="object"&&(j(this,Xe,"f").video={}),a?(j(this,Xe,"f").video.width={exact:e},j(this,Xe,"f").video.height={exact:r}):(j(this,Xe,"f").video.width={ideal:e},j(this,Xe,"f").video.height={ideal:r}),this.state==="closed"||this.videoSrc||this.state==="opening"&&j(this,$t,"f"))return null;j(this,nt,"f").fire("before:resolution:change",[],{target:this,async:!1}),await j(this,_e,"m",hn).call(this);try{this.resetSoftwareScale()}catch{}const d=this.getResolution();return{width:d.width,height:d.height}}getResolution(){if(this.state==="opened"&&this.videoSrc&&j(this,Ae,"f"))return{width:j(this,Ae,"f").videoWidth,height:j(this,Ae,"f").videoHeight};if(j(this,Be,"f")){const e=j(this,Be,"f").getSettings();return{width:e.width,height:e.height}}if(this.isVideoLoaded())return{width:j(this,Ae,"f").videoWidth,height:j(this,Ae,"f").videoHeight};{const e={width:0,height:0};let r=j(this,Xe,"f").video.width||0,a=j(this,Xe,"f").video.height||0;return r&&(e.width=r.exact||r.ideal||r),a&&(e.height=a.exact||a.ideal||a),e}}async getResolutions(e){var r,a,d,p,_,E,C,b,O,M,k;if(!(!((a=(r=window==null?void 0:window.navigator)===null||r===void 0?void 0:r.mediaDevices)===null||a===void 0)&&a.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let V="";const H=(z,Z)=>{const $=j(this,zi,"f").get(z);if(!$||!$.length)return!1;for(let J of $)if(J.width===Z.width&&J.height===Z.height)return!0;return!1};if(this._mediaStream){V=(k=j(this,Nt,"f"))===null||k===void 0?void 0:k.deviceId;let z=j(this,zi,"f").get(V);if(z&&!e)return JSON.parse(JSON.stringify(z));z=[],j(this,zi,"f").set(V,z),Pe(this,yr,!0,"f");try{for(let Z of this.detectedResolutions){await j(this,Be,"f").applyConstraints({width:{ideal:Z.width},height:{ideal:Z.height}}),j(this,_e,"m",Ut).call(this);const $=j(this,Be,"f").getSettings(),J={width:$.width,height:$.height};H(V,J)||z.push({width:J.width,height:J.height})}}catch(Z){throw j(this,_e,"m",Rs).call(this),Pe(this,yr,!1,"f"),Z}try{await j(this,_e,"m",Tr).call(this)}catch(Z){if(Z.name==="AbortError")return z;throw Z}finally{Pe(this,yr,!1,"f")}return z}{const z=async(J,te,he)=>{const ce={video:{deviceId:{exact:J},width:{ideal:te},height:{ideal:he}}};let ue=null;try{ue=await navigator.mediaDevices.getUserMedia(ce)}catch{return null}if(!ue)return null;const be=ue.getVideoTracks();let v=null;try{const pe=be[0].getSettings();v={width:pe.width,height:pe.height}}catch{const Ce=document.createElement("video");Ce.srcObject=ue,v={width:Ce.videoWidth,height:Ce.videoHeight},Ce.srcObject=null}return be.forEach(pe=>{pe.stop()}),v};let Z=((_=(p=(d=j(this,Xe,"f"))===null||d===void 0?void 0:d.video)===null||p===void 0?void 0:p.deviceId)===null||_===void 0?void 0:_.exact)||((b=(C=(E=j(this,Xe,"f"))===null||E===void 0?void 0:E.video)===null||C===void 0?void 0:C.deviceId)===null||b===void 0?void 0:b.ideal)||((M=(O=j(this,Xe,"f"))===null||O===void 0?void 0:O.video)===null||M===void 0?void 0:M.deviceId);if(!Z)return[];let $=j(this,zi,"f").get(Z);if($&&!e)return JSON.parse(JSON.stringify($));$=[],j(this,zi,"f").set(Z,$);for(let J of this.detectedResolutions){const te=await z(Z,J.width,J.height);te&&!H(Z,te)&&$.push({width:te.width,height:te.height})}return $}}async setMediaStreamConstraints(e,r){if(!(a=>{return a!==null&&(d=a,Object.prototype.toString.call(d)==="[object Object]");var d})(e))throw new TypeError("Invalid 'mediaStreamConstraints'.");Pe(this,Xe,JSON.parse(JSON.stringify(e)),"f"),Pe(this,li,null,"f"),r&&j(this,_e,"m",hn).call(this)}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(j(this,Xe,"f")))}resetMediaStreamConstraints(){Pe(this,Xe,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!j(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");return j(this,Be,"f").getCapabilities?j(this,Be,"f").getCapabilities():{}}getCameraSettings(){if(!j(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");return j(this,Be,"f").getSettings()}async turnOnTorch(){if(!j(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(e!=null&&e.torch))throw Error("Not supported.");await j(this,Be,"f").applyConstraints({advanced:[{torch:!0}]})}async turnOffTorch(){if(!j(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const e=this.getCameraCapabilities();if(!(e!=null&&e.torch))throw Error("Not supported.");await j(this,Be,"f").applyConstraints({advanced:[{torch:!1}]})}async setColorTemperature(e,r){var a;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!j(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const d=(a=this.getCameraCapabilities())===null||a===void 0?void 0:a.colorTemperature;if(!d)throw Error("Not supported.");return r&&(e<d.min?e=d.min:e>d.max&&(e=d.max),e=Ct(e,d.min,d.step,d.max)),await j(this,Be,"f").applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]}),e}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}async setExposureCompensation(e,r){var a;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!j(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const d=(a=this.getCameraCapabilities())===null||a===void 0?void 0:a.exposureCompensation;if(!d)throw Error("Not supported.");return r&&(e<d.min?e=d.min:e>d.max&&(e=d.max),e=Ct(e,d.min,d.step,d.max)),await j(this,Be,"f").applyConstraints({advanced:[{exposureCompensation:e}]}),e}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}async setFrameRate(e,r){var a;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!j(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");let d=(a=this.getCameraCapabilities())===null||a===void 0?void 0:a.frameRate;if(!d)throw Error("Not supported.");r&&(e<d.min?e=d.min:e>d.max&&(e=d.max));const p=this.getResolution();return await j(this,Be,"f").applyConstraints({width:{ideal:Math.max(p.width,p.height)},frameRate:e}),e}getFrameRate(){return this.getCameraSettings().frameRate}async setFocus(e,r){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(!j(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const a=this.getCameraCapabilities(),d=a==null?void 0:a.focusMode,p=a==null?void 0:a.focusDistance;if(!d)throw Error("Not supported.");if(typeof e.mode!="string")throw TypeError("Invalid 'mode'.");const _=e.mode.toLowerCase();if(!d.includes(_))throw Error("Unsupported focus mode.");if(_==="manual"){if(!p)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let E=e.distance;r&&(E<p.min?E=p.min:E>p.max&&(E=p.max),E=Ct(E,p.min,p.step,p.max)),this._focusParameters.focusArea=null,await j(this,Be,"f").applyConstraints({advanced:[{focusMode:_,focusDistance:E}]})}else{if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{const E=e.area.centerPoint;let C=e.area.width,b=e.area.height;if(!C||!b){const O=this.getResolution();C||(C=2*Math.round(Math.min(O.width,O.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),b||(b=2*Math.round(Math.min(O.width,O.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:E.x,y:E.y},width:C,height:b},await j(this,_e,"m",Wo).call(this,E,C,b)}}}else this._focusParameters.focusArea=null,await j(this,Be,"f").applyConstraints({advanced:[{focusMode:_}]})}getFocus(){const e=this.getCameraSettings(),r=e.focusMode;return r?r==="manual"?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:r}:null}async enableTapToFocus(){Pe(this,Er,!0,"f")}disableTapToFocus(){Pe(this,Er,!1,"f")}isTapToFocusEnabled(){return j(this,Er,"f")}async setZoom(e){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid 'factor'.");if(this.state!=="opened")throw new Error("Video is not playing.");e.centerPoint?j(this,_e,"m",Ho).call(this,e.centerPoint):this.resetScaleCenter();try{if(j(this,_e,"m",pc).call(this,j(this,ci,"f"))){const r=await this.setHardwareScale(e.factor,!0);let a=this.getHardwareScale();a==1&&r!=1&&(a=r),e.factor>a?this.setSoftwareScale(e.factor/a):this.setSoftwareScale(1)}else await this.setHardwareScale(1),this.setSoftwareScale(e.factor)}catch(r){const a=r.message||r;if(a!=="Not supported."&&a!=="Camera is not open.")throw r;this.setSoftwareScale(e.factor)}}getZoom(){if(this.state!=="opened")throw new Error("Video is not playing.");let e=1;try{e=this.getHardwareScale()}catch(r){if((r.message||r)!=="Camera is not open.")throw r}return{factor:e*j(this,hi,"f")}}async resetZoom(){await this.setZoom({factor:1})}async setHardwareScale(e,r){var a;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(!j(this,Be,"f")||this.state!=="opened")throw new Error("Camera is not open.");const d=(a=this.getCameraCapabilities())===null||a===void 0?void 0:a.zoom;if(!d)throw Error("Not supported.");return r&&(e<d.min?e=d.min:e>d.max&&(e=d.max),e=Ct(e,d.min,d.step,d.max)),await j(this,Be,"f").applyConstraints({advanced:[{zoom:e}]}),e}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(e,r){if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(this.state!=="opened")throw new Error("Video is not playing.");r&&j(this,_e,"m",Ho).call(this,r),Pe(this,hi,e,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return j(this,hi,"f")}resetScaleCenter(){if(this.state!=="opened")throw new Error("Video is not playing.");const e=this.getResolution();Pe(this,ci,{x:e.width/2,y:e.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(e){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||j(this,yr,"f"))return null;const r=Date.now();Te._onLog&&Te._onLog("getFrameData() START: "+r);const a=j(this,Ae,"f").videoWidth,d=j(this,Ae,"f").videoHeight;let p={sx:0,sy:0,sWidth:a,sHeight:d,dWidth:a,dHeight:d};e!=null&&e.position&&(p=JSON.parse(JSON.stringify(e.position)));let _=Fe.RGBA;e!=null&&e.pixelFormat&&(_=e.pixelFormat);let E=j(this,hi,"f");e!=null&&e.scale&&(E=e.scale);let C=j(this,ci,"f");if(e!=null&&e.scaleCenter){if(typeof e.scaleCenter.x!="string"||typeof e.scaleCenter.y!="string")throw new Error("Invalid scale center.");let k=0,V=0;if(e.scaleCenter.x.endsWith("px"))k=parseFloat(e.scaleCenter.x);else{if(!e.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");k=parseFloat(e.scaleCenter.x)/100*a}if(e.scaleCenter.y.endsWith("px"))V=parseFloat(e.scaleCenter.y);else{if(!e.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");V=parseFloat(e.scaleCenter.y)/100*d}if(isNaN(k)||isNaN(V))throw new Error("Invalid scale center.");C.x=Math.round(k),C.y=Math.round(V)}let b=null;if(e!=null&&e.bufferContainer&&(b=e.bufferContainer),a==0||d==0)return null;E!==1&&(p.sWidth=Math.round(p.sWidth/E),p.sHeight=Math.round(p.sHeight/E),p.sx=Math.round((1-1/E)*C.x+p.sx/E),p.sy=Math.round((1-1/E)*C.y+p.sy/E));const O=this.imageDataGetter.getImageData(j(this,Ae,"f"),a,d,p,{pixelFormat:_,bufferContainer:b});if(!O)return null;const M=Date.now();return Te._onLog&&Te._onLog("getFrameData() END: "+M),{data:O.data,width:O.width,height:O.height,pixelFormat:O.pixelFormat,timeSpent:M-r,timeStamp:M,toCanvas:j(this,Vo,"f")}}on(e,r){if(!j(this,Go,"f").includes(e.toLowerCase()))throw new Error(`Event '${e}' does not exist.`);j(this,nt,"f").on(e,r)}off(e,r){j(this,nt,"f").off(e,r)}async dispose(){this.tapFocusEventBoundEl=null,await this.close(),this.releaseVideoEl(),j(this,nt,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",j(this,fs,"f")),Pe(this,gs,!0,"f")}}var En,Ds,Ir,Qi,Ls,wr,jl,mc,Me,Yo,Xo,me,ye,cn,si,Ki,ps,ms,_s,Cn,$i,vs,oi,Dt,qe,ve,Yt,zo,ze,_c,vc,Ko,$o;Ae=new WeakMap,Be=new WeakMap,hs=new WeakMap,cs=new WeakMap,Xe=new WeakMap,Nt=new WeakMap,li=new WeakMap,vr=new WeakMap,us=new WeakMap,$t=new WeakMap,fi=new WeakMap,Rt=new WeakMap,yr=new WeakMap,Er=new WeakMap,ln=new WeakMap,ds=new WeakMap,Cr=new WeakMap,Xi=new WeakMap,hi=new WeakMap,ci=new WeakMap,Vo=new WeakMap,nt=new WeakMap,Go=new WeakMap,zi=new WeakMap,gc=new WeakMap,fs=new WeakMap,gs=new WeakMap,_e=new WeakSet,Bl=async function(){const t=this.getMediaStreamConstraints();if(typeof t.video=="boolean"&&(t.video={}),!t.video.deviceId){if(j(this,li,"f"))delete t.video.facingMode,t.video.deviceId={exact:j(this,li,"f")};else if(this.ifSaveLastUsedCamera&&Te.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete t.video.facingMode,t.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};const e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),r=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&r&&(t.video.width=e,t.video.height=r)}else if(!this.ifSkipCameraInspection){const e=async d=>{let p=null;return d==="environment"&&["Android","HarmonyOS","iPhone","iPad"].includes(ft.OS)?(await this._getCameras(!1),j(this,_e,"m",Ut).call(this),p=Te.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):d||["Android","HarmonyOS","iPhone","iPad"].includes(ft.OS)||(await this._getCameras(!1),j(this,_e,"m",Ut).call(this),p=Te.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),p};let r=t.video.facingMode;r instanceof Array&&r.length&&(r=r[0]),typeof r=="object"&&(r=r.exact||r.ideal);const a=await e(r);a&&(delete t.video.facingMode,t.video.deviceId={exact:a})}}return t},Ut=function(){if(j(this,$t,"f")){const t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},co=async function(t){var e,r;if(!(!((r=(e=window==null?void 0:window.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||r===void 0)&&r.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let a;try{Te._onLog&&Te._onLog("======try getUserMedia========");let d=[0,500,1e3,2e3],p=null;const _=async E=>{for(let C of d){C&&(await new Promise(b=>setTimeout(b,C)),j(this,_e,"m",Ut).call(this));try{Te._onLog&&Te._onLog("ask "+JSON.stringify(E)),a=await navigator.mediaDevices.getUserMedia(E),j(this,_e,"m",Ut).call(this);break}catch(b){if(b.name==="NotFoundError"||b.name==="NotAllowedError"||b.name==="AbortError"||b.name==="OverconstrainedError")throw b;p=b,Te._onLog&&Te._onLog(b.message||b)}}};if(await _(t),a||typeof t.video!="object"||(t.video.deviceId&&(delete t.video.deviceId,await _(t)),!a&&t.video.facingMode&&(delete t.video.facingMode,await _(t)),a||!t.video.width&&!t.video.height||(delete t.video.width,delete t.video.height,await _(t))),!a)throw p;return a}catch(d){throw a==null||a.getTracks().forEach(p=>{p.stop()}),d.name==="NotFoundError"&&(DOMException?d=new DOMException("No camera available, please use a device with an accessible camera.",d.name):(d=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),d}},uo=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(t=>{t.stop()}),this._mediaStream=null),Pe(this,Be,null,"f")},Tr=async function(){Pe(this,$t,!1,"f");const t=Pe(this,us,Symbol(),"f");if(j(this,fi,"f")&&j(this,Rt,"f")==="pending"){try{await j(this,fi,"f")}catch{}j(this,_e,"m",Ut).call(this)}return t!==j(this,us,"f")?void 0:Pe(this,fi,(async()=>{Pe(this,Rt,"pending","f");try{if(this.videoSrc){if(!j(this,Ae,"f"))throw new Error("'videoEl' should be set.");await Te.playVideo(j(this,Ae,"f"),this.videoSrc,this.cameraOpenTimeout),j(this,_e,"m",Ut).call(this)}else{let r=await j(this,_e,"m",Bl).call(this);j(this,_e,"m",uo).call(this);let a=await j(this,_e,"m",co).call(this,r);await this._getCameras(!1),j(this,_e,"m",Ut).call(this);const d=()=>{const C=a.getVideoTracks();let b,O;if(C.length&&(b=C[0]),b){const M=b.getSettings();if(M){for(let k of this._arrCameras)if(M.deviceId===k.deviceId){k._checked=!0,k.label=b.label,O=k;break}}}return O},p=j(this,Xe,"f");if(typeof p.video=="object"){let C=p.video.facingMode;if(C instanceof Array&&C.length&&(C=C[0]),typeof C=="object"&&(C=C.exact||C.ideal),!(j(this,li,"f")||this.ifSaveLastUsedCamera&&Te.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||p.video.deviceId)){const b=d(),O=Te.findBestCamera(this._arrCameras,C,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});O&&O!=(b==null?void 0:b.deviceId)&&(a.getTracks().forEach(M=>{M.stop()}),r.video.deviceId={exact:O},a=await j(this,_e,"m",co).call(this,r),j(this,_e,"m",Ut).call(this))}}const _=d();_!=null&&_.deviceId&&(Pe(this,li,_&&_.deviceId,"f"),this.ifSaveLastUsedCamera&&Te.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",j(this,li,"f")),typeof r.video=="object"&&r.video.width&&r.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(r.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(r.video.height))))),j(this,Ae,"f")&&(await Te.playVideo(j(this,Ae,"f"),a,this.cameraOpenTimeout),j(this,_e,"m",Ut).call(this)),this._mediaStream=a;const E=a.getVideoTracks();E!=null&&E.length&&Pe(this,Be,E[0],"f"),Pe(this,Nt,_,"f")}}catch(r){throw j(this,_e,"m",Rs).call(this),Pe(this,Rt,null,"f"),r}Pe(this,Rt,"fulfilled","f")})(),"f")},hn=async function(){var t;if(this.state==="closed"||this.videoSrc)return;const e=(t=j(this,Nt,"f"))===null||t===void 0?void 0:t.deviceId,r=this.getResolution();await j(this,_e,"m",Tr).call(this);const a=this.getResolution();e&&e!==j(this,Nt,"f").deviceId&&j(this,nt,"f").fire("camera:changed",[j(this,Nt,"f").deviceId,e],{target:this,async:!0}),r.width==a.width&&r.height==a.height||j(this,nt,"f").fire("resolution:changed",[{width:a.width,height:a.height},{width:r.width,height:r.height}],{target:this,async:!0}),j(this,nt,"f").fire("played",null,{target:this,async:!0})},Rs=function(){j(this,_e,"m",uo).call(this),Pe(this,Nt,null,"f"),j(this,Ae,"f")&&(j(this,Ae,"f").srcObject=null,this.videoSrc&&(j(this,Ae,"f").pause(),j(this,Ae,"f").currentTime=0)),Pe(this,$t,!0,"f");try{this.resetSoftwareScale()}catch{}},xt=async function t(e,r){const a=z=>{if(!j(this,Be,"f")||!this.isVideoPlaying||z.focusTaskId!=this._focusParameters.curFocusTaskId){j(this,Be,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);const Z=new Error(`Focus task ${z.focusTaskId} canceled.`);throw Z.name="DeprecatedTaskError",Z}this._focusParameters.isDoingFocus===1&&Date.now()-z.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)};let d;r=Ct(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),await j(this,Be,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}),a(e),d=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/r),Math.abs(1/this._focusParameters.fds.max-1/r))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/r)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=r,await new Promise(z=>{setTimeout(z,d)}),a(e);let p=e.focusL-e.focusW/2,_=e.focusT-e.focusH/2,E=e.focusW,C=e.focusH;const b=this.getResolution();if(p>=b.width||_>=b.height)throw new Error("Invalid area.");p+E>b.width&&(E=b.width-p),_+C>b.height&&(C=b.height-_),p=Math.round(p),_=Math.round(_),E=Math.round(E),C=Math.round(C);const O=4*b.width*b.height*this._focusParameters.defaultTempBufferContainerLenRatio,M=4*E*C;let k=this._focusParameters.tempBufferContainer;if(k){const z=k.length;O>z&&O>=M?k=new Uint8Array(O):M>z&&M>=O&&(k=new Uint8Array(M))}else k=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(O,M));if(!this.imageDataGetter.getImageData(j(this,Ae,"f"),b.width,b.height,{sx:p,sy:_,sWidth:E,sHeight:C,dWidth:E,dHeight:C},{pixelFormat:Fe.RGBA,bufferContainer:k}))return j(this,_e,"m",t).call(this,e,r);const V=k;let H=0;for(let z=0,Z=M-8;z<Z;++z){let $=V[z]-V[z+8];++z;let J=V[z]-V[z+8];++z;let te=V[z]-V[z+8];++z,H+=$*$+J*J+te*te}return-H},hr=async function t(e,r,a,d,p,_,E){let C;if(r=Ct(r,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),d=Ct(d,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),_?_=Ct(_,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(_=Ct(Math.sqrt((r||this._focusParameters.fds.step)*(d||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),E=await j(this,_e,"m",xt).call(this,e,_)),E<=a&&E<=p?C=3:a<p&&a<E?C=1:p<a&&p<E&&(C=2),(d-r)/2<=this._focusParameters.fds.step)return C===3||(C===1?await j(this,Be,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:r}]}):C===2&&await j(this,Be,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:d}]})),!0;if(C===1)return await j(this,_e,"m",t).call(this,e,r,a,_,E);if(C===2)return await j(this,_e,"m",t).call(this,e,_,E,d,p);if(C!==3)return a=await j(this,_e,"m",xt).call(this,e,r),p=await j(this,_e,"m",xt).call(this,e,d),await j(this,_e,"m",t).call(this,e,r,a,d,p);let b=Ct(Math.sqrt((r||this._focusParameters.fds.step)*(_||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),O=Ct(Math.sqrt((d||this._focusParameters.fds.step)*(_||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/b)<=Math.abs(1/this._focusParameters.oldDistance-1/O)){let M=await j(this,_e,"m",xt).call(this,e,b);if(M<E)return await j(this,_e,"m",t).call(this,e,r,a,_,E,b,M);if(M==E)return await j(this,_e,"m",t).call(this,e,b,M,_,E);let k=await j(this,_e,"m",xt).call(this,e,O);if(M>E&&E<k)return await j(this,_e,"m",t).call(this,e,b,M,O,k,_,E);if(E==k)return await j(this,_e,"m",t).call(this,e,_,E,O,k);if(E>k)return await j(this,_e,"m",t).call(this,e,_,E,d,p,O,k)}else{let M=await j(this,_e,"m",xt).call(this,e,O);if(E>M)return await j(this,_e,"m",t).call(this,e,_,E,d,p,O,M);if(E==M)return await j(this,_e,"m",t).call(this,e,_,E,O,M);let k=await j(this,_e,"m",xt).call(this,e,b);if(k>E&&E<M)return await j(this,_e,"m",t).call(this,e,b,k,O,M,_,E);if(k==E)return await j(this,_e,"m",t).call(this,e,b,k,_,E);if(k<E)return await j(this,_e,"m",t).call(this,e,r,a,_,E,b,k)}return!1},Wo=async function(t,e,r,a,d){var p;if(this._focusParameters.isDoingFocus==1)return!1;if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'centerPoint'.");if(!e||typeof e!="string")throw new Error("Invalid 'width'.");if(!r||typeof r!="string")throw new Error("Invalid 'height'.");const _=this.getResolution();let E=0,C=0;if(t.x.endsWith("px"))E=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");E=parseFloat(t.x)/100*_.width}if(t.y.endsWith("px"))C=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");C=parseFloat(t.y)/100*_.height}if(isNaN(E)||isNaN(C)||E<0||E>_.width||C<0||C>_.height)throw new Error("Invalid 'centerPoint'.");let b=0;if(e.endsWith("px"))b=parseFloat(e);else{if(!e.endsWith("%"))throw new Error("Invalid 'width'.");b=parseFloat(e)/100*_.width}if(isNaN(b)||b<0)throw new Error("Invalid 'width'.");let O=0;if(r.endsWith("px"))O=parseFloat(r);else{if(!r.endsWith("%"))throw new Error("Invalid 'height'.");O=parseFloat(r)/100*_.height}if(isNaN(O)||O<0)throw new Error("Invalid 'height'.");if(j(this,hi,"f")!==1){const V=j(this,hi,"f"),H=j(this,ci,"f");b/=V,O/=V,E=(1-1/V)*H.x+E/V,C=(1-1/V)*H.y+C/V}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(p=this.getCameraCapabilities())===null||p===void 0?void 0:p.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;const M={focusL:E,focusT:C,focusW:b,focusH:O,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},k=async(V,H,z)=>{try{(H==null||H<this._focusParameters.fds.min)&&(H=this._focusParameters.fds.min),(z==null||z>this._focusParameters.fds.max)&&(z=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let Z=Ct(Math.sqrt(z*(H||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),$=Ct(Math.sqrt((H||this._focusParameters.fds.step)*Z),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),J=Ct(Math.sqrt(Z*z),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),te=await j(this,_e,"m",xt).call(this,V,J),he=await j(this,_e,"m",xt).call(this,V,$),ce=await j(this,_e,"m",xt).call(this,V,Z);if(he>ce&&ce<te){const ue=await j(this,_e,"m",hr).call(this,V,$,he,J,te,Z,ce);return this._focusParameters.isDoingFocus=0,ue}if(he<ce&&he<te){let ue=await j(this,_e,"m",xt).call(this,V,H);const be=await j(this,_e,"m",hr).call(this,V,H,ue,Z,ce,$,he);return this._focusParameters.isDoingFocus=0,be}if(ce>te&&he>te){let ue=await j(this,_e,"m",xt).call(this,V,z);const be=await j(this,_e,"m",hr).call(this,V,Z,ce,z,ue,J,te);return this._focusParameters.isDoingFocus=0,be}if(he==ce&&ce<te){const ue=await j(this,_e,"m",hr).call(this,V,$,he,Z,ce);return this._focusParameters.isDoingFocus=0,ue}if(ce==te&&he>ce){const ue=await j(this,_e,"m",hr).call(this,V,Z,ce,J,te);return this._focusParameters.isDoingFocus=0,ue}return k(V,H,z)}catch(Z){if(Z.name!=="DeprecatedTaskError")throw Z}};return k(M,a,d)},Ho=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'center'.");const e=this.getResolution();let r=0,a=0;if(t.x.endsWith("px"))r=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");r=parseFloat(t.x)/100*e.width}if(t.y.endsWith("px"))a=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");a=parseFloat(t.y)/100*e.height}if(isNaN(r)||isNaN(a))throw new Error("Invalid scale center.");Pe(this,ci,{x:r,y:a},"f")},pc=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");const e=this.getResolution();return t&&t.x==e.width/2&&t.y==e.height/2},Te.browserInfo=ft,Te.onWarning=(ho=window==null?void 0:window.console)===null||ho===void 0?void 0:ho.warn;class gi{constructor(e){En.add(this),Ds.set(this,void 0),Ir.set(this,0),Qi.set(this,void 0),Ls.set(this,0),wr.set(this,!1),Ee(this,Ds,e,"f")}startCharging(){I(this,wr,"f")||(gi._onLog&&gi._onLog("start charging."),I(this,En,"m",mc).call(this),Ee(this,wr,!0,"f"))}stopCharging(){I(this,Qi,"f")&&clearTimeout(I(this,Qi,"f")),I(this,wr,"f")&&(gi._onLog&&gi._onLog("stop charging."),Ee(this,Ir,Date.now()-I(this,Ls,"f"),"f"),Ee(this,wr,!1,"f"))}}Ds=new WeakMap,Ir=new WeakMap,Qi=new WeakMap,Ls=new WeakMap,wr=new WeakMap,En=new WeakSet,jl=function(){tt.cfd(1),gi._onLog&&gi._onLog("charge 1.")},mc=function t(){I(this,Ir,"f")==0&&I(this,En,"m",jl).call(this),Ee(this,Ls,Date.now(),"f"),I(this,Qi,"f")&&clearTimeout(I(this,Qi,"f")),Ee(this,Qi,setTimeout(()=>{Ee(this,Ir,0,"f"),I(this,En,"m",t).call(this)},I(this,Ds,"f")-I(this,Ir,"f")),"f")};const Ul=new Map([[we.IPF_GRAYSCALED,Fe.GREY],[we.IPF_ABGR_8888,Fe.RGBA],[we.IPF_ARGB_8888,Fe.BGRA]]),Vl=new Map([[Fe.GREY,we.IPF_GRAYSCALED],[Fe.RGBA,we.IPF_ABGR_8888],[Fe.BGRA,we.IPF_ARGB_8888]]),fo=typeof BigInt=="function"?{BF_NULL:BigInt(0),BF_ALL:BigInt(18446744073709552e3),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"};class Oe extends Do{static set _onLog(e){Ee(Oe,Yo,e,"f",Xo),Te._onLog=e,gi._onLog=e}static get _onLog(){return I(Oe,Yo,"f",Xo)}static async detectEnvironment(){return await(async()=>({wasm:lf,worker:hf,getUserMedia:rc,camera:await cf(),browser:ht.browser,version:ht.version,OS:ht.OS}))()}static async testCameraAccess(){const e=await Te.testCameraAccess();return e.ok?{ok:!0,message:"Successfully accessed the camera."}:e.errorName==="InsecureContext"?{ok:!1,message:"Insecure context."}:e.errorName==="OverconstrainedError"||e.errorName==="NotFoundError"?{ok:!1,message:"No camera detected."}:e.errorName==="NotAllowedError"?{ok:!1,message:"No permission to access camera."}:e.errorName==="AbortError"?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:e.errorName==="NotReadableError"?{ok:!1,message:"A hardware error occurred."}:e.errorName==="SecurityError"?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:e.errorMessage}}static async createInstance(e){var r,a;if(e&&!(e instanceof et))throw new TypeError("Invalid view.");if(!((r=yt.license)===null||r===void 0)&&r.LicenseManager){if(!(!((a=yt.license)===null||a===void 0)&&a.LicenseManager.bCallInitLicense))throw new Error("License is not set.");await tt.loadWasm(["license"]),await yt.license.dynamsoft()}const d=new Oe(e);return Oe.onWarning&&(location&&location.protocol==="file:"?setTimeout(()=>{Oe.onWarning&&Oe.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):window.isSecureContext!==!1&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{Oe.onWarning&&Oe.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),d}get video(){return I(this,me,"f").getVideoEl()}set videoSrc(e){if(!I(this,me,"f"))throw new Error("Camera manager is null.");I(this,ye,"f")&&(I(this,ye,"f")._hideDefaultSelection=!0),I(this,me,"f").videoSrc=e}get videoSrc(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.videoSrc}set ifSaveLastUsedCamera(e){if(!I(this,me,"f"))throw new Error("Camera manager is null.");I(this,me,"f").ifSaveLastUsedCamera=e}get ifSaveLastUsedCamera(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){if(!I(this,me,"f"))throw new Error("Camera manager is null.");I(this,me,"f").ifSkipCameraInspection=e}get ifSkipCameraInspection(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.ifSkipCameraInspection}set cameraOpenTimeout(e){if(!I(this,me,"f"))throw new Error("Camera manager is null.");I(this,me,"f").cameraOpenTimeout=e}get cameraOpenTimeout(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.cameraOpenTimeout}set singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Ee(this,ps,e,"f")}get singleFrameMode(){return I(this,ps,"f")}get _isFetchingStarted(){return I(this,oi,"f")}get disposed(){return I(this,zo,"f")}constructor(e){if(super(),Me.add(this),me.set(this,void 0),ye.set(this,void 0),cn.set(this,"closed"),si.set(this,void 0),Ki.set(this,!1),ps.set(this,void 0),this._onCameraSelChange=async()=>{this.isOpen()&&I(this,ye,"f")&&!I(this,ye,"f").disposed&&await this.selectCamera(I(this,ye,"f")._selCam.value)},this._onResolutionSelChange=async()=>{if(!this.isOpen()||!I(this,ye,"f")||I(this,ye,"f").disposed)return;let r,a;if(I(this,ye,"f")._selRsl&&I(this,ye,"f")._selRsl.selectedIndex!=-1){let d=I(this,ye,"f")._selRsl.options[I(this,ye,"f")._selRsl.selectedIndex];r=parseInt(d.getAttribute("data-width")),a=parseInt(d.getAttribute("data-height"))}await this.setResolution({width:r,height:a})},this._onCloseBtnClick=async()=>{this.isOpen()&&I(this,ye,"f")&&!I(this,ye,"f").disposed&&this.close()},ms.set(this,(r,a,d,p)=>{const _=Date.now(),E={sx:p.x,sy:p.y,sWidth:p.width,sHeight:p.height,dWidth:p.width,dHeight:p.height},C=Math.max(E.dWidth,E.dHeight);if(this.canvasSizeLimit&&C>this.canvasSizeLimit){const M=this.canvasSizeLimit/C;E.dWidth>E.dHeight?(E.dWidth=this.canvasSizeLimit,E.dHeight=Math.round(E.dHeight*M)):(E.dWidth=Math.round(E.dWidth*M),E.dHeight=this.canvasSizeLimit)}const b=I(this,me,"f").imageDataGetter.getImageData(r,a,d,E,{pixelFormat:Ul.get(this.getPixelFormat())});let O=null;if(b){const M=Date.now();let k;b.pixelFormat===Fe.GREY?k=b.width:k=4*b.width;let V=!0;E.sx===0&&E.sy===0&&E.sWidth===a&&E.sHeight===d&&(V=!1),O={bytes:b.data,width:b.width,height:b.height,stride:k,format:Vl.get(b.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:xs.ITT_FILE_IMAGE,isCropped:V,cropRegion:{left:p.x,top:p.y,right:p.x+p.width,bottom:p.y+p.height,isMeasuredInPercentage:!1},originalWidth:a,originalHeight:d,currentWidth:b.width,currentHeight:b.height,timeSpent:M-_,timeStamp:M},toCanvas:I(this,_s,"f"),isDCEFrame:!0}}return O}),this._onSingleFrameAcquired=r=>{let a;a=I(this,ye,"f")?I(this,ye,"f").getConvertedRegion():qn.convert(I(this,$i,"f"),r.width,r.height),a||(a={x:0,y:0,width:r.width,height:r.height});const d=I(this,ms,"f").call(this,r,r.width,r.height,a);I(this,si,"f").fire("singleFrameAcquired",[d],{async:!1,copy:!1})},_s.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");const r=document.createElement("canvas");let a;if(r.width=this.width,r.height=this.height,this.format===we.IPF_GRAYSCALED){a=new Uint8ClampedArray(this.width*this.height*4);for(let d=0;d<a.length;d+=4)a[d]=this.bytes[d/4],a[d+1]=this.bytes[d/4],a[d+2]=this.bytes[d/4],a[d+3]=255}else a=new Uint8ClampedArray(this.bytes.buffer);return r.getContext("2d").putImageData(new ImageData(a,this.width,this.height),0,0),r}),Cn.set(this,void 0),$i.set(this,void 0),vs.set(this,we.IPF_ABGR_8888),oi.set(this,!1),this._imageId=-1,Dt.set(this,void 0),this.fetchInterval=0,qe.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),ve.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),Yt.set(this,void 0),zo.set(this,!1),this.isCameraEnhancer=!0,e&&!(e instanceof et))throw new TypeError("Invalid view.");Ee(this,si,new oc,"f"),Ee(this,me,new Te,"f"),this._imageDataGetter=I(this,me,"f").imageDataGetter,I(this,me,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;const r=I(this,me,"f").getSoftwareScale();if(r<1)throw new RangeError("Invalid scale value.");I(this,ye,"f")&&!I(this,ye,"f").disposed?(this.video.style.transform=r===1?"":`scale(${r})`,I(this,ye,"f")._updateVideoContainer()):this.video.style.transform=r===1?"":`scale(${r})`},["iPhone","iPad","Android","HarmonyOS"].includes(ht.OS)?I(this,me,"f").setResolution(1280,720):I(this,me,"f").setResolution(1920,1080),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.singleFrameMode="disabled":this.singleFrameMode="image",e&&this.setCameraView(e),this._on("before:camera:change",()=>{I(this,Yt,"f").stopCharging();const r=I(this,ye,"f");r&&!r.disposed&&(r._startLoading(),r.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{const r=I(this,ye,"f");r&&!r.disposed&&(r._startLoading(),r.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),e.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{I(this,Yt,"f").stopCharging();const r=I(this,ye,"f");r&&r.disposed}),this._on("resumed",()=>{const r=I(this,ye,"f");r&&r.disposed}),this._on("tapfocus",()=>{I(this,qe,"f").tapToFocus&&I(this,Yt,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=async(r,a)=>{var d,p,_,E;if(I(this,Me,"m",ze).call(this)||!this.isOpen()||this.isPaused())return;const C=r.intermediateResultUnits;Oe._onLog&&(Oe._onLog("intermediateResultUnits:"),Oe._onLog(C));let b=!1,O=!1;for(let M of C){if(M.unitType===br.IRUT_DECODED_BARCODES&&M.decodedBarcodes.length){b=!0;break}M.unitType===br.IRUT_LOCALIZED_BARCODES&&M.localizedBarcodes.length&&(O=!0)}if(Oe._onLog&&(Oe._onLog("hasLocalizedBarcodes:"),Oe._onLog(O)),I(this,qe,"f").autoZoom||I(this,qe,"f").enhancedFocus)if(b)I(this,ve,"f").autoZoomInFrameArray.length=0,I(this,ve,"f").autoZoomOutFrameCount=0,I(this,ve,"f").frameArrayInIdealZoom.length=0,I(this,ve,"f").autoFocusFrameArray.length=0;else{const M=async V=>{await this.setZoom(V),I(this,qe,"f").autoZoom&&I(this,Yt,"f").startCharging()},k=async V=>{await this.setFocus(V),I(this,qe,"f").enhancedFocus&&I(this,Yt,"f").startCharging()};if(O){const V=C[0].originalImageTag,H=((d=V.cropRegion)===null||d===void 0?void 0:d.left)||0,z=((p=V.cropRegion)===null||p===void 0?void 0:p.top)||0,Z=!((_=V.cropRegion)===null||_===void 0)&&_.right?V.cropRegion.right-H:V.originalWidth,$=!((E=V.cropRegion)===null||E===void 0)&&E.bottom?V.cropRegion.bottom-z:V.originalHeight,J=V.currentWidth,te=V.currentHeight;let he;{let ce,ue,be,v,pe;{const l=this.video.videoWidth*(1-I(this,ve,"f").autoZoomDetectionArea)/2,s=this.video.videoWidth*(1+I(this,ve,"f").autoZoomDetectionArea)/2,o=s,c=l,i=this.video.videoHeight*(1-I(this,ve,"f").autoZoomDetectionArea)/2,n=i,h=this.video.videoHeight*(1+I(this,ve,"f").autoZoomDetectionArea)/2;pe=[{x:l,y:i},{x:s,y:n},{x:o,y:h},{x:c,y:h}]}Oe._onLog&&(Oe._onLog("detectionArea:"),Oe._onLog(pe));const Ce=[];{const l=(s,o)=>{const c=(n,h)=>{if(!n&&!h)throw new Error("Invalid arguments.");return function(g,u,f){let m=!1;const y=g.length;if(y<=2)return!1;for(let w=0;w<y;w++){const T=g[w],S=g[(w+1)%y];if(ff(T,S,{x:u,y:f}))return!0;ao(T.y-f)>0!=ao(S.y-f)>0&&ao(u-(f-T.y)*(T.x-S.x)/(T.y-S.y)-T.x)<0&&(m=!m)}return m}(h,n.x,n.y)},i=(n,h)=>!!(Gn([n[0],n[1]],[n[2],n[3]],[h[0].x,h[0].y],[h[1].x,h[1].y])||Gn([n[0],n[1]],[n[2],n[3]],[h[1].x,h[1].y],[h[2].x,h[2].y])||Gn([n[0],n[1]],[n[2],n[3]],[h[2].x,h[2].y],[h[3].x,h[3].y])||Gn([n[0],n[1]],[n[2],n[3]],[h[3].x,h[3].y],[h[0].x,h[0].y]));return!!(c({x:s[0].x,y:s[0].y},o)||c({x:s[1].x,y:s[1].y},o)||c({x:s[2].x,y:s[2].y},o)||c({x:s[3].x,y:s[3].y},o))||!!(c({x:o[0].x,y:o[0].y},s)||c({x:o[1].x,y:o[1].y},s)||c({x:o[2].x,y:o[2].y},s)||c({x:o[3].x,y:o[3].y},s))||!!(i([o[0].x,o[0].y,o[1].x,o[1].y],s)||i([o[1].x,o[1].y,o[2].x,o[2].y],s)||i([o[2].x,o[2].y,o[3].x,o[3].y],s)||i([o[3].x,o[3].y,o[0].x,o[0].y],s))};for(let s of C)if(s.unitType===br.IRUT_LOCALIZED_BARCODES)for(let o of s.localizedBarcodes){if(!o)continue;const c=o.location.points;c.forEach(i=>{et._transformCoordinates(i,H,z,Z,$,J,te)}),l(pe,c)&&Ce.push(o)}if(Oe._debug&&I(this,ye,"f")){const s=this.__layer||(this.__layer=I(this,ye,"f")._createDrawingLayer(99));s.clearDrawingItems();const o=this.__styleId2||(this.__styleId2=le.createDrawingStyle({strokeStyle:"red"}));for(let c of C)if(c.unitType===br.IRUT_LOCALIZED_BARCODES)for(let i of c.localizedBarcodes){if(!i)continue;const n=i.location.points,h=new ko({points:n},o);s.addDrawingItems([h])}}}if(Oe._onLog&&(Oe._onLog("intersectedResults:"),Oe._onLog(Ce)),!Ce.length)return;let fe;if(Ce.length){let l=Ce.filter(s=>s.possibleFormats==fo.BF_QR_CODE||s.possibleFormats==fo.BF_DATAMATRIX);if(l.length||(l=Ce.filter(s=>s.possibleFormats==fo.BF_ONED),l.length||(l=Ce)),l.length){const s=c=>{const i=c.location.points,n=(i[0].x+i[1].x+i[2].x+i[3].x)/4,h=(i[0].y+i[1].y+i[2].y+i[3].y)/4;return(n-J/2)*(n-J/2)+(h-te/2)*(h-te/2)};fe=l[0];let o=s(fe);if(l.length!=1)for(let c=1;c<l.length;c++){const i=s(l[c]);(l[c].confidence>1.1*fe.confidence||l[c].confidence>.9*fe.confidence&&i<o)&&(fe=l[c],o=i)}}}if(Oe._onLog&&(Oe._onLog("highPriorityResult:"),Oe._onLog(fe)),fe){const l=fe.location.points;ce=Math.min(l[0].x,l[1].x,l[2].x,l[3].x),ue=Math.max(l[0].x,l[1].x,l[2].x,l[3].x),be=Math.min(l[0].y,l[1].y,l[2].y,l[3].y),v=Math.max(l[0].y,l[1].y,l[2].y,l[3].y),he={points:[{x:ce,y:be},{x:ue,y:be},{x:ue,y:v},{x:ce,y:v}],result:fe}}}if(Oe._onLog&&(Oe._onLog("boundingRect:"),Oe._onLog(he)),!he)return;if(Oe._debug&&I(this,ye,"f")&&(he!=null&&he.points)){const ce=this.__layer||(this.__layer=I(this,ye,"f")._createDrawingLayer(99)),ue=this.__styleId1||(this.__styleId1=le.createDrawingStyle({strokeStyle:"blue"})),be=new ko({points:he.points},ue);ce.addDrawingItems([be])}if(I(this,ve,"f").autoZoomOutFrameCount=0,I(this,qe,"f").autoZoom){const ce=I(this,ve,"f").autoZoomIdealArea[1];let ue=(1-I(this,ve,"f").autoZoomTargetBorder)/2;const be=he.points[0].x/Z,v=(Z-he.points[2].x)/Z,pe=he.points[0].y/$,Ce=($-he.points[2].y)/$;if(be>ce&&v>ce&&pe>ce&&Ce>ce&&he.result.moduleSize<I(this,ve,"f").autoZoomInIdealModuleSize){if(I(this,ve,"f").autoZoomInFrameArray.push(!0),I(this,ve,"f").autoZoomInFrameArray.splice(0,I(this,ve,"f").autoZoomInFrameArray.length-I(this,ve,"f").autoZoomInFrameLimit[0]),I(this,ve,"f").frameArrayInIdealZoom.length=0,I(this,qe,"f").enhancedFocus&&k({mode:"continuous"}).catch(()=>{}),I(this,ve,"f").autoZoomInFrameArray.filter(fe=>fe===!0).length>=I(this,ve,"f").autoZoomInFrameLimit[1]){I(this,ve,"f").autoZoomInFrameArray.length=0;const fe=[(.5-ue)/(.5-be),(.5-ue)/(.5-v),(.5-ue)/(.5-pe),(.5-ue)/(.5-Ce)].filter(i=>i>0),l=Math.min(...fe,I(this,ve,"f").autoZoomInIdealModuleSize/he.result.moduleSize),s=this.getZoomSettings().factor;let o=Math.max(Math.pow(s*l,1/I(this,ve,"f").autoZoomInMaxTimes),I(this,ve,"f").autoZoomInMinStep);o=Math.min(o,l);let c=s*o;c=Math.max(I(this,ve,"f").minValue,c),c=Math.min(I(this,ve,"f").maxValue,c);try{await M({factor:c})}catch(i){const n=i.message||i;console.warn(n)}this.clearBuffer()}}else if(I(this,ve,"f").autoZoomInFrameArray.length=0,I(this,ve,"f").frameArrayInIdealZoom.push(!0),I(this,ve,"f").frameArrayInIdealZoom.splice(0,I(this,ve,"f").frameArrayInIdealZoom.length-I(this,ve,"f").frameLimitInIdealZoom[0]),I(this,ve,"f").frameArrayInIdealZoom.filter(fe=>fe===!0).length>=I(this,ve,"f").frameLimitInIdealZoom[1]&&(I(this,ve,"f").frameArrayInIdealZoom.length=0,I(this,qe,"f").enhancedFocus)){const fe=he.points;try{await k({mode:"manual",area:{centerPoint:{x:(fe[0].x+fe[2].x)/2+"px",y:(fe[0].y+fe[2].y)/2+"px"},width:fe[2].x-fe[0].x+"px",height:fe[2].y-fe[0].y+"px"}})}catch(l){const s=l.message||l;console.warn(s)}this.clearBuffer()}}if(!I(this,qe,"f").autoZoom&&I(this,qe,"f").enhancedFocus&&(I(this,ve,"f").autoFocusFrameArray.push(!0),I(this,ve,"f").autoFocusFrameArray.splice(0,I(this,ve,"f").autoFocusFrameArray.length-I(this,ve,"f").autoFocusFrameLimit[0]),I(this,ve,"f").autoFocusFrameArray.filter(ce=>ce===!0).length>=I(this,ve,"f").autoFocusFrameLimit[1])){I(this,ve,"f").autoFocusFrameArray.length=0;try{const ce=he.points;await k({mode:"manual",area:{centerPoint:{x:(ce[0].x+ce[2].x)/2+"px",y:(ce[0].y+ce[2].y)/2+"px"},width:ce[2].x-ce[0].x+"px",height:ce[2].y-ce[0].y+"px"}})}catch(ce){const ue=ce.message||ce;console.warn(ue)}this.clearBuffer()}}else{if(I(this,qe,"f").autoZoom){if(I(this,ve,"f").autoZoomInFrameArray.push(!1),I(this,ve,"f").autoZoomInFrameArray.splice(0,I(this,ve,"f").autoZoomInFrameArray.length-I(this,ve,"f").autoZoomInFrameLimit[0]),I(this,ve,"f").autoZoomOutFrameCount++,I(this,ve,"f").frameArrayInIdealZoom.push(!1),I(this,ve,"f").frameArrayInIdealZoom.splice(0,I(this,ve,"f").frameArrayInIdealZoom.length-I(this,ve,"f").frameLimitInIdealZoom[0]),I(this,ve,"f").autoZoomOutFrameCount>=I(this,ve,"f").autoZoomOutFrameLimit){I(this,ve,"f").autoZoomOutFrameCount=0;const V=this.getZoomSettings().factor;let H=V-Math.max((V-1)*I(this,ve,"f").autoZoomOutStepRate,I(this,ve,"f").autoZoomOutMinStep);H=Math.max(I(this,ve,"f").minValue,H),H=Math.min(I(this,ve,"f").maxValue,H);try{await M({factor:H})}catch(z){const Z=z.message||z;console.warn(Z)}this.clearBuffer()}I(this,qe,"f").enhancedFocus&&k({mode:"continuous"}).catch(()=>{})}!I(this,qe,"f").autoZoom&&I(this,qe,"f").enhancedFocus&&(I(this,ve,"f").autoFocusFrameArray.length=0,k({mode:"continuous"}).catch(()=>{}))}}},Ee(this,Yt,new gi(1e4),"f")}setCameraView(e){if(!(e instanceof et))throw new TypeError("Invalid view.");if(e.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),e._singleFrameMode=this.singleFrameMode,e._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(I(this,ye,"f")._hideDefaultSelection=!0),I(this,Me,"m",ze).call(this)||I(this,me,"f").setVideoEl(e.getVideoElement()),Ee(this,ye,e,"f"),this.addListenerToView()}getCameraView(){return I(this,ye,"f")}releaseCameraView(){I(this,ye,"f")&&(this.removeListenerFromView(),I(this,ye,"f").disposed||(I(this,ye,"f")._singleFrameMode="disabled",I(this,ye,"f")._onSingleFrameAcquired=null,I(this,ye,"f")._hideDefaultSelection=!1),I(this,me,"f").releaseVideoEl(),Ee(this,ye,null,"f"))}addListenerToView(){if(!I(this,ye,"f"))return;if(I(this,ye,"f").disposed)throw new Error("'cameraView' has been disposed.");const e=I(this,ye,"f");I(this,Me,"m",ze).call(this)||this.videoSrc||(e._innerComponent&&(I(this,me,"f").tapFocusEventBoundEl=e._innerComponent),e._selCam&&e._selCam.addEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.addEventListener("change",this._onResolutionSelChange)),e._btnClose&&e._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!I(this,ye,"f")||I(this,ye,"f").disposed)return;const e=I(this,ye,"f");I(this,me,"f").tapFocusEventBoundEl=null,e._selCam&&e._selCam.removeEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.removeEventListener("change",this._onResolutionSelChange),e._btnClose&&e._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return I(this,Me,"m",ze).call(this)?I(this,cn,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(I(this,me,"f").state)}isOpen(){return this.getCameraState()==="open"}getVideoEl(){return this.video}async open(){const e=I(this,ye,"f");if(e!=null&&e.disposed)throw new Error("'cameraView' has been disposed.");e&&(e._singleFrameMode=this.singleFrameMode,I(this,Me,"m",ze).call(this)?e._clickIptSingleFrameMode():(I(this,me,"f").setVideoEl(e.getVideoElement()),e._startLoading()));let r={width:0,height:0,deviceId:""};if(!I(this,Me,"m",ze).call(this)){try{await I(this,me,"f").open()}catch(d){throw e&&e._stopLoading(),d}I(this,Ki,"f")&&this.turnOnTorch().catch(()=>{});const a=this.getResolution();r.width=a.width,r.height=a.height,r.deviceId=this.getSelectedCamera().deviceId}return Ee(this,cn,"open","f"),e&&(e._innerComponent.style.display="",I(this,Me,"m",ze).call(this)||(e._stopLoading(),e._renderCamerasInfo(this.getSelectedCamera(),I(this,me,"f")._arrCameras),e._renderResolutionInfo({width:r.width,height:r.height}),e.eventHandler.fire("content:updated",null,{async:!0}),e.eventHandler.fire("videoEl:resized",null,{async:!0}))),I(this,si,"f").fire("opened",null,{target:this,async:!0}),r}close(){const e=I(this,ye,"f");if(e!=null&&e.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),I(this,Me,"m",ze).call(this)||I(this,me,"f").close(),Ee(this,cn,"closed","f"),I(this,Yt,"f").stopCharging(),e&&(e._innerComponent.style.display="none",I(this,Me,"m",ze).call(this)&&e._innerComponent.removeElement("content"),e._stopLoading()),I(this,si,"f").fire("closed",null,{target:this,async:!0})}pause(){if(I(this,Me,"m",ze).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");I(this,me,"f").pause()}isPaused(){var e;return!I(this,Me,"m",ze).call(this)&&((e=this.video)===null||e===void 0?void 0:e.paused)===!0}async resume(){if(I(this,Me,"m",ze).call(this))throw new Error("'resume()' is invalid in 'singleFrameMode'.");await I(this,me,"f").resume()}async selectCamera(e){if(!e)throw new Error("Invalid value.");let r;r=typeof e=="string"?e:e.deviceId,await I(this,me,"f").setCamera(r),Ee(this,Ki,!1,"f");const a=this.getResolution(),d=I(this,ye,"f");return d&&!d.disposed&&(d._stopLoading(),d._renderCamerasInfo(this.getSelectedCamera(),I(this,me,"f")._arrCameras),d._renderResolutionInfo({width:a.width,height:a.height})),{width:a.width,height:a.height,deviceId:this.getSelectedCamera().deviceId}}getSelectedCamera(){return I(this,me,"f").getCamera()}async getAllCameras(){return I(this,me,"f").getCameras()}async setResolution(e){await I(this,me,"f").setResolution(e.width,e.height),I(this,Ki,"f")&&this.turnOnTorch().catch(()=>{});const r=this.getResolution(),a=I(this,ye,"f");return a&&!a.disposed&&(a._stopLoading(),a._renderResolutionInfo({width:r.width,height:r.height})),{width:r.width,height:r.height,deviceId:this.getSelectedCamera().deviceId}}getResolution(){return I(this,me,"f").getResolution()}getAvailableResolutions(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.getResolutions()}_on(e,r){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?I(this,si,"f").on(e,r):I(this,me,"f").on(e,r)}_off(e,r){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?I(this,si,"f").off(e,r):I(this,me,"f").off(e,r)}on(e,r){const a=e.toLowerCase(),d=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(a);if(!d)throw new Error("Invalid event.");this._on(d,r)}off(e,r){const a=e.toLowerCase(),d=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(a);if(!d)throw new Error("Invalid event.");this._off(d,r)}getVideoSettings(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.getMediaStreamConstraints()}async updateVideoSettings(e){var r;await((r=I(this,me,"f"))===null||r===void 0?void 0:r.setMediaStreamConstraints(e,!0))}getCapabilities(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.getCameraCapabilities()}getCameraSettings(){return I(this,me,"f").getCameraSettings()}async turnOnTorch(){var e;if(I(this,Me,"m",ze).call(this))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");await((e=I(this,me,"f"))===null||e===void 0?void 0:e.turnOnTorch()),Ee(this,Ki,!0,"f")}async turnOffTorch(){var e;if(I(this,Me,"m",ze).call(this))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");await((e=I(this,me,"f"))===null||e===void 0?void 0:e.turnOffTorch()),Ee(this,Ki,!1,"f")}async setColorTemperature(e){if(I(this,Me,"m",ze).call(this))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");await I(this,me,"f").setColorTemperature(e,!0)}getColorTemperature(){return I(this,me,"f").getColorTemperature()}async setExposureCompensation(e){var r;if(I(this,Me,"m",ze).call(this))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");await((r=I(this,me,"f"))===null||r===void 0?void 0:r.setExposureCompensation(e,!0))}getExposureCompensation(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.getExposureCompensation()}async _setZoom(e){var r;if(I(this,Me,"m",ze).call(this))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");await((r=I(this,me,"f"))===null||r===void 0?void 0:r.setZoom(e))}async setZoom(e){await this._setZoom(e)}getZoomSettings(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.getZoom()}async resetZoom(){var e;if(I(this,Me,"m",ze).call(this))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");await((e=I(this,me,"f"))===null||e===void 0?void 0:e.resetZoom())}async setFrameRate(e){var r;if(I(this,Me,"m",ze).call(this))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");await((r=I(this,me,"f"))===null||r===void 0?void 0:r.setFrameRate(e,!0))}getFrameRate(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.getFrameRate()}async setFocus(e){var r;if(I(this,Me,"m",ze).call(this))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");await((r=I(this,me,"f"))===null||r===void 0?void 0:r.setFocus(e,!0))}getFocusSettings(){var e;return(e=I(this,me,"f"))===null||e===void 0?void 0:e.getFocus()}setAutoZoomRange(e){I(this,ve,"f").minValue=e.min,I(this,ve,"f").maxValue=e.max}getAutoZoomRange(){return{min:I(this,ve,"f").minValue,max:I(this,ve,"f").maxValue}}async enableEnhancedFeatures(e){var r,a;if(!(!((a=(r=yt.license)===null||r===void 0?void 0:r.LicenseManager)===null||a===void 0)&&a.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(tt.bSupportDce4Module!==0)throw new Error("Please set a license containing the DCE module.");e&Ai.EF_ENHANCED_FOCUS&&(I(this,qe,"f").enhancedFocus=!0),e&Ai.EF_AUTO_ZOOM&&(I(this,qe,"f").autoZoom=!0),e&Ai.EF_TAP_TO_FOCUS&&(I(this,qe,"f").tapToFocus=!0,I(this,me,"f").enableTapToFocus())}disableEnhancedFeatures(e){e&Ai.EF_ENHANCED_FOCUS&&(I(this,qe,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),e&Ai.EF_AUTO_ZOOM&&(I(this,qe,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),e&Ai.EF_TAP_TO_FOCUS&&(I(this,qe,"f").tapToFocus=!1,I(this,me,"f").disableTapToFocus()),I(this,Me,"m",vc).call(this)&&I(this,Me,"m",_c).call(this)||I(this,Yt,"f").stopCharging()}_setScanRegion(e){if(e!=null&&!Ta(e)&&!nr(e))throw TypeError("Invalid 'region'.");Ee(this,$i,e?JSON.parse(JSON.stringify(e)):null,"f"),I(this,ye,"f")&&!I(this,ye,"f").disposed&&I(this,ye,"f").setScanRegion(e)}setScanRegion(e){this._setScanRegion(e),I(this,ye,"f")&&!I(this,ye,"f").disposed&&(e===null?I(this,ye,"f").setScanRegionMaskVisible(!1):I(this,ye,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(I(this,$i,"f")))}setErrorListener(e){if(!e)throw new TypeError("Invalid 'listener'");Ee(this,Cn,e,"f")}hasNextImageToFetch(){return!(this.getCameraState()!=="open"||!I(this,me,"f").isVideoLoaded()||I(this,Me,"m",ze).call(this))}startFetching(){if(I(this,Me,"m",ze).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");I(this,oi,"f")||(Ee(this,oi,!0,"f"),I(this,Me,"m",Ko).call(this))}stopFetching(){I(this,oi,"f")&&(Oe._onLog&&Oe._onLog("DCE: stop fetching loop: "+Date.now()),I(this,Dt,"f")&&clearTimeout(I(this,Dt,"f")),Ee(this,oi,!1,"f"))}fetchImage(){if(I(this,Me,"m",ze).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(this.video.readyState!==4)throw new Error("The video is not loaded.");const e=this.getResolution();if(!(e!=null&&e.width)||!(e!=null&&e.height))throw new Error("The video is not loaded.");let r;if(r=qn.convert(I(this,$i,"f"),e.width,e.height),r||(r={x:0,y:0,width:e.width,height:e.height}),r.x>e.width||r.y>e.height)throw new Error("Invalid scan region.");r.x+r.width>e.width&&(r.width=e.width-r.x),r.y+r.height>e.height&&(r.height=e.height-r.y);const a={sx:r.x,sy:r.y,sWidth:r.width,sHeight:r.height,dWidth:r.width,dHeight:r.height},d=Math.max(a.dWidth,a.dHeight);if(this.canvasSizeLimit&&d>this.canvasSizeLimit){const C=this.canvasSizeLimit/d;a.dWidth>a.dHeight?(a.dWidth=this.canvasSizeLimit,a.dHeight=Math.round(a.dHeight*C)):(a.dWidth=Math.round(a.dWidth*C),a.dHeight=this.canvasSizeLimit)}const p=I(this,me,"f").getFrameData({position:a,pixelFormat:Ul.get(this.getPixelFormat())});if(!p)return null;let _;p.pixelFormat===Fe.GREY?_=p.width:_=4*p.width;let E=!0;return a.sx===0&&a.sy===0&&a.sWidth===e.width&&a.sHeight===e.height&&(E=!1),{bytes:p.data,width:p.width,height:p.height,stride:_,format:Vl.get(p.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:xs.ITT_VIDEO_FRAME,isCropped:E,cropRegion:{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height,isMeasuredInPercentage:!1},originalWidth:e.width,originalHeight:e.height,currentWidth:p.width,currentHeight:p.height,timeSpent:p.timeSpent,timeStamp:p.timeStamp},toCanvas:I(this,_s,"f"),isDCEFrame:!0}}setImageFetchInterval(e){this.fetchInterval=e,I(this,oi,"f")&&(I(this,Dt,"f")&&clearTimeout(I(this,Dt,"f")),Ee(this,Dt,setTimeout(()=>{this.disposed||I(this,Me,"m",Ko).call(this)},e),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(e){Ee(this,vs,e,"f")}getPixelFormat(){return I(this,vs,"f")}takePhoto(e){if(!this.isOpen())throw new Error("Not open.");if(I(this,Me,"m",ze).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");const r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),r.setAttribute("capture",""),r.style.position="absolute",r.style.top="-9999px",r.style.backgroundColor="transparent",r.style.color="transparent",r.addEventListener("click",()=>{const a=this.isOpen();this.close(),window.addEventListener("focus",()=>{a&&this.open(),r.remove()},{once:!0})}),r.addEventListener("change",async()=>{const a=r.files[0],d=await(async b=>{let O=null,M=null;if(typeof createImageBitmap<"u")try{if(O=await createImageBitmap(b),O)return O}catch{}var k;return O||(M=await(k=b,new Promise((V,H)=>{let z=URL.createObjectURL(k),Z=new Image;Z.src=z,Z.onload=()=>{URL.revokeObjectURL(Z.src),V(Z)},Z.onerror=$=>{H(new Error("Can't convert blob to image : "+($ instanceof Event?$.type:$)))}}))),M})(a),p=d instanceof HTMLImageElement?d.naturalWidth:d.width,_=d instanceof HTMLImageElement?d.naturalHeight:d.height;let E=qn.convert(I(this,$i,"f"),p,_);E||(E={x:0,y:0,width:p,height:_});const C=I(this,ms,"f").call(this,d,p,_,E);e&&e(C)}),document.body.appendChild(r),r.click()}convertToPageCoordinates(e){const r=I(this,Me,"m",$o).call(this,e);return{x:r.pageX,y:r.pageY}}convertToClientCoordinates(e){const r=I(this,Me,"m",$o).call(this,e);return{x:r.clientX,y:r.clientY}}dispose(){this.close(),I(this,me,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}}Yo=Oe,me=new WeakMap,ye=new WeakMap,cn=new WeakMap,si=new WeakMap,Ki=new WeakMap,ps=new WeakMap,ms=new WeakMap,_s=new WeakMap,Cn=new WeakMap,$i=new WeakMap,vs=new WeakMap,oi=new WeakMap,Dt=new WeakMap,qe=new WeakMap,ve=new WeakMap,Yt=new WeakMap,zo=new WeakMap,Me=new WeakSet,ze=function(){return this.singleFrameMode!=="disabled"},_c=function(){return!this.videoSrc&&I(this,me,"f").state==="opened"},vc=function(){for(let t in I(this,qe,"f"))if(I(this,qe,"f")[t]==1)return!0;return!1},Ko=function t(){if(this.disposed)return;if(this.getCameraState()!=="open"||!I(this,oi,"f"))return I(this,Dt,"f")&&clearTimeout(I(this,Dt,"f")),void Ee(this,Dt,setTimeout(()=>{this.disposed||I(this,Me,"m",t).call(this)},this.fetchInterval),"f");const e=()=>{var r;let a;Oe._onLog&&Oe._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{a=this.fetchImage()}catch(d){const p=d.message||d;if(p==="The video is not loaded.")return;if(!((r=I(this,Cn,"f"))===null||r===void 0)&&r.onErrorReceived)return void setTimeout(()=>{var _;(_=I(this,Cn,"f"))===null||_===void 0||_.onErrorReceived(Lo.EC_IMAGE_READ_FAILED,p)},0);console.warn(d)}a?(this.addImageToBuffer(a),Oe._onLog&&Oe._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),I(this,si,"f").fire("frameAddedToBuffer",null,{async:!0})):Oe._onLog&&Oe._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case ir.BOPM_BLOCK:break;case ir.BOPM_UPDATE:e()}else e();I(this,Dt,"f")&&clearTimeout(I(this,Dt,"f")),Ee(this,Dt,setTimeout(()=>{this.disposed||I(this,Me,"m",t).call(this)},this.fetchInterval),"f")},$o=function(t){if(!I(this,ye,"f"))throw new Error("Camera view is not set.");if(I(this,ye,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!I(this,Me,"m",ze).call(this)&&!I(this,me,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(I(this,Me,"m",ze).call(this)&&!I(this,ye,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");const e=I(this,ye,"f")._innerComponent.getBoundingClientRect(),r=e.left,a=e.top,d=r+window.scrollX,p=a+window.scrollY,{width:_,height:E}=I(this,ye,"f")._innerComponent.getBoundingClientRect();if(_<=0||E<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let C,b,O;if(I(this,Me,"m",ze).call(this)){const J=I(this,ye,"f")._innerComponent.getElement("content");C=J.width,b=J.height,O="contain"}else{const J=this.getVideoEl();C=J.videoWidth,b=J.videoHeight,O=I(this,ye,"f").getVideoFit()}const M=_/E,k=C/b;let V,H,z,Z,$=1;if(O==="contain")M<k?($=_/C,V=r+t.x*$,H=a+t.y*$+(E-b*$)/2,z=d+t.x*$,Z=p+t.y*$+(E-b*$)/2):($=E/b,V=r+t.x*$+(_-C*$)/2,H=a+t.y*$,z=d+t.x*$+(_-C*$)/2,Z=p+t.y*$);else if(O==="cover")if(M<k){$=E/b;let J=t.x*$-(C*$-_)/2;J=Math.max(J,0),J=Math.min(J,_),V=r+J,H=a+t.y*$,z=d+J,Z=p+t.y*$}else{$=_/C;let J=t.y*$-(b*$-E)/2;J=Math.max(J,0),J=Math.min(J,E),V=r+t.x*$,H=a+J,z=d+t.x*$,Z=p+J}return{clientX:V,clientY:H,pageX:z,pageY:Z}},Oe._debug=!1,Xo={value:void 0},Oe.browserInfo=ht,typeof SuppressedError=="function"&&SuppressedError;var Gl,kt,Wl,Zo,un,dn;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(Gl||(Gl={}));class xr{static beep(){if(!this.beepSoundSource)return;let e;if(I(this,kt,"f",un).size&&(e=I(this,kt,"f",un).values().next().value,this.beepSoundSource==e.src?(I(this,kt,"f",un).delete(e),e.play()):e=null),!e)if(I(this,kt,"f",dn).size<64){e=new Audio(this.beepSoundSource);let r=null,a=()=>{e.removeEventListener("loadedmetadata",a),e.play(),r=setTimeout(()=>{I(this,kt,"f",dn).delete(e)},2e3*e.duration)};e.addEventListener("loadedmetadata",a),e.addEventListener("ended",()=>{r!=null&&(clearTimeout(r),r=null),e.pause(),e.currentTime=0,I(this,kt,"f",dn).delete(e),I(this,kt,"f",un).add(e)})}else I(this,kt,"f",Zo)||(Ee(this,kt,!0,"f",Zo),console.warn("The requested audio tracks exceed 64 and will not be played."));e&&I(this,kt,"f",dn).add(e)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(xr.vibrateDuration)}}kt=xr,Wl={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"},Zo={value:!1},un={value:new Set},dn={value:new Set},xr.beepSoundSource=I(xr,kt,"f",Wl),xr.vibrateDuration=300;/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Capture Vision Router JS Edition
 * @website http://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version "2.2.10"
 * @fileoverview Dynamsoft JavaScript Library for Capture Vision
 * More info on cvr JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/capture-vision-router/capture-vision-router-module.html
 */const Hl=t=>t&&typeof t=="object"&&typeof t.then=="function";class cr extends Promise{constructor(e){let r,a;super((d,p)=>{r=d,a=p}),this._s="pending",this.resolve=d=>{this.isPending&&(Hl(d)?this.task=d:(this._s="fulfilled",r(d)))},this.reject=d=>{this.isPending&&(this._s="rejected",a(d))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let r;this._task=e,Hl(e)?r=e:typeof e=="function"&&(r=new Promise(e)),r&&(async()=>{try{const a=await r;e===this._task&&this.resolve(a)}catch(a){e===this._task&&this.reject(a)}})()}get isEmpty(){return this._task==null}}class Cf{constructor(){this.addResultReceiver=null,this.removeResultReceiver=null,this.getOriginalImage=null}}var wf={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1};const yc=typeof self>"u",Ia=(()=>{if(!yc&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let r=t.indexOf("#");r!=-1&&(t=t.substring(0,r))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Ec=t=>{if(t==null&&(t="./"),!yc){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};var go;We.cvr==null&&(We.cvr=Ia),rr.cvr={js:!0,wasm:!0,deps:["license","dip"]},yt.cvr={};const po="1.2.0";typeof We.std!="string"&&Dn(We.std.version,po)<0&&(We.std={version:po,path:Ec(Ia+`../../dynamsoft-capture-vision-std@${po}/dist/`)});const mo="2.2.10";(!We.dip||typeof We.dip!="string"&&Dn(We.dip.version,mo)<0)&&(We.dip={version:mo,path:Ec(Ia+`../../dynamsoft-image-processing@${mo}/dist/`)});var Ms,Yl;function Cc(t,e){if(t&&t.location){const r=t.location.points;for(let a of r)a.x=a.x/e,a.y=a.y/e;Cc(t.referencedItem,e)}}`${(go=qi.cvr)===null||go===void 0?void 0:go.worker}`,function(t){t[t.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",t[t.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(Ms||(Ms={})),function(t){t[t.IRUT_NULL=0]="IRUT_NULL",t[t.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",t[t.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",t[t.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",t[t.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",t[t.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",t[t.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",t[t.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",t[t.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",t[t.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",t[t.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",t[t.IRUT_CONTOURS=1024]="IRUT_CONTOURS",t[t.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",t[t.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",t[t.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",t[t.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",t[t.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",t[t.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",t[t.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",t[t.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",t[t.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",t[t.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",t[t.IRUT_CORNERS=2097152]="IRUT_CORNERS",t[t.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",t[t.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",t[t.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",t[t.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",t[t.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",t[t.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",t[t.IRUT_ALL=134217727]="IRUT_ALL"}(Yl||(Yl={}));class Ve{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(tt.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._irrRegistryState=wf,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._templateName="Default",this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._compressRate=0,this._dynamsoft=!1,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get disposed(){return this.bDestroyed}static async createInstance(){if(!yt.license)throw Error("Module `license` is not existed.");await yt.license.dynamsoft(),await zt(["cvr"]);const e=new Ve,r=new cr;let a=$e();return Ge[a]=async d=>{var p;if(d.success)e._instanceID=d.instanceID,e._currentSettings=JSON.parse(d.outputSettings),`${(p=qi.cvr)===null||p===void 0?void 0:p.worker}${d.version}`,tt.bSupportDce4Module===0&&(e._intermediateResultManager=e.getIntermediateResultManager(!0)),r.resolve(e);else{const _=Error(d.message);d.stack&&(_.stack=d.stack),r.reject(_)}},je.postMessage({type:"cvr_createInstance",id:a}),r}async _singleFrameModeCallback(e){this._isa.getCameraView().setScanLaserVisible(!0);for(let p of this._resultReceiverSet)this._bNeedOutputOriginalImage&&p.onOriginalImageResultReceived&&p.onOriginalImageResultReceived({imageData:e});const r={bytes:new Uint8Array(e.bytes),width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.tag},a=await this.capture(r,this._templateName);a.originalImageTag=e.tag;for(let p of this._resultReceiverSet)p.isDce&&p.onCapturedResultReceived(a,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});const d={originalImageHashId:a.originalImageHashId,originalImageTag:a.originalImageTag,errorCode:a.errorCode,errorString:a.errorString};for(let p of this._resultReceiverSet)if(p.onDecodedBarcodesReceived&&a.barcodeResultItems&&p.onDecodedBarcodesReceived(Object.assign(Object.assign({},d),{barcodeResultItems:a.barcodeResultItems})),p.onRecognizedTextLinesReceived&&a.textLineResultItems&&p.onRecognizedTextLinesReceived(Object.assign(Object.assign({},d),{textLineResultItems:a.textLineResultItems})),p.onDetectedQuadsReceived&&a.detectedQuadResultItems&&p.onDetectedQuadsReceived(Object.assign(Object.assign({},d),{detectedQuadResultItems:a.detectedQuadResultItems})),p.onNormalizedImagesReceived&&a.normalizedImageResultItems&&p.onNormalizedImagesReceived(Object.assign(Object.assign({},d),{normalizedImageResultItems:a.normalizedImageResultItems})),p.onParsedResultsReceived&&a.parsedResultItems&&p.onParsedResultsReceived(Object.assign(Object.assign({},d),{parsedResultItems:a.parsedResultItems})),p.onCapturedResultReceived&&!p.isDce){if(this._bNeedOutputOriginalImage){const _=a.items.findIndex(E=>E.type===1);_!==-1&&(a.items[_].imageData=e)}p.onCapturedResultReceived(a)}}setInput(e){if(this._checkIsDisposed(),e){if(this._isa=e,e.isCameraEnhancer){this._intermediateResultManager&&(this._isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this._isa._intermediateResultReceiver));const r=this._isa.getCameraView();if(r){const a=r._capturedResultReceiver;a.isDce=!0,this._resultReceiverSet.add(a)}}}else this._isa=null}getInput(){return this._isa}addImageSourceStateListener(e){if(this._checkIsDisposed(),typeof e!="object")return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&this._isaStateListenerSet.add(e)}removeImageSourceStateListener(e){return this._checkIsDisposed(),this._isaStateListenerSet.delete(e)}addResultReceiver(e){if(this._checkIsDisposed(),typeof e!="object")throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(this._resultReceiverSet.add(e),this._setCrrRegistry())}removeResultReceiver(e){this._checkIsDisposed(),this._resultReceiverSet.delete(e),this._setCrrRegistry()}async _setCrrRegistry(){const e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let d of this._resultReceiverSet)d.isDce||(e.onCapturedResultReceived=!!d.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!d.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!d.onRecognizedTextLinesReceived,e.onDetectedQuadsReceived=!!d.onDetectedQuadsReceived,e.onNormalizedImagesReceived=!!d.onNormalizedImagesReceived,e.onParsedResultsReceived=!!d.onParsedResultsReceived);const r=new cr;let a=$e();return Ge[a]=async d=>{if(d.success)r.resolve();else{let p=new Error(d.message);p.stack=d.stack+`
`+p.stack,r.reject()}},je.postMessage({type:"cvr_setCrrRegistry",id:a,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}}),r}async addResultFilter(e){if(this._checkIsDisposed(),typeof e!="object")return console.warn("Invalid filter.");if(e&&Object.keys(e)){this._resultFilterSet.add(e),this._handleFilterSwitch();for(let r of this._resultFilterSet)await this._enableResultCrossVerification(r.verificationEnabled),await this._enableResultDeduplication(r.duplicateFilterEnabled),await this._setDuplicateForgetTime(r.duplicateForgetTime)}}async removeResultFilter(e){this._checkIsDisposed(),this._resultFilterSet.delete(e),this._handleFilterSwitch();for(let r of this._resultFilterSet)await this._enableResultCrossVerification(r.verificationEnabled),await this._enableResultDeduplication(r.duplicateFilterEnabled),await this._setDuplicateForgetTime(r.duplicateForgetTime)}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let e of this._resultFilterSet)e.isResultCrossVerificationEnabled(Se.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),e.isResultCrossVerificationEnabled(Se.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),e.isResultCrossVerificationEnabled(Se.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),e.isResultCrossVerificationEnabled(Se.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}async startCapturing(e="Default"){if(this._checkIsDisposed(),!this._bPauseScan)return;if(!this._isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");const r=await this.containsTask(e);return await zt(r),this._isa.isCameraEnhancer&&(r.includes("ddn")?this._isa.setPixelFormat(we.IPF_ABGR_8888):this._isa.setPixelFormat(we.IPF_GRAYSCALED)),this._isa.singleFrameMode!==void 0&&this._isa.singleFrameMode!=="disabled"?(this._templateName=e,void this._isa.on("singleFrameAcquired",this._singleFrameModeCallbackBind)):(this._isa.getColourChannelUsageType()===Jt.CCUT_AUTO&&this._isa.setColourChannelUsageType(r.includes("ddn")?Jt.CCUT_FULL_CHANNEL:Jt.CCUT_Y_CHANNEL_ONLY),this._promiseStartScan&&this._promiseStartScan.isPending?this._promiseStartScan:(this._promiseStartScan=new cr((a,d)=>{if(this.disposed)return;let p=$e();Ge[p]=async _=>{if(this._promiseStartScan&&!this._promiseStartScan.isFulfilled){if(!_.success){let E=new Error(_.message);return E.stack=_.stack+`
`+E.stack,d(E)}for(let E of this._resultFilterSet)await this.addResultFilter(E);this._bPauseScan=!1,this._bNeedOutputOriginalImage=_.bNeedOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(async()=>{this._minImageCaptureInterval!==-1&&this._isa.startFetching(),this._loopReadVideo(e),a()},0),this._isa.isCameraEnhancer&&this._isa.getCameraView().setScanLaserVisible(!0)}},je.postMessage({type:"cvr_startCapturing",id:p,instanceID:this._instanceID,body:{templateName:e}})}),await this._promiseStartScan))}stopCapturing(){this._checkIsDisposed(),this._isa&&(this._isa.isCameraEnhancer&&(this._isa.getCameraView().setScanLaserVisible(!1),this._isa.singleFrameMode!==void 0&&this._isa.singleFrameMode!=="disabled")?this._isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this._isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this._isa.setColourChannelUsageType(Jt.CCUT_AUTO)))}async _clearVerifyList(){let e=$e();const r=new cr;return Ge[e]=async a=>{if(a.success)return r.resolve();{let d=new Error(a.message);return d.stack=a.stack+`
`+d.stack,r.reject(d)}},je.postMessage({type:"cvr_clearVerifyList",id:e,instanceID:this._instanceID}),r}async _getIntermediateResult(){this._checkIsDisposed();let e=$e();const r=new cr;return Ge[e]=async a=>{if(a.success)r.resolve(a.result);else{let d=new Error(a.message);d.stack=a.stack+`
`+d.stack,r.reject(d)}},je.postMessage({type:"cvr_getIntermediateResult",id:e,instanceID:this._instanceID}),r}async containsTask(e){return this._checkIsDisposed(),await new Promise((r,a)=>{let d=$e();Ge[d]=async p=>{if(p.success)return r(JSON.parse(p.tasks));{let _=new Error(p.message);return _.stack=p.stack+`
`+_.stack,a(_)}},je.postMessage({type:"cvr_containsTask",id:d,instanceID:this._instanceID,body:{templateName:e}})})}async _loopReadVideo(e){if(this._dynamsoft=!0,this.disposed||this._bPauseScan)return;if(this._isa.isBufferEmpty()){if(this._isa.hasNextImageToFetch())for(let a of this._isaStateListenerSet)a.onImageSourceStateReceived&&a.onImageSourceStateReceived(Ms.ISS_BUFFER_EMPTY);else if(!this._isa.hasNextImageToFetch())for(let a of this._isaStateListenerSet)a.onImageSourceStateReceived&&a.onImageSourceStateReceived(Ms.ISS_EXHAUSTED)}if(this._minImageCaptureInterval===-1||this._isa.isBufferEmpty())try{this._isa.isBufferEmpty()&&Ve._onLog&&Ve._onLog("buffer is empty so fetch image"),Ve._onLog&&Ve._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=this._isa.fetchImage(),Ve._onLog&&Ve._onLog(`DCE: finish fetching a frame: ${Date.now()}`),this._isa.setImageFetchInterval(this._averageTime)}catch{return void this._reRunCurrnetFunc(e)}else if(this._isa.setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=this._isa.getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!this._dsImage)return void this._reRunCurrnetFunc(e);for(let a of this._resultReceiverSet)this._bNeedOutputOriginalImage&&a.onOriginalImageResultReceived&&a.onOriginalImageResultReceived({imageData:this._dsImage});const r=Date.now();this._captureDsimage(this._dsImage,e).then(async a=>{if(Ve._onLog&&Ve._onLog("no js handle time: "+(Date.now()-r)),this._bPauseScan)return void this._reRunCurrnetFunc(e);a.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let _ of this._resultReceiverSet)if(_.isDce){const E=Date.now();if(_.onCapturedResultReceived(a,{isDetectVerifyOpen:this._bOpenDetectVerify,isNormalizeVerifyOpen:this._bOpenNormalizeVerify,isBarcodeVerifyOpen:this._bOpenBarcodeVerify,isLabelVerifyOpen:this._bOpenLabelVerify}),Ve._onLog){const C=Date.now()-E;C>10&&Ve._onLog(`draw result time: ${C}`)}}const d={originalImageHashId:a.originalImageHashId,originalImageTag:a.originalImageTag,errorCode:a.errorCode,errorString:a.errorString};for(let _ of this._resultReceiverSet)_.onDecodedBarcodesReceived&&a.barcodeResultItems&&_.onDecodedBarcodesReceived(Object.assign(Object.assign({},d),{barcodeResultItems:a.barcodeResultItems.filter(E=>!E.isFilter)})),_.onRecognizedTextLinesReceived&&a.textLineResultItems&&_.onRecognizedTextLinesReceived(Object.assign(Object.assign({},d),{textLineResultItems:a.textLineResultItems.filter(E=>!E.isFilter)})),_.onDetectedQuadsReceived&&a.detectedQuadResultItems&&_.onDetectedQuadsReceived(Object.assign(Object.assign({},d),{detectedQuadResultItems:a.detectedQuadResultItems.filter(E=>!E.isFilter)})),_.onNormalizedImagesReceived&&a.normalizedImageResultItems&&_.onNormalizedImagesReceived(Object.assign(Object.assign({},d),{normalizedImageResultItems:a.normalizedImageResultItems.filter(E=>!E.isFilter)})),_.onParsedResultsReceived&&a.parsedResultItems&&_.onParsedResultsReceived(Object.assign(Object.assign({},d),{parsedResultItems:a.parsedResultItems.filter(E=>!E.isFilter)})),_.onCapturedResultReceived&&!_.isDce&&(a.items=a.items.filter(E=>!E.isFilter),a.barcodeResultItems&&(a.barcodeResultItems=a.barcodeResultItems.filter(E=>!E.isFilter)),a.textLineResultItems&&(a.textLineResultItems=a.textLineResultItems.filter(E=>!E.isFilter)),a.detectedQuadResultItems&&(a.detectedQuadResultItems=a.detectedQuadResultItems.filter(E=>!E.isFilter)),a.normalizedImageResultItems&&(a.normalizedImageResultItems=a.normalizedImageResultItems.filter(E=>!E.isFilter)),a.parsedResultItems&&(a.parsedResultItems=a.parsedResultItems.filter(E=>!E.isFilter)),_.onCapturedResultReceived(a));const p=Date.now();if(this._minImageCaptureInterval>-1&&(this._averageProcessintTimeArray.length===5&&this._averageProcessintTimeArray.shift(),this._averageFetchImageTimeArray.length===5&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-r),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,Ve._onLog&&(Ve._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),Ve._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),Ve._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),Ve._onLog(`averageTime: ${this._averageTime}`))),Ve._onLog){const _=Date.now()-p;_>10&&Ve._onLog(`fetch image calculate time: ${_}`)}Ve._onLog&&Ve._onLog(`time finish decode: ${Date.now()}`),Ve._onLog&&Ve._onLog("main time: "+(Date.now()-r)),Ve._onLog&&Ve._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,0))}).catch(a=>{this._isa.stopFetching(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._isa.startFetching(),this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,1e3)),a.message!=="platform error"&&setTimeout(()=>{throw a},0)})}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},0)}async capture(e,r="Default"){this._checkIsDisposed();const a=await this.containsTask(r);let d;if(await zt(a),this._dynamsoft=!1,Xh(e))d=await this._captureDsimage(e,r);else if(typeof e=="string")d=e.substring(0,11)=="data:image/"?await this._captureBase64(e,r):await this._captureUrl(e,r);else if(e instanceof Blob)d=await this._captureBlob(e,r);else if(e instanceof HTMLImageElement)d=await this._captureImage(e,r);else if(e instanceof HTMLCanvasElement)d=await this._captureCanvas(e,r);else{if(!(e instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");d=await this._captureVideo(e,r)}return d}async _captureDsimage(e,r){return await this._captureInWorker(e,r)}async _captureUrl(e,r){let a=await al(e,"blob");return await this._captureBlob(a,r)}async _captureBase64(e,r){e=e.substring(e.indexOf(",")+1);let a=atob(e),d=a.length,p=new Uint8Array(d);for(;d--;)p[d]=a.charCodeAt(d);return await this._captureBlob(new Blob([p]),r)}async _captureBlob(e,r){let a=null,d=null;if(typeof createImageBitmap<"u")try{a=await createImageBitmap(e)}catch{}a||(d=await async function(_){return await new Promise((E,C)=>{let b=URL.createObjectURL(_),O=new Image;O.src=b,O.onload=()=>{URL.revokeObjectURL(O.dbrObjUrl),E(O)},O.onerror=M=>{C(new Error("Can't convert blob to image : "+(M instanceof Event?M.type:M)))}})}(e));let p=await this._captureImage(a||d,r);return a&&a.close(),p}async _captureImage(e,r){let a,d,p=e instanceof HTMLImageElement?e.naturalWidth:e.width,_=e instanceof HTMLImageElement?e.naturalHeight:e.height,E=Math.max(p,_);E>this.maxCvsSideLength?(this._compressRate=this.maxCvsSideLength/E,a=Math.round(p*this._compressRate),d=Math.round(_*this._compressRate)):(a=p,d=_),this._canvas||(this._canvas=document.createElement("canvas"));const C=this._canvas;return C.width===a&&C.height===d||(C.width=a,C.height=d),C.ctx2d||(C.ctx2d=C.getContext("2d",{willReadFrequently:!0})),C.ctx2d.drawImage(e,0,0,p,_,0,0,a,d),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),await this._captureCanvas(C,r)}async _captureCanvas(e,r){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");const a=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),d={bytes:Uint8Array.from(a.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:10};return await this._captureInWorker(d,r)}async _captureVideo(e,r){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";let a,d,p=e.videoWidth,_=e.videoHeight,E=Math.max(p,_);E>this.maxCvsSideLength?(this._compressRate=this.maxCvsSideLength/E,a=Math.round(p*this._compressRate),d=Math.round(_*this._compressRate)):(a=p,d=_),this._canvas||(this._canvas=document.createElement("canvas"));const C=this._canvas;return C.width===a&&C.height===d||(C.width=a,C.height=d),C.ctx2d||(C.ctx2d=C.getContext("2d",{willReadFrequently:!0})),C.ctx2d.drawImage(e,0,0,p,_,0,0,a,d),await this._captureCanvas(C,r)}async _captureInWorker(e,r){const{bytes:a,width:d,height:p,stride:_,format:E}=e;let C=$e();const b=new cr;return Ge[C]=async O=>{var M,k;if(!O.success){let V=new Error(O.message);return V.stack=O.stack+`
`+V.stack,b.reject(V)}{const V=Date.now();Ve._onLog&&(Ve._onLog(`get result time from worker: ${V}`),Ve._onLog("worker to main time consume: "+(V-O.workerReturnMsgTime)));try{const H=O.captureResult;e.bytes=O.bytes;for(let $ of H.items)this._compressRate!==0&&Cc($,this._compressRate),$.type===Se.CRIT_ORIGINAL_IMAGE?$.imageData=e:$.type===Se.CRIT_NORMALIZED_IMAGE?(M=yt.ddn)===null||M===void 0||M.handleNormalizedImageResultItem($):$.type===Se.CRIT_PARSED_RESULT&&((k=yt.dcp)===null||k===void 0||k.handleParsedResultItem($));if(this._dynamsoft)for(let $ of this._resultFilterSet)$.onDecodedBarcodesReceived(H.items),$.onRecognizedTextLinesReceived(H.items),$.onDetectedQuadsReceived(H.items),$.onNormalizedImagesReceived(H.items);const z=function($){const J={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return $.items.forEach(te=>{te.type===Se.CRIT_BARCODE?J.barcodeResultItems.push(te):te.type===Se.CRIT_TEXT_LINE?J.textLineResultItems.push(te):te.type===Se.CRIT_DETECTED_QUAD?J.detectedQuadResultItems.push(te):te.type===Se.CRIT_NORMALIZED_IMAGE?J.normalizedImageResultItems.push(te):te.type===Se.CRIT_PARSED_RESULT&&J.parsedResultItems.push(te)}),J}(H);z.barcodeResultItems.length&&(H.barcodeResultItems=z.barcodeResultItems),z.textLineResultItems.length&&(H.textLineResultItems=z.textLineResultItems),z.detectedQuadResultItems.length&&(H.detectedQuadResultItems=z.detectedQuadResultItems),z.normalizedImageResultItems.length&&(H.normalizedImageResultItems=z.normalizedImageResultItems),z.parsedResultItems.length&&(H.parsedResultItems=z.parsedResultItems);const Z=H.intermediateResult;if(Z){let $=0;for(let J of this._intermediateResultReceiverSet){$++;for(let te of Z){if(te.info.callbackName==="onTaskResultsReceived"){for(let he of te.intermediateResultUnits)he.originalImageTag=e.tag?e.tag:null;J[te.info.callbackName]&&J[te.info.callbackName]({intermediateResultUnits:te.intermediateResultUnits},te.info)}else J[te.info.callbackName]&&J[te.info.callbackName](te.result,te.info);$===this._intermediateResultReceiverSet.size&&delete te.info.callbackName}}}return H&&H.intermediateResult&&delete H.intermediateResult,this._compressRate=0,b.resolve(H)}catch(H){return b.reject(H)}}},Ve._onLog&&Ve._onLog(`send buffer to worker: ${Date.now()}`),je.postMessage({type:"cvr_capture",id:C,instanceID:this._instanceID,body:{bytes:a,width:d,height:p,stride:_,format:E,templateName:r||"",dynamsoft:this._dynamsoft}},[a.buffer]),b}async initSettings(e){return this._checkIsDisposed(),e&&["string","object"].includes(typeof e)?(typeof e=="string"?e.startsWith("{")?this._currentSettings=JSON.parse(e):e=await al(e,"text"):typeof e=="object"&&(this._currentSettings=e,e=JSON.stringify(e)),await new Promise((r,a)=>{let d=$e();Ge[d]=async p=>{if(p.success){const _=JSON.parse(p.response);if(_.exception!==0){let b=new Error(_.description?_.description:"Init Settings Failed.");return b.errorCode=_.exception,a(b)}let E=[],C=JSON.parse(e).CaptureVisionTemplates;for(let b=0;b<C.length;b++){let O=await this.containsTask(C[b].Name);E=E.concat(O)}return await zt([...new Set(E)]),this._bNeedOutputOriginalImage=this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage===1,r(_)}{let _=new Error(p.message);return _.stack=p.stack+`
`+_.stack,a(_)}},je.postMessage({type:"cvr_initSettings",id:d,instanceID:this._instanceID,body:{settings:e}})})):console.error("Invalid template.")}async outputSettings(e){return this._checkIsDisposed(),await new Promise((r,a)=>{let d=$e();Ge[d]=async p=>{if(p.success){const _=JSON.parse(p.settings);if(_.errorCode!==0){let E=new Error(_.errorString);return E.errorCode=_.errorCode,a(E)}return delete _.errorCode,delete _.errorString,r(_)}{let _=new Error(p.message);return _.stack=p.stack+`
`+_.stack,a(_)}},je.postMessage({type:"cvr_outputSettings",id:d,instanceID:this._instanceID,body:{templateName:e||"Default"}})})}async outputSettingsToFile(e,r,a){const d=await this.outputSettings(e),p=new Blob([JSON.stringify(d,null,2,function(_,E){return E instanceof Array?JSON.stringify(E):E},2)],{type:"application/json"});if(a){const _=document.createElement("a");_.href=URL.createObjectURL(p),r.endsWith(".json")&&(r=r.replace(".json","")),_.download=`${r}.json`,_.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(_.href)},500)},_.click()}return p}async getSimplifiedSettings(e="Default"){this._checkIsDisposed();const r=await this.containsTask(e);return await zt(r),await new Promise((a,d)=>{let p=$e();Ge[p]=async _=>{if(_.success){const E=JSON.parse(_.settings,(C,b)=>Qd&&C==="barcodeFormatIds"?BigInt(b):b);if(E.minImageCaptureInterval=this._minImageCaptureInterval,E.code!==0){let C=new Error(E.codeString);return C.errorCode=E.errorCode,d(C)}return delete E.code,delete E.codeString,a(E)}{let E=new Error(_.message);return E.stack=_.stack+`
`+E.stack,d(E)}},je.postMessage({type:"cvr_getSimplifiedSettings",id:p,instanceID:this._instanceID,body:{templateName:e}})})}async updateSettings(e,r){this._checkIsDisposed();const a=await this.containsTask(e);return await zt(a),await new Promise((d,p)=>{let _=$e();Ge[_]=async E=>{if(E.success){const C=JSON.parse(E.response);if(r.minImageCaptureInterval&&r.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=r.minImageCaptureInterval),this._bNeedOutputOriginalImage=E.bNeedOutputOriginalImage,C.exception!==0){let b=new Error(C.description?C.description:"Update Settings Failed.");return b.errorCode=C.exception,p(b)}return this._currentSettings=await this.outputSettings("*"),d(C)}{let C=new Error(E.message);return C.stack=E.stack+`
`+C.stack,p(C)}},je.postMessage({type:"cvr_updateSettings",id:_,instanceID:this._instanceID,body:{settings:r,templateName:e}})})}async resetSettings(){return this._checkIsDisposed(),await new Promise((e,r)=>{let a=$e();Ge[a]=async d=>{if(d.success){const p=JSON.parse(d.response);if(p.exception!==0){let _=new Error(p.description?p.description:"Reset Settings Failed.");return _.errorCode=p.exception,r(_)}return this._currentSettings=await this.outputSettings("*"),e(p)}{let p=new Error(d.message);return p.stack=d.stack+`
`+p.stack,r(p)}},je.postMessage({type:"cvr_resetSettings",id:a,instanceID:this._instanceID})})}getIntermediateResultManager(e){if(this._checkIsDisposed(),!e&&tt.bSupportIRTModule!==0)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new Cf,this._intermediateResultManager.addResultReceiver=async r=>{if(typeof r!="object")throw new Error("Invalid receiver.");this._intermediateResultReceiverSet.add(r),this._handleIntermediateResultReceiver();let a=-1,d={};if(!r.isDce){if(!r._observedResultUnitTypes||!r._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");a=r._observedResultUnitTypes,r._observedTaskMap.forEach((p,_)=>{d[_]=p}),r._observedTaskMap.clear()}return await(async()=>await new Promise((p,_)=>{let E=$e();Ge[E]=async C=>{if(C.success)return p();{let b=new Error(C.message);return b.stack=C.stack+`
`+b.stack,_(b)}},je.postMessage({type:"cvr_setIrrRegistry",id:E,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:String(a),observedTaskMap:d}})}))()},this._intermediateResultManager.removeResultReceiver=async r=>(this._intermediateResultReceiverSet.delete(r),this._handleIntermediateResultReceiver(),await new Promise((a,d)=>{let p=$e();Ge[p]=async _=>{if(_.success)return a();{let E=new Error(_.message);return E.stack=_.stack+`
`+E.stack,d(E)}},je.postMessage({type:"cvr_setIrrRegistry",id:p,instanceID:this._instanceID,body:{receiverObj:this._irrRegistryState}})})),this._intermediateResultManager.getOriginalImage=()=>this._dsImage),this._intermediateResultManager}_handleIntermediateResultReceiver(){for(let e in this._irrRegistryState)this._irrRegistryState[e]=!1;for(let e of this._intermediateResultReceiverSet)if(e.isDce)this._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let r in e)this._irrRegistryState[r]||(this._irrRegistryState[r]=!!e[r])}contains(e,r){return function(a,d){let p=d.x,_=d.y,E=a[0].x,C=a[0].y,b=a[1].x,O=a[1].y,M=a[2].x,k=a[2].y,V=a[3].x,H=a[3].y,z=te(p,_,E,C,b,O),Z=te(p,_,b,O,M,k),$=te(p,_,M,k,V,H),J=te(p,_,V,H,E,C);function te(he,ce,ue,be,v,pe){return(he-ue)*(pe-be)-(ce-be)*(v-ue)}return z>=0&&Z>=0&&$>=0&&J>=0||z<=0&&Z<=0&&$<=0&&J<=0}(e,r)}async parseRequiredResources(e){return this._checkIsDisposed(),await new Promise((r,a)=>{let d=$e();Ge[d]=async p=>{if(p.success)return r(JSON.parse(p.resources));{let _=new Error(p.message);return _.stack=p.stack+`
`+_.stack,a(_)}},je.postMessage({type:"cvr_parseRequiredResources",id:d,instanceID:this._instanceID,body:{templateName:e}})})}async dispose(){this._checkIsDisposed(),this._promiseStartScan&&this.stopCapturing(),this._isa=null,this._resultReceiverSet.clear(),this._isaStateListenerSet.clear(),this._resultFilterSet.clear(),this.bDestroyed=!0;let e=$e();Ge[e]=r=>{if(!r.success){let a=new Error(r.message);throw a.stack=r.stack+`
`+a.stack,a}},je.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})}async _enableResultCrossVerification(e){return this._checkIsDisposed(),await new Promise((r,a)=>{let d=$e();Ge[d]=async p=>{if(p.success)return r(p.result);{let _=new Error(p.message);return _.stack=p.stack+`
`+_.stack,a(_)}},je.postMessage({type:"cvr_enableResultCrossVerification",id:d,instanceID:this._instanceID,body:{verificationEnabled:e}})})}async _enableResultDeduplication(e){return this._checkIsDisposed(),await new Promise((r,a)=>{let d=$e();Ge[d]=async p=>{if(p.success)return r(p.result);{let _=new Error(p.message);return _.stack=p.stack+`
`+_.stack,a(_)}},je.postMessage({type:"cvr_enableResultDeduplication",id:d,instanceID:this._instanceID,body:{duplicateFilterEnabled:e}})})}async _setDuplicateForgetTime(e){return this._checkIsDisposed(),await new Promise((r,a)=>{let d=$e();Ge[d]=async p=>{if(p.success)return r(p.result);{let _=new Error(p.message);return _.stack=p.stack+`
`+_.stack,a(_)}},je.postMessage({type:"cvr_setDuplicateForgetTime",id:d,instanceID:this._instanceID,body:{duplicateForgetTime:e}})})}async _getDuplicateForgetTime(e){return this._checkIsDisposed(),await new Promise((r,a)=>{let d=$e();Ge[d]=async p=>{if(p.success)return r(p.time);{let _=new Error(p.message);return _.stack=p.stack+`
`+_.stack,a(_)}},je.postMessage({type:"cvr_getDuplicateForgetTime",id:d,instanceID:this._instanceID,body:{type:e}})})}async _setThresholdValue(e,r,a){return await zt("ddn"),await new Promise((d,p)=>{let _=$e();Ge[_]=async E=>{if(E.success)return d();{let C=new Error(E.message);return C.stack=E.stack+`
`+C.stack,p(C)}},je.postMessage({type:"ddn_setThresholdValue",id:_,instanceID:this._instanceID,body:{threshold:e,leftLimit:r,rightLimit:a}})})}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}}/*!
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Utility JS Edition
 * @website https://www.dynamsoft.com
 * @copyright Copyright 2024, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 1.2.10
 * @fileoverview Dynamsoft JavaScript Library for Core
 * More info DU JS: https://www.dynamsoft.com/capture-vision/docs/web/programming/javascript/api-reference/utility/utility-module.html
 */const Fs={barcode:2,text_line:4,detected_quad:8,normalized_image:16},ur=t=>Object.values(Fs).includes(t)||Fs.hasOwnProperty(t),_o=(t,e)=>typeof t=="string"?e[Fs[t]]:e[t],vo=(t,e,r)=>{typeof t=="string"?e[Fs[t]]=r:e[t]=r};class Sf{constructor(){this.verificationEnabled={[Se.CRIT_BARCODE]:!1,[Se.CRIT_TEXT_LINE]:!0,[Se.CRIT_DETECTED_QUAD]:!0,[Se.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[Se.CRIT_BARCODE]:!1,[Se.CRIT_TEXT_LINE]:!1,[Se.CRIT_DETECTED_QUAD]:!1,[Se.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[Se.CRIT_BARCODE]:3e3,[Se.CRIT_TEXT_LINE]:3e3,[Se.CRIT_DETECTED_QUAD]:3e3,[Se.CRIT_NORMALIZED_IMAGE]:3e3}}enableResultCrossVerification(e,r){ur(e)&&vo(e,this.verificationEnabled,r)}isResultCrossVerificationEnabled(e){return!!ur(e)&&_o(e,this.verificationEnabled)}enableResultDeduplication(e,r){ur(e)&&vo(e,this.duplicateFilterEnabled,r)}isResultDeduplicationEnabled(e){return!!ur(e)&&_o(e,this.duplicateFilterEnabled)}setDuplicateForgetTime(e,r){ur(e)&&(r>18e4&&(r=18e4),r<0&&(r=0),vo(e,this.duplicateForgetTime,r))}getDuplicateForgetTime(e){return ur(e)?_o(e,this.duplicateForgetTime):-1}getFilteredResultItemTypes(){let e=0;const r=[Se.CRIT_BARCODE,Se.CRIT_TEXT_LINE,Se.CRIT_DETECTED_QUAD];for(let a=0;a<r.length;a++)(this.verificationEnabled[r[a]]||this.duplicateFilterEnabled[r[a]])&&(e|=r[a]);return e}onOriginalImageResultReceived(e){}onDecodedBarcodesReceived(e){if(this.isResultCrossVerificationEnabled(Se.CRIT_BARCODE))for(let r=0;r<e.length;r++)e[r]&&e[r].type===Se.CRIT_BARCODE&&!e[r].verified&&(e[r].isFilter=!0);if(this.isResultDeduplicationEnabled(Se.CRIT_BARCODE))for(let r=0;r<e.length;r++)e[r]&&e[r].type===Se.CRIT_BARCODE&&e[r].duplicate&&(e[r].isFilter=!0)}onRecognizedTextLinesReceived(e){if(this.isResultCrossVerificationEnabled(Se.CRIT_TEXT_LINE))for(let r=0;r<e.length;r++)e[r]&&e[r].type===Se.CRIT_TEXT_LINE&&!e[r].verified&&(e[r].isFilter=!0);if(this.isResultDeduplicationEnabled(Se.CRIT_TEXT_LINE))for(let r=0;r<e.length;r++)e[r]&&e[r].type===Se.CRIT_TEXT_LINE&&e[r].duplicate&&(e[r].isFilter=!0)}onDetectedQuadsReceived(e){if(this.isResultCrossVerificationEnabled(Se.CRIT_DETECTED_QUAD))for(let r=0;r<e.length;r++)e[r]&&e[r].type===Se.CRIT_DETECTED_QUAD&&!e[r].verified&&(e[r].isFilter=!0);if(this.isResultDeduplicationEnabled(Se.CRIT_DETECTED_QUAD))for(let r=0;r<e.length;r++)e[r]&&e[r].type===Se.CRIT_DETECTED_QUAD&&e[r].duplicate&&(e[r].isFilter=!0)}onNormalizedImagesReceived(e){if(this.isResultCrossVerificationEnabled(Se.CRIT_NORMALIZED_IMAGE))for(let r=0;r<e.length;r++)e[r]&&e[r].type===Se.CRIT_NORMALIZED_IMAGE&&!e[r].verified&&(e[r].isFilter=!0);if(this.isResultDeduplicationEnabled(Se.CRIT_NORMALIZED_IMAGE))for(let r=0;r<e.length;r++)e[r]&&e[r].type===Se.CRIT_NORMALIZED_IMAGE&&e[r].duplicate&&(e[r].isFilter=!0)}}const bf=t=>(yh("data-v-e92e58ce"),t=t(),Eh(),t),Tf=bf(()=>bt("br",null,null,-1)),vi="videoCapture component destoryed",If=da({__name:"VideoCapture",setup(t){const e=Es(null),r=Es(null);let a;const d=new Promise(C=>{a=C});let p=!1,_,E;return Th(async()=>{try{const C=await et.createInstance();if(p||(E=await Oe.createInstance(C),p)||(e.value.append(C.getUIElement()),_=await Ve.createInstance(),p))throw Error(vi);_.setInput(E),_.addResultReceiver({onDecodedBarcodesReceived:O=>{if(O.barcodeResultItems.length){r.value.textContent="",console.log(O);for(let M of O.barcodeResultItems)r.value.append(`${M.formatString}: ${M.text}`,document.createElement("br"),document.createElement("hr"))}}});const b=new Sf;if(b.enableResultCrossVerification("barcode",!0),b.enableResultDeduplication("barcode",!0),await _.addResultFilter(b),p||(await E.open(),p)||(await _.startCapturing("ReadSingleBarcode"),p))throw Error(vi)}catch(C){if((C==null?void 0:C.message)===vi)console.log(vi);else{let b=C.message||C;console.error(b),alert(b)}}a()}),fa(async()=>{p=!0;try{await d,_==null||_.dispose(),E==null||E.dispose()}catch{}}),(C,b)=>(yn(),ma("div",null,[bt("div",{ref_key:"uiContainer",ref:e,class:"div-ui-container"},null,512),Vh(" Results:"),Tf,bt("div",{ref_key:"resultsContainer",ref:r,class:"div-results-container"},null,512)]))}});const xa=(t,e)=>{const r=t.__vccOpts||t;for(const[a,d]of e)r[a]=d;return r},xf=xa(If,[["__scopeId","data-v-e92e58ce"]]),Af={class:"capture-img"},Of={class:"img-ipt"},Rf=da({__name:"ImageCapture",setup(t){const e=Es(null);let r,a=!1;const d=async p=>{let _=[...p.target.files];p.target.value="",e.value.innerText="";try{const E=await(r=r||Ve.createInstance());if(a)return;for(let C of _){const b=await E.capture(C,"ReadBarcodes_SpeedFirst");if(a)return;_.length>1&&(e.value.innerText+=`
${C.name}:
`);for(let O of b.items){if(O.type!==Se.CRIT_BARCODE)continue;let M=O;e.value.innerText+=M.text+`
`,console.log(M.text)}b.items.length||(e.value.innerText+=`No barcode found
`)}}catch(E){let C=E.message||E;console.error(C),alert(C)}};return fa(async()=>{if(a=!0,r)try{(await r).dispose()}catch{}}),(p,_)=>(yn(),ma("div",Af,[bt("div",Of,[bt("input",{type:"file",multiple:"",onChange:d,accept:".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"},null,32)]),bt("div",{class:"result-area",ref_key:"resDiv",ref:e},null,512)]))}});const Df=xa(Rf,[["__scopeId","data-v-ea9202f8"]]),Lf=t=>(yh("data-v-4cb3db5f"),t=t(),Eh(),t),Mf={class:"App"},Ff={class:"title"},Pf=Lf(()=>bt("h2",{class:"title-text"},"Hello World for Vue",-1)),kf=["src"],Nf={class:"top-btns"},Bf=da({__name:"App",setup(t){const e=Es("video");return(r,a)=>(yn(),ma("div",Mf,[bt("div",Ff,[Pf,bt("img",{class:"title-logo",src:dh(zd),alt:"logo"},null,8,kf)]),bt("div",Nf,[bt("button",{onClick:a[0]||(a[0]=d=>e.value="video"),style:wn({backgroundColor:e.value==="video"?"rgb(255, 174, 55)":"#FFFFFF"})},"Video Capture",4),bt("button",{onClick:a[1]||(a[1]=d=>e.value="image"),style:wn({backgroundColor:e.value==="image"?"rgb(255, 174, 55)":"#FFFFFF"})},"Image Capture",4)]),e.value==="video"?(yn(),Ka(xf,{key:0})):(yn(),Ka(Df,{key:1}))]))}});const jf=xa(Bf,[["__scopeId","data-v-4cb3db5f"]]);Hd(jf).mount("#app");
