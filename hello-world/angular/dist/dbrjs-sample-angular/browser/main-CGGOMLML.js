var xp=Object.defineProperty,Ap=Object.defineProperties;var Mp=Object.getOwnPropertyDescriptors;var Uu=Object.getOwnPropertySymbols;var Rp=Object.prototype.hasOwnProperty,Op=Object.prototype.propertyIsEnumerable;var Vu=(t,e,n)=>e in t?xp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,jn=(t,e)=>{for(var n in e||={})Rp.call(e,n)&&Vu(t,n,e[n]);if(Uu)for(var n of Uu(e))Op.call(e,n)&&Vu(t,n,e[n]);return t},li=(t,e)=>Ap(t,Mp(e));var z=(t,e,n)=>new Promise((i,o)=>{var h=w=>{try{v(n.next(w))}catch(I){o(I)}},p=w=>{try{v(n.throw(w))}catch(I){o(I)}},v=w=>w.done?i(w.value):Promise.resolve(w.value).then(h,p);v((n=n.apply(t,e)).next())});var Gu=null;var Ta=1,Hu=Symbol("SIGNAL");function Ve(t){let e=Gu;return Gu=t,e}var Wu={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Lp(t){if(!(Aa(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===Ta)){if(!t.producerMustRecompute(t)&&!Sa(t)){t.dirty=!1,t.lastCleanEpoch=Ta;return}t.producerRecomputeValue(t),t.dirty=!1,t.lastCleanEpoch=Ta}}function Yu(t){return t&&(t.nextProducerIndex=0),Ve(t)}function zu(t,e){if(Ve(e),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(Aa(t))for(let n=t.nextProducerIndex;n<t.producerNode.length;n++)xa(t.producerNode[n],t.producerIndexOfThis[n]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function Sa(t){Us(t);for(let e=0;e<t.producerNode.length;e++){let n=t.producerNode[e],i=t.producerLastReadVersion[e];if(i!==n.version||(Lp(n),i!==n.version))return!0}return!1}function $u(t){if(Us(t),Aa(t))for(let e=0;e<t.producerNode.length;e++)xa(t.producerNode[e],t.producerIndexOfThis[e]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function xa(t,e){if(Fp(t),Us(t),t.liveConsumerNode.length===1)for(let i=0;i<t.producerNode.length;i++)xa(t.producerNode[i],t.producerIndexOfThis[i]);let n=t.liveConsumerNode.length-1;if(t.liveConsumerNode[e]=t.liveConsumerNode[n],t.liveConsumerIndexOfThis[e]=t.liveConsumerIndexOfThis[n],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,e<t.liveConsumerNode.length){let i=t.liveConsumerIndexOfThis[e],o=t.liveConsumerNode[e];Us(o),o.producerIndexOfThis[i]=e}}function Aa(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Us(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function Fp(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function Np(){throw new Error}var Pp=Np;function Xu(t){Pp=t}function wt(t){return typeof t=="function"}function Vs(t){let n=t(i=>{Error.call(i),i.stack=new Error().stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}var Gs=Vs(t=>function(n){t(this),this.message=n?`${n.length} errors occurred during unsubscription:
${n.map((i,o)=>`${o+1}) ${i.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=n});function Ar(t,e){if(t){let n=t.indexOf(e);0<=n&&t.splice(n,1)}}var Et=class t{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;let{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(let h of n)h.remove(this);else n.remove(this);let{initialTeardown:i}=this;if(wt(i))try{i()}catch(h){e=h instanceof Gs?h.errors:[h]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let h of o)try{qu(h)}catch(p){e=e??[],p instanceof Gs?e=[...e,...p.errors]:e.push(p)}}if(e)throw new Gs(e)}}add(e){var n;if(e&&e!==this)if(this.closed)qu(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=(n=this._finalizers)!==null&&n!==void 0?n:[]).push(e)}}_hasParent(e){let{_parentage:n}=this;return n===e||Array.isArray(n)&&n.includes(e)}_addParent(e){let{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(e),n):n?[n,e]:e}_removeParent(e){let{_parentage:n}=this;n===e?this._parentage=null:Array.isArray(n)&&Ar(n,e)}remove(e){let{_finalizers:n}=this;n&&Ar(n,e),e instanceof t&&e._removeParent(this)}};Et.EMPTY=(()=>{let t=new Et;return t.closed=!0,t})();var Ma=Et.EMPTY;function Hs(t){return t instanceof Et||t&&"closed"in t&&wt(t.remove)&&wt(t.add)&&wt(t.unsubscribe)}function qu(t){wt(t)?t():t.unsubscribe()}var Ut={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Ni={setTimeout(t,e,...n){let{delegate:i}=Ni;return i?.setTimeout?i.setTimeout(t,e,...n):setTimeout(t,e,...n)},clearTimeout(t){let{delegate:e}=Ni;return(e?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Zu(t){Ni.setTimeout(()=>{let{onUnhandledError:e}=Ut;if(e)e(t);else throw t})}function Ra(){}var Qu=Oa("C",void 0,void 0);function Ku(t){return Oa("E",void 0,t)}function Ju(t){return Oa("N",t,void 0)}function Oa(t,e,n){return{kind:t,value:e,error:n}}var ci=null;function Pi(t){if(Ut.useDeprecatedSynchronousErrorHandling){let e=!ci;if(e&&(ci={errorThrown:!1,error:null}),t(),e){let{errorThrown:n,error:i}=ci;if(ci=null,n)throw i}}else t()}function eh(t){Ut.useDeprecatedSynchronousErrorHandling&&ci&&(ci.errorThrown=!0,ci.error=t)}var ui=class extends Et{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,Hs(e)&&e.add(this)):this.destination=jp}static create(e,n,i){return new ki(e,n,i)}next(e){this.isStopped?Fa(Ju(e),this):this._next(e)}error(e){this.isStopped?Fa(Ku(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Fa(Qu,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},kp=Function.prototype.bind;function La(t,e){return kp.call(t,e)}var Na=class{constructor(e){this.partialObserver=e}next(e){let{partialObserver:n}=this;if(n.next)try{n.next(e)}catch(i){Ws(i)}}error(e){let{partialObserver:n}=this;if(n.error)try{n.error(e)}catch(i){Ws(i)}else Ws(e)}complete(){let{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(n){Ws(n)}}},ki=class extends ui{constructor(e,n,i){super();let o;if(wt(e)||!e)o={next:e??void 0,error:n??void 0,complete:i??void 0};else{let h;this&&Ut.useDeprecatedNextContext?(h=Object.create(e),h.unsubscribe=()=>this.unsubscribe(),o={next:e.next&&La(e.next,h),error:e.error&&La(e.error,h),complete:e.complete&&La(e.complete,h)}):o=e}this.destination=new Na(o)}};function Ws(t){Ut.useDeprecatedSynchronousErrorHandling?eh(t):Zu(t)}function Bp(t){throw t}function Fa(t,e){let{onStoppedNotification:n}=Ut;n&&Ni.setTimeout(()=>n(t,e))}var jp={closed:!0,next:Ra,error:Bp,complete:Ra};var th=typeof Symbol=="function"&&Symbol.observable||"@@observable";function nh(t){return t}function ih(t){return t.length===0?nh:t.length===1?t[0]:function(n){return t.reduce((i,o)=>o(i),n)}}var Pa=(()=>{class t{constructor(n){n&&(this._subscribe=n)}lift(n){let i=new t;return i.source=this,i.operator=n,i}subscribe(n,i,o){let h=Vp(n)?n:new ki(n,i,o);return Pi(()=>{let{operator:p,source:v}=this;h.add(p?p.call(h,v):v?this._subscribe(h):this._trySubscribe(h))}),h}_trySubscribe(n){try{return this._subscribe(n)}catch(i){n.error(i)}}forEach(n,i){return i=rh(i),new i((o,h)=>{let p=new ki({next:v=>{try{n(v)}catch(w){h(w),p.unsubscribe()}},error:h,complete:o});this.subscribe(p)})}_subscribe(n){var i;return(i=this.source)===null||i===void 0?void 0:i.subscribe(n)}[th](){return this}pipe(...n){return ih(n)(this)}toPromise(n){return n=rh(n),new n((i,o)=>{let h;this.subscribe(p=>h=p,p=>o(p),()=>i(h))})}}return t.create=e=>new t(e),t})();function rh(t){var e;return(e=t??Ut.Promise)!==null&&e!==void 0?e:Promise}function Up(t){return t&&wt(t.next)&&wt(t.error)&&wt(t.complete)}function Vp(t){return t&&t instanceof ui||Up(t)&&Hs(t)}function Gp(t){return wt(t?.lift)}function sh(t){return e=>{if(Gp(e))return e.lift(function(n){try{return t(n,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function oh(t,e,n,i,o){return new ka(t,e,n,i,o)}var ka=class extends ui{constructor(e,n,i,o,h,p){super(e),this.onFinalize=h,this.shouldUnsubscribe=p,this._next=n?function(v){try{n(v)}catch(w){e.error(w)}}:super._next,this._error=o?function(v){try{o(v)}catch(w){e.error(w)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(v){e.error(v)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:n}=this;super.unsubscribe(),!n&&((e=this.onFinalize)===null||e===void 0||e.call(this))}}};var ah=Vs(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Un=(()=>{class t extends Pa{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){let i=new Ys(this,this);return i.operator=n,i}_throwIfClosed(){if(this.closed)throw new ah}next(n){Pi(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let i of this.currentObservers)i.next(n)}})}error(n){Pi(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;let{observers:i}=this;for(;i.length;)i.shift().error(n)}})}complete(){Pi(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return((n=this.observers)===null||n===void 0?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){let{hasError:i,isStopped:o,observers:h}=this;return i||o?Ma:(this.currentObservers=null,h.push(n),new Et(()=>{this.currentObservers=null,Ar(h,n)}))}_checkFinalizedStatuses(n){let{hasError:i,thrownError:o,isStopped:h}=this;i?n.error(o):h&&n.complete()}asObservable(){let n=new Pa;return n.source=this,n}}return t.create=(e,n)=>new Ys(e,n),t})(),Ys=class extends Un{constructor(e,n){super(),this.destination=e,this.source=n}next(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,e)}error(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,e)}complete(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)}_subscribe(e){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&i!==void 0?i:Ma}};var Mr=class extends Un{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){let n=super._subscribe(e);return!n.closed&&e.next(this._value),n}getValue(){let{hasError:e,thrownError:n,_value:i}=this;if(e)throw n;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}};function Ba(t,e){return sh((n,i)=>{let o=0;n.subscribe(oh(i,h=>{i.next(t.call(e,h,o++))}))})}var He=class extends Error{constructor(e,n){super(Nl(e,n)),this.code=e}};function Nl(t,e){return`${`NG0${Math.abs(t)}`}${e?": "+e:""}`}function Pl(t){return{toString:t}.toString()}var zs="__parameters__";function Hp(t){return function(...n){if(t){let i=t(...n);for(let o in i)this[o]=i[o]}}}function Vh(t,e,n){return Pl(()=>{let i=Hp(e);function o(...h){if(this instanceof o)return i.apply(this,h),this;let p=new o(...h);return v.annotation=p,v;function v(w,I,S){let x=w.hasOwnProperty(zs)?w[zs]:Object.defineProperty(w,zs,{value:[]})[zs];for(;x.length<=S;)x.push(null);return(x[S]=x[S]||[]).push(p),w}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}var Rr=globalThis;function Ze(t){for(let e in t)if(t[e]===Ze)return e;throw Error("Could not find renamed property on target object.")}function Ht(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map(Ht).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let e=t.toString();if(e==null)return""+e;let n=e.indexOf(`
`);return n===-1?e:e.substring(0,n)}function lh(t,e){return t==null||t===""?e===null?"":e:e==null||e===""?t:t+" "+e}var Wp=Ze({__forward_ref__:Ze});function Gh(t){return t.__forward_ref__=Gh,t.toString=function(){return Ht(this())},t}function Gt(t){return Yp(t)?t():t}function Yp(t){return typeof t=="function"&&t.hasOwnProperty(Wp)&&t.__forward_ref__===Gh}function ot(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function kl(t){return ch(t,Hh)||ch(t,Wh)}function ch(t,e){return t.hasOwnProperty(e)?t[e]:null}function zp(t){let e=t&&(t[Hh]||t[Wh]);return e||null}function uh(t){return t&&(t.hasOwnProperty(hh)||t.hasOwnProperty($p))?t[hh]:null}var Hh=Ze({\u0275prov:Ze}),hh=Ze({\u0275inj:Ze}),Wh=Ze({ngInjectableDef:Ze}),$p=Ze({ngInjectorDef:Ze}),Ke=class{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof n=="number"?this.__NG_ELEMENT_ID__=n:n!==void 0&&(this.\u0275prov=ot({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function Yh(t){return t&&!!t.\u0275providers}var Xp=Ze({\u0275cmp:Ze}),qp=Ze({\u0275dir:Ze}),Zp=Ze({\u0275pipe:Ze});var dh=Ze({\u0275fac:Ze}),Or=Ze({__NG_ELEMENT_ID__:Ze}),fh=Ze({__NG_ENV_ID__:Ze});function Qp(t){return typeof t=="string"?t:t==null?"":String(t)}function Kp(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():Qp(t)}function Jp(t,e){let n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new He(-200,t)}function Bl(t,e){throw new He(-201,!1)}var Be=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(Be||{}),qa;function zh(){return qa}function rn(t){let e=qa;return qa=t,e}function $h(t,e,n){let i=kl(t);if(i&&i.providedIn=="root")return i.value===void 0?i.value=i.factory():i.value;if(n&Be.Optional)return null;if(e!==void 0)return e;Bl(t,"Injector")}var em={},Lr=em,Za="__NG_DI_FLAG__",Js="ngTempTokenPath",tm="ngTokenPath",nm=/\n/gm,im="\u0275",gh="__source",Hi;function rm(){return Hi}function Bi(t){let e=Hi;return Hi=t,e}function sm(t,e=Be.Default){if(Hi===void 0)throw new He(-203,!1);return Hi===null?$h(t,void 0,e):Hi.get(t,e&Be.Optional?null:void 0,e)}function Xe(t,e=Be.Default){return(zh()||sm)(Gt(t),e)}function ut(t,e=Be.Default){return Xe(t,mo(e))}function mo(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function Qa(t){let e=[];for(let n=0;n<t.length;n++){let i=Gt(t[n]);if(Array.isArray(i)){if(i.length===0)throw new He(900,!1);let o,h=Be.Default;for(let p=0;p<i.length;p++){let v=i[p],w=om(v);typeof w=="number"?w===-1?o=v.token:h|=w:o=v}e.push(Xe(o,h))}else e.push(Xe(i))}return e}function Xh(t,e){return t[Za]=e,t.prototype[Za]=e,t}function om(t){return t[Za]}function am(t,e,n,i){let o=t[Js];throw e[gh]&&o.unshift(e[gh]),t.message=lm(`
`+t.message,o,n,i),t[tm]=o,t[Js]=null,t}function lm(t,e,n,i=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==im?t.slice(2):t;let o=Ht(e);if(Array.isArray(e))o=e.map(Ht).join(" -> ");else if(typeof e=="object"){let h=[];for(let p in e)if(e.hasOwnProperty(p)){let v=e[p];h.push(p+":"+(typeof v=="string"?JSON.stringify(v):Ht(v)))}o=`{${h.join(", ")}}`}return`${n}${i?"("+i+")":""}[${o}]: ${t.replace(nm,`
  `)}`}var qh=Xh(Vh("Optional"),8);var cm=Xh(Vh("SkipSelf"),4);function Fr(t,e){let n=t.hasOwnProperty(dh);return n?t[dh]:null}function um(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){let o=t[i],h=e[i];if(n&&(o=n(o),h=n(h)),h!==o)return!1}return!0}function hm(t){return t.flat(Number.POSITIVE_INFINITY)}function jl(t,e){t.forEach(n=>Array.isArray(n)?jl(n,e):e(n))}function Zh(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function eo(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}var Nr={},Yi=[],Pr=new Ke(""),Qh=new Ke("",-1),Kh=new Ke(""),to=class{get(e,n=Lr){if(n===Lr){let i=new Error(`NullInjectorError: No provider for ${Ht(e)}!`);throw i.name="NullInjectorError",i}return n}},Jh=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(Jh||{}),an=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(an||{}),fi=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(fi||{});function dm(t,e,n){let i=t.length;for(;;){let o=t.indexOf(e,n);if(o===-1)return o;if(o===0||t.charCodeAt(o-1)<=32){let h=e.length;if(o+h===i||t.charCodeAt(o+h)<=32)return o}n=o+1}}function Ka(t,e,n){let i=0;for(;i<n.length;){let o=n[i];if(typeof o=="number"){if(o!==0)break;i++;let h=n[i++],p=n[i++],v=n[i++];t.setAttribute(e,p,v,h)}else{let h=o,p=n[++i];gm(h)?t.setProperty(e,h,p):t.setAttribute(e,h,p),i++}}return i}function fm(t){return t===3||t===4||t===6}function gm(t){return t.charCodeAt(0)===64}function Ul(t,e){if(!(e===null||e.length===0))if(t===null||t.length===0)t=e.slice();else{let n=-1;for(let i=0;i<e.length;i++){let o=e[i];typeof o=="number"?n=o:n===0||(n===-1||n===2?ph(t,n,o,null,e[++i]):ph(t,n,o,null,null))}}return t}function ph(t,e,n,i,o){let h=0,p=t.length;if(e===-1)p=-1;else for(;h<t.length;){let v=t[h++];if(typeof v=="number"){if(v===e){p=-1;break}else if(v>e){p=h-1;break}}}for(;h<t.length;){let v=t[h];if(typeof v=="number")break;if(v===n){if(i===null){o!==null&&(t[h+1]=o);return}else if(i===t[h+1]){t[h+2]=o;return}}h++,i!==null&&h++,o!==null&&h++}p!==-1&&(t.splice(p,0,e),h=p+1),t.splice(h++,0,n),i!==null&&t.splice(h++,0,i),o!==null&&t.splice(h++,0,o)}var ed="ng-template";function pm(t,e,n,i){let o=0;if(i){for(;o<e.length&&typeof e[o]=="string";o+=2)if(e[o]==="class"&&dm(e[o+1].toLowerCase(),n,0)!==-1)return!0}else if(Vl(t))return!1;if(o=e.indexOf(1,o),o>-1){let h;for(;++o<e.length&&typeof(h=e[o])=="string";)if(h.toLowerCase()===n)return!0}return!1}function Vl(t){return t.type===4&&t.value!==ed}function mm(t,e,n){let i=t.type===4&&!n?ed:t.value;return e===i}function vm(t,e,n){let i=4,o=t.attrs,h=o!==null?wm(o):0,p=!1;for(let v=0;v<e.length;v++){let w=e[v];if(typeof w=="number"){if(!p&&!Vt(i)&&!Vt(w))return!1;if(p&&Vt(w))continue;p=!1,i=w|i&1;continue}if(!p)if(i&4){if(i=2|i&1,w!==""&&!mm(t,w,n)||w===""&&e.length===1){if(Vt(i))return!1;p=!0}}else if(i&8){if(o===null||!pm(t,o,w,n)){if(Vt(i))return!1;p=!0}}else{let I=e[++v],S=ym(w,o,Vl(t),n);if(S===-1){if(Vt(i))return!1;p=!0;continue}if(I!==""){let x;if(S>h?x="":x=o[S+1].toLowerCase(),i&2&&I!==x){if(Vt(i))return!1;p=!0}}}}return Vt(i)||p}function Vt(t){return(t&1)===0}function ym(t,e,n,i){if(e===null)return-1;let o=0;if(i||!n){let h=!1;for(;o<e.length;){let p=e[o];if(p===t)return o;if(p===3||p===6)h=!0;else if(p===1||p===2){let v=e[++o];for(;typeof v=="string";)v=e[++o];continue}else{if(p===4)break;if(p===0){o+=4;continue}}o+=h?1:2}return-1}else return Em(e,t)}function _m(t,e,n=!1){for(let i=0;i<e.length;i++)if(vm(t,e[i],n))return!0;return!1}function wm(t){for(let e=0;e<t.length;e++){let n=t[e];if(fm(n))return e}return t.length}function Em(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){let i=t[n];if(typeof i=="number")return-1;if(i===e)return n;n++}return-1}function mh(t,e){return t?":not("+e.trim()+")":e}function Cm(t){let e=t[0],n=1,i=2,o="",h=!1;for(;n<t.length;){let p=t[n];if(typeof p=="string")if(i&2){let v=t[++n];o+="["+p+(v.length>0?'="'+v+'"':"")+"]"}else i&8?o+="."+p:i&4&&(o+=" "+p);else o!==""&&!Vt(p)&&(e+=mh(h,o),o=""),i=p,h=h||!Vt(i);n++}return o!==""&&(e+=mh(h,o)),e}function Im(t){return t.map(Cm).join(",")}function Dm(t){let e=[],n=[],i=1,o=2;for(;i<t.length;){let h=t[i];if(typeof h=="string")o===2?h!==""&&e.push(h,t[++i]):o===8&&n.push(h);else{if(!Vt(o))break;o=h}i++}return{attrs:e,classes:n}}function Qi(t){return Pl(()=>{let e=rd(t),n=li(jn({},e),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===Jh.OnPush,directiveDefs:null,pipeDefs:null,dependencies:e.standalone&&t.dependencies||null,getStandaloneInjector:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||an.Emulated,styles:t.styles||Yi,_:null,schemas:t.schemas||null,tView:null,id:""});sd(n);let i=t.dependencies;return n.directiveDefs=yh(i,!1),n.pipeDefs=yh(i,!0),n.id=xm(n),n})}function bm(t){return zi(t)||nd(t)}function Tm(t){return t!==null}function vh(t,e){if(t==null)return Nr;let n={};for(let i in t)if(t.hasOwnProperty(i)){let o=t[i],h,p,v=fi.None;Array.isArray(o)?(v=o[0],h=o[1],p=o[2]??h):(h=o,p=o),e?(n[h]=v!==fi.None?[i,v]:i,e[h]=p):n[h]=i}return n}function td(t){return Pl(()=>{let e=rd(t);return sd(e),e})}function zi(t){return t[Xp]||null}function nd(t){return t[qp]||null}function id(t){return t[Zp]||null}function Sm(t){let e=zi(t)||nd(t)||id(t);return e!==null?e.standalone:!1}function rd(t){let e={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputTransforms:null,inputConfig:t.inputs||Nr,exportAs:t.exportAs||null,standalone:t.standalone===!0,signals:t.signals===!0,selectors:t.selectors||Yi,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:vh(t.inputs,e),outputs:vh(t.outputs),debugInfo:null}}function sd(t){t.features?.forEach(e=>e(t))}function yh(t,e){if(!t)return null;let n=e?id:bm;return()=>(typeof t=="function"?t():t).map(i=>n(i)).filter(Tm)}function xm(t){let e=0,n=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,t.consts,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery].join("|");for(let o of n)e=Math.imul(31,e)+o.charCodeAt(0)<<0;return e+=2147483648,"c"+e}function od(t){return{\u0275providers:t}}function Am(...t){return{\u0275providers:ad(!0,t),\u0275fromNgModule:!0}}function ad(t,...e){let n=[],i=new Set,o,h=p=>{n.push(p)};return jl(e,p=>{let v=p;Ja(v,h,[],i)&&(o||=[],o.push(v))}),o!==void 0&&ld(o,h),n}function ld(t,e){for(let n=0;n<t.length;n++){let{ngModule:i,providers:o}=t[n];Gl(o,h=>{e(h,i)})}}function Ja(t,e,n,i){if(t=Gt(t),!t)return!1;let o=null,h=uh(t),p=!h&&zi(t);if(!h&&!p){let w=t.ngModule;if(h=uh(w),h)o=w;else return!1}else{if(p&&!p.standalone)return!1;o=t}let v=i.has(o);if(p){if(v)return!1;if(i.add(o),p.dependencies){let w=typeof p.dependencies=="function"?p.dependencies():p.dependencies;for(let I of w)Ja(I,e,n,i)}}else if(h){if(h.imports!=null&&!v){i.add(o);let I;try{jl(h.imports,S=>{Ja(S,e,n,i)&&(I||=[],I.push(S))})}finally{}I!==void 0&&ld(I,e)}if(!v){let I=Fr(o)||(()=>new o);e({provide:o,useFactory:I,deps:Yi},o),e({provide:Kh,useValue:o,multi:!0},o),e({provide:Pr,useValue:()=>Xe(o),multi:!0},o)}let w=h.providers;if(w!=null&&!v){let I=t;Gl(w,S=>{e(S,I)})}}else return!1;return o!==t&&t.providers!==void 0}function Gl(t,e){for(let n of t)Yh(n)&&(n=n.\u0275providers),Array.isArray(n)?Gl(n,e):e(n)}var Mm=Ze({provide:String,useValue:Ze});function cd(t){return t!==null&&typeof t=="object"&&Mm in t}function Rm(t){return!!(t&&t.useExisting)}function Om(t){return!!(t&&t.useFactory)}function el(t){return typeof t=="function"}var vo=new Ke(""),$s={},Lm={},ja;function Hl(){return ja===void 0&&(ja=new to),ja}var Gn=class{},no=class extends Gn{get destroyed(){return this._destroyed}constructor(e,n,i,o){super(),this.parent=n,this.source=i,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,nl(e,p=>this.processProvider(p)),this.records.set(Qh,ji(void 0,this)),o.has("environment")&&this.records.set(Gn,ji(void 0,this));let h=this.records.get(vo);h!=null&&typeof h.value=="string"&&this.scopes.add(h.value),this.injectorDefTypes=new Set(this.get(Kh,Yi,Be.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let e=Ve(null);try{for(let i of this._ngOnDestroyHooks)i.ngOnDestroy();let n=this._onDestroyHooks;this._onDestroyHooks=[];for(let i of n)i()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Ve(e)}}onDestroy(e){return this.assertNotDestroyed(),this._onDestroyHooks.push(e),()=>this.removeOnDestroy(e)}runInContext(e){this.assertNotDestroyed();let n=Bi(this),i=rn(void 0),o;try{return e()}finally{Bi(n),rn(i)}}get(e,n=Lr,i=Be.Default){if(this.assertNotDestroyed(),e.hasOwnProperty(fh))return e[fh](this);i=mo(i);let o,h=Bi(this),p=rn(void 0);try{if(!(i&Be.SkipSelf)){let w=this.records.get(e);if(w===void 0){let I=jm(e)&&kl(e);I&&this.injectableDefInScope(I)?w=ji(tl(e),$s):w=null,this.records.set(e,w)}if(w!=null)return this.hydrate(e,w)}let v=i&Be.Self?Hl():this.parent;return n=i&Be.Optional&&n===Lr?null:n,v.get(e,n)}catch(v){if(v.name==="NullInjectorError"){if((v[Js]=v[Js]||[]).unshift(Ht(e)),h)throw v;return am(v,e,"R3InjectorError",this.source)}else throw v}finally{rn(p),Bi(h)}}resolveInjectorInitializers(){let e=Ve(null),n=Bi(this),i=rn(void 0),o;try{let h=this.get(Pr,Yi,Be.Self);for(let p of h)p()}finally{Bi(n),rn(i),Ve(e)}}toString(){let e=[],n=this.records;for(let i of n.keys())e.push(Ht(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new He(205,!1)}processProvider(e){e=Gt(e);let n=el(e)?e:Gt(e&&e.provide),i=Nm(e);if(!el(e)&&e.multi===!0){let o=this.records.get(n);o||(o=ji(void 0,$s,!0),o.factory=()=>Qa(o.multi),this.records.set(n,o)),n=e,o.multi.push(e)}this.records.set(n,i)}hydrate(e,n){let i=Ve(null);try{return n.value===$s&&(n.value=Lm,n.value=n.factory()),typeof n.value=="object"&&n.value&&Bm(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}finally{Ve(i)}}injectableDefInScope(e){if(!e.providedIn)return!1;let n=Gt(e.providedIn);return typeof n=="string"?n==="any"||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(e){let n=this._onDestroyHooks.indexOf(e);n!==-1&&this._onDestroyHooks.splice(n,1)}};function tl(t){let e=kl(t),n=e!==null?e.factory:Fr(t);if(n!==null)return n;if(t instanceof Ke)throw new He(204,!1);if(t instanceof Function)return Fm(t);throw new He(204,!1)}function Fm(t){if(t.length>0)throw new He(204,!1);let n=zp(t);return n!==null?()=>n.factory(t):()=>new t}function Nm(t){if(cd(t))return ji(void 0,t.useValue);{let e=Pm(t);return ji(e,$s)}}function Pm(t,e,n){let i;if(el(t)){let o=Gt(t);return Fr(o)||tl(o)}else if(cd(t))i=()=>Gt(t.useValue);else if(Om(t))i=()=>t.useFactory(...Qa(t.deps||[]));else if(Rm(t))i=()=>Xe(Gt(t.useExisting));else{let o=Gt(t&&(t.useClass||t.provide));if(km(t))i=()=>new o(...Qa(t.deps));else return Fr(o)||tl(o)}return i}function ji(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function km(t){return!!t.deps}function Bm(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function jm(t){return typeof t=="function"||typeof t=="object"&&t instanceof Ke}function nl(t,e){for(let n of t)Array.isArray(n)?nl(n,e):n&&Yh(n)?nl(n.\u0275providers,e):e(n)}function Um(){return zh()!==void 0||rm()!=null}function Vm(t){return typeof t=="function"}var En=0,Re=1,Te=2,ht=3,Wt=4,zt=5,io=6,kr=7,Yt=8,$i=9,ln=10,It=11,Br=12,_h=13,Yr=14,vn=15,zr=16,Ui=17,yn=18,yo=19,ud=20,Vn=21,Ua=22,gi=23,cn=25,hd=1;var pi=7,ro=8,Xi=9,Ct=10,Wl=function(t){return t[t.None=0]="None",t[t.HasTransplantedViews=2]="HasTransplantedViews",t}(Wl||{});function hi(t){return Array.isArray(t)&&typeof t[hd]=="object"}function Cn(t){return Array.isArray(t)&&t[hd]===!0}function dd(t){return(t.flags&4)!==0}function Yl(t){return t.componentOffset>-1}function zl(t){return(t.flags&1)===1}function $r(t){return!!t.template}function Gm(t){return(t[Te]&512)!==0}var il=class{constructor(e,n,i){this.previousValue=e,this.currentValue=n,this.firstChange=i}isFirstChange(){return this.firstChange}};function fd(t,e,n,i){e!==null?e.applyValueToInputSignal(e,i):t[n]=i}function gd(){return pd}function pd(t){return t.type.prototype.ngOnChanges&&(t.setInput=Wm),Hm}gd.ngInherit=!0;function Hm(){let t=vd(this),e=t?.current;if(e){let n=t.previous;if(n===Nr)t.previous=e;else for(let i in e)n[i]=e[i];t.current=null,this.ngOnChanges(e)}}function Wm(t,e,n,i,o){let h=this.declaredInputs[i],p=vd(t)||Ym(t,{previous:Nr,current:null}),v=p.current||(p.current={}),w=p.previous,I=w[h];v[h]=new il(I&&I.currentValue,n,w===Nr),fd(t,e,o,n)}var md="__ngSimpleChanges__";function vd(t){return t[md]||null}function Ym(t,e){return t[md]=e}var wh=null;var sn=function(t,e,n){wh?.(t,e,n)},zm="svg",$m="math",Xm=!1;function qm(){return Xm}function _n(t){for(;Array.isArray(t);)t=t[En];return t}function $t(t,e){return _n(e[t.index])}function $l(t,e){return t.data[e]}function yi(t,e){let n=e[t];return hi(n)?n:n[En]}function Zm(t){return(t[Te]&4)===4}function Xl(t){return(t[Te]&128)===128}function Qm(t){return Cn(t[ht])}function so(t,e){return e==null?null:t[e]}function yd(t){t[Ui]=0}function Km(t){t[Te]&1024||(t[Te]|=1024,Xl(t)&&jr(t))}function ql(t){return!!(t[Te]&9216||t[gi]?.dirty)}function rl(t){t[ln].changeDetectionScheduler?.notify(1),ql(t)?jr(t):t[Te]&64&&(qm()?(t[Te]|=1024,jr(t)):t[ln].changeDetectionScheduler?.notify())}function jr(t){t[ln].changeDetectionScheduler?.notify();let e=Ur(t);for(;e!==null&&!(e[Te]&8192||(e[Te]|=8192,!Xl(e)));)e=Ur(e)}function _d(t,e){if((t[Te]&256)===256)throw new He(911,!1);t[Vn]===null&&(t[Vn]=[]),t[Vn].push(e)}function Jm(t,e){if(t[Vn]===null)return;let n=t[Vn].indexOf(e);n!==-1&&t[Vn].splice(n,1)}function Ur(t){let e=t[ht];return Cn(e)?e[ht]:e}var Ue={lFrame:Ad(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function ev(){return Ue.lFrame.elementDepthCount}function tv(){Ue.lFrame.elementDepthCount++}function nv(){Ue.lFrame.elementDepthCount--}function wd(){return Ue.bindingsEnabled}function iv(){return Ue.skipHydrationRootTNode!==null}function rv(t){return Ue.skipHydrationRootTNode===t}function sv(){Ue.skipHydrationRootTNode=null}function it(){return Ue.lFrame.lView}function In(){return Ue.lFrame.tView}function Ed(t){return Ue.lFrame.contextLView=t,t[Yt]}function Cd(t){return Ue.lFrame.contextLView=null,t}function un(){let t=Id();for(;t!==null&&t.type===64;)t=t.parent;return t}function Id(){return Ue.lFrame.currentTNode}function ov(){let t=Ue.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}function Xr(t,e){let n=Ue.lFrame;n.currentTNode=t,n.isParent=e}function Dd(){return Ue.lFrame.isParent}function av(){Ue.lFrame.isParent=!1}function lv(){let t=Ue.lFrame,e=t.bindingRootIndex;return e===-1&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}function cv(t){return Ue.lFrame.bindingIndex=t}function bd(){return Ue.lFrame.bindingIndex++}function uv(){return Ue.lFrame.inI18n}function hv(t,e){let n=Ue.lFrame;n.bindingIndex=n.bindingRootIndex=t,sl(e)}function dv(){return Ue.lFrame.currentDirectiveIndex}function sl(t){Ue.lFrame.currentDirectiveIndex=t}function Td(){return Ue.lFrame.currentQueryIndex}function Zl(t){Ue.lFrame.currentQueryIndex=t}function fv(t){let e=t[Re];return e.type===2?e.declTNode:e.type===1?t[zt]:null}function Sd(t,e,n){if(n&Be.SkipSelf){let o=e,h=t;for(;o=o.parent,o===null&&!(n&Be.Host);)if(o=fv(h),o===null||(h=h[Yr],o.type&10))break;if(o===null)return!1;e=o,t=h}let i=Ue.lFrame=xd();return i.currentTNode=e,i.lView=t,!0}function Ql(t){let e=xd(),n=t[Re];Ue.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function xd(){let t=Ue.lFrame,e=t===null?null:t.child;return e===null?Ad(t):e}function Ad(t){let e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=e),e}function Md(){let t=Ue.lFrame;return Ue.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var Rd=Md;function Kl(){let t=Md();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Od(){return Ue.lFrame.selectedIndex}function mi(t){Ue.lFrame.selectedIndex=t}function gv(){let t=Ue.lFrame;return $l(t.tView,t.selectedIndex)}function pv(){return Ue.lFrame.currentNamespace}var Ld=!0;function Jl(){return Ld}function ec(t){Ld=t}function mv(t,e,n){let{ngOnChanges:i,ngOnInit:o,ngDoCheck:h}=e.type.prototype;if(i){let p=pd(e);(n.preOrderHooks??=[]).push(t,p),(n.preOrderCheckHooks??=[]).push(t,p)}o&&(n.preOrderHooks??=[]).push(0-t,o),h&&((n.preOrderHooks??=[]).push(t,h),(n.preOrderCheckHooks??=[]).push(t,h))}function tc(t,e){for(let n=e.directiveStart,i=e.directiveEnd;n<i;n++){let h=t.data[n].type.prototype,{ngAfterContentInit:p,ngAfterContentChecked:v,ngAfterViewInit:w,ngAfterViewChecked:I,ngOnDestroy:S}=h;p&&(t.contentHooks??=[]).push(-n,p),v&&((t.contentHooks??=[]).push(n,v),(t.contentCheckHooks??=[]).push(n,v)),w&&(t.viewHooks??=[]).push(-n,w),I&&((t.viewHooks??=[]).push(n,I),(t.viewCheckHooks??=[]).push(n,I)),S!=null&&(t.destroyHooks??=[]).push(n,S)}}function Xs(t,e,n){Fd(t,e,3,n)}function qs(t,e,n,i){(t[Te]&3)===n&&Fd(t,e,n,i)}function Va(t,e){let n=t[Te];(n&3)===e&&(n&=16383,n+=1,t[Te]=n)}function Fd(t,e,n,i){let o=i!==void 0?t[Ui]&65535:0,h=i??-1,p=e.length-1,v=0;for(let w=o;w<p;w++)if(typeof e[w+1]=="number"){if(v=e[w],i!=null&&v>=i)break}else e[w]<0&&(t[Ui]+=65536),(v<h||h==-1)&&(vv(t,n,e,w),t[Ui]=(t[Ui]&4294901760)+w+2),w++}function Eh(t,e){sn(4,t,e);let n=Ve(null);try{e.call(t)}finally{Ve(n),sn(5,t,e)}}function vv(t,e,n,i){let o=n[i]<0,h=n[i+1],p=o?-n[i]:n[i],v=t[p];o?t[Te]>>14<t[Ui]>>16&&(t[Te]&3)===e&&(t[Te]+=16384,Eh(v,h)):Eh(v,h)}var Wi=-1,Vr=class{constructor(e,n,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=i}};function yv(t){return t instanceof Vr}function _v(t){return(t.flags&8)!==0}function wv(t){return(t.flags&16)!==0}function Nd(t){return t!==Wi}function oo(t){return t&32767}function Ev(t){return t>>16}function ao(t,e){let n=Ev(t),i=e;for(;n>0;)i=i[Yr],n--;return i}var ol=!0;function Ch(t){let e=ol;return ol=t,e}var Cv=256,Pd=Cv-1,kd=5,Iv=0,on={};function Dv(t,e,n){let i;typeof n=="string"?i=n.charCodeAt(0)||0:n.hasOwnProperty(Or)&&(i=n[Or]),i==null&&(i=n[Or]=Iv++);let o=i&Pd,h=1<<o;e.data[t+(o>>kd)]|=h}function Bd(t,e){let n=jd(t,e);if(n!==-1)return n;let i=e[Re];i.firstCreatePass&&(t.injectorIndex=e.length,Ga(i.data,t),Ga(e,null),Ga(i.blueprint,null));let o=nc(t,e),h=t.injectorIndex;if(Nd(o)){let p=oo(o),v=ao(o,e),w=v[Re].data;for(let I=0;I<8;I++)e[h+I]=v[p+I]|w[p+I]}return e[h+8]=o,h}function Ga(t,e){t.push(0,0,0,0,0,0,0,0,e)}function jd(t,e){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||e[t.injectorIndex+8]===null?-1:t.injectorIndex}function nc(t,e){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let n=0,i=null,o=e;for(;o!==null;){if(i=Wd(o),i===null)return Wi;if(n++,o=o[Yr],i.injectorIndex!==-1)return i.injectorIndex|n<<16}return Wi}function bv(t,e,n){Dv(t,e,n)}function Ud(t,e,n){if(n&Be.Optional||t!==void 0)return t;Bl(e,"NodeInjector")}function Vd(t,e,n,i){if(n&Be.Optional&&i===void 0&&(i=null),!(n&(Be.Self|Be.Host))){let o=t[$i],h=rn(void 0);try{return o?o.get(e,i,n&Be.Optional):$h(e,i,n&Be.Optional)}finally{rn(h)}}return Ud(i,e,n)}function Gd(t,e,n,i=Be.Default,o){if(t!==null){if(e[Te]&2048&&!(i&Be.Self)){let p=Av(t,e,n,i,on);if(p!==on)return p}let h=Hd(t,e,n,i,on);if(h!==on)return h}return Vd(e,n,i,o)}function Hd(t,e,n,i,o){let h=Sv(n);if(typeof h=="function"){if(!Sd(e,t,i))return i&Be.Host?Ud(o,n,i):Vd(e,n,i,o);try{let p;if(p=h(i),p==null&&!(i&Be.Optional))Bl(n);else return p}finally{Rd()}}else if(typeof h=="number"){let p=null,v=jd(t,e),w=Wi,I=i&Be.Host?e[vn][zt]:null;for((v===-1||i&Be.SkipSelf)&&(w=v===-1?nc(t,e):e[v+8],w===Wi||!Dh(i,!1)?v=-1:(p=e[Re],v=oo(w),e=ao(w,e)));v!==-1;){let S=e[Re];if(Ih(h,v,S.data)){let x=Tv(v,e,n,p,i,I);if(x!==on)return x}w=e[v+8],w!==Wi&&Dh(i,e[Re].data[v+8]===I)&&Ih(h,v,e)?(p=S,v=oo(w),e=ao(w,e)):v=-1}}return o}function Tv(t,e,n,i,o,h){let p=e[Re],v=p.data[t+8],w=i==null?Yl(v)&&ol:i!=p&&(v.type&3)!==0,I=o&Be.Host&&h===v,S=Zs(v,p,n,w,I);return S!==null?qi(e,p,S,v):on}function Zs(t,e,n,i,o){let h=t.providerIndexes,p=e.data,v=h&1048575,w=t.directiveStart,I=t.directiveEnd,S=h>>20,x=i?v:v+S,M=o?v+S:I;for(let R=x;R<M;R++){let O=p[R];if(R<w&&n===O||R>=w&&O.type===n)return R}if(o){let R=p[w];if(R&&$r(R)&&R.type===n)return w}return null}function qi(t,e,n,i){let o=t[n],h=e.data;if(yv(o)){let p=o;p.resolving&&Jp(Kp(h[n]));let v=Ch(p.canSeeViewProviders);p.resolving=!0;let w,I=p.injectImpl?rn(p.injectImpl):null,S=Sd(t,i,Be.Default);try{o=t[n]=p.factory(void 0,h,t,i),e.firstCreatePass&&n>=i.directiveStart&&mv(n,h[n],e)}finally{I!==null&&rn(I),Ch(v),p.resolving=!1,Rd()}}return o}function Sv(t){if(typeof t=="string")return t.charCodeAt(0)||0;let e=t.hasOwnProperty(Or)?t[Or]:void 0;return typeof e=="number"?e>=0?e&Pd:xv:e}function Ih(t,e,n){let i=1<<t;return!!(n[e+(t>>kd)]&i)}function Dh(t,e){return!(t&Be.Self)&&!(t&Be.Host&&e)}var di=class{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,i){return Gd(this._tNode,this._lView,e,mo(i),n)}};function xv(){return new di(un(),it())}function Av(t,e,n,i,o){let h=t,p=e;for(;h!==null&&p!==null&&p[Te]&2048&&!(p[Te]&512);){let v=Hd(h,p,n,i|Be.Self,on);if(v!==on)return v;let w=h.parent;if(!w){let I=p[ud];if(I){let S=I.get(n,on,i);if(S!==on)return S}w=Wd(p),p=p[Yr]}h=w}return o}function Wd(t){let e=t[Re],n=e.type;return n===2?e.declTNode:n===1?t[zt]:null}function bh(t,e=null,n=null,i){let o=Mv(t,e,n,i);return o.resolveInjectorInitializers(),o}function Mv(t,e=null,n=null,i,o=new Set){let h=[n||Yi,Am(t)];return i=i||(typeof t=="object"?void 0:Ht(t)),new no(h,e||Hl(),i||null,o)}var ic=(()=>{let e=class e{static create(i,o){if(Array.isArray(i))return bh({name:""},o,i,"");{let h=i.name??"";return bh({name:h},i.parent,i.providers,h)}}};e.THROW_IF_NOT_FOUND=Lr,e.NULL=new to,e.\u0275prov=ot({token:e,providedIn:"any",factory:()=>Xe(Qh)}),e.__NG_ELEMENT_ID__=-1;let t=e;return t})();var Rv="ngOriginalError";function Ha(t){return t[Rv]}var wn=class{constructor(){this._console=console}handleError(e){let n=this._findOriginalError(e);this._console.error("ERROR",e),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&Ha(e);for(;n&&Ha(n);)n=Ha(n);return n||null}},Yd=new Ke("",{providedIn:"root",factory:()=>ut(wn).handleError.bind(void 0)}),zd=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=Ov,e.__NG_ENV_ID__=i=>i;let t=e;return t})(),al=class extends zd{constructor(e){super(),this._lView=e}onDestroy(e){return _d(this._lView,e),()=>Jm(this._lView,e)}};function Ov(){return new al(it())}function Lv(){return Ki(un(),it())}function Ki(t,e){return new _i($t(t,e))}var _i=(()=>{let e=class e{constructor(i){this.nativeElement=i}};e.__NG_ELEMENT_ID__=Lv;let t=e;return t})();function Fv(t){return t instanceof _i?t.nativeElement:t}var ll=class extends Un{constructor(e=!1){super(),this.destroyRef=void 0,this.__isAsync=e,Um()&&(this.destroyRef=ut(zd,{optional:!0})??void 0)}emit(e){let n=Ve(null);try{super.next(e)}finally{Ve(n)}}subscribe(e,n,i){let o=e,h=n||(()=>null),p=i;if(e&&typeof e=="object"){let w=e;o=w.next?.bind(w),h=w.error?.bind(w),p=w.complete?.bind(w)}this.__isAsync&&(h=Wa(h),o&&(o=Wa(o)),p&&(p=Wa(p)));let v=super.subscribe({next:o,error:h,complete:p});return e instanceof Et&&e.add(v),v}};function Wa(t){return e=>{setTimeout(t,void 0,e)}}var Vi=ll;function Nv(){return this._results[Symbol.iterator]()}var cl=class t{get changes(){return this._changes??=new Vi}constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let n=t.prototype;n[Symbol.iterator]||(n[Symbol.iterator]=Nv)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,n){return this._results.reduce(e,n)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,n){this.dirty=!1;let i=hm(e);(this._changesDetected=!um(this._results,i,n))&&(this._results=i,this.length=i.length,this.last=i[this.length-1],this.first=i[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(e){this._onDirty=e}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function $d(t){return(t.flags&128)===128}var Xd=new Map,Pv=0;function kv(){return Pv++}function Bv(t){Xd.set(t[yo],t)}function jv(t){Xd.delete(t[yo])}var Th="__ngContext__";function vi(t,e){hi(e)?(t[Th]=e[yo],Bv(e)):t[Th]=e}function qd(t){return Qd(t[Br])}function Zd(t){return Qd(t[Wt])}function Qd(t){for(;t!==null&&!Cn(t);)t=t[Wt];return t}var ul;function Kd(t){ul=t}function Uv(){if(ul!==void 0)return ul;if(typeof document<"u")return document;throw new He(210,!1)}var rc=new Ke("",{providedIn:"root",factory:()=>Vv}),Vv="ng",sc=new Ke(""),Ji=new Ke("",{providedIn:"platform",factory:()=>"unknown"});var oc=new Ke("",{providedIn:"root",factory:()=>Uv().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var Gv="h",Hv="b";var Wv=()=>null;function ac(t,e,n=!1){return Wv(t,e,n)}var Jd=!1,Yv=new Ke("",{providedIn:"root",factory:()=>Jd});var Hn=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Hn||{}),zv;function lc(t,e){return zv(t,e)}function Gi(t,e,n,i,o){if(i!=null){let h,p=!1;Cn(i)?h=i:hi(i)&&(p=!0,i=i[En]);let v=_n(i);t===0&&n!==null?o==null?rf(e,n,v):co(e,n,v,o||null,!0):t===1&&n!==null?co(e,n,v,o||null,!0):t===2?ly(e,v,p):t===3&&e.destroyNode(v),h!=null&&uy(e,t,h,n,o)}}function $v(t,e){return t.createText(e)}function ef(t,e,n){return t.createElement(e,n)}function Xv(t,e){tf(t,e),e[En]=null,e[zt]=null}function qv(t,e,n,i,o,h){i[En]=o,i[zt]=e,_o(t,i,n,1,o,h)}function tf(t,e){e[ln].changeDetectionScheduler?.notify(1),_o(t,e,e[It],2,null,null)}function Zv(t){let e=t[Br];if(!e)return Ya(t[Re],t);for(;e;){let n=null;if(hi(e))n=e[Br];else{let i=e[Ct];i&&(n=i)}if(!n){for(;e&&!e[Wt]&&e!==t;)hi(e)&&Ya(e[Re],e),e=e[ht];e===null&&(e=t),hi(e)&&Ya(e[Re],e),n=e&&e[Wt]}e=n}}function Qv(t,e,n,i){let o=Ct+i,h=n.length;i>0&&(n[o-1][Wt]=e),i<h-Ct?(e[Wt]=n[o],Zh(n,Ct+i,e)):(n.push(e),e[Wt]=null),e[ht]=n;let p=e[zr];p!==null&&n!==p&&Kv(p,e);let v=e[yn];v!==null&&v.insertView(t),rl(e),e[Te]|=128}function Kv(t,e){let n=t[Xi],o=e[ht][ht][vn];e[vn]!==o&&(t[Te]|=Wl.HasTransplantedViews),n===null?t[Xi]=[e]:n.push(e)}function nf(t,e){let n=t[Xi],i=n.indexOf(e);n.splice(i,1)}function lo(t,e){if(t.length<=Ct)return;let n=Ct+e,i=t[n];if(i){let o=i[zr];o!==null&&o!==t&&nf(o,i),e>0&&(t[n-1][Wt]=i[Wt]);let h=eo(t,Ct+e);Xv(i[Re],i);let p=h[yn];p!==null&&p.detachView(h[Re]),i[ht]=null,i[Wt]=null,i[Te]&=-129}return i}function cc(t,e){if(!(e[Te]&256)){let n=e[It];n.destroyNode&&_o(t,e,n,3,null,null),Zv(e)}}function Ya(t,e){if(e[Te]&256)return;let n=Ve(null);try{e[Te]&=-129,e[Te]|=256,e[gi]&&$u(e[gi]),ey(t,e),Jv(t,e),e[Re].type===1&&e[It].destroy();let i=e[zr];if(i!==null&&Cn(e[ht])){i!==e[ht]&&nf(i,e);let o=e[yn];o!==null&&o.detachView(t)}jv(e)}finally{Ve(n)}}function Jv(t,e){let n=t.cleanup,i=e[kr];if(n!==null)for(let h=0;h<n.length-1;h+=2)if(typeof n[h]=="string"){let p=n[h+3];p>=0?i[p]():i[-p].unsubscribe(),h+=2}else{let p=i[n[h+1]];n[h].call(p)}i!==null&&(e[kr]=null);let o=e[Vn];if(o!==null){e[Vn]=null;for(let h=0;h<o.length;h++){let p=o[h];p()}}}function ey(t,e){let n;if(t!=null&&(n=t.destroyHooks)!=null)for(let i=0;i<n.length;i+=2){let o=e[n[i]];if(!(o instanceof Vr)){let h=n[i+1];if(Array.isArray(h))for(let p=0;p<h.length;p+=2){let v=o[h[p]],w=h[p+1];sn(4,v,w);try{w.call(v)}finally{sn(5,v,w)}}else{sn(4,o,h);try{h.call(o)}finally{sn(5,o,h)}}}}}function ty(t,e,n){return ny(t,e.parent,n)}function ny(t,e,n){let i=e;for(;i!==null&&i.type&40;)e=i,i=e.parent;if(i===null)return n[En];{let{componentOffset:o}=i;if(o>-1){let{encapsulation:h}=t.data[i.directiveStart+o];if(h===an.None||h===an.Emulated)return null}return $t(i,n)}}function co(t,e,n,i,o){t.insertBefore(e,n,i,o)}function rf(t,e,n){t.appendChild(e,n)}function Sh(t,e,n,i,o){i!==null?co(t,e,n,i,o):rf(t,e,n)}function iy(t,e,n,i){t.removeChild(e,n,i)}function uc(t,e){return t.parentNode(e)}function ry(t,e){return t.nextSibling(e)}function sy(t,e,n){return ay(t,e,n)}function oy(t,e,n){return t.type&40?$t(t,n):null}var ay=oy,xh;function hc(t,e,n,i){let o=ty(t,i,e),h=e[It],p=i.parent||e[zt],v=sy(p,i,e);if(o!=null)if(Array.isArray(n))for(let w=0;w<n.length;w++)Sh(h,o,n[w],v,!1);else Sh(h,o,n,v,!1);xh!==void 0&&xh(h,i,e,n,o)}function Qs(t,e){if(e!==null){let n=e.type;if(n&3)return $t(e,t);if(n&4)return hl(-1,t[e.index]);if(n&8){let i=e.child;if(i!==null)return Qs(t,i);{let o=t[e.index];return Cn(o)?hl(-1,o):_n(o)}}else{if(n&32)return lc(e,t)()||_n(t[e.index]);{let i=sf(t,e);if(i!==null){if(Array.isArray(i))return i[0];let o=Ur(t[vn]);return Qs(o,i)}else return Qs(t,e.next)}}}return null}function sf(t,e){if(e!==null){let i=t[vn][zt],o=e.projection;return i.projection[o]}return null}function hl(t,e){let n=Ct+t+1;if(n<e.length){let i=e[n],o=i[Re].firstChild;if(o!==null)return Qs(i,o)}return e[pi]}function ly(t,e,n){let i=uc(t,e);i&&iy(t,i,e,n)}function dc(t,e,n,i,o,h,p){for(;n!=null;){let v=i[n.index],w=n.type;if(p&&e===0&&(v&&vi(_n(v),i),n.flags|=2),(n.flags&32)!==32)if(w&8)dc(t,e,n.child,i,o,h,!1),Gi(e,t,o,v,h);else if(w&32){let I=lc(n,i),S;for(;S=I();)Gi(e,t,o,S,h);Gi(e,t,o,v,h)}else w&16?cy(t,e,i,n,o,h):Gi(e,t,o,v,h);n=p?n.projectionNext:n.next}}function _o(t,e,n,i,o,h){dc(n,i,t.firstChild,e,o,h,!1)}function cy(t,e,n,i,o,h){let p=n[vn],w=p[zt].projection[i.projection];if(Array.isArray(w))for(let I=0;I<w.length;I++){let S=w[I];Gi(e,t,o,S,h)}else{let I=w,S=p[ht];$d(i)&&(I.flags|=128),dc(t,e,I,S,o,h,!0)}}function uy(t,e,n,i,o){let h=n[pi],p=_n(n);h!==p&&Gi(e,t,i,h,o);for(let v=Ct;v<n.length;v++){let w=n[v];_o(w[Re],w,t,e,i,h)}}function hy(t,e,n){t.setAttribute(e,"style",n)}function of(t,e,n){n===""?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n)}function af(t,e,n){let{mergedAttrs:i,classes:o,styles:h}=n;i!==null&&Ka(t,e,i),o!==null&&of(t,e,o),h!==null&&hy(t,e,h)}var fc={};function wo(t=1){lf(In(),it(),Od()+t,!1)}function lf(t,e,n,i){if(!i)if((e[Te]&3)===3){let h=t.preOrderCheckHooks;h!==null&&Xs(e,h,n)}else{let h=t.preOrderHooks;h!==null&&qs(e,h,0,n)}mi(n)}function qr(t,e=Be.Default){let n=it();if(n===null)return Xe(t,e);let i=un();return Gd(i,n,Gt(t),e)}function cf(t,e,n,i,o,h){let p=Ve(null);try{let v=null;o&fi.SignalBased&&(v=e[i][Hu]),v!==null&&v.transformFn!==void 0&&(h=v.transformFn(h)),o&fi.HasDecoratorInputTransform&&(h=t.inputTransforms[i].call(e,h)),t.setInput!==null?t.setInput(e,v,h,n,i):fd(e,v,i,h)}finally{Ve(p)}}function dy(t,e){let n=t.hostBindingOpCodes;if(n!==null)try{for(let i=0;i<n.length;i++){let o=n[i];if(o<0)mi(~o);else{let h=o,p=n[++i],v=n[++i];hv(p,h);let w=e[h];v(2,w)}}}finally{mi(-1)}}function Eo(t,e,n,i,o,h,p,v,w,I,S){let x=e.blueprint.slice();return x[En]=o,x[Te]=i|4|128|8|64,(I!==null||t&&t[Te]&2048)&&(x[Te]|=2048),yd(x),x[ht]=x[Yr]=t,x[Yt]=n,x[ln]=p||t&&t[ln],x[It]=v||t&&t[It],x[$i]=w||t&&t[$i]||null,x[zt]=h,x[yo]=kv(),x[io]=S,x[ud]=I,x[vn]=e.type==2?t[vn]:x,x}function Co(t,e,n,i,o){let h=t.data[e];if(h===null)h=fy(t,e,n,i,o),uv()&&(h.flags|=32);else if(h.type&64){h.type=n,h.value=i,h.attrs=o;let p=ov();h.injectorIndex=p===null?-1:p.injectorIndex}return Xr(h,!0),h}function fy(t,e,n,i,o){let h=Id(),p=Dd(),v=p?h:h&&h.parent,w=t.data[e]=_y(t,v,n,e,i,o);return t.firstChild===null&&(t.firstChild=w),h!==null&&(p?h.child==null&&w.parent!==null&&(h.child=w):h.next===null&&(h.next=w,w.prev=h)),w}function uf(t,e,n,i){if(n===0)return-1;let o=e.length;for(let h=0;h<n;h++)e.push(i),t.blueprint.push(i),t.data.push(null);return o}function hf(t,e,n,i,o){let h=Od(),p=i&2;try{mi(-1),p&&e.length>cn&&lf(t,e,cn,!1),sn(p?2:0,o),n(i,o)}finally{mi(h),sn(p?3:1,o)}}function df(t,e,n){if(dd(e)){let i=Ve(null);try{let o=e.directiveStart,h=e.directiveEnd;for(let p=o;p<h;p++){let v=t.data[p];if(v.contentQueries){let w=n[p];v.contentQueries(1,w,p)}}}finally{Ve(i)}}}function ff(t,e,n){wd()&&(Ty(t,e,n,$t(n,e)),(n.flags&64)===64&&yf(t,e,n))}function gf(t,e,n=$t){let i=e.localNames;if(i!==null){let o=e.index+1;for(let h=0;h<i.length;h+=2){let p=i[h+1],v=p===-1?n(e,t):t[p];t[o++]=v}}}function pf(t){let e=t.tView;return e===null||e.incompleteFirstPass?t.tView=gc(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):e}function gc(t,e,n,i,o,h,p,v,w,I,S){let x=cn+i,M=x+o,R=gy(x,M),O=typeof I=="function"?I():I;return R[Re]={type:t,blueprint:R,template:n,queries:null,viewQuery:v,declTNode:e,data:R.slice().fill(null,x),bindingStartIndex:x,expandoStartIndex:M,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof h=="function"?h():h,pipeRegistry:typeof p=="function"?p():p,firstChild:null,schemas:w,consts:O,incompleteFirstPass:!1,ssrId:S}}function gy(t,e){let n=[];for(let i=0;i<e;i++)n.push(i<t?null:fc);return n}function py(t,e,n,i){let h=i.get(Yv,Jd)||n===an.ShadowDom,p=t.selectRootElement(e,h);return my(p),p}function my(t){vy(t)}var vy=()=>null;function yy(t,e,n,i){let o=Ef(e);o.push(n),t.firstCreatePass&&Cf(t).push(i,o.length-1)}function _y(t,e,n,i,o,h){let p=e?e.injectorIndex:-1,v=0;return iv()&&(v|=128),{type:n,index:i,insertBeforeIndex:null,injectorIndex:p,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:v,providerIndexes:0,value:o,attrs:h,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function Ah(t,e,n,i,o){for(let h in e){if(!e.hasOwnProperty(h))continue;let p=e[h];if(p===void 0)continue;i??={};let v,w=fi.None;Array.isArray(p)?(v=p[0],w=p[1]):v=p;let I=h;if(o!==null){if(!o.hasOwnProperty(h))continue;I=o[h]}t===0?Mh(i,n,I,v,w):Mh(i,n,I,v)}return i}function Mh(t,e,n,i,o){let h;t.hasOwnProperty(n)?(h=t[n]).push(e,i):h=t[n]=[e,i],o!==void 0&&h.push(o)}function wy(t,e,n){let i=e.directiveStart,o=e.directiveEnd,h=t.data,p=e.attrs,v=[],w=null,I=null;for(let S=i;S<o;S++){let x=h[S],M=n?n.get(x):null,R=M?M.inputs:null,O=M?M.outputs:null;w=Ah(0,x.inputs,S,w,R),I=Ah(1,x.outputs,S,I,O);let B=w!==null&&p!==null&&!Vl(e)?Ny(w,S,p):null;v.push(B)}w!==null&&(w.hasOwnProperty("class")&&(e.flags|=8),w.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=v,e.inputs=w,e.outputs=I}function Ey(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function Cy(t,e,n,i,o,h,p,v){let w=$t(e,n),I=e.inputs,S;!v&&I!=null&&(S=I[i])?(pc(t,n,S,i,o),Yl(e)&&Iy(n,e.index)):e.type&3?(i=Ey(i),o=p!=null?p(o,e.value||"",i):o,h.setProperty(w,i,o)):e.type&12}function Iy(t,e){let n=yi(e,t);n[Te]&16||(n[Te]|=64)}function mf(t,e,n,i){if(wd()){let o=i===null?null:{"":-1},h=xy(t,n),p,v;h===null?p=v=null:[p,v]=h,p!==null&&vf(t,e,n,p,o,v),o&&Ay(n,i,o)}n.mergedAttrs=Ul(n.mergedAttrs,n.attrs)}function vf(t,e,n,i,o,h){for(let I=0;I<i.length;I++)bv(Bd(n,e),t,i[I].type);Ry(n,t.data.length,i.length);for(let I=0;I<i.length;I++){let S=i[I];S.providersResolver&&S.providersResolver(S)}let p=!1,v=!1,w=uf(t,e,i.length,null);for(let I=0;I<i.length;I++){let S=i[I];n.mergedAttrs=Ul(n.mergedAttrs,S.hostAttrs),Oy(t,n,e,w,S),My(w,S,o),S.contentQueries!==null&&(n.flags|=4),(S.hostBindings!==null||S.hostAttrs!==null||S.hostVars!==0)&&(n.flags|=64);let x=S.type.prototype;!p&&(x.ngOnChanges||x.ngOnInit||x.ngDoCheck)&&((t.preOrderHooks??=[]).push(n.index),p=!0),!v&&(x.ngOnChanges||x.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(n.index),v=!0),w++}wy(t,n,h)}function Dy(t,e,n,i,o){let h=o.hostBindings;if(h){let p=t.hostBindingOpCodes;p===null&&(p=t.hostBindingOpCodes=[]);let v=~e.index;by(p)!=v&&p.push(v),p.push(n,i,h)}}function by(t){let e=t.length;for(;e>0;){let n=t[--e];if(typeof n=="number"&&n<0)return n}return 0}function Ty(t,e,n,i){let o=n.directiveStart,h=n.directiveEnd;Yl(n)&&Ly(e,n,t.data[o+n.componentOffset]),t.firstCreatePass||Bd(n,e),vi(i,e);let p=n.initialInputs;for(let v=o;v<h;v++){let w=t.data[v],I=qi(e,t,v,n);if(vi(I,e),p!==null&&Fy(e,v-o,I,w,n,p),$r(w)){let S=yi(n.index,e);S[Yt]=qi(e,t,v,n)}}}function yf(t,e,n){let i=n.directiveStart,o=n.directiveEnd,h=n.index,p=dv();try{mi(h);for(let v=i;v<o;v++){let w=t.data[v],I=e[v];sl(v),(w.hostBindings!==null||w.hostVars!==0||w.hostAttrs!==null)&&Sy(w,I)}}finally{mi(-1),sl(p)}}function Sy(t,e){t.hostBindings!==null&&t.hostBindings(1,e)}function xy(t,e){let n=t.directiveRegistry,i=null,o=null;if(n)for(let h=0;h<n.length;h++){let p=n[h];if(_m(e,p.selectors,!1))if(i||(i=[]),$r(p))if(p.findHostDirectiveDefs!==null){let v=[];o=o||new Map,p.findHostDirectiveDefs(p,v,o),i.unshift(...v,p);let w=v.length;dl(t,e,w)}else i.unshift(p),dl(t,e,0);else o=o||new Map,p.findHostDirectiveDefs?.(p,i,o),i.push(p)}return i===null?null:[i,o]}function dl(t,e,n){e.componentOffset=n,(t.components??=[]).push(e.index)}function Ay(t,e,n){if(e){let i=t.localNames=[];for(let o=0;o<e.length;o+=2){let h=n[e[o+1]];if(h==null)throw new He(-301,!1);i.push(e[o],h)}}}function My(t,e,n){if(n){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)n[e.exportAs[i]]=t;$r(e)&&(n[""]=t)}}function Ry(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function Oy(t,e,n,i,o){t.data[i]=o;let h=o.factory||(o.factory=Fr(o.type,!0)),p=new Vr(h,$r(o),qr);t.blueprint[i]=p,n[i]=p,Dy(t,e,i,uf(t,n,o.hostVars,fc),o)}function Ly(t,e,n){let i=$t(e,t),o=pf(n),h=t[ln].rendererFactory,p=16;n.signals?p=4096:n.onPush&&(p=64);let v=Io(t,Eo(t,o,null,p,i,e,null,h.createRenderer(i,n),null,null,null));t[e.index]=v}function Fy(t,e,n,i,o,h){let p=h[e];if(p!==null)for(let v=0;v<p.length;){let w=p[v++],I=p[v++],S=p[v++],x=p[v++];cf(i,n,w,I,S,x)}}function Ny(t,e,n){let i=null,o=0;for(;o<n.length;){let h=n[o];if(h===0){o+=4;continue}else if(h===5){o+=2;continue}if(typeof h=="number")break;if(t.hasOwnProperty(h)){i===null&&(i=[]);let p=t[h];for(let v=0;v<p.length;v+=3)if(p[v]===e){i.push(h,p[v+1],p[v+2],n[o+1]);break}}o+=2}return i}function _f(t,e,n,i){return[t,!0,0,e,null,i,null,n,null,null]}function wf(t,e){let n=t.contentQueries;if(n!==null){let i=Ve(null);try{for(let o=0;o<n.length;o+=2){let h=n[o],p=n[o+1];if(p!==-1){let v=t.data[p];Zl(h),v.contentQueries(2,e[p],p)}}}finally{Ve(i)}}}function Io(t,e){return t[Br]?t[_h][Wt]=e:t[Br]=e,t[_h]=e,e}function fl(t,e,n){Zl(0);let i=Ve(null);try{e(t,n)}finally{Ve(i)}}function Ef(t){return t[kr]||(t[kr]=[])}function Cf(t){return t.cleanup||(t.cleanup=[])}function If(t,e){let n=t[$i],i=n?n.get(wn,null):null;i&&i.handleError(e)}function pc(t,e,n,i,o){for(let h=0;h<n.length;){let p=n[h++],v=n[h++],w=n[h++],I=e[p],S=t.data[p];cf(S,I,i,v,w,o)}}function Py(t,e){let n=yi(e,t),i=n[Re];ky(i,n);let o=n[En];o!==null&&n[io]===null&&(n[io]=ac(o,n[$i])),mc(i,n,n[Yt])}function ky(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])}function mc(t,e,n){Ql(e);try{let i=t.viewQuery;i!==null&&fl(1,i,n);let o=t.template;o!==null&&hf(t,e,o,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),e[yn]?.finishViewCreation(t),t.staticContentQueries&&wf(t,e),t.staticViewQueries&&fl(2,t.viewQuery,n);let h=t.components;h!==null&&By(e,h)}catch(i){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),i}finally{e[Te]&=-5,Kl()}}function By(t,e){for(let n=0;n<e.length;n++)Py(t,e[n])}function Df(t,e,n,i){let o=Ve(null);try{let h=e.tView,v=t[Te]&4096?4096:16,w=Eo(t,h,n,v,null,e,null,null,i?.injector??null,i?.embeddedViewInjector??null,i?.dehydratedView??null),I=t[e.index];w[zr]=I;let S=t[yn];return S!==null&&(w[yn]=S.createEmbeddedView(h)),mc(h,w,n),w}finally{Ve(o)}}function jy(t,e){let n=Ct+e;if(n<t.length)return t[n]}function gl(t,e){return!e||e.firstChild===null||$d(t)}function bf(t,e,n,i=!0){let o=e[Re];if(Qv(o,e,t,n),i){let p=hl(n,t),v=e[It],w=uc(v,t[pi]);w!==null&&qv(o,t[zt],v,e,w,p)}let h=e[io];h!==null&&h.firstChild!==null&&(h.firstChild=null)}function Uy(t,e){let n=lo(t,e);return n!==void 0&&cc(n[Re],n),n}function uo(t,e,n,i,o=!1){for(;n!==null;){let h=e[n.index];h!==null&&i.push(_n(h)),Cn(h)&&Vy(h,i);let p=n.type;if(p&8)uo(t,e,n.child,i);else if(p&32){let v=lc(n,e),w;for(;w=v();)i.push(w)}else if(p&16){let v=sf(e,n);if(Array.isArray(v))i.push(...v);else{let w=Ur(e[vn]);uo(w[Re],w,v,i,!0)}}n=o?n.projectionNext:n.next}return i}function Vy(t,e){for(let n=Ct;n<t.length;n++){let i=t[n],o=i[Re].firstChild;o!==null&&uo(i[Re],i,o,e)}t[pi]!==t[En]&&e.push(t[pi])}var Tf=[];function Gy(t){return t[gi]??Hy(t)}function Hy(t){let e=Tf.pop()??Object.create(Yy);return e.lView=t,e}function Wy(t){t.lView[gi]!==t&&(t.lView=null,Tf.push(t))}var Yy=li(jn({},Wu),{consumerIsAlwaysLive:!0,consumerMarkedDirty:t=>{jr(t.lView)},consumerOnSignalRead(){this.lView[gi]=this}}),Sf=100;function xf(t,e=!0,n=0){let i=t[ln],o=i.rendererFactory,h=!1;h||o.begin?.();try{zy(t,n)}catch(p){throw e&&If(t,p),p}finally{h||(o.end?.(),i.inlineEffectRunner?.flush())}}function zy(t,e){pl(t,e);let n=0;for(;ql(t);){if(n===Sf)throw new He(103,!1);n++,pl(t,1)}}function $y(t,e,n,i){let o=e[Te];if((o&256)===256)return;let h=!1;!h&&e[ln].inlineEffectRunner?.flush(),Ql(e);let p=null,v=null;!h&&Xy(t)&&(v=Gy(e),p=Yu(v));try{yd(e),cv(t.bindingStartIndex),n!==null&&hf(t,e,n,2,i);let w=(o&3)===3;if(!h)if(w){let x=t.preOrderCheckHooks;x!==null&&Xs(e,x,null)}else{let x=t.preOrderHooks;x!==null&&qs(e,x,0,null),Va(e,0)}if(qy(e),Af(e,0),t.contentQueries!==null&&wf(t,e),!h)if(w){let x=t.contentCheckHooks;x!==null&&Xs(e,x)}else{let x=t.contentHooks;x!==null&&qs(e,x,1),Va(e,1)}dy(t,e);let I=t.components;I!==null&&Rf(e,I,0);let S=t.viewQuery;if(S!==null&&fl(2,S,i),!h)if(w){let x=t.viewCheckHooks;x!==null&&Xs(e,x)}else{let x=t.viewHooks;x!==null&&qs(e,x,2),Va(e,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),e[Ua]){for(let x of e[Ua])x();e[Ua]=null}h||(e[Te]&=-73)}catch(w){throw jr(e),w}finally{v!==null&&(zu(v,p),Wy(v)),Kl()}}function Xy(t){return t.type!==2}function Af(t,e){for(let n=qd(t);n!==null;n=Zd(n))for(let i=Ct;i<n.length;i++){let o=n[i];Mf(o,e)}}function qy(t){for(let e=qd(t);e!==null;e=Zd(e)){if(!(e[Te]&Wl.HasTransplantedViews))continue;let n=e[Xi];for(let i=0;i<n.length;i++){let o=n[i],h=o[ht];Km(o)}}}function Zy(t,e,n){let i=yi(e,t);Mf(i,n)}function Mf(t,e){Xl(t)&&pl(t,e)}function pl(t,e){let i=t[Re],o=t[Te],h=t[gi],p=!!(e===0&&o&16);if(p||=!!(o&64&&e===0),p||=!!(o&1024),p||=!!(h?.dirty&&Sa(h)),h&&(h.dirty=!1),t[Te]&=-9217,p)$y(i,t,i.template,t[Yt]);else if(o&8192){Af(t,1);let v=i.components;v!==null&&Rf(t,v,1)}}function Rf(t,e,n){for(let i=0;i<e.length;i++)Zy(t,e[i],n)}function vc(t){for(t[ln].changeDetectionScheduler?.notify();t;){t[Te]|=64;let e=Ur(t);if(Gm(t)&&!e)return t;t=e}return null}var Gr=class{get rootNodes(){let e=this._lView,n=e[Re];return uo(n,e,n.firstChild,[])}constructor(e,n,i=!0){this._lView=e,this._cdRefInjectingView=n,this.notifyErrorHandler=i,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Yt]}set context(e){this._lView[Yt]=e}get destroyed(){return(this._lView[Te]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let e=this._lView[ht];if(Cn(e)){let n=e[ro],i=n?n.indexOf(this):-1;i>-1&&(lo(e,i),eo(n,i))}this._attachedToViewContainer=!1}cc(this._lView[Re],this._lView)}onDestroy(e){_d(this._lView,e)}markForCheck(){vc(this._cdRefInjectingView||this._lView)}detach(){this._lView[Te]&=-129}reattach(){rl(this._lView),this._lView[Te]|=128}detectChanges(){this._lView[Te]|=1024,xf(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new He(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,tf(this._lView[Re],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new He(902,!1);this._appRef=e,rl(this._lView)}},Hr=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=Jy;let t=e;return t})(),Qy=Hr,Ky=class extends Qy{constructor(e,n,i){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=i}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(e,n){return this.createEmbeddedViewImpl(e,n)}createEmbeddedViewImpl(e,n,i){let o=Df(this._declarationLView,this._declarationTContainer,e,{embeddedViewInjector:n,dehydratedView:i});return new Gr(o)}};function Jy(){return yc(un(),it())}function yc(t,e){return t.type&4?new Ky(e,t,Ki(t,e)):null}var YE=new RegExp(`^(\\d+)*(${Hv}|${Gv})*(.*)`);var e_=()=>null;function ml(t,e){return e_(t,e)}var vl=class{},yl=class{},ho=class{};function t_(t){let e=Error(`No component factory found for ${Ht(t)}.`);return e[n_]=t,e}var n_="ngComponent";var _l=class{resolveComponentFactory(e){throw t_(e)}},_c=(()=>{let e=class e{};e.NULL=new _l;let t=e;return t})(),Wr=class{},wc=(()=>{let e=class e{constructor(){this.destroyNode=null}};e.__NG_ELEMENT_ID__=()=>i_();let t=e;return t})();function i_(){let t=it(),e=un(),n=yi(e.index,t);return(hi(n)?n:t)[It]}var r_=(()=>{let e=class e{};e.\u0275prov=ot({token:e,providedIn:"root",factory:()=>null});let t=e;return t})(),za={};var Rh=new Set;function Ec(t){Rh.has(t)||(Rh.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function Oh(...t){}function s_(){let t=typeof Rr.requestAnimationFrame=="function",e=Rr[t?"requestAnimationFrame":"setTimeout"],n=Rr[t?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&e&&n){let i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i);let o=n[Zone.__symbol__("OriginalDelegate")];o&&(n=o)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:n}}var pt=class t{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Vi(!1),this.onMicrotaskEmpty=new Vi(!1),this.onStable=new Vi(!1),this.onError=new Vi(!1),typeof Zone>"u")throw new He(908,!1);Zone.assertZonePatched();let o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!i&&n,o.shouldCoalesceRunChangeDetection=i,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=s_().nativeRequestAnimationFrame,l_(o)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new He(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new He(909,!1)}run(e,n,i){return this._inner.run(e,n,i)}runTask(e,n,i,o){let h=this._inner,p=h.scheduleEventTask("NgZoneEvent: "+o,e,o_,Oh,Oh);try{return h.runTask(p,n,i)}finally{h.cancelTask(p)}}runGuarded(e,n,i){return this._inner.runGuarded(e,n,i)}runOutsideAngular(e){return this._outer.run(e)}},o_={};function Cc(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function a_(t){t.isCheckStableRunning||t.lastRequestAnimationFrameId!==-1||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Rr,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,wl(t),t.isCheckStableRunning=!0,Cc(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),wl(t))}function l_(t){let e=()=>{a_(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,i,o,h,p,v)=>{if(c_(v))return n.invokeTask(o,h,p,v);try{return Lh(t),n.invokeTask(o,h,p,v)}finally{(t.shouldCoalesceEventChangeDetection&&h.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&e(),Fh(t)}},onInvoke:(n,i,o,h,p,v,w)=>{try{return Lh(t),n.invoke(o,h,p,v,w)}finally{t.shouldCoalesceRunChangeDetection&&e(),Fh(t)}},onHasTask:(n,i,o,h)=>{n.hasTask(o,h),i===o&&(h.change=="microTask"?(t._hasPendingMicrotasks=h.microTask,wl(t),Cc(t)):h.change=="macroTask"&&(t.hasPendingMacrotasks=h.macroTask))},onHandleError:(n,i,o,h)=>(n.handleError(o,h),t.runOutsideAngular(()=>t.onError.emit(h)),!1)})}function wl(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.lastRequestAnimationFrameId!==-1?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function Lh(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Fh(t){t._nesting--,Cc(t)}function c_(t){return!Array.isArray(t)||t.length!==1?!1:t[0].data?.__ignore_ng_zone__===!0}var Of=(()=>{let e=class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let i=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let o of i)o()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};e.\u0275prov=ot({token:e,providedIn:"root",factory:()=>new e});let t=e;return t})();function El(t,e,n){let i=n?t.styles:null,o=n?t.classes:null,h=0;if(e!==null)for(let p=0;p<e.length;p++){let v=e[p];if(typeof v=="number")h=v;else if(h==1)o=lh(o,v);else if(h==2){let w=v,I=e[++p];i=lh(i,w+": "+I+";")}}n?t.styles=i:t.stylesWithoutHost=i,n?t.classes=o:t.classesWithoutHost=o}var Cl=class extends _c{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){let n=zi(e);return new fo(n,this.ngModule)}};function Nh(t){let e=[];for(let n in t){if(!t.hasOwnProperty(n))continue;let i=t[n];i!==void 0&&e.push({propName:Array.isArray(i)?i[0]:i,templateName:n})}return e}function u_(t){let e=t.toLowerCase();return e==="svg"?zm:e==="math"?$m:null}var Il=class{constructor(e,n){this.injector=e,this.parentInjector=n}get(e,n,i){i=mo(i);let o=this.injector.get(e,za,i);return o!==za||n===za?o:this.parentInjector.get(e,n,i)}},fo=class extends ho{get inputs(){let e=this.componentDef,n=e.inputTransforms,i=Nh(e.inputs);if(n!==null)for(let o of i)n.hasOwnProperty(o.propName)&&(o.transform=n[o.propName]);return i}get outputs(){return Nh(this.componentDef.outputs)}constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=Im(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}create(e,n,i,o){let h=Ve(null);try{o=o||this.ngModule;let p=o instanceof Gn?o:o?.injector;p&&this.componentDef.getStandaloneInjector!==null&&(p=this.componentDef.getStandaloneInjector(p)||p);let v=p?new Il(e,p):e,w=v.get(Wr,null);if(w===null)throw new He(407,!1);let I=v.get(r_,null),S=v.get(Of,null),x=v.get(vl,null),M={rendererFactory:w,sanitizer:I,inlineEffectRunner:null,afterRenderEventManager:S,changeDetectionScheduler:x},R=w.createRenderer(null,this.componentDef),O=this.componentDef.selectors[0][0]||"div",B=i?py(R,i,this.componentDef.encapsulation,v):ef(R,O,u_(O)),V=512;this.componentDef.signals?V|=4096:this.componentDef.onPush||(V|=16);let H=null;B!==null&&(H=ac(B,v,!0));let Y=gc(0,null,null,1,0,null,null,null,null,null,null),Z=Eo(null,Y,null,V,null,null,M,R,v,null,H);Ql(Z);let he,ce;try{let ye=this.componentDef,be,_=null;ye.findHostDirectiveDefs?(be=[],_=new Map,ye.findHostDirectiveDefs(ye,be,_),be.push(ye)):be=[ye];let ue=h_(Z,B),Ee=d_(ue,B,ye,be,Z,M,R);ce=$l(Y,cn),B&&p_(R,ye,B,i),n!==void 0&&m_(ce,this.ngContentSelectors,n),he=g_(Ee,ye,be,_,Z,[v_]),mc(Y,Z,null)}finally{Kl()}return new Dl(this.componentType,he,Ki(ce,Z),Z,ce)}finally{Ve(h)}}},Dl=class extends yl{constructor(e,n,i,o,h){super(),this.location=i,this._rootLView=o,this._tNode=h,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new Gr(o,void 0,!1),this.componentType=e}setInput(e,n){let i=this._tNode.inputs,o;if(i!==null&&(o=i[e])){if(this.previousInputValues??=new Map,this.previousInputValues.has(e)&&Object.is(this.previousInputValues.get(e),n))return;let h=this._rootLView;pc(h[Re],h,o,e,n),this.previousInputValues.set(e,n);let p=yi(this._tNode.index,h);vc(p)}}get injector(){return new di(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}};function h_(t,e){let n=t[Re],i=cn;return t[i]=e,Co(n,i,2,"#host",null)}function d_(t,e,n,i,o,h,p){let v=o[Re];f_(i,t,e,p);let w=null;e!==null&&(w=ac(e,o[$i]));let I=h.rendererFactory.createRenderer(e,n),S=16;n.signals?S=4096:n.onPush&&(S=64);let x=Eo(o,pf(n),null,S,o[t.index],t,h,I,null,null,w);return v.firstCreatePass&&dl(v,t,i.length-1),Io(o,x),o[t.index]=x}function f_(t,e,n,i){for(let o of t)e.mergedAttrs=Ul(e.mergedAttrs,o.hostAttrs);e.mergedAttrs!==null&&(El(e,e.mergedAttrs,!0),n!==null&&af(i,n,e))}function g_(t,e,n,i,o,h){let p=un(),v=o[Re],w=$t(p,o);vf(v,o,p,n,null,i);for(let S=0;S<n.length;S++){let x=p.directiveStart+S,M=qi(o,v,x,p);vi(M,o)}yf(v,o,p),w&&vi(w,o);let I=qi(o,v,p.directiveStart+p.componentOffset,p);if(t[Yt]=o[Yt]=I,h!==null)for(let S of h)S(I,e);return df(v,p,o),I}function p_(t,e,n,i){if(i)Ka(t,n,["ng-version","17.3.9"]);else{let{attrs:o,classes:h}=Dm(e.selectors[0]);o&&Ka(t,n,o),h&&h.length>0&&of(t,n,h.join(" "))}}function m_(t,e,n){let i=t.projection=[];for(let o=0;o<e.length;o++){let h=n[o];i.push(h!=null?Array.from(h):null)}}function v_(){let t=un();tc(it()[Re],t)}var Do=(()=>{let e=class e{};e.__NG_ELEMENT_ID__=y_;let t=e;return t})();function y_(){let t=un();return Ff(t,it())}var __=Do,Lf=class extends __{constructor(e,n,i){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=i}get element(){return Ki(this._hostTNode,this._hostLView)}get injector(){return new di(this._hostTNode,this._hostLView)}get parentInjector(){let e=nc(this._hostTNode,this._hostLView);if(Nd(e)){let n=ao(e,this._hostLView),i=oo(e),o=n[Re].data[i+8];return new di(o,n)}else return new di(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){let n=Ph(this._lContainer);return n!==null&&n[e]||null}get length(){return this._lContainer.length-Ct}createEmbeddedView(e,n,i){let o,h;typeof i=="number"?o=i:i!=null&&(o=i.index,h=i.injector);let p=ml(this._lContainer,e.ssrId),v=e.createEmbeddedViewImpl(n||{},h,p);return this.insertImpl(v,o,gl(this._hostTNode,p)),v}createComponent(e,n,i,o,h){let p=e&&!Vm(e),v;if(p)v=n;else{let O=n||{};v=O.index,i=O.injector,o=O.projectableNodes,h=O.environmentInjector||O.ngModuleRef}let w=p?e:new fo(zi(e)),I=i||this.parentInjector;if(!h&&w.ngModule==null){let B=(p?I:this.parentInjector).get(Gn,null);B&&(h=B)}let S=zi(w.componentType??{}),x=ml(this._lContainer,S?.id??null),M=x?.firstChild??null,R=w.create(I,o,M,h);return this.insertImpl(R.hostView,v,gl(this._hostTNode,x)),R}insert(e,n){return this.insertImpl(e,n,!0)}insertImpl(e,n,i){let o=e._lView;if(Qm(o)){let v=this.indexOf(e);if(v!==-1)this.detach(v);else{let w=o[ht],I=new Lf(w,w[zt],w[ht]);I.detach(I.indexOf(e))}}let h=this._adjustIndex(n),p=this._lContainer;return bf(p,o,h,i),e.attachToViewContainerRef(),Zh($a(p),h,e),e}move(e,n){return this.insert(e,n)}indexOf(e){let n=Ph(this._lContainer);return n!==null?n.indexOf(e):-1}remove(e){let n=this._adjustIndex(e,-1),i=lo(this._lContainer,n);i&&(eo($a(this._lContainer),n),cc(i[Re],i))}detach(e){let n=this._adjustIndex(e,-1),i=lo(this._lContainer,n);return i&&eo($a(this._lContainer),n)!=null?new Gr(i):null}_adjustIndex(e,n=0){return e??this.length+n}};function Ph(t){return t[ro]}function $a(t){return t[ro]||(t[ro]=[])}function Ff(t,e){let n,i=e[t.index];return Cn(i)?n=i:(n=_f(i,e,null,t),e[t.index]=n,Io(e,n)),E_(n,e,t,i),new Lf(n,t,e)}function w_(t,e){let n=t[It],i=n.createComment(""),o=$t(e,t),h=uc(n,o);return co(n,h,i,ry(n,o),!1),i}var E_=D_,C_=()=>!1;function I_(t,e,n){return C_(t,e,n)}function D_(t,e,n,i){if(t[pi])return;let o;n.type&8?o=_n(i):o=w_(e,n),t[pi]=o}var bl=class t{constructor(e){this.queryList=e,this.matches=null}clone(){return new t(this.queryList)}setDirty(){this.queryList.setDirty()}},Tl=class t{constructor(e=[]){this.queries=e}createEmbeddedView(e){let n=e.queries;if(n!==null){let i=e.contentQueries!==null?e.contentQueries[0]:n.length,o=[];for(let h=0;h<i;h++){let p=n.getByIndex(h),v=this.queries[p.indexInDeclarationView];o.push(v.clone())}return new t(o)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}finishViewCreation(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let n=0;n<this.queries.length;n++)Ic(e,n).matches!==null&&this.queries[n].setDirty()}},Sl=class{constructor(e,n,i=null){this.flags=n,this.read=i,typeof e=="string"?this.predicate=O_(e):this.predicate=e}},xl=class t{constructor(e=[]){this.queries=e}elementStart(e,n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementStart(e,n)}elementEnd(e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(e)}embeddedTView(e){let n=null;for(let i=0;i<this.length;i++){let o=n!==null?n.length:0,h=this.getByIndex(i).embeddedTView(e,o);h&&(h.indexInDeclarationView=i,n!==null?n.push(h):n=[h])}return n!==null?new t(n):null}template(e,n){for(let i=0;i<this.queries.length;i++)this.queries[i].template(e,n)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}},Al=class t{constructor(e,n=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(e,n){this.isApplyingToNode(n)&&this.matchTNode(e,n)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,n){this.elementStart(e,n)}embeddedTView(e,n){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,n),new t(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let n=this._declarationNodeIndex,i=e.parent;for(;i!==null&&i.type&8&&i.index!==n;)i=i.parent;return n===(i!==null?i.index:-1)}return this._appliesToNextNode}matchTNode(e,n){let i=this.metadata.predicate;if(Array.isArray(i))for(let o=0;o<i.length;o++){let h=i[o];this.matchTNodeWithReadOption(e,n,b_(n,h)),this.matchTNodeWithReadOption(e,n,Zs(n,e,h,!1,!1))}else i===Hr?n.type&4&&this.matchTNodeWithReadOption(e,n,-1):this.matchTNodeWithReadOption(e,n,Zs(n,e,i,!1,!1))}matchTNodeWithReadOption(e,n,i){if(i!==null){let o=this.metadata.read;if(o!==null)if(o===_i||o===Do||o===Hr&&n.type&4)this.addMatch(n.index,-2);else{let h=Zs(n,e,o,!1,!1);h!==null&&this.addMatch(n.index,h)}else this.addMatch(n.index,i)}}addMatch(e,n){this.matches===null?this.matches=[e,n]:this.matches.push(e,n)}};function b_(t,e){let n=t.localNames;if(n!==null){for(let i=0;i<n.length;i+=2)if(n[i]===e)return n[i+1]}return null}function T_(t,e){return t.type&11?Ki(t,e):t.type&4?yc(t,e):null}function S_(t,e,n,i){return n===-1?T_(e,t):n===-2?x_(t,e,i):qi(t,t[Re],n,e)}function x_(t,e,n){if(n===_i)return Ki(e,t);if(n===Hr)return yc(e,t);if(n===Do)return Ff(e,t)}function Nf(t,e,n,i){let o=e[yn].queries[i];if(o.matches===null){let h=t.data,p=n.matches,v=[];for(let w=0;p!==null&&w<p.length;w+=2){let I=p[w];if(I<0)v.push(null);else{let S=h[I];v.push(S_(e,S,p[w+1],n.metadata.read))}}o.matches=v}return o.matches}function Ml(t,e,n,i){let o=t.queries.getByIndex(n),h=o.matches;if(h!==null){let p=Nf(t,e,o,n);for(let v=0;v<h.length;v+=2){let w=h[v];if(w>0)i.push(p[v/2]);else{let I=h[v+1],S=e[-w];for(let x=Ct;x<S.length;x++){let M=S[x];M[zr]===M[ht]&&Ml(M[Re],M,I,i)}if(S[Xi]!==null){let x=S[Xi];for(let M=0;M<x.length;M++){let R=x[M];Ml(R[Re],R,I,i)}}}}}return i}function A_(t,e){return t[yn].queries[e].queryList}function M_(t,e,n){let i=new cl((n&4)===4);return yy(t,e,i,i.destroy),(e[yn]??=new Tl).queries.push(new bl(i))-1}function R_(t,e,n){let i=In();return i.firstCreatePass&&(L_(i,new Sl(t,e,n),-1),(e&2)===2&&(i.staticViewQueries=!0)),M_(i,it(),e)}function O_(t){return t.split(",").map(e=>e.trim())}function L_(t,e,n){t.queries===null&&(t.queries=new xl),t.queries.track(new Al(e,n))}function Ic(t,e){return t.queries.getByIndex(e)}function F_(t,e){let n=t[Re],i=Ic(n,e);return i.crossesNgTemplate?Ml(n,t,e,[]):Nf(n,t,i,e)}var Zi=class{};var go=class extends Zi{constructor(e){super(),this.componentFactoryResolver=new Cl(this),this.instance=null;let n=new no([...e.providers,{provide:Zi,useValue:this},{provide:_c,useValue:this.componentFactoryResolver}],e.parent||Hl(),e.debugName,new Set(["environment"]));this.injector=n,e.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}};function N_(t,e,n=null){return new go({providers:t,parent:e,debugName:n,runEnvironmentInitializers:!0}).injector}var Pf=(()=>{let e=class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Mr(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let i=this.taskId++;return this.pendingTasks.add(i),i}remove(i){this.pendingTasks.delete(i),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function kf(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function P_(t,e,n){return t[e]=n}function Dc(t,e,n){let i=t[e];return Object.is(i,n)?!1:(t[e]=n,!0)}function k_(t){return(t.flags&32)===32}function B_(t,e,n,i,o,h,p,v,w){let I=e.consts,S=Co(e,t,4,p||null,so(I,v));mf(e,n,S,so(I,w)),tc(e,S);let x=S.tView=gc(2,S,i,o,h,e.directiveRegistry,e.pipeRegistry,null,e.schemas,I,null);return e.queries!==null&&(e.queries.template(e,S),x.queries=e.queries.embeddedTView(S)),S}function bc(t,e,n,i,o,h,p,v){let w=it(),I=In(),S=t+cn,x=I.firstCreatePass?B_(S,I,w,e,n,i,o,h,p):I.data[S];Xr(x,!1);let M=j_(I,w,x,t);Jl()&&hc(I,w,M,x),vi(M,w);let R=_f(M,w,M,x);return w[S]=R,Io(w,R),I_(R,x,w),zl(x)&&ff(I,w,x),p!=null&&gf(w,x,v),bc}var j_=U_;function U_(t,e,n,i){return ec(!0),e[It].createComment("")}function bo(t,e,n){let i=it(),o=bd();if(Dc(i,o,e)){let h=In(),p=gv();Cy(h,p,i,t,e,i[It],n,!1)}return bo}function kh(t,e,n,i,o){let h=e.inputs,p=o?"class":"style";pc(t,n,h[p],p,i)}function Bf(t,e,n){Ec("NgControlFlow");let i=it(),o=bd(),h=V_(i,cn+t),p=0;if(Dc(i,o,e)){let v=Ve(null);try{if(Uy(h,p),e!==-1){let w=G_(i[Re],cn+e),I=ml(h,w.tView.ssrId),S=Df(i,w,n,{dehydratedView:I});bf(h,S,p,gl(w,I))}}finally{Ve(v)}}else{let v=jy(h,p);v!==void 0&&(v[Yt]=n)}}function V_(t,e){return t[e]}function G_(t,e){return $l(t,e)}function H_(t,e,n,i,o,h){let p=e.consts,v=so(p,o),w=Co(e,t,2,i,v);return mf(e,n,w,so(p,h)),w.attrs!==null&&El(w,w.attrs,!1),w.mergedAttrs!==null&&El(w,w.mergedAttrs,!0),e.queries!==null&&e.queries.elementStart(e,w),w}function Wn(t,e,n,i){let o=it(),h=In(),p=cn+t,v=o[It],w=h.firstCreatePass?H_(p,h,o,e,n,i):h.data[p],I=W_(h,o,w,v,e,t);o[p]=I;let S=zl(w);return Xr(w,!0),af(v,I,w),!k_(w)&&Jl()&&hc(h,o,I,w),ev()===0&&vi(I,o),tv(),S&&(ff(h,o,w),df(h,w,o)),i!==null&&gf(o,w),Wn}function hn(){let t=un();Dd()?av():(t=t.parent,Xr(t,!1));let e=t;rv(e)&&sv(),nv();let n=In();return n.firstCreatePass&&(tc(n,t),dd(t)&&n.queries.elementEnd(t)),e.classesWithoutHost!=null&&_v(e)&&kh(n,e,it(),e.classesWithoutHost,!0),e.stylesWithoutHost!=null&&wv(e)&&kh(n,e,it(),e.stylesWithoutHost,!1),hn}function Dn(t,e,n,i){return Wn(t,e,n,i),hn(),Dn}var W_=(t,e,n,i,o,h)=>(ec(!0),ef(i,o,pv()));function jf(){return it()}var po="en-US";var Y_=po;function z_(t){typeof t=="string"&&(Y_=t.toLowerCase().replace(/_/g,"-"))}function er(t,e,n,i){let o=it(),h=In(),p=un();return X_(h,o,o[It],p,t,e,i),er}function $_(t,e,n,i){let o=t.cleanup;if(o!=null)for(let h=0;h<o.length-1;h+=2){let p=o[h];if(p===n&&o[h+1]===i){let v=e[kr],w=o[h+2];return v.length>w?v[w]:null}typeof p=="string"&&(h+=2)}return null}function X_(t,e,n,i,o,h,p){let v=zl(i),I=t.firstCreatePass&&Cf(t),S=e[Yt],x=Ef(e),M=!0;if(i.type&3||p){let B=$t(i,e),V=p?p(B):B,H=x.length,Y=p?he=>p(_n(he[i.index])):i.index,Z=null;if(!p&&v&&(Z=$_(t,e,o,i.index)),Z!==null){let he=Z.__ngLastListenerFn__||Z;he.__ngNextListenerFn__=h,Z.__ngLastListenerFn__=h,M=!1}else{h=jh(i,e,S,h,!1);let he=n.listen(V,o,h);x.push(h,he),I&&I.push(o,Y,H,H+1)}}else h=jh(i,e,S,h,!1);let R=i.outputs,O;if(M&&R!==null&&(O=R[o])){let B=O.length;if(B)for(let V=0;V<B;V+=2){let H=O[V],Y=O[V+1],ce=e[H][Y].subscribe(h),ye=x.length;x.push(h,ce),I&&I.push(o,i.index,ye,-(ye+1))}}}function Bh(t,e,n,i){let o=Ve(null);try{return sn(6,e,n),n(i)!==!1}catch(h){return If(t,h),!1}finally{sn(7,e,n),Ve(o)}}function jh(t,e,n,i,o){return function h(p){if(p===Function)return i;let v=t.componentOffset>-1?yi(t.index,e):e;vc(v);let w=Bh(e,n,i,p),I=h.__ngNextListenerFn__;for(;I;)w=Bh(e,n,I,p)&&w,I=I.__ngNextListenerFn__;return o&&w===!1&&p.preventDefault(),w}}function Zr(t,e,n){R_(t,e,n)}function Qr(t){let e=it(),n=In(),i=Td();Zl(i+1);let o=Ic(n,i);if(t.dirty&&Zm(e)===((o.metadata.flags&2)===2)){if(o.matches===null)t.reset([]);else{let h=F_(e,i);t.reset(h,Fv),t.notifyOnChanges()}return!0}return!1}function Kr(){return A_(it(),Td())}function tr(t,e=""){let n=it(),i=In(),o=t+cn,h=i.firstCreatePass?Co(i,o,1,e,null):i.data[o],p=q_(i,n,h,e,t);n[o]=p,Jl()&&hc(i,n,p,h),Xr(h,!1)}var q_=(t,e,n,i,o)=>(ec(!0),$v(e[It],i));var Z_=(()=>{let e=class e{constructor(i){this._injector=i,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(i){if(!i.standalone)return null;if(!this.cachedInjectors.has(i)){let o=ad(!1,i.type),h=o.length>0?N_([o],this._injector,`Standalone[${i.type.name}]`):null;this.cachedInjectors.set(i,h)}return this.cachedInjectors.get(i)}ngOnDestroy(){try{for(let i of this.cachedInjectors.values())i!==null&&i.destroy()}finally{this.cachedInjectors.clear()}}};e.\u0275prov=ot({token:e,providedIn:"environment",factory:()=>new e(Xe(Gn))});let t=e;return t})();function nr(t){Ec("NgStandalone"),t.getStandaloneInjector=e=>e.get(Z_).getOrCreateStandaloneInjector(t)}function Tc(t,e,n,i){return K_(it(),lv(),t,e,n,i)}function Q_(t,e){let n=t[e];return n===fc?void 0:n}function K_(t,e,n,i,o,h){let p=e+n;return Dc(t,p,o)?P_(t,p+1,h?i.call(h,o):i(o)):Q_(t,p+1)}var Uf=new Ke("");function Sc(t){return!!t&&typeof t.then=="function"}function Vf(t){return!!t&&typeof t.subscribe=="function"}var J_=new Ke(""),Gf=(()=>{let e=class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,o)=>{this.resolve=i,this.reject=o}),this.appInits=ut(J_,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let i=[];for(let h of this.appInits){let p=h();if(Sc(p))i.push(p);else if(Vf(p)){let v=new Promise((w,I)=>{p.subscribe({complete:w,error:I})});i.push(v)}}let o=()=>{this.done=!0,this.resolve()};Promise.all(i).then(()=>{o()}).catch(h=>{this.reject(h)}),i.length===0&&o(),this.initialized=!0}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})(),e0=new Ke("");function t0(){Xu(()=>{throw new He(600,!1)})}function n0(t){return t.isBoundToModule}function i0(t,e,n){try{let i=n();return Sc(i)?i.catch(o=>{throw e.runOutsideAngular(()=>t.handleError(o)),o}):i}catch(i){throw e.runOutsideAngular(()=>t.handleError(i)),i}}var xc=(()=>{let e=class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=ut(Yd),this.afterRenderEffectManager=ut(Of),this.externalTestViews=new Set,this.beforeRender=new Un,this.afterTick=new Un,this.componentTypes=[],this.components=[],this.isStable=ut(Pf).hasPendingTasks.pipe(Ba(i=>!i)),this._injector=ut(Gn)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(i,o){let h=i instanceof ho;if(!this._injector.get(Gf).done){let R=!h&&Sm(i),O=!1;throw new He(405,O)}let v;h?v=i:v=this._injector.get(_c).resolveComponentFactory(i),this.componentTypes.push(v.componentType);let w=n0(v)?void 0:this._injector.get(Zi),I=o||v.selector,S=v.create(ic.NULL,[],I,w),x=S.location.nativeElement,M=S.injector.get(Uf,null);return M?.registerApplication(x),S.onDestroy(()=>{this.detachView(S.hostView),Xa(this.components,S),M?.unregisterApplication(x)}),this._loadComponent(S),S}tick(){this._tick(!0)}_tick(i){if(this._runningTick)throw new He(101,!1);let o=Ve(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(i)}catch(h){this.internalErrorHandler(h)}finally{this.afterTick.next(),this._runningTick=!1,Ve(o)}}detectChangesInAttachedViews(i){let o=0,h=this.afterRenderEffectManager;for(;;){if(o===Sf)throw new He(103,!1);if(i){let p=o===0;this.beforeRender.next(p);for(let{_lView:v,notifyErrorHandler:w}of this._views)r0(v,p,w)}if(o++,h.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:p})=>Rl(p))&&(h.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:p})=>Rl(p))))break}}attachView(i){let o=i;this._views.push(o),o.attachToAppRef(this)}detachView(i){let o=i;Xa(this._views,o),o.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i);let o=this._injector.get(e0,[]);[...this._bootstrapListeners,...o].forEach(h=>h(i))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(i=>i()),this._views.slice().forEach(i=>i.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(i){return this._destroyListeners.push(i),()=>Xa(this._destroyListeners,i)}destroy(){if(this._destroyed)throw new He(406,!1);let i=this._injector;i.destroy&&!i.destroyed&&i.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function Xa(t,e){let n=t.indexOf(e);n>-1&&t.splice(n,1)}function r0(t,e,n){!e&&!Rl(t)||s0(t,n,e)}function Rl(t){return ql(t)}function s0(t,e,n){let i;n?(i=0,t[Te]|=1024):t[Te]&64?i=0:i=1,xf(t,e,i)}var o0=(()=>{let e=class e{constructor(){this.zone=ut(pt),this.applicationRef=ut(xc)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function a0(t){return[{provide:pt,useFactory:t},{provide:Pr,multi:!0,useFactory:()=>{let e=ut(o0,{optional:!0});return()=>e.initialize()}},{provide:Pr,multi:!0,useFactory:()=>{let e=ut(h0);return()=>{e.initialize()}}},{provide:Yd,useFactory:l0}]}function l0(){let t=ut(pt),e=ut(wn);return n=>t.runOutsideAngular(()=>e.handleError(n))}function c0(t){let e=a0(()=>new pt(u0(t)));return od([[],e])}function u0(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var h0=(()=>{let e=class e{constructor(){this.subscription=new Et,this.initialized=!1,this.zone=ut(pt),this.pendingTasks=ut(Pf)}initialize(){if(this.initialized)return;this.initialized=!0;let i=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(i=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{pt.assertNotInAngularZone(),queueMicrotask(()=>{i!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(i),i=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{pt.assertInAngularZone(),i??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();function d0(){return typeof $localize<"u"&&$localize.locale||po}var Ac=new Ke("",{providedIn:"root",factory:()=>ut(Ac,Be.Optional|Be.SkipSelf)||d0()});var Hf=new Ke("");var Ks=null;function f0(t=[],e){return ic.create({name:e,providers:[{provide:vo,useValue:"platform"},{provide:Hf,useValue:new Set([()=>Ks=null])},...t]})}function g0(t=[]){if(Ks)return Ks;let e=f0(t);return Ks=e,t0(),p0(e),e}function p0(t){t.get(sc,null)?.forEach(n=>n())}var Ol=class{constructor(){}supports(e){return e instanceof Map||kf(e)}create(){return new Ll}},Ll=class{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return this._additionsHead!==null||this._changesHead!==null||this._removalsHead!==null}forEachItem(e){let n;for(n=this._mapHead;n!==null;n=n._next)e(n)}forEachPreviousItem(e){let n;for(n=this._previousMapHead;n!==null;n=n._nextPrevious)e(n)}forEachChangedItem(e){let n;for(n=this._changesHead;n!==null;n=n._nextChanged)e(n)}forEachAddedItem(e){let n;for(n=this._additionsHead;n!==null;n=n._nextAdded)e(n)}forEachRemovedItem(e){let n;for(n=this._removalsHead;n!==null;n=n._nextRemoved)e(n)}diff(e){if(!e)e=new Map;else if(!(e instanceof Map||kf(e)))throw new He(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(e,(i,o)=>{if(n&&n.key===o)this._maybeAddToChanges(n,i),this._appendAfter=n,n=n._next;else{let h=this._getOrCreateRecordForKey(o,i);n=this._insertBeforeOrAppend(n,h)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let i=n;i!==null;i=i._nextRemoved)i===this._mapHead&&(this._mapHead=null),this._records.delete(i.key),i._nextRemoved=i._next,i.previousValue=i.currentValue,i.currentValue=null,i._prev=null,i._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(e,n){if(e){let i=e._prev;return n._next=e,n._prev=i,e._prev=n,i&&(i._next=n),e===this._mapHead&&(this._mapHead=n),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(e,n){if(this._records.has(e)){let o=this._records.get(e);this._maybeAddToChanges(o,n);let h=o._prev,p=o._next;return h&&(h._next=p),p&&(p._prev=h),o._next=null,o._prev=null,o}let i=new Fl(e);return this._records.set(e,i),i.currentValue=n,this._addToAdditions(i),i}_reset(){if(this.isDirty){let e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;e!==null;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;e!==null;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;e!=null;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(e,n){Object.is(n,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=n,this._addToChanges(e))}_addToAdditions(e){this._additionsHead===null?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}_addToChanges(e){this._changesHead===null?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}_forEach(e,n){e instanceof Map?e.forEach(n):Object.keys(e).forEach(i=>n(e[i],i))}},Fl=class{constructor(e){this.key=e,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}};function Uh(){return new Mc([new Ol])}var Mc=(()=>{let e=class e{constructor(i){this.factories=i}static create(i,o){if(o){let h=o.factories.slice();i=i.concat(h)}return new e(i)}static extend(i){return{provide:e,useFactory:o=>e.create(i,o||Uh()),deps:[[e,new cm,new qh]]}}find(i){let o=this.factories.find(h=>h.supports(i));if(o)return o;throw new He(901,!1)}};e.\u0275prov=ot({token:e,providedIn:"root",factory:Uh});let t=e;return t})();function Wf(t){try{let{rootComponent:e,appProviders:n,platformProviders:i}=t,o=g0(i),h=[c0(),...n||[]],v=new go({providers:h,parent:o,debugName:"",runEnvironmentInitializers:!1}).injector,w=v.get(pt);return w.run(()=>{v.resolveInjectorInitializers();let I=v.get(wn,null),S;w.runOutsideAngular(()=>{S=w.onError.subscribe({next:R=>{I.handleError(R)}})});let x=()=>v.destroy(),M=o.get(Hf);return M.add(x),v.onDestroy(()=>{S.unsubscribe(),M.delete(x)}),i0(I,w,()=>{let R=v.get(Gf);return R.runInitializers(),R.donePromise.then(()=>{let O=v.get(Ac,po);z_(O||po);let B=v.get(xc);return e!==void 0&&B.bootstrap(e),B})})})}catch(e){return Promise.reject(e)}}var Yf=null;function Rc(){return Yf}function zf(t){Yf??=t}var To=class{};var Yn=new Ke("");function $f(t,e){e=encodeURIComponent(e);for(let n of t.split(";")){let i=n.indexOf("="),[o,h]=i==-1?[n,""]:[n.slice(0,i),n.slice(i+1)];if(o.trim()===e)return decodeURIComponent(h)}return null}var Xf=(()=>{let e=class e{constructor(i,o,h){this._ngEl=i,this._differs=o,this._renderer=h,this._ngStyle=null,this._differ=null}set ngStyle(i){this._ngStyle=i,!this._differ&&i&&(this._differ=this._differs.find(i).create())}ngDoCheck(){if(this._differ){let i=this._differ.diff(this._ngStyle);i&&this._applyChanges(i)}}_setStyle(i,o){let[h,p]=i.split("."),v=h.indexOf("-")===-1?void 0:Hn.DashCase;o!=null?this._renderer.setStyle(this._ngEl.nativeElement,h,p?`${o}${p}`:o,v):this._renderer.removeStyle(this._ngEl.nativeElement,h,v)}_applyChanges(i){i.forEachRemovedItem(o=>this._setStyle(o.key,null)),i.forEachAddedItem(o=>this._setStyle(o.key,o.currentValue)),i.forEachChangedItem(o=>this._setStyle(o.key,o.currentValue))}};e.\u0275fac=function(o){return new(o||e)(qr(_i),qr(Mc),qr(wc))},e.\u0275dir=td({type:e,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0});let t=e;return t})();var qf="browser",E0="server";function Oc(t){return t===E0}var So=class{};var Nc=class extends To{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Pc=class t extends Nc{static makeCurrent(){zf(new t)}onAndCancel(e,n,i){return e.addEventListener(n,i),()=>{e.removeEventListener(n,i)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return n=n||this.getDefaultDocument(),n.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return n==="window"?window:n==="document"?e:n==="body"?e.body:null}getBaseHref(e){let n=I0();return n==null?null:D0(n)}resetBaseElement(){es=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return $f(document.cookie,e)}},es=null;function I0(){return es=es||document.querySelector("base"),es?es.getAttribute("href"):null}function D0(t){return new URL(t,document.baseURI).pathname}var b0=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(o){return new(o||e)},e.\u0275prov=ot({token:e,factory:e.\u0275fac});let t=e;return t})(),kc=new Ke(""),Jf=(()=>{let e=class e{constructor(i,o){this._zone=o,this._eventNameToPlugin=new Map,i.forEach(h=>{h.manager=this}),this._plugins=i.slice().reverse()}addEventListener(i,o,h){return this._findPluginFor(o).addEventListener(i,o,h)}getZone(){return this._zone}_findPluginFor(i){let o=this._eventNameToPlugin.get(i);if(o)return o;if(o=this._plugins.find(p=>p.supports(i)),!o)throw new He(5101,!1);return this._eventNameToPlugin.set(i,o),o}};e.\u0275fac=function(o){return new(o||e)(Xe(kc),Xe(pt))},e.\u0275prov=ot({token:e,factory:e.\u0275fac});let t=e;return t})(),xo=class{constructor(e){this._doc=e}},Lc="ng-app-id",eg=(()=>{let e=class e{constructor(i,o,h,p={}){this.doc=i,this.appId=o,this.nonce=h,this.platformId=p,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Oc(p),this.resetHostNodes()}addStyles(i){for(let o of i)this.changeUsageCount(o,1)===1&&this.onStyleAdded(o)}removeStyles(i){for(let o of i)this.changeUsageCount(o,-1)<=0&&this.onStyleRemoved(o)}ngOnDestroy(){let i=this.styleNodesInDOM;i&&(i.forEach(o=>o.remove()),i.clear());for(let o of this.getAllStyles())this.onStyleRemoved(o);this.resetHostNodes()}addHost(i){this.hostNodes.add(i);for(let o of this.getAllStyles())this.addStyleToHost(i,o)}removeHost(i){this.hostNodes.delete(i)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(i){for(let o of this.hostNodes)this.addStyleToHost(o,i)}onStyleRemoved(i){let o=this.styleRef;o.get(i)?.elements?.forEach(h=>h.remove()),o.delete(i)}collectServerRenderedStyles(){let i=this.doc.head?.querySelectorAll(`style[${Lc}="${this.appId}"]`);if(i?.length){let o=new Map;return i.forEach(h=>{h.textContent!=null&&o.set(h.textContent,h)}),o}return null}changeUsageCount(i,o){let h=this.styleRef;if(h.has(i)){let p=h.get(i);return p.usage+=o,p.usage}return h.set(i,{usage:o,elements:[]}),o}getStyleElement(i,o){let h=this.styleNodesInDOM,p=h?.get(o);if(p?.parentNode===i)return h.delete(o),p.removeAttribute(Lc),p;{let v=this.doc.createElement("style");return this.nonce&&v.setAttribute("nonce",this.nonce),v.textContent=o,this.platformIsServer&&v.setAttribute(Lc,this.appId),i.appendChild(v),v}}addStyleToHost(i,o){let h=this.getStyleElement(i,o),p=this.styleRef,v=p.get(o)?.elements;v?v.push(h):p.set(o,{elements:[h],usage:1})}resetHostNodes(){let i=this.hostNodes;i.clear(),i.add(this.doc.head)}};e.\u0275fac=function(o){return new(o||e)(Xe(Yn),Xe(rc),Xe(oc,8),Xe(Ji))},e.\u0275prov=ot({token:e,factory:e.\u0275fac});let t=e;return t})(),Fc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},jc=/%COMP%/g,tg="%COMP%",T0=`_nghost-${tg}`,S0=`_ngcontent-${tg}`,x0=!0,A0=new Ke("",{providedIn:"root",factory:()=>x0});function M0(t){return S0.replace(jc,t)}function R0(t){return T0.replace(jc,t)}function ng(t,e){return e.map(n=>n.replace(jc,t))}var Zf=(()=>{let e=class e{constructor(i,o,h,p,v,w,I,S=null){this.eventManager=i,this.sharedStylesHost=o,this.appId=h,this.removeStylesOnCompDestroy=p,this.doc=v,this.platformId=w,this.ngZone=I,this.nonce=S,this.rendererByCompId=new Map,this.platformIsServer=Oc(w),this.defaultRenderer=new ts(i,v,I,this.platformIsServer)}createRenderer(i,o){if(!i||!o)return this.defaultRenderer;this.platformIsServer&&o.encapsulation===an.ShadowDom&&(o=li(jn({},o),{encapsulation:an.Emulated}));let h=this.getOrCreateRenderer(i,o);return h instanceof Ao?h.applyToHost(i):h instanceof ns&&h.applyStyles(),h}getOrCreateRenderer(i,o){let h=this.rendererByCompId,p=h.get(o.id);if(!p){let v=this.doc,w=this.ngZone,I=this.eventManager,S=this.sharedStylesHost,x=this.removeStylesOnCompDestroy,M=this.platformIsServer;switch(o.encapsulation){case an.Emulated:p=new Ao(I,S,o,this.appId,x,v,w,M);break;case an.ShadowDom:return new Bc(I,S,i,o,v,w,this.nonce,M);default:p=new ns(I,S,o,x,v,w,M);break}h.set(o.id,p)}return p}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(o){return new(o||e)(Xe(Jf),Xe(eg),Xe(rc),Xe(A0),Xe(Yn),Xe(Ji),Xe(pt),Xe(oc))},e.\u0275prov=ot({token:e,factory:e.\u0275fac});let t=e;return t})(),ts=class{constructor(e,n,i,o){this.eventManager=e,this.doc=n,this.ngZone=i,this.platformIsServer=o,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,n){return n?this.doc.createElementNS(Fc[n]||n,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,n){(Qf(e)?e.content:e).appendChild(n)}insertBefore(e,n,i){e&&(Qf(e)?e.content:e).insertBefore(n,i)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let i=typeof e=="string"?this.doc.querySelector(e):e;if(!i)throw new He(-5104,!1);return n||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,i,o){if(o){n=o+":"+n;let h=Fc[o];h?e.setAttributeNS(h,n,i):e.setAttribute(n,i)}else e.setAttribute(n,i)}removeAttribute(e,n,i){if(i){let o=Fc[i];o?e.removeAttributeNS(o,n):e.removeAttribute(`${i}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,i,o){o&(Hn.DashCase|Hn.Important)?e.style.setProperty(n,i,o&Hn.Important?"important":""):e.style[n]=i}removeStyle(e,n,i){i&Hn.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,i){e!=null&&(e[n]=i)}setValue(e,n){e.nodeValue=n}listen(e,n,i){if(typeof e=="string"&&(e=Rc().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${n}`);return this.eventManager.addEventListener(e,n,this.decoratePreventDefault(i))}decoratePreventDefault(e){return n=>{if(n==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(n)):e(n))===!1&&n.preventDefault()}}};function Qf(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var Bc=class extends ts{constructor(e,n,i,o,h,p,v,w){super(e,h,p,w),this.sharedStylesHost=n,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let I=ng(o.id,o.styles);for(let S of I){let x=document.createElement("style");v&&x.setAttribute("nonce",v),x.textContent=S,this.shadowRoot.appendChild(x)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,i){return super.insertBefore(this.nodeOrShadowRoot(e),n,i)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},ns=class extends ts{constructor(e,n,i,o,h,p,v,w){super(e,h,p,v),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=o,this.styles=w?ng(w,i.styles):i.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},Ao=class extends ns{constructor(e,n,i,o,h,p,v,w){let I=o+"-"+i.id;super(e,n,i,h,p,v,w,I),this.contentAttr=M0(I),this.hostAttr=R0(I)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,n){let i=super.createElement(e,n);return super.setAttribute(i,this.contentAttr,""),i}},O0=(()=>{let e=class e extends xo{constructor(i){super(i)}supports(i){return!0}addEventListener(i,o,h){return i.addEventListener(o,h,!1),()=>this.removeEventListener(i,o,h)}removeEventListener(i,o,h){return i.removeEventListener(o,h)}};e.\u0275fac=function(o){return new(o||e)(Xe(Yn))},e.\u0275prov=ot({token:e,factory:e.\u0275fac});let t=e;return t})(),Kf=["alt","control","meta","shift"],L0={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},F0={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},N0=(()=>{let e=class e extends xo{constructor(i){super(i)}supports(i){return e.parseEventName(i)!=null}addEventListener(i,o,h){let p=e.parseEventName(o),v=e.eventCallback(p.fullKey,h,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Rc().onAndCancel(i,p.domEventName,v))}static parseEventName(i){let o=i.toLowerCase().split("."),h=o.shift();if(o.length===0||!(h==="keydown"||h==="keyup"))return null;let p=e._normalizeKey(o.pop()),v="",w=o.indexOf("code");if(w>-1&&(o.splice(w,1),v="code."),Kf.forEach(S=>{let x=o.indexOf(S);x>-1&&(o.splice(x,1),v+=S+".")}),v+=p,o.length!=0||p.length===0)return null;let I={};return I.domEventName=h,I.fullKey=v,I}static matchEventFullKeyCode(i,o){let h=L0[i.key]||i.key,p="";return o.indexOf("code.")>-1&&(h=i.code,p="code."),h==null||!h?!1:(h=h.toLowerCase(),h===" "?h="space":h==="."&&(h="dot"),Kf.forEach(v=>{if(v!==h){let w=F0[v];w(i)&&(p+=v+".")}}),p+=h,p===o)}static eventCallback(i,o,h){return p=>{e.matchEventFullKeyCode(p,i)&&h.runGuarded(()=>o(p))}}static _normalizeKey(i){return i==="esc"?"escape":i}};e.\u0275fac=function(o){return new(o||e)(Xe(Yn))},e.\u0275prov=ot({token:e,factory:e.\u0275fac});let t=e;return t})();function ig(t,e){return Wf(jn({rootComponent:t},P0(e)))}function P0(t){return{appProviders:[...V0,...t?.providers??[]],platformProviders:U0}}function k0(){Pc.makeCurrent()}function B0(){return new wn}function j0(){return Kd(document),document}var U0=[{provide:Ji,useValue:qf},{provide:sc,useValue:k0,multi:!0},{provide:Yn,useFactory:j0,deps:[]}];var V0=[{provide:vo,useValue:"root"},{provide:wn,useFactory:B0,deps:[]},{provide:kc,useClass:O0,multi:!0,deps:[Yn,pt,Ji]},{provide:kc,useClass:N0,multi:!0,deps:[Yn]},Zf,eg,Jf,{provide:Wr,useExisting:Zf},{provide:So,useClass:b0,deps:[]},[]];function Oe(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function wi(t,e,n,i,o){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?o.call(t,n):o?o.value=n:e.set(t,n),n}var zn,Xt,Ie;typeof SuppressedError=="function"&&SuppressedError,function(t){t[t.BOPM_BLOCK=0]="BOPM_BLOCK",t[t.BOPM_UPDATE=1]="BOPM_UPDATE"}(zn||(zn={})),function(t){t[t.CCUT_AUTO=0]="CCUT_AUTO",t[t.CCUT_FULL_CHANNEL=1]="CCUT_FULL_CHANNEL",t[t.CCUT_Y_CHANNEL_ONLY=2]="CCUT_Y_CHANNEL_ONLY",t[t.CCUT_RGB_R_CHANNEL_ONLY=3]="CCUT_RGB_R_CHANNEL_ONLY",t[t.CCUT_RGB_G_CHANNEL_ONLY=4]="CCUT_RGB_G_CHANNEL_ONLY",t[t.CCUT_RGB_B_CHANNEL_ONLY=5]="CCUT_RGB_B_CHANNEL_ONLY"}(Xt||(Xt={})),function(t){t[t.IPF_BINARY=0]="IPF_BINARY",t[t.IPF_BINARYINVERTED=1]="IPF_BINARYINVERTED",t[t.IPF_GRAYSCALED=2]="IPF_GRAYSCALED",t[t.IPF_NV21=3]="IPF_NV21",t[t.IPF_RGB_565=4]="IPF_RGB_565",t[t.IPF_RGB_555=5]="IPF_RGB_555",t[t.IPF_RGB_888=6]="IPF_RGB_888",t[t.IPF_ARGB_8888=7]="IPF_ARGB_8888",t[t.IPF_RGB_161616=8]="IPF_RGB_161616",t[t.IPF_ARGB_16161616=9]="IPF_ARGB_16161616",t[t.IPF_ABGR_8888=10]="IPF_ABGR_8888",t[t.IPF_ABGR_16161616=11]="IPF_ABGR_16161616",t[t.IPF_BGR_888=12]="IPF_BGR_888",t[t.IPF_BINARY_8=13]="IPF_BINARY_8",t[t.IPF_NV12=14]="IPF_NV12",t[t.IPF_BINARY_8_INVERTED=15]="IPF_BINARY_8_INVERTED"}(Ie||(Ie={}));var fg=t=>Object.prototype.toString.call(t),gg=t=>Array.isArray?Array.isArray(t):fg(t)==="[object Array]",Vc=t=>fg(t)==="[object Boolean]",dt=t=>typeof t=="number"&&!Number.isNaN(t),Xn=t=>t!==null&&typeof t=="object"&&!Array.isArray(t);var No=t=>!!Xn(t)&&t.bytes instanceof Uint8Array&&!!dt(t.width)&&!(t.width<=0)&&!!dt(t.height)&&!(t.height<=0)&&!!dt(t.stride)&&!(t.stride<=0)&&"format"in t&&!("tag"in t&&!G0(t.tag)),pg=t=>!!Xn(t)&&!!dt(t.left)&&!(t.left<0)&&!!dt(t.top)&&!(t.top<0)&&!!dt(t.right)&&!(t.right<0)&&!!dt(t.bottom)&&!(t.bottom<0)&&!(t.left>=t.right)&&!(t.top>=t.bottom)&&!!Vc(t.isMeasuredInPercentage),G0=t=>!!Xn(t)&&!!dt(t.imageId)&&"type"in t;var Po=t=>!!Xn(t)&&!!dt(t.x)&&!!dt(t.y),mg=t=>!!Xn(t)&&!!gg(t.points)&&t.points.length!=0&&!t.points.some(e=>!Po(e)),vg=t=>!!Xn(t)&&!!gg(t.points)&&t.points.length!=0&&t.points.length==4&&!t.points.some(e=>!Po(e)),yg=t=>!!Xn(t)&&!!dt(t.x)&&!!dt(t.y)&&!!dt(t.width)&&!(t.width<0)&&!!dt(t.height)&&!(t.height<0)&&!("isMeasuredInPercentage"in t&&!Vc(t.isMeasuredInPercentage));function ko(t,e){return z(this,null,function*(){return yield new Promise((n,i)=>{let o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType=e,o.send(),o.onloadend=()=>z(this,null,function*(){o.status<200||o.status>=300?i(t+" "+o.status):n(o.response)}),o.onerror=()=>{i(new Error("Network Error: "+o.statusText))}})})}var Qt=(t,e)=>{let n=t.split("."),i=e.split(".");for(let o=0;o<n.length&&o<i.length;++o){let h=n[o],p=i[o];if(h===p)continue;let v=parseInt(n[o]),w=parseInt(i[o]);return v===w||Number.isNaN(v)&&Number.isNaN(w)?h<p?-1:1:v<w||Number.isNaN(v)&&Number.isInteger(w)?-1:1}return n.length===i.length?0:n.length<i.length?-1:1},_g=typeof BigInt=="function",Ro,at,Ei,rs,ss,Pt,Ci,Uc,ir=class t{get _isFetchingStarted(){return Oe(this,ss,"f")}constructor(){Ro.add(this),at.set(this,[]),Ei.set(this,1),rs.set(this,zn.BOPM_BLOCK),ss.set(this,!1),Pt.set(this,void 0),Ci.set(this,Xt.CCUT_AUTO)}setErrorListener(e){}addImageToBuffer(e){var n;if(!No(e))throw new TypeError("Invalid 'image'.");if(!((n=e.tag)===null||n===void 0)&&n.hasOwnProperty("imageId")&&typeof e.tag.imageId=="number"&&this.hasImage(e.tag.imageId))throw new Error("Existed imageId.");if(Oe(this,at,"f").length>=Oe(this,Ei,"f"))switch(Oe(this,rs,"f")){case zn.BOPM_BLOCK:break;case zn.BOPM_UPDATE:if(Oe(this,at,"f").push(e),Xn(Oe(this,Pt,"f"))&&dt(Oe(this,Pt,"f").imageId)&&Oe(this,Pt,"f").keepInBuffer==1)for(;Oe(this,at,"f").length>Oe(this,Ei,"f");){let i=Oe(this,at,"f").findIndex(o=>{var h;return((h=o.tag)===null||h===void 0?void 0:h.imageId)!==Oe(this,Pt,"f").imageId});Oe(this,at,"f").splice(i,1)}else Oe(this,at,"f").splice(0,Oe(this,at,"f").length-Oe(this,Ei,"f"))}else Oe(this,at,"f").push(e)}getImage(){if(Oe(this,at,"f").length===0)return null;let e;if(Oe(this,Pt,"f")&&dt(Oe(this,Pt,"f").imageId)){let n=Oe(this,Ro,"m",Uc).call(this,Oe(this,Pt,"f").imageId);if(n<0)throw new Error(`Image with id ${Oe(this,Pt,"f").imageId} doesn't exist.`);e=Oe(this,at,"f").slice(n,n+1)[0]}else e=Oe(this,at,"f").pop();if([Ie.IPF_RGB_565,Ie.IPF_RGB_555,Ie.IPF_RGB_888,Ie.IPF_ARGB_8888,Ie.IPF_RGB_161616,Ie.IPF_ARGB_16161616,Ie.IPF_ABGR_8888,Ie.IPF_ABGR_16161616,Ie.IPF_BGR_888].includes(e.format)){if(Oe(this,Ci,"f")===Xt.CCUT_RGB_R_CHANNEL_ONLY){t._onLog&&t._onLog("only get R channel data.");let n=new Uint8Array(e.width*e.height);for(let i=0;i<n.length;i++)switch(e.format){case Ie.IPF_RGB_565:case Ie.IPF_RGB_555:case Ie.IPF_RGB_888:case Ie.IPF_RGB_161616:n[i]=e.bytes[3*i+2];break;case Ie.IPF_ARGB_8888:case Ie.IPF_ARGB_16161616:n[i]=e.bytes[4*i+2];break;case Ie.IPF_BGR_888:n[i]=e.bytes[3*i];break;case Ie.IPF_ABGR_8888:case Ie.IPF_ABGR_16161616:n[i]=e.bytes[4*i]}e.bytes=n,e.stride=e.width,e.format=Ie.IPF_GRAYSCALED}else if(Oe(this,Ci,"f")===Xt.CCUT_RGB_G_CHANNEL_ONLY){t._onLog&&t._onLog("only get G channel data.");let n=new Uint8Array(e.width*e.height);for(let i=0;i<n.length;i++)switch(e.format){case Ie.IPF_RGB_565:case Ie.IPF_RGB_555:case Ie.IPF_RGB_888:case Ie.IPF_RGB_161616:case Ie.IPF_BGR_888:n[i]=e.bytes[3*i+1];break;case Ie.IPF_ARGB_8888:case Ie.IPF_ARGB_16161616:case Ie.IPF_ABGR_8888:case Ie.IPF_ABGR_16161616:n[i]=e.bytes[4*i+1]}e.bytes=n,e.stride=e.width,e.format=Ie.IPF_GRAYSCALED}else if(Oe(this,Ci,"f")===Xt.CCUT_RGB_B_CHANNEL_ONLY){t._onLog&&t._onLog("only get B channel data.");let n=new Uint8Array(e.width*e.height);for(let i=0;i<n.length;i++)switch(e.format){case Ie.IPF_RGB_565:case Ie.IPF_RGB_555:case Ie.IPF_RGB_888:case Ie.IPF_RGB_161616:n[i]=e.bytes[3*i];break;case Ie.IPF_ARGB_8888:case Ie.IPF_ARGB_16161616:n[i]=e.bytes[4*i];break;case Ie.IPF_BGR_888:n[i]=e.bytes[3*i+2];break;case Ie.IPF_ABGR_8888:case Ie.IPF_ABGR_16161616:n[i]=e.bytes[4*i+2]}e.bytes=n,e.stride=e.width,e.format=Ie.IPF_GRAYSCALED}}else[Ie.IPF_NV21,Ie.IPF_NV12].includes(e.format)&&t._onLog&&t._onLog("NV21 or NV12 is not supported.");return e}setNextImageToReturn(e,n){if(!((...i)=>i.length!==0&&i.every(o=>dt(o)))(e))throw new TypeError("Invalid 'imageId'.");if(n!==void 0&&!Vc(n))throw new TypeError("Invalid 'keepInBuffer'.");wi(this,Pt,{imageId:e,keepInBuffer:n},"f")}_resetNextReturnedImage(){wi(this,Pt,null,"f")}hasImage(e){return Oe(this,Ro,"m",Uc).call(this,e)>=0}startFetching(){wi(this,ss,!0,"f")}stopFetching(){wi(this,ss,!1,"f")}setMaxImageCount(e){if(typeof e!="number")throw new TypeError("Invalid 'count'.");if(e<1||Math.round(e)!==e)throw new Error("Invalid 'count'.");for(wi(this,Ei,e,"f");Oe(this,at,"f")&&Oe(this,at,"f").length>e;)Oe(this,at,"f").shift()}getMaxImageCount(){return Oe(this,Ei,"f")}getImageCount(){return Oe(this,at,"f").length}clearBuffer(){Oe(this,at,"f").length=0}isBufferEmpty(){return Oe(this,at,"f").length===0}setBufferOverflowProtectionMode(e){wi(this,rs,e,"f")}getBufferOverflowProtectionMode(){return Oe(this,rs,"f")}setColourChannelUsageType(e){wi(this,Ci,e,"f")}getColourChannelUsageType(){return Oe(this,Ci,"f")}};at=new WeakMap,Ei=new WeakMap,rs=new WeakMap,ss=new WeakMap,Pt=new WeakMap,Ci=new WeakMap,Ro=new WeakSet,Uc=function(t){if(typeof t!="number")throw new TypeError("Invalid 'imageId'.");return Oe(this,at,"f").findIndex(e=>{var n;return((n=e.tag)===null||n===void 0?void 0:n.imageId)===t})};var Oo=typeof self>"u",rg=(()=>{if(!Oo&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),wg=t=>{if(t==null&&(t="./"),!Oo){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},is,bn,Mo,Lo,Dt;typeof navigator<"u"&&(is=navigator,bn=is.userAgent,Mo=is.platform,Lo=is.mediaDevices),function(){if(!Oo){let t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:is.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Mo,search:"Win"},Mac:{str:Mo},Linux:{str:Mo}},n="unknownBrowser",i=0,o="unknownOS";for(let h in t){let p=t[h]||{},v=p.str||bn,w=p.search||h,I=p.verStr||bn,S=p.verSearch||h;if(S instanceof Array||(S=[S]),v.indexOf(w)!=-1){n=h;for(let x of S){let M=I.indexOf(x);if(M!=-1){i=parseFloat(I.substring(M+x.length+1));break}}break}}for(let h in e){let p=e[h]||{},v=p.str||bn,w=p.search||h;if(v.indexOf(w)!=-1){o=h;break}}o=="Linux"&&bn.indexOf("Windows NT")!=-1&&(o="HarmonyOS"),Dt={browser:n,version:i,OS:o}}Oo&&(Dt={browser:"ssr",version:0,OS:"ssr"})}();var H0=typeof WebAssembly<"u"&&bn&&!(/Safari/.test(bn)&&!/Chrome/.test(bn)&&/\(.+\s11_2_([2-6]).*\)/.test(bn)),W0=!(typeof Worker>"u"),Eg=!(!Lo||!Lo.getUserMedia),Y0=()=>z(void 0,null,function*(){let t=!1;if(Eg)try{(yield Lo.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t});Dt.browser==="Chrome"&&Dt.version>66||Dt.browser==="Safari"&&Dt.version>13||Dt.browser==="OPR"&&Dt.version>43||Dt.browser==="Edge"&&Dt.version;var sg=t=>t&&typeof t=="object"&&typeof t.then=="function",as=class extends Promise{constructor(e){let n,i;super((o,h)=>{n=o,i=h}),this._s="pending",this.resolve=o=>{this.isPending&&(sg(o)?this.task=o:(this._s="fulfilled",n(o)))},this.reject=o=>{this.isPending&&(this._s="rejected",i(o))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let n;this._task=e,sg(e)?n=e:typeof e=="function"&&(n=new Promise(e)),n&&z(this,null,function*(){try{let i=yield n;e===this._task&&this.resolve(i)}catch(i){e===this._task&&this.reject(i)}})}get isEmpty(){return this._task==null}},Zt={};var Gc=t=>z(void 0,null,function*(){let e=typeof t=="string"?[t]:t,n=[];for(let i of e)n.push(Zt[i]=Zt[i]||new as);yield Promise.all(n)}),ls=(t,e)=>z(void 0,null,function*(){let n,i=typeof t=="string"?[t]:t,o=[];for(let h of i){let p;o.push(p=Zt[h]=Zt[h]||new as(n=n||e())),p.isEmpty&&(p.task=n=n||e())}yield Promise.all(o)}),Me,Cg=0,Ge=()=>Cg++,Le={},Tn,z0=t=>{Tn=t,Me&&Me.postMessage({type:"setBLog",body:{value:!!t}})},Hc=!1,$0=t=>{Hc=t,Me&&Me.postMessage({type:"setBDebug",body:{value:!!t}})},qt={},tt={},Se={std:{version:"1.2.10",path:wg(rg+"../../dynamsoft-capture-vision-std@1.2.10/dist/")},core:{version:"3.2.30",path:rg}},os=new Proxy(Se,{get(t,e,n){let i=Reflect.get(t,e,n);return i&&i.path&&(i=i.path),i}}),Tt={dip:{wasm:!0}},kt=t=>z(void 0,null,function*(){let e;t instanceof Array||(t=t?[t]:[]);{let o=Zt.core;e=!o||o.isEmpty}let n=new Map;for(let o of t){if(o=o.toLowerCase(),o=="std"||o=="core")continue;if(!Tt[o])throw Error("The '"+o+"' module cannot be found.");let h=Tt[o].deps;if(h?.length)for(let v of h){let w=Zt[v];n.has(v)||n.set(v,!w||w.isEmpty)}let p=Zt[o];n.has(o)||n.set(o,!p||p.isEmpty)}let i=[];e&&i.push("core"),i.push(...n.keys()),yield ls(i,()=>z(void 0,null,function*(){let o=[...n.entries()].filter(S=>S[1]).map(S=>S[0]),h={};for(let S in os){if(S=="rootDirectory")continue;let x=os[S];os.rootDirectory&&(x.startsWith("http://")||x.startsWith("https://")||(x=os.rootDirectory+"/"+x)),h[S]=wg(x)}let p={};for(let S of o)p[S]=Tt[S];let v={engineResourcePaths:h,autoResources:p,names:o},w=new as;if(e){v.needLoadCore=!0;let S=h.core+Je._workerName;h.rootDirectory&&(S=h.rootDirectory+S),S.startsWith(location.origin)||(S=yield fetch(S).then(x=>x.blob()).then(x=>URL.createObjectURL(x))),Me=new Worker(S),Me.onerror=x=>{let M=new Error(x.message);w.reject(M)},Me.addEventListener("message",x=>{let M=x.data?x.data:x,R=M.type,O=M.id,B=M.body;switch(R){case"log":Tn&&Tn(M.message);break;case"task":try{Le[O](B),delete Le[O]}catch(V){throw delete Le[O],V}break;case"event":try{Le[O](B)}catch(V){throw V}break;default:console.log(x)}}),v.bLog=!!Tn,v.bd=Hc,v.dm=location.origin.startsWith("http")?location.origin:"https://localhost"}else yield Gc("worker");let I=Cg++;Le[I]=S=>{if(S.success)Object.assign(qt,S.versions),JSON.stringify(S.versions)!=="{}"&&(Je._versions=S.versions),w.resolve(void 0);else{let x=Error(S.message);S.stack&&(x.stack=S.stack),w.reject(x)}},Me.postMessage({type:"loadWasm",body:v,id:I}),e&&ls("worker",()=>Promise.resolve()),yield w}))}),Je=class t{static get engineResourcePaths(){return os}static set engineResourcePaths(e){Object.assign(Se,e)}static get bSupportDce4Module(){return this._bSupportDce4Module}static get bSupportIRTModule(){return this._bSupportIRTModule}static get versions(){return this._versions}static get _onLog(){return Tn}static set _onLog(e){z0(e)}static get _bDebug(){return Hc}static set _bDebug(e){$0(e)}static isModuleLoaded(e){return e=(e=e||"core").toLowerCase(),!!Zt[e]&&Zt[e].isFulfilled}static loadWasm(e){return z(this,null,function*(){return yield kt(e)})}static detectEnvironment(){return z(this,null,function*(){return yield z(this,null,function*(){return{wasm:H0,worker:W0,getUserMedia:Eg,camera:yield Y0(),browser:Dt.browser,version:Dt.version,OS:Dt.OS}})})}static getModuleVersion(){return z(this,null,function*(){return yield new Promise((e,n)=>{let i=Ge();Le[i]=o=>z(this,null,function*(){if(o.success)return e(o.versions);{let h=new Error(o.message);return h.stack=o.stack+`
`+h.stack,n(h)}}),Me.postMessage({type:"getModuleVersion",id:i})})})}static getVersion(){let e=qt.core&&qt.core.worker,n=qt.core&&qt.core.wasm;return`3.2.30(Worker: ${e||"Not Loaded"}, Wasm: ${n||"Not Loaded"})`}static enableLogging(){ir._onLog=console.log,t._onLog=console.log}static disableLogging(){ir._onLog=null,t._onLog=null}static cfd(e){return z(this,null,function*(){return yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success)return n();{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cfd",id:o,body:{count:e}})})})}},De,og,Fo,ag,lg,cs,cg,ug,$n,hg,dg;Je._bSupportDce4Module=-1,Je._bSupportIRTModule=-1,Je._versions=null,Je._workerName="core.worker.js",Je.browserInfo=Dt,function(t){t[t.CRIT_ORIGINAL_IMAGE=1]="CRIT_ORIGINAL_IMAGE",t[t.CRIT_BARCODE=2]="CRIT_BARCODE",t[t.CRIT_TEXT_LINE=4]="CRIT_TEXT_LINE",t[t.CRIT_DETECTED_QUAD=8]="CRIT_DETECTED_QUAD",t[t.CRIT_NORMALIZED_IMAGE=16]="CRIT_NORMALIZED_IMAGE",t[t.CRIT_PARSED_RESULT=32]="CRIT_PARSED_RESULT"}(De||(De={})),function(t){t[t.CT_NORMAL_INTERSECTED=0]="CT_NORMAL_INTERSECTED",t[t.CT_T_INTERSECTED=1]="CT_T_INTERSECTED",t[t.CT_CROSS_INTERSECTED=2]="CT_CROSS_INTERSECTED",t[t.CT_NOT_INTERSECTED=3]="CT_NOT_INTERSECTED"}(og||(og={})),function(t){t[t.EC_OK=0]="EC_OK",t[t.EC_UNKNOWN=-1e4]="EC_UNKNOWN",t[t.EC_NO_MEMORY=-10001]="EC_NO_MEMORY",t[t.EC_NULL_POINTER=-10002]="EC_NULL_POINTER",t[t.EC_LICENSE_INVALID=-10003]="EC_LICENSE_INVALID",t[t.EC_LICENSE_EXPIRED=-10004]="EC_LICENSE_EXPIRED",t[t.EC_FILE_NOT_FOUND=-10005]="EC_FILE_NOT_FOUND",t[t.EC_FILE_TYPE_NOT_SUPPORTED=-10006]="EC_FILE_TYPE_NOT_SUPPORTED",t[t.EC_BPP_NOT_SUPPORTED=-10007]="EC_BPP_NOT_SUPPORTED",t[t.EC_INDEX_INVALID=-10008]="EC_INDEX_INVALID",t[t.EC_CUSTOM_REGION_INVALID=-10010]="EC_CUSTOM_REGION_INVALID",t[t.EC_IMAGE_READ_FAILED=-10012]="EC_IMAGE_READ_FAILED",t[t.EC_TIFF_READ_FAILED=-10013]="EC_TIFF_READ_FAILED",t[t.EC_DIB_BUFFER_INVALID=-10018]="EC_DIB_BUFFER_INVALID",t[t.EC_PDF_READ_FAILED=-10021]="EC_PDF_READ_FAILED",t[t.EC_PDF_DLL_MISSING=-10022]="EC_PDF_DLL_MISSING",t[t.EC_PAGE_NUMBER_INVALID=-10023]="EC_PAGE_NUMBER_INVALID",t[t.EC_CUSTOM_SIZE_INVALID=-10024]="EC_CUSTOM_SIZE_INVALID",t[t.EC_TIMEOUT=-10026]="EC_TIMEOUT",t[t.EC_JSON_PARSE_FAILED=-10030]="EC_JSON_PARSE_FAILED",t[t.EC_JSON_TYPE_INVALID=-10031]="EC_JSON_TYPE_INVALID",t[t.EC_JSON_KEY_INVALID=-10032]="EC_JSON_KEY_INVALID",t[t.EC_JSON_VALUE_INVALID=-10033]="EC_JSON_VALUE_INVALID",t[t.EC_JSON_NAME_KEY_MISSING=-10034]="EC_JSON_NAME_KEY_MISSING",t[t.EC_JSON_NAME_VALUE_DUPLICATED=-10035]="EC_JSON_NAME_VALUE_DUPLICATED",t[t.EC_TEMPLATE_NAME_INVALID=-10036]="EC_TEMPLATE_NAME_INVALID",t[t.EC_JSON_NAME_REFERENCE_INVALID=-10037]="EC_JSON_NAME_REFERENCE_INVALID",t[t.EC_PARAMETER_VALUE_INVALID=-10038]="EC_PARAMETER_VALUE_INVALID",t[t.EC_DOMAIN_NOT_MATCH=-10039]="EC_DOMAIN_NOT_MATCH",t[t.EC_RESERVED_INFO_NOT_MATCH=-10040]="EC_RESERVED_INFO_NOT_MATCH",t[t.EC_LICENSE_KEY_NOT_MATCH=-10043]="EC_LICENSE_KEY_NOT_MATCH",t[t.EC_REQUEST_FAILED=-10044]="EC_REQUEST_FAILED",t[t.EC_LICENSE_INIT_FAILED=-10045]="EC_LICENSE_INIT_FAILED",t[t.EC_SET_MODE_ARGUMENT_ERROR=-10051]="EC_SET_MODE_ARGUMENT_ERROR",t[t.EC_LICENSE_CONTENT_INVALID=-10052]="EC_LICENSE_CONTENT_INVALID",t[t.EC_LICENSE_KEY_INVALID=-10053]="EC_LICENSE_KEY_INVALID",t[t.EC_LICENSE_DEVICE_RUNS_OUT=-10054]="EC_LICENSE_DEVICE_RUNS_OUT",t[t.EC_GET_MODE_ARGUMENT_ERROR=-10055]="EC_GET_MODE_ARGUMENT_ERROR",t[t.EC_IRT_LICENSE_INVALID=-10056]="EC_IRT_LICENSE_INVALID",t[t.EC_FILE_SAVE_FAILED=-10058]="EC_FILE_SAVE_FAILED",t[t.EC_STAGE_TYPE_INVALID=-10059]="EC_STAGE_TYPE_INVALID",t[t.EC_IMAGE_ORIENTATION_INVALID=-10060]="EC_IMAGE_ORIENTATION_INVALID",t[t.EC_CONVERT_COMPLEX_TEMPLATE_ERROR=-10061]="EC_CONVERT_COMPLEX_TEMPLATE_ERROR",t[t.EC_CALL_REJECTED_WHEN_CAPTURING=-10062]="EC_CALL_REJECTED_WHEN_CAPTURING",t[t.EC_NO_IMAGE_SOURCE=-10063]="EC_NO_IMAGE_SOURCE",t[t.EC_READ_DIRECTORY_FAILED=-10064]="EC_READ_DIRECTORY_FAILED",t[t.EC_MODULE_NOT_FOUND=-10065]="EC_MODULE_NOT_FOUND",t[t.EC_MULTI_PAGES_NOT_SUPPORTED=-10066]="EC_MULTI_PAGES_NOT_SUPPORTED",t[t.EC_FILE_ALREADY_EXISTS=-10067]="EC_FILE_ALREADY_EXISTS",t[t.EC_CREATE_FILE_FAILED=-10068]="EC_CREATE_FILE_FAILED",t[t.EC_IMGAE_DATA_INVALID=-10069]="EC_IMGAE_DATA_INVALID",t[t.EC_IMAGE_SIZE_NOT_MATCH=-10070]="EC_IMAGE_SIZE_NOT_MATCH",t[t.EC_IMAGE_PIXEL_FORMAT_NOT_MATCH=-10071]="EC_IMAGE_PIXEL_FORMAT_NOT_MATCH",t[t.EC_SECTION_LEVEL_RESULT_IRREPLACEABLE=-10072]="EC_SECTION_LEVEL_RESULT_IRREPLACEABLE",t[t.EC_AXIS_DEFINITION_INCORRECT=-10073]="EC_AXIS_DEFINITION_INCORRECT",t[t.EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE=-10074]="EC_RESULT_TYPE_MISMATCH_IRREPLACEABLE",t[t.EC_PDF_LIBRARY_LOAD_FAILED=-10075]="EC_PDF_LIBRARY_LOAD_FAILED",t[t.EC_NO_LICENSE=-2e4]="EC_NO_LICENSE",t[t.EC_HANDSHAKE_CODE_INVALID=-20001]="EC_HANDSHAKE_CODE_INVALID",t[t.EC_LICENSE_BUFFER_FAILED=-20002]="EC_LICENSE_BUFFER_FAILED",t[t.EC_LICENSE_SYNC_FAILED=-20003]="EC_LICENSE_SYNC_FAILED",t[t.EC_DEVICE_NOT_MATCH=-20004]="EC_DEVICE_NOT_MATCH",t[t.EC_BIND_DEVICE_FAILED=-20005]="EC_BIND_DEVICE_FAILED",t[t.EC_INSTANCE_COUNT_OVER_LIMIT=-20008]="EC_INSTANCE_COUNT_OVER_LIMIT",t[t.EC_LICENSE_INIT_SEQUENCE_FAILED=-20009]="EC_LICENSE_INIT_SEQUENCE_FAILED",t[t.EC_TRIAL_LICENSE=-20010]="EC_TRIAL_LICENSE",t[t.EC_FAILED_TO_REACH_DLS=-20200]="EC_FAILED_TO_REACH_DLS",t[t.EC_LICENSE_CACHE_USED=-20012]="EC_LICENSE_CACHE_USED",t[t.EC_BARCODE_FORMAT_INVALID=-30009]="EC_BARCODE_FORMAT_INVALID",t[t.EC_QR_LICENSE_INVALID=-30016]="EC_QR_LICENSE_INVALID",t[t.EC_1D_LICENSE_INVALID=-30017]="EC_1D_LICENSE_INVALID",t[t.EC_PDF417_LICENSE_INVALID=-30019]="EC_PDF417_LICENSE_INVALID",t[t.EC_DATAMATRIX_LICENSE_INVALID=-30020]="EC_DATAMATRIX_LICENSE_INVALID",t[t.EC_CUSTOM_MODULESIZE_INVALID=-30025]="EC_CUSTOM_MODULESIZE_INVALID",t[t.EC_AZTEC_LICENSE_INVALID=-30041]="EC_AZTEC_LICENSE_INVALID",t[t.EC_PATCHCODE_LICENSE_INVALID=-30046]="EC_PATCHCODE_LICENSE_INVALID",t[t.EC_POSTALCODE_LICENSE_INVALID=-30047]="EC_POSTALCODE_LICENSE_INVALID",t[t.EC_DPM_LICENSE_INVALID=-30048]="EC_DPM_LICENSE_INVALID",t[t.EC_FRAME_DECODING_THREAD_EXISTS=-30049]="EC_FRAME_DECODING_THREAD_EXISTS",t[t.EC_STOP_DECODING_THREAD_FAILED=-30050]="EC_STOP_DECODING_THREAD_FAILED",t[t.EC_MAXICODE_LICENSE_INVALID=-30057]="EC_MAXICODE_LICENSE_INVALID",t[t.EC_GS1_DATABAR_LICENSE_INVALID=-30058]="EC_GS1_DATABAR_LICENSE_INVALID",t[t.EC_GS1_COMPOSITE_LICENSE_INVALID=-30059]="EC_GS1_COMPOSITE_LICENSE_INVALID",t[t.EC_DOTCODE_LICENSE_INVALID=-30061]="EC_DOTCODE_LICENSE_INVALID",t[t.EC_PHARMACODE_LICENSE_INVALID=-30062]="EC_PHARMACODE_LICENSE_INVALID",t[t.EC_CHARACTER_MODEL_FILE_NOT_FOUND=-40100]="EC_CHARACTER_MODEL_FILE_NOT_FOUND",t[t.EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT=-40101]="EC_TEXT_LINE_GROUP_LAYOUT_CONFLICT",t[t.EC_TEXT_LINE_GROUP_REGEX_CONFLICT=-40102]="EC_TEXT_LINE_GROUP_REGEX_CONFLICT",t[t.EC_QUADRILATERAL_INVALID=-50057]="EC_QUADRILATERAL_INVALID",t[t.EC_PANORAMA_LICENSE_INVALID=-70060]="EC_PANORAMA_LICENSE_INVALID",t[t.EC_RESOURCE_PATH_NOT_EXIST=-90001]="EC_RESOURCE_PATH_NOT_EXIST",t[t.EC_RESOURCE_LOAD_FAILED=-90002]="EC_RESOURCE_LOAD_FAILED",t[t.EC_CODE_SPECIFICATION_NOT_FOUND=-90003]="EC_CODE_SPECIFICATION_NOT_FOUND",t[t.EC_FULL_CODE_EMPTY=-90004]="EC_FULL_CODE_EMPTY",t[t.EC_FULL_CODE_PREPROCESS_FAILED=-90005]="EC_FULL_CODE_PREPROCESS_FAILED",t[t.EC_ZA_DL_LICENSE_INVALID=-90006]="EC_ZA_DL_LICENSE_INVALID",t[t.EC_AAMVA_DL_ID_LICENSE_INVALID=-90007]="EC_AAMVA_DL_ID_LICENSE_INVALID",t[t.EC_AADHAAR_LICENSE_INVALID=-90008]="EC_AADHAAR_LICENSE_INVALID",t[t.EC_MRTD_LICENSE_INVALID=-90009]="EC_MRTD_LICENSE_INVALID",t[t.EC_VIN_LICENSE_INVALID=-90010]="EC_VIN_LICENSE_INVALID",t[t.EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID=-90011]="EC_CUSTOMIZED_CODE_TYPE_LICENSE_INVALID"}(Fo||(Fo={})),function(t){t[t.GEM_SKIP=0]="GEM_SKIP",t[t.GEM_AUTO=1]="GEM_AUTO",t[t.GEM_GENERAL=2]="GEM_GENERAL",t[t.GEM_GRAY_EQUALIZE=4]="GEM_GRAY_EQUALIZE",t[t.GEM_GRAY_SMOOTH=8]="GEM_GRAY_SMOOTH",t[t.GEM_SHARPEN_SMOOTH=16]="GEM_SHARPEN_SMOOTH",t[t.GEM_REV=-2147483648]="GEM_REV"}(ag||(ag={})),function(t){t[t.GTM_SKIP=0]="GTM_SKIP",t[t.GTM_INVERTED=1]="GTM_INVERTED",t[t.GTM_ORIGINAL=2]="GTM_ORIGINAL",t[t.GTM_AUTO=4]="GTM_AUTO",t[t.GTM_REV=-2147483648]="GTM_REV"}(lg||(lg={})),function(t){t[t.ITT_FILE_IMAGE=0]="ITT_FILE_IMAGE",t[t.ITT_VIDEO_FRAME=1]="ITT_VIDEO_FRAME"}(cs||(cs={})),function(t){t[t.PDFRM_VECTOR=1]="PDFRM_VECTOR",t[t.PDFRM_RASTER=2]="PDFRM_RASTER",t[t.PDFRM_REV=-2147483648]="PDFRM_REV"}(cg||(cg={})),function(t){t[t.RDS_RASTERIZED_PAGES=0]="RDS_RASTERIZED_PAGES",t[t.RDS_EXTRACTED_IMAGES=1]="RDS_EXTRACTED_IMAGES"}(ug||(ug={})),function(t){t[t.IRUT_NULL=0]="IRUT_NULL",t[t.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",t[t.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",t[t.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",t[t.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",t[t.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",t[t.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",t[t.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",t[t.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",t[t.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",t[t.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",t[t.IRUT_CONTOURS=1024]="IRUT_CONTOURS",t[t.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",t[t.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",t[t.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",t[t.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",t[t.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",t[t.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",t[t.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",t[t.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",t[t.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",t[t.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",t[t.IRUT_CORNERS=2097152]="IRUT_CORNERS",t[t.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",t[t.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",t[t.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",t[t.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",t[t.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",t[t.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",t[t.IRUT_ALL=268435455]="IRUT_ALL"}($n||($n={})),function(t){t[t.ROET_PREDETECTED_REGION=0]="ROET_PREDETECTED_REGION",t[t.ROET_LOCALIZED_BARCODE=1]="ROET_LOCALIZED_BARCODE",t[t.ROET_DECODED_BARCODE=2]="ROET_DECODED_BARCODE",t[t.ROET_LOCALIZED_TEXT_LINE=3]="ROET_LOCALIZED_TEXT_LINE",t[t.ROET_RECOGNIZED_TEXT_LINE=4]="ROET_RECOGNIZED_TEXT_LINE",t[t.ROET_DETECTED_QUAD=5]="ROET_DETECTED_QUAD",t[t.ROET_NORMALIZED_IMAGE=6]="ROET_NORMALIZED_IMAGE",t[t.ROET_SOURCE_IMAGE=7]="ROET_SOURCE_IMAGE",t[t.ROET_TARGET_ROI=8]="ROET_TARGET_ROI"}(hg||(hg={})),function(t){t[t.ST_NULL=0]="ST_NULL",t[t.ST_REGION_PREDETECTION=1]="ST_REGION_PREDETECTION",t[t.ST_BARCODE_LOCALIZATION=2]="ST_BARCODE_LOCALIZATION",t[t.ST_BARCODE_DECODING=3]="ST_BARCODE_DECODING",t[t.ST_TEXT_LINE_LOCALIZATION=4]="ST_TEXT_LINE_LOCALIZATION",t[t.ST_TEXT_LINE_RECOGNITION=5]="ST_TEXT_LINE_RECOGNITION",t[t.ST_DOCUMENT_DETECTION=6]="ST_DOCUMENT_DETECTION",t[t.ST_DOCUMENT_NORMALIZATION=7]="ST_DOCUMENT_NORMALIZATION"}(dg||(dg={}));var qn=typeof self>"u",Ig=qn?{}:self,Ag=(()=>{if(!qn&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Mg=t=>{if(t==null&&(t="./"),!qn){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},Dg=t=>t&&typeof t=="object"&&typeof t.then=="function",ds=class extends Promise{constructor(e){let n,i;super((o,h)=>{n=o,i=h}),this._s="pending",this.resolve=o=>{this.isPending&&(Dg(o)?this.task=o:(this._s="fulfilled",n(o)))},this.reject=o=>{this.isPending&&(this._s="rejected",i(o))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let n;this._task=e,Dg(e)?n=e:typeof e=="function"&&(n=new Promise(e)),n&&z(this,null,function*(){try{let i=yield n;e===this._task&&this.resolve(i)}catch(i){e===this._task&&this.reject(i)}})}get isEmpty(){return this._task==null}},jo=" is not allowed to change after `createInstance` or `loadWasm` is called.",X0=!qn&&document.currentScript&&(document.currentScript.getAttribute("data-license")||document.currentScript.getAttribute("data-productKeys")||document.currentScript.getAttribute("data-licenseKey")||document.currentScript.getAttribute("data-handshakeCode")||document.currentScript.getAttribute("data-organizationID"))||"",bg=(t,e)=>{let n=t;if(!n._pLoad.isEmpty)throw new Error("`license`"+jo);n._license=e};!qn&&document.currentScript&&document.currentScript.getAttribute("data-sessionPassword");var Rg=t=>{if(t==null)t=[];else{t=t instanceof Array?[...t]:[t];for(let e=0;e<t.length;++e){if(!qn){let n=document.createElement("a");n.href=t[e],t[e]=n.href}t[e].endsWith("/")||(t[e]+="/")}}return t},Tg=(t,e)=>{let n=t;if(!n._pLoad.isEmpty)throw new Error("`licenseServer`"+jo);n._licenseServer=Rg(e)},Sg=(t,e)=>{let n=t;if(!n._pLoad.isEmpty)throw new Error("`deviceFriendlyName`"+jo);n._deviceFriendlyName=e||""},us,hs,Bo,Wc,Kt;typeof navigator<"u"&&(us=navigator,hs=us.userAgent,Bo=us.platform,Wc=us.mediaDevices),function(){if(!qn){let t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:us.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Bo,search:"Win"},Mac:{str:Bo},Linux:{str:Bo}},n="unknownBrowser",i=0,o="unknownOS";for(let h in t){let p=t[h]||{},v=p.str||hs,w=p.search||h,I=p.verStr||hs,S=p.verSearch||h;if(S instanceof Array||(S=[S]),v.indexOf(w)!=-1){n=h;for(let x of S){let M=I.indexOf(x);if(M!=-1){i=parseFloat(I.substring(M+x.length+1));break}}break}}for(let h in e){let p=e[h]||{},v=p.str||hs,w=p.search||h;if(v.indexOf(w)!=-1){o=h;break}}o=="Linux"&&hs.indexOf("Windows NT")!=-1&&(o="HarmonyOS"),Kt={browser:n,version:i,OS:o}}qn&&(Kt={browser:"ssr",version:0,OS:"ssr"})}(),Wc&&Wc.getUserMedia,Kt.browser==="Chrome"&&Kt.version>66||Kt.browser==="Safari"&&Kt.version>13||Kt.browser==="OPR"&&Kt.version>43||Kt.browser==="Edge"&&Kt.version;var Og=()=>z(void 0,null,function*(){return kt("license"),ls("dynamsoft_inited",()=>z(void 0,null,function*(){let{lt:t,l:e,ls:n,sp:i,rmk:o,cv:h}=((w,I=!1)=>{let S=w;if(S._pLoad.isEmpty){let x,M,R,O=S._license||"",B=JSON.parse(JSON.stringify(S._licenseServer)),V=S._sessionPassword,H=0;if(O.startsWith("t")||O.startsWith("f"))H=0;else if(O.length===0||O.startsWith("P")||O.startsWith("L")||O.startsWith("Y")||O.startsWith("A"))H=1;else{H=2;let Y=O.indexOf(":");Y!=-1&&(O=O.substring(Y+1));let Z=O.indexOf("?");if(Z!=-1&&(M=O.substring(Z+1),O=O.substring(0,Z)),O.startsWith("DLC2"))H=0;else{if(O.startsWith("DLS2")){let he;try{let ce=O.substring(4);ce=atob(ce),he=JSON.parse(ce)}catch{throw new Error("Format Error: The license string you specified is invalid, please check to make sure it is correct.")}if(O=he.handshakeCode?he.handshakeCode:he.organizationID?he.organizationID:"",typeof O=="number"&&(O=JSON.stringify(O)),B.length===0){let ce=[];he.mainServerURL&&(ce[0]=he.mainServerURL),he.standbyServerURL&&(ce[1]=he.standbyServerURL),B=Rg(ce)}!V&&he.sessionPassword&&(V=he.sessionPassword),x=he.remark}O&&O!=="200001"&&!O.startsWith("200001-")||(H=1)}}if(H&&(I||(Ig.crypto||(R="Please upgrade your browser to support online key."),Ig.crypto.subtle||(R="Require https to use online key in this browser."))),R){if(H!==1)throw new Error(R);H=0,console.warn(R),S._lastErrorCode=-1,S._lastErrorString=R}return H===1&&(O="",console.warn("Applying for a public trial license ...")),{lt:H,l:O,ls:B,sp:V,rmk:x,cv:M}}throw new Error("Can't preprocess license again"+jo)})(rt),p=new ds;rt._pLoad.task=p,z(void 0,null,function*(){try{yield rt._pLoad}catch{}});let v=Ge();Le[v]=w=>{if(w.message&&rt._onAuthMessage){let x=rt._onAuthMessage(w.message);x!=null&&(w.message=x)}let I,S=!1;if(t===1&&(S=!0),w.success?(Tn&&Tn("init license success"),w.message&&console.warn(w.message),Je._bSupportIRTModule=w.bSupportIRTModule,Je._bSupportDce4Module=w.bSupportDce4Module,rt.bPassValidation=!0):(I=Error(w.message),w.stack&&(I.stack=w.stack),w.ltsErrorCode&&(I.ltsErrorCode=w.ltsErrorCode),S||w.ltsErrorCode==111&&w.message.toLowerCase().indexOf("trial license")!=-1&&(S=!0)),S){let x=Se.license;Se.rootDirectory&&(x=Se.rootDirectory+"/"+x),x=Mg(x),((M,R,O)=>z(void 0,null,function*(){if(!M._bNeverShowDialog)try{let B=yield fetch(M.engineResourcePath+"dls.license.dialog.html");if(!B.ok)throw Error("Get license dialog fail. Network Error: "+B.statusText);let V=yield B.text();if(!V.trim().startsWith("<"))throw Error("Get license dialog fail. Can't get valid HTMLElement.");let H=document.createElement("div");H.innerHTML=V;let Y=[];for(let de=0;de<H.childElementCount;++de){let c=H.children[de];c instanceof HTMLStyleElement&&(Y.push(c),document.head.append(c))}let Z=H.childElementCount==1?H.children[0]:H;Z.remove();let he,ce,ye,be,_,ue=[Z],Ee=Z.children;for(let de of Ee)ue.push(de);for(let de=0;de<ue.length;++de)for(let c of ue[de].children)ue.push(c);for(let de of ue)if(!he&&de.classList.contains("dls-license-mask"))he=de,de.addEventListener("click",c=>{if(de==c.target){Z.remove();for(let a of Y)a.remove()}});else if(!ce&&de.classList.contains("dls-license-icon-close"))ce=de,de.addEventListener("click",()=>{Z.remove();for(let c of Y)c.remove()});else if(!ye&&de.classList.contains("dls-license-icon-error"))ye=de,R!="error"&&de.remove();else if(!be&&de.classList.contains("dls-license-icon-warn"))be=de,R!="warn"&&de.remove();else if(!_&&de.classList.contains("dls-license-msg-content")){_=de;let c=O;for(;c;){let a=c.indexOf("["),l=c.indexOf("]",a),d=c.indexOf("(",l),r=c.indexOf(")",d);if(a==-1||l==-1||d==-1||r==-1){de.appendChild(new Text(c));break}a>0&&de.appendChild(new Text(c.substring(0,a)));let s=document.createElement("a"),u=c.substring(a+1,l);s.innerText=u;let m=c.substring(d+1,r);s.setAttribute("href",m),s.setAttribute("target","_blank"),de.appendChild(s),c=c.substring(r+1)}}document.body.appendChild(Z)}catch(B){M._onLog&&M._onLog(B.message||B)}}))({_bNeverShowDialog:rt._bNeverShowDialog,engineResourcePath:x,_onLog:Tn},w.success?"warn":"error",w.message)}w.success?p.resolve(void 0):p.reject(I)},yield Gc("worker"),Me.postMessage({type:"dynamsoft",body:{v:"3.2.21",brtk:!!t,bptk:t===1,l:e,os:Kt,fn:rt.deviceFriendlyName,ls:n,sp:i,rmk:o,cv:h},id:v}),rt.bCallInitLicense=!0,yield p}))}),xg;tt.license={},tt.license.dynamsoft=Og,tt.license.getAR=()=>z(void 0,null,function*(){{let t=Zt.dynamsoft_inited;t&&t.isRejected&&(yield t)}return Me?new Promise((t,e)=>{let n=Ge();Le[n]=i=>z(void 0,null,function*(){if(i.success){delete i.success;{let o=rt.license;o&&(o.startsWith("t")||o.startsWith("f"))&&(i.pk=o)}if(Object.keys(i).length){if(i.lem){let o=Error(i.lem);o.ltsErrorCode=i.lec,delete i.lem,delete i.lec,i.ae=o}t(i)}else t(null)}else{let o=Error(i.message);i.stack&&(o.stack=i.stack),e(o)}}),Me.postMessage({type:"getAR",id:n})}):null});var rt=class t{static setLicenseServer(e){Tg(t,e)}static get license(){return this._license}static set license(e){bg(t,e)}static get licenseServer(){return this._licenseServer}static set licenseServer(e){Tg(t,e)}static get deviceFriendlyName(){return this._deviceFriendlyName}static set deviceFriendlyName(e){Sg(t,e)}static initLicense(e,n){if(bg(t,e),t.bCallInitLicense=!0,n)return Og()}static setDeviceFriendlyName(e){Sg(t,e)}static getDeviceFriendlyName(){return t._deviceFriendlyName}static getDeviceUUID(){return z(this,null,function*(){return yield ls("dynamsoft_uuid",()=>z(this,null,function*(){yield kt();let e=new ds,n=Ge();Le[n]=i=>{if(i.success)e.resolve(i.uuid);else{let o=Error(i.message);i.stack&&(o.stack=i.stack),e.reject(o)}},Me.postMessage({type:"getDeviceUUID",id:n}),xg=yield e})),xg})}};rt._pLoad=new ds,rt.bPassValidation=!1,rt.bCallInitLicense=!1,rt._license=X0,rt._licenseServer=[],rt._deviceFriendlyName="",Se.license==null&&(Se.license=Ag),Tt.license={wasm:!0},tt.license.LicenseManager=rt;var Yc="1.2.10";typeof Se.std!="string"&&Qt(Se.std.version,Yc)<0&&(Se.std={version:Yc,path:Mg(Ag+`../../dynamsoft-capture-vision-std@${Yc}/dist/`)});var kg=typeof self>"u",Xc=(()=>{if(!kg&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Bg=t=>{if(t==null&&(t="./"),!kg){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};Se.dbr==null&&(Se.dbr=Xc),Tt.dbr={js:!1,wasm:!0,deps:["license","dip"]},tt.dbr={};var zc="1.2.0";typeof Se.std!="string"&&Qt(Se.std.version,zc)<0&&(Se.std={version:zc,path:Bg(Xc+`../../dynamsoft-capture-vision-std@${zc}/dist/`)});var $c="2.2.10";(!Se.dip||typeof Se.dip!="string"&&Qt(Se.dip.version,$c)<0)&&(Se.dip={version:$c,path:Bg(Xc+`../../dynamsoft-image-processing@${$c}/dist/`)});var rI=typeof BigInt=="function"?{BF_NULL:BigInt(0),BF_ALL:BigInt(18446744073709552e3),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"},Lg,Fg,Ng,Pg;(function(t){t[t.EBRT_STANDARD_RESULT=0]="EBRT_STANDARD_RESULT",t[t.EBRT_CANDIDATE_RESULT=1]="EBRT_CANDIDATE_RESULT",t[t.EBRT_PARTIAL_RESULT=2]="EBRT_PARTIAL_RESULT"})(Lg||(Lg={})),function(t){t[t.QRECL_ERROR_CORRECTION_H=0]="QRECL_ERROR_CORRECTION_H",t[t.QRECL_ERROR_CORRECTION_L=1]="QRECL_ERROR_CORRECTION_L",t[t.QRECL_ERROR_CORRECTION_M=2]="QRECL_ERROR_CORRECTION_M",t[t.QRECL_ERROR_CORRECTION_Q=3]="QRECL_ERROR_CORRECTION_Q"}(Fg||(Fg={})),function(t){t[t.LM_AUTO=1]="LM_AUTO",t[t.LM_CONNECTED_BLOCKS=2]="LM_CONNECTED_BLOCKS",t[t.LM_STATISTICS=4]="LM_STATISTICS",t[t.LM_LINES=8]="LM_LINES",t[t.LM_SCAN_DIRECTLY=16]="LM_SCAN_DIRECTLY",t[t.LM_STATISTICS_MARKS=32]="LM_STATISTICS_MARKS",t[t.LM_STATISTICS_POSTAL_CODE=64]="LM_STATISTICS_POSTAL_CODE",t[t.LM_CENTRE=128]="LM_CENTRE",t[t.LM_ONED_FAST_SCAN=256]="LM_ONED_FAST_SCAN",t[t.LM_REV=-2147483648]="LM_REV",t[t.LM_SKIP=0]="LM_SKIP"}(Ng||(Ng={})),function(t){t[t.DM_DIRECT_BINARIZATION=1]="DM_DIRECT_BINARIZATION",t[t.DM_THRESHOLD_BINARIZATION=2]="DM_THRESHOLD_BINARIZATION",t[t.DM_GRAY_EQUALIZATION=4]="DM_GRAY_EQUALIZATION",t[t.DM_SMOOTHING=8]="DM_SMOOTHING",t[t.DM_MORPHING=16]="DM_MORPHING",t[t.DM_DEEP_ANALYSIS=32]="DM_DEEP_ANALYSIS",t[t.DM_SHARPENING=64]="DM_SHARPENING",t[t.DM_BASED_ON_LOC_BIN=128]="DM_BASED_ON_LOC_BIN",t[t.DM_SHARPENING_SMOOTHING=256]="DM_SHARPENING_SMOOTHING",t[t.DM_REV=-2147483648]="DM_REV",t[t.DM_SKIP=0]="DM_SKIP"}(Pg||(Pg={}));rt.initLicense("DLS2eyJoYW5kc2hha2VDb2RlIjoiMjAwMDAwLWRicl9qc19zYW1wbGVzIiwib3JnYW5pemF0aW9uSUQiOiIyMDAwMDAifQ==");Je.engineResourcePaths={std:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-std@1.2.10/dist/",dip:"https://cdn.jsdelivr.net/npm/dynamsoft-image-processing@2.2.30/dist/",core:"https://cdn.jsdelivr.net/npm/dynamsoft-core@3.2.30/dist/",license:"https://cdn.jsdelivr.net/npm/dynamsoft-license@3.2.21/dist/",cvr:"https://cdn.jsdelivr.net/npm/dynamsoft-capture-vision-router@2.2.30/dist/",dbr:"https://cdn.jsdelivr.net/npm/dynamsoft-barcode-reader@10.2.10/dist/",dce:"https://cdn.jsdelivr.net/npm/dynamsoft-camera-enhancer@4.0.3/dist/"};Je.loadWasm(["DBR"]);var jg=t=>t&&typeof t=="object"&&typeof t.then=="function",Zn=class extends Promise{constructor(e){let n,i;super((o,h)=>{n=o,i=h}),this._s="pending",this.resolve=o=>{this.isPending&&(jg(o)?this.task=o:(this._s="fulfilled",n(o)))},this.reject=o=>{this.isPending&&(this._s="rejected",i(o))},this.task=e}get status(){return this._s}get isPending(){return this._s==="pending"}get isFulfilled(){return this._s==="fulfilled"}get isRejected(){return this._s==="rejected"}get task(){return this._task}set task(e){let n;this._task=e,jg(e)?n=e:typeof e=="function"&&(n=new Promise(e)),n&&z(this,null,function*(){try{let i=yield n;e===this._task&&this.resolve(i)}catch(i){e===this._task&&this.reject(i)}})}get isEmpty(){return this._task==null}},Kc=class{constructor(e){this._cvr=e}getMaxBufferedItems(){return z(this,null,function*(){return yield new Promise((e,n)=>{let i=Ge();Le[i]=o=>z(this,null,function*(){if(o.success)return e(o.count);{let h=new Error(o.message);return h.stack=o.stack+`
`+h.stack,n(h)}}),Me.postMessage({type:"cvr_getMaxBufferedItems",id:i,instanceID:this._cvr._instanceID})})})}setMaxBufferedItems(e){return z(this,null,function*(){return yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success)return n();{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_setMaxBufferedItems",id:o,instanceID:this._cvr._instanceID,body:{count:e}})})})}getBufferedCharacterItemSet(){return z(this,null,function*(){return yield new Promise((e,n)=>{let i=Ge();Le[i]=o=>z(this,null,function*(){if(o.success)return e(o.itemSet);{let h=new Error(o.message);return h.stack=o.stack+`
`+h.stack,n(h)}}),Me.postMessage({type:"cvr_getBufferedCharacterItemSet",id:i,instanceID:this._cvr._instanceID})})})}},q0={onTaskResultsReceived:!1,onTaskResultsReceivedForDce:!1,onPredetectedRegionsReceived:!1,onLocalizedBarcodesReceived:!1,onDecodedBarcodesReceived:!1,onLocalizedTextLinesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onColourImageUnitReceived:!1,onScaledDownColourImageUnitReceived:!1,onGrayscaleImageUnitReceived:!1,onTransformedGrayscaleImageUnitReceived:!1,onEnhancedGrayscaleImageUnitReceived:!1,onBinaryImageUnitReceived:!1,onTextureDetectionResultUnitReceived:!1,onTextureRemovedGrayscaleImageUnitReceived:!1,onTextureRemovedBinaryImageUnitReceived:!1,onContoursUnitReceived:!1,onLineSegmentsUnitReceived:!1,onTextZonesUnitReceived:!1,onTextRemovedBinaryImageUnitReceived:!1,onLongLinesUnitReceived:!1,onCornersUnitReceived:!1,onCandidateQuadEdgesUnitReceived:!1,onCandidateBarcodeZonesUnitReceived:!1,onScaledUpBarcodeImageUnitReceived:!1,onDeformationResistedBarcodeImageUnitReceived:!1,onComplementedBarcodeImageUnitReceived:!1,onShortLinesUnitReceived:!1},Ug=(t,e)=>{for(let n in e._irrRegistryState)e._irrRegistryState[n]=!1;for(let n of t._intermediateResultReceiverSet)if(n.isDce)e._irrRegistryState.onTaskResultsReceivedForDce=!0;else for(let i in n)e._irrRegistryState[i]||(e._irrRegistryState[i]=!!n[i])},Jc=class{constructor(e){this._irrRegistryState=q0,this._cvr=e}addResultReceiver(e){return z(this,null,function*(){if(typeof e!="object")throw new Error("Invalid receiver.");this._cvr._intermediateResultReceiverSet.add(e),Ug(this._cvr,this);let n=-1,i={};if(!e.isDce){if(!e._observedResultUnitTypes||!e._observedTaskMap)throw new Error("Invalid Intermediate Result Receiver.");n=e._observedResultUnitTypes,e._observedTaskMap.forEach((o,h)=>{i[h]=o}),e._observedTaskMap.clear()}return yield new Promise((o,h)=>{let p=Ge();Le[p]=v=>z(this,null,function*(){if(v.success)return o();{let w=new Error(v.message);return w.stack=v.stack+`
`+w.stack,h(w)}}),Me.postMessage({type:"cvr_setIrrRegistry",id:p,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState,observedResultUnitTypes:String(n),observedTaskMap:i}})})})}removeResultReceiver(e){return z(this,null,function*(){return this._cvr._intermediateResultReceiverSet.delete(e),Ug(this._cvr,this),yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success)return n();{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_setIrrRegistry",id:o,instanceID:this._cvr._instanceID,body:{receiverObj:this._irrRegistryState}})})})}getOriginalImage(){return this._cvr._dsImage}},Gg=typeof self>"u",eu=(()=>{if(!Gg&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Hg=t=>{if(t==null&&(t="./"),!Gg){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t},qc;Se.cvr==null&&(Se.cvr=eu),Tt.cvr={js:!0,wasm:!0,deps:["license","dip"]},tt.cvr={};var Zc="1.2.10";typeof Se.std!="string"&&Qt(Se.std.version,Zc)<0&&(Se.std={version:Zc,path:Hg(eu+`../../dynamsoft-capture-vision-std@${Zc}/dist/`)});var Qc="2.2.30";(!Se.dip||typeof Se.dip!="string"&&Qt(Se.dip.version,Qc)<0)&&(Se.dip={version:Qc,path:Hg(eu+`../../dynamsoft-image-processing@${Qc}/dist/`)});var Uo=class{static getVersion(){return this._version}},Vo,Vg;function Wg(t,e){if(t&&t.location){let n=t.location.points;for(let i of n)i.x=i.x/e,i.y=i.y/e;Wg(t.referencedItem,e)}}Uo._version=`2.2.30(Worker: ${(qc=qt.cvr)===null||qc===void 0?void 0:qc.worker}, Wasm: loading...`,function(t){t[t.ISS_BUFFER_EMPTY=0]="ISS_BUFFER_EMPTY",t[t.ISS_EXHAUSTED=1]="ISS_EXHAUSTED"}(Vo||(Vo={})),function(t){t[t.IRUT_NULL=0]="IRUT_NULL",t[t.IRUT_COLOUR_IMAGE=1]="IRUT_COLOUR_IMAGE",t[t.IRUT_SCALED_DOWN_COLOUR_IMAGE=2]="IRUT_SCALED_DOWN_COLOUR_IMAGE",t[t.IRUT_GRAYSCALE_IMAGE=4]="IRUT_GRAYSCALE_IMAGE",t[t.IRUT_TRANSOFORMED_GRAYSCALE_IMAGE=8]="IRUT_TRANSOFORMED_GRAYSCALE_IMAGE",t[t.IRUT_ENHANCED_GRAYSCALE_IMAGE=16]="IRUT_ENHANCED_GRAYSCALE_IMAGE",t[t.IRUT_PREDETECTED_REGIONS=32]="IRUT_PREDETECTED_REGIONS",t[t.IRUT_BINARY_IMAGE=64]="IRUT_BINARY_IMAGE",t[t.IRUT_TEXTURE_DETECTION_RESULT=128]="IRUT_TEXTURE_DETECTION_RESULT",t[t.IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE=256]="IRUT_TEXTURE_REMOVED_GRAYSCALE_IMAGE",t[t.IRUT_TEXTURE_REMOVED_BINARY_IMAGE=512]="IRUT_TEXTURE_REMOVED_BINARY_IMAGE",t[t.IRUT_CONTOURS=1024]="IRUT_CONTOURS",t[t.IRUT_LINE_SEGMENTS=2048]="IRUT_LINE_SEGMENTS",t[t.IRUT_TEXT_ZONES=4096]="IRUT_TEXT_ZONES",t[t.IRUT_TEXT_REMOVED_BINARY_IMAGE=8192]="IRUT_TEXT_REMOVED_BINARY_IMAGE",t[t.IRUT_CANDIDATE_BARCODE_ZONES=16384]="IRUT_CANDIDATE_BARCODE_ZONES",t[t.IRUT_LOCALIZED_BARCODES=32768]="IRUT_LOCALIZED_BARCODES",t[t.IRUT_SCALED_UP_BARCODE_IMAGE=65536]="IRUT_SCALED_UP_BARCODE_IMAGE",t[t.IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE=131072]="IRUT_DEFORMATION_RESISTED_BARCODE_IMAGE",t[t.IRUT_COMPLEMENTED_BARCODE_IMAGE=262144]="IRUT_COMPLEMENTED_BARCODE_IMAGE",t[t.IRUT_DECODED_BARCODES=524288]="IRUT_DECODED_BARCODES",t[t.IRUT_LONG_LINES=1048576]="IRUT_LONG_LINES",t[t.IRUT_CORNERS=2097152]="IRUT_CORNERS",t[t.IRUT_CANDIDATE_QUAD_EDGES=4194304]="IRUT_CANDIDATE_QUAD_EDGES",t[t.IRUT_DETECTED_QUADS=8388608]="IRUT_DETECTED_QUADS",t[t.IRUT_LOCALIZED_TEXT_LINES=16777216]="IRUT_LOCALIZED_TEXT_LINES",t[t.IRUT_RECOGNIZED_TEXT_LINES=33554432]="IRUT_RECOGNIZED_TEXT_LINES",t[t.IRUT_NORMALIZED_IMAGES=67108864]="IRUT_NORMALIZED_IMAGES",t[t.IRUT_SHORT_LINES=134217728]="IRUT_SHORT_LINES",t[t.IRUT_ALL=134217727]="IRUT_ALL"}(Vg||(Vg={}));var rr=class t{constructor(){this.maxCvsSideLength=["iPhone","Android","HarmonyOS"].includes(Je.browserInfo.OS)?2048:4096,this._isa=null,this._dsImage=null,this._instanceID=void 0,this._bPauseScan=!0,this._bNeedOutputOriginalImage=!1,this._canvas=null,this._resultReceiverSet=new Set,this._isaStateListenerSet=new Set,this._resultFilterSet=new Set,this._intermediateResultReceiverSet=new Set,this._intermediateResultManager=null,this._bufferdItemsManager=null,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1,this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._minImageCaptureInterval=0,this._averageProcessintTimeArray=[],this._averageFetchImageTimeArray=[],this._currentSettings=null,this._averageTime=999,this._compressRate=0,this._dynamsoft=!1,this.captureInParallel=!0,this.bDestroyed=!1,this._singleFrameModeCallbackBind=this._singleFrameModeCallback.bind(this),this._promiseStartScan=null}get disposed(){return this.bDestroyed}static createInstance(){return z(this,null,function*(){if(!tt.license)throw Error("Module `license` is not existed.");yield tt.license.dynamsoft(),yield kt(["cvr"]);let e=new t,n=new Zn,i=Ge();return Le[i]=o=>z(this,null,function*(){var h;if(o.success)e._instanceID=o.instanceID,e._currentSettings=JSON.parse(o.outputSettings),Uo._version=`2.2.30(Worker: ${(h=qt.cvr)===null||h===void 0?void 0:h.worker}, Wasm: ${o.version})`,Je.bSupportDce4Module===0&&(e._intermediateResultManager=e.getIntermediateResultManager(!0)),n.resolve(e);else{let p=Error(o.message);o.stack&&(p.stack=o.stack),n.reject(p)}}),Me.postMessage({type:"cvr_createInstance",id:i}),n})}_singleFrameModeCallback(e){return z(this,null,function*(){this._isa.getCameraView().setScanLaserVisible(!0);for(let h of this._resultReceiverSet)this._bNeedOutputOriginalImage&&h.onOriginalImageResultReceived&&h.onOriginalImageResultReceived({imageData:e});let n={bytes:new Uint8Array(e.bytes),width:e.width,height:e.height,stride:e.stride,format:e.format,tag:e.tag};this._templateName||(this._templateName=this._currentSettings.CaptureVisionTemplates[0].Name);let i=yield this.capture(n,this._templateName);i.originalImageTag=e.tag;for(let h of this._resultReceiverSet)h.isDce&&h.onCapturedResultReceived(i,{isDetectVerifyOpen:!1,isNormalizeVerifyOpen:!1,isBarcodeVerifyOpen:!1,isLabelVerifyOpen:!1});let o={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let h of this._resultReceiverSet)if(h.onDecodedBarcodesReceived&&i.barcodeResultItems&&h.onDecodedBarcodesReceived(Object.assign(Object.assign({},o),{barcodeResultItems:i.barcodeResultItems})),h.onRecognizedTextLinesReceived&&i.textLineResultItems&&h.onRecognizedTextLinesReceived(Object.assign(Object.assign({},o),{textLineResultItems:i.textLineResultItems})),h.onDetectedQuadsReceived&&i.detectedQuadResultItems&&h.onDetectedQuadsReceived(Object.assign(Object.assign({},o),{detectedQuadResultItems:i.detectedQuadResultItems})),h.onNormalizedImagesReceived&&i.normalizedImageResultItems&&h.onNormalizedImagesReceived(Object.assign(Object.assign({},o),{normalizedImageResultItems:i.normalizedImageResultItems})),h.onParsedResultsReceived&&i.parsedResultItems&&h.onParsedResultsReceived(Object.assign(Object.assign({},o),{parsedResultItems:i.parsedResultItems})),h.onCapturedResultReceived&&!h.isDce){if(this._bNeedOutputOriginalImage){let p=i.items.findIndex(v=>v.type===1);p!==-1&&(i.items[p].imageData=e)}h.onCapturedResultReceived(i)}})}setInput(e){if(this._checkIsDisposed(),e){if(this._isa=e,e.isCameraEnhancer){this._intermediateResultManager&&(this._isa._intermediateResultReceiver.isDce=!0,this._intermediateResultManager.addResultReceiver(this._isa._intermediateResultReceiver));let n=this._isa.getCameraView();if(n){let i=n._capturedResultReceiver;i.isDce=!0,this._resultReceiverSet.add(i)}}}else this._isa=null}getInput(){return this._isa}addImageSourceStateListener(e){if(this._checkIsDisposed(),typeof e!="object")return console.warn("Invalid ISA state listener.");e&&Object.keys(e)&&this._isaStateListenerSet.add(e)}removeImageSourceStateListener(e){return this._checkIsDisposed(),this._isaStateListenerSet.delete(e)}addResultReceiver(e){if(this._checkIsDisposed(),typeof e!="object")throw new Error("Invalid receiver.");e&&Object.keys(e).length&&(this._resultReceiverSet.add(e),this._setCrrRegistry())}removeResultReceiver(e){this._checkIsDisposed(),this._resultReceiverSet.delete(e),this._setCrrRegistry()}_setCrrRegistry(){return z(this,null,function*(){let e={onCapturedResultReceived:!1,onDecodedBarcodesReceived:!1,onRecognizedTextLinesReceived:!1,onDetectedQuadsReceived:!1,onNormalizedImagesReceived:!1,onParsedResultsReceived:!1};for(let o of this._resultReceiverSet)o.isDce||(e.onCapturedResultReceived=!!o.onCapturedResultReceived,e.onDecodedBarcodesReceived=!!o.onDecodedBarcodesReceived,e.onRecognizedTextLinesReceived=!!o.onRecognizedTextLinesReceived,e.onDetectedQuadsReceived=!!o.onDetectedQuadsReceived,e.onNormalizedImagesReceived=!!o.onNormalizedImagesReceived,e.onParsedResultsReceived=!!o.onParsedResultsReceived);let n=new Zn,i=Ge();return Le[i]=o=>z(this,null,function*(){if(o.success)n.resolve();else{let h=new Error(o.message);h.stack=o.stack+`
`+h.stack,n.reject()}}),Me.postMessage({type:"cvr_setCrrRegistry",id:i,instanceID:this._instanceID,body:{receiver:JSON.stringify(e)}}),n})}addResultFilter(e){return z(this,null,function*(){if(this._checkIsDisposed(),typeof e!="object")return console.warn("Invalid filter.");if(e&&Object.keys(e)){this._resultFilterSet.add(e),this._handleFilterSwitch();for(let n of this._resultFilterSet)yield this._enableResultCrossVerification(n.verificationEnabled),yield this._enableResultDeduplication(n.duplicateFilterEnabled),yield this._setDuplicateForgetTime(n.duplicateForgetTime)}})}removeResultFilter(e){return z(this,null,function*(){this._checkIsDisposed(),this._resultFilterSet.delete(e),this._handleFilterSwitch();for(let n of this._resultFilterSet)yield this._enableResultCrossVerification(n.verificationEnabled),yield this._enableResultDeduplication(n.duplicateFilterEnabled),yield this._setDuplicateForgetTime(n.duplicateForgetTime)})}_handleFilterSwitch(){this._bOpenBarcodeVerify=!1,this._bOpenLabelVerify=!1,this._bOpenDetectVerify=!1,this._bOpenNormalizeVerify=!1;for(let e of this._resultFilterSet)e.isResultCrossVerificationEnabled(De.CRIT_BARCODE)&&(this._bOpenBarcodeVerify=!0),e.isResultCrossVerificationEnabled(De.CRIT_TEXT_LINE)&&(this._bOpenLabelVerify=!0),e.isResultCrossVerificationEnabled(De.CRIT_DETECTED_QUAD)&&(this._bOpenDetectVerify=!0),e.isResultCrossVerificationEnabled(De.CRIT_NORMALIZED_IMAGE)&&(this._bOpenNormalizeVerify=!0)}startCapturing(e){return z(this,null,function*(){var n,i;if(this._checkIsDisposed(),!this._bPauseScan)return;if(!this._isa)throw new Error("'ImageSourceAdapter' is not set. call 'setInput' before 'startCapturing'");e||(e=this._currentSettings.CaptureVisionTemplates[0].Name);let o=yield this.containsTask(e);return yield kt(o),o.includes("dlr")&&!(!((n=tt.dlr)===null||n===void 0)&&n.bLoadConfusableCharsData)&&(yield(i=tt.dlr)===null||i===void 0?void 0:i.loadRecognitionData("ConfusableChars",Se.dlr)),this._isa.isCameraEnhancer&&(o.includes("ddn")?this._isa.setPixelFormat(Ie.IPF_ABGR_8888):this._isa.setPixelFormat(Ie.IPF_GRAYSCALED)),this._isa.singleFrameMode!==void 0&&this._isa.singleFrameMode!=="disabled"?(this._templateName=e,void this._isa.on("singleFrameAcquired",this._singleFrameModeCallbackBind)):(this._isa.getColourChannelUsageType()===Xt.CCUT_AUTO&&this._isa.setColourChannelUsageType(o.includes("ddn")?Xt.CCUT_FULL_CHANNEL:Xt.CCUT_Y_CHANNEL_ONLY),this._promiseStartScan&&this._promiseStartScan.isPending?this._promiseStartScan:(this._promiseStartScan=new Zn((h,p)=>{if(this.disposed)return;let v=Ge();Le[v]=w=>z(this,null,function*(){if(this._promiseStartScan&&!this._promiseStartScan.isFulfilled){if(!w.success){let I=new Error(w.message);return I.stack=w.stack+`
`+I.stack,p(I)}for(let I of this._resultFilterSet)yield this.addResultFilter(I);this._bPauseScan=!1,this._bNeedOutputOriginalImage=w.bNeedOutputOriginalImage,this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>z(this,null,function*(){this._minImageCaptureInterval!==-1&&this._isa.startFetching(),this._loopReadVideo(e),h()}),0),this._isa.isCameraEnhancer&&this._isa.getCameraView().setScanLaserVisible(!0)}}),Me.postMessage({type:"cvr_startCapturing",id:v,instanceID:this._instanceID,body:{templateName:e}})}),yield this._promiseStartScan))})}stopCapturing(){this._checkIsDisposed(),this._isa&&(this._isa.isCameraEnhancer&&(this._isa.getCameraView().setScanLaserVisible(!1),this._isa.singleFrameMode!==void 0&&this._isa.singleFrameMode!=="disabled")?this._isa.off("singleFrameAcquired",this._singleFrameModeCallbackBind):(this._isa.stopFetching(),this._clearVerifyList(),this._averageProcessintTimeArray=[],this._averageTime=999,this._bPauseScan=!0,this._promiseStartScan=null,this._isa.setColourChannelUsageType(Xt.CCUT_AUTO)))}_clearVerifyList(){return z(this,null,function*(){let e=Ge(),n=new Zn;return Le[e]=i=>z(this,null,function*(){if(i.success)return n.resolve();{let o=new Error(i.message);return o.stack=i.stack+`
`+o.stack,n.reject(o)}}),Me.postMessage({type:"cvr_clearVerifyList",id:e,instanceID:this._instanceID}),n})}_getIntermediateResult(){return z(this,null,function*(){this._checkIsDisposed();let e=Ge(),n=new Zn;return Le[e]=i=>z(this,null,function*(){if(i.success)n.resolve(i.result);else{let o=new Error(i.message);o.stack=i.stack+`
`+o.stack,n.reject(o)}}),Me.postMessage({type:"cvr_getIntermediateResult",id:e,instanceID:this._instanceID}),n})}containsTask(e){return z(this,null,function*(){return this._checkIsDisposed(),yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success)return n(JSON.parse(h.tasks));{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_containsTask",id:o,instanceID:this._instanceID,body:{templateName:e}})})})}_loopReadVideo(e){return z(this,null,function*(){if(this._dynamsoft=!0,this.disposed||this._bPauseScan)return;if(this._isa.isBufferEmpty()){if(this._isa.hasNextImageToFetch())for(let i of this._isaStateListenerSet)i.onImageSourceStateReceived&&i.onImageSourceStateReceived(Vo.ISS_BUFFER_EMPTY);else if(!this._isa.hasNextImageToFetch())for(let i of this._isaStateListenerSet)i.onImageSourceStateReceived&&i.onImageSourceStateReceived(Vo.ISS_EXHAUSTED)}if(this._minImageCaptureInterval===-1||this._isa.isBufferEmpty())try{this._isa.isBufferEmpty()&&t._onLog&&t._onLog("buffer is empty so fetch image"),t._onLog&&t._onLog(`DCE: start fetching a frame: ${Date.now()}`),this._dsImage=this._isa.fetchImage(),t._onLog&&t._onLog(`DCE: finish fetching a frame: ${Date.now()}`),this._isa.setImageFetchInterval(this._averageTime)}catch{return void this._reRunCurrnetFunc(e)}else if(this._isa.setImageFetchInterval(this._averageTime-(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0)),this._dsImage=this._isa.getImage(),this._dsImage.tag&&Date.now()-this._dsImage.tag.timeStamp>200)return void this._reRunCurrnetFunc(e);if(!this._dsImage)return void this._reRunCurrnetFunc(e);for(let i of this._resultReceiverSet)this._bNeedOutputOriginalImage&&i.onOriginalImageResultReceived&&i.onOriginalImageResultReceived({imageData:this._dsImage});let n=Date.now();this._captureDsimage(this._dsImage,e).then(i=>z(this,null,function*(){if(t._onLog&&t._onLog("no js handle time: "+(Date.now()-n)),this._bPauseScan)return void this._reRunCurrnetFunc(e);i.originalImageTag=this._dsImage.tag?this._dsImage.tag:null;for(let p of this._resultReceiverSet)if(p.isDce){let v=Date.now();if(p.onCapturedResultReceived(i,{isDetectVerifyOpen:this._bOpenDetectVerify,isNormalizeVerifyOpen:this._bOpenNormalizeVerify,isBarcodeVerifyOpen:this._bOpenBarcodeVerify,isLabelVerifyOpen:this._bOpenLabelVerify}),t._onLog){let w=Date.now()-v;w>10&&t._onLog(`draw result time: ${w}`)}}let o={originalImageHashId:i.originalImageHashId,originalImageTag:i.originalImageTag,errorCode:i.errorCode,errorString:i.errorString};for(let p of this._resultReceiverSet)p.onDecodedBarcodesReceived&&i.barcodeResultItems&&p.onDecodedBarcodesReceived(Object.assign(Object.assign({},o),{barcodeResultItems:i.barcodeResultItems.filter(v=>!v.isFilter)})),p.onRecognizedTextLinesReceived&&i.textLineResultItems&&p.onRecognizedTextLinesReceived(Object.assign(Object.assign({},o),{textLineResultItems:i.textLineResultItems.filter(v=>!v.isFilter)})),p.onDetectedQuadsReceived&&i.detectedQuadResultItems&&p.onDetectedQuadsReceived(Object.assign(Object.assign({},o),{detectedQuadResultItems:i.detectedQuadResultItems.filter(v=>!v.isFilter)})),p.onNormalizedImagesReceived&&i.normalizedImageResultItems&&p.onNormalizedImagesReceived(Object.assign(Object.assign({},o),{normalizedImageResultItems:i.normalizedImageResultItems.filter(v=>!v.isFilter)})),p.onParsedResultsReceived&&i.parsedResultItems&&p.onParsedResultsReceived(Object.assign(Object.assign({},o),{parsedResultItems:i.parsedResultItems.filter(v=>!v.isFilter)})),p.onCapturedResultReceived&&!p.isDce&&(i.items=i.items.filter(v=>!v.isFilter),i.barcodeResultItems&&(i.barcodeResultItems=i.barcodeResultItems.filter(v=>!v.isFilter)),i.textLineResultItems&&(i.textLineResultItems=i.textLineResultItems.filter(v=>!v.isFilter)),i.detectedQuadResultItems&&(i.detectedQuadResultItems=i.detectedQuadResultItems.filter(v=>!v.isFilter)),i.normalizedImageResultItems&&(i.normalizedImageResultItems=i.normalizedImageResultItems.filter(v=>!v.isFilter)),i.parsedResultItems&&(i.parsedResultItems=i.parsedResultItems.filter(v=>!v.isFilter)),p.onCapturedResultReceived(i));let h=Date.now();if(this._minImageCaptureInterval>-1&&(this._averageProcessintTimeArray.length===5&&this._averageProcessintTimeArray.shift(),this._averageFetchImageTimeArray.length===5&&this._averageFetchImageTimeArray.shift(),this._averageProcessintTimeArray.push(Date.now()-n),this._averageFetchImageTimeArray.push(this._dsImage&&this._dsImage.tag?this._dsImage.tag.timeSpent:0),this._averageTime=Math.min(...this._averageProcessintTimeArray)-Math.max(...this._averageFetchImageTimeArray),this._averageTime=this._averageTime>0?this._averageTime:0,t._onLog&&(t._onLog(`minImageCaptureInterval: ${this._minImageCaptureInterval}`),t._onLog(`averageProcessintTimeArray: ${this._averageProcessintTimeArray}`),t._onLog(`averageFetchImageTimeArray: ${this._averageFetchImageTimeArray}`),t._onLog(`averageTime: ${this._averageTime}`))),t._onLog){let p=Date.now()-h;p>10&&t._onLog(`fetch image calculate time: ${p}`)}t._onLog&&t._onLog(`time finish decode: ${Date.now()}`),t._onLog&&t._onLog("main time: "+(Date.now()-n)),t._onLog&&t._onLog("===================================================="),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._minImageCaptureInterval>0&&this._minImageCaptureInterval>=this._averageTime?this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},this._minImageCaptureInterval-this._averageTime):this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,0))})).catch(i=>{this._isa.stopFetching(),this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._isa.startFetching(),this._loopReadVideo(e)},Math.max(this._minImageCaptureInterval,1e3)),i.message!=="platform error"&&setTimeout(()=>{throw i},0)})})}_reRunCurrnetFunc(e){this._loopReadVideoTimeoutId&&clearTimeout(this._loopReadVideoTimeoutId),this._loopReadVideoTimeoutId=setTimeout(()=>{this._loopReadVideo(e)},0)}capture(e,n){return z(this,null,function*(){var i,o;this._checkIsDisposed(),n||(n=this._currentSettings.CaptureVisionTemplates[0].Name);let h=yield this.containsTask(n),p;if(yield kt(h),h.includes("dlr")&&!(!((i=tt.dlr)===null||i===void 0)&&i.bLoadConfusableCharsData)&&(yield(o=tt.dlr)===null||o===void 0?void 0:o.loadRecognitionData("ConfusableChars",Se.dlr)),this._dynamsoft=!1,No(e))p=yield this._captureDsimage(e,n);else if(typeof e=="string")p=e.substring(0,11)=="data:image/"?yield this._captureBase64(e,n):yield this._captureUrl(e,n);else if(e instanceof Blob)p=yield this._captureBlob(e,n);else if(e instanceof HTMLImageElement)p=yield this._captureImage(e,n);else if(e instanceof HTMLCanvasElement)p=yield this._captureCanvas(e,n);else{if(!(e instanceof HTMLVideoElement))throw new TypeError("'capture(imageOrFile, templateName)': Type of 'imageOrFile' should be 'DSImageData', 'Url', 'Base64', 'Blob', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement'.");p=yield this._captureVideo(e,n)}return p})}_captureDsimage(e,n){return z(this,null,function*(){return yield this._captureInWorker(e,n)})}_captureUrl(e,n){return z(this,null,function*(){let i=yield ko(e,"blob");return yield this._captureBlob(i,n)})}_captureBase64(e,n){return z(this,null,function*(){e=e.substring(e.indexOf(",")+1);let i=atob(e),o=i.length,h=new Uint8Array(o);for(;o--;)h[o]=i.charCodeAt(o);return yield this._captureBlob(new Blob([h]),n)})}_captureBlob(e,n){return z(this,null,function*(){let i=null,o=null;if(typeof createImageBitmap<"u")try{i=yield createImageBitmap(e)}catch{}i||(o=yield function(p){return z(this,null,function*(){return yield new Promise((v,w)=>{let I=URL.createObjectURL(p),S=new Image;S.src=I,S.onload=()=>{URL.revokeObjectURL(S.dbrObjUrl),v(S)},S.onerror=x=>{w(new Error("Can't convert blob to image : "+(x instanceof Event?x.type:x)))}})})}(e));let h=yield this._captureImage(i||o,n);return i&&i.close(),h})}_captureImage(e,n){return z(this,null,function*(){let i,o,h=e instanceof HTMLImageElement?e.naturalWidth:e.width,p=e instanceof HTMLImageElement?e.naturalHeight:e.height,v=Math.max(h,p);v>this.maxCvsSideLength?(this._compressRate=this.maxCvsSideLength/v,i=Math.round(h*this._compressRate),o=Math.round(p*this._compressRate)):(i=h,o=p),this._canvas||(this._canvas=document.createElement("canvas"));let w=this._canvas;return w.width===i&&w.height===o||(w.width=i,w.height=o),w.ctx2d||(w.ctx2d=w.getContext("2d",{willReadFrequently:!0})),w.ctx2d.drawImage(e,0,0,h,p,0,0,i,o),e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl),yield this._captureCanvas(w,n)})}_captureCanvas(e,n){return z(this,null,function*(){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";if([e.width,e.height].includes(0))throw Error("The width or height of the 'canvas' is 0.");let i=e.ctx2d||e.getContext("2d",{willReadFrequently:!0}),o={bytes:Uint8Array.from(i.getImageData(0,0,e.width,e.height).data),width:e.width,height:e.height,stride:4*e.width,format:10};return yield this._captureInWorker(o,n)})}_captureVideo(e,n){return z(this,null,function*(){if(e.crossOrigin&&e.crossOrigin!="anonymous")throw"cors";let i,o,h=e.videoWidth,p=e.videoHeight,v=Math.max(h,p);v>this.maxCvsSideLength?(this._compressRate=this.maxCvsSideLength/v,i=Math.round(h*this._compressRate),o=Math.round(p*this._compressRate)):(i=h,o=p),this._canvas||(this._canvas=document.createElement("canvas"));let w=this._canvas;return w.width===i&&w.height===o||(w.width=i,w.height=o),w.ctx2d||(w.ctx2d=w.getContext("2d",{willReadFrequently:!0})),w.ctx2d.drawImage(e,0,0,h,p,0,0,i,o),yield this._captureCanvas(w,n)})}_captureInWorker(e,n){return z(this,null,function*(){let{bytes:i,width:o,height:h,stride:p,format:v}=e,w=Ge(),I=new Zn;return Le[w]=S=>z(this,null,function*(){var x,M;if(!S.success){let R=new Error(S.message);return R.stack=S.stack+`
`+R.stack,I.reject(R)}{let R=Date.now();t._onLog&&(t._onLog(`get result time from worker: ${R}`),t._onLog("worker to main time consume: "+(R-S.workerReturnMsgTime)));try{let O=S.captureResult;e.bytes=S.bytes;for(let V of O.items)this._compressRate!==0&&Wg(V,this._compressRate),V.type===De.CRIT_ORIGINAL_IMAGE?V.imageData=e:V.type===De.CRIT_NORMALIZED_IMAGE?(x=tt.ddn)===null||x===void 0||x.handleNormalizedImageResultItem(V):V.type===De.CRIT_PARSED_RESULT&&((M=tt.dcp)===null||M===void 0||M.handleParsedResultItem(V));if(this._dynamsoft)for(let V of this._resultFilterSet)V.onDecodedBarcodesReceived(O.items),V.onRecognizedTextLinesReceived(O.items),V.onDetectedQuadsReceived(O.items),V.onNormalizedImagesReceived(O.items);let B=function(V){let H={barcodeResultItems:[],textLineResultItems:[],detectedQuadResultItems:[],normalizedImageResultItems:[],parsedResultItems:[]};return V.items.forEach(Y=>{Y.type===De.CRIT_BARCODE?H.barcodeResultItems.push(Y):Y.type===De.CRIT_TEXT_LINE?H.textLineResultItems.push(Y):Y.type===De.CRIT_DETECTED_QUAD?H.detectedQuadResultItems.push(Y):Y.type===De.CRIT_NORMALIZED_IMAGE?H.normalizedImageResultItems.push(Y):Y.type===De.CRIT_PARSED_RESULT&&H.parsedResultItems.push(Y)}),H}(O);if(B.barcodeResultItems.length&&(O.barcodeResultItems=B.barcodeResultItems),B.textLineResultItems.length&&(O.textLineResultItems=B.textLineResultItems),B.detectedQuadResultItems.length&&(O.detectedQuadResultItems=B.detectedQuadResultItems),B.normalizedImageResultItems.length&&(O.normalizedImageResultItems=B.normalizedImageResultItems),B.parsedResultItems.length&&(O.parsedResultItems=B.parsedResultItems),!this._bPauseScan||!this._dynamsoft){let V=O.intermediateResult;if(V){let H=0;for(let Y of this._intermediateResultReceiverSet){H++;for(let Z of V){if(Z.info.callbackName==="onTaskResultsReceived"){for(let he of Z.intermediateResultUnits)he.originalImageTag=e.tag?e.tag:null;Y[Z.info.callbackName]&&Y[Z.info.callbackName]({intermediateResultUnits:Z.intermediateResultUnits},Z.info)}else Y[Z.info.callbackName]&&Y[Z.info.callbackName](Z.result,Z.info);H===this._intermediateResultReceiverSet.size&&delete Z.info.callbackName}}}O&&O.intermediateResult&&delete O.intermediateResult}return this._compressRate=0,I.resolve(O)}catch(O){return I.reject(O)}}}),t._onLog&&t._onLog(`send buffer to worker: ${Date.now()}`),Me.postMessage({type:"cvr_capture",id:w,instanceID:this._instanceID,body:{bytes:i,width:o,height:h,stride:p,format:v,templateName:n||"",dynamsoft:this._dynamsoft}},[i.buffer]),I})}initSettings(e){return z(this,null,function*(){return this._checkIsDisposed(),e&&["string","object"].includes(typeof e)?(typeof e=="string"?e.startsWith("{")?this._currentSettings=JSON.parse(e):e=yield ko(e,"text"):typeof e=="object"&&(this._currentSettings=e,e=JSON.stringify(e)),yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success){let p=JSON.parse(h.response);if(p.exception!==0){let I=new Error(p.description?p.description:"Init Settings Failed.");return I.errorCode=p.exception,i(I)}let v=[],w=JSON.parse(e).CaptureVisionTemplates;for(let I=0;I<w.length;I++){let S=yield this.containsTask(w[I].Name);v=v.concat(S)}return yield kt([...new Set(v)]),this._bNeedOutputOriginalImage=this._currentSettings.CaptureVisionTemplates[0].OutputOriginalImage===1,n(p)}{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_initSettings",id:o,instanceID:this._instanceID,body:{settings:e}})})):console.error("Invalid template.")})}outputSettings(e){return z(this,null,function*(){return this._checkIsDisposed(),yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success){let p=JSON.parse(h.settings);if(p.errorCode!==0){let v=new Error(p.errorString);return v.errorCode=p.errorCode,i(v)}return delete p.errorCode,delete p.errorString,n(p)}{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_outputSettings",id:o,instanceID:this._instanceID,body:{templateName:e||"*"}})})})}outputSettingsToFile(e,n,i){return z(this,null,function*(){let o=yield this.outputSettings(e),h=new Blob([JSON.stringify(o,null,2,function(p,v){return v instanceof Array?JSON.stringify(v):v},2)],{type:"application/json"});if(i){let p=document.createElement("a");p.href=URL.createObjectURL(h),n.endsWith(".json")&&(n=n.replace(".json","")),p.download=`${n}.json`,p.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(p.href)},500)},p.click()}return h})}getSimplifiedSettings(e){return z(this,null,function*(){this._checkIsDisposed(),e||(e=this._currentSettings.CaptureVisionTemplates[0].Name);let n=yield this.containsTask(e);return yield kt(n),yield new Promise((i,o)=>{let h=Ge();Le[h]=p=>z(this,null,function*(){if(p.success){let v=JSON.parse(p.settings,(w,I)=>_g&&w==="barcodeFormatIds"?BigInt(I):I);if(v.minImageCaptureInterval=this._minImageCaptureInterval,v.code!==0){let w=new Error(v.codeString);return w.errorCode=v.errorCode,o(w)}return delete v.code,delete v.codeString,i(v)}{let v=new Error(p.message);return v.stack=p.stack+`
`+v.stack,o(v)}}),Me.postMessage({type:"cvr_getSimplifiedSettings",id:h,instanceID:this._instanceID,body:{templateName:e}})})})}updateSettings(e,n){return z(this,null,function*(){this._checkIsDisposed();let i=yield this.containsTask(e);return yield kt(i),yield new Promise((o,h)=>{let p=Ge();Le[p]=v=>z(this,null,function*(){if(v.success){let w=JSON.parse(v.response);if(n.minImageCaptureInterval&&n.minImageCaptureInterval>=-1&&(this._minImageCaptureInterval=n.minImageCaptureInterval),this._bNeedOutputOriginalImage=v.bNeedOutputOriginalImage,w.exception!==0){let I=new Error(w.description?w.description:"Update Settings Failed.");return I.errorCode=w.exception,h(I)}return this._currentSettings=yield this.outputSettings("*"),o(w)}{let w=new Error(v.message);return w.stack=v.stack+`
`+w.stack,h(w)}}),Me.postMessage({type:"cvr_updateSettings",id:p,instanceID:this._instanceID,body:{settings:n,templateName:e}})})})}resetSettings(){return z(this,null,function*(){return this._checkIsDisposed(),yield new Promise((e,n)=>{let i=Ge();Le[i]=o=>z(this,null,function*(){if(o.success){let h=JSON.parse(o.response);if(h.exception!==0){let p=new Error(h.description?h.description:"Reset Settings Failed.");return p.errorCode=h.exception,n(p)}return this._currentSettings=yield this.outputSettings("*"),e(h)}{let h=new Error(o.message);return h.stack=o.stack+`
`+h.stack,n(h)}}),Me.postMessage({type:"cvr_resetSettings",id:i,instanceID:this._instanceID})})})}getBufferedItemsManager(){return this._bufferdItemsManager||(this._bufferdItemsManager=new Kc(this)),this._bufferdItemsManager}getIntermediateResultManager(e){if(this._checkIsDisposed(),!e&&Je.bSupportIRTModule!==0)throw new Error("The current license does not support the use of intermediate results.");return this._intermediateResultManager||(this._intermediateResultManager=new Jc(this)),this._intermediateResultManager}contains(e,n){return function(i,o){let h=o.x,p=o.y,v=i[0].x,w=i[0].y,I=i[1].x,S=i[1].y,x=i[2].x,M=i[2].y,R=i[3].x,O=i[3].y,B=Z(h,p,v,w,I,S),V=Z(h,p,I,S,x,M),H=Z(h,p,x,M,R,O),Y=Z(h,p,R,O,v,w);function Z(he,ce,ye,be,_,ue){return(he-ye)*(ue-be)-(ce-be)*(_-ye)}return B>=0&&V>=0&&H>=0&&Y>=0||B<=0&&V<=0&&H<=0&&Y<=0}(e,n)}parseRequiredResources(e){return z(this,null,function*(){return this._checkIsDisposed(),yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success)return n(JSON.parse(h.resources));{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_parseRequiredResources",id:o,instanceID:this._instanceID,body:{templateName:e}})})})}dispose(){return z(this,null,function*(){this._checkIsDisposed(),this._promiseStartScan&&this.stopCapturing(),this._isa=null,this._resultReceiverSet.clear(),this._isaStateListenerSet.clear(),this._resultFilterSet.clear(),this.bDestroyed=!0;let e=Ge();Le[e]=n=>{if(!n.success){let i=new Error(n.message);throw i.stack=n.stack+`
`+i.stack,i}},Me.postMessage({type:"cvr_dispose",id:e,instanceID:this._instanceID})})}_enableResultCrossVerification(e){return z(this,null,function*(){return this._checkIsDisposed(),yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success)return n(h.result);{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_enableResultCrossVerification",id:o,instanceID:this._instanceID,body:{verificationEnabled:e}})})})}_enableResultDeduplication(e){return z(this,null,function*(){return this._checkIsDisposed(),yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success)return n(h.result);{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_enableResultDeduplication",id:o,instanceID:this._instanceID,body:{duplicateFilterEnabled:e}})})})}_setDuplicateForgetTime(e){return z(this,null,function*(){return this._checkIsDisposed(),yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success)return n(h.result);{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_setDuplicateForgetTime",id:o,instanceID:this._instanceID,body:{duplicateForgetTime:e}})})})}_getDuplicateForgetTime(e){return z(this,null,function*(){return this._checkIsDisposed(),yield new Promise((n,i)=>{let o=Ge();Le[o]=h=>z(this,null,function*(){if(h.success)return n(h.time);{let p=new Error(h.message);return p.stack=h.stack+`
`+p.stack,i(p)}}),Me.postMessage({type:"cvr_getDuplicateForgetTime",id:o,instanceID:this._instanceID,body:{type:e}})})})}_setThresholdValue(e,n,i){return z(this,null,function*(){return yield kt("ddn"),yield new Promise((o,h)=>{let p=Ge();Le[p]=v=>z(this,null,function*(){if(v.success)return o();{let w=new Error(v.message);return w.stack=v.stack+`
`+w.stack,h(w)}}),Me.postMessage({type:"ddn_setThresholdValue",id:p,instanceID:this._instanceID,body:{threshold:e,leftLimit:n,rightLimit:i}})})})}_checkIsDisposed(){if(this.disposed)throw new Error('"CaptureVisionRouter" instance has been disposed')}};var Z0=["resDiv"],Yg=(()=>{let e=class e{constructor(){this.bDestoried=!1,this.captureImage=i=>z(this,null,function*(){let o=[...i.target.files];i.target.value="",this.resDiv.nativeElement.innerText="";try{let h=yield this.pCvRouter=this.pCvRouter||rr.createInstance();if(this.bDestoried)return;for(let p of o){let v=yield h.capture(p,"ReadBarcodes_SpeedFirst");if(this.bDestoried)return;o.length>1&&(this.resDiv.nativeElement.innerText+=`
${p.name}:
`);for(let w of v.items){if(w.type!==De.CRIT_BARCODE)continue;let I=w;this.resDiv.nativeElement.innerText+=I.text+`
`,console.log(I.text)}v.items.length||(this.resDiv.nativeElement.innerText+=`No barcode found
`)}}catch(h){let p=h.message||h;console.error(p),alert(p)}})}ngOnDestroy(){return z(this,null,function*(){if(this.bDestoried=!0,this.pCvRouter)try{(yield this.pCvRouter).dispose()}catch{}})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=Qi({type:e,selectors:[["app-image-capture"]],viewQuery:function(o,h){if(o&1&&Zr(Z0,5),o&2){let p;Qr(p=Kr())&&(h.resDiv=p.first)}},standalone:!0,features:[nr],decls:5,vars:0,consts:[["resDiv",""],[1,"capture-img"],[1,"img-ipt"],["type","file",3,"change"],[1,"result-area"]],template:function(o,h){if(o&1){let p=jf();Wn(0,"div",1)(1,"div",2)(2,"input",3),er("change",function(w){return Ed(p),Cd(h.captureImage(w))}),hn()(),Dn(3,"div",4,0),hn()}},styles:[".capture-img[_ngcontent-%COMP%]{width:100%;height:100%;font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace}.capture-img[_ngcontent-%COMP%]   .img-ipt[_ngcontent-%COMP%]{width:80%;height:100%;display:flex;justify-content:center;border:1px solid black;margin:0 auto}.capture-img[_ngcontent-%COMP%]   .result-area[_ngcontent-%COMP%]{margin-top:20px}"]});let t=e;return t})();var lu=typeof self>"u",Q0=(()=>{if(!lu&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})();Se.dce==null&&(Se.dce=Q0),Tt.dce={wasm:!1,js:!1},tt.dce={};function b(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function Ce(t,e,n,i,o){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?o.call(t,n):o?o.value=n:e.set(t,n),n}var fs,kn,Go,pa,ft;typeof SuppressedError=="function"&&SuppressedError,typeof navigator<"u"&&(fs=navigator,kn=fs.userAgent,Go=fs.platform,pa=fs.mediaDevices),function(){if(!lu){let t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:fs.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Go,search:"Win"},Mac:{str:Go},Linux:{str:Go}},n="unknownBrowser",i=0,o="unknownOS";for(let h in t){let p=t[h]||{},v=p.str||kn,w=p.search||h,I=p.verStr||kn,S=p.verSearch||h;if(S instanceof Array||(S=[S]),v.indexOf(w)!=-1){n=h;for(let x of S){let M=I.indexOf(x);if(M!=-1){i=parseFloat(I.substring(M+x.length+1));break}}break}}for(let h in e){let p=e[h]||{},v=p.str||kn,w=p.search||h;if(v.indexOf(w)!=-1){o=h;break}}o=="Linux"&&kn.indexOf("Windows NT")!=-1&&(o="HarmonyOS"),ft={browser:n,version:i,OS:o}}lu&&(ft={browser:"ssr",version:0,OS:"ssr"})}();var K0=typeof WebAssembly<"u"&&kn&&!(/Safari/.test(kn)&&!/Chrome/.test(kn)&&/\(.+\s11_2_([2-6]).*\)/.test(kn)),J0=!(typeof Worker>"u"),lp=!(!pa||!pa.getUserMedia),ew=()=>z(void 0,null,function*(){let t=!1;if(lp)try{(yield pa.getUserMedia({video:!0})).getTracks().forEach(e=>{e.stop()}),t=!0}catch{}return t});ft.browser==="Chrome"&&ft.version>66||ft.browser==="Safari"&&ft.version>13||ft.browser==="OPR"&&ft.version>43||ft.browser==="Edge"&&ft.version;var tw={653:(t,e,n)=>{var i,o,h,p,v,w,I,S,x,M,R,O,B,V,H,Y,Z,he,ce,ye,be,_=_||{version:"5.2.1"};if(e.fabric=_,typeof document<"u"&&typeof window<"u")document instanceof(typeof HTMLDocument<"u"?HTMLDocument:Document)?_.document=document:_.document=document.implementation.createHTMLDocument(""),_.window=window;else{var ue=new(n(192)).JSDOM(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]},resources:"usable"}).window;_.document=ue.document,_.jsdomImplForWrapper=n(898).implForWrapper,_.nodeCanvas=n(245).Canvas,_.window=ue,DOMParser=_.window.DOMParser}function Ee(c,a){var l=c.canvas,d=a.targetCanvas,r=d.getContext("2d");r.translate(0,d.height),r.scale(1,-1);var s=l.height-d.height;r.drawImage(l,0,s,d.width,d.height,0,0,d.width,d.height)}function de(c,a){var l=a.targetCanvas.getContext("2d"),d=a.destinationWidth,r=a.destinationHeight,s=d*r*4,u=new Uint8Array(this.imageBuffer,0,s),m=new Uint8ClampedArray(this.imageBuffer,0,s);c.readPixels(0,0,d,r,c.RGBA,c.UNSIGNED_BYTE,u);var f=new ImageData(m,d,r);l.putImageData(f,0,0)}_.isTouchSupported="ontouchstart"in _.window||"ontouchstart"in _.document||_.window&&_.window.navigator&&_.window.navigator.maxTouchPoints>0,_.isLikelyNode=typeof Buffer<"u"&&typeof window>"u",_.SHARED_ATTRIBUTES=["display","transform","fill","fill-opacity","fill-rule","opacity","stroke","stroke-dasharray","stroke-linecap","stroke-dashoffset","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","id","paint-order","vector-effect","instantiated_by_use","clip-path"],_.DPI=96,_.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:[eE][-+]?\\d+)?)",_.commaWsp="(?:\\s+,?\\s*|,\\s*)",_.rePathCommand=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,_.reNonWord=/[ \n\.,;!\?\-]/,_.fontPaths={},_.iMatrix=[1,0,0,1,0,0],_.svgNS="http://www.w3.org/2000/svg",_.perfLimitSizeTotal=2097152,_.maxCacheSideLimit=4096,_.minCacheSideLimit=256,_.charWidthsCache={},_.textureSize=2048,_.disableStyleCopyPaste=!1,_.enableGLFiltering=!0,_.devicePixelRatio=_.window.devicePixelRatio||_.window.webkitDevicePixelRatio||_.window.mozDevicePixelRatio||1,_.browserShadowBlurConstant=1,_.arcToSegmentsCache={},_.boundsOfCurveCache={},_.cachesBoundsOfCurve=!0,_.forceGLPutImageData=!1,_.initFilterBackend=function(){return _.enableGLFiltering&&_.isWebglSupported&&_.isWebglSupported(_.textureSize)?(console.log("max texture size: "+_.maxTextureSize),new _.WebglFilterBackend({tileSize:_.textureSize})):_.Canvas2dFilterBackend?new _.Canvas2dFilterBackend:void 0},typeof document<"u"&&typeof window<"u"&&(window.fabric=_),function(){function c(l,d){if(this.__eventListeners[l]){var r=this.__eventListeners[l];d?r[r.indexOf(d)]=!1:_.util.array.fill(r,!1)}}function a(l,d){var r=(function(){d.apply(this,arguments),this.off(l,r)}).bind(this);this.on(l,r)}_.Observable={fire:function(l,d){if(!this.__eventListeners)return this;var r=this.__eventListeners[l];if(!r)return this;for(var s=0,u=r.length;s<u;s++)r[s]&&r[s].call(this,d||{});return this.__eventListeners[l]=r.filter(function(m){return m!==!1}),this},on:function(l,d){if(this.__eventListeners||(this.__eventListeners={}),arguments.length===1)for(var r in l)this.on(r,l[r]);else this.__eventListeners[l]||(this.__eventListeners[l]=[]),this.__eventListeners[l].push(d);return this},once:function(l,d){if(arguments.length===1)for(var r in l)a.call(this,r,l[r]);else a.call(this,l,d);return this},off:function(l,d){if(!this.__eventListeners)return this;if(arguments.length===0)for(l in this.__eventListeners)c.call(this,l);else if(arguments.length===1&&typeof arguments[0]=="object")for(var r in l)c.call(this,r,l[r]);else c.call(this,l,d);return this}}}(),_.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var c=0,a=arguments.length;c<a;c++)this._onObjectAdded(arguments[c]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(c,a,l){var d=this._objects;return l?d[a]=c:d.splice(a,0,c),this._onObjectAdded&&this._onObjectAdded(c),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var c,a=this._objects,l=!1,d=0,r=arguments.length;d<r;d++)(c=a.indexOf(arguments[d]))!==-1&&(l=!0,a.splice(c,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[d]));return this.renderOnAddRemove&&l&&this.requestRenderAll(),this},forEachObject:function(c,a){for(var l=this.getObjects(),d=0,r=l.length;d<r;d++)c.call(a,l[d],d,l);return this},getObjects:function(c){return c===void 0?this._objects.concat():this._objects.filter(function(a){return a.type===c})},item:function(c){return this._objects[c]},isEmpty:function(){return this._objects.length===0},size:function(){return this._objects.length},contains:function(c,a){return this._objects.indexOf(c)>-1||!!a&&this._objects.some(function(l){return typeof l.contains=="function"&&l.contains(c,!0)})},complexity:function(){return this._objects.reduce(function(c,a){return c+(a.complexity?a.complexity():0)},0)}},_.CommonMethods={_setOptions:function(c){for(var a in c)this.set(a,c[a])},_initGradient:function(c,a){!c||!c.colorStops||c instanceof _.Gradient||this.set(a,new _.Gradient(c))},_initPattern:function(c,a,l){!c||!c.source||c instanceof _.Pattern?l&&l():this.set(a,new _.Pattern(c,l))},_setObject:function(c){for(var a in c)this._set(a,c[a])},set:function(c,a){return typeof c=="object"?this._setObject(c):this._set(c,a),this},_set:function(c,a){this[c]=a},toggle:function(c){var a=this.get(c);return typeof a=="boolean"&&this.set(c,!a),this},get:function(c){return this[c]}},i=e,o=Math.sqrt,h=Math.atan2,p=Math.pow,v=Math.PI/180,w=Math.PI/2,_.util={cos:function(c){if(c===0)return 1;switch(c<0&&(c=-c),c/w){case 1:case 3:return 0;case 2:return-1}return Math.cos(c)},sin:function(c){if(c===0)return 0;var a=1;switch(c<0&&(a=-1),c/w){case 1:return a;case 2:return 0;case 3:return-a}return Math.sin(c)},removeFromArray:function(c,a){var l=c.indexOf(a);return l!==-1&&c.splice(l,1),c},getRandomInt:function(c,a){return Math.floor(Math.random()*(a-c+1))+c},degreesToRadians:function(c){return c*v},radiansToDegrees:function(c){return c/v},rotatePoint:function(c,a,l){var d=new _.Point(c.x-a.x,c.y-a.y),r=_.util.rotateVector(d,l);return new _.Point(r.x,r.y).addEquals(a)},rotateVector:function(c,a){var l=_.util.sin(a),d=_.util.cos(a);return{x:c.x*d-c.y*l,y:c.x*l+c.y*d}},createVector:function(c,a){return new _.Point(a.x-c.x,a.y-c.y)},calcAngleBetweenVectors:function(c,a){return Math.acos((c.x*a.x+c.y*a.y)/(Math.hypot(c.x,c.y)*Math.hypot(a.x,a.y)))},getHatVector:function(c){return new _.Point(c.x,c.y).multiply(1/Math.hypot(c.x,c.y))},getBisector:function(c,a,l){var d=_.util.createVector(c,a),r=_.util.createVector(c,l),s=_.util.calcAngleBetweenVectors(d,r),u=s*(_.util.calcAngleBetweenVectors(_.util.rotateVector(d,s),r)===0?1:-1)/2;return{vector:_.util.getHatVector(_.util.rotateVector(d,u)),angle:s}},projectStrokeOnPoints:function(c,a,l){var d=[],r=a.strokeWidth/2,s=a.strokeUniform?new _.Point(1/a.scaleX,1/a.scaleY):new _.Point(1,1),u=function(m){var f=r/Math.hypot(m.x,m.y);return new _.Point(m.x*f*s.x,m.y*f*s.y)};return c.length<=1||c.forEach(function(m,f){var g,y,E=new _.Point(m.x,m.y);f===0?(y=c[f+1],g=l?u(_.util.createVector(y,E)).addEquals(E):c[c.length-1]):f===c.length-1?(g=c[f-1],y=l?u(_.util.createVector(g,E)).addEquals(E):c[0]):(g=c[f-1],y=c[f+1]);var C,T,D=_.util.getBisector(E,g,y),A=D.vector,L=D.angle;if(a.strokeLineJoin==="miter"&&(C=-r/Math.sin(L/2),T=new _.Point(A.x*C*s.x,A.y*C*s.y),Math.hypot(T.x,T.y)/r<=a.strokeMiterLimit))return d.push(E.add(T)),void d.push(E.subtract(T));C=-r*Math.SQRT2,T=new _.Point(A.x*C*s.x,A.y*C*s.y),d.push(E.add(T)),d.push(E.subtract(T))}),d},transformPoint:function(c,a,l){return l?new _.Point(a[0]*c.x+a[2]*c.y,a[1]*c.x+a[3]*c.y):new _.Point(a[0]*c.x+a[2]*c.y+a[4],a[1]*c.x+a[3]*c.y+a[5])},makeBoundingBoxFromPoints:function(c,a){if(a)for(var l=0;l<c.length;l++)c[l]=_.util.transformPoint(c[l],a);var d=[c[0].x,c[1].x,c[2].x,c[3].x],r=_.util.array.min(d),s=_.util.array.max(d)-r,u=[c[0].y,c[1].y,c[2].y,c[3].y],m=_.util.array.min(u);return{left:r,top:m,width:s,height:_.util.array.max(u)-m}},invertTransform:function(c){var a=1/(c[0]*c[3]-c[1]*c[2]),l=[a*c[3],-a*c[1],-a*c[2],a*c[0]],d=_.util.transformPoint({x:c[4],y:c[5]},l,!0);return l[4]=-d.x,l[5]=-d.y,l},toFixed:function(c,a){return parseFloat(Number(c).toFixed(a))},parseUnit:function(c,a){var l=/\D{0,2}$/.exec(c),d=parseFloat(c);switch(a||(a=_.Text.DEFAULT_SVG_FONT_SIZE),l[0]){case"mm":return d*_.DPI/25.4;case"cm":return d*_.DPI/2.54;case"in":return d*_.DPI;case"pt":return d*_.DPI/72;case"pc":return d*_.DPI/72*12;case"em":return d*a;default:return d}},falseFunction:function(){return!1},getKlass:function(c,a){return c=_.util.string.camelize(c.charAt(0).toUpperCase()+c.slice(1)),_.util.resolveNamespace(a)[c]},getSvgAttributes:function(c){var a=["instantiated_by_use","style","id","class"];switch(c){case"linearGradient":a=a.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":a=a.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":a=a.concat(["offset","stop-color","stop-opacity"])}return a},resolveNamespace:function(c){if(!c)return _;var a,l=c.split("."),d=l.length,r=i||_.window;for(a=0;a<d;++a)r=r[l[a]];return r},loadImage:function(c,a,l,d){if(c){var r=_.util.createImage(),s=function(){a&&a.call(l,r,!1),r=r.onload=r.onerror=null};r.onload=s,r.onerror=function(){_.log("Error loading "+r.src),a&&a.call(l,null,!0),r=r.onload=r.onerror=null},c.indexOf("data")!==0&&d!=null&&(r.crossOrigin=d),c.substring(0,14)==="data:image/svg"&&(r.onload=null,_.util.loadImageInDom(r,s)),r.src=c}else a&&a.call(l,c)},loadImageInDom:function(c,a){var l=_.document.createElement("div");l.style.width=l.style.height="1px",l.style.left=l.style.top="-100%",l.style.position="absolute",l.appendChild(c),_.document.querySelector("body").appendChild(l),c.onload=function(){a(),l.parentNode.removeChild(l),l=null}},enlivenObjects:function(c,a,l,d){var r=[],s=0,u=(c=c||[]).length;function m(){++s===u&&a&&a(r.filter(function(f){return f}))}u?c.forEach(function(f,g){f&&f.type?_.util.getKlass(f.type,l).fromObject(f,function(y,E){E||(r[g]=y),d&&d(f,y,E),m()}):m()}):a&&a(r)},enlivenObjectEnlivables:function(c,a,l){var d=_.Object.ENLIVEN_PROPS.filter(function(r){return!!c[r]});_.util.enlivenObjects(d.map(function(r){return c[r]}),function(r){var s={};d.forEach(function(u,m){s[u]=r[m],a&&(a[u]=r[m])}),l&&l(s)})},enlivenPatterns:function(c,a){function l(){++r===s&&a&&a(d)}var d=[],r=0,s=(c=c||[]).length;s?c.forEach(function(u,m){u&&u.source?new _.Pattern(u,function(f){d[m]=f,l()}):(d[m]=u,l())}):a&&a(d)},groupSVGElements:function(c,a,l){var d;return c&&c.length===1?c[0]:(a&&(a.width&&a.height?a.centerPoint={x:a.width/2,y:a.height/2}:(delete a.width,delete a.height)),d=new _.Group(c,a),l!==void 0&&(d.sourcePath=l),d)},populateWithProperties:function(c,a,l){if(l&&Array.isArray(l))for(var d=0,r=l.length;d<r;d++)l[d]in c&&(a[l[d]]=c[l[d]])},createCanvasElement:function(){return _.document.createElement("canvas")},copyCanvasElement:function(c){var a=_.util.createCanvasElement();return a.width=c.width,a.height=c.height,a.getContext("2d").drawImage(c,0,0),a},toDataURL:function(c,a,l){return c.toDataURL("image/"+a,l)},createImage:function(){return _.document.createElement("img")},multiplyTransformMatrices:function(c,a,l){return[c[0]*a[0]+c[2]*a[1],c[1]*a[0]+c[3]*a[1],c[0]*a[2]+c[2]*a[3],c[1]*a[2]+c[3]*a[3],l?0:c[0]*a[4]+c[2]*a[5]+c[4],l?0:c[1]*a[4]+c[3]*a[5]+c[5]]},qrDecompose:function(c){var a=h(c[1],c[0]),l=p(c[0],2)+p(c[1],2),d=o(l),r=(c[0]*c[3]-c[2]*c[1])/d,s=h(c[0]*c[2]+c[1]*c[3],l);return{angle:a/v,scaleX:d,scaleY:r,skewX:s/v,skewY:0,translateX:c[4],translateY:c[5]}},calcRotateMatrix:function(c){if(!c.angle)return _.iMatrix.concat();var a=_.util.degreesToRadians(c.angle),l=_.util.cos(a),d=_.util.sin(a);return[l,d,-d,l,0,0]},calcDimensionsMatrix:function(c){var a=c.scaleX===void 0?1:c.scaleX,l=c.scaleY===void 0?1:c.scaleY,d=[c.flipX?-a:a,0,0,c.flipY?-l:l,0,0],r=_.util.multiplyTransformMatrices,s=_.util.degreesToRadians;return c.skewX&&(d=r(d,[1,0,Math.tan(s(c.skewX)),1],!0)),c.skewY&&(d=r(d,[1,Math.tan(s(c.skewY)),0,1],!0)),d},composeMatrix:function(c){var a=[1,0,0,1,c.translateX||0,c.translateY||0],l=_.util.multiplyTransformMatrices;return c.angle&&(a=l(a,_.util.calcRotateMatrix(c))),(c.scaleX!==1||c.scaleY!==1||c.skewX||c.skewY||c.flipX||c.flipY)&&(a=l(a,_.util.calcDimensionsMatrix(c))),a},resetObjectTransform:function(c){c.scaleX=1,c.scaleY=1,c.skewX=0,c.skewY=0,c.flipX=!1,c.flipY=!1,c.rotate(0)},saveObjectTransform:function(c){return{scaleX:c.scaleX,scaleY:c.scaleY,skewX:c.skewX,skewY:c.skewY,angle:c.angle,left:c.left,flipX:c.flipX,flipY:c.flipY,top:c.top}},isTransparent:function(c,a,l,d){d>0&&(a>d?a-=d:a=0,l>d?l-=d:l=0);var r,s=!0,u=c.getImageData(a,l,2*d||1,2*d||1),m=u.data.length;for(r=3;r<m&&(s=u.data[r]<=0)!=0;r+=4);return u=null,s},parsePreserveAspectRatioAttribute:function(c){var a,l="meet",d=c.split(" ");return d&&d.length&&((l=d.pop())!=="meet"&&l!=="slice"?(a=l,l="meet"):d.length&&(a=d.pop())),{meetOrSlice:l,alignX:a!=="none"?a.slice(1,4):"none",alignY:a!=="none"?a.slice(5,8):"none"}},clearFabricFontCache:function(c){(c=(c||"").toLowerCase())?_.charWidthsCache[c]&&delete _.charWidthsCache[c]:_.charWidthsCache={}},limitDimsByArea:function(c,a){var l=Math.sqrt(a*c),d=Math.floor(a/l);return{x:Math.floor(l),y:d}},capValue:function(c,a,l){return Math.max(c,Math.min(a,l))},findScaleToFit:function(c,a){return Math.min(a.width/c.width,a.height/c.height)},findScaleToCover:function(c,a){return Math.max(a.width/c.width,a.height/c.height)},matrixToSVG:function(c){return"matrix("+c.map(function(a){return _.util.toFixed(a,_.Object.NUM_FRACTION_DIGITS)}).join(" ")+")"},removeTransformFromObject:function(c,a){var l=_.util.invertTransform(a),d=_.util.multiplyTransformMatrices(l,c.calcOwnMatrix());_.util.applyTransformToObject(c,d)},addTransformToObject:function(c,a){_.util.applyTransformToObject(c,_.util.multiplyTransformMatrices(a,c.calcOwnMatrix()))},applyTransformToObject:function(c,a){var l=_.util.qrDecompose(a),d=new _.Point(l.translateX,l.translateY);c.flipX=!1,c.flipY=!1,c.set("scaleX",l.scaleX),c.set("scaleY",l.scaleY),c.skewX=l.skewX,c.skewY=l.skewY,c.angle=l.angle,c.setPositionByOrigin(d,"center","center")},sizeAfterTransform:function(c,a,l){var d=c/2,r=a/2,s=[{x:-d,y:-r},{x:d,y:-r},{x:-d,y:r},{x:d,y:r}],u=_.util.calcDimensionsMatrix(l),m=_.util.makeBoundingBoxFromPoints(s,u);return{x:m.width,y:m.height}},mergeClipPaths:function(c,a){var l=c,d=a;l.inverted&&!d.inverted&&(l=a,d=c),_.util.applyTransformToObject(d,_.util.multiplyTransformMatrices(_.util.invertTransform(l.calcTransformMatrix()),d.calcTransformMatrix()));var r=l.inverted&&d.inverted;return r&&(l.inverted=d.inverted=!1),new _.Group([l],{clipPath:d,inverted:r})}},function(){var c=Array.prototype.join,a={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},l={m:"l",M:"L"};function d(T,D,A,L,U,G,J,q,X,P,N){var W=_.util.cos(T),K=_.util.sin(T),ee=_.util.cos(D),j=_.util.sin(D),k=A*U*ee-L*G*j+J,$=L*U*ee+A*G*j+q;return["C",P+X*(-A*U*K-L*G*W),N+X*(-L*U*K+A*G*W),k+X*(A*U*j+L*G*ee),$+X*(L*U*j-A*G*ee),k,$]}function r(T,D,A,L){var U=Math.atan2(D,T),G=Math.atan2(L,A);return G>=U?G-U:2*Math.PI-(U-G)}function s(T,D,A){for(var L=A[1],U=A[2],G=A[3],J=A[4],q=A[5],X=function(W,K,ee,j,k,$,te){var Q=Math.PI,ne=te*Q/180,ae=_.util.sin(ne),re=_.util.cos(ne),ie=0,oe=0,se=-re*W*.5-ae*K*.5,fe=-re*K*.5+ae*W*.5,_e=(ee=Math.abs(ee))*ee,ge=(j=Math.abs(j))*j,Ae=fe*fe,We=se*se,Ft=_e*ge-_e*Ae-ge*We,mn=0;if(Ft<0){var Oi=Math.sqrt(1-Ft/(_e*ge));ee*=Oi,j*=Oi}else mn=(k===$?-1:1)*Math.sqrt(Ft/(_e*Ae+ge*We));var Qe=mn*ee*fe/j,Nt=-mn*j*se/ee,Tr=re*Qe-ae*Nt+.5*W,Li=ae*Qe+re*Nt+.5*K,ai=r(1,0,(se-Qe)/ee,(fe-Nt)/j),Fi=r((se-Qe)/ee,(fe-Nt)/j,(-se-Qe)/ee,(-fe-Nt)/j);$===0&&Fi>0?Fi-=2*Q:$===1&&Fi<0&&(Fi+=2*Q);for(var ju=Math.ceil(Math.abs(Fi/Q*2)),js=[],Sr=Fi/ju,Sp=8/3*Math.sin(Sr/4)*Math.sin(Sr/4)/Math.sin(Sr/2),ba=ai+Sr,xr=0;xr<ju;xr++)js[xr]=d(ai,ba,re,ae,ee,j,Tr,Li,Sp,ie,oe),ie=js[xr][5],oe=js[xr][6],ai=ba,ba+=Sr;return js}(A[6]-T,A[7]-D,L,U,J,q,G),P=0,N=X.length;P<N;P++)X[P][1]+=T,X[P][2]+=D,X[P][3]+=T,X[P][4]+=D,X[P][5]+=T,X[P][6]+=D;return X}function u(T,D,A,L){return Math.sqrt((A-T)*(A-T)+(L-D)*(L-D))}function m(T,D,A,L,U,G,J,q){return function(X){var P,N=(P=X)*P*P,W=function(j){return 3*j*j*(1-j)}(X),K=function(j){return 3*j*(1-j)*(1-j)}(X),ee=function(j){return(1-j)*(1-j)*(1-j)}(X);return{x:J*N+U*W+A*K+T*ee,y:q*N+G*W+L*K+D*ee}}}function f(T,D,A,L,U,G,J,q){return function(X){var P=1-X,N=3*P*P*(A-T)+6*P*X*(U-A)+3*X*X*(J-U),W=3*P*P*(L-D)+6*P*X*(G-L)+3*X*X*(q-G);return Math.atan2(W,N)}}function g(T,D,A,L,U,G){return function(J){var q,X=(q=J)*q,P=function(W){return 2*W*(1-W)}(J),N=function(W){return(1-W)*(1-W)}(J);return{x:U*X+A*P+T*N,y:G*X+L*P+D*N}}}function y(T,D,A,L,U,G){return function(J){var q=1-J,X=2*q*(A-T)+2*J*(U-A),P=2*q*(L-D)+2*J*(G-L);return Math.atan2(P,X)}}function E(T,D,A){var L,U,G={x:D,y:A},J=0;for(U=1;U<=100;U+=1)L=T(U/100),J+=u(G.x,G.y,L.x,L.y),G=L;return J}function C(T){for(var D,A,L,U,G=0,J=T.length,q=0,X=0,P=0,N=0,W=[],K=0;K<J;K++){switch(L={x:q,y:X,command:(D=T[K])[0]},D[0]){case"M":L.length=0,P=q=D[1],N=X=D[2];break;case"L":L.length=u(q,X,D[1],D[2]),q=D[1],X=D[2];break;case"C":A=m(q,X,D[1],D[2],D[3],D[4],D[5],D[6]),U=f(q,X,D[1],D[2],D[3],D[4],D[5],D[6]),L.iterator=A,L.angleFinder=U,L.length=E(A,q,X),q=D[5],X=D[6];break;case"Q":A=g(q,X,D[1],D[2],D[3],D[4]),U=y(q,X,D[1],D[2],D[3],D[4]),L.iterator=A,L.angleFinder=U,L.length=E(A,q,X),q=D[3],X=D[4];break;case"Z":case"z":L.destX=P,L.destY=N,L.length=u(q,X,P,N),q=P,X=N}G+=L.length,W.push(L)}return W.push({length:G,x:q,y:X}),W}_.util.joinPath=function(T){return T.map(function(D){return D.join(" ")}).join(" ")},_.util.parsePath=function(T){var D,A,L,U,G,J=[],q=[],X=_.rePathCommand,P="[-+]?(?:\\d*\\.\\d+|\\d+\\.?)(?:[eE][-+]?\\d+)?\\s*",N="("+P+")"+_.commaWsp,W="([01])"+_.commaWsp+"?",K=new RegExp(N+"?"+N+"?"+N+W+W+N+"?("+P+")","g");if(!T||!T.match)return J;for(var ee,j=0,k=(G=T.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi)).length;j<k;j++){U=(D=G[j]).slice(1).trim(),q.length=0;var $=D.charAt(0);if(ee=[$],$.toLowerCase()==="a")for(var te;te=K.exec(U);)for(var Q=1;Q<te.length;Q++)q.push(te[Q]);else for(;L=X.exec(U);)q.push(L[0]);Q=0;for(var ne=q.length;Q<ne;Q++)A=parseFloat(q[Q]),isNaN(A)||ee.push(A);var ae=a[$.toLowerCase()],re=l[$]||$;if(ee.length-1>ae)for(var ie=1,oe=ee.length;ie<oe;ie+=ae)J.push([$].concat(ee.slice(ie,ie+ae))),$=re;else J.push(ee)}return J},_.util.makePathSimpler=function(T){var D,A,L,U,G,J,q=0,X=0,P=T.length,N=0,W=0,K=[];for(A=0;A<P;++A){switch(L=!1,(D=T[A].slice(0))[0]){case"l":D[0]="L",D[1]+=q,D[2]+=X;case"L":q=D[1],X=D[2];break;case"h":D[1]+=q;case"H":D[0]="L",D[2]=X,q=D[1];break;case"v":D[1]+=X;case"V":D[0]="L",X=D[1],D[1]=q,D[2]=X;break;case"m":D[0]="M",D[1]+=q,D[2]+=X;case"M":q=D[1],X=D[2],N=D[1],W=D[2];break;case"c":D[0]="C",D[1]+=q,D[2]+=X,D[3]+=q,D[4]+=X,D[5]+=q,D[6]+=X;case"C":G=D[3],J=D[4],q=D[5],X=D[6];break;case"s":D[0]="S",D[1]+=q,D[2]+=X,D[3]+=q,D[4]+=X;case"S":U==="C"?(G=2*q-G,J=2*X-J):(G=q,J=X),q=D[3],X=D[4],D[0]="C",D[5]=D[3],D[6]=D[4],D[3]=D[1],D[4]=D[2],D[1]=G,D[2]=J,G=D[3],J=D[4];break;case"q":D[0]="Q",D[1]+=q,D[2]+=X,D[3]+=q,D[4]+=X;case"Q":G=D[1],J=D[2],q=D[3],X=D[4];break;case"t":D[0]="T",D[1]+=q,D[2]+=X;case"T":U==="Q"?(G=2*q-G,J=2*X-J):(G=q,J=X),D[0]="Q",q=D[1],X=D[2],D[1]=G,D[2]=J,D[3]=q,D[4]=X;break;case"a":D[0]="A",D[6]+=q,D[7]+=X;case"A":L=!0,K=K.concat(s(q,X,D)),q=D[6],X=D[7];break;case"z":case"Z":q=N,X=W}L||K.push(D),U=D[0]}return K},_.util.getSmoothPathFromPoints=function(T,D){var A,L=[],U=new _.Point(T[0].x,T[0].y),G=new _.Point(T[1].x,T[1].y),J=T.length,q=1,X=0,P=J>2;for(D=D||0,P&&(q=T[2].x<G.x?-1:T[2].x===G.x?0:1,X=T[2].y<G.y?-1:T[2].y===G.y?0:1),L.push(["M",U.x-q*D,U.y-X*D]),A=1;A<J;A++){if(!U.eq(G)){var N=U.midPointFrom(G);L.push(["Q",U.x,U.y,N.x,N.y])}U=T[A],A+1<T.length&&(G=T[A+1])}return P&&(q=U.x>T[A-2].x?1:U.x===T[A-2].x?0:-1,X=U.y>T[A-2].y?1:U.y===T[A-2].y?0:-1),L.push(["L",U.x+q*D,U.y+X*D]),L},_.util.getPathSegmentsInfo=C,_.util.getBoundsOfCurve=function(T,D,A,L,U,G,J,q){var X;if(_.cachesBoundsOfCurve&&(X=c.call(arguments),_.boundsOfCurveCache[X]))return _.boundsOfCurveCache[X];var P,N,W,K,ee,j,k,$,te=Math.sqrt,Q=Math.min,ne=Math.max,ae=Math.abs,re=[],ie=[[],[]];N=6*T-12*A+6*U,P=-3*T+9*A-9*U+3*J,W=3*A-3*T;for(var oe=0;oe<2;++oe)if(oe>0&&(N=6*D-12*L+6*G,P=-3*D+9*L-9*G+3*q,W=3*L-3*D),ae(P)<1e-12){if(ae(N)<1e-12)continue;0<(K=-W/N)&&K<1&&re.push(K)}else(k=N*N-4*W*P)<0||(0<(ee=(-N+($=te(k)))/(2*P))&&ee<1&&re.push(ee),0<(j=(-N-$)/(2*P))&&j<1&&re.push(j));for(var se,fe,_e,ge=re.length,Ae=ge;ge--;)se=(_e=1-(K=re[ge]))*_e*_e*T+3*_e*_e*K*A+3*_e*K*K*U+K*K*K*J,ie[0][ge]=se,fe=_e*_e*_e*D+3*_e*_e*K*L+3*_e*K*K*G+K*K*K*q,ie[1][ge]=fe;ie[0][Ae]=T,ie[1][Ae]=D,ie[0][Ae+1]=J,ie[1][Ae+1]=q;var We=[{x:Q.apply(null,ie[0]),y:Q.apply(null,ie[1])},{x:ne.apply(null,ie[0]),y:ne.apply(null,ie[1])}];return _.cachesBoundsOfCurve&&(_.boundsOfCurveCache[X]=We),We},_.util.getPointOnPath=function(T,D,A){A||(A=C(T));for(var L=0;D-A[L].length>0&&L<A.length-2;)D-=A[L].length,L++;var U,G=A[L],J=D/G.length,q=G.command,X=T[L];switch(q){case"M":return{x:G.x,y:G.y,angle:0};case"Z":case"z":return(U=new _.Point(G.x,G.y).lerp(new _.Point(G.destX,G.destY),J)).angle=Math.atan2(G.destY-G.y,G.destX-G.x),U;case"L":return(U=new _.Point(G.x,G.y).lerp(new _.Point(X[1],X[2]),J)).angle=Math.atan2(X[2]-G.y,X[1]-G.x),U;case"C":case"Q":return function(P,N){for(var W,K,ee,j=0,k=0,$=P.iterator,te={x:P.x,y:P.y},Q=.01,ne=P.angleFinder;k<N&&Q>1e-4;)W=$(j),ee=j,(K=u(te.x,te.y,W.x,W.y))+k>N?(j-=Q,Q/=2):(te=W,j+=Q,k+=K);return W.angle=ne(ee),W}(G,D)}},_.util.transformPath=function(T,D,A){return A&&(D=_.util.multiplyTransformMatrices(D,[1,0,0,1,-A.x,-A.y])),T.map(function(L){for(var U=L.slice(0),G={},J=1;J<L.length-1;J+=2)G.x=L[J],G.y=L[J+1],G=_.util.transformPoint(G,D),U[J]=G.x,U[J+1]=G.y;return U})}}(),function(){var c=Array.prototype.slice;function a(l,d,r){if(l&&l.length!==0){var s=l.length-1,u=d?l[s][d]:l[s];if(d)for(;s--;)r(l[s][d],u)&&(u=l[s][d]);else for(;s--;)r(l[s],u)&&(u=l[s]);return u}}_.util.array={fill:function(l,d){for(var r=l.length;r--;)l[r]=d;return l},invoke:function(l,d){for(var r=c.call(arguments,2),s=[],u=0,m=l.length;u<m;u++)s[u]=r.length?l[u][d].apply(l[u],r):l[u][d].call(l[u]);return s},min:function(l,d){return a(l,d,function(r,s){return r<s})},max:function(l,d){return a(l,d,function(r,s){return r>=s})}}}(),function(){function c(a,l,d){if(d)if(!_.isLikelyNode&&l instanceof Element)a=l;else if(l instanceof Array){a=[];for(var r=0,s=l.length;r<s;r++)a[r]=c({},l[r],d)}else if(l&&typeof l=="object")for(var u in l)u==="canvas"||u==="group"?a[u]=null:l.hasOwnProperty(u)&&(a[u]=c({},l[u],d));else a=l;else for(var u in l)a[u]=l[u];return a}_.util.object={extend:c,clone:function(a,l){return c({},a,l)}},_.util.object.extend(_.util,_.Observable)}(),function(){function c(a,l){var d=a.charCodeAt(l);if(isNaN(d))return"";if(d<55296||d>57343)return a.charAt(l);if(55296<=d&&d<=56319){if(a.length<=l+1)throw"High surrogate without following low surrogate";var r=a.charCodeAt(l+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return a.charAt(l)+a.charAt(l+1)}if(l===0)throw"Low surrogate without preceding high surrogate";var s=a.charCodeAt(l-1);if(55296>s||s>56319)throw"Low surrogate without preceding high surrogate";return!1}_.util.string={camelize:function(a){return a.replace(/-+(.)?/g,function(l,d){return d?d.toUpperCase():""})},capitalize:function(a,l){return a.charAt(0).toUpperCase()+(l?a.slice(1):a.slice(1).toLowerCase())},escapeXml:function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},graphemeSplit:function(a){var l,d=0,r=[];for(d=0;d<a.length;d++)(l=c(a,d))!==!1&&r.push(l);return r}}}(),function(){var c=Array.prototype.slice,a=function(){},l=function(){for(var u in{toString:1})if(u==="toString")return!1;return!0}(),d=function(u,m,f){for(var g in m)g in u.prototype&&typeof u.prototype[g]=="function"&&(m[g]+"").indexOf("callSuper")>-1?u.prototype[g]=function(y){return function(){var E=this.constructor.superclass;this.constructor.superclass=f;var C=m[y].apply(this,arguments);if(this.constructor.superclass=E,y!=="initialize")return C}}(g):u.prototype[g]=m[g],l&&(m.toString!==Object.prototype.toString&&(u.prototype.toString=m.toString),m.valueOf!==Object.prototype.valueOf&&(u.prototype.valueOf=m.valueOf))};function r(){}function s(u){for(var m=null,f=this;f.constructor.superclass;){var g=f.constructor.superclass.prototype[u];if(f[u]!==g){m=g;break}f=f.constructor.superclass.prototype}return m?arguments.length>1?m.apply(this,c.call(arguments,1)):m.call(this):console.log("tried to callSuper "+u+", method not found in prototype chain",this)}_.util.createClass=function(){var u=null,m=c.call(arguments,0);function f(){this.initialize.apply(this,arguments)}typeof m[0]=="function"&&(u=m.shift()),f.superclass=u,f.subclasses=[],u&&(r.prototype=u.prototype,f.prototype=new r,u.subclasses.push(f));for(var g=0,y=m.length;g<y;g++)d(f,m[g],u);return f.prototype.initialize||(f.prototype.initialize=a),f.prototype.constructor=f,f.prototype.callSuper=s,f}}(),I=!!_.document.createElement("div").attachEvent,S=["touchstart","touchmove","touchend"],_.util.addListener=function(c,a,l,d){c&&c.addEventListener(a,l,!I&&d)},_.util.removeListener=function(c,a,l,d){c&&c.removeEventListener(a,l,!I&&d)},_.util.getPointer=function(c){var a=c.target,l=_.util.getScrollLeftTop(a),d=function(r){var s=r.changedTouches;return s&&s[0]?s[0]:r}(c);return{x:d.clientX+l.left,y:d.clientY+l.top}},_.util.isTouchEvent=function(c){return S.indexOf(c.type)>-1||c.pointerType==="touch"},M=typeof(x=_.document.createElement("div")).style.opacity=="string",R=typeof x.style.filter=="string",O=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,B=function(c){return c},M?B=function(c,a){return c.style.opacity=a,c}:R&&(B=function(c,a){var l=c.style;return c.currentStyle&&!c.currentStyle.hasLayout&&(l.zoom=1),O.test(l.filter)?(a=a>=.9999?"":"alpha(opacity="+100*a+")",l.filter=l.filter.replace(O,a)):l.filter+=" alpha(opacity="+100*a+")",c}),_.util.setStyle=function(c,a){var l=c.style;if(!l)return c;if(typeof a=="string")return c.style.cssText+=";"+a,a.indexOf("opacity")>-1?B(c,a.match(/opacity:\s*(\d?\.?\d*)/)[1]):c;for(var d in a)d==="opacity"?B(c,a[d]):l[d==="float"||d==="cssFloat"?l.styleFloat===void 0?"cssFloat":"styleFloat":d]=a[d];return c},function(){var c,a,l,d,r=Array.prototype.slice,s=function(f){return r.call(f,0)};try{c=s(_.document.childNodes)instanceof Array}catch{}function u(f,g){var y=_.document.createElement(f);for(var E in g)E==="class"?y.className=g[E]:E==="for"?y.htmlFor=g[E]:y.setAttribute(E,g[E]);return y}function m(f){for(var g=0,y=0,E=_.document.documentElement,C=_.document.body||{scrollLeft:0,scrollTop:0};f&&(f.parentNode||f.host)&&((f=f.parentNode||f.host)===_.document?(g=C.scrollLeft||E.scrollLeft||0,y=C.scrollTop||E.scrollTop||0):(g+=f.scrollLeft||0,y+=f.scrollTop||0),f.nodeType!==1||f.style.position!=="fixed"););return{left:g,top:y}}c||(s=function(f){for(var g=new Array(f.length),y=f.length;y--;)g[y]=f[y];return g}),a=_.document.defaultView&&_.document.defaultView.getComputedStyle?function(f,g){var y=_.document.defaultView.getComputedStyle(f,null);return y?y[g]:void 0}:function(f,g){var y=f.style[g];return!y&&f.currentStyle&&(y=f.currentStyle[g]),y},l=_.document.documentElement.style,d="userSelect"in l?"userSelect":"MozUserSelect"in l?"MozUserSelect":"WebkitUserSelect"in l?"WebkitUserSelect":"KhtmlUserSelect"in l?"KhtmlUserSelect":"",_.util.makeElementUnselectable=function(f){return f.onselectstart!==void 0&&(f.onselectstart=_.util.falseFunction),d?f.style[d]="none":typeof f.unselectable=="string"&&(f.unselectable="on"),f},_.util.makeElementSelectable=function(f){return f.onselectstart!==void 0&&(f.onselectstart=null),d?f.style[d]="":typeof f.unselectable=="string"&&(f.unselectable=""),f},_.util.setImageSmoothing=function(f,g){f.imageSmoothingEnabled=f.imageSmoothingEnabled||f.webkitImageSmoothingEnabled||f.mozImageSmoothingEnabled||f.msImageSmoothingEnabled||f.oImageSmoothingEnabled,f.imageSmoothingEnabled=g},_.util.getById=function(f){return typeof f=="string"?_.document.getElementById(f):f},_.util.toArray=s,_.util.addClass=function(f,g){f&&(" "+f.className+" ").indexOf(" "+g+" ")===-1&&(f.className+=(f.className?" ":"")+g)},_.util.makeElement=u,_.util.wrapElement=function(f,g,y){return typeof g=="string"&&(g=u(g,y)),f.parentNode&&f.parentNode.replaceChild(g,f),g.appendChild(f),g},_.util.getScrollLeftTop=m,_.util.getElementOffset=function(f){var g,y,E=f&&f.ownerDocument,C={left:0,top:0},T={left:0,top:0},D={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!E)return T;for(var A in D)T[D[A]]+=parseInt(a(f,A),10)||0;return g=E.documentElement,f.getBoundingClientRect!==void 0&&(C=f.getBoundingClientRect()),y=m(f),{left:C.left+y.left-(g.clientLeft||0)+T.left,top:C.top+y.top-(g.clientTop||0)+T.top}},_.util.getNodeCanvas=function(f){var g=_.jsdomImplForWrapper(f);return g._canvas||g._image},_.util.cleanUpJsdomNode=function(f){if(_.isLikelyNode){var g=_.jsdomImplForWrapper(f);g&&(g._image=null,g._canvas=null,g._currentSrc=null,g._attributes=null,g._classList=null)}}}(),function(){function c(){}_.util.request=function(a,l){l||(l={});var d=l.method?l.method.toUpperCase():"GET",r=l.onComplete||function(){},s=new _.window.XMLHttpRequest,u=l.body||l.parameters;return s.onreadystatechange=function(){s.readyState===4&&(r(s),s.onreadystatechange=c)},d==="GET"&&(u=null,typeof l.parameters=="string"&&(a=function(m,f){return m+(/\?/.test(m)?"&":"?")+f}(a,l.parameters))),s.open(d,a,!0),d!=="POST"&&d!=="PUT"||s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(u),s}}(),_.log=console.log,_.warn=console.warn,function(){var c=_.util.object.extend,a=_.util.object.clone,l=[];function d(){return!1}function r(f,g,y,E){return-y*Math.cos(f/E*(Math.PI/2))+y+g}_.util.object.extend(l,{cancelAll:function(){var f=this.splice(0);return f.forEach(function(g){g.cancel()}),f},cancelByCanvas:function(f){if(!f)return[];var g=this.filter(function(y){return typeof y.target=="object"&&y.target.canvas===f});return g.forEach(function(y){y.cancel()}),g},cancelByTarget:function(f){var g=this.findAnimationsByTarget(f);return g.forEach(function(y){y.cancel()}),g},findAnimationIndex:function(f){return this.indexOf(this.findAnimation(f))},findAnimation:function(f){return this.find(function(g){return g.cancel===f})},findAnimationsByTarget:function(f){return f?this.filter(function(g){return g.target===f}):[]}});var s=_.window.requestAnimationFrame||_.window.webkitRequestAnimationFrame||_.window.mozRequestAnimationFrame||_.window.oRequestAnimationFrame||_.window.msRequestAnimationFrame||function(f){return _.window.setTimeout(f,1e3/60)},u=_.window.cancelAnimationFrame||_.window.clearTimeout;function m(){return s.apply(_.window,arguments)}_.util.animate=function(f){f||(f={});var g,y=!1,E=function(){var C=_.runningAnimations.indexOf(g);return C>-1&&_.runningAnimations.splice(C,1)[0]};return g=c(a(f),{cancel:function(){return y=!0,E()},currentValue:"startValue"in f?f.startValue:0,completionRate:0,durationRate:0}),_.runningAnimations.push(g),m(function(C){var T,D=C||+new Date,A=f.duration||500,L=D+A,U=f.onChange||d,G=f.abort||d,J=f.onComplete||d,q=f.easing||r,X="startValue"in f&&f.startValue.length>0,P="startValue"in f?f.startValue:0,N="endValue"in f?f.endValue:100,W=f.byValue||(X?P.map(function(K,ee){return N[ee]-P[ee]}):N-P);f.onStart&&f.onStart(),function K(ee){var j=(T=ee||+new Date)>L?A:T-D,k=j/A,$=X?P.map(function(Q,ne){return q(j,P[ne],W[ne],A)}):q(j,P,W,A),te=Math.abs(X?($[0]-P[0])/W[0]:($-P)/W);if(g.currentValue=X?$.slice():$,g.completionRate=te,g.durationRate=k,!y){if(!G($,te,k))return T>L?(g.currentValue=X?N.slice():N,g.completionRate=1,g.durationRate=1,U(X?N.slice():N,1,1),J(N,1,1),void E()):(U($,te,k),void m(K));E()}}(D)}),g.cancel},_.util.requestAnimFrame=m,_.util.cancelAnimFrame=function(){return u.apply(_.window,arguments)},_.runningAnimations=l}(),function(){function c(a,l,d){var r="rgba("+parseInt(a[0]+d*(l[0]-a[0]),10)+","+parseInt(a[1]+d*(l[1]-a[1]),10)+","+parseInt(a[2]+d*(l[2]-a[2]),10);return(r+=","+(a&&l?parseFloat(a[3]+d*(l[3]-a[3])):1))+")"}_.util.animateColor=function(a,l,d,r){var s=new _.Color(a).getSource(),u=new _.Color(l).getSource(),m=r.onComplete,f=r.onChange;return r=r||{},_.util.animate(_.util.object.extend(r,{duration:d||500,startValue:s,endValue:u,byValue:u,easing:function(g,y,E,C){return c(y,E,r.colorEasing?r.colorEasing(g,C):1-Math.cos(g/C*(Math.PI/2)))},onComplete:function(g,y,E){if(m)return m(c(u,u,0),y,E)},onChange:function(g,y,E){if(f){if(Array.isArray(g))return f(c(g,g,0),y,E);f(g,y,E)}}}))}}(),function(){function c(r,s,u,m){return r<Math.abs(s)?(r=s,m=u/4):m=s===0&&r===0?u/(2*Math.PI)*Math.asin(1):u/(2*Math.PI)*Math.asin(s/r),{a:r,c:s,p:u,s:m}}function a(r,s,u){return r.a*Math.pow(2,10*(s-=1))*Math.sin((s*u-r.s)*(2*Math.PI)/r.p)}function l(r,s,u,m){return u-d(m-r,0,u,m)+s}function d(r,s,u,m){return(r/=m)<1/2.75?u*(7.5625*r*r)+s:r<2/2.75?u*(7.5625*(r-=1.5/2.75)*r+.75)+s:r<2.5/2.75?u*(7.5625*(r-=2.25/2.75)*r+.9375)+s:u*(7.5625*(r-=2.625/2.75)*r+.984375)+s}_.util.ease={easeInQuad:function(r,s,u,m){return u*(r/=m)*r+s},easeOutQuad:function(r,s,u,m){return-u*(r/=m)*(r-2)+s},easeInOutQuad:function(r,s,u,m){return(r/=m/2)<1?u/2*r*r+s:-u/2*(--r*(r-2)-1)+s},easeInCubic:function(r,s,u,m){return u*(r/=m)*r*r+s},easeOutCubic:function(r,s,u,m){return u*((r=r/m-1)*r*r+1)+s},easeInOutCubic:function(r,s,u,m){return(r/=m/2)<1?u/2*r*r*r+s:u/2*((r-=2)*r*r+2)+s},easeInQuart:function(r,s,u,m){return u*(r/=m)*r*r*r+s},easeOutQuart:function(r,s,u,m){return-u*((r=r/m-1)*r*r*r-1)+s},easeInOutQuart:function(r,s,u,m){return(r/=m/2)<1?u/2*r*r*r*r+s:-u/2*((r-=2)*r*r*r-2)+s},easeInQuint:function(r,s,u,m){return u*(r/=m)*r*r*r*r+s},easeOutQuint:function(r,s,u,m){return u*((r=r/m-1)*r*r*r*r+1)+s},easeInOutQuint:function(r,s,u,m){return(r/=m/2)<1?u/2*r*r*r*r*r+s:u/2*((r-=2)*r*r*r*r+2)+s},easeInSine:function(r,s,u,m){return-u*Math.cos(r/m*(Math.PI/2))+u+s},easeOutSine:function(r,s,u,m){return u*Math.sin(r/m*(Math.PI/2))+s},easeInOutSine:function(r,s,u,m){return-u/2*(Math.cos(Math.PI*r/m)-1)+s},easeInExpo:function(r,s,u,m){return r===0?s:u*Math.pow(2,10*(r/m-1))+s},easeOutExpo:function(r,s,u,m){return r===m?s+u:u*(1-Math.pow(2,-10*r/m))+s},easeInOutExpo:function(r,s,u,m){return r===0?s:r===m?s+u:(r/=m/2)<1?u/2*Math.pow(2,10*(r-1))+s:u/2*(2-Math.pow(2,-10*--r))+s},easeInCirc:function(r,s,u,m){return-u*(Math.sqrt(1-(r/=m)*r)-1)+s},easeOutCirc:function(r,s,u,m){return u*Math.sqrt(1-(r=r/m-1)*r)+s},easeInOutCirc:function(r,s,u,m){return(r/=m/2)<1?-u/2*(Math.sqrt(1-r*r)-1)+s:u/2*(Math.sqrt(1-(r-=2)*r)+1)+s},easeInElastic:function(r,s,u,m){var f=0;return r===0?s:(r/=m)==1?s+u:(f||(f=.3*m),-a(c(u,u,f,1.70158),r,m)+s)},easeOutElastic:function(r,s,u,m){var f=0;if(r===0)return s;if((r/=m)==1)return s+u;f||(f=.3*m);var g=c(u,u,f,1.70158);return g.a*Math.pow(2,-10*r)*Math.sin((r*m-g.s)*(2*Math.PI)/g.p)+g.c+s},easeInOutElastic:function(r,s,u,m){var f=0;if(r===0)return s;if((r/=m/2)==2)return s+u;f||(f=m*(.3*1.5));var g=c(u,u,f,1.70158);return r<1?-.5*a(g,r,m)+s:g.a*Math.pow(2,-10*(r-=1))*Math.sin((r*m-g.s)*(2*Math.PI)/g.p)*.5+g.c+s},easeInBack:function(r,s,u,m,f){return f===void 0&&(f=1.70158),u*(r/=m)*r*((f+1)*r-f)+s},easeOutBack:function(r,s,u,m,f){return f===void 0&&(f=1.70158),u*((r=r/m-1)*r*((f+1)*r+f)+1)+s},easeInOutBack:function(r,s,u,m,f){return f===void 0&&(f=1.70158),(r/=m/2)<1?u/2*(r*r*((1+(f*=1.525))*r-f))+s:u/2*((r-=2)*r*((1+(f*=1.525))*r+f)+2)+s},easeInBounce:l,easeOutBounce:d,easeInOutBounce:function(r,s,u,m){return r<m/2?.5*l(2*r,0,u,m)+s:.5*d(2*r-m,0,u,m)+.5*u+s}}}(),function(c){var a=c.fabric||(c.fabric={}),l=a.util.object.extend,d=a.util.object.clone,r=a.util.toFixed,s=a.util.parseUnit,u=a.util.multiplyTransformMatrices,m={cx:"left",x:"left",r:"radius",cy:"top",y:"top",display:"visible",visibility:"visible",transform:"transformMatrix","fill-opacity":"fillOpacity","fill-rule":"fillRule","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","letter-spacing":"charSpacing","paint-order":"paintFirst","stroke-dasharray":"strokeDashArray","stroke-dashoffset":"strokeDashOffset","stroke-linecap":"strokeLineCap","stroke-linejoin":"strokeLineJoin","stroke-miterlimit":"strokeMiterLimit","stroke-opacity":"strokeOpacity","stroke-width":"strokeWidth","text-decoration":"textDecoration","text-anchor":"textAnchor",opacity:"opacity","clip-path":"clipPath","clip-rule":"clipRule","vector-effect":"strokeUniform","image-rendering":"imageSmoothing"},f={stroke:"strokeOpacity",fill:"fillOpacity"},g="font-size",y="clip-path";function E(P){return P in m?m[P]:P}function C(P,N,W,K){var ee,j=Array.isArray(N);if(P!=="fill"&&P!=="stroke"||N!=="none"){if(P==="strokeUniform")return N==="non-scaling-stroke";if(P==="strokeDashArray")N=N==="none"?null:N.replace(/,/g," ").split(/\s+/).map(parseFloat);else if(P==="transformMatrix")N=W&&W.transformMatrix?u(W.transformMatrix,a.parseTransformAttribute(N)):a.parseTransformAttribute(N);else if(P==="visible")N=N!=="none"&&N!=="hidden",W&&W.visible===!1&&(N=!1);else if(P==="opacity")N=parseFloat(N),W&&W.opacity!==void 0&&(N*=W.opacity);else if(P==="textAnchor")N=N==="start"?"left":N==="end"?"right":"center";else if(P==="charSpacing")ee=s(N,K)/K*1e3;else if(P==="paintFirst"){var k=N.indexOf("fill"),$=N.indexOf("stroke");N="fill",(k>-1&&$>-1&&$<k||k===-1&&$>-1)&&(N="stroke")}else{if(P==="href"||P==="xlink:href"||P==="font")return N;if(P==="imageSmoothing")return N==="optimizeQuality";ee=j?N.map(s):s(N,K)}}else N="";return!j&&isNaN(ee)?N:ee}function T(P){return new RegExp("^("+P.join("|")+")\\b","i")}function D(P,N){var W,K,ee,j,k=[];for(ee=0,j=N.length;ee<j;ee++)W=N[ee],K=P.getElementsByTagName(W),k=k.concat(Array.prototype.slice.call(K));return k}function A(P,N){var W,K=!0;return(W=L(P,N.pop()))&&N.length&&(K=function(ee,j){for(var k,$=!0;ee.parentNode&&ee.parentNode.nodeType===1&&j.length;)$&&(k=j.pop()),$=L(ee=ee.parentNode,k);return j.length===0}(P,N)),W&&K&&N.length===0}function L(P,N){var W,K,ee=P.nodeName,j=P.getAttribute("class"),k=P.getAttribute("id");if(W=new RegExp("^"+ee,"i"),N=N.replace(W,""),k&&N.length&&(W=new RegExp("#"+k+"(?![a-zA-Z\\-]+)","i"),N=N.replace(W,"")),j&&N.length)for(K=(j=j.split(" ")).length;K--;)W=new RegExp("\\."+j[K]+"(?![a-zA-Z\\-]+)","i"),N=N.replace(W,"");return N.length===0}function U(P,N){var W;if(P.getElementById&&(W=P.getElementById(N)),W)return W;var K,ee,j,k=P.getElementsByTagName("*");for(ee=0,j=k.length;ee<j;ee++)if(N===(K=k[ee]).getAttribute("id"))return K}a.svgValidTagNamesRegEx=T(["path","circle","polygon","polyline","ellipse","rect","line","image","text"]),a.svgViewBoxElementsRegEx=T(["symbol","image","marker","pattern","view","svg"]),a.svgInvalidAncestorsRegEx=T(["pattern","defs","symbol","metadata","clipPath","mask","desc"]),a.svgValidParentsRegEx=T(["symbol","g","a","svg","clipPath","defs"]),a.cssRules={},a.gradientDefs={},a.clipPaths={},a.parseTransformAttribute=function(){function P($,te,Q){$[Q]=Math.tan(a.util.degreesToRadians(te[0]))}var N=a.iMatrix,W=a.reNum,K=a.commaWsp,ee="(?:(?:(matrix)\\s*\\(\\s*("+W+")"+K+"("+W+")"+K+"("+W+")"+K+"("+W+")"+K+"("+W+")"+K+"("+W+")\\s*\\))|(?:(translate)\\s*\\(\\s*("+W+")(?:"+K+"("+W+"))?\\s*\\))|(?:(scale)\\s*\\(\\s*("+W+")(?:"+K+"("+W+"))?\\s*\\))|(?:(rotate)\\s*\\(\\s*("+W+")(?:"+K+"("+W+")"+K+"("+W+"))?\\s*\\))|(?:(skewX)\\s*\\(\\s*("+W+")\\s*\\))|(?:(skewY)\\s*\\(\\s*("+W+")\\s*\\)))",j=new RegExp("^\\s*(?:(?:"+ee+"(?:"+K+"*"+ee+")*)?)\\s*$"),k=new RegExp(ee,"g");return function($){var te=N.concat(),Q=[];if(!$||$&&!j.test($))return te;$.replace(k,function(ae){var re=new RegExp(ee).exec(ae).filter(function(se){return!!se}),ie=re[1],oe=re.slice(2).map(parseFloat);switch(ie){case"translate":(function(se,fe){se[4]=fe[0],fe.length===2&&(se[5]=fe[1])})(te,oe);break;case"rotate":oe[0]=a.util.degreesToRadians(oe[0]),function(se,fe){var _e=a.util.cos(fe[0]),ge=a.util.sin(fe[0]),Ae=0,We=0;fe.length===3&&(Ae=fe[1],We=fe[2]),se[0]=_e,se[1]=ge,se[2]=-ge,se[3]=_e,se[4]=Ae-(_e*Ae-ge*We),se[5]=We-(ge*Ae+_e*We)}(te,oe);break;case"scale":(function(se,fe){var _e=fe[0],ge=fe.length===2?fe[1]:fe[0];se[0]=_e,se[3]=ge})(te,oe);break;case"skewX":P(te,oe,2);break;case"skewY":P(te,oe,1);break;case"matrix":te=oe}Q.push(te.concat()),te=N.concat()});for(var ne=Q[0];Q.length>1;)Q.shift(),ne=a.util.multiplyTransformMatrices(ne,Q[0]);return ne}}();var G=new RegExp("^\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*,?\\s*("+a.reNum+"+)\\s*$");function J(P){if(!a.svgViewBoxElementsRegEx.test(P.nodeName))return{};var N,W,K,ee,j,k,$=P.getAttribute("viewBox"),te=1,Q=1,ne=P.getAttribute("width"),ae=P.getAttribute("height"),re=P.getAttribute("x")||0,ie=P.getAttribute("y")||0,oe=P.getAttribute("preserveAspectRatio")||"",se=!$||!($=$.match(G)),fe=!ne||!ae||ne==="100%"||ae==="100%",_e=se&&fe,ge={},Ae="",We=0,Ft=0;if(ge.width=0,ge.height=0,ge.toBeParsed=_e,se&&(re||ie)&&P.parentNode&&P.parentNode.nodeName!=="#document"&&(Ae=" translate("+s(re)+" "+s(ie)+") ",j=(P.getAttribute("transform")||"")+Ae,P.setAttribute("transform",j),P.removeAttribute("x"),P.removeAttribute("y")),_e)return ge;if(se)return ge.width=s(ne),ge.height=s(ae),ge;if(N=-parseFloat($[1]),W=-parseFloat($[2]),K=parseFloat($[3]),ee=parseFloat($[4]),ge.minX=N,ge.minY=W,ge.viewBoxWidth=K,ge.viewBoxHeight=ee,fe?(ge.width=K,ge.height=ee):(ge.width=s(ne),ge.height=s(ae),te=ge.width/K,Q=ge.height/ee),(oe=a.util.parsePreserveAspectRatioAttribute(oe)).alignX!=="none"&&(oe.meetOrSlice==="meet"&&(Q=te=te>Q?Q:te),oe.meetOrSlice==="slice"&&(Q=te=te>Q?te:Q),We=ge.width-K*te,Ft=ge.height-ee*te,oe.alignX==="Mid"&&(We/=2),oe.alignY==="Mid"&&(Ft/=2),oe.alignX==="Min"&&(We=0),oe.alignY==="Min"&&(Ft=0)),te===1&&Q===1&&N===0&&W===0&&re===0&&ie===0)return ge;if((re||ie)&&P.parentNode.nodeName!=="#document"&&(Ae=" translate("+s(re)+" "+s(ie)+") "),j=Ae+" matrix("+te+" 0 0 "+Q+" "+(N*te+We)+" "+(W*Q+Ft)+") ",P.nodeName==="svg"){for(k=P.ownerDocument.createElementNS(a.svgNS,"g");P.firstChild;)k.appendChild(P.firstChild);P.appendChild(k)}else(k=P).removeAttribute("x"),k.removeAttribute("y"),j=k.getAttribute("transform")+j;return k.setAttribute("transform",j),ge}function q(P,N){var W="xlink:href",K=U(P,N.getAttribute(W).slice(1));if(K&&K.getAttribute(W)&&q(P,K),["gradientTransform","x1","x2","y1","y2","gradientUnits","cx","cy","r","fx","fy"].forEach(function(j){K&&!N.hasAttribute(j)&&K.hasAttribute(j)&&N.setAttribute(j,K.getAttribute(j))}),!N.children.length)for(var ee=K.cloneNode(!0);ee.firstChild;)N.appendChild(ee.firstChild);N.removeAttribute(W)}a.parseSVGDocument=function(P,N,W,K){if(P){(function(re){for(var ie=D(re,["use","svg:use"]),oe=0;ie.length&&oe<ie.length;){var se=ie[oe],fe=se.getAttribute("xlink:href")||se.getAttribute("href");if(fe===null)return;var _e,ge,Ae,We,Ft=fe.slice(1),mn=se.getAttribute("x")||0,Oi=se.getAttribute("y")||0,Qe=U(re,Ft).cloneNode(!0),Nt=(Qe.getAttribute("transform")||"")+" translate("+mn+", "+Oi+")",Tr=ie.length,Li=a.svgNS;if(J(Qe),/^svg$/i.test(Qe.nodeName)){var ai=Qe.ownerDocument.createElementNS(Li,"g");for(ge=0,We=(Ae=Qe.attributes).length;ge<We;ge++)_e=Ae.item(ge),ai.setAttributeNS(Li,_e.nodeName,_e.nodeValue);for(;Qe.firstChild;)ai.appendChild(Qe.firstChild);Qe=ai}for(ge=0,We=(Ae=se.attributes).length;ge<We;ge++)(_e=Ae.item(ge)).nodeName!=="x"&&_e.nodeName!=="y"&&_e.nodeName!=="xlink:href"&&_e.nodeName!=="href"&&(_e.nodeName==="transform"?Nt=_e.nodeValue+" "+Nt:Qe.setAttribute(_e.nodeName,_e.nodeValue));Qe.setAttribute("transform",Nt),Qe.setAttribute("instantiated_by_use","1"),Qe.removeAttribute("id"),se.parentNode.replaceChild(Qe,se),ie.length===Tr&&oe++}})(P);var ee,j,k=a.Object.__uid++,$=J(P),te=a.util.toArray(P.getElementsByTagName("*"));if($.crossOrigin=K&&K.crossOrigin,$.svgUid=k,te.length===0&&a.isLikelyNode){var Q=[];for(ee=0,j=(te=P.selectNodes('//*[name(.)!="svg"]')).length;ee<j;ee++)Q[ee]=te[ee];te=Q}var ne=te.filter(function(re){return J(re),a.svgValidTagNamesRegEx.test(re.nodeName.replace("svg:",""))&&!function(ie,oe){for(;ie&&(ie=ie.parentNode);)if(ie.nodeName&&oe.test(ie.nodeName.replace("svg:",""))&&!ie.getAttribute("instantiated_by_use"))return!0;return!1}(re,a.svgInvalidAncestorsRegEx)});if(!ne||ne&&!ne.length)N&&N([],{});else{var ae={};te.filter(function(re){return re.nodeName.replace("svg:","")==="clipPath"}).forEach(function(re){var ie=re.getAttribute("id");ae[ie]=a.util.toArray(re.getElementsByTagName("*")).filter(function(oe){return a.svgValidTagNamesRegEx.test(oe.nodeName.replace("svg:",""))})}),a.gradientDefs[k]=a.getGradientDefs(P),a.cssRules[k]=a.getCSSRules(P),a.clipPaths[k]=ae,a.parseElements(ne,function(re,ie){N&&(N(re,$,ie,te),delete a.gradientDefs[k],delete a.cssRules[k],delete a.clipPaths[k])},d($),W,K)}}};var X=new RegExp("(normal|italic)?\\s*(normal|small-caps)?\\s*(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\s*("+a.reNum+"(?:px|cm|mm|em|pt|pc|in)*)(?:\\/(normal|"+a.reNum+"))?\\s+(.*)");l(a,{parseFontDeclaration:function(P,N){var W=P.match(X);if(W){var K=W[1],ee=W[3],j=W[4],k=W[5],$=W[6];K&&(N.fontStyle=K),ee&&(N.fontWeight=isNaN(parseFloat(ee))?ee:parseFloat(ee)),j&&(N.fontSize=s(j)),$&&(N.fontFamily=$),k&&(N.lineHeight=k==="normal"?1:k)}},getGradientDefs:function(P){var N,W=D(P,["linearGradient","radialGradient","svg:linearGradient","svg:radialGradient"]),K=0,ee={};for(K=W.length;K--;)(N=W[K]).getAttribute("xlink:href")&&q(P,N),ee[N.getAttribute("id")]=N;return ee},parseAttributes:function(P,N,W){if(P){var K,ee,j,k={};W===void 0&&(W=P.getAttribute("svgUid")),P.parentNode&&a.svgValidParentsRegEx.test(P.parentNode.nodeName)&&(k=a.parseAttributes(P.parentNode,N,W));var $=N.reduce(function(oe,se){return(K=P.getAttribute(se))&&(oe[se]=K),oe},{}),te=l(function(oe,se){var fe={};for(var _e in a.cssRules[se])if(A(oe,_e.split(" ")))for(var ge in a.cssRules[se][_e])fe[ge]=a.cssRules[se][_e][ge];return fe}(P,W),a.parseStyleAttribute(P));$=l($,te),te[y]&&P.setAttribute(y,te[y]),ee=j=k.fontSize||a.Text.DEFAULT_SVG_FONT_SIZE,$[g]&&($[g]=ee=s($[g],j));var Q,ne,ae={};for(var re in $)ne=C(Q=E(re),$[re],k,ee),ae[Q]=ne;ae&&ae.font&&a.parseFontDeclaration(ae.font,ae);var ie=l(k,ae);return a.svgValidParentsRegEx.test(P.nodeName)?ie:function(oe){for(var se in f)if(oe[f[se]]!==void 0&&oe[se]!==""){if(oe[se]===void 0){if(!a.Object.prototype[se])continue;oe[se]=a.Object.prototype[se]}if(oe[se].indexOf("url(")!==0){var fe=new a.Color(oe[se]);oe[se]=fe.setAlpha(r(fe.getAlpha()*oe[f[se]],2)).toRgba()}}return oe}(ie)}},parseElements:function(P,N,W,K,ee){new a.ElementsParser(P,N,W,K,ee).parse()},parseStyleAttribute:function(P){var N={},W=P.getAttribute("style");return W&&(typeof W=="string"?function(K,ee){var j,k;K.replace(/;\s*$/,"").split(";").forEach(function($){var te=$.split(":");j=te[0].trim().toLowerCase(),k=te[1].trim(),ee[j]=k})}(W,N):function(K,ee){var j,k;for(var $ in K)K[$]!==void 0&&(j=$.toLowerCase(),k=K[$],ee[j]=k)}(W,N)),N},parsePointsAttribute:function(P){if(!P)return null;var N,W,K=[];for(N=0,W=(P=(P=P.replace(/,/g," ").trim()).split(/\s+/)).length;N<W;N+=2)K.push({x:parseFloat(P[N]),y:parseFloat(P[N+1])});return K},getCSSRules:function(P){var N,W,K=P.getElementsByTagName("style"),ee={};for(N=0,W=K.length;N<W;N++){var j=K[N].textContent;(j=j.replace(/\/\*[\s\S]*?\*\//g,"")).trim()!==""&&j.split("}").filter(function(k){return k.trim()}).forEach(function(k){var $=k.split("{"),te={},Q=$[1].trim().split(";").filter(function(ie){return ie.trim()});for(N=0,W=Q.length;N<W;N++){var ne=Q[N].split(":"),ae=ne[0].trim(),re=ne[1].trim();te[ae]=re}(k=$[0].trim()).split(",").forEach(function(ie){(ie=ie.replace(/^svg/i,"").trim())!==""&&(ee[ie]?a.util.object.extend(ee[ie],te):ee[ie]=a.util.object.clone(te))})})}return ee},loadSVGFromURL:function(P,N,W,K){P=P.replace(/^\n\s*/,"").trim(),new a.util.request(P,{method:"get",onComplete:function(ee){var j=ee.responseXML;if(!j||!j.documentElement)return N&&N(null),!1;a.parseSVGDocument(j.documentElement,function(k,$,te,Q){N&&N(k,$,te,Q)},W,K)}})},loadSVGFromString:function(P,N,W,K){var ee=new a.window.DOMParser().parseFromString(P.trim(),"text/xml");a.parseSVGDocument(ee.documentElement,function(j,k,$,te){N(j,k,$,te)},W,K)}})}(e),_.ElementsParser=function(c,a,l,d,r,s){this.elements=c,this.callback=a,this.options=l,this.reviver=d,this.svgUid=l&&l.svgUid||0,this.parsingOptions=r,this.regexUrl=/^url\(['"]?#([^'"]+)['"]?\)/g,this.doc=s},(V=_.ElementsParser.prototype).parse=function(){this.instances=new Array(this.elements.length),this.numElements=this.elements.length,this.createObjects()},V.createObjects=function(){var c=this;this.elements.forEach(function(a,l){a.setAttribute("svgUid",c.svgUid),c.createObject(a,l)})},V.findTag=function(c){return _[_.util.string.capitalize(c.tagName.replace("svg:",""))]},V.createObject=function(c,a){var l=this.findTag(c);if(l&&l.fromElement)try{l.fromElement(c,this.createCallback(a,c),this.options)}catch(d){_.log(d)}else this.checkIfDone()},V.createCallback=function(c,a){var l=this;return function(d){var r;l.resolveGradient(d,a,"fill"),l.resolveGradient(d,a,"stroke"),d instanceof _.Image&&d._originalElement&&(r=d.parsePreserveAspectRatioAttribute(a)),d._removeTransformMatrix(r),l.resolveClipPath(d,a),l.reviver&&l.reviver(a,d),l.instances[c]=d,l.checkIfDone()}},V.extractPropertyDefinition=function(c,a,l){var d=c[a],r=this.regexUrl;if(r.test(d)){r.lastIndex=0;var s=r.exec(d)[1];return r.lastIndex=0,_[l][this.svgUid][s]}},V.resolveGradient=function(c,a,l){var d=this.extractPropertyDefinition(c,l,"gradientDefs");if(d){var r=a.getAttribute(l+"-opacity"),s=_.Gradient.fromElement(d,c,r,this.options);c.set(l,s)}},V.createClipPathCallback=function(c,a){return function(l){l._removeTransformMatrix(),l.fillRule=l.clipRule,a.push(l)}},V.resolveClipPath=function(c,a){var l,d,r,s,u=this.extractPropertyDefinition(c,"clipPath","clipPaths");if(u){r=[],d=_.util.invertTransform(c.calcTransformMatrix());for(var m=u[0].parentNode,f=a;f.parentNode&&f.getAttribute("clip-path")!==c.clipPath;)f=f.parentNode;f.parentNode.appendChild(m);for(var g=0;g<u.length;g++)l=u[g],this.findTag(l).fromElement(l,this.createClipPathCallback(c,r),this.options);u=r.length===1?r[0]:new _.Group(r),s=_.util.multiplyTransformMatrices(d,u.calcTransformMatrix()),u.clipPath&&this.resolveClipPath(u,f);var y=_.util.qrDecompose(s);u.flipX=!1,u.flipY=!1,u.set("scaleX",y.scaleX),u.set("scaleY",y.scaleY),u.angle=y.angle,u.skewX=y.skewX,u.skewY=0,u.setPositionByOrigin({x:y.translateX,y:y.translateY},"center","center"),c.clipPath=u}else delete c.clipPath},V.checkIfDone=function(){--this.numElements==0&&(this.instances=this.instances.filter(function(c){return c!=null}),this.callback(this.instances,this.elements))},function(c){var a=c.fabric||(c.fabric={});function l(d,r){this.x=d,this.y=r}a.Point?a.warn("fabric.Point is already defined"):(a.Point=l,l.prototype={type:"point",constructor:l,add:function(d){return new l(this.x+d.x,this.y+d.y)},addEquals:function(d){return this.x+=d.x,this.y+=d.y,this},scalarAdd:function(d){return new l(this.x+d,this.y+d)},scalarAddEquals:function(d){return this.x+=d,this.y+=d,this},subtract:function(d){return new l(this.x-d.x,this.y-d.y)},subtractEquals:function(d){return this.x-=d.x,this.y-=d.y,this},scalarSubtract:function(d){return new l(this.x-d,this.y-d)},scalarSubtractEquals:function(d){return this.x-=d,this.y-=d,this},multiply:function(d){return new l(this.x*d,this.y*d)},multiplyEquals:function(d){return this.x*=d,this.y*=d,this},divide:function(d){return new l(this.x/d,this.y/d)},divideEquals:function(d){return this.x/=d,this.y/=d,this},eq:function(d){return this.x===d.x&&this.y===d.y},lt:function(d){return this.x<d.x&&this.y<d.y},lte:function(d){return this.x<=d.x&&this.y<=d.y},gt:function(d){return this.x>d.x&&this.y>d.y},gte:function(d){return this.x>=d.x&&this.y>=d.y},lerp:function(d,r){return r===void 0&&(r=.5),r=Math.max(Math.min(1,r),0),new l(this.x+(d.x-this.x)*r,this.y+(d.y-this.y)*r)},distanceFrom:function(d){var r=this.x-d.x,s=this.y-d.y;return Math.sqrt(r*r+s*s)},midPointFrom:function(d){return this.lerp(d)},min:function(d){return new l(Math.min(this.x,d.x),Math.min(this.y,d.y))},max:function(d){return new l(Math.max(this.x,d.x),Math.max(this.y,d.y))},toString:function(){return this.x+","+this.y},setXY:function(d,r){return this.x=d,this.y=r,this},setX:function(d){return this.x=d,this},setY:function(d){return this.y=d,this},setFromPoint:function(d){return this.x=d.x,this.y=d.y,this},swap:function(d){var r=this.x,s=this.y;this.x=d.x,this.y=d.y,d.x=r,d.y=s},clone:function(){return new l(this.x,this.y)}})}(e),function(c){var a=c.fabric||(c.fabric={});function l(d){this.status=d,this.points=[]}a.Intersection?a.warn("fabric.Intersection is already defined"):(a.Intersection=l,a.Intersection.prototype={constructor:l,appendPoint:function(d){return this.points.push(d),this},appendPoints:function(d){return this.points=this.points.concat(d),this}},a.Intersection.intersectLineLine=function(d,r,s,u){var m,f=(u.x-s.x)*(d.y-s.y)-(u.y-s.y)*(d.x-s.x),g=(r.x-d.x)*(d.y-s.y)-(r.y-d.y)*(d.x-s.x),y=(u.y-s.y)*(r.x-d.x)-(u.x-s.x)*(r.y-d.y);if(y!==0){var E=f/y,C=g/y;0<=E&&E<=1&&0<=C&&C<=1?(m=new l("Intersection")).appendPoint(new a.Point(d.x+E*(r.x-d.x),d.y+E*(r.y-d.y))):m=new l}else m=new l(f===0||g===0?"Coincident":"Parallel");return m},a.Intersection.intersectLinePolygon=function(d,r,s){var u,m,f,g,y=new l,E=s.length;for(g=0;g<E;g++)u=s[g],m=s[(g+1)%E],f=l.intersectLineLine(d,r,u,m),y.appendPoints(f.points);return y.points.length>0&&(y.status="Intersection"),y},a.Intersection.intersectPolygonPolygon=function(d,r){var s,u=new l,m=d.length;for(s=0;s<m;s++){var f=d[s],g=d[(s+1)%m],y=l.intersectLinePolygon(f,g,r);u.appendPoints(y.points)}return u.points.length>0&&(u.status="Intersection"),u},a.Intersection.intersectPolygonRectangle=function(d,r,s){var u=r.min(s),m=r.max(s),f=new a.Point(m.x,u.y),g=new a.Point(u.x,m.y),y=l.intersectLinePolygon(u,f,d),E=l.intersectLinePolygon(f,m,d),C=l.intersectLinePolygon(m,g,d),T=l.intersectLinePolygon(g,u,d),D=new l;return D.appendPoints(y.points),D.appendPoints(E.points),D.appendPoints(C.points),D.appendPoints(T.points),D.points.length>0&&(D.status="Intersection"),D})}(e),function(c){var a=c.fabric||(c.fabric={});function l(r){r?this._tryParsingColor(r):this.setSource([0,0,0,1])}function d(r,s,u){return u<0&&(u+=1),u>1&&(u-=1),u<1/6?r+6*(s-r)*u:u<.5?s:u<2/3?r+(s-r)*(2/3-u)*6:r}a.Color?a.warn("fabric.Color is already defined."):(a.Color=l,a.Color.prototype={_tryParsingColor:function(r){var s;r in l.colorNameMap&&(r=l.colorNameMap[r]),r==="transparent"&&(s=[255,255,255,0]),s||(s=l.sourceFromHex(r)),s||(s=l.sourceFromRgb(r)),s||(s=l.sourceFromHsl(r)),s||(s=[0,0,0,1]),s&&this.setSource(s)},_rgbToHsl:function(r,s,u){r/=255,s/=255,u/=255;var m,f,g,y=a.util.array.max([r,s,u]),E=a.util.array.min([r,s,u]);if(g=(y+E)/2,y===E)m=f=0;else{var C=y-E;switch(f=g>.5?C/(2-y-E):C/(y+E),y){case r:m=(s-u)/C+(s<u?6:0);break;case s:m=(u-r)/C+2;break;case u:m=(r-s)/C+4}m/=6}return[Math.round(360*m),Math.round(100*f),Math.round(100*g)]},getSource:function(){return this._source},setSource:function(r){this._source=r},toRgb:function(){var r=this.getSource();return"rgb("+r[0]+","+r[1]+","+r[2]+")"},toRgba:function(){var r=this.getSource();return"rgba("+r[0]+","+r[1]+","+r[2]+","+r[3]+")"},toHsl:function(){var r=this.getSource(),s=this._rgbToHsl(r[0],r[1],r[2]);return"hsl("+s[0]+","+s[1]+"%,"+s[2]+"%)"},toHsla:function(){var r=this.getSource(),s=this._rgbToHsl(r[0],r[1],r[2]);return"hsla("+s[0]+","+s[1]+"%,"+s[2]+"%,"+r[3]+")"},toHex:function(){var r,s,u,m=this.getSource();return r=(r=m[0].toString(16)).length===1?"0"+r:r,s=(s=m[1].toString(16)).length===1?"0"+s:s,u=(u=m[2].toString(16)).length===1?"0"+u:u,r.toUpperCase()+s.toUpperCase()+u.toUpperCase()},toHexa:function(){var r,s=this.getSource();return r=(r=(r=Math.round(255*s[3])).toString(16)).length===1?"0"+r:r,this.toHex()+r.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(r){var s=this.getSource();return s[3]=r,this.setSource(s),this},toGrayscale:function(){var r=this.getSource(),s=parseInt((.3*r[0]+.59*r[1]+.11*r[2]).toFixed(0),10),u=r[3];return this.setSource([s,s,s,u]),this},toBlackWhite:function(r){var s=this.getSource(),u=(.3*s[0]+.59*s[1]+.11*s[2]).toFixed(0),m=s[3];return r=r||127,u=Number(u)<Number(r)?0:255,this.setSource([u,u,u,m]),this},overlayWith:function(r){r instanceof l||(r=new l(r));var s,u=[],m=this.getAlpha(),f=this.getSource(),g=r.getSource();for(s=0;s<3;s++)u.push(Math.round(.5*f[s]+.5*g[s]));return u[3]=m,this.setSource(u),this}},a.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,a.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,a.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,a.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},a.Color.fromRgb=function(r){return l.fromSource(l.sourceFromRgb(r))},a.Color.sourceFromRgb=function(r){var s=r.match(l.reRGBa);if(s){var u=parseInt(s[1],10)/(/%$/.test(s[1])?100:1)*(/%$/.test(s[1])?255:1),m=parseInt(s[2],10)/(/%$/.test(s[2])?100:1)*(/%$/.test(s[2])?255:1),f=parseInt(s[3],10)/(/%$/.test(s[3])?100:1)*(/%$/.test(s[3])?255:1);return[parseInt(u,10),parseInt(m,10),parseInt(f,10),s[4]?parseFloat(s[4]):1]}},a.Color.fromRgba=l.fromRgb,a.Color.fromHsl=function(r){return l.fromSource(l.sourceFromHsl(r))},a.Color.sourceFromHsl=function(r){var s=r.match(l.reHSLa);if(s){var u,m,f,g=(parseFloat(s[1])%360+360)%360/360,y=parseFloat(s[2])/(/%$/.test(s[2])?100:1),E=parseFloat(s[3])/(/%$/.test(s[3])?100:1);if(y===0)u=m=f=E;else{var C=E<=.5?E*(y+1):E+y-E*y,T=2*E-C;u=d(T,C,g+1/3),m=d(T,C,g),f=d(T,C,g-1/3)}return[Math.round(255*u),Math.round(255*m),Math.round(255*f),s[4]?parseFloat(s[4]):1]}},a.Color.fromHsla=l.fromHsl,a.Color.fromHex=function(r){return l.fromSource(l.sourceFromHex(r))},a.Color.sourceFromHex=function(r){if(r.match(l.reHex)){var s=r.slice(r.indexOf("#")+1),u=s.length===3||s.length===4,m=s.length===8||s.length===4,f=u?s.charAt(0)+s.charAt(0):s.substring(0,2),g=u?s.charAt(1)+s.charAt(1):s.substring(2,4),y=u?s.charAt(2)+s.charAt(2):s.substring(4,6),E=m?u?s.charAt(3)+s.charAt(3):s.substring(6,8):"FF";return[parseInt(f,16),parseInt(g,16),parseInt(y,16),parseFloat((parseInt(E,16)/255).toFixed(2))]}},a.Color.fromSource=function(r){var s=new l;return s.setSource(r),s})}(e),function(c){var a=c.fabric||(c.fabric={}),l=["e","se","s","sw","w","nw","n","ne","e"],d=["ns","nesw","ew","nwse"],r={},s="left",u="top",m="right",f="bottom",g="center",y={top:f,bottom:u,left:m,right:s,center:g},E=a.util.radiansToDegrees,C=Math.sign||function(j){return(j>0)-(j<0)||+j};function T(j,k){var $=j.angle+E(Math.atan2(k.y,k.x))+360;return Math.round($%360/45)}function D(j,k){var $=k.transform.target,te=$.canvas,Q=a.util.object.clone(k);Q.target=$,te&&te.fire("object:"+j,Q),$.fire(j,k)}function A(j,k){var $=k.canvas,te=j[$.uniScaleKey];return $.uniformScaling&&!te||!$.uniformScaling&&te}function L(j){return j.originX===g&&j.originY===g}function U(j,k,$){var te=j.lockScalingX,Q=j.lockScalingY;return!((!te||!Q)&&(k||!te&&!Q||!$)&&(!te||k!=="x")&&(!Q||k!=="y"))}function G(j,k,$,te){return{e:j,transform:k,pointer:{x:$,y:te}}}function J(j){return function(k,$,te,Q){var ne=$.target,ae=ne.getCenterPoint(),re=ne.translateToOriginPoint(ae,$.originX,$.originY),ie=j(k,$,te,Q);return ne.setPositionByOrigin(re,$.originX,$.originY),ie}}function q(j,k){return function($,te,Q,ne){var ae=k($,te,Q,ne);return ae&&D(j,G($,te,Q,ne)),ae}}function X(j,k,$,te,Q){var ne=j.target,ae=ne.controls[j.corner],re=ne.canvas.getZoom(),ie=ne.padding/re,oe=ne.toLocalPoint(new a.Point(te,Q),k,$);return oe.x>=ie&&(oe.x-=ie),oe.x<=-ie&&(oe.x+=ie),oe.y>=ie&&(oe.y-=ie),oe.y<=ie&&(oe.y+=ie),oe.x-=ae.offsetX,oe.y-=ae.offsetY,oe}function P(j){return j.flipX!==j.flipY}function N(j,k,$,te,Q){if(j[k]!==0){var ne=Q/j._getTransformedDimensions()[te]*j[$];j.set($,ne)}}function W(j,k,$,te){var Q,ne=k.target,ae=ne._getTransformedDimensions(0,ne.skewY),re=X(k,k.originX,k.originY,$,te),ie=Math.abs(2*re.x)-ae.x,oe=ne.skewX;ie<2?Q=0:(Q=E(Math.atan2(ie/ne.scaleX,ae.y/ne.scaleY)),k.originX===s&&k.originY===f&&(Q=-Q),k.originX===m&&k.originY===u&&(Q=-Q),P(ne)&&(Q=-Q));var se=oe!==Q;if(se){var fe=ne._getTransformedDimensions().y;ne.set("skewX",Q),N(ne,"skewY","scaleY","y",fe)}return se}function K(j,k,$,te){var Q,ne=k.target,ae=ne._getTransformedDimensions(ne.skewX,0),re=X(k,k.originX,k.originY,$,te),ie=Math.abs(2*re.y)-ae.y,oe=ne.skewY;ie<2?Q=0:(Q=E(Math.atan2(ie/ne.scaleY,ae.x/ne.scaleX)),k.originX===s&&k.originY===f&&(Q=-Q),k.originX===m&&k.originY===u&&(Q=-Q),P(ne)&&(Q=-Q));var se=oe!==Q;if(se){var fe=ne._getTransformedDimensions().x;ne.set("skewY",Q),N(ne,"skewX","scaleX","x",fe)}return se}function ee(j,k,$,te,Q){Q=Q||{};var ne,ae,re,ie,oe,se,fe=k.target,_e=fe.lockScalingX,ge=fe.lockScalingY,Ae=Q.by,We=A(j,fe),Ft=U(fe,Ae,We),mn=k.gestureScale;if(Ft)return!1;if(mn)ae=k.scaleX*mn,re=k.scaleY*mn;else{if(ne=X(k,k.originX,k.originY,$,te),oe=Ae!=="y"?C(ne.x):1,se=Ae!=="x"?C(ne.y):1,k.signX||(k.signX=oe),k.signY||(k.signY=se),fe.lockScalingFlip&&(k.signX!==oe||k.signY!==se))return!1;if(ie=fe._getTransformedDimensions(),We&&!Ae){var Oi=Math.abs(ne.x)+Math.abs(ne.y),Qe=k.original,Nt=Oi/(Math.abs(ie.x*Qe.scaleX/fe.scaleX)+Math.abs(ie.y*Qe.scaleY/fe.scaleY));ae=Qe.scaleX*Nt,re=Qe.scaleY*Nt}else ae=Math.abs(ne.x*fe.scaleX/ie.x),re=Math.abs(ne.y*fe.scaleY/ie.y);L(k)&&(ae*=2,re*=2),k.signX!==oe&&Ae!=="y"&&(k.originX=y[k.originX],ae*=-1,k.signX=oe),k.signY!==se&&Ae!=="x"&&(k.originY=y[k.originY],re*=-1,k.signY=se)}var Tr=fe.scaleX,Li=fe.scaleY;return Ae?(Ae==="x"&&fe.set("scaleX",ae),Ae==="y"&&fe.set("scaleY",re)):(!_e&&fe.set("scaleX",ae),!ge&&fe.set("scaleY",re)),Tr!==fe.scaleX||Li!==fe.scaleY}r.scaleCursorStyleHandler=function(j,k,$){var te=A(j,$),Q="";if(k.x!==0&&k.y===0?Q="x":k.x===0&&k.y!==0&&(Q="y"),U($,Q,te))return"not-allowed";var ne=T($,k);return l[ne]+"-resize"},r.skewCursorStyleHandler=function(j,k,$){var te="not-allowed";if(k.x!==0&&$.lockSkewingY||k.y!==0&&$.lockSkewingX)return te;var Q=T($,k)%4;return d[Q]+"-resize"},r.scaleSkewCursorStyleHandler=function(j,k,$){return j[$.canvas.altActionKey]?r.skewCursorStyleHandler(j,k,$):r.scaleCursorStyleHandler(j,k,$)},r.rotationWithSnapping=q("rotating",J(function(j,k,$,te){var Q=k,ne=Q.target,ae=ne.translateToOriginPoint(ne.getCenterPoint(),Q.originX,Q.originY);if(ne.lockRotation)return!1;var re,ie=Math.atan2(Q.ey-ae.y,Q.ex-ae.x),oe=Math.atan2(te-ae.y,$-ae.x),se=E(oe-ie+Q.theta);if(ne.snapAngle>0){var fe=ne.snapAngle,_e=ne.snapThreshold||fe,ge=Math.ceil(se/fe)*fe,Ae=Math.floor(se/fe)*fe;Math.abs(se-Ae)<_e?se=Ae:Math.abs(se-ge)<_e&&(se=ge)}return se<0&&(se=360+se),se%=360,re=ne.angle!==se,ne.angle=se,re})),r.scalingEqually=q("scaling",J(function(j,k,$,te){return ee(j,k,$,te)})),r.scalingX=q("scaling",J(function(j,k,$,te){return ee(j,k,$,te,{by:"x"})})),r.scalingY=q("scaling",J(function(j,k,$,te){return ee(j,k,$,te,{by:"y"})})),r.scalingYOrSkewingX=function(j,k,$,te){return j[k.target.canvas.altActionKey]?r.skewHandlerX(j,k,$,te):r.scalingY(j,k,$,te)},r.scalingXOrSkewingY=function(j,k,$,te){return j[k.target.canvas.altActionKey]?r.skewHandlerY(j,k,$,te):r.scalingX(j,k,$,te)},r.changeWidth=q("resizing",J(function(j,k,$,te){var Q=k.target,ne=X(k,k.originX,k.originY,$,te),ae=Q.strokeWidth/(Q.strokeUniform?Q.scaleX:1),re=L(k)?2:1,ie=Q.width,oe=Math.abs(ne.x*re/Q.scaleX)-ae;return Q.set("width",Math.max(oe,0)),ie!==oe})),r.skewHandlerX=function(j,k,$,te){var Q,ne=k.target,ae=ne.skewX,re=k.originY;return!ne.lockSkewingX&&(ae===0?Q=X(k,g,g,$,te).x>0?s:m:(ae>0&&(Q=re===u?s:m),ae<0&&(Q=re===u?m:s),P(ne)&&(Q=Q===s?m:s)),k.originX=Q,q("skewing",J(W))(j,k,$,te))},r.skewHandlerY=function(j,k,$,te){var Q,ne=k.target,ae=ne.skewY,re=k.originX;return!ne.lockSkewingY&&(ae===0?Q=X(k,g,g,$,te).y>0?u:f:(ae>0&&(Q=re===s?u:f),ae<0&&(Q=re===s?f:u),P(ne)&&(Q=Q===u?f:u)),k.originY=Q,q("skewing",J(K))(j,k,$,te))},r.dragHandler=function(j,k,$,te){var Q=k.target,ne=$-k.offsetX,ae=te-k.offsetY,re=!Q.get("lockMovementX")&&Q.left!==ne,ie=!Q.get("lockMovementY")&&Q.top!==ae;return re&&Q.set("left",ne),ie&&Q.set("top",ae),(re||ie)&&D("moving",G(j,k,$,te)),re||ie},r.scaleOrSkewActionName=function(j,k,$){var te=j[$.canvas.altActionKey];return k.x===0?te?"skewX":"scaleY":k.y===0?te?"skewY":"scaleX":void 0},r.rotationStyleHandler=function(j,k,$){return $.lockRotation?"not-allowed":k.cursorStyle},r.fireEvent=D,r.wrapWithFixedAnchor=J,r.wrapWithFireEvent=q,r.getLocalPoint=X,a.controlsUtils=r}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.degreesToRadians,d=a.controlsUtils;d.renderCircleControl=function(r,s,u,m,f){m=m||{};var g,y=this.sizeX||m.cornerSize||f.cornerSize,E=this.sizeY||m.cornerSize||f.cornerSize,C=m.transparentCorners!==void 0?m.transparentCorners:f.transparentCorners,T=C?"stroke":"fill",D=!C&&(m.cornerStrokeColor||f.cornerStrokeColor),A=s,L=u;r.save(),r.fillStyle=m.cornerColor||f.cornerColor,r.strokeStyle=m.cornerStrokeColor||f.cornerStrokeColor,y>E?(g=y,r.scale(1,E/y),L=u*y/E):E>y?(g=E,r.scale(y/E,1),A=s*E/y):g=y,r.lineWidth=1,r.beginPath(),r.arc(A,L,g/2,0,2*Math.PI,!1),r[T](),D&&r.stroke(),r.restore()},d.renderSquareControl=function(r,s,u,m,f){m=m||{};var g=this.sizeX||m.cornerSize||f.cornerSize,y=this.sizeY||m.cornerSize||f.cornerSize,E=m.transparentCorners!==void 0?m.transparentCorners:f.transparentCorners,C=E?"stroke":"fill",T=!E&&(m.cornerStrokeColor||f.cornerStrokeColor),D=g/2,A=y/2;r.save(),r.fillStyle=m.cornerColor||f.cornerColor,r.strokeStyle=m.cornerStrokeColor||f.cornerStrokeColor,r.lineWidth=1,r.translate(s,u),r.rotate(l(f.angle)),r[C+"Rect"](-D,-A,g,y),T&&r.strokeRect(-D,-A,g,y),r.restore()}}(e),function(c){var a=c.fabric||(c.fabric={});a.Control=function(l){for(var d in l)this[d]=l[d]},a.Control.prototype={visible:!0,actionName:"scale",angle:0,x:0,y:0,offsetX:0,offsetY:0,sizeX:null,sizeY:null,touchSizeX:null,touchSizeY:null,cursorStyle:"crosshair",withConnection:!1,actionHandler:function(){},mouseDownHandler:function(){},mouseUpHandler:function(){},getActionHandler:function(){return this.actionHandler},getMouseDownHandler:function(){return this.mouseDownHandler},getMouseUpHandler:function(){return this.mouseUpHandler},cursorStyleHandler:function(l,d){return d.cursorStyle},getActionName:function(l,d){return d.actionName},getVisibility:function(l,d){var r=l._controlsVisibility;return r&&r[d]!==void 0?r[d]:this.visible},setVisibility:function(l){this.visible=l},positionHandler:function(l,d){return a.util.transformPoint({x:this.x*l.x+this.offsetX,y:this.y*l.y+this.offsetY},d)},calcCornerCoords:function(l,d,r,s,u){var m,f,g,y,E=u?this.touchSizeX:this.sizeX,C=u?this.touchSizeY:this.sizeY;if(E&&C&&E!==C){var T=Math.atan2(C,E),D=Math.sqrt(E*E+C*C)/2,A=T-a.util.degreesToRadians(l),L=Math.PI/2-T-a.util.degreesToRadians(l);m=D*a.util.cos(A),f=D*a.util.sin(A),g=D*a.util.cos(L),y=D*a.util.sin(L)}else D=.7071067812*(E&&C?E:d),A=a.util.degreesToRadians(45-l),m=g=D*a.util.cos(A),f=y=D*a.util.sin(A);return{tl:{x:r-y,y:s-g},tr:{x:r+m,y:s-f},bl:{x:r-m,y:s+f},br:{x:r+y,y:s+g}}},render:function(l,d,r,s,u){((s=s||{}).cornerStyle||u.cornerStyle)==="circle"?a.controlsUtils.renderCircleControl.call(this,l,d,r,s,u):a.controlsUtils.renderSquareControl.call(this,l,d,r,s,u)}}}(e),function(){function c(l,d){var r,s,u,m,f=l.getAttribute("style"),g=l.getAttribute("offset")||0;if(g=(g=parseFloat(g)/(/%$/.test(g)?100:1))<0?0:g>1?1:g,f){var y=f.split(/\s*;\s*/);for(y[y.length-1]===""&&y.pop(),m=y.length;m--;){var E=y[m].split(/\s*:\s*/),C=E[0].trim(),T=E[1].trim();C==="stop-color"?r=T:C==="stop-opacity"&&(u=T)}}return r||(r=l.getAttribute("stop-color")||"rgb(0,0,0)"),u||(u=l.getAttribute("stop-opacity")),s=(r=new _.Color(r)).getAlpha(),u=isNaN(parseFloat(u))?1:parseFloat(u),u*=s*d,{offset:g,color:r.toRgb(),opacity:u}}var a=_.util.object.clone;_.Gradient=_.util.createClass({offsetX:0,offsetY:0,gradientTransform:null,gradientUnits:"pixels",type:"linear",initialize:function(l){l||(l={}),l.coords||(l.coords={});var d,r=this;Object.keys(l).forEach(function(s){r[s]=l[s]}),this.id?this.id+="_"+_.Object.__uid++:this.id=_.Object.__uid++,d={x1:l.coords.x1||0,y1:l.coords.y1||0,x2:l.coords.x2||0,y2:l.coords.y2||0},this.type==="radial"&&(d.r1=l.coords.r1||0,d.r2=l.coords.r2||0),this.coords=d,this.colorStops=l.colorStops.slice()},addColorStop:function(l){for(var d in l){var r=new _.Color(l[d]);this.colorStops.push({offset:parseFloat(d),color:r.toRgb(),opacity:r.getAlpha()})}return this},toObject:function(l){var d={type:this.type,coords:this.coords,colorStops:this.colorStops,offsetX:this.offsetX,offsetY:this.offsetY,gradientUnits:this.gradientUnits,gradientTransform:this.gradientTransform?this.gradientTransform.concat():this.gradientTransform};return _.util.populateWithProperties(this,d,l),d},toSVG:function(l,d){var r,s,u,m,f=a(this.coords,!0),g=(d=d||{},a(this.colorStops,!0)),y=f.r1>f.r2,E=this.gradientTransform?this.gradientTransform.concat():_.iMatrix.concat(),C=-this.offsetX,T=-this.offsetY,D=!!d.additionalTransform,A=this.gradientUnits==="pixels"?"userSpaceOnUse":"objectBoundingBox";if(g.sort(function(J,q){return J.offset-q.offset}),A==="objectBoundingBox"?(C/=l.width,T/=l.height):(C+=l.width/2,T+=l.height/2),l.type==="path"&&this.gradientUnits!=="percentage"&&(C-=l.pathOffset.x,T-=l.pathOffset.y),E[4]-=C,E[5]-=T,m='id="SVGID_'+this.id+'" gradientUnits="'+A+'"',m+=' gradientTransform="'+(D?d.additionalTransform+" ":"")+_.util.matrixToSVG(E)+'" ',this.type==="linear"?u=["<linearGradient ",m,' x1="',f.x1,'" y1="',f.y1,'" x2="',f.x2,'" y2="',f.y2,`">
`]:this.type==="radial"&&(u=["<radialGradient ",m,' cx="',y?f.x1:f.x2,'" cy="',y?f.y1:f.y2,'" r="',y?f.r1:f.r2,'" fx="',y?f.x2:f.x1,'" fy="',y?f.y2:f.y1,`">
`]),this.type==="radial"){if(y)for((g=g.concat()).reverse(),r=0,s=g.length;r<s;r++)g[r].offset=1-g[r].offset;var L=Math.min(f.r1,f.r2);if(L>0){var U=L/Math.max(f.r1,f.r2);for(r=0,s=g.length;r<s;r++)g[r].offset+=U*(1-g[r].offset)}}for(r=0,s=g.length;r<s;r++){var G=g[r];u.push("<stop ",'offset="',100*G.offset+"%",'" style="stop-color:',G.color,G.opacity!==void 0?";stop-opacity: "+G.opacity:";",`"/>
`)}return u.push(this.type==="linear"?`</linearGradient>
`:`</radialGradient>
`),u.join("")},toLive:function(l){var d,r,s,u=_.util.object.clone(this.coords);if(this.type){for(this.type==="linear"?d=l.createLinearGradient(u.x1,u.y1,u.x2,u.y2):this.type==="radial"&&(d=l.createRadialGradient(u.x1,u.y1,u.r1,u.x2,u.y2,u.r2)),r=0,s=this.colorStops.length;r<s;r++){var m=this.colorStops[r].color,f=this.colorStops[r].opacity,g=this.colorStops[r].offset;f!==void 0&&(m=new _.Color(m).setAlpha(f).toRgba()),d.addColorStop(g,m)}return d}}}),_.util.object.extend(_.Gradient,{fromElement:function(l,d,r,s){var u=parseFloat(r)/(/%$/.test(r)?100:1);u=u<0?0:u>1?1:u,isNaN(u)&&(u=1);var m,f,g,y,E=l.getElementsByTagName("stop"),C=l.getAttribute("gradientUnits")==="userSpaceOnUse"?"pixels":"percentage",T=l.getAttribute("gradientTransform")||"",D=[],A=0,L=0;for(l.nodeName==="linearGradient"||l.nodeName==="LINEARGRADIENT"?(m="linear",f=function(U){return{x1:U.getAttribute("x1")||0,y1:U.getAttribute("y1")||0,x2:U.getAttribute("x2")||"100%",y2:U.getAttribute("y2")||0}}(l)):(m="radial",f=function(U){return{x1:U.getAttribute("fx")||U.getAttribute("cx")||"50%",y1:U.getAttribute("fy")||U.getAttribute("cy")||"50%",r1:0,x2:U.getAttribute("cx")||"50%",y2:U.getAttribute("cy")||"50%",r2:U.getAttribute("r")||"50%"}}(l)),g=E.length;g--;)D.push(c(E[g],u));return y=_.parseTransformAttribute(T),function(U,G,J,q){var X,P;Object.keys(G).forEach(function(N){(X=G[N])==="Infinity"?P=1:X==="-Infinity"?P=0:(P=parseFloat(G[N],10),typeof X=="string"&&/^(\d+\.\d+)%|(\d+)%$/.test(X)&&(P*=.01,q==="pixels"&&(N!=="x1"&&N!=="x2"&&N!=="r2"||(P*=J.viewBoxWidth||J.width),N!=="y1"&&N!=="y2"||(P*=J.viewBoxHeight||J.height)))),G[N]=P})}(0,f,s,C),C==="pixels"&&(A=-d.left,L=-d.top),new _.Gradient({id:l.getAttribute("id"),type:m,coords:f,colorStops:D,gradientUnits:C,gradientTransform:y,offsetX:A,offsetY:L})}})}(),H=_.util.toFixed,_.Pattern=_.util.createClass({repeat:"repeat",offsetX:0,offsetY:0,crossOrigin:"",patternTransform:null,initialize:function(c,a){if(c||(c={}),this.id=_.Object.__uid++,this.setOptions(c),!c.source||c.source&&typeof c.source!="string")a&&a(this);else{var l=this;this.source=_.util.createImage(),_.util.loadImage(c.source,function(d,r){l.source=d,a&&a(l,r)},null,this.crossOrigin)}},toObject:function(c){var a,l,d=_.Object.NUM_FRACTION_DIGITS;return typeof this.source.src=="string"?a=this.source.src:typeof this.source=="object"&&this.source.toDataURL&&(a=this.source.toDataURL()),l={type:"pattern",source:a,repeat:this.repeat,crossOrigin:this.crossOrigin,offsetX:H(this.offsetX,d),offsetY:H(this.offsetY,d),patternTransform:this.patternTransform?this.patternTransform.concat():null},_.util.populateWithProperties(this,l,c),l},toSVG:function(c){var a=typeof this.source=="function"?this.source():this.source,l=a.width/c.width,d=a.height/c.height,r=this.offsetX/c.width,s=this.offsetY/c.height,u="";return this.repeat!=="repeat-x"&&this.repeat!=="no-repeat"||(d=1,s&&(d+=Math.abs(s))),this.repeat!=="repeat-y"&&this.repeat!=="no-repeat"||(l=1,r&&(l+=Math.abs(r))),a.src?u=a.src:a.toDataURL&&(u=a.toDataURL()),'<pattern id="SVGID_'+this.id+'" x="'+r+'" y="'+s+'" width="'+l+'" height="'+d+`">
<image x="0" y="0" width="`+a.width+'" height="'+a.height+'" xlink:href="'+u+`"></image>
</pattern>
`},setOptions:function(c){for(var a in c)this[a]=c[a]},toLive:function(c){var a=this.source;return!a||a.src!==void 0&&(!a.complete||a.naturalWidth===0||a.naturalHeight===0)?"":c.createPattern(a,this.repeat)}}),function(c){var a=c.fabric||(c.fabric={}),l=a.util.toFixed;a.Shadow?a.warn("fabric.Shadow is already defined."):(a.Shadow=a.util.createClass({color:"rgb(0,0,0)",blur:0,offsetX:0,offsetY:0,affectStroke:!1,includeDefaultValues:!0,nonScaling:!1,initialize:function(d){for(var r in typeof d=="string"&&(d=this._parseShadow(d)),d)this[r]=d[r];this.id=a.Object.__uid++},_parseShadow:function(d){var r=d.trim(),s=a.Shadow.reOffsetsAndBlur.exec(r)||[];return{color:(r.replace(a.Shadow.reOffsetsAndBlur,"")||"rgb(0,0,0)").trim(),offsetX:parseFloat(s[1],10)||0,offsetY:parseFloat(s[2],10)||0,blur:parseFloat(s[3],10)||0}},toString:function(){return[this.offsetX,this.offsetY,this.blur,this.color].join("px ")},toSVG:function(d){var r=40,s=40,u=a.Object.NUM_FRACTION_DIGITS,m=a.util.rotateVector({x:this.offsetX,y:this.offsetY},a.util.degreesToRadians(-d.angle)),f=new a.Color(this.color);return d.width&&d.height&&(r=100*l((Math.abs(m.x)+this.blur)/d.width,u)+20,s=100*l((Math.abs(m.y)+this.blur)/d.height,u)+20),d.flipX&&(m.x*=-1),d.flipY&&(m.y*=-1),'<filter id="SVGID_'+this.id+'" y="-'+s+'%" height="'+(100+2*s)+'%" x="-'+r+'%" width="'+(100+2*r)+`%" >
	<feGaussianBlur in="SourceAlpha" stdDeviation="`+l(this.blur?this.blur/2:0,u)+`"></feGaussianBlur>
	<feOffset dx="`+l(m.x,u)+'" dy="'+l(m.y,u)+`" result="oBlur" ></feOffset>
	<feFlood flood-color="`+f.toRgb()+'" flood-opacity="'+f.getAlpha()+`"/>
	<feComposite in2="oBlur" operator="in" />
	<feMerge>
		<feMergeNode></feMergeNode>
		<feMergeNode in="SourceGraphic"></feMergeNode>
	</feMerge>
</filter>
`},toObject:function(){if(this.includeDefaultValues)return{color:this.color,blur:this.blur,offsetX:this.offsetX,offsetY:this.offsetY,affectStroke:this.affectStroke,nonScaling:this.nonScaling};var d={},r=a.Shadow.prototype;return["color","blur","offsetX","offsetY","affectStroke","nonScaling"].forEach(function(s){this[s]!==r[s]&&(d[s]=this[s])},this),d}}),a.Shadow.reOffsetsAndBlur=/(?:\s|^)(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(-?\d+(?:\.\d*)?(?:px)?(?:\s?|$))?(\d+(?:\.\d*)?(?:px)?)?(?:\s?|$)(?:$|\s)/)}(e),function(){if(_.StaticCanvas)_.warn("fabric.StaticCanvas is already defined.");else{var c=_.util.object.extend,a=_.util.getElementOffset,l=_.util.removeFromArray,d=_.util.toFixed,r=_.util.transformPoint,s=_.util.invertTransform,u=_.util.getNodeCanvas,m=_.util.createCanvasElement,f=new Error("Could not initialize `canvas` element");_.StaticCanvas=_.util.createClass(_.CommonMethods,{initialize:function(g,y){y||(y={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(g,y)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:_.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,clipPath:void 0,_initStatic:function(g,y){var E=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(g),this._initOptions(y),this.interactive||this._initRetinaScaling(),y.overlayImage&&this.setOverlayImage(y.overlayImage,E),y.backgroundImage&&this.setBackgroundImage(y.backgroundImage,E),y.backgroundColor&&this.setBackgroundColor(y.backgroundColor,E),y.overlayColor&&this.setOverlayColor(y.overlayColor,E),this.calcOffset()},_isRetinaScaling:function(){return _.devicePixelRatio>1&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?Math.max(1,_.devicePixelRatio):1},_initRetinaScaling:function(){if(this._isRetinaScaling()){var g=_.devicePixelRatio;this.__initRetinaScaling(g,this.lowerCanvasEl,this.contextContainer),this.upperCanvasEl&&this.__initRetinaScaling(g,this.upperCanvasEl,this.contextTop)}},__initRetinaScaling:function(g,y,E){y.setAttribute("width",this.width*g),y.setAttribute("height",this.height*g),E.scale(g,g)},calcOffset:function(){return this._offset=a(this.lowerCanvasEl),this},setOverlayImage:function(g,y,E){return this.__setBgOverlayImage("overlayImage",g,y,E)},setBackgroundImage:function(g,y,E){return this.__setBgOverlayImage("backgroundImage",g,y,E)},setOverlayColor:function(g,y){return this.__setBgOverlayColor("overlayColor",g,y)},setBackgroundColor:function(g,y){return this.__setBgOverlayColor("backgroundColor",g,y)},__setBgOverlayImage:function(g,y,E,C){return typeof y=="string"?_.util.loadImage(y,function(T,D){if(T){var A=new _.Image(T,C);this[g]=A,A.canvas=this}E&&E(T,D)},this,C&&C.crossOrigin):(C&&y.setOptions(C),this[g]=y,y&&(y.canvas=this),E&&E(y,!1)),this},__setBgOverlayColor:function(g,y,E){return this[g]=y,this._initGradient(y,g),this._initPattern(y,g,E),this},_createCanvasElement:function(){var g=m();if(!g||(g.style||(g.style={}),g.getContext===void 0))throw f;return g},_initOptions:function(g){var y=this.lowerCanvasEl;this._setOptions(g),this.width=this.width||parseInt(y.width,10)||0,this.height=this.height||parseInt(y.height,10)||0,this.lowerCanvasEl.style&&(y.width=this.width,y.height=this.height,y.style.width=this.width+"px",y.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(g){g&&g.getContext?this.lowerCanvasEl=g:this.lowerCanvasEl=_.util.getById(g)||this._createCanvasElement(),_.util.addClass(this.lowerCanvasEl,"lower-canvas"),this._originalCanvasStyle=this.lowerCanvasEl.style,this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(g,y){return this.setDimensions({width:g},y)},setHeight:function(g,y){return this.setDimensions({height:g},y)},setDimensions:function(g,y){var E;for(var C in y=y||{},g)E=g[C],y.cssOnly||(this._setBackstoreDimension(C,g[C]),E+="px",this.hasLostContext=!0),y.backstoreOnly||this._setCssDimension(C,E);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(this.contextTop),this._initRetinaScaling(),this.calcOffset(),y.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(g,y){return this.lowerCanvasEl[g]=y,this.upperCanvasEl&&(this.upperCanvasEl[g]=y),this.cacheCanvasEl&&(this.cacheCanvasEl[g]=y),this[g]=y,this},_setCssDimension:function(g,y){return this.lowerCanvasEl.style[g]=y,this.upperCanvasEl&&(this.upperCanvasEl.style[g]=y),this.wrapperEl&&(this.wrapperEl.style[g]=y),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(g){var y,E,C,T=this._activeObject,D=this.backgroundImage,A=this.overlayImage;for(this.viewportTransform=g,E=0,C=this._objects.length;E<C;E++)(y=this._objects[E]).group||y.setCoords(!0);return T&&T.setCoords(),D&&D.setCoords(!0),A&&A.setCoords(!0),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(g,y){var E=g,C=this.viewportTransform.slice(0);g=r(g,s(this.viewportTransform)),C[0]=y,C[3]=y;var T=r(g,C);return C[4]+=E.x-T.x,C[5]+=E.y-T.y,this.setViewportTransform(C)},setZoom:function(g){return this.zoomToPoint(new _.Point(0,0),g),this},absolutePan:function(g){var y=this.viewportTransform.slice(0);return y[4]=-g.x,y[5]=-g.y,this.setViewportTransform(y)},relativePan:function(g){return this.absolutePan(new _.Point(-g.x-this.viewportTransform[4],-g.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(g){this.stateful&&g.setupState(),g._set("canvas",this),g.setCoords(),this.fire("object:added",{target:g}),g.fire("added")},_onObjectRemoved:function(g){this.fire("object:removed",{target:g}),g.fire("removed"),delete g.canvas},clearContext:function(g){return g.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this.remove.apply(this,this.getObjects()),this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var g=this.contextContainer;return this.renderCanvas(g,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=_.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var g={},y=this.width,E=this.height,C=s(this.viewportTransform);return g.tl=r({x:0,y:0},C),g.br=r({x:y,y:E},C),g.tr=new _.Point(g.br.x,g.tl.y),g.bl=new _.Point(g.tl.x,g.br.y),this.vptCoords=g,g},cancelRequestedRender:function(){this.isRendering&&(_.util.cancelAnimFrame(this.isRendering),this.isRendering=0)},renderCanvas:function(g,y){var E=this.viewportTransform,C=this.clipPath;this.cancelRequestedRender(),this.calcViewportBoundaries(),this.clearContext(g),_.util.setImageSmoothing(g,this.imageSmoothingEnabled),this.fire("before:render",{ctx:g}),this._renderBackground(g),g.save(),g.transform(E[0],E[1],E[2],E[3],E[4],E[5]),this._renderObjects(g,y),g.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),C&&(C.canvas=this,C.shouldCache(),C._transformDone=!0,C.renderCache({forClipping:!0}),this.drawClipPathOnCanvas(g)),this._renderOverlay(g),this.controlsAboveOverlay&&this.interactive&&this.drawControls(g),this.fire("after:render",{ctx:g})},drawClipPathOnCanvas:function(g){var y=this.viewportTransform,E=this.clipPath;g.save(),g.transform(y[0],y[1],y[2],y[3],y[4],y[5]),g.globalCompositeOperation="destination-in",E.transform(g),g.scale(1/E.zoomX,1/E.zoomY),g.drawImage(E._cacheCanvas,-E.cacheTranslationX,-E.cacheTranslationY),g.restore()},_renderObjects:function(g,y){var E,C;for(E=0,C=y.length;E<C;++E)y[E]&&y[E].render(g)},_renderBackgroundOrOverlay:function(g,y){var E=this[y+"Color"],C=this[y+"Image"],T=this.viewportTransform,D=this[y+"Vpt"];if(E||C){if(E){g.save(),g.beginPath(),g.moveTo(0,0),g.lineTo(this.width,0),g.lineTo(this.width,this.height),g.lineTo(0,this.height),g.closePath(),g.fillStyle=E.toLive?E.toLive(g,this):E,D&&g.transform(T[0],T[1],T[2],T[3],T[4],T[5]),g.transform(1,0,0,1,E.offsetX||0,E.offsetY||0);var A=E.gradientTransform||E.patternTransform;A&&g.transform(A[0],A[1],A[2],A[3],A[4],A[5]),g.fill(),g.restore()}C&&(g.save(),D&&g.transform(T[0],T[1],T[2],T[3],T[4],T[5]),C.render(g),g.restore())}},_renderBackground:function(g){this._renderBackgroundOrOverlay(g,"background")},_renderOverlay:function(g){this._renderBackgroundOrOverlay(g,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},getCenterPoint:function(){return new _.Point(this.width/2,this.height/2)},centerObjectH:function(g){return this._centerObject(g,new _.Point(this.getCenterPoint().x,g.getCenterPoint().y))},centerObjectV:function(g){return this._centerObject(g,new _.Point(g.getCenterPoint().x,this.getCenterPoint().y))},centerObject:function(g){var y=this.getCenterPoint();return this._centerObject(g,y)},viewportCenterObject:function(g){var y=this.getVpCenter();return this._centerObject(g,y)},viewportCenterObjectH:function(g){var y=this.getVpCenter();return this._centerObject(g,new _.Point(y.x,g.getCenterPoint().y)),this},viewportCenterObjectV:function(g){var y=this.getVpCenter();return this._centerObject(g,new _.Point(g.getCenterPoint().x,y.y))},getVpCenter:function(){var g=this.getCenterPoint(),y=s(this.viewportTransform);return r(g,y)},_centerObject:function(g,y){return g.setPositionByOrigin(y,"center","center"),g.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(g){return this.toDatalessObject(g)},toObject:function(g){return this._toObjectMethod("toObject",g)},toDatalessObject:function(g){return this._toObjectMethod("toDatalessObject",g)},_toObjectMethod:function(g,y){var E=this.clipPath,C={version:_.version,objects:this._toObjects(g,y)};return E&&!E.excludeFromExport&&(C.clipPath=this._toObject(this.clipPath,g,y)),c(C,this.__serializeBgOverlay(g,y)),_.util.populateWithProperties(this,C,y),C},_toObjects:function(g,y){return this._objects.filter(function(E){return!E.excludeFromExport}).map(function(E){return this._toObject(E,g,y)},this)},_toObject:function(g,y,E){var C;this.includeDefaultValues||(C=g.includeDefaultValues,g.includeDefaultValues=!1);var T=g[y](E);return this.includeDefaultValues||(g.includeDefaultValues=C),T},__serializeBgOverlay:function(g,y){var E={},C=this.backgroundImage,T=this.overlayImage,D=this.backgroundColor,A=this.overlayColor;return D&&D.toObject?D.excludeFromExport||(E.background=D.toObject(y)):D&&(E.background=D),A&&A.toObject?A.excludeFromExport||(E.overlay=A.toObject(y)):A&&(E.overlay=A),C&&!C.excludeFromExport&&(E.backgroundImage=this._toObject(C,g,y)),T&&!T.excludeFromExport&&(E.overlayImage=this._toObject(T,g,y)),E},svgViewportTransformation:!0,toSVG:function(g,y){g||(g={}),g.reviver=y;var E=[];return this._setSVGPreamble(E,g),this._setSVGHeader(E,g),this.clipPath&&E.push('<g clip-path="url(#'+this.clipPath.clipPathId+`)" >
`),this._setSVGBgOverlayColor(E,"background"),this._setSVGBgOverlayImage(E,"backgroundImage",y),this._setSVGObjects(E,y),this.clipPath&&E.push(`</g>
`),this._setSVGBgOverlayColor(E,"overlay"),this._setSVGBgOverlayImage(E,"overlayImage",y),E.push("</svg>"),E.join("")},_setSVGPreamble:function(g,y){y.suppressPreamble||g.push('<?xml version="1.0" encoding="',y.encoding||"UTF-8",`" standalone="no" ?>
`,'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ',`"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
`)},_setSVGHeader:function(g,y){var E,C=y.width||this.width,T=y.height||this.height,D='viewBox="0 0 '+this.width+" "+this.height+'" ',A=_.Object.NUM_FRACTION_DIGITS;y.viewBox?D='viewBox="'+y.viewBox.x+" "+y.viewBox.y+" "+y.viewBox.width+" "+y.viewBox.height+'" ':this.svgViewportTransformation&&(E=this.viewportTransform,D='viewBox="'+d(-E[4]/E[0],A)+" "+d(-E[5]/E[3],A)+" "+d(this.width/E[0],A)+" "+d(this.height/E[3],A)+'" '),g.push("<svg ",'xmlns="http://www.w3.org/2000/svg" ','xmlns:xlink="http://www.w3.org/1999/xlink" ','version="1.1" ','width="',C,'" ','height="',T,'" ',D,`xml:space="preserve">
`,"<desc>Created with Fabric.js ",_.version,`</desc>
`,`<defs>
`,this.createSVGFontFacesMarkup(),this.createSVGRefElementsMarkup(),this.createSVGClipPathMarkup(y),`</defs>
`)},createSVGClipPathMarkup:function(g){var y=this.clipPath;return y?(y.clipPathId="CLIPPATH_"+_.Object.__uid++,'<clipPath id="'+y.clipPathId+`" >
`+this.clipPath.toClipPathSVG(g.reviver)+`</clipPath>
`):""},createSVGRefElementsMarkup:function(){var g=this;return["background","overlay"].map(function(y){var E=g[y+"Color"];if(E&&E.toLive){var C=g[y+"Vpt"],T=g.viewportTransform,D={width:g.width/(C?T[0]:1),height:g.height/(C?T[3]:1)};return E.toSVG(D,{additionalTransform:C?_.util.matrixToSVG(T):""})}}).join("")},createSVGFontFacesMarkup:function(){var g,y,E,C,T,D,A,L,U="",G={},J=_.fontPaths,q=[];for(this._objects.forEach(function P(N){q.push(N),N._objects&&N._objects.forEach(P)}),A=0,L=q.length;A<L;A++)if(y=(g=q[A]).fontFamily,g.type.indexOf("text")!==-1&&!G[y]&&J[y]&&(G[y]=!0,g.styles))for(T in E=g.styles)for(D in C=E[T])!G[y=C[D].fontFamily]&&J[y]&&(G[y]=!0);for(var X in G)U+=[`		@font-face {
`,"			font-family: '",X,`';
`,"			src: url('",J[X],`');
`,`		}
`].join("");return U&&(U=['	<style type="text/css">',`<![CDATA[
`,U,"]]>",`</style>
`].join("")),U},_setSVGObjects:function(g,y){var E,C,T,D=this._objects;for(C=0,T=D.length;C<T;C++)(E=D[C]).excludeFromExport||this._setSVGObject(g,E,y)},_setSVGObject:function(g,y,E){g.push(y.toSVG(E))},_setSVGBgOverlayImage:function(g,y,E){this[y]&&!this[y].excludeFromExport&&this[y].toSVG&&g.push(this[y].toSVG(E))},_setSVGBgOverlayColor:function(g,y){var E=this[y+"Color"],C=this.viewportTransform,T=this.width,D=this.height;if(E)if(E.toLive){var A=E.repeat,L=_.util.invertTransform(C),U=this[y+"Vpt"]?_.util.matrixToSVG(L):"";g.push('<rect transform="'+U+" translate(",T/2,",",D/2,')"',' x="',E.offsetX-T/2,'" y="',E.offsetY-D/2,'" ','width="',A==="repeat-y"||A==="no-repeat"?E.source.width:T,'" height="',A==="repeat-x"||A==="no-repeat"?E.source.height:D,'" fill="url(#SVGID_'+E.id+')"',`></rect>
`)}else g.push('<rect x="0" y="0" width="100%" height="100%" ','fill="',E,'"',`></rect>
`)},sendToBack:function(g){if(!g)return this;var y,E,C,T=this._activeObject;if(g===T&&g.type==="activeSelection")for(y=(C=T._objects).length;y--;)E=C[y],l(this._objects,E),this._objects.unshift(E);else l(this._objects,g),this._objects.unshift(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(g){if(!g)return this;var y,E,C,T=this._activeObject;if(g===T&&g.type==="activeSelection")for(C=T._objects,y=0;y<C.length;y++)E=C[y],l(this._objects,E),this._objects.push(E);else l(this._objects,g),this._objects.push(g);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(g,y){if(!g)return this;var E,C,T,D,A,L=this._activeObject,U=0;if(g===L&&g.type==="activeSelection")for(A=L._objects,E=0;E<A.length;E++)C=A[E],(T=this._objects.indexOf(C))>0+U&&(D=T-1,l(this._objects,C),this._objects.splice(D,0,C)),U++;else(T=this._objects.indexOf(g))!==0&&(D=this._findNewLowerIndex(g,T,y),l(this._objects,g),this._objects.splice(D,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(g,y,E){var C,T;if(E){for(C=y,T=y-1;T>=0;--T)if(g.intersectsWithObject(this._objects[T])||g.isContainedWithinObject(this._objects[T])||this._objects[T].isContainedWithinObject(g)){C=T;break}}else C=y-1;return C},bringForward:function(g,y){if(!g)return this;var E,C,T,D,A,L=this._activeObject,U=0;if(g===L&&g.type==="activeSelection")for(E=(A=L._objects).length;E--;)C=A[E],(T=this._objects.indexOf(C))<this._objects.length-1-U&&(D=T+1,l(this._objects,C),this._objects.splice(D,0,C)),U++;else(T=this._objects.indexOf(g))!==this._objects.length-1&&(D=this._findNewUpperIndex(g,T,y),l(this._objects,g),this._objects.splice(D,0,g));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(g,y,E){var C,T,D;if(E){for(C=y,T=y+1,D=this._objects.length;T<D;++T)if(g.intersectsWithObject(this._objects[T])||g.isContainedWithinObject(this._objects[T])||this._objects[T].isContainedWithinObject(g)){C=T;break}}else C=y+1;return C},moveTo:function(g,y){return l(this._objects,g),this._objects.splice(y,0,g),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(_.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(g){g.dispose&&g.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),_.util.setStyle(this.lowerCanvasEl,this._originalCanvasStyle),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),_.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this._objects.length+" }>"}}),c(_.StaticCanvas.prototype,_.Observable),c(_.StaticCanvas.prototype,_.Collection),c(_.StaticCanvas.prototype,_.DataURLExporter),c(_.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(g){var y=m();if(!y||!y.getContext)return null;var E=y.getContext("2d");return E&&g==="setLineDash"?E.setLineDash!==void 0:null}}),_.StaticCanvas.prototype.toJSON=_.StaticCanvas.prototype.toObject,_.isLikelyNode&&(_.StaticCanvas.prototype.createPNGStream=function(){var g=u(this.lowerCanvasEl);return g&&g.createPNGStream()},_.StaticCanvas.prototype.createJPEGStream=function(g){var y=u(this.lowerCanvasEl);return y&&y.createJPEGStream(g)})}}(),_.BaseBrush=_.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,limitedToCanvasSize:!1,_setBrushStyles:function(c){c.strokeStyle=this.color,c.lineWidth=this.width,c.lineCap=this.strokeLineCap,c.miterLimit=this.strokeMiterLimit,c.lineJoin=this.strokeLineJoin,c.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(c){var a=this.canvas.viewportTransform;c.save(),c.transform(a[0],a[1],a[2],a[3],a[4],a[5])},_setShadow:function(){if(this.shadow){var c=this.canvas,a=this.shadow,l=c.contextTop,d=c.getZoom();c&&c._isRetinaScaling()&&(d*=_.devicePixelRatio),l.shadowColor=a.color,l.shadowBlur=a.blur*d,l.shadowOffsetX=a.offsetX*d,l.shadowOffsetY=a.offsetY*d}},needsFullRender:function(){return new _.Color(this.color).getAlpha()<1||!!this.shadow},_resetShadow:function(){var c=this.canvas.contextTop;c.shadowColor="",c.shadowBlur=c.shadowOffsetX=c.shadowOffsetY=0},_isOutSideCanvas:function(c){return c.x<0||c.x>this.canvas.getWidth()||c.y<0||c.y>this.canvas.getHeight()}}),_.PencilBrush=_.util.createClass(_.BaseBrush,{decimate:.4,drawStraightLine:!1,straightLineKey:"shiftKey",initialize:function(c){this.canvas=c,this._points=[]},needsFullRender:function(){return this.callSuper("needsFullRender")||this._hasStraightLine},_drawSegment:function(c,a,l){var d=a.midPointFrom(l);return c.quadraticCurveTo(a.x,a.y,d.x,d.y),d},onMouseDown:function(c,a){this.canvas._isMainEvent(a.e)&&(this.drawStraightLine=a.e[this.straightLineKey],this._prepareForDrawing(c),this._captureDrawingPath(c),this._render())},onMouseMove:function(c,a){if(this.canvas._isMainEvent(a.e)&&(this.drawStraightLine=a.e[this.straightLineKey],(this.limitedToCanvasSize!==!0||!this._isOutSideCanvas(c))&&this._captureDrawingPath(c)&&this._points.length>1))if(this.needsFullRender())this.canvas.clearContext(this.canvas.contextTop),this._render();else{var l=this._points,d=l.length,r=this.canvas.contextTop;this._saveAndTransform(r),this.oldEnd&&(r.beginPath(),r.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(r,l[d-2],l[d-1],!0),r.stroke(),r.restore()}},onMouseUp:function(c){return!this.canvas._isMainEvent(c.e)||(this.drawStraightLine=!1,this.oldEnd=void 0,this._finalizeAndAddPath(),!1)},_prepareForDrawing:function(c){var a=new _.Point(c.x,c.y);this._reset(),this._addPoint(a),this.canvas.contextTop.moveTo(a.x,a.y)},_addPoint:function(c){return!(this._points.length>1&&c.eq(this._points[this._points.length-1])||(this.drawStraightLine&&this._points.length>1&&(this._hasStraightLine=!0,this._points.pop()),this._points.push(c),0))},_reset:function(){this._points=[],this._setBrushStyles(this.canvas.contextTop),this._setShadow(),this._hasStraightLine=!1},_captureDrawingPath:function(c){var a=new _.Point(c.x,c.y);return this._addPoint(a)},_render:function(c){var a,l,d=this._points[0],r=this._points[1];if(c=c||this.canvas.contextTop,this._saveAndTransform(c),c.beginPath(),this._points.length===2&&d.x===r.x&&d.y===r.y){var s=this.width/1e3;d=new _.Point(d.x,d.y),r=new _.Point(r.x,r.y),d.x-=s,r.x+=s}for(c.moveTo(d.x,d.y),a=1,l=this._points.length;a<l;a++)this._drawSegment(c,d,r),d=this._points[a],r=this._points[a+1];c.lineTo(d.x,d.y),c.stroke(),c.restore()},convertPointsToSVGPath:function(c){var a=this.width/1e3;return _.util.getSmoothPathFromPoints(c,a)},_isEmptySVGPath:function(c){return _.util.joinPath(c)==="M 0 0 Q 0 0 0 0 L 0 0"},createPath:function(c){var a=new _.Path(c,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray});return this.shadow&&(this.shadow.affectStroke=!0,a.shadow=new _.Shadow(this.shadow)),a},decimatePoints:function(c,a){if(c.length<=2)return c;var l,d=this.canvas.getZoom(),r=Math.pow(a/d,2),s=c.length-1,u=c[0],m=[u];for(l=1;l<s-1;l++)Math.pow(u.x-c[l].x,2)+Math.pow(u.y-c[l].y,2)>=r&&(u=c[l],m.push(u));return m.push(c[s]),m},_finalizeAndAddPath:function(){this.canvas.contextTop.closePath(),this.decimate&&(this._points=this.decimatePoints(this._points,this.decimate));var c=this.convertPointsToSVGPath(this._points);if(this._isEmptySVGPath(c))this.canvas.requestRenderAll();else{var a=this.createPath(c);this.canvas.clearContext(this.canvas.contextTop),this.canvas.fire("before:path:created",{path:a}),this.canvas.add(a),this.canvas.requestRenderAll(),a.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:a})}}}),_.CircleBrush=_.util.createClass(_.BaseBrush,{width:10,initialize:function(c){this.canvas=c,this.points=[]},drawDot:function(c){var a=this.addPoint(c),l=this.canvas.contextTop;this._saveAndTransform(l),this.dot(l,a),l.restore()},dot:function(c,a){c.fillStyle=a.fill,c.beginPath(),c.arc(a.x,a.y,a.radius,0,2*Math.PI,!1),c.closePath(),c.fill()},onMouseDown:function(c){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(c)},_render:function(){var c,a,l=this.canvas.contextTop,d=this.points;for(this._saveAndTransform(l),c=0,a=d.length;c<a;c++)this.dot(l,d[c]);l.restore()},onMouseMove:function(c){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(c)||(this.needsFullRender()?(this.canvas.clearContext(this.canvas.contextTop),this.addPoint(c),this._render()):this.drawDot(c))},onMouseUp:function(){var c,a,l=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var d=[];for(c=0,a=this.points.length;c<a;c++){var r=this.points[c],s=new _.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&(s.shadow=new _.Shadow(this.shadow)),d.push(s)}var u=new _.Group(d);u.canvas=this.canvas,this.canvas.fire("before:path:created",{path:u}),this.canvas.add(u),this.canvas.fire("path:created",{path:u}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=l,this.canvas.requestRenderAll()},addPoint:function(c){var a=new _.Point(c.x,c.y),l=_.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,d=new _.Color(this.color).setAlpha(_.util.getRandomInt(0,100)/100).toRgba();return a.radius=l,a.fill=d,this.points.push(a),a}}),_.SprayBrush=_.util.createClass(_.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(c){this.canvas=c,this.sprayChunks=[]},onMouseDown:function(c){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(c),this.render(this.sprayChunkPoints)},onMouseMove:function(c){this.limitedToCanvasSize===!0&&this._isOutSideCanvas(c)||(this.addSprayChunk(c),this.render(this.sprayChunkPoints))},onMouseUp:function(){var c=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var a=[],l=0,d=this.sprayChunks.length;l<d;l++)for(var r=this.sprayChunks[l],s=0,u=r.length;s<u;s++){var m=new _.Rect({width:r[s].width,height:r[s].width,left:r[s].x+1,top:r[s].y+1,originX:"center",originY:"center",fill:this.color});a.push(m)}this.optimizeOverlapping&&(a=this._getOptimizedRects(a));var f=new _.Group(a);this.shadow&&f.set("shadow",new _.Shadow(this.shadow)),this.canvas.fire("before:path:created",{path:f}),this.canvas.add(f),this.canvas.fire("path:created",{path:f}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=c,this.canvas.requestRenderAll()},_getOptimizedRects:function(c){var a,l,d,r={};for(l=0,d=c.length;l<d;l++)r[a=c[l].left+""+c[l].top]||(r[a]=c[l]);var s=[];for(a in r)s.push(r[a]);return s},render:function(c){var a,l,d=this.canvas.contextTop;for(d.fillStyle=this.color,this._saveAndTransform(d),a=0,l=c.length;a<l;a++){var r=c[a];r.opacity!==void 0&&(d.globalAlpha=r.opacity),d.fillRect(r.x,r.y,r.width,r.width)}d.restore()},_render:function(){var c,a,l=this.canvas.contextTop;for(l.fillStyle=this.color,this._saveAndTransform(l),c=0,a=this.sprayChunks.length;c<a;c++)this.render(this.sprayChunks[c]);l.restore()},addSprayChunk:function(c){this.sprayChunkPoints=[];var a,l,d,r,s=this.width/2;for(r=0;r<this.density;r++){a=_.util.getRandomInt(c.x-s,c.x+s),l=_.util.getRandomInt(c.y-s,c.y+s),d=this.dotWidthVariance?_.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var u=new _.Point(a,l);u.width=d,this.randomOpacity&&(u.opacity=_.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(u)}this.sprayChunks.push(this.sprayChunkPoints)}}),_.PatternBrush=_.util.createClass(_.PencilBrush,{getPatternSrc:function(){var c=_.util.createCanvasElement(),a=c.getContext("2d");return c.width=c.height=25,a.fillStyle=this.color,a.beginPath(),a.arc(10,10,10,0,2*Math.PI,!1),a.closePath(),a.fill(),c},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(c){return c.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(c){this.callSuper("_setBrushStyles",c),c.strokeStyle=this.getPattern(c)},createPath:function(c){var a=this.callSuper("createPath",c),l=a._getLeftTopCoords().scalarAdd(a.strokeWidth/2);return a.stroke=new _.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-l.x,offsetY:-l.y}),a}}),function(){var c=_.util.getPointer,a=_.util.degreesToRadians,l=_.util.isTouchEvent;for(var d in _.Canvas=_.util.createClass(_.StaticCanvas,{initialize:function(r,s){s||(s={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(r,s),this._initInteractive(),this._createCacheCanvas()},uniformScaling:!0,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,targets:[],enablePointerEvents:!1,_hoveredTarget:null,_hoveredTargets:[],_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=_.PencilBrush&&new _.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var r,s,u,m=this.getActiveObjects();if(m.length>0&&!this.preserveObjectStacking){s=[],u=[];for(var f=0,g=this._objects.length;f<g;f++)r=this._objects[f],m.indexOf(r)===-1?s.push(r):u.push(r);m.length>1&&(this._activeObject._objects=u),s.push.apply(s,u)}else s=this._objects;return s},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&(this.renderTopLayer(this.contextTop),this.hasLostContext=!1);var r=this.contextContainer;return this.renderCanvas(r,this._chooseObjectsToRender()),this},renderTopLayer:function(r){r.save(),this.isDrawingMode&&this._isCurrentlyDrawing&&(this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.contextTopDirty=!0),this.selection&&this._groupSelector&&(this._drawSelection(r),this.contextTopDirty=!0),r.restore()},renderTop:function(){var r=this.contextTop;return this.clearContext(r),this.renderTopLayer(r),this.fire("after:render"),this},_normalizePointer:function(r,s){var u=r.calcTransformMatrix(),m=_.util.invertTransform(u),f=this.restorePointerVpt(s);return _.util.transformPoint(f,m)},isTargetTransparent:function(r,s,u){if(r.shouldCache()&&r._cacheCanvas&&r!==this._activeObject){var m=this._normalizePointer(r,{x:s,y:u}),f=Math.max(r.cacheTranslationX+m.x*r.zoomX,0),g=Math.max(r.cacheTranslationY+m.y*r.zoomY,0);return _.util.isTransparent(r._cacheContext,Math.round(f),Math.round(g),this.targetFindTolerance)}var y=this.contextCache,E=r.selectionBackgroundColor,C=this.viewportTransform;return r.selectionBackgroundColor="",this.clearContext(y),y.save(),y.transform(C[0],C[1],C[2],C[3],C[4],C[5]),r.render(y),y.restore(),r.selectionBackgroundColor=E,_.util.isTransparent(y,s,u,this.targetFindTolerance)},_isSelectionKeyPressed:function(r){return Array.isArray(this.selectionKey)?!!this.selectionKey.find(function(s){return r[s]===!0}):r[this.selectionKey]},_shouldClearSelection:function(r,s){var u=this.getActiveObjects(),m=this._activeObject;return!s||s&&m&&u.length>1&&u.indexOf(s)===-1&&m!==s&&!this._isSelectionKeyPressed(r)||s&&!s.evented||s&&!s.selectable&&m&&m!==s},_shouldCenterTransform:function(r,s,u){var m;if(r)return s==="scale"||s==="scaleX"||s==="scaleY"||s==="resizing"?m=this.centeredScaling||r.centeredScaling:s==="rotate"&&(m=this.centeredRotation||r.centeredRotation),m?!u:u},_getOriginFromCorner:function(r,s){var u={x:r.originX,y:r.originY};return s==="ml"||s==="tl"||s==="bl"?u.x="right":s!=="mr"&&s!=="tr"&&s!=="br"||(u.x="left"),s==="tl"||s==="mt"||s==="tr"?u.y="bottom":s!=="bl"&&s!=="mb"&&s!=="br"||(u.y="top"),u},_getActionFromCorner:function(r,s,u,m){if(!s||!r)return"drag";var f=m.controls[s];return f.getActionName(u,f,m)},_setupCurrentTransform:function(r,s,u){if(s){var m=this.getPointer(r),f=s.__corner,g=s.controls[f],y=u&&f?g.getActionHandler(r,s,g):_.controlsUtils.dragHandler,E=this._getActionFromCorner(u,f,r,s),C=this._getOriginFromCorner(s,f),T=r[this.centeredKey],D={target:s,action:E,actionHandler:y,corner:f,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,offsetX:m.x-s.left,offsetY:m.y-s.top,originX:C.x,originY:C.y,ex:m.x,ey:m.y,lastX:m.x,lastY:m.y,theta:a(s.angle),width:s.width*s.scaleX,shiftKey:r.shiftKey,altKey:T,original:_.util.saveObjectTransform(s)};this._shouldCenterTransform(s,E,T)&&(D.originX="center",D.originY="center"),D.original.originX=C.x,D.original.originY=C.y,this._currentTransform=D,this._beforeTransform(r)}},setCursor:function(r){this.upperCanvasEl.style.cursor=r},_drawSelection:function(r){var s=this._groupSelector,u=new _.Point(s.ex,s.ey),m=_.util.transformPoint(u,this.viewportTransform),f=new _.Point(s.ex+s.left,s.ey+s.top),g=_.util.transformPoint(f,this.viewportTransform),y=Math.min(m.x,g.x),E=Math.min(m.y,g.y),C=Math.max(m.x,g.x),T=Math.max(m.y,g.y),D=this.selectionLineWidth/2;this.selectionColor&&(r.fillStyle=this.selectionColor,r.fillRect(y,E,C-y,T-E)),this.selectionLineWidth&&this.selectionBorderColor&&(r.lineWidth=this.selectionLineWidth,r.strokeStyle=this.selectionBorderColor,y+=D,E+=D,C-=D,T-=D,_.Object.prototype._setLineDash.call(this,r,this.selectionDashArray),r.strokeRect(y,E,C-y,T-E))},findTarget:function(r,s){if(!this.skipTargetFind){var u,m,f=this.getPointer(r,!0),g=this._activeObject,y=this.getActiveObjects(),E=l(r),C=y.length>1&&!s||y.length===1;if(this.targets=[],C&&g._findTargetCorner(f,E)||y.length>1&&!s&&g===this._searchPossibleTargets([g],f))return g;if(y.length===1&&g===this._searchPossibleTargets([g],f)){if(!this.preserveObjectStacking)return g;u=g,m=this.targets,this.targets=[]}var T=this._searchPossibleTargets(this._objects,f);return r[this.altSelectionKey]&&T&&u&&T!==u&&(T=u,this.targets=m),T}},_checkTarget:function(r,s,u){if(s&&s.visible&&s.evented&&s.containsPoint(r)&&(!this.perPixelTargetFind&&!s.perPixelTargetFind||s.isEditing||!this.isTargetTransparent(s,u.x,u.y)))return!0},_searchPossibleTargets:function(r,s){for(var u,m,f=r.length;f--;){var g=r[f],y=g.group?this._normalizePointer(g.group,s):s;if(this._checkTarget(y,g,s)){(u=r[f]).subTargetCheck&&u instanceof _.Group&&(m=this._searchPossibleTargets(u._objects,s))&&this.targets.push(m);break}}return u},restorePointerVpt:function(r){return _.util.transformPoint(r,_.util.invertTransform(this.viewportTransform))},getPointer:function(r,s){if(this._absolutePointer&&!s)return this._absolutePointer;if(this._pointer&&s)return this._pointer;var u,m=c(r),f=this.upperCanvasEl,g=f.getBoundingClientRect(),y=g.width||0,E=g.height||0;y&&E||("top"in g&&"bottom"in g&&(E=Math.abs(g.top-g.bottom)),"right"in g&&"left"in g&&(y=Math.abs(g.right-g.left))),this.calcOffset(),m.x=m.x-this._offset.left,m.y=m.y-this._offset.top,s||(m=this.restorePointerVpt(m));var C=this.getRetinaScaling();return C!==1&&(m.x/=C,m.y/=C),u=y===0||E===0?{width:1,height:1}:{width:f.width/y,height:f.height/E},{x:m.x*u.width,y:m.y*u.height}},_createUpperCanvas:function(){var r=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,""),s=this.lowerCanvasEl,u=this.upperCanvasEl;u?u.className="":(u=this._createCanvasElement(),this.upperCanvasEl=u),_.util.addClass(u,"upper-canvas "+r),this.wrapperEl.appendChild(u),this._copyCanvasStyle(s,u),this._applyCanvasStyle(u),this.contextTop=u.getContext("2d")},getTopContext:function(){return this.contextTop},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=_.util.wrapElement(this.lowerCanvasEl,"div",{class:this.containerClass}),_.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),_.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(r){var s=this.width||r.width,u=this.height||r.height;_.util.setStyle(r,{position:"absolute",width:s+"px",height:u+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none","-ms-touch-action":this.allowTouchScrolling?"manipulation":"none"}),r.width=s,r.height=u,_.util.makeElementUnselectable(r)},_copyCanvasStyle:function(r,s){s.style.cssText=r.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var r=this._activeObject;return r?r.type==="activeSelection"&&r._objects?r._objects.slice(0):[r]:[]},_onObjectRemoved:function(r){r===this._activeObject&&(this.fire("before:selection:cleared",{target:r}),this._discardActiveObject(),this.fire("selection:cleared",{target:r}),r.fire("deselected")),r===this._hoveredTarget&&(this._hoveredTarget=null,this._hoveredTargets=[]),this.callSuper("_onObjectRemoved",r)},_fireSelectionEvents:function(r,s){var u=!1,m=this.getActiveObjects(),f=[],g=[];r.forEach(function(y){m.indexOf(y)===-1&&(u=!0,y.fire("deselected",{e:s,target:y}),g.push(y))}),m.forEach(function(y){r.indexOf(y)===-1&&(u=!0,y.fire("selected",{e:s,target:y}),f.push(y))}),r.length>0&&m.length>0?u&&this.fire("selection:updated",{e:s,selected:f,deselected:g}):m.length>0?this.fire("selection:created",{e:s,selected:f}):r.length>0&&this.fire("selection:cleared",{e:s,deselected:g})},setActiveObject:function(r,s){var u=this.getActiveObjects();return this._setActiveObject(r,s),this._fireSelectionEvents(u,s),this},_setActiveObject:function(r,s){return this._activeObject!==r&&!!this._discardActiveObject(s,r)&&!r.onSelect({e:s})&&(this._activeObject=r,!0)},_discardActiveObject:function(r,s){var u=this._activeObject;if(u){if(u.onDeselect({e:r,object:s}))return!1;this._activeObject=null}return!0},discardActiveObject:function(r){var s=this.getActiveObjects(),u=this.getActiveObject();return s.length&&this.fire("before:selection:cleared",{target:u,e:r}),this._discardActiveObject(r),this._fireSelectionEvents(s,r),this},dispose:function(){var r=this.wrapperEl;return this.removeListeners(),r.removeChild(this.upperCanvasEl),r.removeChild(this.lowerCanvasEl),this.contextCache=null,this.contextTop=null,["upperCanvasEl","cacheCanvasEl"].forEach((function(s){_.util.cleanUpJsdomNode(this[s]),this[s]=void 0}).bind(this)),r.parentNode&&r.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,_.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(r){var s=this._activeObject;s&&s._renderControls(r)},_toObject:function(r,s,u){var m=this._realizeGroupTransformOnObject(r),f=this.callSuper("_toObject",r,s,u);return this._unwindGroupTransformOnObject(r,m),f},_realizeGroupTransformOnObject:function(r){if(r.group&&r.group.type==="activeSelection"&&this._activeObject===r.group){var s={};return["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"].forEach(function(u){s[u]=r[u]}),_.util.addTransformToObject(r,this._activeObject.calcOwnMatrix()),s}return null},_unwindGroupTransformOnObject:function(r,s){s&&r.set(s)},_setSVGObject:function(r,s,u){var m=this._realizeGroupTransformOnObject(s);this.callSuper("_setSVGObject",r,s,u),this._unwindGroupTransformOnObject(s,m)},setViewportTransform:function(r){this.renderOnAddRemove&&this._activeObject&&this._activeObject.isEditing&&this._activeObject.clearContextTop(),_.StaticCanvas.prototype.setViewportTransform.call(this,r)}}),_.StaticCanvas)d!=="prototype"&&(_.Canvas[d]=_.StaticCanvas[d])}(),function(){var c=_.util.addListener,a=_.util.removeListener,l={passive:!1};function d(r,s){return r.button&&r.button===s-1}_.util.object.extend(_.Canvas.prototype,{mainTouchId:null,_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(c,"add")},_getEventPrefix:function(){return this.enablePointerEvents?"pointer":"mouse"},addOrRemove:function(r,s){var u=this.upperCanvasEl,m=this._getEventPrefix();r(_.window,"resize",this._onResize),r(u,m+"down",this._onMouseDown),r(u,m+"move",this._onMouseMove,l),r(u,m+"out",this._onMouseOut),r(u,m+"enter",this._onMouseEnter),r(u,"wheel",this._onMouseWheel),r(u,"contextmenu",this._onContextMenu),r(u,"dblclick",this._onDoubleClick),r(u,"dragover",this._onDragOver),r(u,"dragenter",this._onDragEnter),r(u,"dragleave",this._onDragLeave),r(u,"drop",this._onDrop),this.enablePointerEvents||r(u,"touchstart",this._onTouchStart,l),typeof eventjs<"u"&&s in eventjs&&(eventjs[s](u,"gesture",this._onGesture),eventjs[s](u,"drag",this._onDrag),eventjs[s](u,"orientation",this._onOrientationChange),eventjs[s](u,"shake",this._onShake),eventjs[s](u,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(a,"remove");var r=this._getEventPrefix();a(_.document,r+"up",this._onMouseUp),a(_.document,"touchend",this._onTouchEnd,l),a(_.document,r+"move",this._onMouseMove,l),a(_.document,"touchmove",this._onMouseMove,l)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onTouchStart=this._onTouchStart.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onTouchEnd=this._onTouchEnd.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._onDrop.bind(this),this.eventsBound=!0)},_onGesture:function(r,s){this.__onTransformGesture&&this.__onTransformGesture(r,s)},_onDrag:function(r,s){this.__onDrag&&this.__onDrag(r,s)},_onMouseWheel:function(r){this.__onMouseWheel(r)},_onMouseOut:function(r){var s=this._hoveredTarget;this.fire("mouse:out",{target:s,e:r}),this._hoveredTarget=null,s&&s.fire("mouseout",{e:r});var u=this;this._hoveredTargets.forEach(function(m){u.fire("mouse:out",{target:s,e:r}),m&&s.fire("mouseout",{e:r})}),this._hoveredTargets=[],this._iTextInstances&&this._iTextInstances.forEach(function(m){m.isEditing&&m.hiddenTextarea.focus()})},_onMouseEnter:function(r){this._currentTransform||this.findTarget(r)||(this.fire("mouse:over",{target:null,e:r}),this._hoveredTarget=null,this._hoveredTargets=[])},_onOrientationChange:function(r,s){this.__onOrientationChange&&this.__onOrientationChange(r,s)},_onShake:function(r,s){this.__onShake&&this.__onShake(r,s)},_onLongPress:function(r,s){this.__onLongPress&&this.__onLongPress(r,s)},_onDragOver:function(r){r.preventDefault();var s=this._simpleEventHandler("dragover",r);this._fireEnterLeaveEvents(s,r)},_onDrop:function(r){return this._simpleEventHandler("drop:before",r),this._simpleEventHandler("drop",r)},_onContextMenu:function(r){return this.stopContextMenu&&(r.stopPropagation(),r.preventDefault()),!1},_onDoubleClick:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"dblclick"),this._resetTransformEventData(r)},getPointerId:function(r){var s=r.changedTouches;return s?s[0]&&s[0].identifier:this.enablePointerEvents?r.pointerId:-1},_isMainEvent:function(r){return r.isPrimary===!0||r.isPrimary!==!1&&(r.type==="touchend"&&r.touches.length===0||!r.changedTouches||r.changedTouches[0].identifier===this.mainTouchId)},_onTouchStart:function(r){r.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(r)),this.__onMouseDown(r),this._resetTransformEventData();var s=this.upperCanvasEl,u=this._getEventPrefix();c(_.document,"touchend",this._onTouchEnd,l),c(_.document,"touchmove",this._onMouseMove,l),a(s,u+"down",this._onMouseDown)},_onMouseDown:function(r){this.__onMouseDown(r),this._resetTransformEventData();var s=this.upperCanvasEl,u=this._getEventPrefix();a(s,u+"move",this._onMouseMove,l),c(_.document,u+"up",this._onMouseUp),c(_.document,u+"move",this._onMouseMove,l)},_onTouchEnd:function(r){if(!(r.touches.length>0)){this.__onMouseUp(r),this._resetTransformEventData(),this.mainTouchId=null;var s=this._getEventPrefix();a(_.document,"touchend",this._onTouchEnd,l),a(_.document,"touchmove",this._onMouseMove,l);var u=this;this._willAddMouseDown&&clearTimeout(this._willAddMouseDown),this._willAddMouseDown=setTimeout(function(){c(u.upperCanvasEl,s+"down",u._onMouseDown),u._willAddMouseDown=0},400)}},_onMouseUp:function(r){this.__onMouseUp(r),this._resetTransformEventData();var s=this.upperCanvasEl,u=this._getEventPrefix();this._isMainEvent(r)&&(a(_.document,u+"up",this._onMouseUp),a(_.document,u+"move",this._onMouseMove,l),c(s,u+"move",this._onMouseMove,l))},_onMouseMove:function(r){!this.allowTouchScrolling&&r.preventDefault&&r.preventDefault(),this.__onMouseMove(r)},_onResize:function(){this.calcOffset()},_shouldRender:function(r){var s=this._activeObject;return!!(!!s!=!!r||s&&r&&s!==r)||(s&&s.isEditing,!1)},__onMouseUp:function(r){var s,u=this._currentTransform,m=this._groupSelector,f=!1,g=!m||m.left===0&&m.top===0;if(this._cacheTransformEventData(r),s=this._target,this._handleEvent(r,"up:before"),d(r,3))this.fireRightClick&&this._handleEvent(r,"up",3,g);else{if(d(r,2))return this.fireMiddleClick&&this._handleEvent(r,"up",2,g),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)this._onMouseUpInDrawingMode(r);else if(this._isMainEvent(r)){if(u&&(this._finalizeCurrentTransform(r),f=u.actionPerformed),!g){var y=s===this._activeObject;this._maybeGroupObjects(r),f||(f=this._shouldRender(s)||!y&&s===this._activeObject)}var E,C;if(s){if(E=s._findTargetCorner(this.getPointer(r,!0),_.util.isTouchEvent(r)),s.selectable&&s!==this._activeObject&&s.activeOn==="up")this.setActiveObject(s,r),f=!0;else{var T=s.controls[E],D=T&&T.getMouseUpHandler(r,s,T);D&&D(r,u,(C=this.getPointer(r)).x,C.y)}s.isMoving=!1}if(u&&(u.target!==s||u.corner!==E)){var A=u.target&&u.target.controls[u.corner],L=A&&A.getMouseUpHandler(r,s,T);C=C||this.getPointer(r),L&&L(r,u,C.x,C.y)}this._setCursorFromEvent(r,s),this._handleEvent(r,"up",1,g),this._groupSelector=null,this._currentTransform=null,s&&(s.__corner=0),f?this.requestRenderAll():g||this.renderTop()}}},_simpleEventHandler:function(r,s){var u=this.findTarget(s),m=this.targets,f={e:s,target:u,subTargets:m};if(this.fire(r,f),u&&u.fire(r,f),!m)return u;for(var g=0;g<m.length;g++)m[g].fire(r,f);return u},_handleEvent:function(r,s,u,m){var f=this._target,g=this.targets||[],y={e:r,target:f,subTargets:g,button:u||1,isClick:m||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};s==="up"&&(y.currentTarget=this.findTarget(r),y.currentSubTargets=this.targets),this.fire("mouse:"+s,y),f&&f.fire("mouse"+s,y);for(var E=0;E<g.length;E++)g[E].fire("mouse"+s,y)},_finalizeCurrentTransform:function(r){var s=this._currentTransform,u=s.target,m={e:r,target:u,transform:s,action:s.action};u._scaling&&(u._scaling=!1),u.setCoords(),(s.actionPerformed||this.stateful&&u.hasStateChanged())&&this._fire("modified",m)},_onMouseDownInDrawingMode:function(r){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(r).requestRenderAll();var s=this.getPointer(r);this.freeDrawingBrush.onMouseDown(s,{e:r,pointer:s}),this._handleEvent(r,"down")},_onMouseMoveInDrawingMode:function(r){if(this._isCurrentlyDrawing){var s=this.getPointer(r);this.freeDrawingBrush.onMouseMove(s,{e:r,pointer:s})}this.setCursor(this.freeDrawingCursor),this._handleEvent(r,"move")},_onMouseUpInDrawingMode:function(r){var s=this.getPointer(r);this._isCurrentlyDrawing=this.freeDrawingBrush.onMouseUp({e:r,pointer:s}),this._handleEvent(r,"up")},__onMouseDown:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"down:before");var s=this._target;if(d(r,3))this.fireRightClick&&this._handleEvent(r,"down",3);else if(d(r,2))this.fireMiddleClick&&this._handleEvent(r,"down",2);else if(this.isDrawingMode)this._onMouseDownInDrawingMode(r);else if(this._isMainEvent(r)&&!this._currentTransform){var u=this._pointer;this._previousPointer=u;var m=this._shouldRender(s),f=this._shouldGroup(r,s);if(this._shouldClearSelection(r,s)?this.discardActiveObject(r):f&&(this._handleGrouping(r,s),s=this._activeObject),!this.selection||s&&(s.selectable||s.isEditing||s===this._activeObject)||(this._groupSelector={ex:this._absolutePointer.x,ey:this._absolutePointer.y,top:0,left:0}),s){var g=s===this._activeObject;s.selectable&&s.activeOn==="down"&&this.setActiveObject(s,r);var y=s._findTargetCorner(this.getPointer(r,!0),_.util.isTouchEvent(r));if(s.__corner=y,s===this._activeObject&&(y||!f)){this._setupCurrentTransform(r,s,g);var E=s.controls[y],C=(u=this.getPointer(r),E&&E.getMouseDownHandler(r,s,E));C&&C(r,this._currentTransform,u.x,u.y)}}this._handleEvent(r,"down"),(m||f)&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(r){this._resetTransformEventData(),this._pointer=this.getPointer(r,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(r)||null},_beforeTransform:function(r){var s=this._currentTransform;this.stateful&&s.target.saveState(),this.fire("before:transform",{e:r,transform:s})},__onMouseMove:function(r){var s,u;if(this._handleEvent(r,"move:before"),this._cacheTransformEventData(r),this.isDrawingMode)this._onMouseMoveInDrawingMode(r);else if(this._isMainEvent(r)){var m=this._groupSelector;m?(u=this._absolutePointer,m.left=u.x-m.ex,m.top=u.y-m.ey,this.renderTop()):this._currentTransform?this._transformObject(r):(s=this.findTarget(r)||null,this._setCursorFromEvent(r,s),this._fireOverOutEvents(s,r)),this._handleEvent(r,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(r,s){var u=this._hoveredTarget,m=this._hoveredTargets,f=this.targets,g=Math.max(m.length,f.length);this.fireSyntheticInOutEvents(r,s,{oldTarget:u,evtOut:"mouseout",canvasEvtOut:"mouse:out",evtIn:"mouseover",canvasEvtIn:"mouse:over"});for(var y=0;y<g;y++)this.fireSyntheticInOutEvents(f[y],s,{oldTarget:m[y],evtOut:"mouseout",evtIn:"mouseover"});this._hoveredTarget=r,this._hoveredTargets=this.targets.concat()},_fireEnterLeaveEvents:function(r,s){var u=this._draggedoverTarget,m=this._hoveredTargets,f=this.targets,g=Math.max(m.length,f.length);this.fireSyntheticInOutEvents(r,s,{oldTarget:u,evtOut:"dragleave",evtIn:"dragenter"});for(var y=0;y<g;y++)this.fireSyntheticInOutEvents(f[y],s,{oldTarget:m[y],evtOut:"dragleave",evtIn:"dragenter"});this._draggedoverTarget=r},fireSyntheticInOutEvents:function(r,s,u){var m,f,g,y=u.oldTarget,E=y!==r,C=u.canvasEvtIn,T=u.canvasEvtOut;E&&(m={e:s,target:r,previousTarget:y},f={e:s,target:y,nextTarget:r}),g=r&&E,y&&E&&(T&&this.fire(T,f),y.fire(u.evtOut,f)),g&&(C&&this.fire(C,m),r.fire(u.evtIn,m))},__onMouseWheel:function(r){this._cacheTransformEventData(r),this._handleEvent(r,"wheel"),this._resetTransformEventData()},_transformObject:function(r){var s=this.getPointer(r),u=this._currentTransform;u.reset=!1,u.shiftKey=r.shiftKey,u.altKey=r[this.centeredKey],this._performTransformAction(r,u,s),u.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(r,s,u){var m=u.x,f=u.y,g=s.action,y=!1,E=s.actionHandler;E&&(y=E(r,s,m,f)),g==="drag"&&y&&(s.target.isMoving=!0,this.setCursor(s.target.moveCursor||this.moveCursor)),s.actionPerformed=s.actionPerformed||y},_fire:_.controlsUtils.fireEvent,_setCursorFromEvent:function(r,s){if(!s)return this.setCursor(this.defaultCursor),!1;var u=s.hoverCursor||this.hoverCursor,m=this._activeObject&&this._activeObject.type==="activeSelection"?this._activeObject:null,f=(!m||!m.contains(s))&&s._findTargetCorner(this.getPointer(r,!0));f?this.setCursor(this.getCornerCursor(f,s,r)):(s.subTargetCheck&&this.targets.concat().reverse().map(function(g){u=g.hoverCursor||u}),this.setCursor(u))},getCornerCursor:function(r,s,u){var m=s.controls[r];return m.cursorStyleHandler(u,m,s)}})}(),Y=Math.min,Z=Math.max,_.util.object.extend(_.Canvas.prototype,{_shouldGroup:function(c,a){var l=this._activeObject;return l&&this._isSelectionKeyPressed(c)&&a&&a.selectable&&this.selection&&(l!==a||l.type==="activeSelection")&&!a.onSelect({e:c})},_handleGrouping:function(c,a){var l=this._activeObject;l.__corner||(a!==l||(a=this.findTarget(c,!0))&&a.selectable)&&(l&&l.type==="activeSelection"?this._updateActiveSelection(a,c):this._createActiveSelection(a,c))},_updateActiveSelection:function(c,a){var l=this._activeObject,d=l._objects.slice(0);l.contains(c)?(l.removeWithUpdate(c),this._hoveredTarget=c,this._hoveredTargets=this.targets.concat(),l.size()===1&&this._setActiveObject(l.item(0),a)):(l.addWithUpdate(c),this._hoveredTarget=l,this._hoveredTargets=this.targets.concat()),this._fireSelectionEvents(d,a)},_createActiveSelection:function(c,a){var l=this.getActiveObjects(),d=this._createGroup(c);this._hoveredTarget=d,this._setActiveObject(d,a),this._fireSelectionEvents(l,a)},_createGroup:function(c){var a=this._objects,l=a.indexOf(this._activeObject)<a.indexOf(c)?[this._activeObject,c]:[c,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new _.ActiveSelection(l,{canvas:this})},_groupSelectedObjects:function(c){var a,l=this._collectObjects(c);l.length===1?this.setActiveObject(l[0],c):l.length>1&&(a=new _.ActiveSelection(l.reverse(),{canvas:this}),this.setActiveObject(a,c))},_collectObjects:function(c){for(var a,l=[],d=this._groupSelector.ex,r=this._groupSelector.ey,s=d+this._groupSelector.left,u=r+this._groupSelector.top,m=new _.Point(Y(d,s),Y(r,u)),f=new _.Point(Z(d,s),Z(r,u)),g=!this.selectionFullyContained,y=d===s&&r===u,E=this._objects.length;E--&&!((a=this._objects[E])&&a.selectable&&a.visible&&(g&&a.intersectsWithRect(m,f,!0)||a.isContainedWithinRect(m,f,!0)||g&&a.containsPoint(m,null,!0)||g&&a.containsPoint(f,null,!0))&&(l.push(a),y)););return l.length>1&&(l=l.filter(function(C){return!C.onSelect({e:c})})),l},_maybeGroupObjects:function(c){this.selection&&this._groupSelector&&this._groupSelectedObjects(c),this.setCursor(this.defaultCursor),this._groupSelector=null}}),_.util.object.extend(_.StaticCanvas.prototype,{toDataURL:function(c){c||(c={});var a=c.format||"png",l=c.quality||1,d=(c.multiplier||1)*(c.enableRetinaScaling?this.getRetinaScaling():1),r=this.toCanvasElement(d,c);return _.util.toDataURL(r,a,l)},toCanvasElement:function(c,a){c=c||1;var l=((a=a||{}).width||this.width)*c,d=(a.height||this.height)*c,r=this.getZoom(),s=this.width,u=this.height,m=r*c,f=this.viewportTransform,g=(f[4]-(a.left||0))*c,y=(f[5]-(a.top||0))*c,E=this.interactive,C=[m,0,0,m,g,y],T=this.enableRetinaScaling,D=_.util.createCanvasElement(),A=this.contextTop;return D.width=l,D.height=d,this.contextTop=null,this.enableRetinaScaling=!1,this.interactive=!1,this.viewportTransform=C,this.width=l,this.height=d,this.calcViewportBoundaries(),this.renderCanvas(D.getContext("2d"),this._objects),this.viewportTransform=f,this.width=s,this.height=u,this.calcViewportBoundaries(),this.interactive=E,this.enableRetinaScaling=T,this.contextTop=A,D}}),_.util.object.extend(_.StaticCanvas.prototype,{loadFromJSON:function(c,a,l){if(c){var d=typeof c=="string"?JSON.parse(c):_.util.object.clone(c),r=this,s=d.clipPath,u=this.renderOnAddRemove;return this.renderOnAddRemove=!1,delete d.clipPath,this._enlivenObjects(d.objects,function(m){r.clear(),r._setBgOverlay(d,function(){s?r._enlivenObjects([s],function(f){r.clipPath=f[0],r.__setupCanvas.call(r,d,m,u,a)}):r.__setupCanvas.call(r,d,m,u,a)})},l),this}},__setupCanvas:function(c,a,l,d){var r=this;a.forEach(function(s,u){r.insertAt(s,u)}),this.renderOnAddRemove=l,delete c.objects,delete c.backgroundImage,delete c.overlayImage,delete c.background,delete c.overlay,this._setOptions(c),this.renderAll(),d&&d()},_setBgOverlay:function(c,a){var l={backgroundColor:!1,overlayColor:!1,backgroundImage:!1,overlayImage:!1};if(c.backgroundImage||c.overlayImage||c.background||c.overlay){var d=function(){l.backgroundImage&&l.overlayImage&&l.backgroundColor&&l.overlayColor&&a&&a()};this.__setBgOverlay("backgroundImage",c.backgroundImage,l,d),this.__setBgOverlay("overlayImage",c.overlayImage,l,d),this.__setBgOverlay("backgroundColor",c.background,l,d),this.__setBgOverlay("overlayColor",c.overlay,l,d)}else a&&a()},__setBgOverlay:function(c,a,l,d){var r=this;if(!a)return l[c]=!0,void(d&&d());c==="backgroundImage"||c==="overlayImage"?_.util.enlivenObjects([a],function(s){r[c]=s[0],l[c]=!0,d&&d()}):this["set"+_.util.string.capitalize(c,!0)](a,function(){l[c]=!0,d&&d()})},_enlivenObjects:function(c,a,l){c&&c.length!==0?_.util.enlivenObjects(c,function(d){a&&a(d)},null,l):a&&a([])},_toDataURL:function(c,a){this.clone(function(l){a(l.toDataURL(c))})},_toDataURLWithMultiplier:function(c,a,l){this.clone(function(d){l(d.toDataURLWithMultiplier(c,a))})},clone:function(c,a){var l=JSON.stringify(this.toJSON(a));this.cloneWithoutData(function(d){d.loadFromJSON(l,function(){c&&c(d)})})},cloneWithoutData:function(c){var a=_.util.createCanvasElement();a.width=this.width,a.height=this.height;var l=new _.Canvas(a);this.backgroundImage?(l.setBackgroundImage(this.backgroundImage.src,function(){l.renderAll(),c&&c(l)}),l.backgroundImageOpacity=this.backgroundImageOpacity,l.backgroundImageStretch=this.backgroundImageStretch):c&&c(l)}}),function(c){var a=c.fabric||(c.fabric={}),l=a.util.object.extend,d=a.util.object.clone,r=a.util.toFixed,s=a.util.string.capitalize,u=a.util.degreesToRadians,m=!a.isLikelyNode;a.Object||(a.Object=a.util.createClass(a.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,touchCornerSize:24,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgb(178,204,255)",borderDashArray:null,cornerColor:"rgb(178,204,255)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeDashOffset:0,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,perPixelTargetFind:!1,includeDefaultValues:!0,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:m,statefullCache:!1,noScaleCache:!0,strokeUniform:!1,dirty:!0,__corner:0,paintFirst:"fill",activeOn:"down",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow visible backgroundColor skewX skewY fillRule paintFirst clipPath strokeUniform".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath".split(" "),colorProperties:"fill stroke backgroundColor".split(" "),clipPath:void 0,inverted:!1,absolutePositioned:!1,initialize:function(f){f&&this.setOptions(f)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=a.util.createCanvasElement(),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(f){var g=a.perfLimitSizeTotal,y=f.width,E=f.height,C=a.maxCacheSideLimit,T=a.minCacheSideLimit;if(y<=C&&E<=C&&y*E<=g)return y<T&&(f.width=T),E<T&&(f.height=T),f;var D=y/E,A=a.util.limitDimsByArea(D,g),L=a.util.capValue,U=L(T,A.x,C),G=L(T,A.y,C);return y>U&&(f.zoomX/=y/U,f.width=U,f.capped=!0),E>G&&(f.zoomY/=E/G,f.height=G,f.capped=!0),f},_getCacheCanvasDimensions:function(){var f=this.getTotalObjectScaling(),g=this._getTransformedDimensions(0,0),y=g.x*f.scaleX/this.scaleX,E=g.y*f.scaleY/this.scaleY;return{width:y+2,height:E+2,zoomX:f.scaleX,zoomY:f.scaleY,x:y,y:E}},_updateCacheCanvas:function(){var f=this.canvas;if(this.noScaleCache&&f&&f._currentTransform){var g=f._currentTransform.target,y=f._currentTransform.action;if(this===g&&y.slice&&y.slice(0,5)==="scale")return!1}var E,C,T=this._cacheCanvas,D=this._limitCacheSize(this._getCacheCanvasDimensions()),A=a.minCacheSideLimit,L=D.width,U=D.height,G=D.zoomX,J=D.zoomY,q=L!==this.cacheWidth||U!==this.cacheHeight,X=this.zoomX!==G||this.zoomY!==J,P=q||X,N=0,W=0,K=!1;if(q){var ee=this._cacheCanvas.width,j=this._cacheCanvas.height,k=L>ee||U>j;K=k||(L<.9*ee||U<.9*j)&&ee>A&&j>A,k&&!D.capped&&(L>A||U>A)&&(N=.1*L,W=.1*U)}return this instanceof a.Text&&this.path&&(P=!0,K=!0,N+=this.getHeightOfLine(0)*this.zoomX,W+=this.getHeightOfLine(0)*this.zoomY),!!P&&(K?(T.width=Math.ceil(L+N),T.height=Math.ceil(U+W)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,T.width,T.height)),E=D.x/2,C=D.y/2,this.cacheTranslationX=Math.round(T.width/2-E)+E,this.cacheTranslationY=Math.round(T.height/2-C)+C,this.cacheWidth=L,this.cacheHeight=U,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(G,J),this.zoomX=G,this.zoomY=J,!0)},setOptions:function(f){this._setOptions(f),this._initGradient(f.fill,"fill"),this._initGradient(f.stroke,"stroke"),this._initPattern(f.fill,"fill"),this._initPattern(f.stroke,"stroke")},transform:function(f){var g=this.group&&!this.group._transformDone||this.group&&this.canvas&&f===this.canvas.contextTop,y=this.calcTransformMatrix(!g);f.transform(y[0],y[1],y[2],y[3],y[4],y[5])},toObject:function(f){var g=a.Object.NUM_FRACTION_DIGITS,y={type:this.type,version:a.version,originX:this.originX,originY:this.originY,left:r(this.left,g),top:r(this.top,g),width:r(this.width,g),height:r(this.height,g),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,g),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeDashOffset:this.strokeDashOffset,strokeLineJoin:this.strokeLineJoin,strokeUniform:this.strokeUniform,strokeMiterLimit:r(this.strokeMiterLimit,g),scaleX:r(this.scaleX,g),scaleY:r(this.scaleY,g),angle:r(this.angle,g),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,g),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,skewX:r(this.skewX,g),skewY:r(this.skewY,g)};return this.clipPath&&!this.clipPath.excludeFromExport&&(y.clipPath=this.clipPath.toObject(f),y.clipPath.inverted=this.clipPath.inverted,y.clipPath.absolutePositioned=this.clipPath.absolutePositioned),a.util.populateWithProperties(this,y,f),this.includeDefaultValues||(y=this._removeDefaultValues(y)),y},toDatalessObject:function(f){return this.toObject(f)},_removeDefaultValues:function(f){var g=a.util.getKlass(f.type).prototype;return g.stateProperties.forEach(function(y){y!=="left"&&y!=="top"&&(f[y]===g[y]&&delete f[y],Array.isArray(f[y])&&Array.isArray(g[y])&&f[y].length===0&&g[y].length===0&&delete f[y])}),f},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){if(!this.group)return{scaleX:this.scaleX,scaleY:this.scaleY};var f=a.util.qrDecompose(this.calcTransformMatrix());return{scaleX:Math.abs(f.scaleX),scaleY:Math.abs(f.scaleY)}},getTotalObjectScaling:function(){var f=this.getObjectScaling(),g=f.scaleX,y=f.scaleY;if(this.canvas){var E=this.canvas.getZoom(),C=this.canvas.getRetinaScaling();g*=E*C,y*=E*C}return{scaleX:g,scaleY:y}},getObjectOpacity:function(){var f=this.opacity;return this.group&&(f*=this.group.getObjectOpacity()),f},_set:function(f,g){var y=f==="scaleX"||f==="scaleY",E=this[f]!==g,C=!1;return y&&(g=this._constrainScale(g)),f==="scaleX"&&g<0?(this.flipX=!this.flipX,g*=-1):f==="scaleY"&&g<0?(this.flipY=!this.flipY,g*=-1):f!=="shadow"||!g||g instanceof a.Shadow?f==="dirty"&&this.group&&this.group.set("dirty",g):g=new a.Shadow(g),this[f]=g,E&&(C=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(f)>-1?(this.dirty=!0,C&&this.group.set("dirty",!0)):C&&this.stateProperties.indexOf(f)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:a.iMatrix.concat()},isNotVisible:function(){return this.opacity===0||!this.width&&!this.height&&this.strokeWidth===0||!this.visible},render:function(f){this.isNotVisible()||this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(f.save(),this._setupCompositeOperation(f),this.drawSelectionBackground(f),this.transform(f),this._setOpacity(f),this._setShadow(f,this),this.shouldCache()?(this.renderCache(),this.drawCacheOnCanvas(f)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(f),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),f.restore())},renderCache:function(f){f=f||{},this._cacheCanvas&&this._cacheContext||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext,f.forClipping),this.dirty=!1)},_removeCacheCanvas:function(){this._cacheCanvas=null,this._cacheContext=null,this.cacheWidth=0,this.cacheHeight=0},hasStroke:function(){return this.stroke&&this.stroke!=="transparent"&&this.strokeWidth!==0},hasFill:function(){return this.fill&&this.fill!=="transparent"},needsItsOwnCache:function(){return!(this.paintFirst!=="stroke"||!this.hasFill()||!this.hasStroke()||typeof this.shadow!="object")||!!this.clipPath},shouldCache:function(){return this.ownCaching=this.needsItsOwnCache()||this.objectCaching&&(!this.group||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(this.shadow.offsetX!==0||this.shadow.offsetY!==0)},drawClipPathOnCache:function(f,g){if(f.save(),g.inverted?f.globalCompositeOperation="destination-out":f.globalCompositeOperation="destination-in",g.absolutePositioned){var y=a.util.invertTransform(this.calcTransformMatrix());f.transform(y[0],y[1],y[2],y[3],y[4],y[5])}g.transform(f),f.scale(1/g.zoomX,1/g.zoomY),f.drawImage(g._cacheCanvas,-g.cacheTranslationX,-g.cacheTranslationY),f.restore()},drawObject:function(f,g){var y=this.fill,E=this.stroke;g?(this.fill="black",this.stroke="",this._setClippingProperties(f)):this._renderBackground(f),this._render(f),this._drawClipPath(f,this.clipPath),this.fill=y,this.stroke=E},_drawClipPath:function(f,g){g&&(g.canvas=this.canvas,g.shouldCache(),g._transformDone=!0,g.renderCache({forClipping:!0}),this.drawClipPathOnCache(f,g))},drawCacheOnCanvas:function(f){f.scale(1/this.zoomX,1/this.zoomY),f.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(f){if(this.isNotVisible())return!1;if(this._cacheCanvas&&this._cacheContext&&!f&&this._updateCacheCanvas())return!0;if(this.dirty||this.clipPath&&this.clipPath.absolutePositioned||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&this._cacheContext&&!f){var g=this.cacheWidth/this.zoomX,y=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-g/2,-y/2,g,y)}return!0}return!1},_renderBackground:function(f){if(this.backgroundColor){var g=this._getNonTransformedDimensions();f.fillStyle=this.backgroundColor,f.fillRect(-g.x/2,-g.y/2,g.x,g.y),this._removeShadow(f)}},_setOpacity:function(f){this.group&&!this.group._transformDone?f.globalAlpha=this.getObjectOpacity():f.globalAlpha*=this.opacity},_setStrokeStyles:function(f,g){var y=g.stroke;y&&(f.lineWidth=g.strokeWidth,f.lineCap=g.strokeLineCap,f.lineDashOffset=g.strokeDashOffset,f.lineJoin=g.strokeLineJoin,f.miterLimit=g.strokeMiterLimit,y.toLive?y.gradientUnits==="percentage"||y.gradientTransform||y.patternTransform?this._applyPatternForTransformedGradient(f,y):(f.strokeStyle=y.toLive(f,this),this._applyPatternGradientTransform(f,y)):f.strokeStyle=g.stroke)},_setFillStyles:function(f,g){var y=g.fill;y&&(y.toLive?(f.fillStyle=y.toLive(f,this),this._applyPatternGradientTransform(f,g.fill)):f.fillStyle=y)},_setClippingProperties:function(f){f.globalAlpha=1,f.strokeStyle="transparent",f.fillStyle="#000000"},_setLineDash:function(f,g){g&&g.length!==0&&(1&g.length&&g.push.apply(g,g),f.setLineDash(g))},_renderControls:function(f,g){var y,E,C,T=this.getViewportTransform(),D=this.calcTransformMatrix();E=(g=g||{}).hasBorders!==void 0?g.hasBorders:this.hasBorders,C=g.hasControls!==void 0?g.hasControls:this.hasControls,D=a.util.multiplyTransformMatrices(T,D),y=a.util.qrDecompose(D),f.save(),f.translate(y.translateX,y.translateY),f.lineWidth=1*this.borderScaleFactor,this.group||(f.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),this.flipX&&(y.angle-=180),f.rotate(u(this.group?y.angle:this.angle)),g.forActiveSelection||this.group?E&&this.drawBordersInGroup(f,y,g):E&&this.drawBorders(f,g),C&&this.drawControls(f,g),f.restore()},_setShadow:function(f){if(this.shadow){var g,y=this.shadow,E=this.canvas,C=E&&E.viewportTransform[0]||1,T=E&&E.viewportTransform[3]||1;g=y.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),E&&E._isRetinaScaling()&&(C*=a.devicePixelRatio,T*=a.devicePixelRatio),f.shadowColor=y.color,f.shadowBlur=y.blur*a.browserShadowBlurConstant*(C+T)*(g.scaleX+g.scaleY)/4,f.shadowOffsetX=y.offsetX*C*g.scaleX,f.shadowOffsetY=y.offsetY*T*g.scaleY}},_removeShadow:function(f){this.shadow&&(f.shadowColor="",f.shadowBlur=f.shadowOffsetX=f.shadowOffsetY=0)},_applyPatternGradientTransform:function(f,g){if(!g||!g.toLive)return{offsetX:0,offsetY:0};var y=g.gradientTransform||g.patternTransform,E=-this.width/2+g.offsetX||0,C=-this.height/2+g.offsetY||0;return g.gradientUnits==="percentage"?f.transform(this.width,0,0,this.height,E,C):f.transform(1,0,0,1,E,C),y&&f.transform(y[0],y[1],y[2],y[3],y[4],y[5]),{offsetX:E,offsetY:C}},_renderPaintInOrder:function(f){this.paintFirst==="stroke"?(this._renderStroke(f),this._renderFill(f)):(this._renderFill(f),this._renderStroke(f))},_render:function(){},_renderFill:function(f){this.fill&&(f.save(),this._setFillStyles(f,this),this.fillRule==="evenodd"?f.fill("evenodd"):f.fill(),f.restore())},_renderStroke:function(f){if(this.stroke&&this.strokeWidth!==0){if(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(f),f.save(),this.strokeUniform&&this.group){var g=this.getObjectScaling();f.scale(1/g.scaleX,1/g.scaleY)}else this.strokeUniform&&f.scale(1/this.scaleX,1/this.scaleY);this._setLineDash(f,this.strokeDashArray),this._setStrokeStyles(f,this),f.stroke(),f.restore()}},_applyPatternForTransformedGradient:function(f,g){var y,E=this._limitCacheSize(this._getCacheCanvasDimensions()),C=a.util.createCanvasElement(),T=this.canvas.getRetinaScaling(),D=E.x/this.scaleX/T,A=E.y/this.scaleY/T;C.width=D,C.height=A,(y=C.getContext("2d")).beginPath(),y.moveTo(0,0),y.lineTo(D,0),y.lineTo(D,A),y.lineTo(0,A),y.closePath(),y.translate(D/2,A/2),y.scale(E.zoomX/this.scaleX/T,E.zoomY/this.scaleY/T),this._applyPatternGradientTransform(y,g),y.fillStyle=g.toLive(f),y.fill(),f.translate(-this.width/2-this.strokeWidth/2,-this.height/2-this.strokeWidth/2),f.scale(T*this.scaleX/E.zoomX,T*this.scaleY/E.zoomY),f.strokeStyle=y.createPattern(C,"no-repeat")},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var f=a.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",f.scaleX),this.set("scaleY",f.scaleY),this.angle=f.angle,this.skewX=f.skewX,this.skewY=0}},_removeTransformMatrix:function(f){var g=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),g=a.util.transformPoint(g,this.transformMatrix)),this.transformMatrix=null,f&&(this.scaleX*=f.scaleX,this.scaleY*=f.scaleY,this.cropX=f.cropX,this.cropY=f.cropY,g.x+=f.offsetLeft,g.y+=f.offsetTop,this.width=f.width,this.height=f.height),this.setPositionByOrigin(g,"center","center")},clone:function(f,g){var y=this.toObject(g);this.constructor.fromObject?this.constructor.fromObject(y,f):a.Object._fromObject("Object",y,f)},cloneAsImage:function(f,g){var y=this.toCanvasElement(g);return f&&f(new a.Image(y)),this},toCanvasElement:function(f){f||(f={});var g=a.util,y=g.saveObjectTransform(this),E=this.group,C=this.shadow,T=Math.abs,D=(f.multiplier||1)*(f.enableRetinaScaling?a.devicePixelRatio:1);delete this.group,f.withoutTransform&&g.resetObjectTransform(this),f.withoutShadow&&(this.shadow=null);var A,L,U,G,J=a.util.createCanvasElement(),q=this.getBoundingRect(!0,!0),X=this.shadow,P={x:0,y:0};X&&(L=X.blur,A=X.nonScaling?{scaleX:1,scaleY:1}:this.getObjectScaling(),P.x=2*Math.round(T(X.offsetX)+L)*T(A.scaleX),P.y=2*Math.round(T(X.offsetY)+L)*T(A.scaleY)),U=q.width+P.x,G=q.height+P.y,J.width=Math.ceil(U),J.height=Math.ceil(G);var N=new a.StaticCanvas(J,{enableRetinaScaling:!1,renderOnAddRemove:!1,skipOffscreen:!1});f.format==="jpeg"&&(N.backgroundColor="#fff"),this.setPositionByOrigin(new a.Point(N.width/2,N.height/2),"center","center");var W=this.canvas;N.add(this);var K=N.toCanvasElement(D||1,f);return this.shadow=C,this.set("canvas",W),E&&(this.group=E),this.set(y).setCoords(),N._objects=[],N.dispose(),N=null,K},toDataURL:function(f){return f||(f={}),a.util.toDataURL(this.toCanvasElement(f),f.format||"png",f.quality||1)},isType:function(f){return arguments.length>1?Array.from(arguments).includes(this.type):this.type===f},complexity:function(){return 1},toJSON:function(f){return this.toObject(f)},rotate:function(f){var g=(this.originX!=="center"||this.originY!=="center")&&this.centeredRotation;return g&&this._setOriginToCenter(),this.set("angle",f),g&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(f,g){g=g||this.canvas.getPointer(f);var y=new a.Point(g.x,g.y),E=this._getLeftTopCoords();return this.angle&&(y=a.util.rotatePoint(y,E,u(-this.angle))),{x:y.x-E.x,y:y.y-E.y}},_setupCompositeOperation:function(f){this.globalCompositeOperation&&(f.globalCompositeOperation=this.globalCompositeOperation)},dispose:function(){a.runningAnimations&&a.runningAnimations.cancelByTarget(this)}}),a.util.createAccessors&&a.util.createAccessors(a.Object),l(a.Object.prototype,a.Observable),a.Object.NUM_FRACTION_DIGITS=2,a.Object.ENLIVEN_PROPS=["clipPath"],a.Object._fromObject=function(f,g,y,E){var C=a[f];g=d(g,!0),a.util.enlivenPatterns([g.fill,g.stroke],function(T){T[0]!==void 0&&(g.fill=T[0]),T[1]!==void 0&&(g.stroke=T[1]),a.util.enlivenObjectEnlivables(g,g,function(){var D=E?new C(g[E],g):new C(g);y&&y(D)})})},a.Object.__uid=0)}(e),he=_.util.degreesToRadians,ce={left:-.5,center:0,right:.5},ye={top:-.5,center:0,bottom:.5},_.util.object.extend(_.Object.prototype,{translateToGivenOrigin:function(c,a,l,d,r){var s,u,m,f=c.x,g=c.y;return typeof a=="string"?a=ce[a]:a-=.5,typeof d=="string"?d=ce[d]:d-=.5,typeof l=="string"?l=ye[l]:l-=.5,typeof r=="string"?r=ye[r]:r-=.5,u=r-l,((s=d-a)||u)&&(m=this._getTransformedDimensions(),f=c.x+s*m.x,g=c.y+u*m.y),new _.Point(f,g)},translateToCenterPoint:function(c,a,l){var d=this.translateToGivenOrigin(c,a,l,"center","center");return this.angle?_.util.rotatePoint(d,c,he(this.angle)):d},translateToOriginPoint:function(c,a,l){var d=this.translateToGivenOrigin(c,"center","center",a,l);return this.angle?_.util.rotatePoint(d,c,he(this.angle)):d},getCenterPoint:function(){var c=new _.Point(this.left,this.top);return this.translateToCenterPoint(c,this.originX,this.originY)},getPointByOrigin:function(c,a){var l=this.getCenterPoint();return this.translateToOriginPoint(l,c,a)},toLocalPoint:function(c,a,l){var d,r,s=this.getCenterPoint();return d=a!==void 0&&l!==void 0?this.translateToGivenOrigin(s,"center","center",a,l):new _.Point(this.left,this.top),r=new _.Point(c.x,c.y),this.angle&&(r=_.util.rotatePoint(r,s,-he(this.angle))),r.subtractEquals(d)},setPositionByOrigin:function(c,a,l){var d=this.translateToCenterPoint(c,a,l),r=this.translateToOriginPoint(d,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(c){var a,l,d=he(this.angle),r=this.getScaledWidth(),s=_.util.cos(d)*r,u=_.util.sin(d)*r;a=typeof this.originX=="string"?ce[this.originX]:this.originX-.5,l=typeof c=="string"?ce[c]:c-.5,this.left+=s*(l-a),this.top+=u*(l-a),this.setCoords(),this.originX=c},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var c=this.getCenterPoint();this.originX="center",this.originY="center",this.left=c.x,this.top=c.y},_resetOrigin:function(){var c=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=c.x,this.top=c.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}}),function(){var c=_.util,a=c.degreesToRadians,l=c.multiplyTransformMatrices,d=c.transformPoint;c.object.extend(_.Object.prototype,{oCoords:null,aCoords:null,lineCoords:null,ownMatrixCache:null,matrixCache:null,controls:{},_getCoords:function(r,s){return s?r?this.calcACoords():this.calcLineCoords():(this.aCoords&&this.lineCoords||this.setCoords(!0),r?this.aCoords:this.lineCoords)},getCoords:function(r,s){return u=this._getCoords(r,s),[new _.Point(u.tl.x,u.tl.y),new _.Point(u.tr.x,u.tr.y),new _.Point(u.br.x,u.br.y),new _.Point(u.bl.x,u.bl.y)];var u},intersectsWithRect:function(r,s,u,m){var f=this.getCoords(u,m);return _.Intersection.intersectPolygonRectangle(f,r,s).status==="Intersection"},intersectsWithObject:function(r,s,u){return _.Intersection.intersectPolygonPolygon(this.getCoords(s,u),r.getCoords(s,u)).status==="Intersection"||r.isContainedWithinObject(this,s,u)||this.isContainedWithinObject(r,s,u)},isContainedWithinObject:function(r,s,u){for(var m=this.getCoords(s,u),f=s?r.aCoords:r.lineCoords,g=0,y=r._getImageLines(f);g<4;g++)if(!r.containsPoint(m[g],y))return!1;return!0},isContainedWithinRect:function(r,s,u,m){var f=this.getBoundingRect(u,m);return f.left>=r.x&&f.left+f.width<=s.x&&f.top>=r.y&&f.top+f.height<=s.y},containsPoint:function(r,s,u,m){var f=this._getCoords(u,m),g=(s=s||this._getImageLines(f),this._findCrossPoints(r,s));return g!==0&&g%2==1},isOnScreen:function(r){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,u=this.canvas.vptCoords.br;return!!this.getCoords(!0,r).some(function(m){return m.x<=u.x&&m.x>=s.x&&m.y<=u.y&&m.y>=s.y})||!!this.intersectsWithRect(s,u,!0,r)||this._containsCenterOfCanvas(s,u,r)},_containsCenterOfCanvas:function(r,s,u){var m={x:(r.x+s.x)/2,y:(r.y+s.y)/2};return!!this.containsPoint(m,null,!0,u)},isPartiallyOnScreen:function(r){if(!this.canvas)return!1;var s=this.canvas.vptCoords.tl,u=this.canvas.vptCoords.br;return!!this.intersectsWithRect(s,u,!0,r)||this.getCoords(!0,r).every(function(m){return(m.x>=u.x||m.x<=s.x)&&(m.y>=u.y||m.y<=s.y)})&&this._containsCenterOfCanvas(s,u,r)},_getImageLines:function(r){return{topline:{o:r.tl,d:r.tr},rightline:{o:r.tr,d:r.br},bottomline:{o:r.br,d:r.bl},leftline:{o:r.bl,d:r.tl}}},_findCrossPoints:function(r,s){var u,m,f,g=0;for(var y in s)if(!((f=s[y]).o.y<r.y&&f.d.y<r.y||f.o.y>=r.y&&f.d.y>=r.y||(f.o.x===f.d.x&&f.o.x>=r.x?m=f.o.x:(u=(f.d.y-f.o.y)/(f.d.x-f.o.x),m=-(r.y-0*r.x-(f.o.y-u*f.o.x))/(0-u)),m>=r.x&&(g+=1),g!==2)))break;return g},getBoundingRect:function(r,s){var u=this.getCoords(r,s);return c.makeBoundingBoxFromPoints(u)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(r){return Math.abs(r)<this.minScaleLimit?r<0?-this.minScaleLimit:this.minScaleLimit:r===0?1e-4:r},scale:function(r){return this._set("scaleX",r),this._set("scaleY",r),this.setCoords()},scaleToWidth:function(r,s){var u=this.getBoundingRect(s).width/this.getScaledWidth();return this.scale(r/this.width/u)},scaleToHeight:function(r,s){var u=this.getBoundingRect(s).height/this.getScaledHeight();return this.scale(r/this.height/u)},calcLineCoords:function(){var r=this.getViewportTransform(),s=this.padding,u=a(this.angle),m=c.cos(u)*s,f=c.sin(u)*s,g=m+f,y=m-f,E=this.calcACoords(),C={tl:d(E.tl,r),tr:d(E.tr,r),bl:d(E.bl,r),br:d(E.br,r)};return s&&(C.tl.x-=y,C.tl.y-=g,C.tr.x+=g,C.tr.y-=y,C.bl.x-=g,C.bl.y+=y,C.br.x+=y,C.br.y+=g),C},calcOCoords:function(){var r=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),u=this.getViewportTransform(),m=l(u,s),f=l(m,r),g=(f=l(f,[1/u[0],0,0,1/u[3],0,0]),this._calculateCurrentDimensions()),y={};return this.forEachControl(function(E,C,T){y[C]=E.positionHandler(g,f,T)}),y},calcACoords:function(){var r=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),u=l(s,r),m=this._getTransformedDimensions(),f=m.x/2,g=m.y/2;return{tl:d({x:-f,y:-g},u),tr:d({x:f,y:-g},u),bl:d({x:-f,y:g},u),br:d({x:f,y:g},u)}},setCoords:function(r){return this.aCoords=this.calcACoords(),this.lineCoords=this.group?this.aCoords:this.calcLineCoords(),r||(this.oCoords=this.calcOCoords(),this._setCornerCoords&&this._setCornerCoords()),this},_calcRotateMatrix:function(){return c.calcRotateMatrix(this)},_calcTranslateMatrix:function(){var r=this.getCenterPoint();return[1,0,0,1,r.x,r.y]},transformMatrixKey:function(r){var s="_",u="";return!r&&this.group&&(u=this.group.transformMatrixKey(r)+s),u+this.top+s+this.left+s+this.scaleX+s+this.scaleY+s+this.skewX+s+this.skewY+s+this.angle+s+this.originX+s+this.originY+s+this.width+s+this.height+s+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(r){var s=this.calcOwnMatrix();if(r||!this.group)return s;var u=this.transformMatrixKey(r),m=this.matrixCache||(this.matrixCache={});return m.key===u?m.value:(this.group&&(s=l(this.group.calcTransformMatrix(!1),s)),m.key=u,m.value=s,s)},calcOwnMatrix:function(){var r=this.transformMatrixKey(!0),s=this.ownMatrixCache||(this.ownMatrixCache={});if(s.key===r)return s.value;var u=this._calcTranslateMatrix(),m={angle:this.angle,translateX:u[4],translateY:u[5],scaleX:this.scaleX,scaleY:this.scaleY,skewX:this.skewX,skewY:this.skewY,flipX:this.flipX,flipY:this.flipY};return s.key=r,s.value=c.composeMatrix(m),s.value},_getNonTransformedDimensions:function(){var r=this.strokeWidth;return{x:this.width+r,y:this.height+r}},_getTransformedDimensions:function(r,s){r===void 0&&(r=this.skewX),s===void 0&&(s=this.skewY);var u,m,f,g=r===0&&s===0;if(this.strokeUniform?(m=this.width,f=this.height):(m=(u=this._getNonTransformedDimensions()).x,f=u.y),g)return this._finalizeDimensions(m*this.scaleX,f*this.scaleY);var y=c.sizeAfterTransform(m,f,{scaleX:this.scaleX,scaleY:this.scaleY,skewX:r,skewY:s});return this._finalizeDimensions(y.x,y.y)},_finalizeDimensions:function(r,s){return this.strokeUniform?{x:r+this.strokeWidth,y:s+this.strokeWidth}:{x:r,y:s}},_calculateCurrentDimensions:function(){var r=this.getViewportTransform(),s=this._getTransformedDimensions();return d(s,r,!0).scalarAdd(2*this.padding)}})}(),_.util.object.extend(_.Object.prototype,{sendToBack:function(){return this.group?_.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas&&this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?_.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas&&this.canvas.bringToFront(this),this},sendBackwards:function(c){return this.group?_.StaticCanvas.prototype.sendBackwards.call(this.group,this,c):this.canvas&&this.canvas.sendBackwards(this,c),this},bringForward:function(c){return this.group?_.StaticCanvas.prototype.bringForward.call(this.group,this,c):this.canvas&&this.canvas.bringForward(this,c),this},moveTo:function(c){return this.group&&this.group.type!=="activeSelection"?_.StaticCanvas.prototype.moveTo.call(this.group,this,c):this.canvas&&this.canvas.moveTo(this,c),this}}),function(){function c(l,d){if(d){if(d.toLive)return l+": url(#SVGID_"+d.id+"); ";var r=new _.Color(d),s=l+": "+r.toRgb()+"; ",u=r.getAlpha();return u!==1&&(s+=l+"-opacity: "+u.toString()+"; "),s}return l+": none; "}var a=_.util.toFixed;_.util.object.extend(_.Object.prototype,{getSvgStyles:function(l){var d=this.fillRule?this.fillRule:"nonzero",r=this.strokeWidth?this.strokeWidth:"0",s=this.strokeDashArray?this.strokeDashArray.join(" "):"none",u=this.strokeDashOffset?this.strokeDashOffset:"0",m=this.strokeLineCap?this.strokeLineCap:"butt",f=this.strokeLineJoin?this.strokeLineJoin:"miter",g=this.strokeMiterLimit?this.strokeMiterLimit:"4",y=this.opacity!==void 0?this.opacity:"1",E=this.visible?"":" visibility: hidden;",C=l?"":this.getSvgFilter(),T=c("fill",this.fill);return[c("stroke",this.stroke),"stroke-width: ",r,"; ","stroke-dasharray: ",s,"; ","stroke-linecap: ",m,"; ","stroke-dashoffset: ",u,"; ","stroke-linejoin: ",f,"; ","stroke-miterlimit: ",g,"; ",T,"fill-rule: ",d,"; ","opacity: ",y,";",C,E].join("")},getSvgSpanStyles:function(l,d){var r="; ",s=l.fontFamily?"font-family: "+(l.fontFamily.indexOf("'")===-1&&l.fontFamily.indexOf('"')===-1?"'"+l.fontFamily+"'":l.fontFamily)+r:"",u=l.strokeWidth?"stroke-width: "+l.strokeWidth+r:"",m=l.fontSize?"font-size: "+l.fontSize+"px"+r:"",f=l.fontStyle?"font-style: "+l.fontStyle+r:"",g=l.fontWeight?"font-weight: "+l.fontWeight+r:"",y=l.fill?c("fill",l.fill):"",E=l.stroke?c("stroke",l.stroke):"",C=this.getSvgTextDecoration(l);return C&&(C="text-decoration: "+C+r),[E,u,s,m,f,g,C,y,l.deltaY?"baseline-shift: "+-l.deltaY+"; ":"",d?"white-space: pre; ":""].join("")},getSvgTextDecoration:function(l){return["overline","underline","line-through"].filter(function(d){return l[d.replace("-","")]}).join(" ")},getSvgFilter:function(){return this.shadow?"filter: url(#SVGID_"+this.shadow.id+");":""},getSvgCommons:function(){return[this.id?'id="'+this.id+'" ':"",this.clipPath?'clip-path="url(#'+this.clipPath.clipPathId+')" ':""].join("")},getSvgTransform:function(l,d){var r=l?this.calcTransformMatrix():this.calcOwnMatrix();return'transform="'+_.util.matrixToSVG(r)+(d||"")+'" '},_setSVGBg:function(l){if(this.backgroundColor){var d=_.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(this.backgroundColor),' x="',a(-this.width/2,d),'" y="',a(-this.height/2,d),'" width="',a(this.width,d),'" height="',a(this.height,d),`"></rect>
`)}},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(l),{reviver:l})},toClipPathSVG:function(l){return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(l),{reviver:l})},_createBaseClipPathSVGMarkup:function(l,d){var r=(d=d||{}).reviver,s=d.additionalTransform||"",u=[this.getSvgTransform(!0,s),this.getSvgCommons()].join(""),m=l.indexOf("COMMON_PARTS");return l[m]=u,r?r(l.join("")):l.join("")},_createBaseSVGMarkup:function(l,d){var r,s,u=(d=d||{}).noStyle,m=d.reviver,f=u?"":'style="'+this.getSvgStyles()+'" ',g=d.withShadow?'style="'+this.getSvgFilter()+'" ':"",y=this.clipPath,E=this.strokeUniform?'vector-effect="non-scaling-stroke" ':"",C=y&&y.absolutePositioned,T=this.stroke,D=this.fill,A=this.shadow,L=[],U=l.indexOf("COMMON_PARTS"),G=d.additionalTransform;return y&&(y.clipPathId="CLIPPATH_"+_.Object.__uid++,s='<clipPath id="'+y.clipPathId+`" >
`+y.toClipPathSVG(m)+`</clipPath>
`),C&&L.push("<g ",g,this.getSvgCommons(),` >
`),L.push("<g ",this.getSvgTransform(!1),C?"":g+this.getSvgCommons(),` >
`),r=[f,E,u?"":this.addPaintOrder()," ",G?'transform="'+G+'" ':""].join(""),l[U]=r,D&&D.toLive&&L.push(D.toSVG(this)),T&&T.toLive&&L.push(T.toSVG(this)),A&&L.push(A.toSVG(this)),y&&L.push(s),L.push(l.join("")),L.push(`</g>
`),C&&L.push(`</g>
`),m?m(L.join("")):L.join("")},addPaintOrder:function(){return this.paintFirst!=="fill"?' paint-order="'+this.paintFirst+'" ':""}})}(),function(){var c=_.util.object.extend,a="stateProperties";function l(r,s,u){var m={};u.forEach(function(f){m[f]=r[f]}),c(r[s],m,!0)}function d(r,s,u){if(r===s)return!0;if(Array.isArray(r)){if(!Array.isArray(s)||r.length!==s.length)return!1;for(var m=0,f=r.length;m<f;m++)if(!d(r[m],s[m]))return!1;return!0}if(r&&typeof r=="object"){var g,y=Object.keys(r);if(!s||typeof s!="object"||!u&&y.length!==Object.keys(s).length)return!1;for(m=0,f=y.length;m<f;m++)if((g=y[m])!=="canvas"&&g!=="group"&&!d(r[g],s[g]))return!1;return!0}}_.util.object.extend(_.Object.prototype,{hasStateChanged:function(r){var s="_"+(r=r||a);return Object.keys(this[s]).length<this[r].length||!d(this[s],this,!0)},saveState:function(r){var s=r&&r.propertySet||a,u="_"+s;return this[u]?(l(this,u,this[s]),r&&r.stateProperties&&l(this,u,r.stateProperties),this):this.setupState(r)},setupState:function(r){var s=(r=r||{}).propertySet||a;return r.propertySet=s,this["_"+s]={},this.saveState(r),this}})}(),function(){var c=_.util.degreesToRadians;_.util.object.extend(_.Object.prototype,{_findTargetCorner:function(a,l){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var d,r,s,u=a.x,m=a.y,f=Object.keys(this.oCoords),g=f.length-1;for(this.__corner=0;g>=0;g--)if(s=f[g],this.isControlVisible(s)&&(r=this._getImageLines(l?this.oCoords[s].touchCorner:this.oCoords[s].corner),(d=this._findCrossPoints({x:u,y:m},r))!==0&&d%2==1))return this.__corner=s,s;return!1},forEachControl:function(a){for(var l in this.controls)a(this.controls[l],l,this)},_setCornerCoords:function(){var a=this.oCoords;for(var l in a){var d=this.controls[l];a[l].corner=d.calcCornerCoords(this.angle,this.cornerSize,a[l].x,a[l].y,!1),a[l].touchCorner=d.calcCornerCoords(this.angle,this.touchCornerSize,a[l].x,a[l].y,!0)}},drawSelectionBackground:function(a){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;a.save();var l=this.getCenterPoint(),d=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return a.translate(l.x,l.y),a.scale(1/r[0],1/r[3]),a.rotate(c(this.angle)),a.fillStyle=this.selectionBackgroundColor,a.fillRect(-d.x/2,-d.y/2,d.x,d.y),a.restore(),this},drawBorders:function(a,l){l=l||{};var d=this._calculateCurrentDimensions(),r=this.borderScaleFactor,s=d.x+r,u=d.y+r,m=l.hasControls!==void 0?l.hasControls:this.hasControls,f=!1;return a.save(),a.strokeStyle=l.borderColor||this.borderColor,this._setLineDash(a,l.borderDashArray||this.borderDashArray),a.strokeRect(-s/2,-u/2,s,u),m&&(a.beginPath(),this.forEachControl(function(g,y,E){g.withConnection&&g.getVisibility(E,y)&&(f=!0,a.moveTo(g.x*s,g.y*u),a.lineTo(g.x*s+g.offsetX,g.y*u+g.offsetY))}),f&&a.stroke()),a.restore(),this},drawBordersInGroup:function(a,l,d){d=d||{};var r=_.util.sizeAfterTransform(this.width,this.height,l),s=this.strokeWidth,u=this.strokeUniform,m=this.borderScaleFactor,f=r.x+s*(u?this.canvas.getZoom():l.scaleX)+m,g=r.y+s*(u?this.canvas.getZoom():l.scaleY)+m;return a.save(),this._setLineDash(a,d.borderDashArray||this.borderDashArray),a.strokeStyle=d.borderColor||this.borderColor,a.strokeRect(-f/2,-g/2,f,g),a.restore(),this},drawControls:function(a,l){l=l||{},a.save();var d,r,s=this.canvas.getRetinaScaling();return a.setTransform(s,0,0,s,0,0),a.strokeStyle=a.fillStyle=l.cornerColor||this.cornerColor,this.transparentCorners||(a.strokeStyle=l.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(a,l.cornerDashArray||this.cornerDashArray),this.setCoords(),this.group&&(d=this.group.calcTransformMatrix()),this.forEachControl(function(u,m,f){r=f.oCoords[m],u.getVisibility(f,m)&&(d&&(r=_.util.transformPoint(r,d)),u.render(a,r.x,r.y,l,f))}),a.restore(),this},isControlVisible:function(a){return this.controls[a]&&this.controls[a].getVisibility(this,a)},setControlVisible:function(a,l){return this._controlsVisibility||(this._controlsVisibility={}),this._controlsVisibility[a]=l,this},setControlsVisibility:function(a){for(var l in a||(a={}),a)this.setControlVisible(l,a[l]);return this},onDeselect:function(){},onSelect:function(){}})}(),_.util.object.extend(_.StaticCanvas.prototype,{FX_DURATION:500,fxCenterObjectH:function(c,a){var l=function(){},d=(a=a||{}).onComplete||l,r=a.onChange||l,s=this;return _.util.animate({target:this,startValue:c.left,endValue:this.getCenterPoint().x,duration:this.FX_DURATION,onChange:function(u){c.set("left",u),s.requestRenderAll(),r()},onComplete:function(){c.setCoords(),d()}})},fxCenterObjectV:function(c,a){var l=function(){},d=(a=a||{}).onComplete||l,r=a.onChange||l,s=this;return _.util.animate({target:this,startValue:c.top,endValue:this.getCenterPoint().y,duration:this.FX_DURATION,onChange:function(u){c.set("top",u),s.requestRenderAll(),r()},onComplete:function(){c.setCoords(),d()}})},fxRemove:function(c,a){var l=function(){},d=(a=a||{}).onComplete||l,r=a.onChange||l,s=this;return _.util.animate({target:this,startValue:c.opacity,endValue:0,duration:this.FX_DURATION,onChange:function(u){c.set("opacity",u),s.requestRenderAll(),r()},onComplete:function(){s.remove(c),d()}})}}),_.util.object.extend(_.Object.prototype,{animate:function(){if(arguments[0]&&typeof arguments[0]=="object"){var c,a,l=[],d=[];for(c in arguments[0])l.push(c);for(var r=0,s=l.length;r<s;r++)c=l[r],a=r!==s-1,d.push(this._animate(c,arguments[0][c],arguments[1],a));return d}return this._animate.apply(this,arguments)},_animate:function(c,a,l,d){var r,s=this;a=a.toString(),l=l?_.util.object.clone(l):{},~c.indexOf(".")&&(r=c.split("."));var u=s.colorProperties.indexOf(c)>-1||r&&s.colorProperties.indexOf(r[1])>-1,m=r?this.get(r[0])[r[1]]:this.get(c);"from"in l||(l.from=m),u||(a=~a.indexOf("=")?m+parseFloat(a.replace("=","")):parseFloat(a));var f={target:this,startValue:l.from,endValue:a,byValue:l.by,easing:l.easing,duration:l.duration,abort:l.abort&&function(g,y,E){return l.abort.call(s,g,y,E)},onChange:function(g,y,E){r?s[r[0]][r[1]]=g:s.set(c,g),d||l.onChange&&l.onChange(g,y,E)},onComplete:function(g,y,E){d||(s.setCoords(),l.onComplete&&l.onComplete(g,y,E))}};return u?_.util.animateColor(f.startValue,f.endValue,f.duration,f):_.util.animate(f)}}),function(c){var a=c.fabric||(c.fabric={}),l=a.util.object.extend,d=a.util.object.clone,r={x1:1,x2:1,y1:1,y2:1};function s(u,m){var f=u.origin,g=u.axis1,y=u.axis2,E=u.dimension,C=m.nearest,T=m.center,D=m.farthest;return function(){switch(this.get(f)){case C:return Math.min(this.get(g),this.get(y));case T:return Math.min(this.get(g),this.get(y))+.5*this.get(E);case D:return Math.max(this.get(g),this.get(y))}}}a.Line?a.warn("fabric.Line is already defined"):(a.Line=a.util.createClass(a.Object,{type:"line",x1:0,y1:0,x2:0,y2:0,cacheProperties:a.Object.prototype.cacheProperties.concat("x1","x2","y1","y2"),initialize:function(u,m){u||(u=[0,0,0,0]),this.callSuper("initialize",m),this.set("x1",u[0]),this.set("y1",u[1]),this.set("x2",u[2]),this.set("y2",u[3]),this._setWidthHeight(m)},_setWidthHeight:function(u){u||(u={}),this.width=Math.abs(this.x2-this.x1),this.height=Math.abs(this.y2-this.y1),this.left="left"in u?u.left:this._getLeftToOriginX(),this.top="top"in u?u.top:this._getTopToOriginY()},_set:function(u,m){return this.callSuper("_set",u,m),r[u]!==void 0&&this._setWidthHeight(),this},_getLeftToOriginX:s({origin:"originX",axis1:"x1",axis2:"x2",dimension:"width"},{nearest:"left",center:"center",farthest:"right"}),_getTopToOriginY:s({origin:"originY",axis1:"y1",axis2:"y2",dimension:"height"},{nearest:"top",center:"center",farthest:"bottom"}),_render:function(u){u.beginPath();var m=this.calcLinePoints();u.moveTo(m.x1,m.y1),u.lineTo(m.x2,m.y2),u.lineWidth=this.strokeWidth;var f=u.strokeStyle;u.strokeStyle=this.stroke||u.fillStyle,this.stroke&&this._renderStroke(u),u.strokeStyle=f},_findCenterFromElement:function(){return{x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2}},toObject:function(u){return l(this.callSuper("toObject",u),this.calcLinePoints())},_getNonTransformedDimensions:function(){var u=this.callSuper("_getNonTransformedDimensions");return this.strokeLineCap==="butt"&&(this.width===0&&(u.y-=this.strokeWidth),this.height===0&&(u.x-=this.strokeWidth)),u},calcLinePoints:function(){var u=this.x1<=this.x2?-1:1,m=this.y1<=this.y2?-1:1,f=u*this.width*.5,g=m*this.height*.5;return{x1:f,x2:u*this.width*-.5,y1:g,y2:m*this.height*-.5}},_toSVG:function(){var u=this.calcLinePoints();return["<line ","COMMON_PARTS",'x1="',u.x1,'" y1="',u.y1,'" x2="',u.x2,'" y2="',u.y2,`" />
`]}}),a.Line.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x1 y1 x2 y2".split(" ")),a.Line.fromElement=function(u,m,f){f=f||{};var g=a.parseAttributes(u,a.Line.ATTRIBUTE_NAMES),y=[g.x1||0,g.y1||0,g.x2||0,g.y2||0];m(new a.Line(y,l(g,f)))},a.Line.fromObject=function(u,m){var f=d(u,!0);f.points=[u.x1,u.y1,u.x2,u.y2],a.Object._fromObject("Line",f,function(g){delete g.points,m&&m(g)},"points")})}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.degreesToRadians;a.Circle?a.warn("fabric.Circle is already defined."):(a.Circle=a.util.createClass(a.Object,{type:"circle",radius:0,startAngle:0,endAngle:360,cacheProperties:a.Object.prototype.cacheProperties.concat("radius","startAngle","endAngle"),_set:function(d,r){return this.callSuper("_set",d,r),d==="radius"&&this.setRadius(r),this},toObject:function(d){return this.callSuper("toObject",["radius","startAngle","endAngle"].concat(d))},_toSVG:function(){var d,r=(this.endAngle-this.startAngle)%360;if(r===0)d=["<circle ","COMMON_PARTS",'cx="0" cy="0" ','r="',this.radius,`" />
`];else{var s=l(this.startAngle),u=l(this.endAngle),m=this.radius;d=['<path d="M '+a.util.cos(s)*m+" "+a.util.sin(s)*m," A "+m+" "+m," 0 ",+(r>180?"1":"0")+" 1"," "+a.util.cos(u)*m+" "+a.util.sin(u)*m,'" ',"COMMON_PARTS",` />
`]}return d},_render:function(d){d.beginPath(),d.arc(0,0,this.radius,l(this.startAngle),l(this.endAngle),!1),this._renderPaintInOrder(d)},getRadiusX:function(){return this.get("radius")*this.get("scaleX")},getRadiusY:function(){return this.get("radius")*this.get("scaleY")},setRadius:function(d){return this.radius=d,this.set("width",2*d).set("height",2*d)}}),a.Circle.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy r".split(" ")),a.Circle.fromElement=function(d,r){var s,u=a.parseAttributes(d,a.Circle.ATTRIBUTE_NAMES);if(!("radius"in(s=u)&&s.radius>=0))throw new Error("value of `r` attribute is required and can not be negative");u.left=(u.left||0)-u.radius,u.top=(u.top||0)-u.radius,r(new a.Circle(u))},a.Circle.fromObject=function(d,r){a.Object._fromObject("Circle",d,r)})}(e),function(c){var a=c.fabric||(c.fabric={});a.Triangle?a.warn("fabric.Triangle is already defined"):(a.Triangle=a.util.createClass(a.Object,{type:"triangle",width:100,height:100,_render:function(l){var d=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-d,r),l.lineTo(0,-r),l.lineTo(d,r),l.closePath(),this._renderPaintInOrder(l)},_toSVG:function(){var l=this.width/2,d=this.height/2;return["<polygon ","COMMON_PARTS",'points="',[-l+" "+d,"0 "+-d,l+" "+d].join(","),'" />']}}),a.Triangle.fromObject=function(l,d){return a.Object._fromObject("Triangle",l,d)})}(e),function(c){var a=c.fabric||(c.fabric={}),l=2*Math.PI;a.Ellipse?a.warn("fabric.Ellipse is already defined."):(a.Ellipse=a.util.createClass(a.Object,{type:"ellipse",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d),this.set("rx",d&&d.rx||0),this.set("ry",d&&d.ry||0)},_set:function(d,r){switch(this.callSuper("_set",d,r),d){case"rx":this.rx=r,this.set("width",2*r);break;case"ry":this.ry=r,this.set("height",2*r)}return this},getRx:function(){return this.get("rx")*this.get("scaleX")},getRy:function(){return this.get("ry")*this.get("scaleY")},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){return["<ellipse ","COMMON_PARTS",'cx="0" cy="0" ','rx="',this.rx,'" ry="',this.ry,`" />
`]},_render:function(d){d.beginPath(),d.save(),d.transform(1,0,0,this.ry/this.rx,0,0),d.arc(0,0,this.rx,0,l,!1),d.restore(),this._renderPaintInOrder(d)}}),a.Ellipse.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("cx cy rx ry".split(" ")),a.Ellipse.fromElement=function(d,r){var s=a.parseAttributes(d,a.Ellipse.ATTRIBUTE_NAMES);s.left=(s.left||0)-s.rx,s.top=(s.top||0)-s.ry,r(new a.Ellipse(s))},a.Ellipse.fromObject=function(d,r){a.Object._fromObject("Ellipse",d,r)})}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.object.extend;a.Rect?a.warn("fabric.Rect is already defined"):(a.Rect=a.util.createClass(a.Object,{stateProperties:a.Object.prototype.stateProperties.concat("rx","ry"),type:"rect",rx:0,ry:0,cacheProperties:a.Object.prototype.cacheProperties.concat("rx","ry"),initialize:function(d){this.callSuper("initialize",d),this._initRxRy()},_initRxRy:function(){this.rx&&!this.ry?this.ry=this.rx:this.ry&&!this.rx&&(this.rx=this.ry)},_render:function(d){var r=this.rx?Math.min(this.rx,this.width/2):0,s=this.ry?Math.min(this.ry,this.height/2):0,u=this.width,m=this.height,f=-this.width/2,g=-this.height/2,y=r!==0||s!==0,E=.4477152502;d.beginPath(),d.moveTo(f+r,g),d.lineTo(f+u-r,g),y&&d.bezierCurveTo(f+u-E*r,g,f+u,g+E*s,f+u,g+s),d.lineTo(f+u,g+m-s),y&&d.bezierCurveTo(f+u,g+m-E*s,f+u-E*r,g+m,f+u-r,g+m),d.lineTo(f+r,g+m),y&&d.bezierCurveTo(f+E*r,g+m,f,g+m-E*s,f,g+m-s),d.lineTo(f,g+s),y&&d.bezierCurveTo(f,g+E*s,f+E*r,g,f+r,g),d.closePath(),this._renderPaintInOrder(d)},toObject:function(d){return this.callSuper("toObject",["rx","ry"].concat(d))},_toSVG:function(){return["<rect ","COMMON_PARTS",'x="',-this.width/2,'" y="',-this.height/2,'" rx="',this.rx,'" ry="',this.ry,'" width="',this.width,'" height="',this.height,`" />
`]}}),a.Rect.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y rx ry width height".split(" ")),a.Rect.fromElement=function(d,r,s){if(!d)return r(null);s=s||{};var u=a.parseAttributes(d,a.Rect.ATTRIBUTE_NAMES);u.left=u.left||0,u.top=u.top||0,u.height=u.height||0,u.width=u.width||0;var m=new a.Rect(l(s?a.util.object.clone(s):{},u));m.visible=m.visible&&m.width>0&&m.height>0,r(m)},a.Rect.fromObject=function(d,r){return a.Object._fromObject("Rect",d,r)})}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.object.extend,d=a.util.array.min,r=a.util.array.max,s=a.util.toFixed,u=a.util.projectStrokeOnPoints;a.Polyline?a.warn("fabric.Polyline is already defined"):(a.Polyline=a.util.createClass(a.Object,{type:"polyline",points:null,exactBoundingBox:!1,cacheProperties:a.Object.prototype.cacheProperties.concat("points"),initialize:function(m,f){f=f||{},this.points=m||[],this.callSuper("initialize",f),this._setPositionDimensions(f)},_projectStrokeOnPoints:function(){return u(this.points,this,!0)},_setPositionDimensions:function(m){var f,g=this._calcDimensions(m),y=this.exactBoundingBox?this.strokeWidth:0;this.width=g.width-y,this.height=g.height-y,m.fromSVG||(f=this.translateToGivenOrigin({x:g.left-this.strokeWidth/2+y/2,y:g.top-this.strokeWidth/2+y/2},"left","top",this.originX,this.originY)),m.left===void 0&&(this.left=m.fromSVG?g.left:f.x),m.top===void 0&&(this.top=m.fromSVG?g.top:f.y),this.pathOffset={x:g.left+this.width/2+y/2,y:g.top+this.height/2+y/2}},_calcDimensions:function(){var m=this.exactBoundingBox?this._projectStrokeOnPoints():this.points,f=d(m,"x")||0,g=d(m,"y")||0;return{left:f,top:g,width:(r(m,"x")||0)-f,height:(r(m,"y")||0)-g}},toObject:function(m){return l(this.callSuper("toObject",m),{points:this.points.concat()})},_toSVG:function(){for(var m=[],f=this.pathOffset.x,g=this.pathOffset.y,y=a.Object.NUM_FRACTION_DIGITS,E=0,C=this.points.length;E<C;E++)m.push(s(this.points[E].x-f,y),",",s(this.points[E].y-g,y)," ");return["<"+this.type+" ","COMMON_PARTS",'points="',m.join(""),`" />
`]},commonRender:function(m){var f,g=this.points.length,y=this.pathOffset.x,E=this.pathOffset.y;if(!g||isNaN(this.points[g-1].y))return!1;m.beginPath(),m.moveTo(this.points[0].x-y,this.points[0].y-E);for(var C=0;C<g;C++)f=this.points[C],m.lineTo(f.x-y,f.y-E);return!0},_render:function(m){this.commonRender(m)&&this._renderPaintInOrder(m)},complexity:function(){return this.get("points").length}}),a.Polyline.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polyline.fromElementGenerator=function(m){return function(f,g,y){if(!f)return g(null);y||(y={});var E=a.parsePointsAttribute(f.getAttribute("points")),C=a.parseAttributes(f,a[m].ATTRIBUTE_NAMES);C.fromSVG=!0,g(new a[m](E,l(C,y)))}},a.Polyline.fromElement=a.Polyline.fromElementGenerator("Polyline"),a.Polyline.fromObject=function(m,f){return a.Object._fromObject("Polyline",m,f,"points")})}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.projectStrokeOnPoints;a.Polygon?a.warn("fabric.Polygon is already defined"):(a.Polygon=a.util.createClass(a.Polyline,{type:"polygon",_projectStrokeOnPoints:function(){return l(this.points,this)},_render:function(d){this.commonRender(d)&&(d.closePath(),this._renderPaintInOrder(d))}}),a.Polygon.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(),a.Polygon.fromElement=a.Polyline.fromElementGenerator("Polygon"),a.Polygon.fromObject=function(d,r){a.Object._fromObject("Polygon",d,r,"points")})}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.array.min,d=a.util.array.max,r=a.util.object.extend,s=a.util.object.clone,u=a.util.toFixed;a.Path?a.warn("fabric.Path is already defined"):(a.Path=a.util.createClass(a.Object,{type:"path",path:null,cacheProperties:a.Object.prototype.cacheProperties.concat("path","fillRule"),stateProperties:a.Object.prototype.stateProperties.concat("path"),initialize:function(m,f){delete(f=s(f||{})).path,this.callSuper("initialize",f),this._setPath(m||[],f)},_setPath:function(m,f){this.path=a.util.makePathSimpler(Array.isArray(m)?m:a.util.parsePath(m)),a.Polyline.prototype._setPositionDimensions.call(this,f||{})},_renderPathCommands:function(m){var f,g=0,y=0,E=0,C=0,T=0,D=0,A=-this.pathOffset.x,L=-this.pathOffset.y;m.beginPath();for(var U=0,G=this.path.length;U<G;++U)switch((f=this.path[U])[0]){case"L":E=f[1],C=f[2],m.lineTo(E+A,C+L);break;case"M":g=E=f[1],y=C=f[2],m.moveTo(E+A,C+L);break;case"C":E=f[5],C=f[6],T=f[3],D=f[4],m.bezierCurveTo(f[1]+A,f[2]+L,T+A,D+L,E+A,C+L);break;case"Q":m.quadraticCurveTo(f[1]+A,f[2]+L,f[3]+A,f[4]+L),E=f[3],C=f[4],T=f[1],D=f[2];break;case"z":case"Z":E=g,C=y,m.closePath()}},_render:function(m){this._renderPathCommands(m),this._renderPaintInOrder(m)},toString:function(){return"#<fabric.Path ("+this.complexity()+'): { "top": '+this.top+', "left": '+this.left+" }>"},toObject:function(m){return r(this.callSuper("toObject",m),{path:this.path.map(function(f){return f.slice()})})},toDatalessObject:function(m){var f=this.toObject(["sourcePath"].concat(m));return f.sourcePath&&delete f.path,f},_toSVG:function(){return["<path ","COMMON_PARTS",'d="',a.util.joinPath(this.path),'" stroke-linecap="round" ',`/>
`]},_getOffsetTransform:function(){var m=a.Object.NUM_FRACTION_DIGITS;return" translate("+u(-this.pathOffset.x,m)+", "+u(-this.pathOffset.y,m)+")"},toClipPathSVG:function(m){var f=this._getOffsetTransform();return"	"+this._createBaseClipPathSVGMarkup(this._toSVG(),{reviver:m,additionalTransform:f})},toSVG:function(m){var f=this._getOffsetTransform();return this._createBaseSVGMarkup(this._toSVG(),{reviver:m,additionalTransform:f})},complexity:function(){return this.path.length},_calcDimensions:function(){for(var m,f,g=[],y=[],E=0,C=0,T=0,D=0,A=0,L=this.path.length;A<L;++A){switch((m=this.path[A])[0]){case"L":T=m[1],D=m[2],f=[];break;case"M":E=T=m[1],C=D=m[2],f=[];break;case"C":f=a.util.getBoundsOfCurve(T,D,m[1],m[2],m[3],m[4],m[5],m[6]),T=m[5],D=m[6];break;case"Q":f=a.util.getBoundsOfCurve(T,D,m[1],m[2],m[1],m[2],m[3],m[4]),T=m[3],D=m[4];break;case"z":case"Z":T=E,D=C}f.forEach(function(J){g.push(J.x),y.push(J.y)}),g.push(T),y.push(D)}var U=l(g)||0,G=l(y)||0;return{left:U,top:G,width:(d(g)||0)-U,height:(d(y)||0)-G}}}),a.Path.fromObject=function(m,f){if(typeof m.sourcePath=="string"){var g=m.sourcePath;a.loadSVGFromURL(g,function(y){var E=y[0];E.setOptions(m),f&&f(E)})}else a.Object._fromObject("Path",m,f,"path")},a.Path.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat(["d"]),a.Path.fromElement=function(m,f,g){var y=a.parseAttributes(m,a.Path.ATTRIBUTE_NAMES);y.fromSVG=!0,f(new a.Path(y.d,r(y,g)))})}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.array.min,d=a.util.array.max;a.Group||(a.Group=a.util.createClass(a.Object,a.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(r,s,u){s=s||{},this._objects=[],u&&this.callSuper("initialize",s),this._objects=r||[];for(var m=this._objects.length;m--;)this._objects[m].group=this;if(u)this._updateObjectsACoords();else{var f=s&&s.centerPoint;s.originX!==void 0&&(this.originX=s.originX),s.originY!==void 0&&(this.originY=s.originY),f||this._calcBounds(),this._updateObjectsCoords(f),delete s.centerPoint,this.callSuper("initialize",s)}this.setCoords()},_updateObjectsACoords:function(){for(var r=this._objects.length;r--;)this._objects[r].setCoords(!0)},_updateObjectsCoords:function(r){r=r||this.getCenterPoint();for(var s=this._objects.length;s--;)this._updateObjectCoords(this._objects[s],r)},_updateObjectCoords:function(r,s){var u=r.left,m=r.top;r.set({left:u-s.x,top:m-s.y}),r.group=this,r.setCoords(!0)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(r){var s=!!this.group;return this._restoreObjectsState(),a.util.resetObjectTransform(this),r&&(s&&a.util.removeTransformFromObject(r,this.group.calcTransformMatrix()),this._objects.push(r),r.group=this,r._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.dirty=!0,s?this.group.addWithUpdate():this.setCoords(),this},removeWithUpdate:function(r){return this._restoreObjectsState(),a.util.resetObjectTransform(this),this.remove(r),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(r){this.dirty=!0,r.group=this,r._set("canvas",this.canvas)},_onObjectRemoved:function(r){this.dirty=!0,delete r.group},_set:function(r,s){var u=this._objects.length;if(this.useSetOnGroup)for(;u--;)this._objects[u].setOnGroup(r,s);if(r==="canvas")for(;u--;)this._objects[u]._set(r,s);a.Object.prototype._set.call(this,r,s)},toObject:function(r){var s=this.includeDefaultValues,u=this._objects.filter(function(f){return!f.excludeFromExport}).map(function(f){var g=f.includeDefaultValues;f.includeDefaultValues=s;var y=f.toObject(r);return f.includeDefaultValues=g,y}),m=a.Object.prototype.toObject.call(this,r);return m.objects=u,m},toDatalessObject:function(r){var s,u=this.sourcePath;if(u)s=u;else{var m=this.includeDefaultValues;s=this._objects.map(function(g){var y=g.includeDefaultValues;g.includeDefaultValues=m;var E=g.toDatalessObject(r);return g.includeDefaultValues=y,E})}var f=a.Object.prototype.toDatalessObject.call(this,r);return f.objects=s,f},render:function(r){this._transformDone=!0,this.callSuper("render",r),this._transformDone=!1},shouldCache:function(){var r=a.Object.prototype.shouldCache.call(this);if(r){for(var s=0,u=this._objects.length;s<u;s++)if(this._objects[s].willDrawShadow())return this.ownCaching=!1,!1}return r},willDrawShadow:function(){if(a.Object.prototype.willDrawShadow.call(this))return!0;for(var r=0,s=this._objects.length;r<s;r++)if(this._objects[r].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(r){for(var s=0,u=this._objects.length;s<u;s++)this._objects[s].render(r);this._drawClipPath(r,this.clipPath)},isCacheDirty:function(r){if(this.callSuper("isCacheDirty",r))return!0;if(!this.statefullCache)return!1;for(var s=0,u=this._objects.length;s<u;s++)if(this._objects[s].isCacheDirty(!0)){if(this._cacheCanvas){var m=this.cacheWidth/this.zoomX,f=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-m/2,-f/2,m,f)}return!0}return!1},_restoreObjectsState:function(){var r=this.calcOwnMatrix();return this._objects.forEach(function(s){a.util.addTransformToObject(s,r),delete s.group,s.setCoords()}),this},destroy:function(){return this._objects.forEach(function(r){r.set("dirty",!0)}),this._restoreObjectsState()},dispose:function(){this.callSuper("dispose"),this.forEachObject(function(r){r.dispose&&r.dispose()}),this._objects=[]},toActiveSelection:function(){if(this.canvas){var r=this._objects,s=this.canvas;this._objects=[];var u=this.toObject();delete u.objects;var m=new a.ActiveSelection([]);return m.set(u),m.type="activeSelection",s.remove(this),r.forEach(function(f){f.group=m,f.dirty=!0,s.add(f)}),m.canvas=s,m._objects=r,s._activeObject=m,m.setCoords(),m}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){return this.forEachObject(function(r){r.setCoords(!0)}),this},_calcBounds:function(r){for(var s,u,m,f,g=[],y=[],E=["tr","br","bl","tl"],C=0,T=this._objects.length,D=E.length;C<T;++C){for(m=(s=this._objects[C]).calcACoords(),f=0;f<D;f++)u=E[f],g.push(m[u].x),y.push(m[u].y);s.aCoords=m}this._getBounds(g,y,r)},_getBounds:function(r,s,u){var m=new a.Point(l(r),l(s)),f=new a.Point(d(r),d(s)),g=m.y||0,y=m.x||0,E=f.x-m.x||0,C=f.y-m.y||0;this.width=E,this.height=C,u||this.setPositionByOrigin({x:y,y:g},"left","top")},_toSVG:function(r){for(var s=["<g ","COMMON_PARTS",` >
`],u=0,m=this._objects.length;u<m;u++)s.push("		",this._objects[u].toSVG(r));return s.push(`</g>
`),s},getSvgStyles:function(){var r=this.opacity!==void 0&&this.opacity!==1?"opacity: "+this.opacity+";":"",s=this.visible?"":" visibility: hidden;";return[r,this.getSvgFilter(),s].join("")},toClipPathSVG:function(r){for(var s=[],u=0,m=this._objects.length;u<m;u++)s.push("	",this._objects[u].toClipPathSVG(r));return this._createBaseClipPathSVGMarkup(s,{reviver:r})}}),a.Group.fromObject=function(r,s){var u=r.objects,m=a.util.object.clone(r,!0);delete m.objects,typeof u!="string"?a.util.enlivenObjects(u,function(f){var g=a.util.object.clone(r,!0);delete g.objects,a.util.enlivenObjectEnlivables(r,g,function(){s&&s(new a.Group(f,g,!0))})}):a.loadSVGFromURL(u,function(f){var g=a.util.groupSVGElements(f,r,u);g.set(m),s&&s(g)})})}(e),function(c){var a=c.fabric||(c.fabric={});a.ActiveSelection||(a.ActiveSelection=a.util.createClass(a.Group,{type:"activeSelection",initialize:function(l,d){d=d||{},this._objects=l||[];for(var r=this._objects.length;r--;)this._objects[r].group=this;d.originX&&(this.originX=d.originX),d.originY&&(this.originY=d.originY),this._calcBounds(),this._updateObjectsCoords(),a.Object.prototype.initialize.call(this,d),this.setCoords()},toGroup:function(){var l=this._objects.concat();this._objects=[];var d=a.Object.prototype.toObject.call(this),r=new a.Group([]);if(delete d.type,r.set(d),l.forEach(function(u){u.canvas.remove(u),u.group=r}),r._objects=l,!this.canvas)return r;var s=this.canvas;return s.add(r),s._activeObject=r,r.setCoords(),r},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},shouldCache:function(){return!1},isOnACache:function(){return!1},_renderControls:function(l,d,r){l.save(),l.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",l,d),(r=r||{}).hasControls===void 0&&(r.hasControls=!1),r.forActiveSelection=!0;for(var s=0,u=this._objects.length;s<u;s++)this._objects[s]._renderControls(l,r);l.restore()}}),a.ActiveSelection.fromObject=function(l,d){a.util.enlivenObjects(l.objects,function(r){delete l.objects,d&&d(new a.ActiveSelection(r,l,!0))})})}(e),function(c){var a=_.util.object.extend;c.fabric||(c.fabric={}),c.fabric.Image?_.warn("fabric.Image is already defined."):(_.Image=_.util.createClass(_.Object,{type:"image",strokeWidth:0,srcFromAttribute:!1,_lastScaleX:1,_lastScaleY:1,_filterScalingX:1,_filterScalingY:1,minimumScaleTrigger:.5,stateProperties:_.Object.prototype.stateProperties.concat("cropX","cropY"),cacheProperties:_.Object.prototype.cacheProperties.concat("cropX","cropY"),cacheKey:"",cropX:0,cropY:0,imageSmoothing:!0,initialize:function(l,d){d||(d={}),this.filters=[],this.cacheKey="texture"+_.Object.__uid++,this.callSuper("initialize",d),this._initElement(l,d)},getElement:function(){return this._element||{}},setElement:function(l,d){return this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._element=l,this._originalElement=l,this._initConfig(d),this.filters.length!==0&&this.applyFilters(),this.resizeFilter&&this.applyResizeFilters(),this},removeTexture:function(l){var d=_.filterBackend;d&&d.evictCachesForKey&&d.evictCachesForKey(l)},dispose:function(){this.callSuper("dispose"),this.removeTexture(this.cacheKey),this.removeTexture(this.cacheKey+"_filtered"),this._cacheContext=void 0,["_originalElement","_element","_filteredEl","_cacheCanvas"].forEach((function(l){_.util.cleanUpJsdomNode(this[l]),this[l]=void 0}).bind(this))},getCrossOrigin:function(){return this._originalElement&&(this._originalElement.crossOrigin||null)},getOriginalSize:function(){var l=this.getElement();return{width:l.naturalWidth||l.width,height:l.naturalHeight||l.height}},_stroke:function(l){if(this.stroke&&this.strokeWidth!==0){var d=this.width/2,r=this.height/2;l.beginPath(),l.moveTo(-d,-r),l.lineTo(d,-r),l.lineTo(d,r),l.lineTo(-d,r),l.lineTo(-d,-r),l.closePath()}},toObject:function(l){var d=[];this.filters.forEach(function(s){s&&d.push(s.toObject())});var r=a(this.callSuper("toObject",["cropX","cropY"].concat(l)),{src:this.getSrc(),crossOrigin:this.getCrossOrigin(),filters:d});return this.resizeFilter&&(r.resizeFilter=this.resizeFilter.toObject()),r},hasCrop:function(){return this.cropX||this.cropY||this.width<this._element.width||this.height<this._element.height},_toSVG:function(){var l,d=[],r=[],s=this._element,u=-this.width/2,m=-this.height/2,f="",g="";if(!s)return[];if(this.hasCrop()){var y=_.Object.__uid++;d.push('<clipPath id="imageCrop_'+y+`">
`,'	<rect x="'+u+'" y="'+m+'" width="'+this.width+'" height="'+this.height+`" />
`,`</clipPath>
`),f=' clip-path="url(#imageCrop_'+y+')" '}if(this.imageSmoothing||(g='" image-rendering="optimizeSpeed'),r.push("	<image ","COMMON_PARTS",'xlink:href="',this.getSvgSrc(!0),'" x="',u-this.cropX,'" y="',m-this.cropY,'" width="',s.width||s.naturalWidth,'" height="',s.height||s.height,g,'"',f,`></image>
`),this.stroke||this.strokeDashArray){var E=this.fill;this.fill=null,l=["	<rect ",'x="',u,'" y="',m,'" width="',this.width,'" height="',this.height,'" style="',this.getSvgStyles(),`"/>
`],this.fill=E}return this.paintFirst!=="fill"?d.concat(l,r):d.concat(r,l)},getSrc:function(l){var d=l?this._element:this._originalElement;return d?d.toDataURL?d.toDataURL():this.srcFromAttribute?d.getAttribute("src"):d.src:this.src||""},setSrc:function(l,d,r){return _.util.loadImage(l,function(s,u){this.setElement(s,r),this._setWidthHeight(),d&&d(this,u)},this,r&&r.crossOrigin),this},toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},applyResizeFilters:function(){var l=this.resizeFilter,d=this.minimumScaleTrigger,r=this.getTotalObjectScaling(),s=r.scaleX,u=r.scaleY,m=this._filteredEl||this._originalElement;if(this.group&&this.set("dirty",!0),!l||s>d&&u>d)return this._element=m,this._filterScalingX=1,this._filterScalingY=1,this._lastScaleX=s,void(this._lastScaleY=u);_.filterBackend||(_.filterBackend=_.initFilterBackend());var f=_.util.createCanvasElement(),g=this._filteredEl?this.cacheKey+"_filtered":this.cacheKey,y=m.width,E=m.height;f.width=y,f.height=E,this._element=f,this._lastScaleX=l.scaleX=s,this._lastScaleY=l.scaleY=u,_.filterBackend.applyFilters([l],m,y,E,this._element,g),this._filterScalingX=f.width/this._originalElement.width,this._filterScalingY=f.height/this._originalElement.height},applyFilters:function(l){if(l=(l=l||this.filters||[]).filter(function(m){return m&&!m.isNeutralState()}),this.set("dirty",!0),this.removeTexture(this.cacheKey+"_filtered"),l.length===0)return this._element=this._originalElement,this._filteredEl=null,this._filterScalingX=1,this._filterScalingY=1,this;var d=this._originalElement,r=d.naturalWidth||d.width,s=d.naturalHeight||d.height;if(this._element===this._originalElement){var u=_.util.createCanvasElement();u.width=r,u.height=s,this._element=u,this._filteredEl=u}else this._element=this._filteredEl,this._filteredEl.getContext("2d").clearRect(0,0,r,s),this._lastScaleX=1,this._lastScaleY=1;return _.filterBackend||(_.filterBackend=_.initFilterBackend()),_.filterBackend.applyFilters(l,this._originalElement,r,s,this._element,this.cacheKey),this._originalElement.width===this._element.width&&this._originalElement.height===this._element.height||(this._filterScalingX=this._element.width/this._originalElement.width,this._filterScalingY=this._element.height/this._originalElement.height),this},_render:function(l){_.util.setImageSmoothing(l,this.imageSmoothing),this.isMoving!==!0&&this.resizeFilter&&this._needsResize()&&this.applyResizeFilters(),this._stroke(l),this._renderPaintInOrder(l)},drawCacheOnCanvas:function(l){_.util.setImageSmoothing(l,this.imageSmoothing),_.Object.prototype.drawCacheOnCanvas.call(this,l)},shouldCache:function(){return this.needsItsOwnCache()},_renderFill:function(l){var d=this._element;if(d){var r=this._filterScalingX,s=this._filterScalingY,u=this.width,m=this.height,f=Math.min,g=Math.max,y=g(this.cropX,0),E=g(this.cropY,0),C=d.naturalWidth||d.width,T=d.naturalHeight||d.height,D=y*r,A=E*s,L=f(u*r,C-D),U=f(m*s,T-A),G=-u/2,J=-m/2,q=f(u,C/r-y),X=f(m,T/s-E);d&&l.drawImage(d,D,A,L,U,G,J,q,X)}},_needsResize:function(){var l=this.getTotalObjectScaling();return l.scaleX!==this._lastScaleX||l.scaleY!==this._lastScaleY},_resetWidthHeight:function(){this.set(this.getOriginalSize())},_initElement:function(l,d){this.setElement(_.util.getById(l),d),_.util.addClass(this.getElement(),_.Image.CSS_CANVAS)},_initConfig:function(l){l||(l={}),this.setOptions(l),this._setWidthHeight(l)},_initFilters:function(l,d){l&&l.length?_.util.enlivenObjects(l,function(r){d&&d(r)},"fabric.Image.filters"):d&&d()},_setWidthHeight:function(l){l||(l={});var d=this.getElement();this.width=l.width||d.naturalWidth||d.width||0,this.height=l.height||d.naturalHeight||d.height||0},parsePreserveAspectRatioAttribute:function(){var l,d=_.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio||""),r=this._element.width,s=this._element.height,u=1,m=1,f=0,g=0,y=0,E=0,C=this.width,T=this.height,D={width:C,height:T};return!d||d.alignX==="none"&&d.alignY==="none"?(u=C/r,m=T/s):(d.meetOrSlice==="meet"&&(l=(C-r*(u=m=_.util.findScaleToFit(this._element,D)))/2,d.alignX==="Min"&&(f=-l),d.alignX==="Max"&&(f=l),l=(T-s*m)/2,d.alignY==="Min"&&(g=-l),d.alignY==="Max"&&(g=l)),d.meetOrSlice==="slice"&&(l=r-C/(u=m=_.util.findScaleToCover(this._element,D)),d.alignX==="Mid"&&(y=l/2),d.alignX==="Max"&&(y=l),l=s-T/m,d.alignY==="Mid"&&(E=l/2),d.alignY==="Max"&&(E=l),r=C/u,s=T/m)),{width:r,height:s,scaleX:u,scaleY:m,offsetLeft:f,offsetTop:g,cropX:y,cropY:E}}}),_.Image.CSS_CANVAS="canvas-img",_.Image.prototype.getSvgSrc=_.Image.prototype.getSrc,_.Image.fromObject=function(l,d){var r=_.util.object.clone(l);_.util.loadImage(r.src,function(s,u){u?d&&d(null,!0):_.Image.prototype._initFilters.call(r,r.filters,function(m){r.filters=m||[],_.Image.prototype._initFilters.call(r,[r.resizeFilter],function(f){r.resizeFilter=f[0],_.util.enlivenObjectEnlivables(r,r,function(){var g=new _.Image(s,r);d(g,!1)})})})},null,r.crossOrigin)},_.Image.fromURL=function(l,d,r){_.util.loadImage(l,function(s,u){d&&d(new _.Image(s,r),u)},null,r&&r.crossOrigin)},_.Image.ATTRIBUTE_NAMES=_.SHARED_ATTRIBUTES.concat("x y width height preserveAspectRatio xlink:href crossOrigin image-rendering".split(" ")),_.Image.fromElement=function(l,d,r){var s=_.parseAttributes(l,_.Image.ATTRIBUTE_NAMES);_.Image.fromURL(s["xlink:href"],d,a(r?_.util.object.clone(r):{},s))})}(e),_.util.object.extend(_.Object.prototype,{_getAngleValueForStraighten:function(){var c=this.angle%360;return c>0?90*Math.round((c-1)/90):90*Math.round(c/90)},straighten:function(){return this.rotate(this._getAngleValueForStraighten())},fxStraighten:function(c){var a=function(){},l=(c=c||{}).onComplete||a,d=c.onChange||a,r=this;return _.util.animate({target:this,startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(s){r.rotate(s),d()},onComplete:function(){r.setCoords(),l()}})}}),_.util.object.extend(_.StaticCanvas.prototype,{straightenObject:function(c){return c.straighten(),this.requestRenderAll(),this},fxStraightenObject:function(c){return c.fxStraighten({onChange:this.requestRenderAllBound})}}),function(){function c(l,d){var r="precision "+d+` float;
void main(){}`,s=l.createShader(l.FRAGMENT_SHADER);return l.shaderSource(s,r),l.compileShader(s),!!l.getShaderParameter(s,l.COMPILE_STATUS)}function a(l){l&&l.tileSize&&(this.tileSize=l.tileSize),this.setupGLContext(this.tileSize,this.tileSize),this.captureGPUInfo()}_.isWebglSupported=function(l){if(_.isLikelyNode)return!1;l=l||_.WebglFilterBackend.prototype.tileSize;var d=document.createElement("canvas"),r=d.getContext("webgl")||d.getContext("experimental-webgl"),s=!1;if(r){_.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),s=_.maxTextureSize>=l;for(var u=["highp","mediump","lowp"],m=0;m<3;m++)if(c(r,u[m])){_.webGlPrecision=u[m];break}}return this.isSupported=s,s},_.WebglFilterBackend=a,a.prototype={tileSize:2048,resources:{},setupGLContext:function(l,d){this.dispose(),this.createWebGLCanvas(l,d),this.aPosition=new Float32Array([0,0,0,1,1,0,1,1]),this.chooseFastestCopyGLTo2DMethod(l,d)},chooseFastestCopyGLTo2DMethod:function(l,d){var r,s=window.performance!==void 0;try{new ImageData(1,1),r=!0}catch{r=!1}var u=typeof ArrayBuffer<"u",m=typeof Uint8ClampedArray<"u";if(s&&r&&u&&m){var f=_.util.createCanvasElement(),g=new ArrayBuffer(l*d*4);if(_.forceGLPutImageData)return this.imageBuffer=g,void(this.copyGLTo2D=de);var y,E,C={imageBuffer:g,destinationWidth:l,destinationHeight:d,targetCanvas:f};f.width=l,f.height=d,y=window.performance.now(),Ee.call(C,this.gl,C),E=window.performance.now()-y,y=window.performance.now(),de.call(C,this.gl,C),E>window.performance.now()-y?(this.imageBuffer=g,this.copyGLTo2D=de):this.copyGLTo2D=Ee}},createWebGLCanvas:function(l,d){var r=_.util.createCanvasElement();r.width=l,r.height=d;var s={alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1},u=r.getContext("webgl",s);u||(u=r.getContext("experimental-webgl",s)),u&&(u.clearColor(0,0,0,0),this.canvas=r,this.gl=u)},applyFilters:function(l,d,r,s,u,m){var f,g=this.gl;m&&(f=this.getCachedTexture(m,d));var y={originalWidth:d.width||d.originalWidth,originalHeight:d.height||d.originalHeight,sourceWidth:r,sourceHeight:s,destinationWidth:r,destinationHeight:s,context:g,sourceTexture:this.createTexture(g,r,s,!f&&d),targetTexture:this.createTexture(g,r,s),originalTexture:f||this.createTexture(g,r,s,!f&&d),passes:l.length,webgl:!0,aPosition:this.aPosition,programCache:this.programCache,pass:0,filterBackend:this,targetCanvas:u},E=g.createFramebuffer();return g.bindFramebuffer(g.FRAMEBUFFER,E),l.forEach(function(C){C&&C.applyTo(y)}),function(C){var T=C.targetCanvas,D=T.width,A=T.height,L=C.destinationWidth,U=C.destinationHeight;D===L&&A===U||(T.width=L,T.height=U)}(y),this.copyGLTo2D(g,y),g.bindTexture(g.TEXTURE_2D,null),g.deleteTexture(y.sourceTexture),g.deleteTexture(y.targetTexture),g.deleteFramebuffer(E),u.getContext("2d").setTransform(1,0,0,1,0,0),y},dispose:function(){this.canvas&&(this.canvas=null,this.gl=null),this.clearWebGLCaches()},clearWebGLCaches:function(){this.programCache={},this.textureCache={}},createTexture:function(l,d,r,s){var u=l.createTexture();return l.bindTexture(l.TEXTURE_2D,u),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),s?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,s):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,d,r,0,l.RGBA,l.UNSIGNED_BYTE,null),u},getCachedTexture:function(l,d){if(this.textureCache[l])return this.textureCache[l];var r=this.createTexture(this.gl,d.width,d.height,d);return this.textureCache[l]=r,r},evictCachesForKey:function(l){this.textureCache[l]&&(this.gl.deleteTexture(this.textureCache[l]),delete this.textureCache[l])},copyGLTo2D:Ee,captureGPUInfo:function(){if(this.gpuInfo)return this.gpuInfo;var l=this.gl,d={renderer:"",vendor:""};if(!l)return d;var r=l.getExtension("WEBGL_debug_renderer_info");if(r){var s=l.getParameter(r.UNMASKED_RENDERER_WEBGL),u=l.getParameter(r.UNMASKED_VENDOR_WEBGL);s&&(d.renderer=s.toLowerCase()),u&&(d.vendor=u.toLowerCase())}return this.gpuInfo=d,d}}}(),function(){var c=function(){};function a(){}_.Canvas2dFilterBackend=a,a.prototype={evictCachesForKey:c,dispose:c,clearWebGLCaches:c,resources:{},applyFilters:function(l,d,r,s,u){var m=u.getContext("2d");m.drawImage(d,0,0,r,s);var f={sourceWidth:r,sourceHeight:s,imageData:m.getImageData(0,0,r,s),originalEl:d,originalImageData:m.getImageData(0,0,r,s),canvasEl:u,ctx:m,filterBackend:this};return l.forEach(function(g){g.applyTo(f)}),f.imageData.width===r&&f.imageData.height===s||(u.width=f.imageData.width,u.height=f.imageData.height),m.putImageData(f.imageData,0,0),f}}}(),_.Image=_.Image||{},_.Image.filters=_.Image.filters||{},_.Image.filters.BaseFilter=_.util.createClass({type:"BaseFilter",vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
void main() {
vTexCoord = aPosition;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:`precision highp float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
}`,initialize:function(c){c&&this.setOptions(c)},setOptions:function(c){for(var a in c)this[a]=c[a]},createProgram:function(c,a,l){a=a||this.fragmentSource,l=l||this.vertexSource,_.webGlPrecision!=="highp"&&(a=a.replace(/precision highp float/g,"precision "+_.webGlPrecision+" float"));var d=c.createShader(c.VERTEX_SHADER);if(c.shaderSource(d,l),c.compileShader(d),!c.getShaderParameter(d,c.COMPILE_STATUS))throw new Error("Vertex shader compile error for "+this.type+": "+c.getShaderInfoLog(d));var r=c.createShader(c.FRAGMENT_SHADER);if(c.shaderSource(r,a),c.compileShader(r),!c.getShaderParameter(r,c.COMPILE_STATUS))throw new Error("Fragment shader compile error for "+this.type+": "+c.getShaderInfoLog(r));var s=c.createProgram();if(c.attachShader(s,d),c.attachShader(s,r),c.linkProgram(s),!c.getProgramParameter(s,c.LINK_STATUS))throw new Error('Shader link error for "${this.type}" '+c.getProgramInfoLog(s));var u=this.getAttributeLocations(c,s),m=this.getUniformLocations(c,s)||{};return m.uStepW=c.getUniformLocation(s,"uStepW"),m.uStepH=c.getUniformLocation(s,"uStepH"),{program:s,attributeLocations:u,uniformLocations:m}},getAttributeLocations:function(c,a){return{aPosition:c.getAttribLocation(a,"aPosition")}},getUniformLocations:function(){return{}},sendAttributeData:function(c,a,l){var d=a.aPosition,r=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,r),c.enableVertexAttribArray(d),c.vertexAttribPointer(d,2,c.FLOAT,!1,0,0),c.bufferData(c.ARRAY_BUFFER,l,c.STATIC_DRAW)},_setupFrameBuffer:function(c){var a,l,d=c.context;c.passes>1?(a=c.destinationWidth,l=c.destinationHeight,c.sourceWidth===a&&c.sourceHeight===l||(d.deleteTexture(c.targetTexture),c.targetTexture=c.filterBackend.createTexture(d,a,l)),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c.targetTexture,0)):(d.bindFramebuffer(d.FRAMEBUFFER,null),d.finish())},_swapTextures:function(c){c.passes--,c.pass++;var a=c.targetTexture;c.targetTexture=c.sourceTexture,c.sourceTexture=a},isNeutralState:function(){var c=this.mainParameter,a=_.Image.filters[this.type].prototype;if(c){if(Array.isArray(a[c])){for(var l=a[c].length;l--;)if(this[c][l]!==a[c][l])return!1;return!0}return a[c]===this[c]}return!1},applyTo:function(c){c.webgl?(this._setupFrameBuffer(c),this.applyToWebGL(c),this._swapTextures(c)):this.applyTo2d(c)},retrieveShader:function(c){return c.programCache.hasOwnProperty(this.type)||(c.programCache[this.type]=this.createProgram(c.context)),c.programCache[this.type]},applyToWebGL:function(c){var a=c.context,l=this.retrieveShader(c);c.pass===0&&c.originalTexture?a.bindTexture(a.TEXTURE_2D,c.originalTexture):a.bindTexture(a.TEXTURE_2D,c.sourceTexture),a.useProgram(l.program),this.sendAttributeData(a,l.attributeLocations,c.aPosition),a.uniform1f(l.uniformLocations.uStepW,1/c.sourceWidth),a.uniform1f(l.uniformLocations.uStepH,1/c.sourceHeight),this.sendUniformData(a,l.uniformLocations),a.viewport(0,0,c.destinationWidth,c.destinationHeight),a.drawArrays(a.TRIANGLE_STRIP,0,4)},bindAdditionalTexture:function(c,a,l){c.activeTexture(l),c.bindTexture(c.TEXTURE_2D,a),c.activeTexture(c.TEXTURE0)},unbindAdditionalTexture:function(c,a){c.activeTexture(a),c.bindTexture(c.TEXTURE_2D,null),c.activeTexture(c.TEXTURE0)},getMainParameter:function(){return this[this.mainParameter]},setMainParameter:function(c){this[this.mainParameter]=c},sendUniformData:function(){},createHelpLayer:function(c){if(!c.helpLayer){var a=document.createElement("canvas");a.width=c.sourceWidth,a.height=c.sourceHeight,c.helpLayer=a}},toObject:function(){var c={type:this.type},a=this.mainParameter;return a&&(c[a]=this[a]),c},toJSON:function(){return this.toObject()}}),_.Image.filters.BaseFilter.fromObject=function(c,a){var l=new _.Image.filters[c.type](c);return a&&a(l),l},function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.ColorMatrix=d(l.BaseFilter,{type:"ColorMatrix",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
uniform mat4 uColorMatrix;
uniform vec4 uConstants;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color *= uColorMatrix;
color += uConstants;
gl_FragColor = color;
}`,matrix:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],mainParameter:"matrix",colorsOnly:!0,initialize:function(r){this.callSuper("initialize",r),this.matrix=this.matrix.slice(0)},applyTo2d:function(r){var s,u,m,f,g,y=r.imageData.data,E=y.length,C=this.matrix,T=this.colorsOnly;for(g=0;g<E;g+=4)s=y[g],u=y[g+1],m=y[g+2],T?(y[g]=s*C[0]+u*C[1]+m*C[2]+255*C[4],y[g+1]=s*C[5]+u*C[6]+m*C[7]+255*C[9],y[g+2]=s*C[10]+u*C[11]+m*C[12]+255*C[14]):(f=y[g+3],y[g]=s*C[0]+u*C[1]+m*C[2]+f*C[3]+255*C[4],y[g+1]=s*C[5]+u*C[6]+m*C[7]+f*C[8]+255*C[9],y[g+2]=s*C[10]+u*C[11]+m*C[12]+f*C[13]+255*C[14],y[g+3]=s*C[15]+u*C[16]+m*C[17]+f*C[18]+255*C[19])},getUniformLocations:function(r,s){return{uColorMatrix:r.getUniformLocation(s,"uColorMatrix"),uConstants:r.getUniformLocation(s,"uConstants")}},sendUniformData:function(r,s){var u=this.matrix,m=[u[0],u[1],u[2],u[3],u[5],u[6],u[7],u[8],u[10],u[11],u[12],u[13],u[15],u[16],u[17],u[18]],f=[u[4],u[9],u[14],u[19]];r.uniformMatrix4fv(s.uColorMatrix,!1,m),r.uniform4fv(s.uConstants,f)}}),a.Image.filters.ColorMatrix.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Brightness=d(l.BaseFilter,{type:"Brightness",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBrightness;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += uBrightness;
gl_FragColor = color;
}`,brightness:0,mainParameter:"brightness",applyTo2d:function(r){if(this.brightness!==0){var s,u=r.imageData.data,m=u.length,f=Math.round(255*this.brightness);for(s=0;s<m;s+=4)u[s]=u[s]+f,u[s+1]=u[s+1]+f,u[s+2]=u[s+2]+f}},getUniformLocations:function(r,s){return{uBrightness:r.getUniformLocation(s,"uBrightness")}},sendUniformData:function(r,s){r.uniform1f(s.uBrightness,this.brightness)}}),a.Image.filters.Brightness.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.object.extend,d=a.Image.filters,r=a.util.createClass;d.Convolute=r(d.BaseFilter,{type:"Convolute",opaque:!1,matrix:[0,0,0,0,1,0,0,0,0],fragmentSource:{Convolute_3_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_3_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[9];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 3.0; h+=1.0) {
for (float w = 0.0; w < 3.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_5_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_5_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[25];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 5.0; h+=1.0) {
for (float w = 0.0; w < 5.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_7_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_7_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[49];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 7.0; h+=1.0) {
for (float w = 0.0; w < 7.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`,Convolute_9_1:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 0);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];
}
}
gl_FragColor = color;
}`,Convolute_9_0:`precision highp float;
uniform sampler2D uTexture;
uniform float uMatrix[81];
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
vec4 color = vec4(0, 0, 0, 1);
for (float h = 0.0; h < 9.0; h+=1.0) {
for (float w = 0.0; w < 9.0; w+=1.0) {
vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));
color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];
}
}
float alpha = texture2D(uTexture, vTexCoord).a;
gl_FragColor = color;
gl_FragColor.a = alpha;
}`},retrieveShader:function(s){var u=Math.sqrt(this.matrix.length),m=this.type+"_"+u+"_"+(this.opaque?1:0),f=this.fragmentSource[m];return s.programCache.hasOwnProperty(m)||(s.programCache[m]=this.createProgram(s.context,f)),s.programCache[m]},applyTo2d:function(s){var u,m,f,g,y,E,C,T,D,A,L,U,G,J=s.imageData,q=J.data,X=this.matrix,P=Math.round(Math.sqrt(X.length)),N=Math.floor(P/2),W=J.width,K=J.height,ee=s.ctx.createImageData(W,K),j=ee.data,k=this.opaque?1:0;for(L=0;L<K;L++)for(A=0;A<W;A++){for(y=4*(L*W+A),u=0,m=0,f=0,g=0,G=0;G<P;G++)for(U=0;U<P;U++)E=A+U-N,(C=L+G-N)<0||C>=K||E<0||E>=W||(T=4*(C*W+E),D=X[G*P+U],u+=q[T]*D,m+=q[T+1]*D,f+=q[T+2]*D,k||(g+=q[T+3]*D));j[y]=u,j[y+1]=m,j[y+2]=f,j[y+3]=k?q[y+3]:g}s.imageData=ee},getUniformLocations:function(s,u){return{uMatrix:s.getUniformLocation(u,"uMatrix"),uOpaque:s.getUniformLocation(u,"uOpaque"),uHalfSize:s.getUniformLocation(u,"uHalfSize"),uSize:s.getUniformLocation(u,"uSize")}},sendUniformData:function(s,u){s.uniform1fv(u.uMatrix,this.matrix)},toObject:function(){return l(this.callSuper("toObject"),{opaque:this.opaque,matrix:this.matrix})}}),a.Image.filters.Convolute.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Grayscale=d(l.BaseFilter,{type:"Grayscale",fragmentSource:{average:`precision highp float;
uniform sampler2D uTexture;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float average = (color.r + color.b + color.g) / 3.0;
gl_FragColor = vec4(average, average, average, color.a);
}`,lightness:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;
gl_FragColor = vec4(average, average, average, col.a);
}`,luminosity:`precision highp float;
uniform sampler2D uTexture;
uniform int uMode;
varying vec2 vTexCoord;
void main() {
vec4 col = texture2D(uTexture, vTexCoord);
float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;
gl_FragColor = vec4(average, average, average, col.a);
}`},mode:"average",mainParameter:"mode",applyTo2d:function(r){var s,u,m=r.imageData.data,f=m.length,g=this.mode;for(s=0;s<f;s+=4)g==="average"?u=(m[s]+m[s+1]+m[s+2])/3:g==="lightness"?u=(Math.min(m[s],m[s+1],m[s+2])+Math.max(m[s],m[s+1],m[s+2]))/2:g==="luminosity"&&(u=.21*m[s]+.72*m[s+1]+.07*m[s+2]),m[s]=u,m[s+1]=u,m[s+2]=u},retrieveShader:function(r){var s=this.type+"_"+this.mode;if(!r.programCache.hasOwnProperty(s)){var u=this.fragmentSource[this.mode];r.programCache[s]=this.createProgram(r.context,u)}return r.programCache[s]},getUniformLocations:function(r,s){return{uMode:r.getUniformLocation(s,"uMode")}},sendUniformData:function(r,s){r.uniform1i(s.uMode,1)},isNeutralState:function(){return!1}}),a.Image.filters.Grayscale.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Invert=d(l.BaseFilter,{type:"Invert",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform int uInvert;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
if (uInvert == 1) {
gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);
} else {
gl_FragColor = color;
}
}`,invert:!0,mainParameter:"invert",applyTo2d:function(r){var s,u=r.imageData.data,m=u.length;for(s=0;s<m;s+=4)u[s]=255-u[s],u[s+1]=255-u[s+1],u[s+2]=255-u[s+2]},isNeutralState:function(){return!this.invert},getUniformLocations:function(r,s){return{uInvert:r.getUniformLocation(s,"uInvert")}},sendUniformData:function(r,s){r.uniform1i(s.uInvert,this.invert)}}),a.Image.filters.Invert.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.object.extend,d=a.Image.filters,r=a.util.createClass;d.Noise=r(d.BaseFilter,{type:"Noise",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uStepH;
uniform float uNoise;
uniform float uSeed;
varying vec2 vTexCoord;
float rand(vec2 co, float seed, float vScale) {
return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);
}
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;
gl_FragColor = color;
}`,mainParameter:"noise",noise:0,applyTo2d:function(s){if(this.noise!==0){var u,m,f=s.imageData.data,g=f.length,y=this.noise;for(u=0,g=f.length;u<g;u+=4)m=(.5-Math.random())*y,f[u]+=m,f[u+1]+=m,f[u+2]+=m}},getUniformLocations:function(s,u){return{uNoise:s.getUniformLocation(u,"uNoise"),uSeed:s.getUniformLocation(u,"uSeed")}},sendUniformData:function(s,u){s.uniform1f(u.uNoise,this.noise/255),s.uniform1f(u.uSeed,Math.random())},toObject:function(){return l(this.callSuper("toObject"),{noise:this.noise})}}),a.Image.filters.Noise.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Pixelate=d(l.BaseFilter,{type:"Pixelate",blocksize:4,mainParameter:"blocksize",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uBlocksize;
uniform float uStepW;
uniform float uStepH;
varying vec2 vTexCoord;
void main() {
float blockW = uBlocksize * uStepW;
float blockH = uBlocksize * uStepW;
int posX = int(vTexCoord.x / blockW);
int posY = int(vTexCoord.y / blockH);
float fposX = float(posX);
float fposY = float(posY);
vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);
vec4 color = texture2D(uTexture, squareCoords);
gl_FragColor = color;
}`,applyTo2d:function(r){var s,u,m,f,g,y,E,C,T,D,A,L=r.imageData,U=L.data,G=L.height,J=L.width;for(u=0;u<G;u+=this.blocksize)for(m=0;m<J;m+=this.blocksize)for(f=U[s=4*u*J+4*m],g=U[s+1],y=U[s+2],E=U[s+3],D=Math.min(u+this.blocksize,G),A=Math.min(m+this.blocksize,J),C=u;C<D;C++)for(T=m;T<A;T++)U[s=4*C*J+4*T]=f,U[s+1]=g,U[s+2]=y,U[s+3]=E},isNeutralState:function(){return this.blocksize===1},getUniformLocations:function(r,s){return{uBlocksize:r.getUniformLocation(s,"uBlocksize"),uStepW:r.getUniformLocation(s,"uStepW"),uStepH:r.getUniformLocation(s,"uStepH")}},sendUniformData:function(r,s){r.uniform1f(s.uBlocksize,this.blocksize)}}),a.Image.filters.Pixelate.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.object.extend,d=a.Image.filters,r=a.util.createClass;d.RemoveColor=r(d.BaseFilter,{type:"RemoveColor",color:"#FFFFFF",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uLow;
uniform vec4 uHigh;
varying vec2 vTexCoord;
void main() {
gl_FragColor = texture2D(uTexture, vTexCoord);
if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {
gl_FragColor.a = 0.0;
}
}`,distance:.02,useAlpha:!1,applyTo2d:function(s){var u,m,f,g,y=s.imageData.data,E=255*this.distance,C=new a.Color(this.color).getSource(),T=[C[0]-E,C[1]-E,C[2]-E],D=[C[0]+E,C[1]+E,C[2]+E];for(u=0;u<y.length;u+=4)m=y[u],f=y[u+1],g=y[u+2],m>T[0]&&f>T[1]&&g>T[2]&&m<D[0]&&f<D[1]&&g<D[2]&&(y[u+3]=0)},getUniformLocations:function(s,u){return{uLow:s.getUniformLocation(u,"uLow"),uHigh:s.getUniformLocation(u,"uHigh")}},sendUniformData:function(s,u){var m=new a.Color(this.color).getSource(),f=parseFloat(this.distance),g=[0+m[0]/255-f,0+m[1]/255-f,0+m[2]/255-f,1],y=[m[0]/255+f,m[1]/255+f,m[2]/255+f,1];s.uniform4fv(u.uLow,g),s.uniform4fv(u.uHigh,y)},toObject:function(){return l(this.callSuper("toObject"),{color:this.color,distance:this.distance})}}),a.Image.filters.RemoveColor.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass,r={Brownie:[.5997,.34553,-.27082,0,.186,-.0377,.86095,.15059,0,-.1449,.24113,-.07441,.44972,0,-.02965,0,0,0,1,0],Vintage:[.62793,.32021,-.03965,0,.03784,.02578,.64411,.03259,0,.02926,.0466,-.08512,.52416,0,.02023,0,0,0,1,0],Kodachrome:[1.12855,-.39673,-.03992,0,.24991,-.16404,1.08352,-.05498,0,.09698,-.16786,-.56034,1.60148,0,.13972,0,0,0,1,0],Technicolor:[1.91252,-.85453,-.09155,0,.04624,-.30878,1.76589,-.10601,0,-.27589,-.2311,-.75018,1.84759,0,.12137,0,0,0,1,0],Polaroid:[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],Sepia:[.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0],BlackWhite:[1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,1.5,1.5,1.5,0,-1,0,0,0,1,0]};for(var s in r)l[s]=d(l.ColorMatrix,{type:s,matrix:r[s],mainParameter:!1,colorsOnly:!0}),a.Image.filters[s].fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric,l=a.Image.filters,d=a.util.createClass;l.BlendColor=d(l.BaseFilter,{type:"BlendColor",color:"#F95C63",mode:"multiply",alpha:1,fragmentSource:{multiply:`gl_FragColor.rgb *= uColor.rgb;
`,screen:`gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);
`,add:`gl_FragColor.rgb += uColor.rgb;
`,diff:`gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);
`,subtract:`gl_FragColor.rgb -= uColor.rgb;
`,lighten:`gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);
`,darken:`gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);
`,exclusion:`gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);
`,overlay:`if (uColor.r < 0.5) {
gl_FragColor.r *= 2.0 * uColor.r;
} else {
gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);
}
if (uColor.g < 0.5) {
gl_FragColor.g *= 2.0 * uColor.g;
} else {
gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);
}
if (uColor.b < 0.5) {
gl_FragColor.b *= 2.0 * uColor.b;
} else {
gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);
}
`,tint:`gl_FragColor.rgb *= (1.0 - uColor.a);
gl_FragColor.rgb += uColor.rgb;
`},buildSource:function(r){return`precision highp float;
uniform sampler2D uTexture;
uniform vec4 uColor;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
gl_FragColor = color;
if (color.a > 0.0) {
`+this.fragmentSource[r]+`}
}`},retrieveShader:function(r){var s,u=this.type+"_"+this.mode;return r.programCache.hasOwnProperty(u)||(s=this.buildSource(this.mode),r.programCache[u]=this.createProgram(r.context,s)),r.programCache[u]},applyTo2d:function(r){var s,u,m,f,g,y,E,C=r.imageData.data,T=C.length,D=1-this.alpha;s=(E=new a.Color(this.color).getSource())[0]*this.alpha,u=E[1]*this.alpha,m=E[2]*this.alpha;for(var A=0;A<T;A+=4)switch(f=C[A],g=C[A+1],y=C[A+2],this.mode){case"multiply":C[A]=f*s/255,C[A+1]=g*u/255,C[A+2]=y*m/255;break;case"screen":C[A]=255-(255-f)*(255-s)/255,C[A+1]=255-(255-g)*(255-u)/255,C[A+2]=255-(255-y)*(255-m)/255;break;case"add":C[A]=f+s,C[A+1]=g+u,C[A+2]=y+m;break;case"diff":case"difference":C[A]=Math.abs(f-s),C[A+1]=Math.abs(g-u),C[A+2]=Math.abs(y-m);break;case"subtract":C[A]=f-s,C[A+1]=g-u,C[A+2]=y-m;break;case"darken":C[A]=Math.min(f,s),C[A+1]=Math.min(g,u),C[A+2]=Math.min(y,m);break;case"lighten":C[A]=Math.max(f,s),C[A+1]=Math.max(g,u),C[A+2]=Math.max(y,m);break;case"overlay":C[A]=s<128?2*f*s/255:255-2*(255-f)*(255-s)/255,C[A+1]=u<128?2*g*u/255:255-2*(255-g)*(255-u)/255,C[A+2]=m<128?2*y*m/255:255-2*(255-y)*(255-m)/255;break;case"exclusion":C[A]=s+f-2*s*f/255,C[A+1]=u+g-2*u*g/255,C[A+2]=m+y-2*m*y/255;break;case"tint":C[A]=s+f*D,C[A+1]=u+g*D,C[A+2]=m+y*D}},getUniformLocations:function(r,s){return{uColor:r.getUniformLocation(s,"uColor")}},sendUniformData:function(r,s){var u=new a.Color(this.color).getSource();u[0]=this.alpha*u[0]/255,u[1]=this.alpha*u[1]/255,u[2]=this.alpha*u[2]/255,u[3]=this.alpha,r.uniform4fv(s.uColor,u)},toObject:function(){return{type:this.type,color:this.color,mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendColor.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric,l=a.Image.filters,d=a.util.createClass;l.BlendImage=d(l.BaseFilter,{type:"BlendImage",image:null,mode:"multiply",alpha:1,vertexSource:`attribute vec2 aPosition;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
uniform mat3 uTransformMatrix;
void main() {
vTexCoord = aPosition;
vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;
gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);
}`,fragmentSource:{multiply:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.rgba *= color2.rgba;
gl_FragColor = color;
}`,mask:`precision highp float;
uniform sampler2D uTexture;
uniform sampler2D uImage;
uniform vec4 uColor;
varying vec2 vTexCoord;
varying vec2 vTexCoord2;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec4 color2 = texture2D(uImage, vTexCoord2);
color.a = color2.a;
gl_FragColor = color;
}`},retrieveShader:function(r){var s=this.type+"_"+this.mode,u=this.fragmentSource[this.mode];return r.programCache.hasOwnProperty(s)||(r.programCache[s]=this.createProgram(r.context,u)),r.programCache[s]},applyToWebGL:function(r){var s=r.context,u=this.createTexture(r.filterBackend,this.image);this.bindAdditionalTexture(s,u,s.TEXTURE1),this.callSuper("applyToWebGL",r),this.unbindAdditionalTexture(s,s.TEXTURE1)},createTexture:function(r,s){return r.getCachedTexture(s.cacheKey,s._element)},calculateMatrix:function(){var r=this.image,s=r._element.width,u=r._element.height;return[1/r.scaleX,0,0,0,1/r.scaleY,0,-r.left/s,-r.top/u,1]},applyTo2d:function(r){var s,u,m,f,g,y,E,C,T,D,A,L=r.imageData,U=r.filterBackend.resources,G=L.data,J=G.length,q=L.width,X=L.height,P=this.image;U.blendImage||(U.blendImage=a.util.createCanvasElement()),D=(T=U.blendImage).getContext("2d"),T.width!==q||T.height!==X?(T.width=q,T.height=X):D.clearRect(0,0,q,X),D.setTransform(P.scaleX,0,0,P.scaleY,P.left,P.top),D.drawImage(P._element,0,0,q,X),A=D.getImageData(0,0,q,X).data;for(var N=0;N<J;N+=4)switch(g=G[N],y=G[N+1],E=G[N+2],C=G[N+3],s=A[N],u=A[N+1],m=A[N+2],f=A[N+3],this.mode){case"multiply":G[N]=g*s/255,G[N+1]=y*u/255,G[N+2]=E*m/255,G[N+3]=C*f/255;break;case"mask":G[N+3]=f}},getUniformLocations:function(r,s){return{uTransformMatrix:r.getUniformLocation(s,"uTransformMatrix"),uImage:r.getUniformLocation(s,"uImage")}},sendUniformData:function(r,s){var u=this.calculateMatrix();r.uniform1i(s.uImage,1),r.uniformMatrix3fv(s.uTransformMatrix,!1,u)},toObject:function(){return{type:this.type,image:this.image&&this.image.toObject(),mode:this.mode,alpha:this.alpha}}}),a.Image.filters.BlendImage.fromObject=function(r,s){a.Image.fromObject(r.image,function(u){var m=a.util.object.clone(r);m.image=u,s(new a.Image.filters.BlendImage(m))})}}(e),function(c){var a=c.fabric||(c.fabric={}),l=Math.pow,d=Math.floor,r=Math.sqrt,s=Math.abs,u=Math.round,m=Math.sin,f=Math.ceil,g=a.Image.filters,y=a.util.createClass;g.Resize=y(g.BaseFilter,{type:"Resize",resizeType:"hermite",scaleX:1,scaleY:1,lanczosLobes:3,getUniformLocations:function(E,C){return{uDelta:E.getUniformLocation(C,"uDelta"),uTaps:E.getUniformLocation(C,"uTaps")}},sendUniformData:function(E,C){E.uniform2fv(C.uDelta,this.horizontal?[1/this.width,0]:[0,1/this.height]),E.uniform1fv(C.uTaps,this.taps)},retrieveShader:function(E){var C=this.getFilterWindow(),T=this.type+"_"+C;if(!E.programCache.hasOwnProperty(T)){var D=this.generateShader(C);E.programCache[T]=this.createProgram(E.context,D)}return E.programCache[T]},getFilterWindow:function(){var E=this.tempScale;return Math.ceil(this.lanczosLobes/E)},getTaps:function(){for(var E=this.lanczosCreate(this.lanczosLobes),C=this.tempScale,T=this.getFilterWindow(),D=new Array(T),A=1;A<=T;A++)D[A-1]=E(A*C);return D},generateShader:function(E){for(var C=new Array(E),T=this.fragmentSourceTOP,D=1;D<=E;D++)C[D-1]=D+".0 * uDelta";return T+="uniform float uTaps["+E+`];
`,T+=`void main() {
`,T+=`  vec4 color = texture2D(uTexture, vTexCoord);
`,T+=`  float sum = 1.0;
`,C.forEach(function(A,L){T+="  color += texture2D(uTexture, vTexCoord + "+A+") * uTaps["+L+`];
`,T+="  color += texture2D(uTexture, vTexCoord - "+A+") * uTaps["+L+`];
`,T+="  sum += 2.0 * uTaps["+L+`];
`}),T+=`  gl_FragColor = color / sum;
`,T+="}"},fragmentSourceTOP:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
`,applyTo:function(E){E.webgl?(E.passes++,this.width=E.sourceWidth,this.horizontal=!0,this.dW=Math.round(this.width*this.scaleX),this.dH=E.sourceHeight,this.tempScale=this.dW/this.width,this.taps=this.getTaps(),E.destinationWidth=this.dW,this._setupFrameBuffer(E),this.applyToWebGL(E),this._swapTextures(E),E.sourceWidth=E.destinationWidth,this.height=E.sourceHeight,this.horizontal=!1,this.dH=Math.round(this.height*this.scaleY),this.tempScale=this.dH/this.height,this.taps=this.getTaps(),E.destinationHeight=this.dH,this._setupFrameBuffer(E),this.applyToWebGL(E),this._swapTextures(E),E.sourceHeight=E.destinationHeight):this.applyTo2d(E)},isNeutralState:function(){return this.scaleX===1&&this.scaleY===1},lanczosCreate:function(E){return function(C){if(C>=E||C<=-E)return 0;if(C<11920929e-14&&C>-11920929e-14)return 1;var T=(C*=Math.PI)/E;return m(C)/C*m(T)/T}},applyTo2d:function(E){var C=E.imageData,T=this.scaleX,D=this.scaleY;this.rcpScaleX=1/T,this.rcpScaleY=1/D;var A,L=C.width,U=C.height,G=u(L*T),J=u(U*D);this.resizeType==="sliceHack"?A=this.sliceByTwo(E,L,U,G,J):this.resizeType==="hermite"?A=this.hermiteFastResize(E,L,U,G,J):this.resizeType==="bilinear"?A=this.bilinearFiltering(E,L,U,G,J):this.resizeType==="lanczos"&&(A=this.lanczosResize(E,L,U,G,J)),E.imageData=A},sliceByTwo:function(E,C,T,D,A){var L,U,G=E.imageData,J=.5,q=!1,X=!1,P=C*J,N=T*J,W=a.filterBackend.resources,K=0,ee=0,j=C,k=0;for(W.sliceByTwo||(W.sliceByTwo=document.createElement("canvas")),((L=W.sliceByTwo).width<1.5*C||L.height<T)&&(L.width=1.5*C,L.height=T),(U=L.getContext("2d")).clearRect(0,0,1.5*C,T),U.putImageData(G,0,0),D=d(D),A=d(A);!q||!X;)C=P,T=N,D<d(P*J)?P=d(P*J):(P=D,q=!0),A<d(N*J)?N=d(N*J):(N=A,X=!0),U.drawImage(L,K,ee,C,T,j,k,P,N),K=j,ee=k,k+=N;return U.getImageData(K,ee,D,A)},lanczosResize:function(E,C,T,D,A){var L=E.imageData.data,U=E.ctx.createImageData(D,A),G=U.data,J=this.lanczosCreate(this.lanczosLobes),q=this.rcpScaleX,X=this.rcpScaleY,P=2/this.rcpScaleX,N=2/this.rcpScaleY,W=f(q*this.lanczosLobes/2),K=f(X*this.lanczosLobes/2),ee={},j={},k={};return function $(te){var Q,ne,ae,re,ie,oe,se,fe,_e,ge,Ae;for(j.x=(te+.5)*q,k.x=d(j.x),Q=0;Q<A;Q++){for(j.y=(Q+.5)*X,k.y=d(j.y),ie=0,oe=0,se=0,fe=0,_e=0,ne=k.x-W;ne<=k.x+W;ne++)if(!(ne<0||ne>=C)){ge=d(1e3*s(ne-j.x)),ee[ge]||(ee[ge]={});for(var We=k.y-K;We<=k.y+K;We++)We<0||We>=T||(Ae=d(1e3*s(We-j.y)),ee[ge][Ae]||(ee[ge][Ae]=J(r(l(ge*P,2)+l(Ae*N,2))/1e3)),(ae=ee[ge][Ae])>0&&(ie+=ae,oe+=ae*L[re=4*(We*C+ne)],se+=ae*L[re+1],fe+=ae*L[re+2],_e+=ae*L[re+3]))}G[re=4*(Q*D+te)]=oe/ie,G[re+1]=se/ie,G[re+2]=fe/ie,G[re+3]=_e/ie}return++te<D?$(te):U}(0)},bilinearFiltering:function(E,C,T,D,A){var L,U,G,J,q,X,P,N,W,K=0,ee=this.rcpScaleX,j=this.rcpScaleY,k=4*(C-1),$=E.imageData.data,te=E.ctx.createImageData(D,A),Q=te.data;for(G=0;G<A;G++)for(J=0;J<D;J++)for(q=ee*J-(L=d(ee*J)),X=j*G-(U=d(j*G)),W=4*(U*C+L),P=0;P<4;P++)N=$[W+P]*(1-q)*(1-X)+$[W+4+P]*q*(1-X)+$[W+k+P]*X*(1-q)+$[W+k+4+P]*q*X,Q[K++]=N;return te},hermiteFastResize:function(E,C,T,D,A){for(var L=this.rcpScaleX,U=this.rcpScaleY,G=f(L/2),J=f(U/2),q=E.imageData.data,X=E.ctx.createImageData(D,A),P=X.data,N=0;N<A;N++)for(var W=0;W<D;W++){for(var K=4*(W+N*D),ee=0,j=0,k=0,$=0,te=0,Q=0,ne=0,ae=(N+.5)*U,re=d(N*U);re<(N+1)*U;re++)for(var ie=s(ae-(re+.5))/J,oe=(W+.5)*L,se=ie*ie,fe=d(W*L);fe<(W+1)*L;fe++){var _e=s(oe-(fe+.5))/G,ge=r(se+_e*_e);ge>1&&ge<-1||(ee=2*ge*ge*ge-3*ge*ge+1)>0&&(ne+=ee*q[3+(_e=4*(fe+re*C))],k+=ee,q[_e+3]<255&&(ee=ee*q[_e+3]/250),$+=ee*q[_e],te+=ee*q[_e+1],Q+=ee*q[_e+2],j+=ee)}P[K]=$/j,P[K+1]=te/j,P[K+2]=Q/j,P[K+3]=ne/k}return X},toObject:function(){return{type:this.type,scaleX:this.scaleX,scaleY:this.scaleY,resizeType:this.resizeType,lanczosLobes:this.lanczosLobes}}}),a.Image.filters.Resize.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Contrast=d(l.BaseFilter,{type:"Contrast",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uContrast;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));
color.rgb = contrastF * (color.rgb - 0.5) + 0.5;
gl_FragColor = color;
}`,contrast:0,mainParameter:"contrast",applyTo2d:function(r){if(this.contrast!==0){var s,u=r.imageData.data,m=u.length,f=Math.floor(255*this.contrast),g=259*(f+255)/(255*(259-f));for(s=0;s<m;s+=4)u[s]=g*(u[s]-128)+128,u[s+1]=g*(u[s+1]-128)+128,u[s+2]=g*(u[s+2]-128)+128}},getUniformLocations:function(r,s){return{uContrast:r.getUniformLocation(s,"uContrast")}},sendUniformData:function(r,s){r.uniform1f(s.uContrast,this.contrast)}}),a.Image.filters.Contrast.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Saturation=d(l.BaseFilter,{type:"Saturation",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uSaturation;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float rgMax = max(color.r, color.g);
float rgbMax = max(rgMax, color.b);
color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;
color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;
color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;
gl_FragColor = color;
}`,saturation:0,mainParameter:"saturation",applyTo2d:function(r){if(this.saturation!==0){var s,u,m=r.imageData.data,f=m.length,g=-this.saturation;for(s=0;s<f;s+=4)u=Math.max(m[s],m[s+1],m[s+2]),m[s]+=u!==m[s]?(u-m[s])*g:0,m[s+1]+=u!==m[s+1]?(u-m[s+1])*g:0,m[s+2]+=u!==m[s+2]?(u-m[s+2])*g:0}},getUniformLocations:function(r,s){return{uSaturation:r.getUniformLocation(s,"uSaturation")}},sendUniformData:function(r,s){r.uniform1f(s.uSaturation,-this.saturation)}}),a.Image.filters.Saturation.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Vibrance=d(l.BaseFilter,{type:"Vibrance",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform float uVibrance;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
float max = max(color.r, max(color.g, color.b));
float avg = (color.r + color.g + color.b) / 3.0;
float amt = (abs(max - avg) * 2.0) * uVibrance;
color.r += max != color.r ? (max - color.r) * amt : 0.00;
color.g += max != color.g ? (max - color.g) * amt : 0.00;
color.b += max != color.b ? (max - color.b) * amt : 0.00;
gl_FragColor = color;
}`,vibrance:0,mainParameter:"vibrance",applyTo2d:function(r){if(this.vibrance!==0){var s,u,m,f,g=r.imageData.data,y=g.length,E=-this.vibrance;for(s=0;s<y;s+=4)u=Math.max(g[s],g[s+1],g[s+2]),m=(g[s]+g[s+1]+g[s+2])/3,f=2*Math.abs(u-m)/255*E,g[s]+=u!==g[s]?(u-g[s])*f:0,g[s+1]+=u!==g[s+1]?(u-g[s+1])*f:0,g[s+2]+=u!==g[s+2]?(u-g[s+2])*f:0}},getUniformLocations:function(r,s){return{uVibrance:r.getUniformLocation(s,"uVibrance")}},sendUniformData:function(r,s){r.uniform1f(s.uVibrance,-this.vibrance)}}),a.Image.filters.Vibrance.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Blur=d(l.BaseFilter,{type:"Blur",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec2 uDelta;
varying vec2 vTexCoord;
const float nSamples = 15.0;
vec3 v3offset = vec3(12.9898, 78.233, 151.7182);
float random(vec3 scale) {
return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);
}
void main() {
vec4 color = vec4(0.0);
float total = 0.0;
float offset = random(v3offset);
for (float t = -nSamples; t <= nSamples; t++) {
float percent = (t + offset - 0.5) / nSamples;
float weight = 1.0 - abs(percent);
color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;
total += weight;
}
gl_FragColor = color / total;
}`,blur:0,mainParameter:"blur",applyTo:function(r){r.webgl?(this.aspectRatio=r.sourceWidth/r.sourceHeight,r.passes++,this._setupFrameBuffer(r),this.horizontal=!0,this.applyToWebGL(r),this._swapTextures(r),this._setupFrameBuffer(r),this.horizontal=!1,this.applyToWebGL(r),this._swapTextures(r)):this.applyTo2d(r)},applyTo2d:function(r){r.imageData=this.simpleBlur(r)},simpleBlur:function(r){var s,u,m=r.filterBackend.resources,f=r.imageData.width,g=r.imageData.height;m.blurLayer1||(m.blurLayer1=a.util.createCanvasElement(),m.blurLayer2=a.util.createCanvasElement()),s=m.blurLayer1,u=m.blurLayer2,s.width===f&&s.height===g||(u.width=s.width=f,u.height=s.height=g);var y,E,C,T,D=s.getContext("2d"),A=u.getContext("2d"),L=.06*this.blur*.5;for(D.putImageData(r.imageData,0,0),A.clearRect(0,0,f,g),T=-15;T<=15;T++)C=L*(E=T/15)*f+(y=(Math.random()-.5)/4),A.globalAlpha=1-Math.abs(E),A.drawImage(s,C,y),D.drawImage(u,0,0),A.globalAlpha=1,A.clearRect(0,0,u.width,u.height);for(T=-15;T<=15;T++)C=L*(E=T/15)*g+(y=(Math.random()-.5)/4),A.globalAlpha=1-Math.abs(E),A.drawImage(s,y,C),D.drawImage(u,0,0),A.globalAlpha=1,A.clearRect(0,0,u.width,u.height);r.ctx.drawImage(s,0,0);var U=r.ctx.getImageData(0,0,s.width,s.height);return D.globalAlpha=1,D.clearRect(0,0,s.width,s.height),U},getUniformLocations:function(r,s){return{delta:r.getUniformLocation(s,"uDelta")}},sendUniformData:function(r,s){var u=this.chooseRightDelta();r.uniform2fv(s.delta,u)},chooseRightDelta:function(){var r,s=1,u=[0,0];return this.horizontal?this.aspectRatio>1&&(s=1/this.aspectRatio):this.aspectRatio<1&&(s=this.aspectRatio),r=s*this.blur*.12,this.horizontal?u[0]=r:u[1]=r,u}}),l.Blur.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Gamma=d(l.BaseFilter,{type:"Gamma",fragmentSource:`precision highp float;
uniform sampler2D uTexture;
uniform vec3 uGamma;
varying vec2 vTexCoord;
void main() {
vec4 color = texture2D(uTexture, vTexCoord);
vec3 correction = (1.0 / uGamma);
color.r = pow(color.r, correction.r);
color.g = pow(color.g, correction.g);
color.b = pow(color.b, correction.b);
gl_FragColor = color;
gl_FragColor.rgb *= color.a;
}`,gamma:[1,1,1],mainParameter:"gamma",initialize:function(r){this.gamma=[1,1,1],l.BaseFilter.prototype.initialize.call(this,r)},applyTo2d:function(r){var s,u=r.imageData.data,m=this.gamma,f=u.length,g=1/m[0],y=1/m[1],E=1/m[2];for(this.rVals||(this.rVals=new Uint8Array(256),this.gVals=new Uint8Array(256),this.bVals=new Uint8Array(256)),s=0,f=256;s<f;s++)this.rVals[s]=255*Math.pow(s/255,g),this.gVals[s]=255*Math.pow(s/255,y),this.bVals[s]=255*Math.pow(s/255,E);for(s=0,f=u.length;s<f;s+=4)u[s]=this.rVals[u[s]],u[s+1]=this.gVals[u[s+1]],u[s+2]=this.bVals[u[s+2]]},getUniformLocations:function(r,s){return{uGamma:r.getUniformLocation(s,"uGamma")}},sendUniformData:function(r,s){r.uniform3fv(s.uGamma,this.gamma)}}),a.Image.filters.Gamma.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.Composed=d(l.BaseFilter,{type:"Composed",subFilters:[],initialize:function(r){this.callSuper("initialize",r),this.subFilters=this.subFilters.slice(0)},applyTo:function(r){r.passes+=this.subFilters.length-1,this.subFilters.forEach(function(s){s.applyTo(r)})},toObject:function(){return a.util.object.extend(this.callSuper("toObject"),{subFilters:this.subFilters.map(function(r){return r.toObject()})})},isNeutralState:function(){return!this.subFilters.some(function(r){return!r.isNeutralState()})}}),a.Image.filters.Composed.fromObject=function(r,s){var u=(r.subFilters||[]).map(function(f){return new a.Image.filters[f.type](f)}),m=new a.Image.filters.Composed({subFilters:u});return s&&s(m),m}}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.Image.filters,d=a.util.createClass;l.HueRotation=d(l.ColorMatrix,{type:"HueRotation",rotation:0,mainParameter:"rotation",calculateMatrix:function(){var r=this.rotation*Math.PI,s=a.util.cos(r),u=a.util.sin(r),m=1/3,f=Math.sqrt(m)*u,g=1-s;this.matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],this.matrix[0]=s+g/3,this.matrix[1]=m*g-f,this.matrix[2]=m*g+f,this.matrix[5]=m*g+f,this.matrix[6]=s+m*g,this.matrix[7]=m*g-f,this.matrix[10]=m*g-f,this.matrix[11]=m*g+f,this.matrix[12]=s+m*g},isNeutralState:function(r){return this.calculateMatrix(),l.BaseFilter.prototype.isNeutralState.call(this,r)},applyTo:function(r){this.calculateMatrix(),l.BaseFilter.prototype.applyTo.call(this,r)}}),a.Image.filters.HueRotation.fromObject=a.Image.filters.BaseFilter.fromObject}(e),function(c){var a=c.fabric||(c.fabric={}),l=a.util.object.clone;if(a.Text)a.warn("fabric.Text is already defined");else{var d="fontFamily fontWeight fontSize text underline overline linethrough textAlign fontStyle lineHeight textBackgroundColor charSpacing styles direction path pathStartOffset pathSide pathAlign".split(" ");a.Text=a.util.createClass(a.Object,{_dimensionAffectingProps:["fontSize","fontWeight","fontFamily","fontStyle","lineHeight","text","charSpacing","textAlign","styles","path","pathStartOffset","pathSide","pathAlign"],_reNewline:/\r?\n/,_reSpacesAndTabs:/[ \t\r]/g,_reSpaceAndTab:/[ \t\r]/,_reWords:/\S+/g,type:"text",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",underline:!1,overline:!1,linethrough:!1,textAlign:"left",fontStyle:"normal",lineHeight:1.16,superscript:{size:.6,baseline:-.35},subscript:{size:.6,baseline:.11},textBackgroundColor:"",stateProperties:a.Object.prototype.stateProperties.concat(d),cacheProperties:a.Object.prototype.cacheProperties.concat(d),stroke:null,shadow:null,path:null,pathStartOffset:0,pathSide:"left",pathAlign:"baseline",_fontSizeFraction:.222,offsets:{underline:.1,linethrough:-.315,overline:-.88},_fontSizeMult:1.13,charSpacing:0,styles:null,_measuringContext:null,deltaY:0,direction:"ltr",_styleProperties:["stroke","strokeWidth","fill","fontFamily","fontSize","fontWeight","fontStyle","underline","overline","linethrough","deltaY","textBackgroundColor"],__charBounds:[],CACHE_FONT_SIZE:400,MIN_TEXT_WIDTH:2,initialize:function(r,s){this.styles=s&&s.styles||{},this.text=r,this.__skipDimension=!0,this.callSuper("initialize",s),this.path&&this.setPathInfo(),this.__skipDimension=!1,this.initDimensions(),this.setCoords(),this.setupState({propertySet:"_dimensionAffectingProps"})},setPathInfo:function(){var r=this.path;r&&(r.segmentsInfo=a.util.getPathSegmentsInfo(r.path))},getMeasuringContext:function(){return a._measuringContext||(a._measuringContext=this.canvas&&this.canvas.contextCache||a.util.createCanvasElement().getContext("2d")),a._measuringContext},_splitText:function(){var r=this._splitTextIntoLines(this.text);return this.textLines=r.lines,this._textLines=r.graphemeLines,this._unwrappedTextLines=r._unwrappedLines,this._text=r.graphemeText,r},initDimensions:function(){this.__skipDimension||(this._splitText(),this._clearCache(),this.path?(this.width=this.path.width,this.height=this.path.height):(this.width=this.calcTextWidth()||this.cursorWidth||this.MIN_TEXT_WIDTH,this.height=this.calcTextHeight()),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.saveState({propertySet:"_dimensionAffectingProps"}))},enlargeSpaces:function(){for(var r,s,u,m,f,g,y,E=0,C=this._textLines.length;E<C;E++)if((this.textAlign==="justify"||E!==C-1&&!this.isEndOfWrapping(E))&&(m=0,f=this._textLines[E],(s=this.getLineWidth(E))<this.width&&(y=this.textLines[E].match(this._reSpacesAndTabs)))){u=y.length,r=(this.width-s)/u;for(var T=0,D=f.length;T<=D;T++)g=this.__charBounds[E][T],this._reSpaceAndTab.test(f[T])?(g.width+=r,g.kernedWidth+=r,g.left+=m,m+=r):g.left+=m}},isEndOfWrapping:function(r){return r===this._textLines.length-1},missingNewlineOffset:function(){return 1},toString:function(){return"#<fabric.Text ("+this.complexity()+'): { "text": "'+this.text+'", "fontFamily": "'+this.fontFamily+'" }>'},_getCacheCanvasDimensions:function(){var r=this.callSuper("_getCacheCanvasDimensions"),s=this.fontSize;return r.width+=s*r.zoomX,r.height+=s*r.zoomY,r},_render:function(r){var s=this.path;s&&!s.isNotVisible()&&s._render(r),this._setTextStyles(r),this._renderTextLinesBackground(r),this._renderTextDecoration(r,"underline"),this._renderText(r),this._renderTextDecoration(r,"overline"),this._renderTextDecoration(r,"linethrough")},_renderText:function(r){this.paintFirst==="stroke"?(this._renderTextStroke(r),this._renderTextFill(r)):(this._renderTextFill(r),this._renderTextStroke(r))},_setTextStyles:function(r,s,u){if(r.textBaseline="alphabetical",this.path)switch(this.pathAlign){case"center":r.textBaseline="middle";break;case"ascender":r.textBaseline="top";break;case"descender":r.textBaseline="bottom"}r.font=this._getFontDeclaration(s,u)},calcTextWidth:function(){for(var r=this.getLineWidth(0),s=1,u=this._textLines.length;s<u;s++){var m=this.getLineWidth(s);m>r&&(r=m)}return r},_renderTextLine:function(r,s,u,m,f,g){this._renderChars(r,s,u,m,f,g)},_renderTextLinesBackground:function(r){if(this.textBackgroundColor||this.styleHas("textBackgroundColor")){for(var s,u,m,f,g,y,E,C=r.fillStyle,T=this._getLeftOffset(),D=this._getTopOffset(),A=0,L=0,U=this.path,G=0,J=this._textLines.length;G<J;G++)if(s=this.getHeightOfLine(G),this.textBackgroundColor||this.styleHas("textBackgroundColor",G)){m=this._textLines[G],u=this._getLineLeftOffset(G),L=0,A=0,f=this.getValueOfPropertyAt(G,0,"textBackgroundColor");for(var q=0,X=m.length;q<X;q++)g=this.__charBounds[G][q],y=this.getValueOfPropertyAt(G,q,"textBackgroundColor"),U?(r.save(),r.translate(g.renderLeft,g.renderTop),r.rotate(g.angle),r.fillStyle=y,y&&r.fillRect(-g.width/2,-s/this.lineHeight*(1-this._fontSizeFraction),g.width,s/this.lineHeight),r.restore()):y!==f?(E=T+u+A,this.direction==="rtl"&&(E=this.width-E-L),r.fillStyle=f,f&&r.fillRect(E,D,L,s/this.lineHeight),A=g.left,L=g.width,f=y):L+=g.kernedWidth;y&&!U&&(E=T+u+A,this.direction==="rtl"&&(E=this.width-E-L),r.fillStyle=y,r.fillRect(E,D,L,s/this.lineHeight)),D+=s}else D+=s;r.fillStyle=C,this._removeShadow(r)}},getFontCache:function(r){var s=r.fontFamily.toLowerCase();a.charWidthsCache[s]||(a.charWidthsCache[s]={});var u=a.charWidthsCache[s],m=r.fontStyle.toLowerCase()+"_"+(r.fontWeight+"").toLowerCase();return u[m]||(u[m]={}),u[m]},_measureChar:function(r,s,u,m){var f,g,y,E,C=this.getFontCache(s),T=u+r,D=this._getFontDeclaration(s)===this._getFontDeclaration(m),A=s.fontSize/this.CACHE_FONT_SIZE;if(u&&C[u]!==void 0&&(y=C[u]),C[r]!==void 0&&(E=f=C[r]),D&&C[T]!==void 0&&(E=(g=C[T])-y),f===void 0||y===void 0||g===void 0){var L=this.getMeasuringContext();this._setTextStyles(L,s,!0)}return f===void 0&&(E=f=L.measureText(r).width,C[r]=f),y===void 0&&D&&u&&(y=L.measureText(u).width,C[u]=y),D&&g===void 0&&(g=L.measureText(T).width,C[T]=g,E=g-y),{width:f*A,kernedWidth:E*A}},getHeightOfChar:function(r,s){return this.getValueOfPropertyAt(r,s,"fontSize")},measureLine:function(r){var s=this._measureLine(r);return this.charSpacing!==0&&(s.width-=this._getWidthOfCharSpacing()),s.width<0&&(s.width=0),s},_measureLine:function(r){var s,u,m,f,g,y,E=0,C=this._textLines[r],T=new Array(C.length),D=0,A=this.path,L=this.pathSide==="right";for(this.__charBounds[r]=T,s=0;s<C.length;s++)u=C[s],f=this._getGraphemeBox(u,r,s,m),T[s]=f,E+=f.kernedWidth,m=u;if(T[s]={left:f?f.left+f.width:0,width:0,kernedWidth:0,height:this.fontSize},A){switch(y=A.segmentsInfo[A.segmentsInfo.length-1].length,(g=a.util.getPointOnPath(A.path,0,A.segmentsInfo)).x+=A.pathOffset.x,g.y+=A.pathOffset.y,this.textAlign){case"left":D=L?y-E:0;break;case"center":D=(y-E)/2;break;case"right":D=L?0:y-E}for(D+=this.pathStartOffset*(L?-1:1),s=L?C.length-1:0;L?s>=0:s<C.length;L?s--:s++)f=T[s],D>y?D%=y:D<0&&(D+=y),this._setGraphemeOnPath(D,f,g),D+=f.kernedWidth}return{width:E,numOfSpaces:0}},_setGraphemeOnPath:function(r,s,u){var m=r+s.kernedWidth/2,f=this.path,g=a.util.getPointOnPath(f.path,m,f.segmentsInfo);s.renderLeft=g.x-u.x,s.renderTop=g.y-u.y,s.angle=g.angle+(this.pathSide==="right"?Math.PI:0)},_getGraphemeBox:function(r,s,u,m,f){var g,y=this.getCompleteStyleDeclaration(s,u),E=m?this.getCompleteStyleDeclaration(s,u-1):{},C=this._measureChar(r,y,m,E),T=C.kernedWidth,D=C.width;this.charSpacing!==0&&(D+=g=this._getWidthOfCharSpacing(),T+=g);var A={width:D,left:0,height:y.fontSize,kernedWidth:T,deltaY:y.deltaY};if(u>0&&!f){var L=this.__charBounds[s][u-1];A.left=L.left+L.width+C.kernedWidth-C.width}return A},getHeightOfLine:function(r){if(this.__lineHeights[r])return this.__lineHeights[r];for(var s=this._textLines[r],u=this.getHeightOfChar(r,0),m=1,f=s.length;m<f;m++)u=Math.max(this.getHeightOfChar(r,m),u);return this.__lineHeights[r]=u*this.lineHeight*this._fontSizeMult},calcTextHeight:function(){for(var r,s=0,u=0,m=this._textLines.length;u<m;u++)r=this.getHeightOfLine(u),s+=u===m-1?r/this.lineHeight:r;return s},_getLeftOffset:function(){return this.direction==="ltr"?-this.width/2:this.width/2},_getTopOffset:function(){return-this.height/2},_renderTextCommon:function(r,s){r.save();for(var u=0,m=this._getLeftOffset(),f=this._getTopOffset(),g=0,y=this._textLines.length;g<y;g++){var E=this.getHeightOfLine(g),C=E/this.lineHeight,T=this._getLineLeftOffset(g);this._renderTextLine(s,r,this._textLines[g],m+T,f+u+C,g),u+=E}r.restore()},_renderTextFill:function(r){(this.fill||this.styleHas("fill"))&&this._renderTextCommon(r,"fillText")},_renderTextStroke:function(r){(this.stroke&&this.strokeWidth!==0||!this.isEmptyStyles())&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(r),r.save(),this._setLineDash(r,this.strokeDashArray),r.beginPath(),this._renderTextCommon(r,"strokeText"),r.closePath(),r.restore())},_renderChars:function(r,s,u,m,f,g){var y,E,C,T,D,A=this.getHeightOfLine(g),L=this.textAlign.indexOf("justify")!==-1,U="",G=0,J=this.path,q=!L&&this.charSpacing===0&&this.isEmptyStyles(g)&&!J,X=this.direction==="ltr",P=this.direction==="ltr"?1:-1,N=s.canvas.getAttribute("dir");if(s.save(),N!==this.direction&&(s.canvas.setAttribute("dir",X?"ltr":"rtl"),s.direction=X?"ltr":"rtl",s.textAlign=X?"left":"right"),f-=A*this._fontSizeFraction/this.lineHeight,q)return this._renderChar(r,s,g,0,u.join(""),m,f,A),void s.restore();for(var W=0,K=u.length-1;W<=K;W++)T=W===K||this.charSpacing||J,U+=u[W],C=this.__charBounds[g][W],G===0?(m+=P*(C.kernedWidth-C.width),G+=C.width):G+=C.kernedWidth,L&&!T&&this._reSpaceAndTab.test(u[W])&&(T=!0),T||(y=y||this.getCompleteStyleDeclaration(g,W),E=this.getCompleteStyleDeclaration(g,W+1),T=this._hasStyleChanged(y,E)),T&&(J?(s.save(),s.translate(C.renderLeft,C.renderTop),s.rotate(C.angle),this._renderChar(r,s,g,W,U,-G/2,0,A),s.restore()):(D=m,this._renderChar(r,s,g,W,U,D,f,A)),U="",y=E,m+=P*G,G=0);s.restore()},_applyPatternGradientTransformText:function(r){var s,u=a.util.createCanvasElement(),m=this.width+this.strokeWidth,f=this.height+this.strokeWidth;return u.width=m,u.height=f,(s=u.getContext("2d")).beginPath(),s.moveTo(0,0),s.lineTo(m,0),s.lineTo(m,f),s.lineTo(0,f),s.closePath(),s.translate(m/2,f/2),s.fillStyle=r.toLive(s),this._applyPatternGradientTransform(s,r),s.fill(),s.createPattern(u,"no-repeat")},handleFiller:function(r,s,u){var m,f;return u.toLive?u.gradientUnits==="percentage"||u.gradientTransform||u.patternTransform?(m=-this.width/2,f=-this.height/2,r.translate(m,f),r[s]=this._applyPatternGradientTransformText(u),{offsetX:m,offsetY:f}):(r[s]=u.toLive(r,this),this._applyPatternGradientTransform(r,u)):(r[s]=u,{offsetX:0,offsetY:0})},_setStrokeStyles:function(r,s){return r.lineWidth=s.strokeWidth,r.lineCap=this.strokeLineCap,r.lineDashOffset=this.strokeDashOffset,r.lineJoin=this.strokeLineJoin,r.miterLimit=this.strokeMiterLimit,this.handleFiller(r,"strokeStyle",s.stroke)},_setFillStyles:function(r,s){return this.handleFiller(r,"fillStyle",s.fill)},_renderChar:function(r,s,u,m,f,g,y){var E,C,T=this._getStyleDeclaration(u,m),D=this.getCompleteStyleDeclaration(u,m),A=r==="fillText"&&D.fill,L=r==="strokeText"&&D.stroke&&D.strokeWidth;(L||A)&&(s.save(),A&&(E=this._setFillStyles(s,D)),L&&(C=this._setStrokeStyles(s,D)),s.font=this._getFontDeclaration(D),T&&T.textBackgroundColor&&this._removeShadow(s),T&&T.deltaY&&(y+=T.deltaY),A&&s.fillText(f,g-E.offsetX,y-E.offsetY),L&&s.strokeText(f,g-C.offsetX,y-C.offsetY),s.restore())},setSuperscript:function(r,s){return this._setScript(r,s,this.superscript)},setSubscript:function(r,s){return this._setScript(r,s,this.subscript)},_setScript:function(r,s,u){var m=this.get2DCursorLocation(r,!0),f=this.getValueOfPropertyAt(m.lineIndex,m.charIndex,"fontSize"),g=this.getValueOfPropertyAt(m.lineIndex,m.charIndex,"deltaY"),y={fontSize:f*u.size,deltaY:g+f*u.baseline};return this.setSelectionStyles(y,r,s),this},_hasStyleChanged:function(r,s){return r.fill!==s.fill||r.stroke!==s.stroke||r.strokeWidth!==s.strokeWidth||r.fontSize!==s.fontSize||r.fontFamily!==s.fontFamily||r.fontWeight!==s.fontWeight||r.fontStyle!==s.fontStyle||r.deltaY!==s.deltaY},_hasStyleChangedForSvg:function(r,s){return this._hasStyleChanged(r,s)||r.overline!==s.overline||r.underline!==s.underline||r.linethrough!==s.linethrough},_getLineLeftOffset:function(r){var s=this.getLineWidth(r),u=this.width-s,m=this.textAlign,f=this.direction,g=0,y=this.isEndOfWrapping(r);return m==="justify"||m==="justify-center"&&!y||m==="justify-right"&&!y||m==="justify-left"&&!y?0:(m==="center"&&(g=u/2),m==="right"&&(g=u),m==="justify-center"&&(g=u/2),m==="justify-right"&&(g=u),f==="rtl"&&(g-=u),g)},_clearCache:function(){this.__lineWidths=[],this.__lineHeights=[],this.__charBounds=[]},_shouldClearDimensionCache:function(){var r=this._forceClearCache;return r||(r=this.hasStateChanged("_dimensionAffectingProps")),r&&(this.dirty=!0,this._forceClearCache=!1),r},getLineWidth:function(r){if(this.__lineWidths[r]!==void 0)return this.__lineWidths[r];var s=this.measureLine(r).width;return this.__lineWidths[r]=s,s},_getWidthOfCharSpacing:function(){return this.charSpacing!==0?this.fontSize*this.charSpacing/1e3:0},getValueOfPropertyAt:function(r,s,u){var m=this._getStyleDeclaration(r,s);return m&&m[u]!==void 0?m[u]:this[u]},_renderTextDecoration:function(r,s){if(this[s]||this.styleHas(s)){for(var u,m,f,g,y,E,C,T,D,A,L,U,G,J,q,X,P=this._getLeftOffset(),N=this._getTopOffset(),W=this.path,K=this._getWidthOfCharSpacing(),ee=this.offsets[s],j=0,k=this._textLines.length;j<k;j++)if(u=this.getHeightOfLine(j),this[s]||this.styleHas(s,j)){C=this._textLines[j],J=u/this.lineHeight,g=this._getLineLeftOffset(j),A=0,L=0,T=this.getValueOfPropertyAt(j,0,s),X=this.getValueOfPropertyAt(j,0,"fill"),D=N+J*(1-this._fontSizeFraction),m=this.getHeightOfChar(j,0),y=this.getValueOfPropertyAt(j,0,"deltaY");for(var $=0,te=C.length;$<te;$++)if(U=this.__charBounds[j][$],G=this.getValueOfPropertyAt(j,$,s),q=this.getValueOfPropertyAt(j,$,"fill"),f=this.getHeightOfChar(j,$),E=this.getValueOfPropertyAt(j,$,"deltaY"),W&&G&&q)r.save(),r.fillStyle=X,r.translate(U.renderLeft,U.renderTop),r.rotate(U.angle),r.fillRect(-U.kernedWidth/2,ee*f+E,U.kernedWidth,this.fontSize/15),r.restore();else if((G!==T||q!==X||f!==m||E!==y)&&L>0){var Q=P+g+A;this.direction==="rtl"&&(Q=this.width-Q-L),T&&X&&(r.fillStyle=X,r.fillRect(Q,D+ee*m+y,L,this.fontSize/15)),A=U.left,L=U.width,T=G,X=q,m=f,y=E}else L+=U.kernedWidth;Q=P+g+A,this.direction==="rtl"&&(Q=this.width-Q-L),r.fillStyle=q,G&&q&&r.fillRect(Q,D+ee*m+y,L-K,this.fontSize/15),N+=u}else N+=u;this._removeShadow(r)}},_getFontDeclaration:function(r,s){var u=r||this,m=this.fontFamily,f=a.Text.genericFonts.indexOf(m.toLowerCase())>-1,g=m===void 0||m.indexOf("'")>-1||m.indexOf(",")>-1||m.indexOf('"')>-1||f?u.fontFamily:'"'+u.fontFamily+'"';return[a.isLikelyNode?u.fontWeight:u.fontStyle,a.isLikelyNode?u.fontStyle:u.fontWeight,s?this.CACHE_FONT_SIZE+"px":u.fontSize+"px",g].join(" ")},render:function(r){this.visible&&(this.canvas&&this.canvas.skipOffscreen&&!this.group&&!this.isOnScreen()||(this._shouldClearDimensionCache()&&this.initDimensions(),this.callSuper("render",r)))},_splitTextIntoLines:function(r){for(var s=r.split(this._reNewline),u=new Array(s.length),m=[`
`],f=[],g=0;g<s.length;g++)u[g]=a.util.string.graphemeSplit(s[g]),f=f.concat(u[g],m);return f.pop(),{_unwrappedLines:u,lines:s,graphemeText:f,graphemeLines:u}},toObject:function(r){var s=d.concat(r),u=this.callSuper("toObject",s);return u.styles=l(this.styles,!0),u.path&&(u.path=this.path.toObject()),u},set:function(r,s){this.callSuper("set",r,s);var u=!1,m=!1;if(typeof r=="object")for(var f in r)f==="path"&&this.setPathInfo(),u=u||this._dimensionAffectingProps.indexOf(f)!==-1,m=m||f==="path";else u=this._dimensionAffectingProps.indexOf(r)!==-1,m=r==="path";return m&&this.setPathInfo(),u&&(this.initDimensions(),this.setCoords()),this},complexity:function(){return 1}}),a.Text.ATTRIBUTE_NAMES=a.SHARED_ATTRIBUTES.concat("x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor".split(" ")),a.Text.DEFAULT_SVG_FONT_SIZE=16,a.Text.fromElement=function(r,s,u){if(!r)return s(null);var m=a.parseAttributes(r,a.Text.ATTRIBUTE_NAMES),f=m.textAnchor||"left";if((u=a.util.object.extend(u?l(u):{},m)).top=u.top||0,u.left=u.left||0,m.textDecoration){var g=m.textDecoration;g.indexOf("underline")!==-1&&(u.underline=!0),g.indexOf("overline")!==-1&&(u.overline=!0),g.indexOf("line-through")!==-1&&(u.linethrough=!0),delete u.textDecoration}"dx"in m&&(u.left+=m.dx),"dy"in m&&(u.top+=m.dy),"fontSize"in u||(u.fontSize=a.Text.DEFAULT_SVG_FONT_SIZE);var y="";"textContent"in r?y=r.textContent:"firstChild"in r&&r.firstChild!==null&&"data"in r.firstChild&&r.firstChild.data!==null&&(y=r.firstChild.data),y=y.replace(/^\s+|\s+$|\n+/g,"").replace(/\s+/g," ");var E=u.strokeWidth;u.strokeWidth=0;var C=new a.Text(y,u),T=C.getScaledHeight()/C.height,D=((C.height+C.strokeWidth)*C.lineHeight-C.height)*T,A=C.getScaledHeight()+D,L=0;f==="center"&&(L=C.getScaledWidth()/2),f==="right"&&(L=C.getScaledWidth()),C.set({left:C.left-L,top:C.top-(A-C.fontSize*(.07+C._fontSizeFraction))/C.lineHeight,strokeWidth:E!==void 0?E:1}),s(C)},a.Text.fromObject=function(r,s){var u=l(r),m=r.path;return delete u.path,a.Object._fromObject("Text",u,function(f){m?a.Object._fromObject("Path",m,function(g){f.set("path",g),s(f)},"path"):s(f)},"text")},a.Text.genericFonts=["sans-serif","serif","cursive","fantasy","monospace"],a.util.createAccessors&&a.util.createAccessors(a.Text)}}(e),_.util.object.extend(_.Text.prototype,{isEmptyStyles:function(c){if(!this.styles||c!==void 0&&!this.styles[c])return!0;var a=c===void 0?this.styles:{line:this.styles[c]};for(var l in a)for(var d in a[l])for(var r in a[l][d])return!1;return!0},styleHas:function(c,a){if(!this.styles||!c||c===""||a!==void 0&&!this.styles[a])return!1;var l=a===void 0?this.styles:{0:this.styles[a]};for(var d in l)for(var r in l[d])if(l[d][r][c]!==void 0)return!0;return!1},cleanStyle:function(c){if(!this.styles||!c||c==="")return!1;var a,l,d=this.styles,r=0,s=!0,u=0;for(var m in d){for(var f in a=0,d[m]){var g;r++,(g=d[m][f]).hasOwnProperty(c)?(l?g[c]!==l&&(s=!1):l=g[c],g[c]===this[c]&&delete g[c]):s=!1,Object.keys(g).length!==0?a++:delete d[m][f]}a===0&&delete d[m]}for(var y=0;y<this._textLines.length;y++)u+=this._textLines[y].length;s&&r===u&&(this[c]=l,this.removeStyle(c))},removeStyle:function(c){if(this.styles&&c&&c!==""){var a,l,d,r=this.styles;for(l in r){for(d in a=r[l])delete a[d][c],Object.keys(a[d]).length===0&&delete a[d];Object.keys(a).length===0&&delete r[l]}}},_extendStyles:function(c,a){var l=this.get2DCursorLocation(c);this._getLineStyle(l.lineIndex)||this._setLineStyle(l.lineIndex),this._getStyleDeclaration(l.lineIndex,l.charIndex)||this._setStyleDeclaration(l.lineIndex,l.charIndex,{}),_.util.object.extend(this._getStyleDeclaration(l.lineIndex,l.charIndex),a)},get2DCursorLocation:function(c,a){c===void 0&&(c=this.selectionStart);for(var l=a?this._unwrappedTextLines:this._textLines,d=l.length,r=0;r<d;r++){if(c<=l[r].length)return{lineIndex:r,charIndex:c};c-=l[r].length+this.missingNewlineOffset(r)}return{lineIndex:r-1,charIndex:l[r-1].length<c?l[r-1].length:c}},getSelectionStyles:function(c,a,l){c===void 0&&(c=this.selectionStart||0),a===void 0&&(a=this.selectionEnd||c);for(var d=[],r=c;r<a;r++)d.push(this.getStyleAtPosition(r,l));return d},getStyleAtPosition:function(c,a){var l=this.get2DCursorLocation(c);return(a?this.getCompleteStyleDeclaration(l.lineIndex,l.charIndex):this._getStyleDeclaration(l.lineIndex,l.charIndex))||{}},setSelectionStyles:function(c,a,l){a===void 0&&(a=this.selectionStart||0),l===void 0&&(l=this.selectionEnd||a);for(var d=a;d<l;d++)this._extendStyles(d,c);return this._forceClearCache=!0,this},_getStyleDeclaration:function(c,a){var l=this.styles&&this.styles[c];return l?l[a]:null},getCompleteStyleDeclaration:function(c,a){for(var l,d=this._getStyleDeclaration(c,a)||{},r={},s=0;s<this._styleProperties.length;s++)r[l=this._styleProperties[s]]=d[l]===void 0?this[l]:d[l];return r},_setStyleDeclaration:function(c,a,l){this.styles[c][a]=l},_deleteStyleDeclaration:function(c,a){delete this.styles[c][a]},_getLineStyle:function(c){return!!this.styles[c]},_setLineStyle:function(c){this.styles[c]={}},_deleteLineStyle:function(c){delete this.styles[c]}}),function(){function c(a){a.textDecoration&&(a.textDecoration.indexOf("underline")>-1&&(a.underline=!0),a.textDecoration.indexOf("line-through")>-1&&(a.linethrough=!0),a.textDecoration.indexOf("overline")>-1&&(a.overline=!0),delete a.textDecoration)}_.IText=_.util.createClass(_.Text,_.Observable,{type:"i-text",selectionStart:0,selectionEnd:0,selectionColor:"rgba(17,119,255,0.3)",isEditing:!1,editable:!0,editingBorderColor:"rgba(102,153,255,0.25)",cursorWidth:2,cursorColor:"",cursorDelay:1e3,cursorDuration:600,caching:!0,hiddenTextareaContainer:null,_reSpace:/\s|\n/,_currentCursorOpacity:0,_selectionDirection:null,_abortCursorAnimation:!1,__widthOfSpace:[],inCompositionMode:!1,initialize:function(a,l){this.callSuper("initialize",a,l),this.initBehavior()},setSelectionStart:function(a){a=Math.max(a,0),this._updateAndFire("selectionStart",a)},setSelectionEnd:function(a){a=Math.min(a,this.text.length),this._updateAndFire("selectionEnd",a)},_updateAndFire:function(a,l){this[a]!==l&&(this._fireSelectionChanged(),this[a]=l),this._updateTextarea()},_fireSelectionChanged:function(){this.fire("selection:changed"),this.canvas&&this.canvas.fire("text:selection:changed",{target:this})},initDimensions:function(){this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this.callSuper("initDimensions")},render:function(a){this.clearContextTop(),this.callSuper("render",a),this.cursorOffsetCache={},this.renderCursorOrSelection()},_render:function(a){this.callSuper("_render",a)},clearContextTop:function(a){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var l=this.canvas.contextTop,d=this.canvas.viewportTransform;l.save(),l.transform(d[0],d[1],d[2],d[3],d[4],d[5]),this.transform(l),this._clearTextArea(l),a||l.restore()}},renderCursorOrSelection:function(){if(this.isEditing&&this.canvas&&this.canvas.contextTop){var a=this._getCursorBoundaries(),l=this.canvas.contextTop;this.clearContextTop(!0),this.selectionStart===this.selectionEnd?this.renderCursor(a,l):this.renderSelection(a,l),l.restore()}},_clearTextArea:function(a){var l=this.width+4,d=this.height+4;a.clearRect(-l/2,-d/2,l,d)},_getCursorBoundaries:function(a){a===void 0&&(a=this.selectionStart);var l=this._getLeftOffset(),d=this._getTopOffset(),r=this._getCursorBoundariesOffsets(a);return{left:l,top:d,leftOffset:r.left,topOffset:r.top}},_getCursorBoundariesOffsets:function(a){if(this.cursorOffsetCache&&"top"in this.cursorOffsetCache)return this.cursorOffsetCache;var l,d,r,s,u=0,m=0,f=this.get2DCursorLocation(a);r=f.charIndex,d=f.lineIndex;for(var g=0;g<d;g++)u+=this.getHeightOfLine(g);l=this._getLineLeftOffset(d);var y=this.__charBounds[d][r];return y&&(m=y.left),this.charSpacing!==0&&r===this._textLines[d].length&&(m-=this._getWidthOfCharSpacing()),s={top:u,left:l+(m>0?m:0)},this.direction==="rtl"&&(s.left*=-1),this.cursorOffsetCache=s,this.cursorOffsetCache},renderCursor:function(a,l){var d=this.get2DCursorLocation(),r=d.lineIndex,s=d.charIndex>0?d.charIndex-1:0,u=this.getValueOfPropertyAt(r,s,"fontSize"),m=this.scaleX*this.canvas.getZoom(),f=this.cursorWidth/m,g=a.topOffset,y=this.getValueOfPropertyAt(r,s,"deltaY");g+=(1-this._fontSizeFraction)*this.getHeightOfLine(r)/this.lineHeight-u*(1-this._fontSizeFraction),this.inCompositionMode&&this.renderSelection(a,l),l.fillStyle=this.cursorColor||this.getValueOfPropertyAt(r,s,"fill"),l.globalAlpha=this.__isMousedown?1:this._currentCursorOpacity,l.fillRect(a.left+a.leftOffset-f/2,g+a.top+y,f,u)},renderSelection:function(a,l){for(var d=this.inCompositionMode?this.hiddenTextarea.selectionStart:this.selectionStart,r=this.inCompositionMode?this.hiddenTextarea.selectionEnd:this.selectionEnd,s=this.textAlign.indexOf("justify")!==-1,u=this.get2DCursorLocation(d),m=this.get2DCursorLocation(r),f=u.lineIndex,g=m.lineIndex,y=u.charIndex<0?0:u.charIndex,E=m.charIndex<0?0:m.charIndex,C=f;C<=g;C++){var T,D=this._getLineLeftOffset(C)||0,A=this.getHeightOfLine(C),L=0,U=0;if(C===f&&(L=this.__charBounds[f][y].left),C>=f&&C<g)U=s&&!this.isEndOfWrapping(C)?this.width:this.getLineWidth(C)||5;else if(C===g)if(E===0)U=this.__charBounds[g][E].left;else{var G=this._getWidthOfCharSpacing();U=this.__charBounds[g][E-1].left+this.__charBounds[g][E-1].width-G}T=A,(this.lineHeight<1||C===g&&this.lineHeight>1)&&(A/=this.lineHeight);var J=a.left+D+L,q=U-L,X=A,P=0;this.inCompositionMode?(l.fillStyle=this.compositionColor||"black",X=1,P=A):l.fillStyle=this.selectionColor,this.direction==="rtl"&&(J=this.width-J-q),l.fillRect(J,a.top+a.topOffset+P,q,X),a.topOffset+=T}},getCurrentCharFontSize:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fontSize")},getCurrentCharColor:function(){var a=this._getCurrentCharIndex();return this.getValueOfPropertyAt(a.l,a.c,"fill")},_getCurrentCharIndex:function(){var a=this.get2DCursorLocation(this.selectionStart,!0),l=a.charIndex>0?a.charIndex-1:0;return{l:a.lineIndex,c:l}}}),_.IText.fromObject=function(a,l){if(c(a),a.styles)for(var d in a.styles)for(var r in a.styles[d])c(a.styles[d][r]);_.Object._fromObject("IText",a,l,"text")}}(),be=_.util.object.clone,_.util.object.extend(_.IText.prototype,{initBehavior:function(){this.initAddedHandler(),this.initRemovedHandler(),this.initCursorSelectionHandlers(),this.initDoubleClickSimulation(),this.mouseMoveHandler=this.mouseMoveHandler.bind(this)},onDeselect:function(){this.isEditing&&this.exitEditing(),this.selected=!1},initAddedHandler:function(){var c=this;this.on("added",function(){var a=c.canvas;a&&(a._hasITextHandlers||(a._hasITextHandlers=!0,c._initCanvasHandlers(a)),a._iTextInstances=a._iTextInstances||[],a._iTextInstances.push(c))})},initRemovedHandler:function(){var c=this;this.on("removed",function(){var a=c.canvas;a&&(a._iTextInstances=a._iTextInstances||[],_.util.removeFromArray(a._iTextInstances,c),a._iTextInstances.length===0&&(a._hasITextHandlers=!1,c._removeCanvasHandlers(a)))})},_initCanvasHandlers:function(c){c._mouseUpITextHandler=function(){c._iTextInstances&&c._iTextInstances.forEach(function(a){a.__isMousedown=!1})},c.on("mouse:up",c._mouseUpITextHandler)},_removeCanvasHandlers:function(c){c.off("mouse:up",c._mouseUpITextHandler)},_tick:function(){this._currentTickState=this._animateCursor(this,1,this.cursorDuration,"_onTickComplete")},_animateCursor:function(c,a,l,d){var r;return r={isAborted:!1,abort:function(){this.isAborted=!0}},c.animate("_currentCursorOpacity",a,{duration:l,onComplete:function(){r.isAborted||c[d]()},onChange:function(){c.canvas&&c.selectionStart===c.selectionEnd&&c.renderCursorOrSelection()},abort:function(){return r.isAborted}}),r},_onTickComplete:function(){var c=this;this._cursorTimeout1&&clearTimeout(this._cursorTimeout1),this._cursorTimeout1=setTimeout(function(){c._currentTickCompleteState=c._animateCursor(c,0,this.cursorDuration/2,"_tick")},100)},initDelayedCursor:function(c){var a=this,l=c?0:this.cursorDelay;this.abortCursorAnimation(),this._currentCursorOpacity=1,this._cursorTimeout2=setTimeout(function(){a._tick()},l)},abortCursorAnimation:function(){var c=this._currentTickState||this._currentTickCompleteState,a=this.canvas;this._currentTickState&&this._currentTickState.abort(),this._currentTickCompleteState&&this._currentTickCompleteState.abort(),clearTimeout(this._cursorTimeout1),clearTimeout(this._cursorTimeout2),this._currentCursorOpacity=0,c&&a&&a.clearContext(a.contextTop||a.contextContainer)},selectAll:function(){return this.selectionStart=0,this.selectionEnd=this._text.length,this._fireSelectionChanged(),this._updateTextarea(),this},getSelectedText:function(){return this._text.slice(this.selectionStart,this.selectionEnd).join("")},findWordBoundaryLeft:function(c){var a=0,l=c-1;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)a++,l--;for(;/\S/.test(this._text[l])&&l>-1;)a++,l--;return c-a},findWordBoundaryRight:function(c){var a=0,l=c;if(this._reSpace.test(this._text[l]))for(;this._reSpace.test(this._text[l]);)a++,l++;for(;/\S/.test(this._text[l])&&l<this._text.length;)a++,l++;return c+a},findLineBoundaryLeft:function(c){for(var a=0,l=c-1;!/\n/.test(this._text[l])&&l>-1;)a++,l--;return c-a},findLineBoundaryRight:function(c){for(var a=0,l=c;!/\n/.test(this._text[l])&&l<this._text.length;)a++,l++;return c+a},searchWordBoundary:function(c,a){for(var l=this._text,d=this._reSpace.test(l[c])?c-1:c,r=l[d],s=_.reNonWord;!s.test(r)&&d>0&&d<l.length;)r=l[d+=a];return s.test(r)&&(d+=a===1?0:1),d},selectWord:function(c){c=c||this.selectionStart;var a=this.searchWordBoundary(c,-1),l=this.searchWordBoundary(c,1);this.selectionStart=a,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()},selectLine:function(c){c=c||this.selectionStart;var a=this.findLineBoundaryLeft(c),l=this.findLineBoundaryRight(c);return this.selectionStart=a,this.selectionEnd=l,this._fireSelectionChanged(),this._updateTextarea(),this},enterEditing:function(c){if(!this.isEditing&&this.editable)return this.canvas&&(this.canvas.calcOffset(),this.exitEditingOnOthers(this.canvas)),this.isEditing=!0,this.initHiddenTextarea(c),this.hiddenTextarea.focus(),this.hiddenTextarea.value=this.text,this._updateTextarea(),this._saveEditingProps(),this._setEditingProps(),this._textBeforeEdit=this.text,this._tick(),this.fire("editing:entered"),this._fireSelectionChanged(),this.canvas?(this.canvas.fire("text:editing:entered",{target:this}),this.initMouseMoveHandler(),this.canvas.requestRenderAll(),this):this},exitEditingOnOthers:function(c){c._iTextInstances&&c._iTextInstances.forEach(function(a){a.selected=!1,a.isEditing&&a.exitEditing()})},initMouseMoveHandler:function(){this.canvas.on("mouse:move",this.mouseMoveHandler)},mouseMoveHandler:function(c){if(this.__isMousedown&&this.isEditing){var a=this.getSelectionStartFromPointer(c.e),l=this.selectionStart,d=this.selectionEnd;(a===this.__selectionStartOnMouseDown&&l!==d||l!==a&&d!==a)&&(a>this.__selectionStartOnMouseDown?(this.selectionStart=this.__selectionStartOnMouseDown,this.selectionEnd=a):(this.selectionStart=a,this.selectionEnd=this.__selectionStartOnMouseDown),this.selectionStart===l&&this.selectionEnd===d||(this.restartCursorIfNeeded(),this._fireSelectionChanged(),this._updateTextarea(),this.renderCursorOrSelection()))}},_setEditingProps:function(){this.hoverCursor="text",this.canvas&&(this.canvas.defaultCursor=this.canvas.moveCursor="text"),this.borderColor=this.editingBorderColor,this.hasControls=this.selectable=!1,this.lockMovementX=this.lockMovementY=!0},fromStringToGraphemeSelection:function(c,a,l){var d=l.slice(0,c),r=_.util.string.graphemeSplit(d).length;if(c===a)return{selectionStart:r,selectionEnd:r};var s=l.slice(c,a);return{selectionStart:r,selectionEnd:r+_.util.string.graphemeSplit(s).length}},fromGraphemeToStringSelection:function(c,a,l){var d=l.slice(0,c).join("").length;return c===a?{selectionStart:d,selectionEnd:d}:{selectionStart:d,selectionEnd:d+l.slice(c,a).join("").length}},_updateTextarea:function(){if(this.cursorOffsetCache={},this.hiddenTextarea){if(!this.inCompositionMode){var c=this.fromGraphemeToStringSelection(this.selectionStart,this.selectionEnd,this._text);this.hiddenTextarea.selectionStart=c.selectionStart,this.hiddenTextarea.selectionEnd=c.selectionEnd}this.updateTextareaPosition()}},updateFromTextArea:function(){if(this.hiddenTextarea){this.cursorOffsetCache={},this.text=this.hiddenTextarea.value,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords());var c=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value);this.selectionEnd=this.selectionStart=c.selectionEnd,this.inCompositionMode||(this.selectionStart=c.selectionStart),this.updateTextareaPosition()}},updateTextareaPosition:function(){if(this.selectionStart===this.selectionEnd){var c=this._calcTextareaPosition();this.hiddenTextarea.style.left=c.left,this.hiddenTextarea.style.top=c.top}},_calcTextareaPosition:function(){if(!this.canvas)return{x:1,y:1};var c=this.inCompositionMode?this.compositionStart:this.selectionStart,a=this._getCursorBoundaries(c),l=this.get2DCursorLocation(c),d=l.lineIndex,r=l.charIndex,s=this.getValueOfPropertyAt(d,r,"fontSize")*this.lineHeight,u=a.leftOffset,m=this.calcTransformMatrix(),f={x:a.left+u,y:a.top+a.topOffset+s},g=this.canvas.getRetinaScaling(),y=this.canvas.upperCanvasEl,E=y.width/g,C=y.height/g,T=E-s,D=C-s,A=y.clientWidth/E,L=y.clientHeight/C;return f=_.util.transformPoint(f,m),(f=_.util.transformPoint(f,this.canvas.viewportTransform)).x*=A,f.y*=L,f.x<0&&(f.x=0),f.x>T&&(f.x=T),f.y<0&&(f.y=0),f.y>D&&(f.y=D),f.x+=this.canvas._offset.left,f.y+=this.canvas._offset.top,{left:f.x+"px",top:f.y+"px",fontSize:s+"px",charHeight:s}},_saveEditingProps:function(){this._savedProps={hasControls:this.hasControls,borderColor:this.borderColor,lockMovementX:this.lockMovementX,lockMovementY:this.lockMovementY,hoverCursor:this.hoverCursor,selectable:this.selectable,defaultCursor:this.canvas&&this.canvas.defaultCursor,moveCursor:this.canvas&&this.canvas.moveCursor}},_restoreEditingProps:function(){this._savedProps&&(this.hoverCursor=this._savedProps.hoverCursor,this.hasControls=this._savedProps.hasControls,this.borderColor=this._savedProps.borderColor,this.selectable=this._savedProps.selectable,this.lockMovementX=this._savedProps.lockMovementX,this.lockMovementY=this._savedProps.lockMovementY,this.canvas&&(this.canvas.defaultCursor=this._savedProps.defaultCursor,this.canvas.moveCursor=this._savedProps.moveCursor))},exitEditing:function(){var c=this._textBeforeEdit!==this.text,a=this.hiddenTextarea;return this.selected=!1,this.isEditing=!1,this.selectionEnd=this.selectionStart,a&&(a.blur&&a.blur(),a.parentNode&&a.parentNode.removeChild(a)),this.hiddenTextarea=null,this.abortCursorAnimation(),this._restoreEditingProps(),this._currentCursorOpacity=0,this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this.fire("editing:exited"),c&&this.fire("modified"),this.canvas&&(this.canvas.off("mouse:move",this.mouseMoveHandler),this.canvas.fire("text:editing:exited",{target:this}),c&&this.canvas.fire("object:modified",{target:this})),this},_removeExtraneousStyles:function(){for(var c in this.styles)this._textLines[c]||delete this.styles[c]},removeStyleFromTo:function(c,a){var l,d,r=this.get2DCursorLocation(c,!0),s=this.get2DCursorLocation(a,!0),u=r.lineIndex,m=r.charIndex,f=s.lineIndex,g=s.charIndex;if(u!==f){if(this.styles[u])for(l=m;l<this._unwrappedTextLines[u].length;l++)delete this.styles[u][l];if(this.styles[f])for(l=g;l<this._unwrappedTextLines[f].length;l++)(d=this.styles[f][l])&&(this.styles[u]||(this.styles[u]={}),this.styles[u][m+l-g]=d);for(l=u+1;l<=f;l++)delete this.styles[l];this.shiftLineStyles(f,u-f)}else if(this.styles[u]){d=this.styles[u];var y,E,C=g-m;for(l=m;l<g;l++)delete d[l];for(E in this.styles[u])(y=parseInt(E,10))>=g&&(d[y-C]=d[E],delete d[E])}},shiftLineStyles:function(c,a){var l=be(this.styles);for(var d in this.styles){var r=parseInt(d,10);r>c&&(this.styles[r+a]=l[r],l[r-a]||delete this.styles[r])}},restartCursorIfNeeded:function(){this._currentTickState&&!this._currentTickState.isAborted&&this._currentTickCompleteState&&!this._currentTickCompleteState.isAborted||this.initDelayedCursor()},insertNewlineStyleObject:function(c,a,l,d){var r,s={},u=!1,m=this._unwrappedTextLines[c].length===a;for(var f in l||(l=1),this.shiftLineStyles(c,l),this.styles[c]&&(r=this.styles[c][a===0?a:a-1]),this.styles[c]){var g=parseInt(f,10);g>=a&&(u=!0,s[g-a]=this.styles[c][f],m&&a===0||delete this.styles[c][f])}var y=!1;for(u&&!m&&(this.styles[c+l]=s,y=!0),y&&l--;l>0;)d&&d[l-1]?this.styles[c+l]={0:be(d[l-1])}:r?this.styles[c+l]={0:be(r)}:delete this.styles[c+l],l--;this._forceClearCache=!0},insertCharStyleObject:function(c,a,l,d){this.styles||(this.styles={});var r=this.styles[c],s=r?be(r):{};for(var u in l||(l=1),s){var m=parseInt(u,10);m>=a&&(r[m+l]=s[m],s[m-l]||delete r[m])}if(this._forceClearCache=!0,d)for(;l--;)Object.keys(d[l]).length&&(this.styles[c]||(this.styles[c]={}),this.styles[c][a+l]=be(d[l]));else if(r)for(var f=r[a?a-1:1];f&&l--;)this.styles[c][a+l]=be(f)},insertNewStyleBlock:function(c,a,l){for(var d=this.get2DCursorLocation(a,!0),r=[0],s=0,u=0;u<c.length;u++)c[u]===`
`?r[++s]=0:r[s]++;for(r[0]>0&&(this.insertCharStyleObject(d.lineIndex,d.charIndex,r[0],l),l=l&&l.slice(r[0]+1)),s&&this.insertNewlineStyleObject(d.lineIndex,d.charIndex+r[0],s),u=1;u<s;u++)r[u]>0?this.insertCharStyleObject(d.lineIndex+u,0,r[u],l):l&&this.styles[d.lineIndex+u]&&l[0]&&(this.styles[d.lineIndex+u][0]=l[0]),l=l&&l.slice(r[u]+1);r[u]>0&&this.insertCharStyleObject(d.lineIndex+u,0,r[u],l)},setSelectionStartEndWithShift:function(c,a,l){l<=c?(a===c?this._selectionDirection="left":this._selectionDirection==="right"&&(this._selectionDirection="left",this.selectionEnd=c),this.selectionStart=l):l>c&&l<a?this._selectionDirection==="right"?this.selectionEnd=l:this.selectionStart=l:(a===c?this._selectionDirection="right":this._selectionDirection==="left"&&(this._selectionDirection="right",this.selectionStart=a),this.selectionEnd=l)},setSelectionInBoundaries:function(){var c=this.text.length;this.selectionStart>c?this.selectionStart=c:this.selectionStart<0&&(this.selectionStart=0),this.selectionEnd>c?this.selectionEnd=c:this.selectionEnd<0&&(this.selectionEnd=0)}}),_.util.object.extend(_.IText.prototype,{initDoubleClickSimulation:function(){this.__lastClickTime=+new Date,this.__lastLastClickTime=+new Date,this.__lastPointer={},this.on("mousedown",this.onMouseDown)},onMouseDown:function(c){if(this.canvas){this.__newClickTime=+new Date;var a=c.pointer;this.isTripleClick(a)&&(this.fire("tripleclick",c),this._stopEvent(c.e)),this.__lastLastClickTime=this.__lastClickTime,this.__lastClickTime=this.__newClickTime,this.__lastPointer=a,this.__lastIsEditing=this.isEditing,this.__lastSelected=this.selected}},isTripleClick:function(c){return this.__newClickTime-this.__lastClickTime<500&&this.__lastClickTime-this.__lastLastClickTime<500&&this.__lastPointer.x===c.x&&this.__lastPointer.y===c.y},_stopEvent:function(c){c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation()},initCursorSelectionHandlers:function(){this.initMousedownHandler(),this.initMouseupHandler(),this.initClicks()},doubleClickHandler:function(c){this.isEditing&&this.selectWord(this.getSelectionStartFromPointer(c.e))},tripleClickHandler:function(c){this.isEditing&&this.selectLine(this.getSelectionStartFromPointer(c.e))},initClicks:function(){this.on("mousedblclick",this.doubleClickHandler),this.on("tripleclick",this.tripleClickHandler)},_mouseDownHandler:function(c){!this.canvas||!this.editable||c.e.button&&c.e.button!==1||(this.__isMousedown=!0,this.selected&&(this.inCompositionMode=!1,this.setCursorByClick(c.e)),this.isEditing&&(this.__selectionStartOnMouseDown=this.selectionStart,this.selectionStart===this.selectionEnd&&this.abortCursorAnimation(),this.renderCursorOrSelection()))},_mouseDownHandlerBefore:function(c){!this.canvas||!this.editable||c.e.button&&c.e.button!==1||(this.selected=this===this.canvas._activeObject)},initMousedownHandler:function(){this.on("mousedown",this._mouseDownHandler),this.on("mousedown:before",this._mouseDownHandlerBefore)},initMouseupHandler:function(){this.on("mouseup",this.mouseUpHandler)},mouseUpHandler:function(c){if(this.__isMousedown=!1,!(!this.editable||this.group||c.transform&&c.transform.actionPerformed||c.e.button&&c.e.button!==1)){if(this.canvas){var a=this.canvas._activeObject;if(a&&a!==this)return}this.__lastSelected&&!this.__corner?(this.selected=!1,this.__lastSelected=!1,this.enterEditing(c.e),this.selectionStart===this.selectionEnd?this.initDelayedCursor(!0):this.renderCursorOrSelection()):this.selected=!0}},setCursorByClick:function(c){var a=this.getSelectionStartFromPointer(c),l=this.selectionStart,d=this.selectionEnd;c.shiftKey?this.setSelectionStartEndWithShift(l,d,a):(this.selectionStart=a,this.selectionEnd=a),this.isEditing&&(this._fireSelectionChanged(),this._updateTextarea())},getSelectionStartFromPointer:function(c){for(var a,l=this.getLocalPointer(c),d=0,r=0,s=0,u=0,m=0,f=0,g=this._textLines.length;f<g&&s<=l.y;f++)s+=this.getHeightOfLine(f)*this.scaleY,m=f,f>0&&(u+=this._textLines[f-1].length+this.missingNewlineOffset(f-1));r=this._getLineLeftOffset(m)*this.scaleX,a=this._textLines[m],this.direction==="rtl"&&(l.x=this.width*this.scaleX-l.x+r);for(var y=0,E=a.length;y<E&&(d=r,(r+=this.__charBounds[m][y].kernedWidth*this.scaleX)<=l.x);y++)u++;return this._getNewSelectionStartFromOffset(l,d,r,u,E)},_getNewSelectionStartFromOffset:function(c,a,l,d,r){var s=c.x-a,u=l-c.x,m=d+(u>s||u<0?0:1);return this.flipX&&(m=r-m),m>this._text.length&&(m=this._text.length),m}}),_.util.object.extend(_.IText.prototype,{initHiddenTextarea:function(){this.hiddenTextarea=_.document.createElement("textarea"),this.hiddenTextarea.setAttribute("autocapitalize","off"),this.hiddenTextarea.setAttribute("autocorrect","off"),this.hiddenTextarea.setAttribute("autocomplete","off"),this.hiddenTextarea.setAttribute("spellcheck","false"),this.hiddenTextarea.setAttribute("data-fabric-hiddentextarea",""),this.hiddenTextarea.setAttribute("wrap","off");var c=this._calcTextareaPosition();this.hiddenTextarea.style.cssText="position: absolute; top: "+c.top+"; left: "+c.left+"; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px; padding\uFF70top: "+c.fontSize+";",this.hiddenTextareaContainer?this.hiddenTextareaContainer.appendChild(this.hiddenTextarea):_.document.body.appendChild(this.hiddenTextarea),_.util.addListener(this.hiddenTextarea,"keydown",this.onKeyDown.bind(this)),_.util.addListener(this.hiddenTextarea,"keyup",this.onKeyUp.bind(this)),_.util.addListener(this.hiddenTextarea,"input",this.onInput.bind(this)),_.util.addListener(this.hiddenTextarea,"copy",this.copy.bind(this)),_.util.addListener(this.hiddenTextarea,"cut",this.copy.bind(this)),_.util.addListener(this.hiddenTextarea,"paste",this.paste.bind(this)),_.util.addListener(this.hiddenTextarea,"compositionstart",this.onCompositionStart.bind(this)),_.util.addListener(this.hiddenTextarea,"compositionupdate",this.onCompositionUpdate.bind(this)),_.util.addListener(this.hiddenTextarea,"compositionend",this.onCompositionEnd.bind(this)),!this._clickHandlerInitialized&&this.canvas&&(_.util.addListener(this.canvas.upperCanvasEl,"click",this.onClick.bind(this)),this._clickHandlerInitialized=!0)},keysMap:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorRight",36:"moveCursorLeft",37:"moveCursorLeft",38:"moveCursorUp",39:"moveCursorRight",40:"moveCursorDown"},keysMapRtl:{9:"exitEditing",27:"exitEditing",33:"moveCursorUp",34:"moveCursorDown",35:"moveCursorLeft",36:"moveCursorRight",37:"moveCursorRight",38:"moveCursorUp",39:"moveCursorLeft",40:"moveCursorDown"},ctrlKeysMapUp:{67:"copy",88:"cut"},ctrlKeysMapDown:{65:"selectAll"},onClick:function(){this.hiddenTextarea&&this.hiddenTextarea.focus()},onKeyDown:function(c){if(this.isEditing){var a=this.direction==="rtl"?this.keysMapRtl:this.keysMap;if(c.keyCode in a)this[a[c.keyCode]](c);else{if(!(c.keyCode in this.ctrlKeysMapDown)||!c.ctrlKey&&!c.metaKey)return;this[this.ctrlKeysMapDown[c.keyCode]](c)}c.stopImmediatePropagation(),c.preventDefault(),c.keyCode>=33&&c.keyCode<=40?(this.inCompositionMode=!1,this.clearContextTop(),this.renderCursorOrSelection()):this.canvas&&this.canvas.requestRenderAll()}},onKeyUp:function(c){!this.isEditing||this._copyDone||this.inCompositionMode?this._copyDone=!1:c.keyCode in this.ctrlKeysMapUp&&(c.ctrlKey||c.metaKey)&&(this[this.ctrlKeysMapUp[c.keyCode]](c),c.stopImmediatePropagation(),c.preventDefault(),this.canvas&&this.canvas.requestRenderAll())},onInput:function(c){var a=this.fromPaste;if(this.fromPaste=!1,c&&c.stopPropagation(),this.isEditing){var l,d,r,s,u,m=this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,f=this._text.length,g=m.length,y=g-f,E=this.selectionStart,C=this.selectionEnd,T=E!==C;if(this.hiddenTextarea.value==="")return this.styles={},this.updateFromTextArea(),this.fire("changed"),void(this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll()));var D=this.fromStringToGraphemeSelection(this.hiddenTextarea.selectionStart,this.hiddenTextarea.selectionEnd,this.hiddenTextarea.value),A=E>D.selectionStart;T?(l=this._text.slice(E,C),y+=C-E):g<f&&(l=A?this._text.slice(C+y,C):this._text.slice(E,E-y)),d=m.slice(D.selectionEnd-y,D.selectionEnd),l&&l.length&&(d.length&&(r=this.getSelectionStyles(E,E+1,!1),r=d.map(function(){return r[0]})),T?(s=E,u=C):A?(s=C-l.length,u=C):(s=C,u=C+l.length),this.removeStyleFromTo(s,u)),d.length&&(a&&d.join("")===_.copiedText&&!_.disableStyleCopyPaste&&(r=_.copiedTextStyle),this.insertNewStyleBlock(d,E,r)),this.updateFromTextArea(),this.fire("changed"),this.canvas&&(this.canvas.fire("text:changed",{target:this}),this.canvas.requestRenderAll())}},onCompositionStart:function(){this.inCompositionMode=!0},onCompositionEnd:function(){this.inCompositionMode=!1},onCompositionUpdate:function(c){this.compositionStart=c.target.selectionStart,this.compositionEnd=c.target.selectionEnd,this.updateTextareaPosition()},copy:function(){this.selectionStart!==this.selectionEnd&&(_.copiedText=this.getSelectedText(),_.disableStyleCopyPaste?_.copiedTextStyle=null:_.copiedTextStyle=this.getSelectionStyles(this.selectionStart,this.selectionEnd,!0),this._copyDone=!0)},paste:function(){this.fromPaste=!0},_getClipboardData:function(c){return c&&c.clipboardData||_.window.clipboardData},_getWidthBeforeCursor:function(c,a){var l,d=this._getLineLeftOffset(c);return a>0&&(d+=(l=this.__charBounds[c][a-1]).left+l.width),d},getDownCursorOffset:function(c,a){var l=this._getSelectionForOffset(c,a),d=this.get2DCursorLocation(l),r=d.lineIndex;if(r===this._textLines.length-1||c.metaKey||c.keyCode===34)return this._text.length-l;var s=d.charIndex,u=this._getWidthBeforeCursor(r,s),m=this._getIndexOnLine(r+1,u);return this._textLines[r].slice(s).length+m+1+this.missingNewlineOffset(r)},_getSelectionForOffset:function(c,a){return c.shiftKey&&this.selectionStart!==this.selectionEnd&&a?this.selectionEnd:this.selectionStart},getUpCursorOffset:function(c,a){var l=this._getSelectionForOffset(c,a),d=this.get2DCursorLocation(l),r=d.lineIndex;if(r===0||c.metaKey||c.keyCode===33)return-l;var s=d.charIndex,u=this._getWidthBeforeCursor(r,s),m=this._getIndexOnLine(r-1,u),f=this._textLines[r].slice(0,s),g=this.missingNewlineOffset(r-1);return-this._textLines[r-1].length+m-f.length+(1-g)},_getIndexOnLine:function(c,a){for(var l,d,r=this._textLines[c],s=this._getLineLeftOffset(c),u=0,m=0,f=r.length;m<f;m++)if((s+=l=this.__charBounds[c][m].width)>a){d=!0;var g=s-l,y=s,E=Math.abs(g-a);u=Math.abs(y-a)<E?m:m-1;break}return d||(u=r.length-1),u},moveCursorDown:function(c){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorUpOrDown("Down",c)},moveCursorUp:function(c){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorUpOrDown("Up",c)},_moveCursorUpOrDown:function(c,a){var l=this["get"+c+"CursorOffset"](a,this._selectionDirection==="right");a.shiftKey?this.moveCursorWithShift(l):this.moveCursorWithoutShift(l),l!==0&&(this.setSelectionInBoundaries(),this.abortCursorAnimation(),this._currentCursorOpacity=1,this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorWithShift:function(c){var a=this._selectionDirection==="left"?this.selectionStart+c:this.selectionEnd+c;return this.setSelectionStartEndWithShift(this.selectionStart,this.selectionEnd,a),c!==0},moveCursorWithoutShift:function(c){return c<0?(this.selectionStart+=c,this.selectionEnd=this.selectionStart):(this.selectionEnd+=c,this.selectionStart=this.selectionEnd),c!==0},moveCursorLeft:function(c){this.selectionStart===0&&this.selectionEnd===0||this._moveCursorLeftOrRight("Left",c)},_move:function(c,a,l){var d;if(c.altKey)d=this["findWordBoundary"+l](this[a]);else{if(!c.metaKey&&c.keyCode!==35&&c.keyCode!==36)return this[a]+=l==="Left"?-1:1,!0;d=this["findLineBoundary"+l](this[a])}if(typeof d!==void 0&&this[a]!==d)return this[a]=d,!0},_moveLeft:function(c,a){return this._move(c,a,"Left")},_moveRight:function(c,a){return this._move(c,a,"Right")},moveCursorLeftWithoutShift:function(c){var a=!0;return this._selectionDirection="left",this.selectionEnd===this.selectionStart&&this.selectionStart!==0&&(a=this._moveLeft(c,"selectionStart")),this.selectionEnd=this.selectionStart,a},moveCursorLeftWithShift:function(c){return this._selectionDirection==="right"&&this.selectionStart!==this.selectionEnd?this._moveLeft(c,"selectionEnd"):this.selectionStart!==0?(this._selectionDirection="left",this._moveLeft(c,"selectionStart")):void 0},moveCursorRight:function(c){this.selectionStart>=this._text.length&&this.selectionEnd>=this._text.length||this._moveCursorLeftOrRight("Right",c)},_moveCursorLeftOrRight:function(c,a){var l="moveCursor"+c+"With";this._currentCursorOpacity=1,a.shiftKey?l+="Shift":l+="outShift",this[l](a)&&(this.abortCursorAnimation(),this.initDelayedCursor(),this._fireSelectionChanged(),this._updateTextarea())},moveCursorRightWithShift:function(c){return this._selectionDirection==="left"&&this.selectionStart!==this.selectionEnd?this._moveRight(c,"selectionStart"):this.selectionEnd!==this._text.length?(this._selectionDirection="right",this._moveRight(c,"selectionEnd")):void 0},moveCursorRightWithoutShift:function(c){var a=!0;return this._selectionDirection="right",this.selectionStart===this.selectionEnd?(a=this._moveRight(c,"selectionStart"),this.selectionEnd=this.selectionStart):this.selectionStart=this.selectionEnd,a},removeChars:function(c,a){a===void 0&&(a=c+1),this.removeStyleFromTo(c,a),this._text.splice(c,a-c),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()},insertChars:function(c,a,l,d){d===void 0&&(d=l),d>l&&this.removeStyleFromTo(l,d);var r=_.util.string.graphemeSplit(c);this.insertNewStyleBlock(r,l,a),this._text=[].concat(this._text.slice(0,l),r,this._text.slice(d)),this.text=this._text.join(""),this.set("dirty",!0),this._shouldClearDimensionCache()&&(this.initDimensions(),this.setCoords()),this._removeExtraneousStyles()}}),function(){var c=_.util.toFixed,a=/  +/g;_.util.object.extend(_.Text.prototype,{_toSVG:function(){var l=this._getSVGLeftTopOffsets(),d=this._getSVGTextAndBg(l.textTop,l.textLeft);return this._wrapSVGTextAndBg(d)},toSVG:function(l){return this._createBaseSVGMarkup(this._toSVG(),{reviver:l,noStyle:!0,withShadow:!0})},_getSVGLeftTopOffsets:function(){return{textLeft:-this.width/2,textTop:-this.height/2,lineTop:this.getHeightOfLine(0)}},_wrapSVGTextAndBg:function(l){var d=this.getSvgTextDecoration(this);return[l.textBgRects.join(""),'		<text xml:space="preserve" ',this.fontFamily?'font-family="'+this.fontFamily.replace(/"/g,"'")+'" ':"",this.fontSize?'font-size="'+this.fontSize+'" ':"",this.fontStyle?'font-style="'+this.fontStyle+'" ':"",this.fontWeight?'font-weight="'+this.fontWeight+'" ':"",d?'text-decoration="'+d+'" ':"",'style="',this.getSvgStyles(!0),'"',this.addPaintOrder()," >",l.textSpans.join(""),`</text>
`]},_getSVGTextAndBg:function(l,d){var r,s=[],u=[],m=l;this._setSVGBg(u);for(var f=0,g=this._textLines.length;f<g;f++)r=this._getLineLeftOffset(f),(this.textBackgroundColor||this.styleHas("textBackgroundColor",f))&&this._setSVGTextLineBg(u,f,d+r,m),this._setSVGTextLineText(s,f,d+r,m),m+=this.getHeightOfLine(f);return{textSpans:s,textBgRects:u}},_createTextCharSpan:function(l,d,r,s){var u=l!==l.trim()||l.match(a),m=this.getSvgSpanStyles(d,u),f=m?'style="'+m+'"':"",g=d.deltaY,y="",E=_.Object.NUM_FRACTION_DIGITS;return g&&(y=' dy="'+c(g,E)+'" '),['<tspan x="',c(r,E),'" y="',c(s,E),'" ',y,f,">",_.util.string.escapeXml(l),"</tspan>"].join("")},_setSVGTextLineText:function(l,d,r,s){var u,m,f,g,y,E=this.getHeightOfLine(d),C=this.textAlign.indexOf("justify")!==-1,T="",D=0,A=this._textLines[d];s+=E*(1-this._fontSizeFraction)/this.lineHeight;for(var L=0,U=A.length-1;L<=U;L++)y=L===U||this.charSpacing,T+=A[L],f=this.__charBounds[d][L],D===0?(r+=f.kernedWidth-f.width,D+=f.width):D+=f.kernedWidth,C&&!y&&this._reSpaceAndTab.test(A[L])&&(y=!0),y||(u=u||this.getCompleteStyleDeclaration(d,L),m=this.getCompleteStyleDeclaration(d,L+1),y=this._hasStyleChangedForSvg(u,m)),y&&(g=this._getStyleDeclaration(d,L)||{},l.push(this._createTextCharSpan(T,g,r,s)),T="",u=m,r+=D,D=0)},_pushTextBgRect:function(l,d,r,s,u,m){var f=_.Object.NUM_FRACTION_DIGITS;l.push("		<rect ",this._getFillAttributes(d),' x="',c(r,f),'" y="',c(s,f),'" width="',c(u,f),'" height="',c(m,f),`"></rect>
`)},_setSVGTextLineBg:function(l,d,r,s){for(var u,m,f=this._textLines[d],g=this.getHeightOfLine(d)/this.lineHeight,y=0,E=0,C=this.getValueOfPropertyAt(d,0,"textBackgroundColor"),T=0,D=f.length;T<D;T++)u=this.__charBounds[d][T],(m=this.getValueOfPropertyAt(d,T,"textBackgroundColor"))!==C?(C&&this._pushTextBgRect(l,C,r+E,s,y,g),E=u.left,y=u.width,C=m):y+=u.kernedWidth;m&&this._pushTextBgRect(l,m,r+E,s,y,g)},_getFillAttributes:function(l){var d=l&&typeof l=="string"?new _.Color(l):"";return d&&d.getSource()&&d.getAlpha()!==1?'opacity="'+d.getAlpha()+'" fill="'+d.setAlpha(1).toRgb()+'"':'fill="'+l+'"'},_getSVGLineTopOffset:function(l){for(var d,r=0,s=0;s<l;s++)r+=this.getHeightOfLine(s);return d=this.getHeightOfLine(s),{lineTop:r,offset:(this._fontSizeMult-this._fontSizeFraction)*d/(this.lineHeight*this._fontSizeMult)}},getSvgStyles:function(l){return _.Object.prototype.getSvgStyles.call(this,l)+" white-space: pre;"}})}(),function(c){var a=c.fabric||(c.fabric={});a.Textbox=a.util.createClass(a.IText,a.Observable,{type:"textbox",minWidth:20,dynamicMinWidth:2,__cachedLines:null,lockScalingFlip:!0,noScaleCache:!1,_dimensionAffectingProps:a.Text.prototype._dimensionAffectingProps.concat("width"),_wordJoiners:/[ \t\r]/,splitByGrapheme:!1,initDimensions:function(){this.__skipDimension||(this.isEditing&&this.initDelayedCursor(),this.clearContextTop(),this._clearCache(),this.dynamicMinWidth=0,this._styleMap=this._generateStyleMap(this._splitText()),this.dynamicMinWidth>this.width&&this._set("width",this.dynamicMinWidth),this.textAlign.indexOf("justify")!==-1&&this.enlargeSpaces(),this.height=this.calcTextHeight(),this.saveState({propertySet:"_dimensionAffectingProps"}))},_generateStyleMap:function(l){for(var d=0,r=0,s=0,u={},m=0;m<l.graphemeLines.length;m++)l.graphemeText[s]===`
`&&m>0?(r=0,s++,d++):!this.splitByGrapheme&&this._reSpaceAndTab.test(l.graphemeText[s])&&m>0&&(r++,s++),u[m]={line:d,offset:r},s+=l.graphemeLines[m].length,r+=l.graphemeLines[m].length;return u},styleHas:function(l,d){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[d];r&&(d=r.line)}return a.Text.prototype.styleHas.call(this,l,d)},isEmptyStyles:function(l){if(!this.styles)return!0;var d,r,s=0,u=!1,m=this._styleMap[l],f=this._styleMap[l+1];for(var g in m&&(l=m.line,s=m.offset),f&&(u=f.line===l,d=f.offset),r=l===void 0?this.styles:{line:this.styles[l]})for(var y in r[g])if(y>=s&&(!u||y<d))for(var E in r[g][y])return!1;return!0},_getStyleDeclaration:function(l,d){if(this._styleMap&&!this.isWrapping){var r=this._styleMap[l];if(!r)return null;l=r.line,d=r.offset+d}return this.callSuper("_getStyleDeclaration",l,d)},_setStyleDeclaration:function(l,d,r){var s=this._styleMap[l];l=s.line,d=s.offset+d,this.styles[l][d]=r},_deleteStyleDeclaration:function(l,d){var r=this._styleMap[l];l=r.line,d=r.offset+d,delete this.styles[l][d]},_getLineStyle:function(l){var d=this._styleMap[l];return!!this.styles[d.line]},_setLineStyle:function(l){var d=this._styleMap[l];this.styles[d.line]={}},_wrapText:function(l,d){var r,s=[];for(this.isWrapping=!0,r=0;r<l.length;r++)s=s.concat(this._wrapLine(l[r],r,d));return this.isWrapping=!1,s},_measureWord:function(l,d,r){var s,u=0;r=r||0;for(var m=0,f=l.length;m<f;m++)u+=this._getGraphemeBox(l[m],d,m+r,s,!0).kernedWidth,s=l[m];return u},_wrapLine:function(l,d,r,s){var u=0,m=this.splitByGrapheme,f=[],g=[],y=m?a.util.string.graphemeSplit(l):l.split(this._wordJoiners),E="",C=0,T=m?"":" ",D=0,A=0,L=0,U=!0,G=this._getWidthOfCharSpacing();s=s||0,y.length===0&&y.push([]),r-=s;for(var J=0;J<y.length;J++)E=m?y[J]:a.util.string.graphemeSplit(y[J]),D=this._measureWord(E,d,C),C+=E.length,(u+=A+D-G)>r&&!U?(f.push(g),g=[],u=D,U=!0):u+=G,U||m||g.push(T),g=g.concat(E),A=m?0:this._measureWord([T],d,C),C++,U=!1,D>L&&(L=D);return J&&f.push(g),L+s>this.dynamicMinWidth&&(this.dynamicMinWidth=L-G+s),f},isEndOfWrapping:function(l){return!this._styleMap[l+1]||this._styleMap[l+1].line!==this._styleMap[l].line},missingNewlineOffset:function(l){return this.splitByGrapheme?this.isEndOfWrapping(l)?1:0:1},_splitTextIntoLines:function(l){for(var d=a.Text.prototype._splitTextIntoLines.call(this,l),r=this._wrapText(d.lines,this.width),s=new Array(r.length),u=0;u<r.length;u++)s[u]=r[u].join("");return d.lines=s,d.graphemeLines=r,d},getMinWidth:function(){return Math.max(this.minWidth,this.dynamicMinWidth)},_removeExtraneousStyles:function(){var l={};for(var d in this._styleMap)this._textLines[d]&&(l[this._styleMap[d].line]=1);for(var d in this.styles)l[d]||delete this.styles[d]},toObject:function(l){return this.callSuper("toObject",["minWidth","splitByGrapheme"].concat(l))}}),a.Textbox.fromObject=function(l,d){return a.Object._fromObject("Textbox",l,d,"text")}}(e),function(){var c=_.controlsUtils,a=c.scaleSkewCursorStyleHandler,l=c.scaleCursorStyleHandler,d=c.scalingEqually,r=c.scalingYOrSkewingX,s=c.scalingXOrSkewingY,u=c.scaleOrSkewActionName,m=_.Object.prototype.controls;if(m.ml=new _.Control({x:-.5,y:0,cursorStyleHandler:a,actionHandler:s,getActionName:u}),m.mr=new _.Control({x:.5,y:0,cursorStyleHandler:a,actionHandler:s,getActionName:u}),m.mb=new _.Control({x:0,y:.5,cursorStyleHandler:a,actionHandler:r,getActionName:u}),m.mt=new _.Control({x:0,y:-.5,cursorStyleHandler:a,actionHandler:r,getActionName:u}),m.tl=new _.Control({x:-.5,y:-.5,cursorStyleHandler:l,actionHandler:d}),m.tr=new _.Control({x:.5,y:-.5,cursorStyleHandler:l,actionHandler:d}),m.bl=new _.Control({x:-.5,y:.5,cursorStyleHandler:l,actionHandler:d}),m.br=new _.Control({x:.5,y:.5,cursorStyleHandler:l,actionHandler:d}),m.mtr=new _.Control({x:0,y:-.5,actionHandler:c.rotationWithSnapping,cursorStyleHandler:c.rotationStyleHandler,offsetY:-40,withConnection:!0,actionName:"rotate"}),_.Textbox){var f=_.Textbox.prototype.controls={};f.mtr=m.mtr,f.tr=m.tr,f.br=m.br,f.tl=m.tl,f.bl=m.bl,f.mt=m.mt,f.mb=m.mb,f.mr=new _.Control({x:.5,y:0,actionHandler:c.changeWidth,cursorStyleHandler:a,actionName:"resizing"}),f.ml=new _.Control({x:-.5,y:0,actionHandler:c.changeWidth,cursorStyleHandler:a,actionName:"resizing"})}}()},192:()=>{},898:()=>{},245:()=>{}},zg={};function Ai(t){var e=zg[t];if(e!==void 0)return e.exports;var n=zg[t]={exports:{}};return tw[t](n,n.exports,Ai),n.exports}Ai.d=(t,e)=>{for(var n in e)Ai.o(e,n)&&!Ai.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},Ai.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var cp={};(()=>{let t;Ai.d(cp,{R:()=>t}),t=typeof document<"u"&&typeof window<"u"?Ai(653).fabric:{version:"5.2.1"}})();var gt,Lt,ii,$g,ke=cp.R;(function(t){t[t.DIMT_RECTANGLE=1]="DIMT_RECTANGLE",t[t.DIMT_QUADRILATERAL=2]="DIMT_QUADRILATERAL",t[t.DIMT_TEXT=4]="DIMT_TEXT",t[t.DIMT_ARC=8]="DIMT_ARC",t[t.DIMT_IMAGE=16]="DIMT_IMAGE",t[t.DIMT_POLYGON=32]="DIMT_POLYGON",t[t.DIMT_LINE=64]="DIMT_LINE",t[t.DIMT_GROUP=128]="DIMT_GROUP"})(gt||(gt={})),function(t){t[t.DIS_DEFAULT=1]="DIS_DEFAULT",t[t.DIS_SELECTED=2]="DIS_SELECTED"}(Lt||(Lt={})),function(t){t[t.EF_ENHANCED_FOCUS=4]="EF_ENHANCED_FOCUS",t[t.EF_AUTO_ZOOM=16]="EF_AUTO_ZOOM",t[t.EF_TAP_TO_FOCUS=64]="EF_TAP_TO_FOCUS"}(ii||(ii={})),function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"}($g||($g={}));var Cr=t=>typeof t=="number"&&!Number.isNaN(t),cu=t=>typeof t=="string",Yo,ms,or,uu,fn,ma;(function(t){t[t.ARC=0]="ARC",t[t.IMAGE=1]="IMAGE",t[t.LINE=2]="LINE",t[t.POLYGON=3]="POLYGON",t[t.QUAD=4]="QUAD",t[t.RECT=5]="RECT",t[t.TEXT=6]="TEXT",t[t.GROUP=7]="GROUP"})(fn||(fn={})),function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SELECTED=1]="SELECTED"}(ma||(ma={}));var vt=class{get mediaType(){return new Map([["rect",gt.DIMT_RECTANGLE],["quad",gt.DIMT_QUADRILATERAL],["text",gt.DIMT_TEXT],["arc",gt.DIMT_ARC],["image",gt.DIMT_IMAGE],["polygon",gt.DIMT_POLYGON],["line",gt.DIMT_LINE],["group",gt.DIMT_GROUP]]).get(this._mediaType)}get styleSelector(){switch(b(this,ms,"f")){case Lt.DIS_DEFAULT:return"default";case Lt.DIS_SELECTED:return"selected"}}set drawingStyleId(e){this.styleId=e}get drawingStyleId(){return this.styleId}set coordinateBase(e){if(!["view","image"].includes(e))throw new Error("Invalid 'coordinateBase'.");this._drawingLayer&&(b(this,or,"f")==="image"&&e==="view"?this.updateCoordinateBaseFromImageToView():b(this,or,"f")==="view"&&e==="image"&&this.updateCoordinateBaseFromViewToImage()),Ce(this,or,e,"f")}get coordinateBase(){return b(this,or,"f")}get drawingLayerId(){return this._drawingLayerId}constructor(e,n){if(Yo.add(this),ms.set(this,void 0),or.set(this,"image"),this._zIndex=null,this._drawingLayer=null,this._drawingLayerId=null,this._mapState_StyleId=new Map,this.mapEvent_Callbacks=new Map([["selected",new Map],["deselected",new Map],["mousedown",new Map],["mouseup",new Map],["dblclick",new Map],["mouseover",new Map],["mouseout",new Map]]),this.mapNoteName_Content=new Map([]),this.isDrawingItem=!0,n!=null&&!Cr(n))throw new TypeError("Invalid 'drawingStyleId'.");e&&this._setFabricObject(e),this.setState(Lt.DIS_DEFAULT),this.styleId=n}_setFabricObject(e){this._fabricObject=e,this._fabricObject.on("selected",()=>{this.setState(Lt.DIS_SELECTED)}),this._fabricObject.on("deselected",()=>{this._fabricObject.canvas&&this._fabricObject.canvas.getActiveObjects().includes(this._fabricObject)?this.setState(Lt.DIS_SELECTED):this.setState(Lt.DIS_DEFAULT),this._fabricObject.type==="textbox"&&(this._fabricObject.isEditing&&this._fabricObject.exitEditing(),this._fabricObject.selected=!1)}),e.getDrawingItem=()=>this}_getFabricObject(){return this._fabricObject}setState(e){Ce(this,ms,e,"f")}getState(){return b(this,ms,"f")}_on(e,n){if(!n)return;let i=e.toLowerCase(),o=this.mapEvent_Callbacks.get(i);if(!o)throw new Error(`Event '${e}' does not exist.`);let h=o.get(n);h||(h=p=>{let v=p.e;if(!v)return void(n&&n.apply(this,[{targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null}]));let w={targetItem:this,itemClientX:null,itemClientY:null,itemPageX:null,itemPageY:null};if(this._drawingLayer){let I,S,x,M,R=v.target.getBoundingClientRect();I=R.left,S=R.top,x=I+window.scrollX,M=S+window.scrollY;let{width:O,height:B}=this._drawingLayer.fabricCanvas.lowerCanvasEl.getBoundingClientRect(),V=this._drawingLayer.width,H=this._drawingLayer.height,Y=O/B,Z=V/H,he=this._drawingLayer._getObjectFit(),ce,ye,be,_,ue=1;if(he==="contain")Y<Z?(ue=O/V,ce=I+this.get("x")*ue,ye=S+this.get("y")*ue+(B-H*ue)/2,be=x+this.get("x")*ue,_=M+this.get("y")*ue+(B-H*ue)/2):(ue=B/H,ce=I+this.get("x")*ue+(O-V*ue)/2,ye=S+this.get("y")*ue,be=x+this.get("x")*ue+(O-V*ue)/2,_=M+this.get("y")*ue);else if(he==="cover")if(Y<Z){ue=B/H;let Ee=this.get("x")*ue-(V*ue-O)/2;Ee=Math.max(Ee,0),Ee=Math.min(Ee,O),ce=I+Ee,ye=S+this.get("y")*ue,be=x+Ee,_=M+this.get("y")*ue}else{ue=O/V;let Ee=this.get("y")*ue-(H*ue-B)/2;Ee=Math.max(Ee,0),Ee=Math.min(Ee,B),ce=I+this.get("x")*ue,ye=S+Ee,be=x+this.get("x")*ue,_=M+Ee}w.itemClientX=Math.round(ce),w.itemClientY=Math.round(ye),w.itemPageX=Math.round(be),w.itemPageY=Math.round(_)}for(let I of Object.getOwnPropertyNames(w))Object.defineProperty(v,I,{value:w[I],writable:!0});n&&n.apply(this,[v])},o.set(n,h),this._fabricObject.on(i==="dblclick"?"mousedblclick":i,h))}on(e,n){this._on(e,n)}_off(e,n){let i=e.toLowerCase(),o=this.mapEvent_Callbacks.get(i);if(!o)throw new Error(`Event '${e}' does not exist.`);let h=o.get(n);h&&(o.delete(n),this._fabricObject.off(i==="dblclick"?"mousedblclick":i,h))}off(e,n){this._off(e,n)}_setEditable(e){let n=this._fabricObject;e?(n.selectable=!0,n.hasControls=!0,n.hoverCursor=null):(n.selectable=!1,n.hasControls=!1,n.hoverCursor="default")}hasNote(e){return this.mapNoteName_Content.has(e)}addNote(e,n){if(this.hasNote(e.name)&&!n)throw new Error("A note with the same name already exists, please use a different name.");let i=e.content?JSON.parse(JSON.stringify(e.content)):e.content;this.mapNoteName_Content.set(e.name,[i])}getNote(e){let n=this.mapNoteName_Content.get(e);return n?n.length===1?{name:e,content:n[0]?JSON.parse(JSON.stringify(n[0])):n[0]}:{name:e,content:JSON.parse(JSON.stringify(n))}:null}getNotes(){let e=[];for(let n of this.mapNoteName_Content){let i=n[1].length===1?n[1][0]:n[1];i=i&&JSON.parse(JSON.stringify(i)),e.push({name:n[0],content:i})}return e}updateNote(e,n,i){let o=this.mapNoteName_Content.get(e);if(!o)throw new Error("The note name does not exist.");i||(o.length=0),n=n&&JSON.parse(JSON.stringify(n)),o.push(n)}deleteNote(e){this.mapNoteName_Content.delete(e)}clearNotes(){this.mapNoteName_Content.clear()}set(e,n){if(!this.extendSet(e,n))if(e==="x"){let i=this._fabricObject.group;i?(this._fabricObject.set("left",n-i.left-i.width/2),i.addWithUpdate()):this._fabricObject.set("left",n)}else if(e==="y"){let i=this._fabricObject.group;i?(this._fabricObject.set("top",n-i.top-i.height/2),i.addWithUpdate()):this._fabricObject.set("top",n)}else e==="styleId"?this.styleId=n:this._fabricObject.set(e,n);["vertices","startPoint","endPoint","x","y","left","top","width","height","scaleX","scaleY","skewX","skewY","padding","angle","strokeWidth"].includes(e)&&this._fabricObject.setCoords()}get(e){let n=this.extendGet(e);if(n===void 0)if(e==="x"){let i=this._fabricObject.group;n=i?this._fabricObject.get("left")+i.left+i.width/2:this._fabricObject.get("left")}else if(e==="y"){let i=this._fabricObject.group;n=i?this._fabricObject.get("top")+i.top+i.height/2:this._fabricObject.get("top")}else n=e==="scaledWidth"?this._fabricObject.getScaledWidth():e==="scaledHeight"?this._fabricObject.getScaledHeight():["type","mediaType"].includes(e)?this.mediaType:e==="state"?this.getState():e==="styleId"?this.styleId:e==="drawingLayerId"?this.drawingLayerId:this._fabricObject.get(e);return n}remove(){this._drawingLayer&&this._drawingLayer.removeDrawingItems([this])}convertPropFromImageToView(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e*b(this,Yo,"m",uu).call(this)}convertPropFromViewToImage(e){if(typeof e!="number")throw new TypeError("Invalid value.");return e/b(this,Yo,"m",uu).call(this)}_setLineWidth(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("strokeWidth",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("strokeWidth",e)}}_getLineWidth(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("strokeWidth"));if(this.coordinateBase==="image")return this.get("strokeWidth");throw new Error("Invalid 'coordinateBase'.")}}_setFontSize(e){if(this._drawingLayer)if(this.coordinateBase==="view")this.set("fontSize",this.convertPropFromViewToImage(e));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("fontSize",e)}}_getFontSize(){if(this._drawingLayer){if(this.coordinateBase==="view")return this.convertPropFromImageToView(this.get("fontSize"));if(this.coordinateBase==="image")return this.get("fontSize");throw new Error("Invalid 'coordinateBase'.")}}};ms=new WeakMap,or=new WeakMap,Yo=new WeakSet,uu=function(){let t=this._drawingLayer;if(!t)return 1;let e=t.width,n=t.height,{width:i,height:o}=t.fabricCanvas.wrapperEl.getBoundingClientRect();if(i<=0||o<=0)throw new Error("Unable to get drawing layer dimensions. Layer may not be rendered on the page.");let h=i/e,p=o/n,v=t._getObjectFit(),w=1;return v==="contain"?h<p?w=i/e:w=o/n:v==="cover"&&(h<p?w=o/n:w=i/e),w},vt.arrMediaTypes=["rect","arc","polygon","image","text","line","quad"],vt.mapItemType=new Map([[fn.ARC,"arc"],[fn.IMAGE,"image"],[fn.LINE,"line"],[fn.POLYGON,"polygon"],[fn.QUAD,"quad"],[fn.RECT,"rect"],[fn.TEXT,"text"],[fn.GROUP,"group"]]),vt.arrStyleSelectors=["default","selected"],vt.mapItemState=new Map([[ma.DEFAULT,"default"],[ma.SELECTED,"selected"]]);var up=t=>t!==null&&typeof t=="object"&&!Array.isArray(t),tu=t=>!!cu(t)&&t!=="";var Lu=pg;var Xg=mg,nw=Po,qg=vg,Ri=yg,Zg=t=>!!up(t)&&!("id"in t&&!Cr(t.id))&&!("lineWidth"in t&&!Cr(t.lineWidth))&&!("fillStyle"in t&&!tu(t.fillStyle))&&!("strokeStyle"in t&&!tu(t.strokeStyle))&&!("paintMode"in t&&!["fill","stroke","strokeAndFill"].includes(t.paintMode))&&!("fontFamily"in t&&!tu(t.fontFamily))&&!("fontSize"in t&&!Cr(t.fontSize)),Ir=class{static convert(e,n,i){let o={x:0,y:0,width:n,height:i};if(!e)return o;if(Ri(e))e.isMeasuredInPercentage?(o.x=e.x/100*n,o.y=e.y/100*i,o.width=e.width/100*n,o.height=e.height/100*i):(o.x=e.x,o.y=e.y,o.width=e.width,o.height=e.height);else{if(!Lu(e))throw TypeError("Invalid region.");e.isMeasuredInPercentage?(o.x=e.left/100*n,o.y=e.top/100*i,o.width=(e.right-e.left)/100*n,o.height=(e.bottom-e.top)/100*i):(o.x=e.left,o.y=e.top,o.width=e.right-e.left,o.height=e.bottom-e.top)}return o.x=Math.round(o.x),o.y=Math.round(o.y),o.width=Math.round(o.width),o.height=Math.round(o.height),o}},Ii,zo,va=class{constructor(){Ii.set(this,new Map),zo.set(this,!1)}get disposed(){return b(this,zo,"f")}on(e,n){e=e.toLowerCase();let i=b(this,Ii,"f").get(e);if(i){if(i.includes(n))return;i.push(n)}else b(this,Ii,"f").set(e,[n])}off(e,n){e=e.toLowerCase();let i=b(this,Ii,"f").get(e);if(!i)return;let o=i.indexOf(n);o!==-1&&i.splice(o,1)}offAll(e){e=e.toLowerCase();let n=b(this,Ii,"f").get(e);n&&(n.length=0)}fire(e,n=[],i={async:!1,copy:!0}){n||(n=[]),e=e.toLowerCase();let o=b(this,Ii,"f").get(e);if(o&&o.length){i=Object.assign({async:!1,copy:!0},i);for(let h of o){if(!h)continue;let p=[];if(i.copy)for(let w of n){try{w=JSON.parse(JSON.stringify(w))}catch{}p.push(w)}else p=n;let v=!1;if(i.async)setTimeout(()=>{this.disposed||o.includes(h)&&h.apply(i.target,p)},0);else try{v=h.apply(i.target,p)}catch{}if(v===!0)break}}}dispose(){Ce(this,zo,!0,"f")}};function iw(t,e,n){return(n.x-t.x)*(e.y-t.y)==(e.x-t.x)*(n.y-t.y)&&Math.min(t.x,e.x)<=n.x&&n.x<=Math.max(t.x,e.x)&&Math.min(t.y,e.y)<=n.y&&n.y<=Math.max(t.y,e.y)}function nu(t){return Math.abs(t)<1e-6?0:t<0?-1:1}function Ho(t,e,n,i){let o=t[0]*(n[1]-e[1])+e[0]*(t[1]-n[1])+n[0]*(e[1]-t[1]),h=t[0]*(i[1]-e[1])+e[0]*(t[1]-i[1])+i[0]*(e[1]-t[1]);return!((o^h)>=0&&o!==0&&h!==0)&&(o=n[0]*(t[1]-i[1])+i[0]*(n[1]-t[1])+t[0]*(i[1]-n[1]),h=n[0]*(e[1]-i[1])+i[0]*(n[1]-e[1])+e[0]*(i[1]-n[1]),!((o^h)>=0&&o!==0&&h!==0))}Ii=new WeakMap,zo=new WeakMap;var Qg=t=>z(void 0,null,function*(){if(typeof t!="string")throw new TypeError("Invalid url.");let e=yield fetch(t);if(!e.ok)throw Error("Network Error: "+e.statusText);let n=yield e.text();if(!n.trim().startsWith("<"))throw Error("Unable to get valid HTMLElement.");let i=document.createElement("div");i.insertAdjacentHTML("beforeend",n);for(let o=0;o<i.childElementCount;++o){let h=i.children[o];h instanceof HTMLStyleElement&&document.head.append(h)}return i.childElementCount==1?i.children[0]:i}),Qn,Kn,rw,sw,Jn,ri=class extends vt{constructor(e,n){if(super(null,n),Qn.set(this,void 0),!Ri(e))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new ke.Rect({left:e.x,top:e.y,width:e.width,height:e.height})),Ce(this,Qn,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="rect"}extendSet(e,n){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth"))),this.set("height",this.convertPropFromViewToImage(this.get("scaledHeight")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth"))),this.set("height",this.convertPropFromImageToView(this.get("scaledHeight")))}setPosition(e){this.setRect(e)}getPosition(){return this.getRect()}updatePosition(){b(this,Qn,"f")&&this.setRect(b(this,Qn,"f"))}setRect(e){if(!Ri(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width)),this.set("height",this.convertPropFromViewToImage(e.height));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width),this.set("height",e.height)}this._drawingLayer.renderAll()}else Ce(this,Qn,JSON.parse(JSON.stringify(e)),"f")}getRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return b(this,Qn,"f")?JSON.parse(JSON.stringify(b(this,Qn,"f"))):null}};function Kg(t,e,n){let i=n.points[this.pointIndex].x-n.pathOffset.x,o=n.points[this.pointIndex].y-n.pathOffset.y;return ke.util.transformPoint({x:i,y:o},n.calcTransformMatrix())}function hp(t){let e=new ke.Point(t.strokeUniform?1/t.scaleX:1,t.strokeUniform?1/t.scaleY:1).multiply(t.strokeWidth);return new ke.Point(t.width+e.x,t.height+e.y)}function Jg(t,e,n,i){let o=e.target,h=o.controls[o.__corner],p=o.toLocalPoint(new ke.Point(n,i),"center","center"),v=hp(o),w=o._getTransformedDimensions(0,0),I={x:p.x*v.x/w.x+o.pathOffset.x,y:p.y*v.y/w.y+o.pathOffset.y};return o.points[h.pointIndex]=I,ke.controlsUtils.fireEvent("scaling",{e:t,transform:e,pointer:{x:n,y:i}}),!0}function ep(t,e){return function(n,i,o,h){let p=i.target,v=ke.util.transformPoint({x:p.points[t].x-p.pathOffset.x,y:p.points[t].y-p.pathOffset.y},p.calcTransformMatrix()),w=e(n,i,o,h);p._setPositionDimensions({});let I=hp(p),S=(p.points[t].x-p.pathOffset.x)/I.x,x=(p.points[t].y-p.pathOffset.y)/I.y;return p.setPositionByOrigin(v,S+.5,x+.5),w}}Qn=new WeakMap;var Bs=class extends vt{constructor(e,n){if(super(null,n),Kn.set(this,void 0),!Xg(e))throw new TypeError("Invalid 'polygon'.");this._setFabricObject(new ke.Polygon(e.points,{objectCaching:!1}));let i=this._fabricObject,o=i.points.length-1;i.controls=i.points.reduce(function(h,p,v){return h["p"+v]=new ke.Control({positionHandler:Kg,actionHandler:ep(v>0?v-1:o,Jg),actionName:"modifyPolygon",pointIndex:v}),h},{}),Ce(this,Kn,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="polygon"}extendSet(e,n){if(e==="vertices"){let i=this._fabricObject;if(i.group){let h=i.group;i.points=n.map(p=>({x:p.x-h.left-h.width/2,y:p.y-h.top-h.height/2})),h.addWithUpdate()}else i.points=n;let o=i.points.length-1;return i.controls=i.points.reduce(function(h,p,v){return h["p"+v]=new ke.Control({positionHandler:Kg,actionHandler:ep(v>0?v-1:o,Jg),actionName:"modifyPolygon",pointIndex:v}),h},{}),i._setPositionDimensions({}),!0}}extendGet(e){if(e==="vertices"){let n=[],i=this._fabricObject;if(i.selectable&&!i.group)for(let o in i.oCoords)n.push({x:i.oCoords[o].x,y:i.oCoords[o].y});else for(let o of i.points){let h=o.x-i.pathOffset.x,p=o.y-i.pathOffset.y,v=ke.util.transformPoint({x:h,y:p},i.calcTransformMatrix());n.push({x:v.x,y:v.y})}return n}}updateCoordinateBaseFromImageToView(){let e=this.get("vertices").map(n=>({x:this.convertPropFromViewToImage(n.x),y:this.convertPropFromViewToImage(n.y)}));this.set("vertices",e)}updateCoordinateBaseFromViewToImage(){let e=this.get("vertices").map(n=>({x:this.convertPropFromImageToView(n.x),y:this.convertPropFromImageToView(n.y)}));this.set("vertices",e)}setPosition(e){this.setPolygon(e)}getPosition(){return this.getPolygon()}updatePosition(){b(this,Kn,"f")&&this.setPolygon(b(this,Kn,"f"))}setPolygon(e){if(!Xg(e))throw new TypeError("Invalid 'polygon'.");if(this._drawingLayer){if(this.coordinateBase==="view"){let n=e.points.map(i=>({x:this.convertPropFromViewToImage(i.x),y:this.convertPropFromViewToImage(i.y)}));this.set("vertices",n)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Ce(this,Kn,JSON.parse(JSON.stringify(e)),"f")}getPolygon(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return b(this,Kn,"f")?JSON.parse(JSON.stringify(b(this,Kn,"f"))):null}};Kn=new WeakMap;rw=new WeakMap,sw=new WeakMap;var tp=t=>{let e=(n=>n.split(`
`).map(i=>i.split("	")))(t);return(n=>{for(let i=0;;i++){let o=-1;for(let h=0;h<n.length;h++){let p=n[h][i];p!==void 0&&p.length>o&&(o=p.length)}if(o===-1)break;for(let h=0;h<n.length;h++){if(i>=n[h].length-1)continue;let p=" ".repeat(o+2-n[h][i].length);n[h][i]=n[h][i].concat(p)}}})(e),(n=>{let i="";for(let o=0;o<n.length;o++)i=i.concat(...n[o],o===n.length-1?"":`
`);return i})(e)},hu=class extends vt{constructor(e,n,i){if(super(null,i),Jn.set(this,void 0),!cu(e))throw new TypeError("Invalid 'text'.");if(!Ri(n))throw new TypeError("Invalid 'rect'.");this._setFabricObject(new ke.Textbox(tp(e),{left:n.x,top:n.y,width:n.width})),this._text=e,Ce(this,Jn,JSON.parse(JSON.stringify(n)),"f"),this._mediaType="text"}extendSet(e,n){if(e==="text")return this._text=n,this._fabricObject.set("text",tp(n)),!0}extendGet(e){if(e==="text")return this._text}updateCoordinateBaseFromImageToView(){this.set("left",this.convertPropFromViewToImage(this.get("left"))),this.set("top",this.convertPropFromViewToImage(this.get("top"))),this.set("width",this.convertPropFromViewToImage(this.get("scaledWidth")))}updateCoordinateBaseFromViewToImage(){this.set("left",this.convertPropFromImageToView(this.get("left"))),this.set("top",this.convertPropFromImageToView(this.get("top"))),this.set("width",this.convertPropFromImageToView(this.get("scaledWidth")))}setPosition(e){this.setTextRect(e)}getPosition(){return this.getTextRect()}updatePosition(){b(this,Jn,"f")&&this.setTextRect(b(this,Jn,"f"))}setText(e){if(!cu(e))throw new TypeError("Invalid 'text'.");this.set("text",e)}getText(){return this.get("text")}setTextRect(e){if(!Ri(e))throw new TypeError("Invalid 'rect'.");if(this._drawingLayer){if(this.coordinateBase==="view")this.set("left",this.convertPropFromViewToImage(e.x)),this.set("top",this.convertPropFromViewToImage(e.y)),this.set("width",this.convertPropFromViewToImage(e.width));else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("left",e.x),this.set("top",e.y),this.set("width",e.width)}this._drawingLayer.renderAll()}else Ce(this,Jn,JSON.parse(JSON.stringify(e)),"f")}getTextRect(){if(this._drawingLayer){if(this.coordinateBase==="view")return{x:this.convertPropFromImageToView(this.get("left")),y:this.convertPropFromImageToView(this.get("top")),width:this.convertPropFromImageToView(this.get("scaledWidth")),height:this.convertPropFromImageToView(this.get("scaledHeight"))};if(this.coordinateBase==="image")return{x:this.get("left"),y:this.get("top"),width:this.get("scaledWidth"),height:this.get("scaledHeight")};throw new Error("Invalid 'coordinateBase'.")}return b(this,Jn,"f")?JSON.parse(JSON.stringify(b(this,Jn,"f"))):null}},ow,ei,ti,ar,du,lr,vs,cr,At,ys,_s,ws,dp,fp,gp,pp,$o,Ye,Es,Cs,Is,lt,Xo,qo,Zo,ni,Ds,bs,fu,xt,Qo,mp,gu,pu,Ts,Ko;Jn=new WeakMap;ow=new WeakMap;var mu=class extends Bs{constructor(e,n){if(super({points:e?.points},n),ei.set(this,void 0),!qg(e))throw new TypeError("Invalid 'quad'.");Ce(this,ei,JSON.parse(JSON.stringify(e)),"f"),this._mediaType="quad"}setPosition(e){this.setQuad(e)}getPosition(){return this.getQuad()}updatePosition(){b(this,ei,"f")&&this.setQuad(b(this,ei,"f"))}setPolygon(){}getPolygon(){return null}setQuad(e){if(!qg(e))throw new TypeError("Invalid 'quad'.");if(this._drawingLayer){if(this.coordinateBase==="view"){let n=e.points.map(i=>({x:this.convertPropFromViewToImage(i.x),y:this.convertPropFromViewToImage(i.y)}));this.set("vertices",n)}else{if(this.coordinateBase!=="image")throw new Error("Invalid 'coordinateBase'.");this.set("vertices",e.points)}this._drawingLayer.renderAll()}else Ce(this,ei,JSON.parse(JSON.stringify(e)),"f")}getQuad(){if(this._drawingLayer){if(this.coordinateBase==="view")return{points:this.get("vertices").map(e=>({x:this.convertPropFromImageToView(e.x),y:this.convertPropFromImageToView(e.y)}))};if(this.coordinateBase==="image")return{points:this.get("vertices")};throw new Error("Invalid 'coordinateBase'.")}return b(this,ei,"f")?JSON.parse(JSON.stringify(b(this,ei,"f"))):null}};ei=new WeakMap;var vu=class extends vt{constructor(e){super(new ke.Group(e.map(n=>n._getFabricObject()))),this._fabricObject.on("selected",()=>{this.setState(Lt.DIS_SELECTED);let n=this._fabricObject._objects;for(let i of n)setTimeout(()=>{i&&i.fire("selected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._fabricObject.on("deselected",()=>{this.setState(Lt.DIS_DEFAULT);let n=this._fabricObject._objects;for(let i of n)setTimeout(()=>{i&&i.fire("deselected")},0);setTimeout(()=>{this._fabricObject&&this._fabricObject.canvas&&(this._fabricObject.dirty=!0,this._fabricObject.canvas.renderAll())},0)}),this._mediaType="group"}extendSet(e,n){return!1}extendGet(e){}updateCoordinateBaseFromImageToView(){}updateCoordinateBaseFromViewToImage(){}setPosition(){}getPosition(){}updatePosition(){}getChildDrawingItems(){return this._fabricObject._objects.map(e=>e.getDrawingItem())}setChildDrawingItems(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"add"):this._fabricObject.addWithUpdate(e._getFabricObject())}removeChildItem(e){e&&e.isDrawingItem&&(this._drawingLayer?this._drawingLayer._updateGroupItem(this,e,"remove"):this._fabricObject.removeWithUpdate(e._getFabricObject()))}},le=class t{static createDrawingStyle(e){if(!Zg(e))throw new Error("Invalid style definition.");let n,i=t.USER_START_STYLE_ID;for(;b(t,ti,"f",ar).has(i);)i++;n=i;let o=JSON.parse(JSON.stringify(e));o.id=n;for(let h in b(t,ti,"f",du))o.hasOwnProperty(h)||(o[h]=b(t,ti,"f",du)[h]);return b(t,ti,"f",ar).set(n,o),o.id}static _getDrawingStyle(e,n){if(typeof e!="number")throw new Error("Invalid style id.");let i=b(t,ti,"f",ar).get(e);return i?n?JSON.parse(JSON.stringify(i)):i:null}static getDrawingStyle(e){return this._getDrawingStyle(e,!0)}static getAllDrawingStyles(){return JSON.parse(JSON.stringify(Array.from(b(t,ti,"f",ar).values())))}static _updateDrawingStyle(e,n){if(!Zg(n))throw new Error("Invalid style definition.");let i=b(t,ti,"f",ar).get(e);if(i)for(let o in n)i.hasOwnProperty(o)&&(i[o]=n[o])}static updateDrawingStyle(e,n){this._updateDrawingStyle(e,n)}};ti=le,le.STYLE_BLUE_STROKE=1,le.STYLE_GREEN_STROKE=2,le.STYLE_ORANGE_STROKE=3,le.STYLE_YELLOW_STROKE=4,le.STYLE_BLUE_STROKE_FILL=5,le.STYLE_GREEN_STROKE_FILL=6,le.STYLE_ORANGE_STROKE_FILL=7,le.STYLE_YELLOW_STROKE_FILL=8,le.STYLE_BLUE_STROKE_TRANSPARENT=9,le.STYLE_GREEN_STROKE_TRANSPARENT=10,le.STYLE_ORANGE_STROKE_TRANSPARENT=11,le.USER_START_STYLE_ID=1024,ar={value:new Map([[le.STYLE_BLUE_STROKE,{id:le.STYLE_BLUE_STROKE,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[le.STYLE_GREEN_STROKE,{id:le.STYLE_GREEN_STROKE,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_ORANGE_STROKE,{id:le.STYLE_ORANGE_STROKE,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_YELLOW_STROKE,{id:le.STYLE_YELLOW_STROKE,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}],[le.STYLE_BLUE_STROKE_FILL,{id:le.STYLE_BLUE_STROKE_FILL,lineWidth:4,fillStyle:"rgba(73, 173, 245, 0.3)",strokeStyle:"rgba(73, 173, 245, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_GREEN_STROKE_FILL,{id:le.STYLE_GREEN_STROKE_FILL,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.3)",strokeStyle:"rgba(73, 245, 73, 0.9)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_ORANGE_STROKE_FILL,{id:le.STYLE_ORANGE_STROKE_FILL,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.3)",strokeStyle:"rgba(254, 180, 32, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_YELLOW_STROKE_FILL,{id:le.STYLE_YELLOW_STROKE_FILL,lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_BLUE_STROKE_TRANSPARENT,{id:le.STYLE_BLUE_STROKE_TRANSPARENT,lineWidth:4,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_GREEN_STROKE_TRANSPARENT,{id:le.STYLE_GREEN_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(73, 245, 73, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}],[le.STYLE_ORANGE_STROKE_TRANSPARENT,{id:le.STYLE_ORANGE_STROKE_TRANSPARENT,lineWidth:2,fillStyle:"rgba(254, 180, 32, 0.2)",strokeStyle:"transparent",paintMode:"strokeAndFill",fontFamily:"consolas",fontSize:40}]])},du={value:{lineWidth:2,fillStyle:"rgba(245, 236, 73, 0.3)",strokeStyle:"rgba(245, 236, 73, 1)",paintMode:"stroke",fontFamily:"consolas",fontSize:40}},typeof document<"u"&&typeof window<"u"&&(ke.StaticCanvas.prototype.dispose=function(){return this.isRendering&&(ke.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(t){t.dispose&&t.dispose()}),this._objects=[],this.backgroundImage&&this.backgroundImage.dispose&&this.backgroundImage.dispose(),this.backgroundImage=null,this.overlayImage&&this.overlayImage.dispose&&this.overlayImage.dispose(),this.overlayImage=null,this._iTextInstances=null,this.contextContainer=null,this.lowerCanvasEl.classList.remove("lower-canvas"),delete this._originalCanvasStyle,this.lowerCanvasEl.setAttribute("width",this.width),this.lowerCanvasEl.setAttribute("height",this.height),ke.util.cleanUpJsdomNode(this.lowerCanvasEl),this.lowerCanvasEl=void 0,this},ke.Object.prototype.transparentCorners=!1,ke.Object.prototype.cornerSize=20,ke.Object.prototype.touchCornerSize=100,ke.Object.prototype.cornerColor="rgb(254,142,20)",ke.Object.prototype.cornerStyle="circle",ke.Object.prototype.strokeUniform=!0,ke.Object.prototype.hasBorders=!1,ke.Canvas.prototype.containerClass="",ke.Canvas.prototype.getPointer=function(t,e){if(this._absolutePointer&&!e)return this._absolutePointer;if(this._pointer&&e)return this._pointer;var n,i=this.upperCanvasEl,o=ke.util.getPointer(t,i),h=i.getBoundingClientRect(),p=h.width||0,v=h.height||0;p&&v||("top"in h&&"bottom"in h&&(v=Math.abs(h.top-h.bottom)),"right"in h&&"left"in h&&(p=Math.abs(h.right-h.left))),this.calcOffset(),o.x=o.x-this._offset.left,o.y=o.y-this._offset.top,e||(o=this.restorePointerVpt(o));var w=this.getRetinaScaling();if(w!==1&&(o.x/=w,o.y/=w),p!==0&&v!==0){var I=window.getComputedStyle(i).objectFit,S=i.width,x=i.height,M=p,R=v;n={width:S/M,height:x/R};var O,B,V=S/x,H=M/R;return I==="contain"?V>H?(O=M,B=M/V,{x:o.x*n.width,y:(o.y-(R-B)/2)*n.width}):(O=R*V,B=R,{x:(o.x-(M-O)/2)*n.height,y:o.y*n.height}):I==="cover"?V>H?{x:(S-n.height*M)/2+o.x*n.height,y:o.y*n.height}:{x:o.x*n.width,y:(x-n.width*R)/2+o.y*n.width}:{x:o.x*n.width,y:o.y*n.height}}return n={width:1,height:1},{x:o.x*n.width,y:o.y*n.height}},ke.Canvas.prototype._onTouchStart=function(t){var e=this.findTarget(t);!this.allowTouchScrolling&&t.cancelable&&t.preventDefault&&t.preventDefault(),e&&t.cancelable&&t.preventDefault&&t.preventDefault(),this.mainTouchId===null&&(this.mainTouchId=this.getPointerId(t)),this.__onMouseDown(t),this._resetTransformEventData();var n=this.upperCanvasEl,i=this._getEventPrefix();ke.util.addListener(ke.document,"touchend",this._onTouchEnd,{passive:!1}),ke.util.addListener(ke.document,"touchmove",this._onMouseMove,{passive:!1}),ke.util.removeListener(n,i+"down",this._onMouseDown)},ke.Textbox.prototype._wrapLine=function(t,e,n,i){let o=t.match(/[\u3040-\u30ff\u3400-\u4dbf\u4e00-\u9fff\uf900-\ufaff\uff66-\uff9f]/g),h=!(!o||!o.length);var p=0,v=this.splitByGrapheme||h,w=[],I=[],S=v?ke.util.string.graphemeSplit(t):t.split(this._wordJoiners),x="",M=0,R=v?"":" ",O=0,B=0,V=0,H=!0,Y=this._getWidthOfCharSpacing();i=i||0,S.length===0&&S.push([]),n-=i;for(var Z=0;Z<S.length;Z++)x=v?S[Z]:ke.util.string.graphemeSplit(S[Z]),O=this._measureWord(x,e,M),M+=x.length,(p+=B+O-Y)>n&&!H?(w.push(I),I=[],p=O,H=!0):p+=Y,H||v||I.push(R),I=I.concat(x),B=v?0:this._measureWord([R],e,M),M++,H=!1,O>V&&(V=O);return Z&&w.push(I),V+i>this.dynamicMinWidth&&(this.dynamicMinWidth=V-Y+i),w});var nt=class t{get width(){return this.fabricCanvas.width}get height(){return this.fabricCanvas.height}set _allowMultiSelect(e){this.fabricCanvas.selection=e,this.fabricCanvas.renderAll()}get _allowMultiSelect(){return this.fabricCanvas.selection}constructor(e,n,i){if(this.mapType_StateAndStyleId=new Map,this.mode="viewer",this.onSelectionChanged=null,this._arrDrwaingItem=[],this._arrFabricObject=[],this._visible=!0,e.hasOwnProperty("getFabricCanvas"))this.fabricCanvas=e.getFabricCanvas();else{let p=this.fabricCanvas=new ke.Canvas(e,Object.assign(i,{allowTouchScrolling:!0,selection:!1}));p.setDimensions({width:"100%",height:"100%"},{cssOnly:!0}),p.lowerCanvasEl.className="",p.upperCanvasEl.className="",p.on("selection:created",function(v){let w=v.selected,I=[];for(let S of w){let x=S.getDrawingItem()._drawingLayer;x&&!I.includes(x)&&I.push(x)}for(let S of I){let x=[];for(let M of w){let R=M.getDrawingItem();R._drawingLayer===S&&x.push(R)}setTimeout(()=>{S.onSelectionChanged&&S.onSelectionChanged(x,[])},0)}}),p.on("before:selection:cleared",function(v){let w=this.getActiveObjects(),I=[];for(let S of w){let x=S.getDrawingItem()._drawingLayer;x&&!I.includes(x)&&I.push(x)}for(let S of I){let x=[];for(let M of w){let R=M.getDrawingItem();R._drawingLayer===S&&x.push(R)}setTimeout(()=>{let M=[];for(let R of x)S.hasDrawingItem(R)&&M.push(R);M.length>0&&S.onSelectionChanged&&S.onSelectionChanged([],M)},0)}}),p.on("selection:updated",function(v){let w=v.selected,I=v.deselected,S=[];for(let x of w){let M=x.getDrawingItem()._drawingLayer;M&&!S.includes(M)&&S.push(M)}for(let x of I){let M=x.getDrawingItem()._drawingLayer;M&&!S.includes(M)&&S.push(M)}for(let x of S){let M=[],R=[];for(let O of w){let B=O.getDrawingItem();B._drawingLayer===x&&M.push(B)}for(let O of I){let B=O.getDrawingItem();B._drawingLayer===x&&R.push(B)}setTimeout(()=>{x.onSelectionChanged&&x.onSelectionChanged(M,R)},0)}}),p.wrapperEl.style.position="absolute",e.getFabricCanvas=()=>this.fabricCanvas}let o,h;switch(this.id=n,n){case t.DDN_LAYER_ID:o=le.getDrawingStyle(le.STYLE_BLUE_STROKE),h=le.getDrawingStyle(le.STYLE_BLUE_STROKE_FILL);break;case t.DBR_LAYER_ID:o=le.getDrawingStyle(le.STYLE_ORANGE_STROKE),h=le.getDrawingStyle(le.STYLE_ORANGE_STROKE_FILL);break;case t.DLR_LAYER_ID:o=le.getDrawingStyle(le.STYLE_GREEN_STROKE),h=le.getDrawingStyle(le.STYLE_GREEN_STROKE_FILL);break;default:o=le.getDrawingStyle(le.STYLE_YELLOW_STROKE),h=le.getDrawingStyle(le.STYLE_YELLOW_STROKE_FILL)}for(let p of vt.arrMediaTypes)this.mapType_StateAndStyleId.set(p,{default:o.id,selected:h.id})}getId(){return this.id}setVisible(e){if(e){for(let n of this._arrFabricObject)n.visible=!0,n.hasControls=!0;this._visible=!0}else{for(let n of this._arrFabricObject)n.visible=!1,n.hasControls=!1;this._visible=!1}this.fabricCanvas.renderAll()}isVisible(){return this._visible}_getItemCurrentStyle(e){return e.styleId?le.getDrawingStyle(e.styleId):le.getDrawingStyle(e._mapState_StyleId.get(e.styleSelector))||null}_changeMediaTypeCurStyleInStyleSelector(e,n,i,o){let h=this.getDrawingItems(p=>p._mediaType===e);for(let p of h)p.styleSelector===n&&this._changeItemStyle(p,i,!0);o||this.fabricCanvas.renderAll()}_changeItemStyle(e,n,i){if(!e||!n)return;let o=e._getFabricObject();typeof e.styleId=="number"&&(n=le.getDrawingStyle(e.styleId)),o.strokeWidth=n.lineWidth,n.paintMode==="fill"?(o.fill=n.fillStyle,o.stroke=n.fillStyle):n.paintMode==="stroke"?(o.fill="transparent",o.stroke=n.strokeStyle):n.paintMode==="strokeAndFill"&&(o.fill=n.fillStyle,o.stroke=n.strokeStyle),o.fontFamily&&(o.fontFamily=n.fontFamily),o.fontSize&&(o.fontSize=n.fontSize),o.group||(o.dirty=!0),i||this.fabricCanvas.renderAll()}_updateGroupItem(e,n,i){if(!e||!n)return;let o=e.getChildDrawingItems();if(i==="add"){if(o.includes(n))return;let h=n._getFabricObject();if(this.fabricCanvas.getObjects().includes(h)){if(!this._arrFabricObject.includes(h))throw new Error("Existed in other drawing layers.");n._zIndex=null}else{let p;if(n.styleId)p=le.getDrawingStyle(n.styleId);else{let v=this.mapType_StateAndStyleId.get(n._mediaType);p=le.getDrawingStyle(v[e.styleSelector]);let w=()=>{this._changeItemStyle(n,le.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).selected),!0)},I=()=>{this._changeItemStyle(n,le.getDrawingStyle(this.mapType_StateAndStyleId.get(n._mediaType).default),!0)};n._on("selected",w),n._on("deselected",I),n._funcChangeStyleToSelected=w,n._funcChangeStyleToDefault=I}n._drawingLayer=this,n._drawingLayerId=this.id,this._changeItemStyle(n,p,!0)}e._fabricObject.addWithUpdate(n._getFabricObject())}else{if(i!=="remove"||!o.includes(n))return;n._zIndex=null,n._drawingLayer=null,n._drawingLayerId=null,n._off("selected",n._funcChangeStyleToSelected),n._off("deselected",n._funcChangeStyleToDefault),n._funcChangeStyleToSelected=null,n._funcChangeStyleToDefault=null,e._fabricObject.removeWithUpdate(n._getFabricObject())}this.fabricCanvas.renderAll()}_addDrawingItem(e,n){if(!(e instanceof vt))throw new TypeError("Invalid 'drawingItem'.");if(e._drawingLayer){if(e._drawingLayer==this)return;throw new Error("This drawing item has existed in other layer.")}let i=e._getFabricObject(),o=this.fabricCanvas.getObjects(),h,p;if(o.includes(i)){if(this._arrFabricObject.includes(i))return;throw new Error("Existed in other drawing layers.")}if(e._mediaType==="group"){h=e.getChildDrawingItems();for(let I of h)if(I._drawingLayer&&I._drawingLayer!==this)throw new Error("The childItems of DT_Group have existed in other drawing layers.")}if(n&&typeof n=="object"&&!Array.isArray(n))for(let I in n)i.set(I,n[I]);if(h){for(let I of h){let S=this.mapType_StateAndStyleId.get(I._mediaType);for(let x of vt.arrStyleSelectors)I._mapState_StyleId.set(x,S[x]);if(I.styleId)p=le.getDrawingStyle(I.styleId);else{p=le.getDrawingStyle(S.default);let x=()=>{this._changeItemStyle(I,le.getDrawingStyle(this.mapType_StateAndStyleId.get(I._mediaType).selected),!0)},M=()=>{this._changeItemStyle(I,le.getDrawingStyle(this.mapType_StateAndStyleId.get(I._mediaType).default),!0)};I._on("selected",x),I._on("deselected",M),I._funcChangeStyleToSelected=x,I._funcChangeStyleToDefault=M}I._drawingLayer=this,I._drawingLayerId=this.id,this._changeItemStyle(I,p,!0)}i.dirty=!0,this.fabricCanvas.renderAll()}else{let I=this.mapType_StateAndStyleId.get(e._mediaType);for(let S of vt.arrStyleSelectors)e._mapState_StyleId.set(S,I[S]);if(e.styleId)p=le.getDrawingStyle(e.styleId);else{p=le.getDrawingStyle(I.default);let S=()=>{this._changeItemStyle(e,le.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).selected))},x=()=>{this._changeItemStyle(e,le.getDrawingStyle(this.mapType_StateAndStyleId.get(e._mediaType).default))};e._on("selected",S),e._on("deselected",x),e._funcChangeStyleToSelected=S,e._funcChangeStyleToDefault=x}this._changeItemStyle(e,p)}e._zIndex=this.id,e._drawingLayer=this,e._drawingLayerId=this.id;let v=this._arrFabricObject.length,w=o.length;if(v)w=o.indexOf(this._arrFabricObject[v-1])+1;else for(let I=0;I<o.length;I++)if(e._zIndex<o[I].getDrawingItem()._zIndex){w=I;break}this._arrDrwaingItem.push(e),this._arrFabricObject.push(i),this._visible?i.visible=!0:i.visible=!1,this.fabricCanvas.insertAt(i,w,!1)}addDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(this.mode==="viewer")e._setEditable(!1);else{if(this.mode!=="editor")throw new Error("Illegal 'mode'.");e._setEditable(!0)}this._addDrawingItem(e),e.updatePosition()}addDrawingItems(e){for(let n of e)this.addDrawingItem(n)}removeDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");if(!this.hasDrawingItem(e))return;if(e._zIndex=null,e._drawingLayer=null,e._drawingLayerId=null,e._mediaType==="group"){let i=e.getChildDrawingItems();for(let o of i)o._zIndex=null,o._drawingLayer=null,o._drawingLayerId=null,o._off("selected",o._funcChangeStyleToSelected),o._off("deselected",o._funcChangeStyleToDefault),o._funcChangeStyleToSelected=null,o._funcChangeStyleToDefault=null,o._mapState_StyleId.clear()}else e._off("selected",e._funcChangeStyleToSelected),e._off("deselected",e._funcChangeStyleToDefault),e._funcChangeStyleToSelected=null,e._funcChangeStyleToDefault=null,e._mapState_StyleId.clear();let n=e._getFabricObject();e.styleSelector==="selected"&&(n.group?n.group.removeWithUpdate(n):this.fabricCanvas._activeObject=null,e.setState(Lt.DIS_DEFAULT)),this.fabricCanvas.remove(n),this._arrDrwaingItem.splice(this._arrDrwaingItem.indexOf(e),1),this._arrFabricObject.splice(this._arrFabricObject.indexOf(n),1)}removeDrawingItems(e){for(let n of e)this.removeDrawingItem(n)}setDrawingItems(e){this.clearDrawingItems(),this.addDrawingItems(e)}getDrawingItems(e){return e&&typeof e=="function"?this._arrDrwaingItem.filter(e):Array.from(this._arrDrwaingItem)}getSelectedDrawingItems(){let e=this.fabricCanvas.getActiveObjects(),n=[];for(let i of e)this._arrFabricObject.includes(i)&&n.push(i.getDrawingItem());return n}hasDrawingItem(e){if(!e||!e.isDrawingItem)throw TypeError("Illegal drawing item.");return this._arrDrwaingItem.includes(e)}clearDrawingItems(){this.removeDrawingItems(Array.from(this._arrDrwaingItem))}_setDefaultStyle(e,n,i){n?n.forEach(p=>p.toLowerCase()):n=vt.arrMediaTypes,i?i.forEach(p=>p.toLowerCase()):i=vt.arrStyleSelectors;let o=le.getDrawingStyle(e);if(!o)throw new Error(`The 'drawingStyle' with id '${e}' doesn't exist.`);let h;for(let p of n)if(h=this.mapType_StateAndStyleId.get(p),h)for(let v of i){this._changeMediaTypeCurStyleInStyleSelector(p,v,o,!0),h[v]=e;for(let w of this._arrDrwaingItem)w._mediaType===p&&w._mapState_StyleId.set(v,e)}this.fabricCanvas.renderAll()}setDefaultStyle(e,n,i){let o=[];i&gt.DIMT_RECTANGLE&&o.push("rect"),i&gt.DIMT_QUADRILATERAL&&o.push("quad"),i&gt.DIMT_TEXT&&o.push("text"),i&gt.DIMT_ARC&&o.push("arc"),i&gt.DIMT_IMAGE&&o.push("image"),i&gt.DIMT_POLYGON&&o.push("polygon"),i&gt.DIMT_LINE&&o.push("line");let h=[];n&Lt.DIS_DEFAULT&&h.push("default"),n&Lt.DIS_SELECTED&&h.push("selected"),this._setDefaultStyle(e,o.length?o:null,h.length?h:null)}setMode(e){if((e=e.toLowerCase())==="viewer"){for(let n of this._arrDrwaingItem)n._setEditable(!1);this.fabricCanvas.discardActiveObject(),this.fabricCanvas.renderAll(),this.mode="viewer"}else{if(e!=="editor")throw new RangeError("Invalid value.");for(let n of this._arrDrwaingItem)n._setEditable(!0);this.mode="editor"}this._manager._switchPointerEvent()}getMode(){return this.mode}_setDimensions(e,n){this.fabricCanvas.setDimensions(e,n)}_setObjectFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);this.fabricCanvas.lowerCanvasEl.style.objectFit=e,this.fabricCanvas.upperCanvasEl.style.objectFit=e}_getObjectFit(){return this.fabricCanvas.lowerCanvasEl.style.objectFit}renderAll(){for(let e of this._arrDrwaingItem){let n=this._getItemCurrentStyle(e);this._changeItemStyle(e,n,!0)}this.fabricCanvas.renderAll()}dispose(){this.clearDrawingItems(),this._manager._arrDrawingLayer.length===1&&(this.fabricCanvas.wrapperEl.style.pointerEvents="none",this.fabricCanvas.dispose(),this._arrDrwaingItem.length=0,this._arrFabricObject.length=0)}};nt.DDN_LAYER_ID=1,nt.DBR_LAYER_ID=2,nt.DLR_LAYER_ID=3,nt.USER_DEFINED_LAYER_BASE_ID=100,nt.TIP_LAYER_ID=999;var yu=class{constructor(){this._arrDrawingLayer=[]}createDrawingLayer(e,n){if(this.getDrawingLayer(n))throw new Error("Existed drawing layer id.");let i=new nt(e,n,{enableRetinaScaling:!1});return i._manager=this,this._arrDrawingLayer.push(i),this._switchPointerEvent(),i}deleteDrawingLayer(e){let n=this.getDrawingLayer(e);if(!n)return;let i=this._arrDrawingLayer;n.dispose(),i.splice(i.indexOf(n),1),this._switchPointerEvent()}clearDrawingLayers(){for(let e of this._arrDrawingLayer)e.dispose();this._arrDrawingLayer.length=0}getDrawingLayer(e){for(let n of this._arrDrawingLayer)if(n.getId()===e)return n;return null}getAllDrawingLayers(){return Array.from(this._arrDrawingLayer)}getSelectedDrawingItems(){if(!this._arrDrawingLayer.length)return;let e=this._getFabricCanvas().getActiveObjects(),n=[];for(let i of e)n.push(i.getDrawingItem());return n}setDimensions(e,n){this._arrDrawingLayer.length&&this._arrDrawingLayer[0]._setDimensions(e,n)}setObjectFit(e){for(let n of this._arrDrawingLayer)n&&n._setObjectFit(e)}getObjectFit(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0]._getObjectFit():null}setVisible(e){if(!this._arrDrawingLayer.length)return;let n=this._getFabricCanvas();n.wrapperEl.style.display=e?"block":"none"}_getFabricCanvas(){return this._arrDrawingLayer.length?this._arrDrawingLayer[0].fabricCanvas:null}_switchPointerEvent(){if(this._arrDrawingLayer.length)for(let e of this._arrDrawingLayer)e.getMode()}},_u=class extends hu{constructor(e,n,i,o,h){super(e,{x:n,y:i,width:o,height:0},h),lr.set(this,void 0),vs.set(this,void 0),this._fabricObject.paddingTop=15,this._fabricObject.calcTextHeight=function(){for(var p=0,v=0,w=this._textLines.length;v<w;v++)p+=this.getHeightOfLine(v);return p+=2*this.paddingTop},this._fabricObject._getTopOffset=function(){return-this.height/2+this.getHeightOfLine(0)*(1-1/this.lineHeight)/2+this.paddingTop},this.set("backgroundColor","rgba(50, 50, 52, .8)"),this.set("lineHeight",1.3),this.set("textAlign","center")}setDuration(e){Ce(this,lr,e,"f"),b(this,vs,"f")&&clearTimeout(b(this,vs,"f")),b(this,lr,"f")>=0&&Ce(this,vs,setTimeout(()=>{this.set("visible",!1),this._drawingLayer&&this._drawingLayer.renderAll()},b(this,lr,"f")),"f")}getDuration(){return b(this,lr,"f")}};lr=new WeakMap,vs=new WeakMap;var wu=class{constructor(){cr.add(this),At.set(this,void 0),ys.set(this,void 0),_s.set(this,void 0),ws.set(this,!0),this._drawingLayerManager=new yu}createDrawingLayerBaseCvs(e,n,i="contain"){if(typeof e!="number"||e<=1)throw new Error("Invalid 'width'.");if(typeof n!="number"||n<=1)throw new Error("Invalid 'height'.");if(!["contain","cover"].includes(i))throw new Error("Unsupported 'objectFit'.");let o=document.createElement("canvas");return o.width==e&&o.height==n||(o.width=e,o.height=n),o.style.objectFit=i,o}_createDrawingLayer(e,n,i,o){if(!this._layerBaseCvs){let v;try{v=this.getContentDimensions()}catch(w){if((w.message||w)!=="Invalid content dimensions.")throw w}n||(n=v?.width||1280),i||(i=v?.height||720),o||(o=v?.objectFit||"contain"),this._layerBaseCvs=this.createDrawingLayerBaseCvs(n,i,o)}let h=this._layerBaseCvs,p=this._drawingLayerManager.createDrawingLayer(h,e);return this._innerComponent.getElement("drawing-layer")||this._innerComponent.setElement("drawing-layer",h.parentElement),p}createDrawingLayer(){let e;for(let n=nt.USER_DEFINED_LAYER_BASE_ID;;n++)if(!this._drawingLayerManager.getDrawingLayer(n)&&n!==nt.TIP_LAYER_ID){e=n;break}return this._createDrawingLayer(e)}deleteDrawingLayer(e){var n;this._drawingLayerManager.deleteDrawingLayer(e),this._drawingLayerManager.getAllDrawingLayers().length||((n=this._innerComponent)===null||n===void 0||n.removeElement("drawing-layer"),this._layerBaseCvs=null)}deleteUserDefinedDrawingLayer(e){if(typeof e!="number")throw new TypeError("Invalid id.");if(e<nt.USER_DEFINED_LAYER_BASE_ID)throw new Error(`The drawing layer with id ${e} is not defined by users.`);this.deleteDrawingLayer(e)}_clearDrawingLayers(){let e=this.getAllDrawingLayers();for(let n of e)this.deleteDrawingLayer(n.getId())}clearUserDefinedDrawingLayers(){let e=this.getAllDrawingLayers();for(let n of e){let i=n.getId();i<nt.USER_DEFINED_LAYER_BASE_ID||this.deleteUserDefinedDrawingLayer(i)}}getDrawingLayer(e){return e==nt.TIP_LAYER_ID?null:this._drawingLayerManager.getDrawingLayer(e)||([nt.DDN_LAYER_ID,nt.DBR_LAYER_ID,nt.DLR_LAYER_ID].includes(e)?this._createDrawingLayer(e):null)}getAllDrawingLayers(){return this._drawingLayerManager.getAllDrawingLayers().filter(e=>e.getId()>=0&&e.getId()!==nt.TIP_LAYER_ID)}updateDrawingLayers(e){((n,i,o)=>{if(!(n<=1||i<=1)){if(!["contain","cover"].includes(o))throw new Error("Unsupported 'objectFit'.");this._drawingLayerManager.setDimensions({width:n,height:i},{backstoreOnly:!0}),this._drawingLayerManager.setObjectFit(o)}})(e.width,e.height,e.objectFit)}getSelectedDrawingItems(){return this._drawingLayerManager.getSelectedDrawingItems()}setTipConfig(e){if(!(up(n=e)&&nw(n.topLeftPoint)&&Cr(n.width))||n.width<=0||!Cr(n.duration)||"coordinateBase"in n&&!["view","image"].includes(n.coordinateBase))throw new Error("Invalid tip config.");var n;Ce(this,At,JSON.parse(JSON.stringify(e)),"f"),b(this,At,"f").coordinateBase||(b(this,At,"f").coordinateBase="view"),Ce(this,_s,e.duration,"f"),b(this,cr,"m",pp).call(this)}getTipConfig(){return b(this,At,"f")?b(this,At,"f"):null}setTipVisible(e){if(typeof e!="boolean")throw new TypeError("Invalid value.");this._tip&&(this._tip.set("visible",e),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll()),Ce(this,ws,e,"f")}isTipVisible(){return b(this,ws,"f")}updateTipMessage(e){if(!b(this,At,"f"))throw new Error("Tip config is not set.");this._tipStyleId||(this._tipStyleId=le.createDrawingStyle({fillStyle:"#FFFFFF",paintMode:"fill",fontFamily:"Open Sans",fontSize:40})),this._drawingLayerOfTip||(this._drawingLayerOfTip=this._drawingLayerManager.getDrawingLayer(nt.TIP_LAYER_ID)||this._createDrawingLayer(nt.TIP_LAYER_ID)),this._tip?this._tip.set("text",e):this._tip=b(this,cr,"m",dp).call(this,e,b(this,At,"f").topLeftPoint.x,b(this,At,"f").topLeftPoint.y,b(this,At,"f").width,b(this,At,"f").coordinateBase,this._tipStyleId),b(this,cr,"m",fp).call(this,this._tip,this._drawingLayerOfTip),this._tip.set("visible",b(this,ws,"f")),this._drawingLayerOfTip&&this._drawingLayerOfTip.renderAll(),b(this,ys,"f")&&clearTimeout(b(this,ys,"f")),b(this,_s,"f")>=0&&Ce(this,ys,setTimeout(()=>{b(this,cr,"m",gp).call(this)},b(this,_s,"f")),"f")}};At=new WeakMap,ys=new WeakMap,_s=new WeakMap,ws=new WeakMap,cr=new WeakSet,dp=function(t,e,n,i,o,h){let p=new _u(t,e,n,i,h);return p.coordinateBase=o,p},fp=function(t,e){e.hasDrawingItem(t)||e.addDrawingItems([t])},gp=function(){this._tip&&this._drawingLayerOfTip.removeDrawingItems([this._tip])},pp=function(){if(!this._tip)return;let t=b(this,At,"f");this._tip.coordinateBase=t.coordinateBase,this._tip.setTextRect({x:t.topLeftPoint.x,y:t.topLeftPoint.y,width:t.width,height:0}),this._tip.set("width",this._tip.get("width")),this._tip._drawingLayer&&this._tip._drawingLayer.renderAll()};var ya=class extends HTMLElement{constructor(){super(),$o.set(this,void 0);let e=document.createElement("template").content,n=document.createElement("div");n.setAttribute("class","wrapper"),e.appendChild(n),Ce(this,$o,n,"f");let i=document.createElement("slot");i.setAttribute("name","single-frame-input-container"),n.append(i);let o=document.createElement("slot");o.setAttribute("name","content"),n.append(o);let h=document.createElement("slot");h.setAttribute("name","drawing-layer"),n.append(h);let p=document.createElement("style");p.textContent=`
.wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}
::slotted(canvas[slot="content"]) {
  object-fit: contain;
  pointer-events: none;
}
::slotted(div[slot="single-frame-input-container"]) {
  width: 1px;
  height: 1px;
  overflow: hidden;
  pointer-events: none;
}
::slotted(*) {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
    `,e.appendChild(p),this.attachShadow({mode:"open"}).appendChild(e.cloneNode(!0))}getWrapper(){return b(this,$o,"f")}setElement(e,n){if(!(n instanceof HTMLElement))throw new TypeError("Invalid 'el'.");if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");this.removeElement(e),n.setAttribute("slot",e),this.appendChild(n)}getElement(e){if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");return this.querySelector(`[slot="${e}"]`)}removeElement(e){var n;if(!["content","single-frame-input-container","drawing-layer"].includes(e))throw new TypeError("Invalid 'slot'.");(n=this.querySelectorAll(`[slot="${e}"]`))===null||n===void 0||n.forEach(i=>i.remove())}};$o=new WeakMap,customElements.get("dce-component")||customElements.define("dce-component",ya);var si=class extends HTMLElement{constructor(){super();let e=window._dce_default_template.content;this.attachShadow({mode:"open"}).appendChild(e.cloneNode(!0))}showScanLaser(){let e=this.shadowRoot.querySelector(".dce-scanlight");e&&(e.style.display="")}hideScanLaser(){let e=this.shadowRoot.querySelector(".dce-scanlight");e&&(e.style.display="none")}getElement(e){return this.shadowRoot.querySelector(e)}getVideoContainer(){return this.shadowRoot.querySelector(".dce-video-container")}getScanAreaEl(){return this.shadowRoot.querySelector(".dce-scanarea")}getScanLightEl(){return this.shadowRoot.querySelector(".dce-scanlight")}getLoadingBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-loading")}getCameraBackgroundEl(){return this.shadowRoot.querySelector(".dce-bg-camera")}getCameraSelectEl(){return this.shadowRoot.querySelector(".dce-sel-camera")}getResolutionSelectEl(){return this.shadowRoot.querySelector(".dce-sel-resolution")}getResolutionOptionEl(){return this.shadowRoot.querySelector(".dce-opt-gotResolution")}getCloseBtnEl(){return this.shadowRoot.querySelector(".dce-btn-close")}getDLRSelectEl(){return this.shadowRoot.querySelector(".dlr-sel-minletter")}getDLROptionEl(){return this.shadowRoot.querySelector(".dlr-opt-gotMinLtr")}},pn=class t extends wu{static get engineResourcePath(){return Je.engineResourcePaths.dce}static set defaultUIElementURL(e){t._defaultUIElementURL=e}static get defaultUIElementURL(){var e;return(e=t._defaultUIElementURL)===null||e===void 0?void 0:e.replace("@engineResourcePath/",t.engineResourcePath)}static createInstance(e){return z(this,null,function*(){customElements.get(t.uiComponentName)||customElements.define(t.uiComponentName,si);let n=new t;return yield n.setUIElement(e||t.defaultUIElementURL),n})}static _transformCoordinates(e,n,i,o,h,p,v){let w=p/o,I=v/h;e.x=Math.round(e.x/w+n),e.y=Math.round(e.y/I+i)}set _singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(e!==b(this,Ds,"f")){if(Ce(this,Ds,e,"f"),b(this,Ye,"m",xt).call(this))Ce(this,lt,null,"f"),this._videoContainer=null,this._innerComponent.removeElement("content"),this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block");else if(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none"),!b(this,lt,"f")){let n=document.createElement("video");n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.width="100%",n.style.height="100%",n.style.objectFit=this.getVideoFit(),n.setAttribute("autoplay","true"),n.setAttribute("playsinline","true"),n.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(ft.OS)&&n.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Ce(this,lt,n,"f");let i=document.createElement("div");i.append(n),i.style.overflow="hidden",this._videoContainer=i,this._innerComponent.setElement("content",i)}b(this,Ye,"m",xt).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading())}}get _singleFrameMode(){return b(this,Ds,"f")}get disposed(){return b(this,fu,"f")}constructor(){super(),Ye.add(this),Es.set(this,void 0),Cs.set(this,void 0),Is.set(this,void 0),this.containerClassName="dce-video-container",lt.set(this,void 0),this.videoFit="contain",this._hideDefaultSelection=!1,this._divScanArea=null,this._divScanLight=null,this._bgLoading=null,this._selCam=null,this._bgCamera=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,Xo.set(this,null),this.regionMaskFillStyle="rgba(0,0,0,0.5)",this.regionMaskStrokeStyle="rgb(254,142,20)",this.regionMaskLineWidth=6,qo.set(this,!1),Zo.set(this,!1),ni.set(this,{width:0,height:0}),this._updateLayersTimeout=500,this._videoResizeListener=()=>{b(this,Ye,"m",Ts).call(this),this._updateLayersTimeoutId&&clearTimeout(this._updateLayersTimeoutId),this._updateLayersTimeoutId=setTimeout(()=>{this.disposed||(this.eventHandler.fire("videoEl:resized",null,{async:!1}),this.eventHandler.fire("content:updated",null,{async:!1}),this.isScanLaserVisible()&&b(this,Ye,"m",pu).call(this))},this._updateLayersTimeout)},this._windowResizeListener=()=>{t._onLog&&t._onLog("window resize event triggered."),b(this,ni,"f").width===document.documentElement.clientWidth&&b(this,ni,"f").height===document.documentElement.clientHeight||(b(this,ni,"f").width=document.documentElement.clientWidth,b(this,ni,"f").height=document.documentElement.clientHeight,this._videoResizeListener())},Ds.set(this,"disabled"),this._clickIptSingleFrameMode=()=>{if(!b(this,Ye,"m",xt).call(this))return;let e;if(this._singleFrameInputContainer)e=this._singleFrameInputContainer.firstElementChild;else{e=document.createElement("input"),e.setAttribute("type","file"),this._singleFrameMode==="camera"?(e.setAttribute("capture",""),e.setAttribute("accept","image/*")):this._singleFrameMode==="image"&&(e.removeAttribute("capture"),e.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp")),e.addEventListener("change",()=>z(this,null,function*(){let i=e.files[0];e.value="";{let o=M=>z(this,null,function*(){let R=null,O=null;if(typeof createImageBitmap<"u")try{if(R=yield createImageBitmap(M),R)return R}catch{}var B;return R||(O=yield(B=M,new Promise((V,H)=>{let Y=URL.createObjectURL(B),Z=new Image;Z.src=Y,Z.onload=()=>{URL.revokeObjectURL(Z.src),V(Z)},Z.onerror=he=>{H(new Error("Can't convert blob to image : "+(he instanceof Event?he.type:he)))}}))),O}),h=(M,R,O,B)=>{M.width==O&&M.height==B||(M.width=O,M.height=B);let V=M.getContext("2d");V.clearRect(0,0,M.width,M.height),V.drawImage(R,0,0)},p=yield o(i),v=p instanceof HTMLImageElement?p.naturalWidth:p.width,w=p instanceof HTMLImageElement?p.naturalHeight:p.height,I=this._cvsSingleFrameMode,S=I?.width,x=I?.height;I||(I=document.createElement("canvas"),this._cvsSingleFrameMode=I),h(I,p,v,w),this._innerComponent.setElement("content",I),S===I.width&&x===I.height||this.eventHandler.fire("content:updated",null,{async:!1})}this._onSingleFrameAcquired&&setTimeout(()=>{this._onSingleFrameAcquired(this._cvsSingleFrameMode)},0)})),e.style.position="absolute",e.style.top="-9999px",e.style.backgroundColor="transparent",e.style.color="transparent";let n=document.createElement("div");n.append(e),this._innerComponent.setElement("single-frame-input-container",n),this._singleFrameInputContainer=n}e?.click()},bs.set(this,[]),this._capturedResultReceiver={onCapturedResultReceived:(e,n)=>{var i,o,h,p;if(this.disposed||(this.clearAllInnerDrawingItems(),!e))return;let v=e.originalImageTag;if(!v)return;let w=e.items;if(!w?.length)return;let I=((i=v.cropRegion)===null||i===void 0?void 0:i.left)||0,S=((o=v.cropRegion)===null||o===void 0?void 0:o.top)||0,x=!((h=v.cropRegion)===null||h===void 0)&&h.right?v.cropRegion.right-I:v.originalWidth,M=!((p=v.cropRegion)===null||p===void 0)&&p.bottom?v.cropRegion.bottom-S:v.originalHeight,R=v.currentWidth,O=v.currentHeight,B=(Y,Z,he,ce,ye,be,_,ue,Ee=[],de)=>{Z.forEach(a=>t._transformCoordinates(a,he,ce,ye,be,_,ue));let c=new mu({points:[{x:Z[0].x,y:Z[0].y},{x:Z[1].x,y:Z[1].y},{x:Z[2].x,y:Z[2].y},{x:Z[3].x,y:Z[3].y}]},de);for(let a of Ee)c.addNote(a);Y.addDrawingItems([c]),b(this,bs,"f").push(c)},V,H;for(let Y of w)switch(Y.type){case De.CRIT_ORIGINAL_IMAGE:break;case De.CRIT_BARCODE:V=this.getDrawingLayer(nt.DBR_LAYER_ID),H=[{name:"format",content:Y.formatString},{name:"text",content:Y.text}],n?.isBarcodeVerifyOpen?Y.verified?B(V,Y.location.points,I,S,x,M,R,O,H):B(V,Y.location.points,I,S,x,M,R,O,H,le.STYLE_ORANGE_STROKE_TRANSPARENT):B(V,Y.location.points,I,S,x,M,R,O,H);break;case De.CRIT_TEXT_LINE:V=this.getDrawingLayer(nt.DLR_LAYER_ID),H=[{name:"text",content:Y.text}],n.isLabelVerifyOpen?Y.verified?B(V,Y.location.points,I,S,x,M,R,O,H):B(V,Y.location.points,I,S,x,M,R,O,H,le.STYLE_GREEN_STROKE_TRANSPARENT):B(V,Y.location.points,I,S,x,M,R,O,H);break;case De.CRIT_DETECTED_QUAD:V=this.getDrawingLayer(nt.DDN_LAYER_ID),n?.isDetectVerifyOpen?Y.verified?B(V,Y.location.points,I,S,x,M,R,O,[]):B(V,Y.location.points,I,S,x,M,R,O,[],le.STYLE_BLUE_STROKE_TRANSPARENT):B(V,Y.location.points,I,S,x,M,R,O,[]);break;case De.CRIT_NORMALIZED_IMAGE:V=this.getDrawingLayer(nt.DDN_LAYER_ID),n?.isNormalizeVerifyOpen?Y.verified?B(V,Y.location.points,I,S,x,M,R,O,[]):B(V,Y.location.points,I,S,x,M,R,O,[],le.STYLE_BLUE_STROKE_TRANSPARENT):B(V,Y.location.points,I,S,x,M,R,O,[]);break;case De.CRIT_PARSED_RESULT:break;default:throw new Error("Illegal item type.")}}},fu.set(this,!1),this.eventHandler=new va,this.eventHandler.on("content:updated",()=>{b(this,Es,"f")&&clearTimeout(b(this,Es,"f")),Ce(this,Es,setTimeout(()=>{if(this.disposed)return;let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(n){if((n.message||n)==="Invalid content dimensions.")return;throw n}this.updateDrawingLayers(e),this.updateConvertedRegion(e)},0),"f")}),this.eventHandler.on("videoEl:resized",()=>{b(this,Cs,"f")&&clearTimeout(b(this,Cs,"f")),Ce(this,Cs,setTimeout(()=>{this.disposed||this._updateVideoContainer()},0),"f")})}_setUIElement(e){e instanceof HTMLTemplateElement?(window._dce_default_template=e,this.UIElement=new si):this.UIElement=e,this._unbindUI(),this._bindUI()}setUIElement(e){return z(this,null,function*(){let n;if(n=typeof e=="string"?yield Qg(e):e,n instanceof HTMLDivElement&&n.childElementCount==0){let i=yield Qg(t.defaultUIElementURL);i instanceof HTMLTemplateElement?(window._dce_default_template=i,n.append(new si)):n.append(i),this._setUIElement(n)}else this._setUIElement(n)})}getUIElement(){return this.UIElement}_bindUI(){var e;if(!this.UIElement)throw new Error("Need to set 'UIElement'.");if(this._innerComponent)return;let n,i=this.UIElement;if(i instanceof si?n=i.getElement(`.${this.containerClassName}`):i instanceof HTMLDivElement&&i.childElementCount===1&&i.firstElementChild instanceof si?(n=i.firstElementChild.getElement(`.${this.containerClassName}`),i=i.firstElementChild):n=i.classList.contains(this.containerClassName)?i:i.querySelector(`.${this.containerClassName}`),!n)throw Error(`Can not find the element with class '${this.containerClassName}'.`);if(this._innerComponent=new ya,n.appendChild(this._innerComponent),!b(this,Ye,"m",xt).call(this)){let o=document.createElement("video");o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.width="100%",o.style.height="100%",o.style.objectFit=this.getVideoFit(),o.setAttribute("autoplay","true"),o.setAttribute("playsinline","true"),o.setAttribute("muted","true"),["iPhone","iPad","Mac"].includes(ft.OS)&&o.setAttribute("poster","data:image/gif;base64,R0lGODlhAQABAIEAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAABAAEAAAgEAAEEBAA7"),Ce(this,lt,o,"f");let h=document.createElement("div");h.append(o),h.style.overflow="hidden",this._videoContainer=h,this._innerComponent.setElement("content",h)}if(i instanceof si?(this._selRsl=i.getElement(".dce-sel-resolution"),this._selMinLtr=i.getElement(".dlr-sel-minletter"),this._divScanArea=i.getElement(".dce-scanarea"),this._divScanLight=i.getElement(".dce-scanlight"),this._bgLoading=i.getElement(".dce-bg-loading"),this._bgCamera=i.getElement(".dce-bg-camera"),this._selCam=i.getElement(".dce-sel-camera"),this._optGotRsl=i.getElement(".dce-opt-gotResolution"),this._btnClose=i.getElement(".dce-btn-close"),this._optGotMinLtr=i.getElement(".dlr-opt-gotMinLtr")):(this._selRsl=i.querySelector(".dce-sel-resolution"),this._selMinLtr=i.querySelector(".dlr-sel-minletter"),this._divScanArea=i.querySelector(".dce-scanarea"),this._divScanLight=i.querySelector(".dce-scanlight"),this._bgLoading=i.querySelector(".dce-bg-loading"),this._bgCamera=i.querySelector(".dce-bg-camera"),this._selCam=i.querySelector(".dce-sel-camera"),this._optGotRsl=i.querySelector(".dce-opt-gotResolution"),this._btnClose=i.querySelector(".dce-btn-close"),this._optGotMinLtr=i.querySelector(".dlr-opt-gotMinLtr")),this._selRsl&&(this._hideDefaultSelection||b(this,Ye,"m",xt).call(this)||this._selRsl.options.length||(this._selRsl.innerHTML=['<option class="dce-opt-gotResolution" value="got"></option>','<option data-width="1920" data-height="1080">ask 1920x1080</option>','<option data-width="1280" data-height="720">ask 1280x720</option>','<option data-width="640" data-height="480">ask 640x480</option>'].join(""),this._optGotRsl=this._selRsl.options[0])),this._selMinLtr&&(this._hideDefaultSelection||b(this,Ye,"m",xt).call(this)||this._selMinLtr.options.length||(this._selMinLtr.innerHTML=['<option class="dlr-opt-gotMinLtr" value="got"></option>','<option value="0" selected>any letter</option>','<option value="3">3+ letters</option>','<option value="5">5+ letters</option>','<option value="8">8+ letters</option>','<option value="12">12+ letters</option>','<option value="17">17+ letters</option>','<option value="30">30+ letters</option>','<option value="50">50+ letters</option>','<option value="80">80+ letters</option>','<option value="120">120+ letters</option>'].join(""),this._optGotMinLtr=this._selMinLtr.options[0])),this.isScanLaserVisible()||b(this,Ye,"m",Ts).call(this),b(this,Ye,"m",xt).call(this)&&(this._innerComponent&&(this._innerComponent.addEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.setAttribute("title","Take a photo")),this._bgCamera&&(this._bgCamera.style.display="block")),b(this,Ye,"m",xt).call(this)||this._hideDefaultSelection?(this._selCam&&(this._selCam.style.display="none"),this._selRsl&&(this._selRsl.style.display="none"),this._selMinLtr&&(this._selMinLtr.style.display="none")):(this._selCam&&(this._selCam.style.display="block"),this._selRsl&&(this._selRsl.style.display="block"),this._selMinLtr&&(this._selMinLtr.style.display="block"),this._stopLoading()),window.ResizeObserver){this._resizeObserver||(this._resizeObserver=new ResizeObserver(h=>{var p;t._onLog&&t._onLog("resize observer triggered.");for(let v of h)v.target===((p=this._innerComponent)===null||p===void 0?void 0:p.getWrapper())&&this._videoResizeListener()}));let o=(e=this._innerComponent)===null||e===void 0?void 0:e.getWrapper();o&&this._resizeObserver.observe(o)}b(this,ni,"f").width=document.documentElement.clientWidth,b(this,ni,"f").height=document.documentElement.clientHeight,window.addEventListener("resize",this._windowResizeListener)}_unbindUI(){var e,n,i,o;b(this,Ye,"m",xt).call(this)?(this._innerComponent&&(this._innerComponent.removeEventListener("click",this._clickIptSingleFrameMode),this._innerComponent.removeAttribute("title")),this._bgCamera&&(this._bgCamera.style.display="none")):this._stopLoading(),b(this,Ye,"m",Ts).call(this),(e=this._drawingLayerManager)===null||e===void 0||e.clearDrawingLayers(),(n=this._innerComponent)===null||n===void 0||n.removeElement("drawing-layer"),this._layerBaseCvs=null,this._drawingLayerOfMask=null,this._drawingLayerOfTip=null,(i=this._innerComponent)===null||i===void 0||i.remove(),this._innerComponent=null,Ce(this,lt,null,"f"),(o=this._videoContainer)===null||o===void 0||o.remove(),this._videoContainer=null,this._selCam=null,this._selRsl=null,this._optGotRsl=null,this._btnClose=null,this._selMinLtr=null,this._optGotMinLtr=null,this._divScanArea=null,this._divScanLight=null,this._singleFrameInputContainer&&(this._singleFrameInputContainer.remove(),this._singleFrameInputContainer=null),window.ResizeObserver&&this._resizeObserver&&this._resizeObserver.disconnect(),window.removeEventListener("resize",this._windowResizeListener)}_startLoading(){this._bgLoading&&(this._bgLoading.style.display="",this._bgLoading.style.animationPlayState="")}_stopLoading(){this._bgLoading&&(this._bgLoading.style.display="none",this._bgLoading.style.animationPlayState="paused")}_renderCamerasInfo(e,n){if(!this._selCam)return;let i;this._selCam.textContent="";for(let o of n){let h=document.createElement("option");h.value=o.deviceId,h.innerText=o.label,this._selCam.append(h),o.deviceId&&e&&e.deviceId==o.deviceId&&(i=h)}this._selCam.value=i?i.value:""}_renderResolutionInfo(e){this._optGotRsl&&(this._optGotRsl.setAttribute("data-width",e.width),this._optGotRsl.setAttribute("data-height",e.height),this._optGotRsl.innerText="got "+e.width+"x"+e.height,this._selRsl&&this._optGotRsl.parentNode==this._selRsl&&(this._selRsl.value="got"))}getVideoElement(){return b(this,lt,"f")}isVideoLoaded(){return!!b(this,lt,"f")&&b(this,lt,"f").readyState==4}setVideoFit(e){if(e=e.toLowerCase(),!["contain","cover"].includes(e))throw new Error(`Unsupported value '${e}'.`);if(this.videoFit=e,!b(this,lt,"f")||(b(this,lt,"f").style.objectFit=e,b(this,Ye,"m",xt).call(this)))return;let n;this._updateVideoContainer();try{n=this.getContentDimensions()}catch(i){if((i.message||i)==="Invalid content dimensions.")return;throw i}b(this,Ye,"m",Ko).call(this,n,this.getConvertedRegion()),this.updateDrawingLayers(n)}getVideoFit(){return this.videoFit}getContentDimensions(){var e,n,i,o;let h,p,v;if(b(this,Ye,"m",xt).call(this)?(h=(i=this._cvsSingleFrameMode)===null||i===void 0?void 0:i.width,p=(o=this._cvsSingleFrameMode)===null||o===void 0?void 0:o.height,v="contain"):(h=(e=b(this,lt,"f"))===null||e===void 0?void 0:e.videoWidth,p=(n=b(this,lt,"f"))===null||n===void 0?void 0:n.videoHeight,v=this.getVideoFit()),!h||!p)throw new Error("Invalid content dimensions.");return{width:h,height:p,objectFit:v}}updateConvertedRegion(e){let n=Ir.convert(this.scanRegion,e.width,e.height);Ce(this,Xo,n,"f"),b(this,Is,"f")&&clearTimeout(b(this,Is,"f")),Ce(this,Is,setTimeout(()=>{let i;try{i=this.getContentDimensions()}catch(o){if((o.message||o)==="Invalid content dimensions.")return;throw o}b(this,Ye,"m",Qo).call(this,i,n),b(this,Ye,"m",Ko).call(this,i,n)},0),"f")}getConvertedRegion(){return b(this,Xo,"f")}setScanRegion(e){if(e!=null&&!Lu(e)&&!Ri(e))throw TypeError("Invalid 'region'.");let n;this.scanRegion=e?JSON.parse(JSON.stringify(e)):null;try{n=this.getContentDimensions()}catch(i){if((i.message||i)==="Invalid content dimensions.")return;throw i}this.updateConvertedRegion(n)}getScanRegion(){return JSON.parse(JSON.stringify(this.scanRegion))}getVisibleRegionOfVideo(e){if(!this.isVideoLoaded())throw new Error("The video is not loaded.");let n=b(this,lt,"f").videoWidth,i=b(this,lt,"f").videoHeight,o=this.getVideoFit(),{width:h,height:p}=this._innerComponent.getBoundingClientRect();if(h<=0||p<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let v,w={x:0,y:0,width:n,height:i,isMeasuredInPercentage:!1};if(o==="cover"&&(h/p<n/i?(v=p/i,w.x=Math.floor((n-h/v)/2),w.y=0,w.width=Math.ceil(h/v),w.height=i):(v=h/n,w.x=0,w.y=Math.floor((i-p/v)/2),w.width=n,w.height=Math.ceil(p/v))),e?.inPixels)return w;let I=w;return I.x=Math.ceil(I.x/i*100),I.y=Math.ceil(I.y/n*100),I.width=Math.floor(I.width/n*100),I.height=Math.floor(I.height/i*100),I.isMeasuredInPercentage=!0,w}setScanRegionMask(e,n,i,o){this._drawingLayerOfMask||(this._drawingLayerOfMask=this._createDrawingLayer(-2),this.isScanRegionMaskVisible()||b(this,Ye,"m",gu).call(this)),this.clearScanRegionMask(),this._maskBackRectStyleId||(this._maskBackRectStyleId=le.createDrawingStyle({paintMode:"fill",fillStyle:this.regionMaskFillStyle,lineWidth:0})),this._maskCenterRectStyleId||(this._maskCenterRectStyleId=le.createDrawingStyle({paintMode:"stroke",strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}));let h=this._drawingLayerOfMask.width,p=this._drawingLayerOfMask.height,v=new ri({x:0,y:0,width:h,height:p},this._maskBackRectStyleId),w=new ri({x:-h/2,y:-p/2+n,width:e,height:o}),I=new ri({x:-h/2+e+i,y:-p/2+n,width:h-e-i<0?0:h-e-i,height:o}),S=new ri({x:-h/2,y:-p/2,width:h,height:n}),x=new ri({x:-h/2,y:-p/2+n+o,width:h,height:p-n-o<0?0:p-n-o});w.set("strokeWidth",0),I.set("strokeWidth",0),S.set("strokeWidth",0),x.set("strokeWidth",0);let M=new vu([w,I,S,x])._getFabricObject();v.set("clipPath",M);let R=new ri({x:e,y:n,width:i,height:o},this._maskCenterRectStyleId);this._drawingLayerOfMask.addDrawingItems([v,R])}clearScanRegionMask(){this._drawingLayerOfMask&&this._drawingLayerOfMask.clearDrawingItems()}deleteScanRegionMask(){this._drawingLayerOfMask&&this.deleteDrawingLayer(this._drawingLayerOfMask.getId())}_setScanRegionMaskVisible(e){Ce(this,qo,e,"f"),e?b(this,Ye,"m",mp).call(this):b(this,Ye,"m",gu).call(this)}setScanRegionMaskVisible(e){this._setScanRegionMaskVisible(e),this._userSetMaskVisible=e}isScanRegionMaskVisible(){return b(this,qo,"f")}setScanRegionMaskStyle(e){if(!e)return;let n;e.fillStyle&&(this.regionMaskFillStyle=e.fillStyle),e.strokeStyle&&(this.regionMaskStrokeStyle=e.strokeStyle),e.lineWidth&&(this.regionMaskLineWidth=e.lineWidth),this._maskBackRectStyleId&&le.updateDrawingStyle(this._maskBackRectStyleId,{fillStyle:this.regionMaskFillStyle}),this._maskCenterRectStyleId&&le.updateDrawingStyle(this._maskCenterRectStyleId,{strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth});try{n=this.getContentDimensions()}catch(i){if((i.message||i)==="Invalid content dimensions.")return;throw i}b(this,Ye,"m",Qo).call(this,n,this.getConvertedRegion())}getScanRegionMaskStyle(){return{fillStyle:this.regionMaskFillStyle,strokeStyle:this.regionMaskStrokeStyle,lineWidth:this.regionMaskLineWidth}}_setScanLaserVisible(e){Ce(this,Zo,e,"f"),e?b(this,Ye,"m",pu).call(this):b(this,Ye,"m",Ts).call(this)}setScanLaserVisible(e){this._setScanLaserVisible(e),this._userSetLaserVisible=e}isScanLaserVisible(){return b(this,Zo,"f")}_updateVideoContainer(){if(!b(this,lt,"f")||b(this,Ye,"m",xt).call(this))return;let e=1,n=b(this,lt,"f").style.transform.match(/scale\((.+)\)/);n&&(e=parseFloat(n[1]));let i=this._videoContainer;if(this.videoFit==="contain"&&e>1){let o=b(this,lt,"f").videoWidth,h=b(this,lt,"f").videoHeight,{width:p,height:v}=this._innerComponent.getBoundingClientRect(),w=o/h;if(p/v<w){let I=p/w;i.style.left="0",i.style.top=(v-I)/2/v*100+"%",i.style.width="100%",i.style.height=I/v*100+"%"}else{let I=v*w;i.style.left=(p-I)/2/p*100+"%",i.style.top="0",i.style.width=I/p*100+"%",i.style.height="100%"}}else i.style.left="0",i.style.top="0",i.style.width="100%",i.style.height="100%"}updateLayers(){let e;this._updateVideoContainer();try{e=this.getContentDimensions()}catch(i){if((i.message||i)==="Invalid content dimensions.")return;throw i}let n=this.getConvertedRegion();b(this,Ye,"m",Ko).call(this,e,n),this.updateDrawingLayers(e),b(this,Ye,"m",Qo).call(this,e,n)}clearAllInnerDrawingItems(){b(this,bs,"f").forEach(e=>e.remove()),b(this,bs,"f").length=0}dispose(){this._unbindUI(),delete window._dce_default_template,this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"disposed",{value:!0})}};function F(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function Pe(t,e,n,i,o){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?o.call(t,n):o?o.value=n:e.set(t,n),n}Es=new WeakMap,Cs=new WeakMap,Is=new WeakMap,lt=new WeakMap,Xo=new WeakMap,qo=new WeakMap,Zo=new WeakMap,ni=new WeakMap,Ds=new WeakMap,bs=new WeakMap,fu=new WeakMap,Ye=new WeakSet,xt=function(){return this._singleFrameMode!=="disabled"},Qo=function(t,e){e&&(e.x!==0||e.y!==0||e.width!==t.width||e.height!==t.height)?this.setScanRegionMask(e.x,e.y,e.width,e.height):this.clearScanRegionMask()},mp=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!0)},gu=function(){this._drawingLayerOfMask&&this._drawingLayerOfMask.setVisible(!1)},pu=function(){this._divScanLight&&this._divScanLight.style.display=="none"&&(this._divScanLight.style.display="block")},Ts=function(){this._divScanLight&&(this._divScanLight.style.display="none")},Ko=function(t,e){if(!this._divScanArea||!this._innerComponent.getElement("content"))return;let{width:n,height:i,objectFit:o}=t;e||(e={x:0,y:0,width:n,height:i});let{width:h,height:p}=this._innerComponent.getBoundingClientRect();if(h<=0||p<=0)return;let v=h/p,w=n/i,I,S,x,M,R=1;if(o==="contain")v<w?(R=h/n,I=0,S=(p-i*R)/2):(R=p/i,I=(h-n*R)/2,S=0),I+=e.x*R,S+=e.y*R,x=e.width*R,M=e.height*R;else if(o==="cover")if(v<w){R=p/i,I=e.x*R-(n*R-h)/2,I=Math.max(I,0),I=Math.min(I,h),S=e.y*R;let O=(e.x+e.width)*R-(n*R-h)/2;O=Math.max(O,0),O=Math.min(O,h),x=O-I,M=e.height*R}else{R=h/n,I=e.x*R,S=e.y*R-(i*R-p)/2,S=Math.max(S,0),S=Math.min(S,p);let O=(e.y+e.height)*R-(i*R-p)/2;O=Math.max(O,0),O=Math.min(O,p),x=e.width*R,M=O-S}else I=0,S=0,x=0,M=0;this._divScanArea.style.left=I+"px",this._divScanArea.style.top=S+"px",this._divScanArea.style.width=x+"px",this._divScanArea.style.height=M+"px"},pn.uiComponentName="default-camera-view",pn._defaultUIElementURL="@engineResourcePath/dce.ui.html",typeof SuppressedError=="function"&&SuppressedError;var np=typeof self>"u",gs,ps,Wo,iu,mt;function yt(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function Jt(t,e,n,i,o){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?o.call(t,n):o?o.value=n:e.set(t,n),n}typeof navigator<"u"&&(gs=navigator,ps=gs.userAgent,Wo=gs.platform,iu=gs.mediaDevices),function(){if(!np){let t={Edge:{search:"Edg",verSearch:"Edg"},OPR:null,Chrome:null,Safari:{str:gs.vendor,search:"Apple",verSearch:["Version","iPhone OS","CPU OS"]},Firefox:null,Explorer:{search:"MSIE",verSearch:"MSIE"}},e={HarmonyOS:null,Android:null,iPhone:null,iPad:null,Windows:{str:Wo,search:"Win"},Mac:{str:Wo},Linux:{str:Wo}},n="unknownBrowser",i=0,o="unknownOS";for(let h in t){let p=t[h]||{},v=p.str||ps,w=p.search||h,I=p.verStr||ps,S=p.verSearch||h;if(S instanceof Array||(S=[S]),v.indexOf(w)!=-1){n=h;for(let x of S){let M=I.indexOf(x);if(M!=-1){i=parseFloat(I.substring(M+x.length+1));break}}break}}for(let h in e){let p=e[h]||{},v=p.str||ps,w=p.search||h;if(v.indexOf(w)!=-1){o=h;break}}o=="Linux"&&ps.indexOf("Windows NT")!=-1&&(o="HarmonyOS"),mt={browser:n,version:i,OS:o}}np&&(mt={browser:"ssr",version:0,OS:"ssr"})}(),iu&&iu.getUserMedia,mt.browser==="Chrome"&&mt.version>66||mt.browser==="Safari"&&mt.version>13||mt.browser==="OPR"&&mt.version>43||mt.browser==="Edge"&&mt.version,typeof SuppressedError=="function"&&SuppressedError;var Sn=class Jo{static multiply(e,n){let i=[];for(let o=0;o<3;o++){let h=n.slice(3*o,3*o+3);for(let p=0;p<3;p++){let v=[e[p],e[p+3],e[p+6]].reduce((w,I,S)=>w+I*h[S],0);i.push(v)}}return i}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,n,i){return Jo.multiply(e,[1,0,0,0,1,0,n,i,1])}static rotate(e,n){var i=Math.cos(n),o=Math.sin(n);return Jo.multiply(e,[i,-o,0,o,i,0,0,0,1])}static scale(e,n,i){return Jo.multiply(e,[n,0,0,0,i,0,0,0,1])}},Ne,xn,An,ea,ur,Ss,xs,hr,ta;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(Ne||(Ne={}));var _a=class t{static get version(){return"1.1.0"}static checkWebGLSupport(){return document.createElement("canvas").getContext("webgl")===null?(Jt(t,xn,!1,"f",An),!1):(Jt(t,xn,!0,"f",An),!0)}get disposed(){return yt(this,ta,"f")}constructor(){ea.set(this,Ne.RGBA),ur.set(this,null),Ss.set(this,null),xs.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,hr.set(this,null),ta.set(this,!1)}drawImage(e,n,i,o,h,p){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!o)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(yt(t,xn,"f",An)==null&&t.checkWebGLSupport(),p?.bUseWebGL&&!yt(t,xn,"f",An))throw new Error("Your browser or machine may not support WebGL.");if(n instanceof HTMLVideoElement&&n.readyState!==4||n instanceof HTMLImageElement&&!n.complete)throw new Error("The source is not loaded.");let v;t._onLog&&(v=Date.now(),t._onLog("drawImage(), START: "+v));let w=0,I=0,S=i,x=o,M=0,R=0,O=i,B=o;h&&(h.sx&&(w=Math.round(h.sx)),h.sy&&(I=Math.round(h.sy)),h.sWidth&&(S=Math.round(h.sWidth)),h.sHeight&&(x=Math.round(h.sHeight)),h.dx&&(M=Math.round(h.dx)),h.dy&&(R=Math.round(h.dy)),h.dWidth&&(O=Math.round(h.dWidth)),h.dHeight&&(B=Math.round(h.dHeight)));let V,H=Ne.RGBA;if(p?.pixelFormat&&(H=p.pixelFormat),p?.bufferContainer&&(V=p.bufferContainer,V.length<4*O*B))throw new Error("Unexpected size of the 'bufferContainer'.");let Y=e;if(!yt(t,xn,"f",An)||!(this.useWebGLByDefault&&p?.bUseWebGL==null||p?.bUseWebGL)){t._onLog&&t._onLog("drawImage() in context2d."),Y.ctx2d||(Y.ctx2d=Y.getContext("2d",{willReadFrequently:!0}));let Z=Y.ctx2d;if(!Z)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(Y.width<M+O||Y.height<R+B)&&(Y.width=M+O,Y.height=R+B),Z.drawImage(n,w,I,S,x,M,R,O,B),t._onLog&&t._onLog("drawImage() in context2d end. Costs: "+(Date.now()-v)),{context:Z,pixelFormat:Ne.RGBA,bUseWebGL:!1}}t._onLog&&t._onLog("drawImage() in WebGL.");try{(Y.width<M+O||Y.height<R+B)&&(Y.width=M+O,Y.height=R+B,Y.ctxWebGL&&Y.ctxWebGL.viewport(0,0,M+O,R+B));let Z=Y.ctxWebGL||Y.getContext("webgl",{antialias:!1})||Y.getContext("experimental-webgl",{antialias:!1});if(!Z){t._onLog&&t._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");let _=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw _.name="WebGLError",_}if(!Y.ctxWebGL||H!==yt(this,ea,"f")){Y.ctxWebGL=Z;let _=r=>{let s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),r.STATIC_DRAW);let u=r.createBuffer();return r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),r.STATIC_DRAW),{positions:s,texCoords:u}},ue=r=>{let s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),s},Ee=(r,s)=>{let u=r.createProgram();if(s.forEach(m=>r.attachShader(u,m)),r.linkProgram(u),!r.getProgramParameter(u,r.LINK_STATUS)){let m=new Error(`An error occured linking the program: ${r.getProgramInfoLog(u)}.`);throw m.name="WebGLError",m}return r.useProgram(u),u},de=(r,s,u)=>{let m=r.createShader(s);if(r.shaderSource(m,u),r.compileShader(m),!r.getShaderParameter(m,r.COMPILE_STATUS)){let f=new Error(`An error occured compiling the shader: ${r.getShaderInfoLog(m)}.`);throw f.name="WebGLError",f}return m},c=`
                  attribute vec2 a_position;
                  attribute vec2 a_texCoord;
  
                  uniform mat3 u_matrix;
                  uniform mat3 u_textureMatrix;
  
                  varying vec2 v_texCoord;
                  void main(void) {
                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                  }
              `,a="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(H)&&(a=H.slice(0,3));let l=`
                  precision mediump float;
                  varying vec2 v_texCoord;
                  uniform sampler2D u_image;
                  uniform float uColorFactor;
  
                  void main() {
                      vec4 sample = texture2D(u_image, v_texCoord);
                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                      gl_FragColor = vec4(sample.${a} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                  }
              `,d=Ee(Z,[de(Z,Z.VERTEX_SHADER,c),de(Z,Z.FRAGMENT_SHADER,l)]);Jt(this,Ss,{program:d,attribLocations:{vertexPosition:Z.getAttribLocation(d,"a_position"),texPosition:Z.getAttribLocation(d,"a_texCoord")},uniformLocations:{uSampler:Z.getUniformLocation(d,"u_image"),uColorFactor:Z.getUniformLocation(d,"uColorFactor"),uMatrix:Z.getUniformLocation(d,"u_matrix"),uTextureMatrix:Z.getUniformLocation(d,"u_textureMatrix")}},"f"),Jt(this,xs,_(Z),"f"),Jt(this,ur,ue(Z),"f"),Jt(this,ea,H,"f")}let he=(_,ue,Ee)=>{_.bindBuffer(_.ARRAY_BUFFER,ue),_.enableVertexAttribArray(Ee),_.vertexAttribPointer(Ee,2,_.FLOAT,!1,0,0)},ce=(_,ue,Ee)=>{let de=_.RGBA,c=_.RGBA,a=_.UNSIGNED_BYTE;_.bindTexture(_.TEXTURE_2D,ue),_.texImage2D(_.TEXTURE_2D,0,de,c,a,Ee)},ye=(_,ue,Ee,de)=>{_.clearColor(0,0,0,1),_.clearDepth(1),_.enable(_.DEPTH_TEST),_.depthFunc(_.LEQUAL),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT),he(_,Ee.positions,ue.attribLocations.vertexPosition),he(_,Ee.texCoords,ue.attribLocations.texPosition),_.activeTexture(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,de),_.uniform1i(ue.uniformLocations.uSampler,0),_.uniform1f(ue.uniformLocations.uColorFactor,[Ne.GREY,Ne.GREY32].includes(H)?1:0);let c,a,l=Sn.translate(Sn.identity(),-1,-1);l=Sn.scale(l,2,2),l=Sn.scale(l,1/_.canvas.width,1/_.canvas.height),c=Sn.translate(l,M,R),c=Sn.scale(c,O,B),_.uniformMatrix3fv(ue.uniformLocations.uMatrix,!1,c),a=Sn.translate(Sn.identity(),w/i,I/o),a=Sn.scale(a,S/i,x/o),_.uniformMatrix3fv(ue.uniformLocations.uTextureMatrix,!1,a),_.drawArrays(_.TRIANGLES,0,6)};ce(Z,yt(this,ur,"f"),n),ye(Z,yt(this,Ss,"f"),yt(this,xs,"f"),yt(this,ur,"f"));let be=V||new Uint8Array(4*O*B);if(Z.readPixels(M,R,O,B,Z.RGBA,Z.UNSIGNED_BYTE,be),be[3]!==255){t._onLog&&t._onLog("Incorrect WebGL drawing .");let _=new Error("WebGL error: incorrect drawing.");throw _.name="WebGLError",_}return t._onLog&&t._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-v)),{context:Z,pixelFormat:H===Ne.GREY?Ne.GREY32:H,bUseWebGL:!0}}catch(Z){if(this.forceLoseContext(),p?.bUseWebGL==null)return t._onLog&&t._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,n,i,o,h,Object.assign({},p,{bUseWebGL:!1}));throw Z.name="WebGLError",Z}}readCvsData(e,n,i){if(!(e instanceof CanvasRenderingContext2D||e instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let o,h=0,p=0,v=e.canvas.width,w=e.canvas.height;if(n&&(n.x&&(h=n.x),n.y&&(p=n.y),n.width&&(v=n.width),n.height&&(w=n.height)),i?.length<4*v*w)throw new Error("Unexpected size of the 'bufferContainer'.");if(e instanceof WebGLRenderingContext){let I=e;i?(I.readPixels(h,p,v,w,I.RGBA,I.UNSIGNED_BYTE,i),o=new Uint8Array(i.buffer,0,4*v*w)):(o=new Uint8Array(4*v*w),I.readPixels(h,p,v,w,I.RGBA,I.UNSIGNED_BYTE,o))}else if(e instanceof CanvasRenderingContext2D){let I;I=e.getImageData(h,p,v,w),o=new Uint8Array(I.data.buffer),i?.set(o)}return o}transformPixelFormat(e,n,i,o){let h,p;if(t._onLog&&(h=Date.now(),t._onLog("transformPixelFormat(), START: "+h)),n===i)return t._onLog&&t._onLog("transformPixelFormat() end. Costs: "+(Date.now()-h)),o?new Uint8Array(e):e;let v=[Ne.RGBA,Ne.RBGA,Ne.GRBA,Ne.GBRA,Ne.BRGA,Ne.BGRA];if(v.includes(n))if(i===Ne.GREY){p=new Uint8Array(e.length/4);for(let w=0;w<e.length;w+=4){let I=.21*e[w]+.71*e[w+1]+.07*e[w+2];p[w/4]=I}}else if(i===Ne.GREY32){p=o?new Uint8Array(e):e;for(let w=0;w<e.length;w+=4){let I=.21*e[w]+.71*e[w+1]+.07*e[w+2];p[w]=I,p[w+1]=I,p[w+2]=I}}else{if(!v.includes(i))throw new Error("Unable to transform.");if(o){p=new Uint8Array(e);let w=n.indexOf("r"),I=n.indexOf("g"),S=n.indexOf("b"),x=i.indexOf("r"),M=i.indexOf("g"),R=i.indexOf("b");for(let O=0;O<e.length;O+=4)p[O+x]=e[O+w],p[O+M]=e[O+I],p[O+R]=e[O+S]}else{p=e;let w=n.indexOf("r"),I=n.indexOf("g"),S=n.indexOf("b"),x=i.indexOf("r"),M=i.indexOf("g"),R=i.indexOf("b");for(let O=0;O<e.length;O+=4){let B=[e[O],e[O+1],e[O+2]];p[O+x]=B[w],p[O+M]=B[I],p[O+R]=B[S]}}}else if(n===Ne.GREY){if(i!==Ne.GREY32)throw new Error("Unable to transform.");p=new Uint8Array(4*e.length);for(let w=0;w<e.length;w++)p[4*w]=e[w],p[4*w+1]=e[w],p[4*w+2]=e[w],p[4*w+3]=255}else{if(n!==Ne.GREY32)throw new Error("Unable to transform.");if(i!==Ne.GREY)throw new Error("Unable to transform.");p=new Uint8Array(e.length/4);for(let w=0;w<e.length;w+=4)p[w/4]=e[w]}return t._onLog&&t._onLog("transformPixelFormat() end. Costs: "+(Date.now()-h)),p}getImageData(e,n,i,o,h){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!n||!i)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(yt(t,xn,"f",An)==null&&t.checkWebGLSupport(),h?.bUseWebGL&&!yt(t,xn,"f",An))throw new Error("Your browser or machine may not support WebGL.");if(o.sx>n||o.sy>i||o.sx+o.sWidth>n||o.sy+o.sHeight>i)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let p;t._onLog&&(p=Date.now(),t._onLog("getImageData(), START: "+p));let v=Math.round(o.sx),w=Math.round(o.sy),I=Math.round(o.sWidth),S=Math.round(o.sHeight),x=Math.round(o.dWidth),M=Math.round(o.dHeight),R=Ne.RGBA;h?.pixelFormat&&(R=h.pixelFormat);let O,B,V,H=null;if(h?.bufferContainer&&(H=h.bufferContainer),yt(t,xn,"f",An)&&(this.useWebGLByDefault&&h?.bUseWebGL==null||h?.bUseWebGL)){t._onLog&&t._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),O=this._reusedWebGLCvs;try{if(H)if(R===Ne.GREY){if(V=new Uint8Array(4*x*M),B=this.drawImage(O,e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},{pixelFormat:R,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,B.pixelFormat,R),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}}else B=this.drawImage(O,e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},{pixelFormat:R,bUseWebGL:!0,bufferContainer:H}),V=new Uint8Array(H.buffer,0,4*x*M),V=this.transformPixelFormat(V,B.pixelFormat,R);else R===Ne.GREY?((!yt(this,hr,"f")||yt(this,hr,"f").length<4*x*M)&&Jt(this,hr,new Uint8Array(4*x*M),"f"),V=new Uint8Array(yt(this,hr,"f").buffer,0,4*x*M)):V=new Uint8Array(4*x*M),B=this.drawImage(O,e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},{pixelFormat:R,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,B.pixelFormat,R)}catch(Y){if(Y.name==="WebGLError"&&(this.forceLoseContext(),h?.bUseWebGL==null))return t._onLog&&t._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},Object.assign({},h,{bUseWebGL:!1}));throw Y}}else if(t._onLog&&t._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),O=this._reusedCvs,B=this.drawImage(O,e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},{pixelFormat:Ne.RGBA,bUseWebGL:!1}),V=this.readCvsData(B.context,{width:x,height:M},null),V=this.transformPixelFormat(V,B.pixelFormat,R),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}return t._onLog&&t._onLog("getImageData() end. Costs: "+(Date.now()-p)),{data:V,pixelFormat:R,width:x,height:M,bUseWebGL:B.bUseWebGL}}convertDataToCvs(e,n,i,o){if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if(typeof n!="number"||n<=0)throw new Error("Invalid 'width'.");if(typeof i!="number"||i<=0)throw new Error("Invalid 'height'.");let h=document.createElement("canvas"),p;if(h.width=n,h.height=i,o===Ne.GREY){p=new Uint8ClampedArray(4*n*i);for(let w=0;w<p.length;w+=4)p[w]=e[w/4],p[w+1]=e[w/4],p[w+2]=e[w/4],p[w+3]=255}else p=new Uint8ClampedArray(e.buffer);let v=new ImageData(p,n,i);return h.getContext("2d").putImageData(v,0,0),h}forceLoseContext(){if(!this._reusedWebGLCvs)return;let e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),Jt(this,ur,null,"f"),Jt(this,Ss,null,"f"),Jt(this,xs,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),Jt(this,ta,!0,"f")}};xn=_a,ea=new WeakMap,ur=new WeakMap,Ss=new WeakMap,xs=new WeakMap,hr=new WeakMap,ta=new WeakMap,An={value:void 0};var Di,na,ru,me,xe,je,ia,ra,ze,jt,Fn,dr,sa,gn,Bn,Rt,fr,gr,As,oa,pr,bi,Nn,Pn,Eu,ct,Cu,Ti,vp,aa,la,ip,tn,su,ou,_r,Ms,wa,St,sr,Iu,Du,yp,bu=class{constructor(){Di.set(this,new Map),na.set(this,!1)}get disposed(){return F(this,na,"f")}on(e,n){e=e.toLowerCase();let i=F(this,Di,"f").get(e);if(i){if(i.includes(n))return;i.push(n)}else F(this,Di,"f").set(e,[n])}off(e,n){e=e.toLowerCase();let i=F(this,Di,"f").get(e);if(!i)return;let o=i.indexOf(n);o!==-1&&i.splice(o,1)}offAll(e){e=e.toLowerCase();let n=F(this,Di,"f").get(e);n&&(n.length=0)}fire(o){return z(this,arguments,function*(e,n=[],i={async:!1,copy:!0}){n||(n=[]),e=e.toLowerCase();let h=F(this,Di,"f").get(e);if(h&&h.length){i=Object.assign({async:!1,copy:!0},i);for(let p of h){if(!p)continue;let v=[];if(i.copy)for(let I of n){try{I=JSON.parse(JSON.stringify(I))}catch{}v.push(I)}else v=n;let w=!1;if(i.async)setTimeout(()=>{this.disposed||p.apply(i.target,v)},0);else try{w=p.apply(i.target,v)}catch{}if(w===!0)break}}})}dispose(){Pe(this,na,!0,"f")}};Di=new WeakMap,na=new WeakMap;var bt=(t,e,n,i)=>{if(!n)return t;let o=e+Math.round((t-e)/n)*n;return i&&(o=Math.min(o,i)),o},st=class t{static get version(){return"2.0.7"}static isStorageAvailable(e){let n;try{n=window[e];let i="__storage_test__";return n.setItem(i,i),n.removeItem(i),!0}catch(i){return i instanceof DOMException&&(i.code===22||i.code===1014||i.name==="QuotaExceededError"||i.name==="NS_ERROR_DOM_QUOTA_REACHED")&&n&&n.length!==0}}static findBestRearCameraInIOS(e,n){if(!e||!e.length)return null;let i=!1;if(n?.getMainCamera&&(i=!0),i){let o=["\uD6C4\uBA74 \uCE74\uBA54\uB77C","\u80CC\u9762\u30AB\u30E1\u30E9","\u5F8C\u7F6E\u93E1\u982D","\u540E\u7F6E\u76F8\u673A","\u0E01\u0E25\u0E49\u0E2D\u0E07\u0E14\u0E49\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07","\u092C\u0948\u0915 \u0915\u0948\u092E\u0930\u093E","\u0627\u0644\u0643\u0627\u0645\u064A\u0631\u0627 \u0627\u0644\u062E\u0644\u0641\u064A\u0629","\u05DE\u05E6\u05DC\u05DE\u05D4 \u05D0\u05D7\u05D5\u05E8\u05D9\u05EA","\u043A\u0430\u043C\u0435\u0440\u0430 \u043D\u0430 \u0437\u0430\u0434\u043D\u0435\u0439 \u043F\u0430\u043D\u0435\u043B\u0438","\u0437\u0430\u0434\u043D\u044F \u043A\u0430\u043C\u0435\u0440\u0430","\u0437\u0430\u0434\u043D\u0430 \u043A\u0430\u043C\u0435\u0440\u0430","\u0430\u0440\u0442\u049B\u044B \u043A\u0430\u043C\u0435\u0440\u0430","\u03C0\u03AF\u03C3\u03C9 \u03BA\u03AC\u03BC\u03B5\u03C1\u03B1","zadn\xED fotoapar\xE1t","zadn\xE1 kamera","tylny aparat","takakamera","stra\u017Enja kamera","r\xFCckkamera","kamera p\xE5 baksidan","kamera belakang","kamera bak","h\xE1ts\xF3 kamera","fotocamera (posteriore)","c\xE2mera traseira","c\xE2mara traseira","c\xE1mara trasera","c\xE0mera posterior","cam\xE9ra arri\xE8re","camer\u0103 spate","camera m\u1EB7t sau","camera aan achterzijde","bagsidekamera","back camera","arka kamera"],h=e.find(p=>o.includes(p.label.toLowerCase()));return h?.deviceId}{let o=["\uD6C4\uBA74","\u80CC\u9762","\u5F8C\u7F6E","\u540E\u7F6E","\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07","\u092C\u0948\u0915","\u062E\u0644\u0641\u064A\u0629","\u05D0\u05D7\u05D5\u05E8\u05D9\u05EA","\u0437\u0430\u0434\u043D\u044F\u044F","\u0437\u0430\u0434\u043D\u0435\u0439","\u0437\u0430\u0434\u043D\u0430","\u03C0\u03AF\u03C3\u03C9","zadn\xED","zadn\xE1","tylny","trasera","traseira","taka","stra\u017Enja","spate","sau","r\xFCck","posteriore","posterior","h\xE1ts\xF3","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049B\u044B","arri\xE8re","arka","achterzijde"],h=["\uD2B8\uB9AC\uD50C","\u4E09\u955C\u5934","\u4E09\u93E1\u982D","\u30C8\u30EA\u30D7\u30EB","\u0E2A\u0E32\u0E21","\u091F\u094D\u0930\u093F\u092A\u0932","\u062B\u0644\u0627\u062B\u064A\u0629","\u05DE\u05E9\u05D5\u05DC\u05E9\u05EA","\u04AF\u0448\u0442\u0456\u043A","\u0442\u0440\u043E\u0439\u043D\u0430\u044F","\u0442\u0440\u043E\u0439\u043D\u0430","\u043F\u043E\u0442\u0440\u043E\u0454\u043D\u0430","\u03C4\u03C1\u03B9\u03C0\u03BB\u03AE","\xFC\xE7l\xFC","tr\xF3jobiektywowy","trostruka","trojn\xFD","trojit\xE1","trippelt","trippel","tripl\u0103","triple","tripla","tiga","kolmois","ba camera"],p=["\uB4C0\uC5BC \uC640\uC774\uB4DC","\u96D9\u5EE3\u89D2","\u53CC\u5E7F\u89D2","\u30C7\u30E5\u30A2\u30EB\u5E83\u89D2","\u0E04\u0E39\u0E48\u0E14\u0E49\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07\u0E21\u0E38\u0E21\u0E01\u0E27\u0E49\u0E32\u0E07","\u0921\u094D\u092F\u0941\u0905\u0932 \u0935\u093E\u0907\u0921","\u0645\u0632\u062F\u0648\u062C\u0629 \u0639\u0631\u064A\u0636\u0629","\u05DB\u05E4\u05D5\u05DC\u05D4 \u05E8\u05D7\u05D1\u05D4","\u049B\u043E\u0441 \u043A\u0435\u04A3 \u0431\u04B1\u0440\u044B\u0448\u0442\u044B","\u0437\u0434\u0432\u043E\u0454\u043D\u0430 \u0448\u0438\u0440\u043E\u043A\u043E\u043A\u0443\u0442\u043D\u0430","\u0434\u0432\u043E\u0439\u043D\u0430\u044F \u0448\u0438\u0440\u043E\u043A\u043E\u0443\u0433\u043E\u043B\u044C\u043D\u0430\u044F","\u0434\u0432\u043E\u0439\u043D\u0430 \u0448\u0438\u0440\u043E\u043A\u043E\u044A\u0433\u044A\u043B\u043D\u0430","\u03B4\u03B9\u03C0\u03BB\u03AE \u03B5\u03C5\u03C1\u03B5\u03AF\u03B1","\xE7ift geni\u015F","laajakulmainen kaksois","k\xE9p r\u1ED9ng m\u1EB7t sau","kett\u0151s, sz\xE9les l\xE1t\xF3sz\xF6g\u0171","grande angular dupla","ganda","dwuobiektywowy","dwikamera","dvostruka \u0161iroka","du\xE1ln\xED \u0161iroko\xFAhl\xFD","du\xE1lna \u0161irokouhl\xE1","dupla grande-angular","dubl\u0103","dubbel vidvinkel","dual-weitwinkel","dual wide","dual con gran angular","dual","double","doppia con grandangolo","doble","dobbelt vidvinkelkamera"],v=e.filter(S=>{let x=S.label.toLowerCase();return o.some(M=>x.includes(M))});if(!v.length)return null;let w=v.find(S=>{let x=S.label.toLowerCase();return h.some(M=>x.includes(M))});if(w)return w.deviceId;let I=v.find(S=>{let x=S.label.toLowerCase();return p.some(M=>x.includes(M))});return I?I.deviceId:v[0].deviceId}}static findBestRearCamera(e,n){if(!e||!e.length)return null;if(["iPhone","iPad","Mac"].includes(mt.OS))return t.findBestRearCameraInIOS(e,{getMainCamera:n?.getMainCameraInIOS});let i=["\uD6C4","\u80CC\u9762","\u80CC\u7F6E","\u5F8C\u9762","\u5F8C\u7F6E","\u540E\u9762","\u540E\u7F6E","\u0E32\u0E19\u0E2B\u0E25\u0E31\u0E07","\u0E2B\u0E25\u0E31\u0E07","\u092C\u0948\u0915","\u062E\u0644\u0641\u064A\u0629","\u05D0\u05D7\u05D5\u05E8\u05D9\u05EA","\u0437\u0430\u0434\u043D\u044F\u044F","\u0437\u0430\u0434\u043D\u044F","\u0437\u0430\u0434\u043D\u0435\u0439","\u0437\u0430\u0434\u043D\u0430","\u03C0\u03AF\u03C3\u03C9","zadn\xED","zadn\xE1","tylny","tr\xE1s","trasera","traseira","taka","stra\u017Enja","spate","sau","r\xFCck","rear","posteriore","posterior","h\xE1ts\xF3","darrere","belakang","baksidan","bakre","bak","bagside","back","a\u0440\u0442\u049B\u044B","arri\xE8re","arka","achterzijde"];for(let o of e){let h=o.label.toLowerCase();if(h&&i.some(p=>h.includes(p))&&/\b0(\b)?/.test(h))return o.deviceId}return["Android","HarmonyOS"].includes(mt.OS)?e[e.length-1].deviceId:null}static findBestCamera(e,n,i){return e&&e.length?n==="environment"?this.findBestRearCamera(e,i):n==="user"?null:n?void 0:null:null}static playVideo(e,n,i){return z(this,null,function*(){if(!e)throw new Error("Invalid 'videoEl'.");if(!n)throw new Error("Invalid 'source'.");return new Promise((o,h)=>z(this,null,function*(){let p,v=()=>{e.removeEventListener("loadstart",x),e.removeEventListener("abort",M),e.removeEventListener("play",R),e.removeEventListener("error",O),e.removeEventListener("loadedmetadata",H)},w=!1,I=()=>{w=!0,p&&clearTimeout(p),v(),o(e)},S=Y=>{p&&clearTimeout(p),v(),h(Y)},x=()=>{e.addEventListener("abort",M,{once:!0})},M=()=>{let Y=new Error("Video playing was interrupted.");Y.name="AbortError",S(Y)},R=()=>{I()},O=()=>{S(new Error(`Video error ${e.error.code}: ${e.error.message}.`))},B,V=new Promise(Y=>{B=Y}),H=()=>{B()};if(e.addEventListener("loadstart",x,{once:!0}),e.addEventListener("play",R,{once:!0}),e.addEventListener("error",O,{once:!0}),e.addEventListener("loadedmetadata",H,{once:!0}),typeof n=="string"||n instanceof String?e.src=n:e.srcObject=n,e.autoplay&&(yield new Promise(Y=>{setTimeout(Y,1e3)})),!w){i&&(p=setTimeout(()=>{v(),h(new Error("Failed to play video. Timeout."))},i));try{e.src&&(yield e.load()),yield e.play(),I()}catch(Y){console.warn("1st play error: "+(Y?.message||Y))}if(!w){yield V;try{yield e.play(),I()}catch(Y){console.warn("2rd play error: "+(Y?.message||Y)),S(Y)}}}}))})}static testCameraAccess(e){return z(this,null,function*(){var n,i;if(!(!((i=(n=window?.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||i===void 0)&&i.getUserMedia))return{ok:!1,errorName:"InsecureContext",errorMessage:"Insecure context."};let o;try{o=e?yield navigator.mediaDevices.getUserMedia(e):yield navigator.mediaDevices.getUserMedia({video:!0})}catch(h){return{ok:!1,errorName:h.name,errorMessage:h.message}}finally{o?.getTracks().forEach(h=>{h.stop()})}return{ok:!0}})}get state(){if(!F(this,Rt,"f"))return"closed";if(F(this,Rt,"f")==="pending")return"opening";if(F(this,Rt,"f")==="fulfilled")return"opened";throw new Error("Unknown state.")}set ifSaveLastUsedCamera(e){e?t.isStorageAvailable("localStorage")?Pe(this,dr,!0,"f"):(Pe(this,dr,!1,"f"),console.warn("Local storage is unavailable")):Pe(this,dr,!1,"f")}get ifSaveLastUsedCamera(){return F(this,dr,"f")}get isVideoPlaying(){return!(!F(this,xe,"f")||F(this,xe,"f").paused)&&this.state==="opened"}set tapFocusEventBoundEl(e){var n,i,o;if(!(e instanceof HTMLElement)&&e!=null)throw new TypeError("Invalid 'element'.");(n=F(this,bi,"f"))===null||n===void 0||n.removeEventListener("click",F(this,pr,"f")),(i=F(this,bi,"f"))===null||i===void 0||i.removeEventListener("touchend",F(this,pr,"f")),(o=F(this,bi,"f"))===null||o===void 0||o.removeEventListener("touchmove",F(this,oa,"f")),Pe(this,bi,e,"f"),e&&(window.TouchEvent&&["Android","HarmonyOS","iPhone","iPad"].includes(mt.OS)?(e.addEventListener("touchend",F(this,pr,"f")),e.addEventListener("touchmove",F(this,oa,"f"))):e.addEventListener("click",F(this,pr,"f")))}get tapFocusEventBoundEl(){return F(this,bi,"f")}get disposed(){return F(this,la,"f")}constructor(e){var n,i;me.add(this),xe.set(this,null),je.set(this,void 0),ia.set(this,()=>{this.state==="opened"&&F(this,ct,"f").fire("resumed",null,{target:this,async:!1})}),ra.set(this,()=>{F(this,ct,"f").fire("paused",null,{target:this,async:!1})}),ze.set(this,void 0),jt.set(this,void 0),this.cameraOpenTimeout=15e3,this._arrCameras=[],Fn.set(this,void 0),dr.set(this,!1),this.ifSkipCameraInspection=!1,this.selectIOSRearMainCameraAsDefault=!1,sa.set(this,void 0),gn.set(this,!0),Bn.set(this,void 0),Rt.set(this,void 0),fr.set(this,!1),this._focusParameters={maxTimeout:400,minTimeout:300,kTimeout:void 0,oldDistance:null,fds:null,isDoingFocus:0,taskBackToContinous:null,curFocusTaskId:0,focusCancelableTime:1500,defaultFocusAreaSizeRatio:6,focusBackToContinousTime:5e3,tapFocusMinDistance:null,tapFocusMaxDistance:null,focusArea:null,tempBufferContainer:null,defaultTempBufferContainerLenRatio:1/4},gr.set(this,!1),this._focusSupported=!0,this.calculateCoordInVideo=(o,h)=>{let p,v,w=window.getComputedStyle(F(this,xe,"f")).objectFit,I=this.getResolution(),S=F(this,xe,"f").getBoundingClientRect(),x=S.left,M=S.top,{width:R,height:O}=F(this,xe,"f").getBoundingClientRect();if(R<=0||O<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let B=R/O,V=I.width/I.height,H=1;if(w==="contain")V>B?(H=R/I.width,p=(o-x)/H,v=(h-M-(O-R/V)/2)/H):(H=O/I.height,v=(h-M)/H,p=(o-x-(R-O*V)/2)/H);else{if(w!=="cover")throw new Error("Unsupported object-fit.");V>B?(H=O/I.height,v=(h-M)/H,p=(o-x+(O*V-R)/2)/H):(H=R/I.width,p=(o-x)/H,v=(h-M+(R/V-O)/2)/H)}return{x:p,y:v}},As.set(this,!1),oa.set(this,()=>{Pe(this,As,!0,"f")}),pr.set(this,o=>z(this,null,function*(){var h;if(F(this,As,"f"))return void Pe(this,As,!1,"f");if(!F(this,gr,"f")||!this.isVideoPlaying||!F(this,je,"f")||!this._focusSupported)return;if(!this._focusParameters.fds&&(this._focusParameters.fds=(h=this.getCameraCapabilities())===null||h===void 0?void 0:h.focusDistance,!this._focusParameters.fds))return void(this._focusSupported=!1);if(this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus==1)return;let p,v;if(this._focusParameters.taskBackToContinous&&(clearTimeout(this._focusParameters.taskBackToContinous),this._focusParameters.taskBackToContinous=null),o instanceof MouseEvent)p=o.clientX,v=o.clientY;else{if(!(o instanceof TouchEvent))throw new Error("Unknown event type.");if(!o.changedTouches.length)return;p=o.changedTouches[0].clientX,v=o.changedTouches[0].clientY}let w=this.getResolution(),I=2*Math.round(Math.min(w.width,w.height)/this._focusParameters.defaultFocusAreaSizeRatio/2),S;try{S=this.calculateCoordInVideo(p,v)}catch{}if(S.x<0||S.x>w.width||S.y<0||S.y>w.height)return;let x={x:S.x+"px",y:S.y+"px"},M=I+"px",R=M,O;t._onLog&&(O=Date.now());try{yield F(this,me,"m",Iu).call(this,x,M,R,this._focusParameters.tapFocusMinDistance,this._focusParameters.tapFocusMaxDistance)}catch(B){if(t._onLog)throw t._onLog(B),B}t._onLog&&t._onLog(`Tap focus costs: ${Date.now()-O} ms`),this._focusParameters.taskBackToContinous=setTimeout(()=>{var B;t._onLog&&t._onLog("Back to continuous focus."),(B=F(this,je,"f"))===null||B===void 0||B.applyConstraints({advanced:[{focusMode:"continuous"}]}).catch(()=>{})},this._focusParameters.focusBackToContinousTime),F(this,ct,"f").fire("tapfocus",null,{target:this,async:!1})})),bi.set(this,null),Nn.set(this,1),Pn.set(this,{x:0,y:0}),this.updateVideoElWhenSoftwareScaled=()=>{if(!F(this,xe,"f"))return;let o=F(this,Nn,"f");if(o<1)throw new RangeError("Invalid scale value.");if(o===1)F(this,xe,"f").style.transform="";else{let h=window.getComputedStyle(F(this,xe,"f")).objectFit,p=F(this,xe,"f").videoWidth,v=F(this,xe,"f").videoHeight,{width:w,height:I}=F(this,xe,"f").getBoundingClientRect();if(w<=0||I<=0)throw new Error("Unable to get video dimensions. Video may not be rendered on the page.");let S=w/I,x=p/v,M=1;h==="contain"?M=S<x?w/(p/o):I/(v/o):h==="cover"&&(M=x>S?I/(p/o):w/(v/o));let R=M*(1-1/o)*(p/2-F(this,Pn,"f").x),O=M*(1-1/o)*(v/2-F(this,Pn,"f").y);F(this,xe,"f").style.transform=`translate(${R}px, ${O}px) scale(${o})`}},Eu.set(this,function(){if(!(this.data instanceof Uint8Array||this.data instanceof Uint8ClampedArray))throw new TypeError("Invalid data.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");let o=document.createElement("canvas"),h;if(o.width=this.width,o.height=this.height,this.pixelFormat===Ne.GREY){h=new Uint8ClampedArray(this.width*this.height*4);for(let v=0;v<h.length;v+=4)h[v]=this.data[v/4],h[v+1]=this.data[v/4],h[v+2]=this.data[v/4],h[v+3]=255}else h=new Uint8ClampedArray(this.data.buffer);let p=new ImageData(h,this.width,this.height);return o.getContext("2d").putImageData(p,0,0),o}),ct.set(this,void 0),Cu.set(this,["before:open","opened","before:close","closed","before:camera:change","camera:changed","before:resolution:change","resolution:changed","played","paused","resumed","tapfocus"]),this.detectedResolutions=[{width:160,height:120},{width:320,height:240},{width:480,height:360},{width:640,height:480},{width:800,height:600},{width:960,height:720},{width:1280,height:720},{width:1920,height:1080},{width:2560,height:1440},{width:3840,height:2160}],Ti.set(this,new Map),vp.set(this,!1),aa.set(this,()=>z(this,null,function*(){var o,h;if(document.visibilityState==="visible"){if(t._onLog&&t._onLog("document visible. video paused: "+((o=F(this,xe,"f"))===null||o===void 0?void 0:o.paused)),this.state=="opening"||this.state=="opened"){let p=!1;if(!this.isVideoPlaying){t._onLog&&t._onLog("document visible. Not auto resume. 1st resume start.");try{yield this.resume(),p=!0}catch{t._onLog&&t._onLog("document visible. 1st resume video failed, try open instead.")}p||(yield F(this,me,"m",_r).call(this))}if(yield new Promise(v=>setTimeout(v,300)),!this.isVideoPlaying){t._onLog&&t._onLog("document visible. 1st open failed. 2rd resume start."),p=!1;try{yield this.resume(),p=!0}catch{t._onLog&&t._onLog("document visible. 2rd resume video failed, try open instead.")}p||(yield F(this,me,"m",_r).call(this))}}}else document.visibilityState==="hidden"&&(t._onLog&&t._onLog("document hidden. video paused: "+((h=F(this,xe,"f"))===null||h===void 0?void 0:h.paused)),this.state=="opening"||this.state=="opened"&&this.isVideoPlaying&&this.pause())})),la.set(this,!1),!((i=(n=window?.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||i===void 0)&&i.getUserMedia||setTimeout(()=>{t.onWarning&&t.onWarning("The browser is too old or the page is loaded from an insecure origin.")},0),this.defaultConstraints={video:{facingMode:{ideal:"environment"}}},this.resetMediaStreamConstraints(),e instanceof HTMLVideoElement&&this.setVideoEl(e),Pe(this,ct,new bu,"f"),this.imageDataGetter=new _a,document.addEventListener("visibilitychange",F(this,aa,"f"))}setVideoEl(e){if(!(e&&e instanceof HTMLVideoElement))throw new Error("Invalid 'videoEl'.");e.addEventListener("play",F(this,ia,"f")),e.addEventListener("pause",F(this,ra,"f")),Pe(this,xe,e,"f")}getVideoEl(){return F(this,xe,"f")}releaseVideoEl(){var e,n;(e=F(this,xe,"f"))===null||e===void 0||e.removeEventListener("play",F(this,ia,"f")),(n=F(this,xe,"f"))===null||n===void 0||n.removeEventListener("pause",F(this,ra,"f")),Pe(this,xe,null,"f")}isVideoLoaded(){return!!F(this,xe,"f")&&F(this,xe,"f").readyState==4}open(){return z(this,null,function*(){if(F(this,Bn,"f")&&!F(this,gn,"f")){if(F(this,Rt,"f")==="pending")return F(this,Bn,"f");if(F(this,Rt,"f")==="fulfilled")return}F(this,ct,"f").fire("before:open",null,{target:this}),yield F(this,me,"m",_r).call(this),F(this,ct,"f").fire("played",null,{target:this,async:!1}),F(this,ct,"f").fire("opened",null,{target:this,async:!1})})}close(){return z(this,null,function*(){if(this.state==="closed")return;F(this,ct,"f").fire("before:close",null,{target:this});let e=F(this,Bn,"f");if(F(this,me,"m",wa).call(this),e&&F(this,Rt,"f")==="pending"){try{yield e}catch{}if(F(this,gn,"f")===!1){let n=new Error("'close()' was interrupted.");throw n.name="AbortError",n}}Pe(this,Bn,null,"f"),Pe(this,Rt,null,"f"),F(this,ct,"f").fire("closed",null,{target:this,async:!1})})}pause(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");F(this,xe,"f").pause()}resume(){return z(this,null,function*(){if(!this.isVideoLoaded())throw new Error("Video is not loaded.");if(this.state!=="opened")throw new Error("Camera or video is not open.");yield F(this,xe,"f").play()})}setCamera(e){return z(this,null,function*(){if(typeof e!="string")throw new TypeError("Invalid 'deviceId'.");if(typeof F(this,ze,"f").video!="object"&&(F(this,ze,"f").video={}),delete F(this,ze,"f").video.facingMode,F(this,ze,"f").video.deviceId={exact:e},!(this.state==="closed"||this.videoSrc||this.state==="opening"&&F(this,gn,"f"))){F(this,ct,"f").fire("before:camera:change",[],{target:this,async:!1}),yield F(this,me,"m",Ms).call(this);try{this.resetSoftwareScale()}catch{}return F(this,jt,"f")}})}switchToFrontCamera(e){return z(this,null,function*(){if(typeof F(this,ze,"f").video!="object"&&(F(this,ze,"f").video={}),e?.resolution&&(F(this,ze,"f").video.width={ideal:e.resolution.width},F(this,ze,"f").video.height={ideal:e.resolution.height}),delete F(this,ze,"f").video.deviceId,F(this,ze,"f").video.facingMode={exact:"user"},Pe(this,Fn,null,"f"),!(this.state==="closed"||this.videoSrc||this.state==="opening"&&F(this,gn,"f"))){F(this,ct,"f").fire("before:camera:change",[],{target:this,async:!1}),F(this,me,"m",Ms).call(this);try{this.resetSoftwareScale()}catch{}return F(this,jt,"f")}})}getCamera(){var e;if(F(this,jt,"f"))return F(this,jt,"f");{let n=((e=F(this,ze,"f").video)===null||e===void 0?void 0:e.deviceId)||"";if(n){n=n.exact||n.ideal||n;for(let i of this._arrCameras)if(i.deviceId===n)return JSON.parse(JSON.stringify(i))}return{deviceId:"",label:"",_checked:!1}}}_getCameras(e){return z(this,null,function*(){var n,i;if(!(!((i=(n=window?.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||i===void 0)&&i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let o;if(e){let v=yield navigator.mediaDevices.getUserMedia({video:!0});o=(yield navigator.mediaDevices.enumerateDevices()).filter(w=>w.kind==="videoinput"),v.getTracks().forEach(w=>{w.stop()})}else o=(yield navigator.mediaDevices.enumerateDevices()).filter(v=>v.kind==="videoinput");let h=[],p=[];if(this._arrCameras)for(let v of this._arrCameras)v._checked&&p.push(v);for(let v=0;v<o.length;v++){let w,I=o[v];for(let S of p)if(I.deviceId==S.deviceId){w=S;break}w||(w={deviceId:I.deviceId,label:I.label?I.label:"camera "+v,_checked:!1}),w.deviceId&&h.push(w)}return this._arrCameras=h,t._onLog&&t._onLog(JSON.stringify(this._arrCameras)),h})}getCameras(){return z(this,null,function*(){var e,n;if(!(!((n=(e=window?.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||n===void 0)&&n.enumerateDevices))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let i=(yield navigator.mediaDevices.enumerateDevices()).filter(o=>o.kind==="videoinput");return i&&i.length&&!i[0].deviceId?this._getCameras(!0):this._getCameras(!1)})}getAllCameras(){return z(this,null,function*(){return this.getCameras()})}setResolution(e,n,i){return z(this,null,function*(){if(typeof e!="number"||e<=0)throw new TypeError("Invalid 'width'.");if(typeof n!="number"||n<=0)throw new TypeError("Invalid 'height'.");if(typeof F(this,ze,"f").video!="object"&&(F(this,ze,"f").video={}),i?(F(this,ze,"f").video.width={exact:e},F(this,ze,"f").video.height={exact:n}):(F(this,ze,"f").video.width={ideal:e},F(this,ze,"f").video.height={ideal:n}),this.state==="closed"||this.videoSrc||this.state==="opening"&&F(this,gn,"f"))return null;F(this,ct,"f").fire("before:resolution:change",[],{target:this,async:!1}),yield F(this,me,"m",Ms).call(this);try{this.resetSoftwareScale()}catch{}let o=this.getResolution();return{width:o.width,height:o.height}})}getResolution(){if(this.state==="opened"&&this.videoSrc&&F(this,xe,"f"))return{width:F(this,xe,"f").videoWidth,height:F(this,xe,"f").videoHeight};if(F(this,je,"f")){let e=F(this,je,"f").getSettings();return{width:e.width,height:e.height}}if(this.isVideoLoaded())return{width:F(this,xe,"f").videoWidth,height:F(this,xe,"f").videoHeight};{let e={width:0,height:0},n=F(this,ze,"f").video.width||0,i=F(this,ze,"f").video.height||0;return n&&(e.width=n.exact||n.ideal||n),i&&(e.height=i.exact||i.ideal||i),e}}getResolutions(e){return z(this,null,function*(){var n,i,o,h,p,v,w,I,S,x,M;if(!(!((i=(n=window?.navigator)===null||n===void 0?void 0:n.mediaDevices)===null||i===void 0)&&i.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let R="",O=(B,V)=>{let H=F(this,Ti,"f").get(B);if(!H||!H.length)return!1;for(let Y of H)if(Y.width===V.width&&Y.height===V.height)return!0;return!1};if(this._mediaStream){R=(M=F(this,jt,"f"))===null||M===void 0?void 0:M.deviceId;let B=F(this,Ti,"f").get(R);if(B&&!e)return JSON.parse(JSON.stringify(B));B=[],F(this,Ti,"f").set(R,B),Pe(this,fr,!0,"f");try{for(let V of this.detectedResolutions){yield F(this,je,"f").applyConstraints({width:{ideal:V.width},height:{ideal:V.height}}),F(this,me,"m",tn).call(this);let H=F(this,je,"f").getSettings(),Y={width:H.width,height:H.height};O(R,Y)||B.push({width:Y.width,height:Y.height})}}catch(V){throw F(this,me,"m",wa).call(this),Pe(this,fr,!1,"f"),V}try{yield F(this,me,"m",_r).call(this)}catch(V){if(V.name==="AbortError")return B;throw V}finally{Pe(this,fr,!1,"f")}return B}{let B=(Y,Z,he)=>z(this,null,function*(){let ce={video:{deviceId:{exact:Y},width:{ideal:Z},height:{ideal:he}}},ye=null;try{ye=yield navigator.mediaDevices.getUserMedia(ce)}catch{return null}if(!ye)return null;let be=ye.getVideoTracks(),_=null;try{let ue=be[0].getSettings();_={width:ue.width,height:ue.height}}catch{let Ee=document.createElement("video");Ee.srcObject=ye,_={width:Ee.videoWidth,height:Ee.videoHeight},Ee.srcObject=null}return be.forEach(ue=>{ue.stop()}),_}),V=((p=(h=(o=F(this,ze,"f"))===null||o===void 0?void 0:o.video)===null||h===void 0?void 0:h.deviceId)===null||p===void 0?void 0:p.exact)||((I=(w=(v=F(this,ze,"f"))===null||v===void 0?void 0:v.video)===null||w===void 0?void 0:w.deviceId)===null||I===void 0?void 0:I.ideal)||((x=(S=F(this,ze,"f"))===null||S===void 0?void 0:S.video)===null||x===void 0?void 0:x.deviceId);if(!V)return[];let H=F(this,Ti,"f").get(V);if(H&&!e)return JSON.parse(JSON.stringify(H));H=[],F(this,Ti,"f").set(V,H);for(let Y of this.detectedResolutions){let Z=yield B(V,Y.width,Y.height);Z&&!O(V,Z)&&H.push({width:Z.width,height:Z.height})}return H}})}setMediaStreamConstraints(e,n){return z(this,null,function*(){if(!(i=>{return i!==null&&(o=i,Object.prototype.toString.call(o)==="[object Object]");var o})(e))throw new TypeError("Invalid 'mediaStreamConstraints'.");Pe(this,ze,JSON.parse(JSON.stringify(e)),"f"),Pe(this,Fn,null,"f"),n&&F(this,me,"m",Ms).call(this)})}getMediaStreamConstraints(){return JSON.parse(JSON.stringify(F(this,ze,"f")))}resetMediaStreamConstraints(){Pe(this,ze,this.defaultConstraints?JSON.parse(JSON.stringify(this.defaultConstraints)):null,"f")}getCameraCapabilities(){if(!F(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");return F(this,je,"f").getCapabilities?F(this,je,"f").getCapabilities():{}}getCameraSettings(){if(!F(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");return F(this,je,"f").getSettings()}turnOnTorch(){return z(this,null,function*(){if(!F(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");let e=this.getCameraCapabilities();if(!e?.torch)throw Error("Not supported.");yield F(this,je,"f").applyConstraints({advanced:[{torch:!0}]})})}turnOffTorch(){return z(this,null,function*(){if(!F(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");let e=this.getCameraCapabilities();if(!e?.torch)throw Error("Not supported.");yield F(this,je,"f").applyConstraints({advanced:[{torch:!1}]})})}setColorTemperature(e,n){return z(this,null,function*(){var i;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!F(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");let o=(i=this.getCameraCapabilities())===null||i===void 0?void 0:i.colorTemperature;if(!o)throw Error("Not supported.");return n&&(e<o.min?e=o.min:e>o.max&&(e=o.max),e=bt(e,o.min,o.step,o.max)),yield F(this,je,"f").applyConstraints({advanced:[{colorTemperature:e,whiteBalanceMode:"manual"}]}),e})}getColorTemperature(){return this.getCameraSettings().colorTemperature||0}setExposureCompensation(e,n){return z(this,null,function*(){var i;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!F(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");let o=(i=this.getCameraCapabilities())===null||i===void 0?void 0:i.exposureCompensation;if(!o)throw Error("Not supported.");return n&&(e<o.min?e=o.min:e>o.max&&(e=o.max),e=bt(e,o.min,o.step,o.max)),yield F(this,je,"f").applyConstraints({advanced:[{exposureCompensation:e}]}),e})}getExposureCompensation(){return this.getCameraSettings().exposureCompensation||0}setFrameRate(e,n){return z(this,null,function*(){var i;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(!F(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");let o=(i=this.getCameraCapabilities())===null||i===void 0?void 0:i.frameRate;if(!o)throw Error("Not supported.");n&&(e<o.min?e=o.min:e>o.max&&(e=o.max));let h=this.getResolution();return yield F(this,je,"f").applyConstraints({width:{ideal:Math.max(h.width,h.height)},frameRate:e}),e})}getFrameRate(){return this.getCameraSettings().frameRate}setFocus(e,n){return z(this,null,function*(){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(!F(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");let i=this.getCameraCapabilities(),o=i?.focusMode,h=i?.focusDistance;if(!o)throw Error("Not supported.");if(typeof e.mode!="string")throw TypeError("Invalid 'mode'.");let p=e.mode.toLowerCase();if(!o.includes(p))throw Error("Unsupported focus mode.");if(p==="manual"){if(!h)throw Error("Manual focus unsupported.");if(e.hasOwnProperty("distance")){let v=e.distance;n&&(v<h.min?v=h.min:v>h.max&&(v=h.max),v=bt(v,h.min,h.step,h.max)),this._focusParameters.focusArea=null,yield F(this,je,"f").applyConstraints({advanced:[{focusMode:p,focusDistance:v}]})}else{if(!e.area)throw new Error("'distance' or 'area' should be specified in 'manual' mode.");{let v=e.area.centerPoint,w=e.area.width,I=e.area.height;if(!w||!I){let S=this.getResolution();w||(w=2*Math.round(Math.min(S.width,S.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px"),I||(I=2*Math.round(Math.min(S.width,S.height)/this._focusParameters.defaultFocusAreaSizeRatio/2)+"px")}this._focusParameters.focusArea={centerPoint:{x:v.x,y:v.y},width:w,height:I},yield F(this,me,"m",Iu).call(this,v,w,I)}}}else this._focusParameters.focusArea=null,yield F(this,je,"f").applyConstraints({advanced:[{focusMode:p}]})})}getFocus(){let e=this.getCameraSettings(),n=e.focusMode;return n?n==="manual"?this._focusParameters.focusArea?{mode:"manual",area:JSON.parse(JSON.stringify(this._focusParameters.focusArea))}:{mode:"manual",distance:e.focusDistance}:{mode:n}:null}enableTapToFocus(){return z(this,null,function*(){Pe(this,gr,!0,"f")})}disableTapToFocus(){Pe(this,gr,!1,"f")}isTapToFocusEnabled(){return F(this,gr,"f")}setZoom(e){return z(this,null,function*(){if(typeof e!="object"||Array.isArray(e)||e==null)throw new TypeError("Invalid 'settings'.");if(typeof e.factor!="number")throw new TypeError("Illegal type of 'factor'.");if(e.factor<1)throw new RangeError("Invalid 'factor'.");if(this.state!=="opened")throw new Error("Video is not playing.");e.centerPoint?F(this,me,"m",Du).call(this,e.centerPoint):this.resetScaleCenter();try{if(F(this,me,"m",yp).call(this,F(this,Pn,"f"))){let n=yield this.setHardwareScale(e.factor,!0),i=this.getHardwareScale();i==1&&n!=1&&(i=n),e.factor>i?this.setSoftwareScale(e.factor/i):this.setSoftwareScale(1)}else yield this.setHardwareScale(1),this.setSoftwareScale(e.factor)}catch(n){let i=n.message||n;if(i!=="Not supported."&&i!=="Camera is not open.")throw n;this.setSoftwareScale(e.factor)}})}getZoom(){if(this.state!=="opened")throw new Error("Video is not playing.");let e=1;try{e=this.getHardwareScale()}catch(n){if((n.message||n)!=="Camera is not open.")throw n}return{factor:e*F(this,Nn,"f")}}resetZoom(){return z(this,null,function*(){yield this.setZoom({factor:1})})}setHardwareScale(e,n){return z(this,null,function*(){var i;if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(!F(this,je,"f")||this.state!=="opened")throw new Error("Camera is not open.");let o=(i=this.getCameraCapabilities())===null||i===void 0?void 0:i.zoom;if(!o)throw Error("Not supported.");return n&&(e<o.min?e=o.min:e>o.max&&(e=o.max),e=bt(e,o.min,o.step,o.max)),yield F(this,je,"f").applyConstraints({advanced:[{zoom:e}]}),e})}getHardwareScale(){return this.getCameraSettings().zoom||1}setSoftwareScale(e,n){if(typeof e!="number")throw new TypeError("Invalid 'value'.");if(e<1)throw new RangeError("Invalid 'value'.");if(this.state!=="opened")throw new Error("Video is not playing.");n&&F(this,me,"m",Du).call(this,n),Pe(this,Nn,e,"f"),this.updateVideoElWhenSoftwareScaled()}getSoftwareScale(){return F(this,Nn,"f")}resetScaleCenter(){if(this.state!=="opened")throw new Error("Video is not playing.");let e=this.getResolution();Pe(this,Pn,{x:e.width/2,y:e.height/2},"f")}resetSoftwareScale(){this.setSoftwareScale(1),this.resetScaleCenter()}getFrameData(e){if(this.disposed)throw Error("The 'Camera' instance has been disposed.");if(!this.isVideoLoaded()||F(this,fr,"f"))return null;let n=Date.now();t._onLog&&t._onLog("getFrameData() START: "+n);let i=F(this,xe,"f").videoWidth,o=F(this,xe,"f").videoHeight,h={sx:0,sy:0,sWidth:i,sHeight:o,dWidth:i,dHeight:o};e?.position&&(h=JSON.parse(JSON.stringify(e.position)));let p=Ne.RGBA;e?.pixelFormat&&(p=e.pixelFormat);let v=F(this,Nn,"f");e?.scale&&(v=e.scale);let w=F(this,Pn,"f");if(e?.scaleCenter){if(typeof e.scaleCenter.x!="string"||typeof e.scaleCenter.y!="string")throw new Error("Invalid scale center.");let M=0,R=0;if(e.scaleCenter.x.endsWith("px"))M=parseFloat(e.scaleCenter.x);else{if(!e.scaleCenter.x.endsWith("%"))throw new Error("Invalid scale center.");M=parseFloat(e.scaleCenter.x)/100*i}if(e.scaleCenter.y.endsWith("px"))R=parseFloat(e.scaleCenter.y);else{if(!e.scaleCenter.y.endsWith("%"))throw new Error("Invalid scale center.");R=parseFloat(e.scaleCenter.y)/100*o}if(isNaN(M)||isNaN(R))throw new Error("Invalid scale center.");w.x=Math.round(M),w.y=Math.round(R)}let I=null;if(e?.bufferContainer&&(I=e.bufferContainer),i==0||o==0)return null;v!==1&&(h.sWidth=Math.round(h.sWidth/v),h.sHeight=Math.round(h.sHeight/v),h.sx=Math.round((1-1/v)*w.x+h.sx/v),h.sy=Math.round((1-1/v)*w.y+h.sy/v));let S=this.imageDataGetter.getImageData(F(this,xe,"f"),i,o,h,{pixelFormat:p,bufferContainer:I});if(!S)return null;let x=Date.now();return t._onLog&&t._onLog("getFrameData() END: "+x),{data:S.data,width:S.width,height:S.height,pixelFormat:S.pixelFormat,timeSpent:x-n,timeStamp:x,toCanvas:F(this,Eu,"f")}}on(e,n){if(!F(this,Cu,"f").includes(e.toLowerCase()))throw new Error(`Event '${e}' does not exist.`);F(this,ct,"f").on(e,n)}off(e,n){F(this,ct,"f").off(e,n)}dispose(){return z(this,null,function*(){this.tapFocusEventBoundEl=null,yield this.close(),this.releaseVideoEl(),F(this,ct,"f").dispose(),this.imageDataGetter.dispose(),document.removeEventListener("visibilitychange",F(this,aa,"f")),Pe(this,la,!0,"f")})}},Ps,Ea,wr,Mi,Ca,mr,rp,_p,Fe,Tu,Su,pe,we,Rs,On,Si,ca,ua,ha,ks,xi,da,Ln,Ot,et,ve,dn,xu,$e,wp,Ep,Au,Mu;xe=new WeakMap,je=new WeakMap,ia=new WeakMap,ra=new WeakMap,ze=new WeakMap,jt=new WeakMap,Fn=new WeakMap,dr=new WeakMap,sa=new WeakMap,gn=new WeakMap,Bn=new WeakMap,Rt=new WeakMap,fr=new WeakMap,gr=new WeakMap,As=new WeakMap,oa=new WeakMap,pr=new WeakMap,bi=new WeakMap,Nn=new WeakMap,Pn=new WeakMap,Eu=new WeakMap,ct=new WeakMap,Cu=new WeakMap,Ti=new WeakMap,vp=new WeakMap,aa=new WeakMap,la=new WeakMap,me=new WeakSet,ip=function(){return z(this,null,function*(){let t=this.getMediaStreamConstraints();if(typeof t.video=="boolean"&&(t.video={}),!t.video.deviceId){if(F(this,Fn,"f"))delete t.video.facingMode,t.video.deviceId={exact:F(this,Fn,"f")};else if(this.ifSaveLastUsedCamera&&st.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")){delete t.video.facingMode,t.video.deviceId={ideal:window.localStorage.getItem("dce_last_camera_id")};let e=JSON.parse(window.localStorage.getItem("dce_last_apply_width")),n=JSON.parse(window.localStorage.getItem("dce_last_apply_height"));e&&n&&(t.video.width=e,t.video.height=n)}else if(!this.ifSkipCameraInspection){let e=o=>z(this,null,function*(){let h=null;return o==="environment"&&["Android","HarmonyOS","iPhone","iPad"].includes(mt.OS)?(yield this._getCameras(!1),F(this,me,"m",tn).call(this),h=st.findBestCamera(this._arrCameras,"environment",{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})):o||["Android","HarmonyOS","iPhone","iPad"].includes(mt.OS)||(yield this._getCameras(!1),F(this,me,"m",tn).call(this),h=st.findBestCamera(this._arrCameras,null,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault})),h}),n=t.video.facingMode;n instanceof Array&&n.length&&(n=n[0]),typeof n=="object"&&(n=n.exact||n.ideal);let i=yield e(n);i&&(delete t.video.facingMode,t.video.deviceId={exact:i})}}return t})},tn=function(){if(F(this,gn,"f")){let t=new Error("The operation was interrupted.");throw t.name="AbortError",t}},su=function(t){return z(this,null,function*(){var e,n;if(!(!((n=(e=window?.navigator)===null||e===void 0?void 0:e.mediaDevices)===null||n===void 0)&&n.getUserMedia))throw new Error("Failed to access the camera because the browser is too old or the page is loaded from an insecure origin.");let i;try{st._onLog&&st._onLog("======try getUserMedia========");let o=[0,500,1e3,2e3],h=null,p=v=>z(this,null,function*(){for(let w of o){w&&(yield new Promise(I=>setTimeout(I,w)),F(this,me,"m",tn).call(this));try{st._onLog&&st._onLog("ask "+JSON.stringify(v)),i=yield navigator.mediaDevices.getUserMedia(v),F(this,me,"m",tn).call(this);break}catch(I){if(I.name==="NotFoundError"||I.name==="NotAllowedError"||I.name==="AbortError"||I.name==="OverconstrainedError")throw I;h=I,st._onLog&&st._onLog(I.message||I)}}});if(yield p(t),i||typeof t.video!="object"||(t.video.deviceId&&(delete t.video.deviceId,yield p(t)),!i&&t.video.facingMode&&(delete t.video.facingMode,yield p(t)),i||!t.video.width&&!t.video.height||(delete t.video.width,delete t.video.height,yield p(t))),!i)throw h;return i}catch(o){throw i?.getTracks().forEach(h=>{h.stop()}),o.name==="NotFoundError"&&(DOMException?o=new DOMException("No camera available, please use a device with an accessible camera.",o.name):(o=new Error("No camera available, please use a device with an accessible camera.")).name="NotFoundError"),o}})},ou=function(){this._mediaStream&&(this._mediaStream.getTracks().forEach(t=>{t.stop()}),this._mediaStream=null),Pe(this,je,null,"f")},_r=function(){return z(this,null,function*(){Pe(this,gn,!1,"f");let t=Pe(this,sa,Symbol(),"f");if(F(this,Bn,"f")&&F(this,Rt,"f")==="pending"){try{yield F(this,Bn,"f")}catch{}F(this,me,"m",tn).call(this)}return t!==F(this,sa,"f")?void 0:Pe(this,Bn,z(this,null,function*(){Pe(this,Rt,"pending","f");try{if(this.videoSrc){if(!F(this,xe,"f"))throw new Error("'videoEl' should be set.");yield st.playVideo(F(this,xe,"f"),this.videoSrc,this.cameraOpenTimeout),F(this,me,"m",tn).call(this)}else{let n=yield F(this,me,"m",ip).call(this);F(this,me,"m",ou).call(this);let i=yield F(this,me,"m",su).call(this,n);yield this._getCameras(!1),F(this,me,"m",tn).call(this);let o=()=>{let w=i.getVideoTracks(),I,S;if(w.length&&(I=w[0]),I){let x=I.getSettings();if(x){for(let M of this._arrCameras)if(x.deviceId===M.deviceId){M._checked=!0,M.label=I.label,S=M;break}}}return S},h=F(this,ze,"f");if(typeof h.video=="object"){let w=h.video.facingMode;if(w instanceof Array&&w.length&&(w=w[0]),typeof w=="object"&&(w=w.exact||w.ideal),!(F(this,Fn,"f")||this.ifSaveLastUsedCamera&&st.isStorageAvailable&&window.localStorage.getItem("dce_last_camera_id")||this.ifSkipCameraInspection||h.video.deviceId)){let I=o(),S=st.findBestCamera(this._arrCameras,w,{getMainCameraInIOS:this.selectIOSRearMainCameraAsDefault});S&&S!=I?.deviceId&&(i.getTracks().forEach(x=>{x.stop()}),n.video.deviceId={exact:S},i=yield F(this,me,"m",su).call(this,n),F(this,me,"m",tn).call(this))}}let p=o();p?.deviceId&&(Pe(this,Fn,p&&p.deviceId,"f"),this.ifSaveLastUsedCamera&&st.isStorageAvailable&&(window.localStorage.setItem("dce_last_camera_id",F(this,Fn,"f")),typeof n.video=="object"&&n.video.width&&n.video.height&&(window.localStorage.setItem("dce_last_apply_width",JSON.stringify(n.video.width)),window.localStorage.setItem("dce_last_apply_height",JSON.stringify(n.video.height))))),F(this,xe,"f")&&(yield st.playVideo(F(this,xe,"f"),i,this.cameraOpenTimeout),F(this,me,"m",tn).call(this)),this._mediaStream=i;let v=i.getVideoTracks();v?.length&&Pe(this,je,v[0],"f"),Pe(this,jt,p,"f")}}catch(n){throw F(this,me,"m",wa).call(this),Pe(this,Rt,null,"f"),n}Pe(this,Rt,"fulfilled","f")}),"f")})},Ms=function(){return z(this,null,function*(){var t;if(this.state==="closed"||this.videoSrc)return;let e=(t=F(this,jt,"f"))===null||t===void 0?void 0:t.deviceId,n=this.getResolution();yield F(this,me,"m",_r).call(this);let i=this.getResolution();e&&e!==F(this,jt,"f").deviceId&&F(this,ct,"f").fire("camera:changed",[F(this,jt,"f").deviceId,e],{target:this,async:!1}),n.width==i.width&&n.height==i.height||F(this,ct,"f").fire("resolution:changed",[{width:i.width,height:i.height},{width:n.width,height:n.height}],{target:this,async:!1}),F(this,ct,"f").fire("played",null,{target:this,async:!1})})},wa=function(){F(this,me,"m",ou).call(this),Pe(this,jt,null,"f"),F(this,xe,"f")&&(F(this,xe,"f").srcObject=null,this.videoSrc&&(F(this,xe,"f").pause(),F(this,xe,"f").currentTime=0)),Pe(this,gn,!0,"f");try{this.resetSoftwareScale()}catch{}},St=function t(e,n){return z(this,null,function*(){let i=B=>{if(!F(this,je,"f")||!this.isVideoPlaying||B.focusTaskId!=this._focusParameters.curFocusTaskId){F(this,je,"f")&&this.isVideoPlaying||(this._focusParameters.isDoingFocus=0);let V=new Error(`Focus task ${B.focusTaskId} canceled.`);throw V.name="DeprecatedTaskError",V}this._focusParameters.isDoingFocus===1&&Date.now()-B.timeStart>this._focusParameters.focusCancelableTime&&(this._focusParameters.isDoingFocus=-1)},o;n=bt(n,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),yield F(this,je,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]}),i(e),o=this._focusParameters.oldDistance==null?this._focusParameters.kTimeout*Math.max(Math.abs(1/this._focusParameters.fds.min-1/n),Math.abs(1/this._focusParameters.fds.max-1/n))+this._focusParameters.minTimeout:this._focusParameters.kTimeout*Math.abs(1/this._focusParameters.oldDistance-1/n)+this._focusParameters.minTimeout,this._focusParameters.oldDistance=n,yield new Promise(B=>{setTimeout(B,o)}),i(e);let h=e.focusL-e.focusW/2,p=e.focusT-e.focusH/2,v=e.focusW,w=e.focusH,I=this.getResolution();if(h>=I.width||p>=I.height)throw new Error("Invalid area.");h+v>I.width&&(v=I.width-h),p+w>I.height&&(w=I.height-p),h=Math.round(h),p=Math.round(p),v=Math.round(v),w=Math.round(w);let S=4*I.width*I.height*this._focusParameters.defaultTempBufferContainerLenRatio,x=4*v*w,M=this._focusParameters.tempBufferContainer;if(M){let B=M.length;S>B&&S>=x?M=new Uint8Array(S):x>B&&x>=S&&(M=new Uint8Array(x))}else M=this._focusParameters.tempBufferContainer=new Uint8Array(Math.max(S,x));if(!this.imageDataGetter.getImageData(F(this,xe,"f"),I.width,I.height,{sx:h,sy:p,sWidth:v,sHeight:w,dWidth:v,dHeight:w},{pixelFormat:Ne.RGBA,bufferContainer:M}))return F(this,me,"m",t).call(this,e,n);let R=M,O=0;for(let B=0,V=x-8;B<V;++B){let H=R[B]-R[B+8];++B;let Y=R[B]-R[B+8];++B;let Z=R[B]-R[B+8];++B,O+=H*H+Y*Y+Z*Z}return-O})},sr=function t(e,n,i,o,h,p,v){return z(this,null,function*(){let w;if(n=bt(n,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),o=bt(o,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),p?p=bt(p,this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max):(p=bt(Math.sqrt((n||this._focusParameters.fds.step)*(o||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),v=yield F(this,me,"m",St).call(this,e,p)),v<=i&&v<=h?w=3:i<h&&i<v?w=1:h<i&&h<v&&(w=2),(o-n)/2<=this._focusParameters.fds.step)return w===3||(w===1?yield F(this,je,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:n}]}):w===2&&(yield F(this,je,"f").applyConstraints({advanced:[{focusMode:"manual",focusDistance:o}]}))),!0;if(w===1)return yield F(this,me,"m",t).call(this,e,n,i,p,v);if(w===2)return yield F(this,me,"m",t).call(this,e,p,v,o,h);if(w!==3)return i=yield F(this,me,"m",St).call(this,e,n),h=yield F(this,me,"m",St).call(this,e,o),yield F(this,me,"m",t).call(this,e,n,i,o,h);let I=bt(Math.sqrt((n||this._focusParameters.fds.step)*(p||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),S=bt(Math.sqrt((o||this._focusParameters.fds.step)*(p||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max);if(Math.abs(1/this._focusParameters.oldDistance-1/I)<=Math.abs(1/this._focusParameters.oldDistance-1/S)){let x=yield F(this,me,"m",St).call(this,e,I);if(x<v)return yield F(this,me,"m",t).call(this,e,n,i,p,v,I,x);if(x==v)return yield F(this,me,"m",t).call(this,e,I,x,p,v);let M=yield F(this,me,"m",St).call(this,e,S);if(x>v&&v<M)return yield F(this,me,"m",t).call(this,e,I,x,S,M,p,v);if(v==M)return yield F(this,me,"m",t).call(this,e,p,v,S,M);if(v>M)return yield F(this,me,"m",t).call(this,e,p,v,o,h,S,M)}else{let x=yield F(this,me,"m",St).call(this,e,S);if(v>x)return yield F(this,me,"m",t).call(this,e,p,v,o,h,S,x);if(v==x)return yield F(this,me,"m",t).call(this,e,p,v,S,x);let M=yield F(this,me,"m",St).call(this,e,I);if(M>v&&v<x)return yield F(this,me,"m",t).call(this,e,I,M,S,x,p,v);if(M==v)return yield F(this,me,"m",t).call(this,e,I,M,p,v);if(M<v)return yield F(this,me,"m",t).call(this,e,n,i,p,v,I,M)}return!1})},Iu=function(t,e,n,i,o){return z(this,null,function*(){var h;if(this._focusParameters.isDoingFocus==1)return!1;if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'centerPoint'.");if(!e||typeof e!="string")throw new Error("Invalid 'width'.");if(!n||typeof n!="string")throw new Error("Invalid 'height'.");let p=this.getResolution(),v=0,w=0;if(t.x.endsWith("px"))v=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid 'centerPoint'.");v=parseFloat(t.x)/100*p.width}if(t.y.endsWith("px"))w=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid 'centerPoint'.");w=parseFloat(t.y)/100*p.height}if(isNaN(v)||isNaN(w)||v<0||v>p.width||w<0||w>p.height)throw new Error("Invalid 'centerPoint'.");let I=0;if(e.endsWith("px"))I=parseFloat(e);else{if(!e.endsWith("%"))throw new Error("Invalid 'width'.");I=parseFloat(e)/100*p.width}if(isNaN(I)||I<0)throw new Error("Invalid 'width'.");let S=0;if(n.endsWith("px"))S=parseFloat(n);else{if(!n.endsWith("%"))throw new Error("Invalid 'height'.");S=parseFloat(n)/100*p.height}if(isNaN(S)||S<0)throw new Error("Invalid 'height'.");if(F(this,Nn,"f")!==1){let R=F(this,Nn,"f"),O=F(this,Pn,"f");I/=R,S/=R,v=(1-1/R)*O.x+v/R,w=(1-1/R)*O.y+w/R}if(!this._focusSupported)throw new Error("Manual focus unsupported.");if(!this._focusParameters.fds&&(this._focusParameters.fds=(h=this.getCameraCapabilities())===null||h===void 0?void 0:h.focusDistance,!this._focusParameters.fds))throw this._focusSupported=!1,new Error("Manual focus unsupported.");this._focusParameters.kTimeout==null&&(this._focusParameters.kTimeout=(this._focusParameters.maxTimeout-this._focusParameters.minTimeout)/(1/this._focusParameters.fds.min-1/this._focusParameters.fds.max)),this._focusParameters.isDoingFocus=1;let x={focusL:v,focusT:w,focusW:I,focusH:S,focusTaskId:++this._focusParameters.curFocusTaskId,timeStart:Date.now()},M=(R,O,B)=>z(this,null,function*(){try{(O==null||O<this._focusParameters.fds.min)&&(O=this._focusParameters.fds.min),(B==null||B>this._focusParameters.fds.max)&&(B=this._focusParameters.fds.max),this._focusParameters.oldDistance=null;let V=bt(Math.sqrt(B*(O||this._focusParameters.fds.step)),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),H=bt(Math.sqrt((O||this._focusParameters.fds.step)*V),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),Y=bt(Math.sqrt(V*B),this._focusParameters.fds.min,this._focusParameters.fds.step,this._focusParameters.fds.max),Z=yield F(this,me,"m",St).call(this,R,Y),he=yield F(this,me,"m",St).call(this,R,H),ce=yield F(this,me,"m",St).call(this,R,V);if(he>ce&&ce<Z){let ye=yield F(this,me,"m",sr).call(this,R,H,he,Y,Z,V,ce);return this._focusParameters.isDoingFocus=0,ye}if(he<ce&&he<Z){let ye=yield F(this,me,"m",St).call(this,R,O),be=yield F(this,me,"m",sr).call(this,R,O,ye,V,ce,H,he);return this._focusParameters.isDoingFocus=0,be}if(ce>Z&&he>Z){let ye=yield F(this,me,"m",St).call(this,R,B),be=yield F(this,me,"m",sr).call(this,R,V,ce,B,ye,Y,Z);return this._focusParameters.isDoingFocus=0,be}if(he==ce&&ce<Z){let ye=yield F(this,me,"m",sr).call(this,R,H,he,V,ce);return this._focusParameters.isDoingFocus=0,ye}if(ce==Z&&he>ce){let ye=yield F(this,me,"m",sr).call(this,R,V,ce,Y,Z);return this._focusParameters.isDoingFocus=0,ye}return M(R,O,B)}catch(V){if(V.name!=="DeprecatedTaskError")throw V}});return M(x,i,o)})},Du=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");if(!t||typeof t.x!="string"||typeof t.y!="string")throw new Error("Invalid 'center'.");let e=this.getResolution(),n=0,i=0;if(t.x.endsWith("px"))n=parseFloat(t.x);else{if(!t.x.endsWith("%"))throw new Error("Invalid scale center.");n=parseFloat(t.x)/100*e.width}if(t.y.endsWith("px"))i=parseFloat(t.y);else{if(!t.y.endsWith("%"))throw new Error("Invalid scale center.");i=parseFloat(t.y)/100*e.height}if(isNaN(n)||isNaN(i))throw new Error("Invalid scale center.");Pe(this,Pn,{x:n,y:i},"f")},yp=function(t){if(this.state!=="opened")throw new Error("Video is not playing.");let e=this.getResolution();return t&&t.x==e.width/2&&t.y==e.height/2},st.browserInfo=mt,st.onWarning=(ru=window?.console)===null||ru===void 0?void 0:ru.warn;var Dr=class t{constructor(e){Ps.add(this),Ea.set(this,void 0),wr.set(this,0),Mi.set(this,void 0),Ca.set(this,0),mr.set(this,!1),Ce(this,Ea,e,"f")}startCharging(){b(this,mr,"f")||(t._onLog&&t._onLog("start charging."),b(this,Ps,"m",_p).call(this),Ce(this,mr,!0,"f"))}stopCharging(){b(this,Mi,"f")&&clearTimeout(b(this,Mi,"f")),b(this,mr,"f")&&(t._onLog&&t._onLog("stop charging."),Ce(this,wr,Date.now()-b(this,Ca,"f"),"f"),Ce(this,mr,!1,"f"))}};Ea=new WeakMap,wr=new WeakMap,Mi=new WeakMap,Ca=new WeakMap,mr=new WeakMap,Ps=new WeakSet,rp=function(){Je.cfd(1),Dr._onLog&&Dr._onLog("charge 1.")},_p=function t(){b(this,wr,"f")==0&&b(this,Ps,"m",rp).call(this),Ce(this,Ca,Date.now(),"f"),b(this,Mi,"f")&&clearTimeout(b(this,Mi,"f")),Ce(this,Mi,setTimeout(()=>{Ce(this,wr,0,"f"),b(this,Ps,"m",t).call(this)},b(this,Ea,"f")-b(this,wr,"f")),"f")};var sp=new Map([[Ie.IPF_GRAYSCALED,Ne.GREY],[Ie.IPF_ABGR_8888,Ne.RGBA],[Ie.IPF_ARGB_8888,Ne.BGRA]]),op=new Map([[Ne.GREY,Ie.IPF_GRAYSCALED],[Ne.RGBA,Ie.IPF_ABGR_8888],[Ne.BGRA,Ie.IPF_ARGB_8888]]),au=typeof BigInt=="function"?{BF_NULL:BigInt(0),BF_ALL:BigInt(18446744073709552e3),BF_DEFAULT:BigInt(4265345023),BF_ONED:BigInt(3147775),BF_GS1_DATABAR:BigInt(260096),BF_CODE_39:BigInt(1),BF_CODE_128:BigInt(2),BF_CODE_93:BigInt(4),BF_CODABAR:BigInt(8),BF_ITF:BigInt(16),BF_EAN_13:BigInt(32),BF_EAN_8:BigInt(64),BF_UPC_A:BigInt(128),BF_UPC_E:BigInt(256),BF_INDUSTRIAL_25:BigInt(512),BF_CODE_39_EXTENDED:BigInt(1024),BF_GS1_DATABAR_OMNIDIRECTIONAL:BigInt(2048),BF_GS1_DATABAR_TRUNCATED:BigInt(4096),BF_GS1_DATABAR_STACKED:BigInt(8192),BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:BigInt(16384),BF_GS1_DATABAR_EXPANDED:BigInt(32768),BF_GS1_DATABAR_EXPANDED_STACKED:BigInt(65536),BF_GS1_DATABAR_LIMITED:BigInt(131072),BF_PATCHCODE:BigInt(262144),BF_CODE_32:BigInt(16777216),BF_PDF417:BigInt(33554432),BF_QR_CODE:BigInt(67108864),BF_DATAMATRIX:BigInt(134217728),BF_AZTEC:BigInt(268435456),BF_MAXICODE:BigInt(536870912),BF_MICRO_QR:BigInt(1073741824),BF_MICRO_PDF417:BigInt(524288),BF_GS1_COMPOSITE:BigInt(2147483648),BF_MSI_CODE:BigInt(1048576),BF_CODE_11:BigInt(2097152),BF_TWO_DIGIT_ADD_ON:BigInt(4194304),BF_FIVE_DIGIT_ADD_ON:BigInt(8388608),BF_MATRIX_25:BigInt(68719476736),BF_POSTALCODE:BigInt(0x3f0000000000000),BF_NONSTANDARD_BARCODE:BigInt(4294967296),BF_USPSINTELLIGENTMAIL:BigInt(4503599627370496),BF_POSTNET:BigInt(9007199254740992),BF_PLANET:BigInt(0x40000000000000),BF_AUSTRALIANPOST:BigInt(0x80000000000000),BF_RM4SCC:BigInt(72057594037927940),BF_KIX:BigInt(0x200000000000000),BF_DOTCODE:BigInt(8589934592),BF_PHARMACODE_ONE_TRACK:BigInt(17179869184),BF_PHARMACODE_TWO_TRACK:BigInt(34359738368),BF_PHARMACODE:BigInt(51539607552)}:{BF_NULL:"0x00",BF_ALL:"0xFFFFFFFFFFFFFFFF",BF_DEFAULT:"0xFE3BFFFF",BF_ONED:"0x003007FF",BF_GS1_DATABAR:"0x0003F800",BF_CODE_39:"0x1",BF_CODE_128:"0x2",BF_CODE_93:"0x4",BF_CODABAR:"0x8",BF_ITF:"0x10",BF_EAN_13:"0x20",BF_EAN_8:"0x40",BF_UPC_A:"0x80",BF_UPC_E:"0x100",BF_INDUSTRIAL_25:"0x200",BF_CODE_39_EXTENDED:"0x400",BF_GS1_DATABAR_OMNIDIRECTIONAL:"0x800",BF_GS1_DATABAR_TRUNCATED:"0x1000",BF_GS1_DATABAR_STACKED:"0x2000",BF_GS1_DATABAR_STACKED_OMNIDIRECTIONAL:"0x4000",BF_GS1_DATABAR_EXPANDED:"0x8000",BF_GS1_DATABAR_EXPANDED_STACKED:"0x10000",BF_GS1_DATABAR_LIMITED:"0x20000",BF_PATCHCODE:"0x00040000",BF_CODE_32:"0x01000000",BF_PDF417:"0x02000000",BF_QR_CODE:"0x04000000",BF_DATAMATRIX:"0x08000000",BF_AZTEC:"0x10000000",BF_MAXICODE:"0x20000000",BF_MICRO_QR:"0x40000000",BF_MICRO_PDF417:"0x00080000",BF_GS1_COMPOSITE:"0x80000000",BF_MSI_CODE:"0x100000",BF_CODE_11:"0x200000",BF_TWO_DIGIT_ADD_ON:"0x400000",BF_FIVE_DIGIT_ADD_ON:"0x800000",BF_MATRIX_25:"0x1000000000",BF_POSTALCODE:"0x3F0000000000000",BF_NONSTANDARD_BARCODE:"0x100000000",BF_USPSINTELLIGENTMAIL:"0x10000000000000",BF_POSTNET:"0x20000000000000",BF_PLANET:"0x40000000000000",BF_AUSTRALIANPOST:"0x80000000000000",BF_RM4SCC:"0x100000000000000",BF_KIX:"0x200000000000000",BF_DOTCODE:"0x200000000",BF_PHARMACODE_ONE_TRACK:"0x400000000",BF_PHARMACODE_TWO_TRACK:"0x800000000",BF_PHARMACODE:"0xC00000000"},Mt=class t extends ir{static set _onLog(e){Ce(t,Tu,e,"f",Su),st._onLog=e,Dr._onLog=e}static get _onLog(){return b(t,Tu,"f",Su)}static detectEnvironment(){return z(this,null,function*(){return yield z(this,null,function*(){return{wasm:K0,worker:J0,getUserMedia:lp,camera:yield ew(),browser:ft.browser,version:ft.version,OS:ft.OS}})})}static testCameraAccess(){return z(this,null,function*(){let e=yield st.testCameraAccess();return e.ok?{ok:!0,message:"Successfully accessed the camera."}:e.errorName==="InsecureContext"?{ok:!1,message:"Insecure context."}:e.errorName==="OverconstrainedError"||e.errorName==="NotFoundError"?{ok:!1,message:"No camera detected."}:e.errorName==="NotAllowedError"?{ok:!1,message:"No permission to access camera."}:e.errorName==="AbortError"?{ok:!1,message:"Some problem occurred which prevented the device from being used."}:e.errorName==="NotReadableError"?{ok:!1,message:"A hardware error occurred."}:e.errorName==="SecurityError"?{ok:!1,message:"User media support is disabled."}:{ok:!1,message:e.errorMessage}})}static createInstance(e){return z(this,null,function*(){var n,i;if(e&&!(e instanceof pn))throw new TypeError("Invalid view.");if(!((n=tt.license)===null||n===void 0)&&n.LicenseManager){if(!(!((i=tt.license)===null||i===void 0)&&i.LicenseManager.bCallInitLicense))throw new Error("License is not set.");yield Je.loadWasm(["license"]),yield tt.license.dynamsoft()}let o=new t(e);return t.onWarning&&(location&&location.protocol==="file:"?setTimeout(()=>{t.onWarning&&t.onWarning({id:1,message:"The page is opened over file:// and Dynamsoft Camera Enhancer may not work properly. Please open the page via https://."})},0):window.isSecureContext!==!1&&navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||setTimeout(()=>{t.onWarning&&t.onWarning({id:2,message:"Dynamsoft Camera Enhancer may not work properly in a non-secure context. Please open the page via https://."})},0)),o})}get video(){return b(this,pe,"f").getVideoEl()}set videoSrc(e){if(!b(this,pe,"f"))throw new Error("Camera manager is null.");b(this,we,"f")&&(b(this,we,"f")._hideDefaultSelection=!0),b(this,pe,"f").videoSrc=e}get videoSrc(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.videoSrc}set ifSaveLastUsedCamera(e){if(!b(this,pe,"f"))throw new Error("Camera manager is null.");b(this,pe,"f").ifSaveLastUsedCamera=e}get ifSaveLastUsedCamera(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.ifSaveLastUsedCamera}set ifSkipCameraInspection(e){if(!b(this,pe,"f"))throw new Error("Camera manager is null.");b(this,pe,"f").ifSkipCameraInspection=e}get ifSkipCameraInspection(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.ifSkipCameraInspection}set cameraOpenTimeout(e){if(!b(this,pe,"f"))throw new Error("Camera manager is null.");b(this,pe,"f").cameraOpenTimeout=e}get cameraOpenTimeout(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.cameraOpenTimeout}set singleFrameMode(e){if(!["disabled","image","camera"].includes(e))throw new Error("Invalid value.");if(this.isOpen())throw new Error("It is not allowed to change `singleFrameMode` when the camera is open.");Ce(this,ca,e,"f")}get singleFrameMode(){return b(this,ca,"f")}get _isFetchingStarted(){return b(this,Ln,"f")}get disposed(){return b(this,xu,"f")}constructor(e){if(super(),Fe.add(this),pe.set(this,void 0),we.set(this,void 0),Rs.set(this,"closed"),On.set(this,void 0),Si.set(this,!1),ca.set(this,void 0),this._onCameraSelChange=()=>z(this,null,function*(){this.isOpen()&&b(this,we,"f")&&!b(this,we,"f").disposed&&(yield this.selectCamera(b(this,we,"f")._selCam.value))}),this._onResolutionSelChange=()=>z(this,null,function*(){if(!this.isOpen()||!b(this,we,"f")||b(this,we,"f").disposed)return;let n,i;if(b(this,we,"f")._selRsl&&b(this,we,"f")._selRsl.selectedIndex!=-1){let o=b(this,we,"f")._selRsl.options[b(this,we,"f")._selRsl.selectedIndex];n=parseInt(o.getAttribute("data-width")),i=parseInt(o.getAttribute("data-height"))}yield this.setResolution({width:n,height:i})}),this._onCloseBtnClick=()=>z(this,null,function*(){this.isOpen()&&b(this,we,"f")&&!b(this,we,"f").disposed&&this.close()}),ua.set(this,(n,i,o,h)=>{let p=Date.now(),v={sx:h.x,sy:h.y,sWidth:h.width,sHeight:h.height,dWidth:h.width,dHeight:h.height},w=Math.max(v.dWidth,v.dHeight);if(this.canvasSizeLimit&&w>this.canvasSizeLimit){let x=this.canvasSizeLimit/w;v.dWidth>v.dHeight?(v.dWidth=this.canvasSizeLimit,v.dHeight=Math.round(v.dHeight*x)):(v.dWidth=Math.round(v.dWidth*x),v.dHeight=this.canvasSizeLimit)}let I=b(this,pe,"f").imageDataGetter.getImageData(n,i,o,v,{pixelFormat:sp.get(this.getPixelFormat())}),S=null;if(I){let x=Date.now(),M;I.pixelFormat===Ne.GREY?M=I.width:M=4*I.width;let R=!0;v.sx===0&&v.sy===0&&v.sWidth===i&&v.sHeight===o&&(R=!1),S={bytes:I.data,width:I.width,height:I.height,stride:M,format:op.get(I.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:cs.ITT_FILE_IMAGE,isCropped:R,cropRegion:{left:h.x,top:h.y,right:h.x+h.width,bottom:h.y+h.height,isMeasuredInPercentage:!1},originalWidth:i,originalHeight:o,currentWidth:I.width,currentHeight:I.height,timeSpent:x-p,timeStamp:x},toCanvas:b(this,ha,"f"),isDCEFrame:!0}}return S}),this._onSingleFrameAcquired=n=>{let i;i=b(this,we,"f")?b(this,we,"f").getConvertedRegion():Ir.convert(b(this,xi,"f"),n.width,n.height),i||(i={x:0,y:0,width:n.width,height:n.height});let o=b(this,ua,"f").call(this,n,n.width,n.height,i);b(this,On,"f").fire("singleFrameAcquired",[o],{async:!1,copy:!1})},ha.set(this,function(){if(!(this.bytes instanceof Uint8Array||this.bytes instanceof Uint8ClampedArray))throw new TypeError("Invalid bytes.");if(typeof this.width!="number"||this.width<=0)throw new Error("Invalid width.");if(typeof this.height!="number"||this.height<=0)throw new Error("Invalid height.");let n=document.createElement("canvas"),i;if(n.width=this.width,n.height=this.height,this.format===Ie.IPF_GRAYSCALED){i=new Uint8ClampedArray(this.width*this.height*4);for(let o=0;o<i.length;o+=4)i[o]=this.bytes[o/4],i[o+1]=this.bytes[o/4],i[o+2]=this.bytes[o/4],i[o+3]=255}else i=new Uint8ClampedArray(this.bytes.buffer);return n.getContext("2d").putImageData(new ImageData(i,this.width,this.height),0,0),n}),ks.set(this,void 0),xi.set(this,void 0),da.set(this,Ie.IPF_ABGR_8888),Ln.set(this,!1),this._imageId=-1,Ot.set(this,void 0),this.fetchInterval=0,et.set(this,{enhancedFocus:!1,autoZoom:!1,tapToFocus:!1}),ve.set(this,{minValue:1,maxValue:999,autoFocusFrameArray:[],autoFocusFrameLimit:[5,3],autoZoomDetectionArea:.5,autoZoomTargetBorder:.9,autoZoomIdealArea:[0,.05],autoZoomInFrameArray:[],autoZoomInFrameLimit:[5,3],autoZoomInMaxTimes:5,autoZoomInMinStep:Math.pow(10,.2),autoZoomInIdealModuleSize:6,autoZoomOutFrameCount:0,autoZoomOutFrameLimit:3,autoZoomOutStepRate:1/3,autoZoomOutStepRate_2:.05,autoZoomOutMinStep:2,frameArrayInIdealZoom:[],frameLimitInIdealZoom:[5,3]}),dn.set(this,void 0),xu.set(this,!1),this.isCameraEnhancer=!0,e&&!(e instanceof pn))throw new TypeError("Invalid view.");Ce(this,On,new va,"f"),Ce(this,pe,new st,"f"),this._imageDataGetter=b(this,pe,"f").imageDataGetter,b(this,pe,"f").updateVideoElWhenSoftwareScaled=()=>{if(!this.video)return;let n=b(this,pe,"f").getSoftwareScale();if(n<1)throw new RangeError("Invalid scale value.");b(this,we,"f")&&!b(this,we,"f").disposed?(this.video.style.transform=n===1?"":`scale(${n})`,b(this,we,"f")._updateVideoContainer()):this.video.style.transform=n===1?"":`scale(${n})`},["iPhone","iPad","Android","HarmonyOS"].includes(ft.OS)?b(this,pe,"f").setResolution(1280,720):b(this,pe,"f").setResolution(1920,1080),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?this.singleFrameMode="disabled":this.singleFrameMode="image",e&&this.setCameraView(e),this._on("before:camera:change",()=>{b(this,dn,"f").stopCharging();let n=b(this,we,"f");n&&!n.disposed&&(n._startLoading(),n.clearAllInnerDrawingItems())}),this._on("camera:changed",()=>{this.clearBuffer()}),this._on("before:resolution:change",()=>{let n=b(this,we,"f");n&&!n.disposed&&(n._startLoading(),n.clearAllInnerDrawingItems())}),this._on("resolution:changed",()=>{this.clearBuffer(),e.eventHandler.fire("content:updated",null,{async:!1})}),this._on("paused",()=>{b(this,dn,"f").stopCharging();let n=b(this,we,"f");n&&n.disposed}),this._on("resumed",()=>{let n=b(this,we,"f");n&&n.disposed}),this._on("tapfocus",()=>{b(this,et,"f").tapToFocus&&b(this,dn,"f").startCharging()}),this._intermediateResultReceiver={},this._intermediateResultReceiver.onTaskResultsReceived=(n,i)=>z(this,null,function*(){var o,h,p,v;if(b(this,Fe,"m",$e).call(this)||!this.isOpen()||this.isPaused())return;let w=n.intermediateResultUnits;t._onLog&&(t._onLog("intermediateResultUnits:"),t._onLog(w));let I=!1,S=!1;for(let x of w){if(x.unitType===$n.IRUT_DECODED_BARCODES&&x.decodedBarcodes.length){I=!0;break}x.unitType===$n.IRUT_LOCALIZED_BARCODES&&x.localizedBarcodes.length&&(S=!0)}if(t._onLog&&(t._onLog("hasLocalizedBarcodes:"),t._onLog(S)),b(this,et,"f").autoZoom||b(this,et,"f").enhancedFocus)if(I)b(this,ve,"f").autoZoomInFrameArray.length=0,b(this,ve,"f").autoZoomOutFrameCount=0,b(this,ve,"f").frameArrayInIdealZoom.length=0,b(this,ve,"f").autoFocusFrameArray.length=0;else{let x=R=>z(this,null,function*(){yield this.setZoom(R),b(this,et,"f").autoZoom&&b(this,dn,"f").startCharging()}),M=R=>z(this,null,function*(){yield this.setFocus(R),b(this,et,"f").enhancedFocus&&b(this,dn,"f").startCharging()});if(S){let R=w[0].originalImageTag,O=((o=R.cropRegion)===null||o===void 0?void 0:o.left)||0,B=((h=R.cropRegion)===null||h===void 0?void 0:h.top)||0,V=!((p=R.cropRegion)===null||p===void 0)&&p.right?R.cropRegion.right-O:R.originalWidth,H=!((v=R.cropRegion)===null||v===void 0)&&v.bottom?R.cropRegion.bottom-B:R.originalHeight,Y=R.currentWidth,Z=R.currentHeight,he;{let ce,ye,be,_,ue;{let c=this.video.videoWidth*(1-b(this,ve,"f").autoZoomDetectionArea)/2,a=this.video.videoWidth*(1+b(this,ve,"f").autoZoomDetectionArea)/2,l=a,d=c,r=this.video.videoHeight*(1-b(this,ve,"f").autoZoomDetectionArea)/2,s=r,u=this.video.videoHeight*(1+b(this,ve,"f").autoZoomDetectionArea)/2;ue=[{x:c,y:r},{x:a,y:s},{x:l,y:u},{x:d,y:u}]}t._onLog&&(t._onLog("detectionArea:"),t._onLog(ue));let Ee=[];{let c=(a,l)=>{let d=(s,u)=>{if(!s&&!u)throw new Error("Invalid arguments.");return function(m,f,g){let y=!1,E=m.length;if(E<=2)return!1;for(let C=0;C<E;C++){let T=m[C],D=m[(C+1)%E];if(iw(T,D,{x:f,y:g}))return!0;nu(T.y-g)>0!=nu(D.y-g)>0&&nu(f-(g-T.y)*(T.x-D.x)/(T.y-D.y)-T.x)<0&&(y=!y)}return y}(u,s.x,s.y)},r=(s,u)=>!!(Ho([s[0],s[1]],[s[2],s[3]],[u[0].x,u[0].y],[u[1].x,u[1].y])||Ho([s[0],s[1]],[s[2],s[3]],[u[1].x,u[1].y],[u[2].x,u[2].y])||Ho([s[0],s[1]],[s[2],s[3]],[u[2].x,u[2].y],[u[3].x,u[3].y])||Ho([s[0],s[1]],[s[2],s[3]],[u[3].x,u[3].y],[u[0].x,u[0].y]));return!!(d({x:a[0].x,y:a[0].y},l)||d({x:a[1].x,y:a[1].y},l)||d({x:a[2].x,y:a[2].y},l)||d({x:a[3].x,y:a[3].y},l))||!!(d({x:l[0].x,y:l[0].y},a)||d({x:l[1].x,y:l[1].y},a)||d({x:l[2].x,y:l[2].y},a)||d({x:l[3].x,y:l[3].y},a))||!!(r([l[0].x,l[0].y,l[1].x,l[1].y],a)||r([l[1].x,l[1].y,l[2].x,l[2].y],a)||r([l[2].x,l[2].y,l[3].x,l[3].y],a)||r([l[3].x,l[3].y,l[0].x,l[0].y],a))};for(let a of w)if(a.unitType===$n.IRUT_LOCALIZED_BARCODES)for(let l of a.localizedBarcodes){if(!l)continue;let d=l.location.points;d.forEach(r=>{pn._transformCoordinates(r,O,B,V,H,Y,Z)}),c(ue,d)&&Ee.push(l)}if(t._debug&&b(this,we,"f")){let a=this.__layer||(this.__layer=b(this,we,"f")._createDrawingLayer(99));a.clearDrawingItems();let l=this.__styleId2||(this.__styleId2=le.createDrawingStyle({strokeStyle:"red"}));for(let d of w)if(d.unitType===$n.IRUT_LOCALIZED_BARCODES)for(let r of d.localizedBarcodes){if(!r)continue;let s=r.location.points,u=new Bs({points:s},l);a.addDrawingItems([u])}}}if(t._onLog&&(t._onLog("intersectedResults:"),t._onLog(Ee)),!Ee.length)return;let de;if(Ee.length){let c=Ee.filter(a=>a.possibleFormats==au.BF_QR_CODE||a.possibleFormats==au.BF_DATAMATRIX);if(c.length||(c=Ee.filter(a=>a.possibleFormats==au.BF_ONED),c.length||(c=Ee)),c.length){let a=d=>{let r=d.location.points,s=(r[0].x+r[1].x+r[2].x+r[3].x)/4,u=(r[0].y+r[1].y+r[2].y+r[3].y)/4;return(s-Y/2)*(s-Y/2)+(u-Z/2)*(u-Z/2)};de=c[0];let l=a(de);if(c.length!=1)for(let d=1;d<c.length;d++){let r=a(c[d]);(c[d].confidence>1.1*de.confidence||c[d].confidence>.9*de.confidence&&r<l)&&(de=c[d],l=r)}}}if(t._onLog&&(t._onLog("highPriorityResult:"),t._onLog(de)),de){let c=de.location.points;ce=Math.min(c[0].x,c[1].x,c[2].x,c[3].x),ye=Math.max(c[0].x,c[1].x,c[2].x,c[3].x),be=Math.min(c[0].y,c[1].y,c[2].y,c[3].y),_=Math.max(c[0].y,c[1].y,c[2].y,c[3].y),he={points:[{x:ce,y:be},{x:ye,y:be},{x:ye,y:_},{x:ce,y:_}],result:de}}}if(t._onLog&&(t._onLog("boundingRect:"),t._onLog(he)),!he)return;if(t._debug&&b(this,we,"f")&&he?.points){let ce=this.__layer||(this.__layer=b(this,we,"f")._createDrawingLayer(99)),ye=this.__styleId1||(this.__styleId1=le.createDrawingStyle({strokeStyle:"blue"})),be=new Bs({points:he.points},ye);ce.addDrawingItems([be])}if(b(this,ve,"f").autoZoomOutFrameCount=0,b(this,et,"f").autoZoom){let ce=b(this,ve,"f").autoZoomIdealArea[1],ye=(1-b(this,ve,"f").autoZoomTargetBorder)/2,be=he.points[0].x/V,_=(V-he.points[2].x)/V,ue=he.points[0].y/H,Ee=(H-he.points[2].y)/H;if(be>ce&&_>ce&&ue>ce&&Ee>ce&&he.result.moduleSize<b(this,ve,"f").autoZoomInIdealModuleSize){if(b(this,ve,"f").autoZoomInFrameArray.push(!0),b(this,ve,"f").autoZoomInFrameArray.splice(0,b(this,ve,"f").autoZoomInFrameArray.length-b(this,ve,"f").autoZoomInFrameLimit[0]),b(this,ve,"f").frameArrayInIdealZoom.length=0,b(this,et,"f").enhancedFocus&&M({mode:"continuous"}).catch(()=>{}),b(this,ve,"f").autoZoomInFrameArray.filter(de=>de===!0).length>=b(this,ve,"f").autoZoomInFrameLimit[1]){b(this,ve,"f").autoZoomInFrameArray.length=0;let de=[(.5-ye)/(.5-be),(.5-ye)/(.5-_),(.5-ye)/(.5-ue),(.5-ye)/(.5-Ee)].filter(r=>r>0),c=Math.min(...de,b(this,ve,"f").autoZoomInIdealModuleSize/he.result.moduleSize),a=this.getZoomSettings().factor,l=Math.max(Math.pow(a*c,1/b(this,ve,"f").autoZoomInMaxTimes),b(this,ve,"f").autoZoomInMinStep);l=Math.min(l,c);let d=a*l;d=Math.max(b(this,ve,"f").minValue,d),d=Math.min(b(this,ve,"f").maxValue,d);try{yield x({factor:d})}catch(r){let s=r.message||r;console.warn(s)}this.clearBuffer()}}else if(b(this,ve,"f").autoZoomInFrameArray.length=0,b(this,ve,"f").frameArrayInIdealZoom.push(!0),b(this,ve,"f").frameArrayInIdealZoom.splice(0,b(this,ve,"f").frameArrayInIdealZoom.length-b(this,ve,"f").frameLimitInIdealZoom[0]),b(this,ve,"f").frameArrayInIdealZoom.filter(de=>de===!0).length>=b(this,ve,"f").frameLimitInIdealZoom[1]&&(b(this,ve,"f").frameArrayInIdealZoom.length=0,b(this,et,"f").enhancedFocus)){let de=he.points;try{yield M({mode:"manual",area:{centerPoint:{x:(de[0].x+de[2].x)/2+"px",y:(de[0].y+de[2].y)/2+"px"},width:de[2].x-de[0].x+"px",height:de[2].y-de[0].y+"px"}})}catch(c){let a=c.message||c;console.warn(a)}this.clearBuffer()}}if(!b(this,et,"f").autoZoom&&b(this,et,"f").enhancedFocus&&(b(this,ve,"f").autoFocusFrameArray.push(!0),b(this,ve,"f").autoFocusFrameArray.splice(0,b(this,ve,"f").autoFocusFrameArray.length-b(this,ve,"f").autoFocusFrameLimit[0]),b(this,ve,"f").autoFocusFrameArray.filter(ce=>ce===!0).length>=b(this,ve,"f").autoFocusFrameLimit[1])){b(this,ve,"f").autoFocusFrameArray.length=0;try{let ce=he.points;yield M({mode:"manual",area:{centerPoint:{x:(ce[0].x+ce[2].x)/2+"px",y:(ce[0].y+ce[2].y)/2+"px"},width:ce[2].x-ce[0].x+"px",height:ce[2].y-ce[0].y+"px"}})}catch(ce){let ye=ce.message||ce;console.warn(ye)}this.clearBuffer()}}else{if(b(this,et,"f").autoZoom){if(b(this,ve,"f").autoZoomInFrameArray.push(!1),b(this,ve,"f").autoZoomInFrameArray.splice(0,b(this,ve,"f").autoZoomInFrameArray.length-b(this,ve,"f").autoZoomInFrameLimit[0]),b(this,ve,"f").autoZoomOutFrameCount++,b(this,ve,"f").frameArrayInIdealZoom.push(!1),b(this,ve,"f").frameArrayInIdealZoom.splice(0,b(this,ve,"f").frameArrayInIdealZoom.length-b(this,ve,"f").frameLimitInIdealZoom[0]),b(this,ve,"f").autoZoomOutFrameCount>=b(this,ve,"f").autoZoomOutFrameLimit){b(this,ve,"f").autoZoomOutFrameCount=0;let R=this.getZoomSettings().factor,O=R-Math.max((R-1)*b(this,ve,"f").autoZoomOutStepRate,b(this,ve,"f").autoZoomOutMinStep);O=Math.max(b(this,ve,"f").minValue,O),O=Math.min(b(this,ve,"f").maxValue,O);try{yield x({factor:O})}catch(B){let V=B.message||B;console.warn(V)}this.clearBuffer()}b(this,et,"f").enhancedFocus&&M({mode:"continuous"}).catch(()=>{})}!b(this,et,"f").autoZoom&&b(this,et,"f").enhancedFocus&&(b(this,ve,"f").autoFocusFrameArray.length=0,M({mode:"continuous"}).catch(()=>{}))}}}),Ce(this,dn,new Dr(1e4),"f")}setCameraView(e){if(!(e instanceof pn))throw new TypeError("Invalid view.");if(e.disposed)throw new Error("The camera view has been disposed.");if(this.isOpen())throw new Error("It is not allowed to change camera view when the camera is open.");this.releaseCameraView(),e._singleFrameMode=this.singleFrameMode,e._onSingleFrameAcquired=this._onSingleFrameAcquired,this.videoSrc&&(b(this,we,"f")._hideDefaultSelection=!0),b(this,Fe,"m",$e).call(this)||b(this,pe,"f").setVideoEl(e.getVideoElement()),Ce(this,we,e,"f"),this.addListenerToView()}getCameraView(){return b(this,we,"f")}releaseCameraView(){b(this,we,"f")&&(this.removeListenerFromView(),b(this,we,"f").disposed||(b(this,we,"f")._singleFrameMode="disabled",b(this,we,"f")._onSingleFrameAcquired=null,b(this,we,"f")._hideDefaultSelection=!1),b(this,pe,"f").releaseVideoEl(),Ce(this,we,null,"f"))}addListenerToView(){if(!b(this,we,"f"))return;if(b(this,we,"f").disposed)throw new Error("'cameraView' has been disposed.");let e=b(this,we,"f");b(this,Fe,"m",$e).call(this)||this.videoSrc||(e._innerComponent&&(b(this,pe,"f").tapFocusEventBoundEl=e._innerComponent),e._selCam&&e._selCam.addEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.addEventListener("change",this._onResolutionSelChange)),e._btnClose&&e._btnClose.addEventListener("click",this._onCloseBtnClick)}removeListenerFromView(){if(!b(this,we,"f")||b(this,we,"f").disposed)return;let e=b(this,we,"f");b(this,pe,"f").tapFocusEventBoundEl=null,e._selCam&&e._selCam.removeEventListener("change",this._onCameraSelChange),e._selRsl&&e._selRsl.removeEventListener("change",this._onResolutionSelChange),e._btnClose&&e._btnClose.removeEventListener("click",this._onCloseBtnClick)}getCameraState(){return b(this,Fe,"m",$e).call(this)?b(this,Rs,"f"):new Map([["closed","closed"],["opening","opening"],["opened","open"]]).get(b(this,pe,"f").state)}isOpen(){return this.getCameraState()==="open"}getVideoEl(){return this.video}open(){return z(this,null,function*(){let e=b(this,we,"f");if(e?.disposed)throw new Error("'cameraView' has been disposed.");e&&(e._singleFrameMode=this.singleFrameMode,b(this,Fe,"m",$e).call(this)?e._clickIptSingleFrameMode():(b(this,pe,"f").setVideoEl(e.getVideoElement()),e._startLoading()));let n={width:0,height:0,deviceId:""};if(!b(this,Fe,"m",$e).call(this)){try{yield b(this,pe,"f").open()}catch(o){throw e&&e._stopLoading(),o}b(this,Si,"f")&&this.turnOnTorch().catch(()=>{});let i=this.getResolution();n.width=i.width,n.height=i.height,n.deviceId=this.getSelectedCamera().deviceId}return Ce(this,Rs,"open","f"),e&&(e._innerComponent.style.display="",b(this,Fe,"m",$e).call(this)||(e._stopLoading(),e._renderCamerasInfo(this.getSelectedCamera(),b(this,pe,"f")._arrCameras),e._renderResolutionInfo({width:n.width,height:n.height}),e.eventHandler.fire("content:updated",null,{async:!1}),e.eventHandler.fire("videoEl:resized",null,{async:!1}))),b(this,On,"f").fire("opened",null,{target:this,async:!1}),n})}close(){let e=b(this,we,"f");if(e?.disposed)throw new Error("'cameraView' has been disposed.");this.stopFetching(),this.clearBuffer(),b(this,Fe,"m",$e).call(this)||b(this,pe,"f").close(),Ce(this,Rs,"closed","f"),b(this,dn,"f").stopCharging(),e&&(e._innerComponent.style.display="none",b(this,Fe,"m",$e).call(this)&&e._innerComponent.removeElement("content"),e._stopLoading()),b(this,On,"f").fire("closed",null,{target:this,async:!1})}pause(){if(b(this,Fe,"m",$e).call(this))throw new Error("'pause()' is invalid in 'singleFrameMode'.");b(this,pe,"f").pause()}isPaused(){var e;return!b(this,Fe,"m",$e).call(this)&&((e=this.video)===null||e===void 0?void 0:e.paused)===!0}resume(){return z(this,null,function*(){if(b(this,Fe,"m",$e).call(this))throw new Error("'resume()' is invalid in 'singleFrameMode'.");yield b(this,pe,"f").resume()})}selectCamera(e){return z(this,null,function*(){if(!e)throw new Error("Invalid value.");let n;n=typeof e=="string"?e:e.deviceId,yield b(this,pe,"f").setCamera(n),Ce(this,Si,!1,"f");let i=this.getResolution(),o=b(this,we,"f");return o&&!o.disposed&&(o._stopLoading(),o._renderCamerasInfo(this.getSelectedCamera(),b(this,pe,"f")._arrCameras),o._renderResolutionInfo({width:i.width,height:i.height})),{width:i.width,height:i.height,deviceId:this.getSelectedCamera().deviceId}})}getSelectedCamera(){return b(this,pe,"f").getCamera()}getAllCameras(){return z(this,null,function*(){return b(this,pe,"f").getCameras()})}setResolution(e){return z(this,null,function*(){yield b(this,pe,"f").setResolution(e.width,e.height),b(this,Si,"f")&&this.turnOnTorch().catch(()=>{});let n=this.getResolution(),i=b(this,we,"f");return i&&!i.disposed&&(i._stopLoading(),i._renderResolutionInfo({width:n.width,height:n.height})),{width:n.width,height:n.height,deviceId:this.getSelectedCamera().deviceId}})}getResolution(){return b(this,pe,"f").getResolution()}getAvailableResolutions(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.getResolutions()}_on(e,n){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?b(this,On,"f").on(e,n):b(this,pe,"f").on(e,n)}_off(e,n){["opened","closed","singleframeacquired","frameaddedtobuffer"].includes(e.toLowerCase())?b(this,On,"f").off(e,n):b(this,pe,"f").off(e,n)}on(e,n){let i=e.toLowerCase(),o=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!o)throw new Error("Invalid event.");this._on(o,n)}off(e,n){let i=e.toLowerCase(),o=new Map([["cameraopen","opened"],["cameraclose","closed"],["camerachange","camera:changed"],["resolutionchange","resolution:changed"],["played","played"],["singleframeacquired","singleFrameAcquired"],["frameaddedtobuffer","frameAddedToBuffer"]]).get(i);if(!o)throw new Error("Invalid event.");this._off(o,n)}getVideoSettings(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.getMediaStreamConstraints()}updateVideoSettings(e){return z(this,null,function*(){var n;yield(n=b(this,pe,"f"))===null||n===void 0?void 0:n.setMediaStreamConstraints(e,!0)})}getCapabilities(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.getCameraCapabilities()}getCameraSettings(){return b(this,pe,"f").getCameraSettings()}turnOnTorch(){return z(this,null,function*(){var e;if(b(this,Fe,"m",$e).call(this))throw new Error("'turnOnTorch()' is invalid in 'singleFrameMode'.");yield(e=b(this,pe,"f"))===null||e===void 0?void 0:e.turnOnTorch(),Ce(this,Si,!0,"f")})}turnOffTorch(){return z(this,null,function*(){var e;if(b(this,Fe,"m",$e).call(this))throw new Error("'turnOffTorch()' is invalid in 'singleFrameMode'.");yield(e=b(this,pe,"f"))===null||e===void 0?void 0:e.turnOffTorch(),Ce(this,Si,!1,"f")})}setColorTemperature(e){return z(this,null,function*(){if(b(this,Fe,"m",$e).call(this))throw new Error("'setColorTemperature()' is invalid in 'singleFrameMode'.");yield b(this,pe,"f").setColorTemperature(e,!0)})}getColorTemperature(){return b(this,pe,"f").getColorTemperature()}setExposureCompensation(e){return z(this,null,function*(){var n;if(b(this,Fe,"m",$e).call(this))throw new Error("'setExposureCompensation()' is invalid in 'singleFrameMode'.");yield(n=b(this,pe,"f"))===null||n===void 0?void 0:n.setExposureCompensation(e,!0)})}getExposureCompensation(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.getExposureCompensation()}_setZoom(e){return z(this,null,function*(){var n;if(b(this,Fe,"m",$e).call(this))throw new Error("'setZoom()' is invalid in 'singleFrameMode'.");yield(n=b(this,pe,"f"))===null||n===void 0?void 0:n.setZoom(e)})}setZoom(e){return z(this,null,function*(){yield this._setZoom(e)})}getZoomSettings(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.getZoom()}resetZoom(){return z(this,null,function*(){var e;if(b(this,Fe,"m",$e).call(this))throw new Error("'resetZoom()' is invalid in 'singleFrameMode'.");yield(e=b(this,pe,"f"))===null||e===void 0?void 0:e.resetZoom()})}setFrameRate(e){return z(this,null,function*(){var n;if(b(this,Fe,"m",$e).call(this))throw new Error("'setFrameRate()' is invalid in 'singleFrameMode'.");yield(n=b(this,pe,"f"))===null||n===void 0?void 0:n.setFrameRate(e,!0)})}getFrameRate(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.getFrameRate()}setFocus(e){return z(this,null,function*(){var n;if(b(this,Fe,"m",$e).call(this))throw new Error("'setFocus()' is invalid in 'singleFrameMode'.");yield(n=b(this,pe,"f"))===null||n===void 0?void 0:n.setFocus(e,!0)})}getFocusSettings(){var e;return(e=b(this,pe,"f"))===null||e===void 0?void 0:e.getFocus()}setAutoZoomRange(e){b(this,ve,"f").minValue=e.min,b(this,ve,"f").maxValue=e.max}getAutoZoomRange(){return{min:b(this,ve,"f").minValue,max:b(this,ve,"f").maxValue}}enableEnhancedFeatures(e){return z(this,null,function*(){var n,i;if(!(!((i=(n=tt.license)===null||n===void 0?void 0:n.LicenseManager)===null||i===void 0)&&i.bPassValidation))throw new Error("License is not verified, or license is invalid.");if(Je.bSupportDce4Module!==0)throw new Error("Please set a license containing the DCE module.");e&ii.EF_ENHANCED_FOCUS&&(b(this,et,"f").enhancedFocus=!0),e&ii.EF_AUTO_ZOOM&&(b(this,et,"f").autoZoom=!0),e&ii.EF_TAP_TO_FOCUS&&(b(this,et,"f").tapToFocus=!0,b(this,pe,"f").enableTapToFocus())})}disableEnhancedFeatures(e){e&ii.EF_ENHANCED_FOCUS&&(b(this,et,"f").enhancedFocus=!1,this.setFocus({mode:"continuous"}).catch(()=>{})),e&ii.EF_AUTO_ZOOM&&(b(this,et,"f").autoZoom=!1,this.resetZoom().catch(()=>{})),e&ii.EF_TAP_TO_FOCUS&&(b(this,et,"f").tapToFocus=!1,b(this,pe,"f").disableTapToFocus()),b(this,Fe,"m",Ep).call(this)&&b(this,Fe,"m",wp).call(this)||b(this,dn,"f").stopCharging()}_setScanRegion(e){if(e!=null&&!Lu(e)&&!Ri(e))throw TypeError("Invalid 'region'.");Ce(this,xi,e?JSON.parse(JSON.stringify(e)):null,"f"),b(this,we,"f")&&!b(this,we,"f").disposed&&b(this,we,"f").setScanRegion(e)}setScanRegion(e){this._setScanRegion(e),b(this,we,"f")&&!b(this,we,"f").disposed&&(e===null?b(this,we,"f").setScanRegionMaskVisible(!1):b(this,we,"f").setScanRegionMaskVisible(!0))}getScanRegion(){return JSON.parse(JSON.stringify(b(this,xi,"f")))}setErrorListener(e){if(!e)throw new TypeError("Invalid 'listener'");Ce(this,ks,e,"f")}hasNextImageToFetch(){return!(this.getCameraState()!=="open"||!b(this,pe,"f").isVideoLoaded()||b(this,Fe,"m",$e).call(this))}startFetching(){if(b(this,Fe,"m",$e).call(this))throw Error("'startFetching()' is unavailable in 'singleFrameMode'.");b(this,Ln,"f")||(Ce(this,Ln,!0,"f"),b(this,Fe,"m",Au).call(this))}stopFetching(){b(this,Ln,"f")&&(t._onLog&&t._onLog("DCE: stop fetching loop: "+Date.now()),b(this,Ot,"f")&&clearTimeout(b(this,Ot,"f")),Ce(this,Ln,!1,"f"))}fetchImage(){if(b(this,Fe,"m",$e).call(this))throw new Error("'fetchImage()' is unavailable in 'singleFrameMode'.");if(!this.video)throw new Error("The video element does not exist.");if(this.video.readyState!==4)throw new Error("The video is not loaded.");let e=this.getResolution();if(!e?.width||!e?.height)throw new Error("The video is not loaded.");let n;if(n=Ir.convert(b(this,xi,"f"),e.width,e.height),n||(n={x:0,y:0,width:e.width,height:e.height}),n.x>e.width||n.y>e.height)throw new Error("Invalid scan region.");n.x+n.width>e.width&&(n.width=e.width-n.x),n.y+n.height>e.height&&(n.height=e.height-n.y);let i={sx:n.x,sy:n.y,sWidth:n.width,sHeight:n.height,dWidth:n.width,dHeight:n.height},o=Math.max(i.dWidth,i.dHeight);if(this.canvasSizeLimit&&o>this.canvasSizeLimit){let w=this.canvasSizeLimit/o;i.dWidth>i.dHeight?(i.dWidth=this.canvasSizeLimit,i.dHeight=Math.round(i.dHeight*w)):(i.dWidth=Math.round(i.dWidth*w),i.dHeight=this.canvasSizeLimit)}let h=b(this,pe,"f").getFrameData({position:i,pixelFormat:sp.get(this.getPixelFormat())});if(!h)return null;let p;h.pixelFormat===Ne.GREY?p=h.width:p=4*h.width;let v=!0;return i.sx===0&&i.sy===0&&i.sWidth===e.width&&i.sHeight===e.height&&(v=!1),{bytes:h.data,width:h.width,height:h.height,stride:p,format:op.get(h.pixelFormat),tag:{imageId:this._imageId==Number.MAX_VALUE?this._imageId=0:++this._imageId,type:cs.ITT_VIDEO_FRAME,isCropped:v,cropRegion:{left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height,isMeasuredInPercentage:!1},originalWidth:e.width,originalHeight:e.height,currentWidth:h.width,currentHeight:h.height,timeSpent:h.timeSpent,timeStamp:h.timeStamp},toCanvas:b(this,ha,"f"),isDCEFrame:!0}}setImageFetchInterval(e){this.fetchInterval=e,b(this,Ln,"f")&&(b(this,Ot,"f")&&clearTimeout(b(this,Ot,"f")),Ce(this,Ot,setTimeout(()=>{this.disposed||b(this,Fe,"m",Au).call(this)},e),"f"))}getImageFetchInterval(){return this.fetchInterval}setPixelFormat(e){Ce(this,da,e,"f")}getPixelFormat(){return b(this,da,"f")}takePhoto(e){if(!this.isOpen())throw new Error("Not open.");if(b(this,Fe,"m",$e).call(this))throw new Error("'takePhoto()' is unavailable in 'singleFrameMode'.");let n=document.createElement("input");n.setAttribute("type","file"),n.setAttribute("accept",".jpg,.jpeg,.icon,.gif,.svg,.webp,.png,.bmp"),n.setAttribute("capture",""),n.style.position="absolute",n.style.top="-9999px",n.style.backgroundColor="transparent",n.style.color="transparent",n.addEventListener("click",()=>{let i=this.isOpen();this.close(),window.addEventListener("focus",()=>{i&&this.open(),n.remove()},{once:!0})}),n.addEventListener("change",()=>z(this,null,function*(){let i=n.files[0],o=yield(I=>z(this,null,function*(){let S=null,x=null;if(typeof createImageBitmap<"u")try{if(S=yield createImageBitmap(I),S)return S}catch{}var M;return S||(x=yield(M=I,new Promise((R,O)=>{let B=URL.createObjectURL(M),V=new Image;V.src=B,V.onload=()=>{URL.revokeObjectURL(V.src),R(V)},V.onerror=H=>{O(new Error("Can't convert blob to image : "+(H instanceof Event?H.type:H)))}}))),x}))(i),h=o instanceof HTMLImageElement?o.naturalWidth:o.width,p=o instanceof HTMLImageElement?o.naturalHeight:o.height,v=Ir.convert(b(this,xi,"f"),h,p);v||(v={x:0,y:0,width:h,height:p});let w=b(this,ua,"f").call(this,o,h,p,v);e&&e(w)})),document.body.appendChild(n),n.click()}convertToPageCoordinates(e){let n=b(this,Fe,"m",Mu).call(this,e);return{x:n.pageX,y:n.pageY}}convertToClientCoordinates(e){let n=b(this,Fe,"m",Mu).call(this,e);return{x:n.clientX,y:n.clientY}}dispose(){this.close(),b(this,pe,"f").dispose(),this.releaseCameraView(),this.__proto__=null;for(let e in this)delete this[e];Object.defineProperty(this,"isCameraEnhancer",{value:!0}),Object.defineProperty(this,"disposed",{value:!0})}};function _t(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)}function en(t,e,n,i,o){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?o.call(t,n):o?o.value=n:e.set(t,n),n}Tu=Mt,pe=new WeakMap,we=new WeakMap,Rs=new WeakMap,On=new WeakMap,Si=new WeakMap,ca=new WeakMap,ua=new WeakMap,ha=new WeakMap,ks=new WeakMap,xi=new WeakMap,da=new WeakMap,Ln=new WeakMap,Ot=new WeakMap,et=new WeakMap,ve=new WeakMap,dn=new WeakMap,xu=new WeakMap,Fe=new WeakSet,$e=function(){return this.singleFrameMode!=="disabled"},wp=function(){return!this.videoSrc&&b(this,pe,"f").state==="opened"},Ep=function(){for(let t in b(this,et,"f"))if(b(this,et,"f")[t]==1)return!0;return!1},Au=function t(){if(this.disposed)return;if(this.getCameraState()!=="open"||!b(this,Ln,"f"))return b(this,Ot,"f")&&clearTimeout(b(this,Ot,"f")),void Ce(this,Ot,setTimeout(()=>{this.disposed||b(this,Fe,"m",t).call(this)},this.fetchInterval),"f");let e=()=>{var n;let i;Mt._onLog&&Mt._onLog("DCE: start fetching a frame into buffer: "+Date.now());try{i=this.fetchImage()}catch(o){let h=o.message||o;if(h==="The video is not loaded.")return;if(!((n=b(this,ks,"f"))===null||n===void 0)&&n.onErrorReceived)return void setTimeout(()=>{var p;(p=b(this,ks,"f"))===null||p===void 0||p.onErrorReceived(Fo.EC_IMAGE_READ_FAILED,h)},0);console.warn(o)}i?(this.addImageToBuffer(i),Mt._onLog&&Mt._onLog("DCE: finish fetching a frame into buffer: "+Date.now()),b(this,On,"f").fire("frameAddedToBuffer",null,{async:!1})):Mt._onLog&&Mt._onLog("DCE: get a invalid frame, abandon it: "+Date.now())};if(this.getImageCount()>=this.getMaxImageCount())switch(this.getBufferOverflowProtectionMode()){case zn.BOPM_BLOCK:break;case zn.BOPM_UPDATE:e()}else e();b(this,Ot,"f")&&clearTimeout(b(this,Ot,"f")),Ce(this,Ot,setTimeout(()=>{this.disposed||b(this,Fe,"m",t).call(this)},this.fetchInterval),"f")},Mu=function(t){if(!b(this,we,"f"))throw new Error("Camera view is not set.");if(b(this,we,"f").disposed)throw new Error("'cameraView' has been disposed.");if(!this.isOpen())throw new Error("Not open.");if(!b(this,Fe,"m",$e).call(this)&&!b(this,pe,"f").isVideoLoaded())throw new Error("Video is not loaded.");if(b(this,Fe,"m",$e).call(this)&&!b(this,we,"f")._cvsSingleFrameMode)throw new Error("No image is selected.");let e=b(this,we,"f")._innerComponent.getBoundingClientRect(),n=e.left,i=e.top,o=n+window.scrollX,h=i+window.scrollY,{width:p,height:v}=b(this,we,"f")._innerComponent.getBoundingClientRect();if(p<=0||v<=0)throw new Error("Unable to get content dimensions. Camera view may not be rendered on the page.");let w,I,S;if(b(this,Fe,"m",$e).call(this)){let Y=b(this,we,"f")._innerComponent.getElement("content");w=Y.width,I=Y.height,S="contain"}else{let Y=this.getVideoEl();w=Y.videoWidth,I=Y.videoHeight,S=b(this,we,"f").getVideoFit()}let x=p/v,M=w/I,R,O,B,V,H=1;if(S==="contain")x<M?(H=p/w,R=n+t.x*H,O=i+t.y*H+(v-I*H)/2,B=o+t.x*H,V=h+t.y*H+(v-I*H)/2):(H=v/I,R=n+t.x*H+(p-w*H)/2,O=i+t.y*H,B=o+t.x*H+(p-w*H)/2,V=h+t.y*H);else if(S==="cover")if(x<M){H=v/I;let Y=t.x*H-(w*H-p)/2;Y=Math.max(Y,0),Y=Math.min(Y,p),R=n+Y,O=i+t.y*H,B=o+Y,V=h+t.y*H}else{H=p/w;let Y=t.y*H-(I*H-v)/2;Y=Math.max(Y,0),Y=Math.min(Y,v),R=n+t.x*H,O=i+Y,B=o+t.x*H,V=h+Y}return{clientX:R,clientY:O,pageX:B,pageY:V}},Mt._debug=!1,Su={value:void 0},Mt.browserInfo=ft,typeof SuppressedError=="function"&&SuppressedError;var nn=class t{static multiply(e,n){let i=[];for(let o=0;o<3;o++){let h=n.slice(3*o,3*o+3);for(let p=0;p<3;p++){let v=[e[p],e[p+3],e[p+6]].reduce((w,I,S)=>w+I*h[S],0);i.push(v)}}return i}static identity(){return[1,0,0,0,1,0,0,0,1]}static translate(e,n,i){return t.multiply(e,[1,0,0,0,1,0,n,i,1])}static rotate(e,n){var i=Math.cos(n),o=Math.sin(n);return t.multiply(e,[i,-o,0,o,i,0,0,0,1])}static scale(e,n,i){return t.multiply(e,[n,0,0,0,i,0,0,0,1])}},qe,Mn,Rn,fa,vr,Os,Ls,yr,ga,aw,lw,cw,uw,hw,dw,fw,gw,pw,Bt,ap,Ru,Fs,Ns;(function(t){t.GREY="grey",t.GREY32="grey32",t.RGBA="rgba",t.RBGA="rbga",t.GRBA="grba",t.GBRA="gbra",t.BRGA="brga",t.BGRA="bgra"})(qe||(qe={}));var Ou=class t{static get version(){return"1.1.0"}static checkWebGLSupport(){return document.createElement("canvas").getContext("webgl")===null?(en(t,Mn,!1,"f",Rn),!1):(en(t,Mn,!0,"f",Rn),!0)}get disposed(){return _t(this,ga,"f")}constructor(){fa.set(this,qe.RGBA),vr.set(this,null),Os.set(this,null),Ls.set(this,null),this.useWebGLByDefault=!0,this._reusedCvs=null,this._reusedWebGLCvs=null,yr.set(this,null),ga.set(this,!1)}drawImage(e,n,i,o,h,p){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!i||!o)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(_t(t,Mn,"f",Rn)==null&&t.checkWebGLSupport(),p?.bUseWebGL&&!_t(t,Mn,"f",Rn))throw new Error("Your browser or machine may not support WebGL.");if(n instanceof HTMLVideoElement&&n.readyState!==4||n instanceof HTMLImageElement&&!n.complete)throw new Error("The source is not loaded.");let v;t._onLog&&(v=Date.now(),t._onLog("drawImage(), START: "+v));let w=0,I=0,S=i,x=o,M=0,R=0,O=i,B=o;h&&(h.sx&&(w=Math.round(h.sx)),h.sy&&(I=Math.round(h.sy)),h.sWidth&&(S=Math.round(h.sWidth)),h.sHeight&&(x=Math.round(h.sHeight)),h.dx&&(M=Math.round(h.dx)),h.dy&&(R=Math.round(h.dy)),h.dWidth&&(O=Math.round(h.dWidth)),h.dHeight&&(B=Math.round(h.dHeight)));let V,H=qe.RGBA;if(p?.pixelFormat&&(H=p.pixelFormat),p?.bufferContainer&&(V=p.bufferContainer,V.length<4*O*B))throw new Error("Unexpected size of the 'bufferContainer'.");let Y=e;if(!_t(t,Mn,"f",Rn)||!(this.useWebGLByDefault&&p?.bUseWebGL==null||p?.bUseWebGL)){t._onLog&&t._onLog("drawImage() in context2d."),Y.ctx2d||(Y.ctx2d=Y.getContext("2d",{willReadFrequently:!0}));let Z=Y.ctx2d;if(!Z)throw new Error("Unable to get 'CanvasRenderingContext2D' from canvas.");return(Y.width<M+O||Y.height<R+B)&&(Y.width=M+O,Y.height=R+B),Z.drawImage(n,w,I,S,x,M,R,O,B),t._onLog&&t._onLog("drawImage() in context2d end. Costs: "+(Date.now()-v)),{context:Z,pixelFormat:qe.RGBA,bUseWebGL:!1}}t._onLog&&t._onLog("drawImage() in WebGL.");try{(Y.width<M+O||Y.height<R+B)&&(Y.width=M+O,Y.height=R+B,Y.ctxWebGL&&Y.ctxWebGL.viewport(0,0,M+O,R+B));let Z=Y.ctxWebGL||Y.getContext("webgl",{antialias:!1})||Y.getContext("experimental-webgl",{antialias:!1});if(!Z){t._onLog&&t._onLog("Browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");let _=new Error("Unable to get 'WebGLRenderingContext'. Your browser or machine may not support WebGL, or the canvas has already been set to a different context mode.");throw _.name="WebGLError",_}if(!Y.ctxWebGL||H!==_t(this,fa,"f")){Y.ctxWebGL=Z;let _=r=>{let s=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,s),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),r.STATIC_DRAW);let u=r.createBuffer();return r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,0,0,1,1,1]),r.STATIC_DRAW),{positions:s,texCoords:u}},ue=r=>{let s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),s},Ee=(r,s)=>{let u=r.createProgram();if(s.forEach(m=>r.attachShader(u,m)),r.linkProgram(u),!r.getProgramParameter(u,r.LINK_STATUS)){let m=new Error(`An error occured linking the program: ${r.getProgramInfoLog(u)}.`);throw m.name="WebGLError",m}return r.useProgram(u),u},de=(r,s,u)=>{let m=r.createShader(s);if(r.shaderSource(m,u),r.compileShader(m),!r.getShaderParameter(m,r.COMPILE_STATUS)){let f=new Error(`An error occured compiling the shader: ${r.getShaderInfoLog(m)}.`);throw f.name="WebGLError",f}return m},c=`
                  attribute vec2 a_position;
                  attribute vec2 a_texCoord;
  
                  uniform mat3 u_matrix;
                  uniform mat3 u_textureMatrix;
  
                  varying vec2 v_texCoord;
                  void main(void) {
                  gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, 0, 1.0);
                  v_texCoord = vec4((u_textureMatrix * vec3(a_texCoord, 1)).xy, 0, 1.0).xy;
                  }
              `,a="rgb";["rgba","rbga","grba","gbra","brga","bgra"].includes(H)&&(a=H.slice(0,3));let l=`
                  precision mediump float;
                  varying vec2 v_texCoord;
                  uniform sampler2D u_image;
                  uniform float uColorFactor;
  
                  void main() {
                      vec4 sample = texture2D(u_image, v_texCoord);
                      float grey = 0.21 * sample.r + 0.71 * sample.g + 0.07 * sample.b;
                      gl_FragColor = vec4(sample.${a} * (1.0 - uColorFactor) + (grey * uColorFactor), sample.a);
                  }
              `,d=Ee(Z,[de(Z,Z.VERTEX_SHADER,c),de(Z,Z.FRAGMENT_SHADER,l)]);en(this,Os,{program:d,attribLocations:{vertexPosition:Z.getAttribLocation(d,"a_position"),texPosition:Z.getAttribLocation(d,"a_texCoord")},uniformLocations:{uSampler:Z.getUniformLocation(d,"u_image"),uColorFactor:Z.getUniformLocation(d,"uColorFactor"),uMatrix:Z.getUniformLocation(d,"u_matrix"),uTextureMatrix:Z.getUniformLocation(d,"u_textureMatrix")}},"f"),en(this,Ls,_(Z),"f"),en(this,vr,ue(Z),"f"),en(this,fa,H,"f")}let he=(_,ue,Ee)=>{_.bindBuffer(_.ARRAY_BUFFER,ue),_.enableVertexAttribArray(Ee),_.vertexAttribPointer(Ee,2,_.FLOAT,!1,0,0)},ce=(_,ue,Ee)=>{let de=_.RGBA,c=_.RGBA,a=_.UNSIGNED_BYTE;_.bindTexture(_.TEXTURE_2D,ue),_.texImage2D(_.TEXTURE_2D,0,de,c,a,Ee)},ye=(_,ue,Ee,de)=>{_.clearColor(0,0,0,1),_.clearDepth(1),_.enable(_.DEPTH_TEST),_.depthFunc(_.LEQUAL),_.clear(_.COLOR_BUFFER_BIT|_.DEPTH_BUFFER_BIT),he(_,Ee.positions,ue.attribLocations.vertexPosition),he(_,Ee.texCoords,ue.attribLocations.texPosition),_.activeTexture(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,de),_.uniform1i(ue.uniformLocations.uSampler,0),_.uniform1f(ue.uniformLocations.uColorFactor,[qe.GREY,qe.GREY32].includes(H)?1:0);let c,a,l=nn.translate(nn.identity(),-1,-1);l=nn.scale(l,2,2),l=nn.scale(l,1/_.canvas.width,1/_.canvas.height),c=nn.translate(l,M,R),c=nn.scale(c,O,B),_.uniformMatrix3fv(ue.uniformLocations.uMatrix,!1,c),a=nn.translate(nn.identity(),w/i,I/o),a=nn.scale(a,S/i,x/o),_.uniformMatrix3fv(ue.uniformLocations.uTextureMatrix,!1,a),_.drawArrays(_.TRIANGLES,0,6)};ce(Z,_t(this,vr,"f"),n),ye(Z,_t(this,Os,"f"),_t(this,Ls,"f"),_t(this,vr,"f"));let be=V||new Uint8Array(4*O*B);if(Z.readPixels(M,R,O,B,Z.RGBA,Z.UNSIGNED_BYTE,be),be[3]!==255){t._onLog&&t._onLog("Incorrect WebGL drawing .");let _=new Error("WebGL error: incorrect drawing.");throw _.name="WebGLError",_}return t._onLog&&t._onLog("drawImage() in WebGL end. Costs: "+(Date.now()-v)),{context:Z,pixelFormat:H===qe.GREY?qe.GREY32:H,bUseWebGL:!0}}catch(Z){if(this.forceLoseContext(),p?.bUseWebGL==null)return t._onLog&&t._onLog("'drawImage()' in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.drawImage(e,n,i,o,h,Object.assign({},p,{bUseWebGL:!1}));throw Z.name="WebGLError",Z}}readCvsData(e,n,i){if(!(e instanceof CanvasRenderingContext2D||e instanceof WebGLRenderingContext))throw new Error("Invalid 'context'.");let o,h=0,p=0,v=e.canvas.width,w=e.canvas.height;if(n&&(n.x&&(h=n.x),n.y&&(p=n.y),n.width&&(v=n.width),n.height&&(w=n.height)),i?.length<4*v*w)throw new Error("Unexpected size of the 'bufferContainer'.");if(e instanceof WebGLRenderingContext){let I=e;i?(I.readPixels(h,p,v,w,I.RGBA,I.UNSIGNED_BYTE,i),o=new Uint8Array(i.buffer,0,4*v*w)):(o=new Uint8Array(4*v*w),I.readPixels(h,p,v,w,I.RGBA,I.UNSIGNED_BYTE,o))}else if(e instanceof CanvasRenderingContext2D){let I;I=e.getImageData(h,p,v,w),o=new Uint8Array(I.data.buffer),i?.set(o)}return o}transformPixelFormat(e,n,i,o){let h,p;if(t._onLog&&(h=Date.now(),t._onLog("transformPixelFormat(), START: "+h)),n===i)return t._onLog&&t._onLog("transformPixelFormat() end. Costs: "+(Date.now()-h)),o?new Uint8Array(e):e;let v=[qe.RGBA,qe.RBGA,qe.GRBA,qe.GBRA,qe.BRGA,qe.BGRA];if(v.includes(n))if(i===qe.GREY){p=new Uint8Array(e.length/4);for(let w=0;w<e.length;w+=4){let I=.21*e[w]+.71*e[w+1]+.07*e[w+2];p[w/4]=I}}else if(i===qe.GREY32){p=o?new Uint8Array(e):e;for(let w=0;w<e.length;w+=4){let I=.21*e[w]+.71*e[w+1]+.07*e[w+2];p[w]=I,p[w+1]=I,p[w+2]=I}}else{if(!v.includes(i))throw new Error("Unable to transform.");if(o){p=new Uint8Array(e);let w=n.indexOf("r"),I=n.indexOf("g"),S=n.indexOf("b"),x=i.indexOf("r"),M=i.indexOf("g"),R=i.indexOf("b");for(let O=0;O<e.length;O+=4)p[O+x]=e[O+w],p[O+M]=e[O+I],p[O+R]=e[O+S]}else{p=e;let w=n.indexOf("r"),I=n.indexOf("g"),S=n.indexOf("b"),x=i.indexOf("r"),M=i.indexOf("g"),R=i.indexOf("b");for(let O=0;O<e.length;O+=4){let B=[e[O],e[O+1],e[O+2]];p[O+x]=B[w],p[O+M]=B[I],p[O+R]=B[S]}}}else if(n===qe.GREY){if(i!==qe.GREY32)throw new Error("Unable to transform.");p=new Uint8Array(4*e.length);for(let w=0;w<e.length;w++)p[4*w]=e[w],p[4*w+1]=e[w],p[4*w+2]=e[w],p[4*w+3]=255}else{if(n!==qe.GREY32)throw new Error("Unable to transform.");if(i!==qe.GREY)throw new Error("Unable to transform.");p=new Uint8Array(e.length/4);for(let w=0;w<e.length;w+=4)p[w/4]=e[w]}return t._onLog&&t._onLog("transformPixelFormat() end. Costs: "+(Date.now()-h)),p}getImageData(e,n,i,o,h){if(this.disposed)throw Error("The 'ImageDataGetter' instance has been disposed.");if(!n||!i)throw new Error("Invalid 'sourceWidth' or 'sourceHeight'.");if(_t(t,Mn,"f",Rn)==null&&t.checkWebGLSupport(),h?.bUseWebGL&&!_t(t,Mn,"f",Rn))throw new Error("Your browser or machine may not support WebGL.");if(o.sx>n||o.sy>i||o.sx+o.sWidth>n||o.sy+o.sHeight>i)throw new Error("Invalid position.");if(e instanceof HTMLVideoElement&&e.readyState!==4||e instanceof HTMLImageElement&&!e.complete)throw new Error("The source is not loaded.");let p;t._onLog&&(p=Date.now(),t._onLog("getImageData(), START: "+p));let v=Math.round(o.sx),w=Math.round(o.sy),I=Math.round(o.sWidth),S=Math.round(o.sHeight),x=Math.round(o.dWidth),M=Math.round(o.dHeight),R=qe.RGBA;h?.pixelFormat&&(R=h.pixelFormat);let O,B,V,H=null;if(h?.bufferContainer&&(H=h.bufferContainer),_t(t,Mn,"f",Rn)&&(this.useWebGLByDefault&&h?.bUseWebGL==null||h?.bUseWebGL)){t._onLog&&t._onLog("getImageData() in WebGL."),this._reusedWebGLCvs||(this._reusedWebGLCvs=document.createElement("canvas")),O=this._reusedWebGLCvs;try{if(H)if(R===qe.GREY){if(V=new Uint8Array(4*x*M),B=this.drawImage(O,e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},{pixelFormat:R,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,B.pixelFormat,R),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}}else B=this.drawImage(O,e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},{pixelFormat:R,bUseWebGL:!0,bufferContainer:H}),V=new Uint8Array(H.buffer,0,4*x*M),V=this.transformPixelFormat(V,B.pixelFormat,R);else R===qe.GREY?((!_t(this,yr,"f")||_t(this,yr,"f").length<4*x*M)&&en(this,yr,new Uint8Array(4*x*M),"f"),V=new Uint8Array(_t(this,yr,"f").buffer,0,4*x*M)):V=new Uint8Array(4*x*M),B=this.drawImage(O,e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},{pixelFormat:R,bUseWebGL:!0,bufferContainer:V}),V=this.transformPixelFormat(V,B.pixelFormat,R)}catch(Y){if(Y.name==="WebGLError"&&(this.forceLoseContext(),h?.bUseWebGL==null))return t._onLog&&t._onLog("getImageData() in WebGL failed, try again in context2d."),this.useWebGLByDefault=!1,this.getImageData(e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},Object.assign({},h,{bUseWebGL:!1}));throw Y}}else if(t._onLog&&t._onLog("getImageData() in context2d."),this._reusedCvs||(this._reusedCvs=document.createElement("canvas")),O=this._reusedCvs,B=this.drawImage(O,e,n,i,{sx:v,sy:w,sWidth:I,sHeight:S,dWidth:x,dHeight:M},{pixelFormat:qe.RGBA,bUseWebGL:!1}),V=this.readCvsData(B.context,{width:x,height:M},null),V=this.transformPixelFormat(V,B.pixelFormat,R),H){if(H.length<V.length)throw new Error("Unexpected size of the 'bufferContainer'.");H.set(V)}return t._onLog&&t._onLog("getImageData() end. Costs: "+(Date.now()-p)),{data:V,pixelFormat:R,width:x,height:M,bUseWebGL:B.bUseWebGL}}convertDataToCvs(e,n,i,o){if(!(e instanceof Uint8Array||e instanceof Uint8ClampedArray))throw new TypeError("Invalid 'data'.");if(typeof n!="number"||n<=0)throw new Error("Invalid 'width'.");if(typeof i!="number"||i<=0)throw new Error("Invalid 'height'.");let h=document.createElement("canvas"),p;if(h.width=n,h.height=i,o===qe.GREY){p=new Uint8ClampedArray(4*n*i);for(let w=0;w<p.length;w+=4)p[w]=e[w/4],p[w+1]=e[w/4],p[w+2]=e[w/4],p[w+3]=255}else p=new Uint8ClampedArray(e.buffer);let v=new ImageData(p,n,i);return h.getContext("2d").putImageData(v,0,0),h}forceLoseContext(){if(!this._reusedWebGLCvs)return;let e=this._reusedWebGLCvs.ctxWebGL;e&&!e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").loseContext(),en(this,vr,null,"f"),en(this,Os,null,"f"),en(this,Ls,null,"f"),this._reusedWebGLCvs=null}dispose(){this.forceLoseContext(),en(this,ga,!0,"f")}};Mn=Ou,fa=new WeakMap,vr=new WeakMap,Os=new WeakMap,Ls=new WeakMap,yr=new WeakMap,ga=new WeakMap,Rn={value:void 0};aw=new WeakMap,lw=new WeakMap;uw=new WeakMap,hw=new WeakMap,dw=new WeakMap,fw=new WeakMap,gw=new WeakMap,cw=new WeakSet,pw=function(){let t=document.createElement("div");return t.className=this.containerClassName,t.style.width="100%",t.style.height="100%",t};var Er=class t{static beep(){if(!this.beepSoundSource)return;let e;if(b(this,Bt,"f",Fs).size&&(e=b(this,Bt,"f",Fs).values().next().value,this.beepSoundSource==e.src?(b(this,Bt,"f",Fs).delete(e),e.play()):e=null),!e)if(b(this,Bt,"f",Ns).size<64){e=new Audio(this.beepSoundSource);let n=null,i=()=>{e.removeEventListener("loadedmetadata",i),e.play(),n=setTimeout(()=>{b(this,Bt,"f",Ns).delete(e)},2e3*e.duration)};e.addEventListener("loadedmetadata",i),e.addEventListener("ended",()=>{n!=null&&(clearTimeout(n),n=null),e.pause(),e.currentTime=0,b(this,Bt,"f",Ns).delete(e),b(this,Bt,"f",Fs).add(e)})}else b(this,Bt,"f",Ru)||(Ce(this,Bt,!0,"f",Ru),console.warn("The requested audio tracks exceed 64 and will not be played."));e&&b(this,Bt,"f",Ns).add(e)}static vibrate(){if(!navigator||!navigator.vibrate)throw new Error("Not supported.");navigator.vibrate(t.vibrateDuration)}};Bt=Er,ap={value:"data:audio/mpeg;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA/+M4wAAAAAAAAAAAAEluZm8AAAAPAAAABQAAAkAAgICAgICAgICAgICAgICAgICAgKCgoKCgoKCgoKCgoKCgoKCgoKCgwMDAwMDAwMDAwMDAwMDAwMDAwMDg4ODg4ODg4ODg4ODg4ODg4ODg4P//////////////////////////AAAAAExhdmM1OC41NAAAAAAAAAAAAAAAACQEUQAAAAAAAAJAk0uXRQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/+MYxAANQAbGeUEQAAHZYZ3fASqD4P5TKBgocg+Bw/8+CAYBA4XB9/4EBAEP4nB9+UOf/6gfUCAIKyjgQ/Kf//wfswAAAwQA/+MYxAYOqrbdkZGQAMA7DJLCsQxNOij///////////+tv///3RWiZGBEhsf/FO/+LoCSFs1dFVS/g8f/4Mhv0nhqAieHleLy/+MYxAYOOrbMAY2gABf/////////////////usPJ66R0wI4boY9/8jQYg//g2SPx1M0N3Z0kVJLIs///Uw4aMyvHJJYmPBYG/+MYxAgPMALBucAQAoGgaBoFQVBUFQWDv6gZBUFQVBUGgaBr5YSgqCoKhIGg7+IQVBUFQVBoGga//SsFSoKnf/iVTEFNRTMu/+MYxAYAAANIAAAAADEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV"},Ru={value:!1},Fs={value:new Set},Ns={value:new Set},Er.beepSoundSource=b(Er,Bt,"f",ap),Er.vibrateDuration=300;var Cp=typeof self>"u",Bu=(()=>{if(!Cp&&document.currentScript){let t=document.currentScript.src,e=t.indexOf("?");if(e!=-1)t=t.substring(0,e);else{let n=t.indexOf("#");n!=-1&&(t=t.substring(0,n))}return t.substring(0,t.lastIndexOf("/")+1)}return"./"})(),Ip=t=>{if(t==null&&(t="./"),!Cp){let e=document.createElement("a");e.href=t,t=e.href}return t.endsWith("/")||(t+="/"),t};Se.utility==null&&(Se.utility=Bu),Tt.utility={js:!0,wasm:!0};var Fu="1.2.10";typeof Se.std!="string"&&Qt(Se.std.version,Fu)<0&&(Se.std={version:Fu,path:Ip(Bu+`../../dynamsoft-capture-vision-std@${Fu}/dist/`)});var Nu="2.2.30";(!Se.dip||typeof Se.dip!="string"&&Qt(Se.dip.version,Nu)<0)&&(Se.dip={version:Nu,path:Ip(Bu+`../../dynamsoft-image-processing@${Nu}/dist/`)});var Ia={barcode:2,text_line:4,detected_quad:8,normalized_image:16},br=t=>Object.values(Ia).includes(t)||Ia.hasOwnProperty(t),Pu=(t,e)=>typeof t=="string"?e[Ia[t]]:e[t],ku=(t,e,n)=>{typeof t=="string"?e[Ia[t]]=n:e[t]=n},Da=class{constructor(){this.verificationEnabled={[De.CRIT_BARCODE]:!1,[De.CRIT_TEXT_LINE]:!0,[De.CRIT_DETECTED_QUAD]:!0,[De.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateFilterEnabled={[De.CRIT_BARCODE]:!1,[De.CRIT_TEXT_LINE]:!1,[De.CRIT_DETECTED_QUAD]:!1,[De.CRIT_NORMALIZED_IMAGE]:!1},this.duplicateForgetTime={[De.CRIT_BARCODE]:3e3,[De.CRIT_TEXT_LINE]:3e3,[De.CRIT_DETECTED_QUAD]:3e3,[De.CRIT_NORMALIZED_IMAGE]:3e3}}enableResultCrossVerification(e,n){br(e)&&ku(e,this.verificationEnabled,n)}isResultCrossVerificationEnabled(e){return!!br(e)&&Pu(e,this.verificationEnabled)}enableResultDeduplication(e,n){br(e)&&ku(e,this.duplicateFilterEnabled,n)}isResultDeduplicationEnabled(e){return!!br(e)&&Pu(e,this.duplicateFilterEnabled)}setDuplicateForgetTime(e,n){br(e)&&(n>18e4&&(n=18e4),n<0&&(n=0),ku(e,this.duplicateForgetTime,n))}getDuplicateForgetTime(e){return br(e)?Pu(e,this.duplicateForgetTime):-1}getFilteredResultItemTypes(){let e=0,n=[De.CRIT_BARCODE,De.CRIT_TEXT_LINE,De.CRIT_DETECTED_QUAD];for(let i=0;i<n.length;i++)(this.verificationEnabled[n[i]]||this.duplicateFilterEnabled[n[i]])&&(e|=n[i]);return e}onOriginalImageResultReceived(e){}onDecodedBarcodesReceived(e){if(this.isResultCrossVerificationEnabled(De.CRIT_BARCODE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===De.CRIT_BARCODE&&!e[n].verified&&(e[n].isFilter=!0);if(this.isResultDeduplicationEnabled(De.CRIT_BARCODE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===De.CRIT_BARCODE&&e[n].duplicate&&(e[n].isFilter=!0)}onRecognizedTextLinesReceived(e){if(this.isResultCrossVerificationEnabled(De.CRIT_TEXT_LINE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===De.CRIT_TEXT_LINE&&!e[n].verified&&(e[n].isFilter=!0);if(this.isResultDeduplicationEnabled(De.CRIT_TEXT_LINE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===De.CRIT_TEXT_LINE&&e[n].duplicate&&(e[n].isFilter=!0)}onDetectedQuadsReceived(e){if(this.isResultCrossVerificationEnabled(De.CRIT_DETECTED_QUAD))for(let n=0;n<e.length;n++)e[n]&&e[n].type===De.CRIT_DETECTED_QUAD&&!e[n].verified&&(e[n].isFilter=!0);if(this.isResultDeduplicationEnabled(De.CRIT_DETECTED_QUAD))for(let n=0;n<e.length;n++)e[n]&&e[n].type===De.CRIT_DETECTED_QUAD&&e[n].duplicate&&(e[n].isFilter=!0)}onNormalizedImagesReceived(e){if(this.isResultCrossVerificationEnabled(De.CRIT_NORMALIZED_IMAGE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===De.CRIT_NORMALIZED_IMAGE&&!e[n].verified&&(e[n].isFilter=!0);if(this.isResultDeduplicationEnabled(De.CRIT_NORMALIZED_IMAGE))for(let n=0;n<e.length;n++)e[n]&&e[n].type===De.CRIT_NORMALIZED_IMAGE&&e[n].duplicate&&(e[n].isFilter=!0)}};var mw=["uiContainer"],vw=["resultsContainer"],oi="videoCapture component destoryed",Dp=(()=>{let e=class e{constructor(){this.pInit=new Promise(i=>{this.resolveInit=i}),this.bDestoryed=!1}ngAfterViewInit(){return z(this,null,function*(){try{let i=yield pn.createInstance();if(this.bDestoryed||(this.cameraEnhancer=yield Mt.createInstance(i),this.bDestoryed)||(this.uiContainer.nativeElement.append(i.getUIElement()),this.cvRouter=yield rr.createInstance(),this.bDestoryed))throw Error(oi);this.cvRouter.setInput(this.cameraEnhancer),this.cvRouter.addResultReceiver({onDecodedBarcodesReceived:h=>{if(h.barcodeResultItems.length){this.resultsContainer.nativeElement.textContent="",console.log(h);for(let p of h.barcodeResultItems)this.resultsContainer.nativeElement.append(`${p.formatString}: ${p.text}`,document.createElement("br"),document.createElement("hr"))}}});let o=new Da;if(o.enableResultCrossVerification("barcode",!0),o.enableResultDeduplication("barcode",!0),yield this.cvRouter.addResultFilter(o),this.bDestoryed||(yield this.cameraEnhancer.open(),this.bDestoryed)||(yield this.cvRouter.startCapturing("ReadSingleBarcode"),this.bDestoryed))throw Error(oi)}catch(i){if(i?.message===oi)console.log(oi);else{let o=i.message||i;console.error(o),alert(o)}}this.resolveInit()})}ngOnDestroy(){return z(this,null,function*(){this.bDestoryed=!0;try{yield this.pInit,this.cvRouter?.dispose(),this.cameraEnhancer?.dispose()}catch{}})}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=Qi({type:e,selectors:[["app-video-capture"]],viewQuery:function(o,h){if(o&1&&(Zr(mw,5),Zr(vw,5)),o&2){let p;Qr(p=Kr())&&(h.uiContainer=p.first),Qr(p=Kr())&&(h.resultsContainer=p.first)}},standalone:!0,features:[nr],decls:6,vars:0,consts:[["uiContainer",""],["resultsContainer",""],[1,"div-ui-container"],[1,"div-results-container"]],template:function(o,h){o&1&&(Dn(0,"div",2,0),tr(2,`
Results:
`),Dn(3,"br")(4,"div",3,1))},styles:[".div-ui-container[_ngcontent-%COMP%]{width:100%;height:70vh}.div-results-container[_ngcontent-%COMP%]{width:100%;height:10vh;overflow:auto}"]});let t=e;return t})();var bp=t=>({"background-color":t});function yw(t,e){t&1&&Dn(0,"app-video-capture")}function _w(t,e){t&1&&Dn(0,"app-image-capture")}var Tp=(()=>{let e=class e{constructor(){this.title="dbrjs-sample-angular",this.mode="video"}switchMode(i){this.mode=i}};e.\u0275fac=function(o){return new(o||e)},e.\u0275cmp=Qi({type:e,selectors:[["app-root"]],standalone:!0,features:[nr],decls:11,vars:7,consts:[[1,"App"],[1,"title"],[1,"title-text"],[1,"top-btns"],[3,"click","ngStyle"]],template:function(o,h){o&1&&(Wn(0,"div",0)(1,"div",1)(2,"h2",2),tr(3,"Hello World for Angular"),hn()(),Wn(4,"div",3)(5,"button",4),er("click",function(){return h.switchMode("video")}),tr(6,"Video Capture"),hn(),Wn(7,"button",4),er("click",function(){return h.switchMode("image")}),tr(8,"Image Capture"),hn()(),bc(9,yw,1,0,"app-video-capture")(10,_w,1,0),hn()),o&2&&(wo(5),bo("ngStyle",Tc(3,bp,h.mode==="video"?"rgb(255,174,55)":"white")),wo(2),bo("ngStyle",Tc(5,bp,h.mode==="image"?"rgb(255,174,55)":"white")),wo(2),Bf(9,h.mode==="video"?9:10))},dependencies:[Xf,Yg,Dp],styles:[".title[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:20px}.title[_ngcontent-%COMP%]   .title-logo[_ngcontent-%COMP%]{width:60px;height:60px;animation:_ngcontent-%COMP%_retate 5s infinite linear}.top-btns[_ngcontent-%COMP%]{width:30%;margin:20px auto}.top-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:inline-block;border:1px solid black;padding:5px 15px;background-color:transparent;cursor:pointer}.top-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px;border-right:transparent}.top-btns[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:nth-child(2){border-top-right-radius:10px;border-bottom-right-radius:10px;border-left:transparent}@media screen and (max-width: 500px){.top-btns[_ngcontent-%COMP%]{width:70%}}@keyframes _ngcontent-%COMP%_retate{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"]});let t=e;return t})();ig(Tp).catch(t=>console.error(t));
